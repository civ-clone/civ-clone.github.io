"use strict";(()=>{var xW=Object.create;var Hp=Object.defineProperty;var vW=Object.getOwnPropertyDescriptor;var bW=Object.getOwnPropertyNames;var CW=Object.getPrototypeOf,TW=Object.prototype.hasOwnProperty;var t=(r,e)=>Hp(r,"name",{value:e,configurable:!0});var n=(r,e)=>()=>(r&&(e=r(r=0)),e);var T=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),lc=(r,e)=>{for(var i in e)Hp(r,i,{get:e[i],enumerable:!0})},sb=(r,e,i,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of bW(e))!TW.call(r,a)&&a!==i&&Hp(r,a,{get:()=>e[a],enumerable:!(o=vW(e,a))||o.enumerable});return r};var P=(r,e,i)=>(i=r!=null?xW(CW(r)):{},sb(e||!r||!r.__esModule?Hp(i,"default",{value:r,enumerable:!0}):i,r)),O=r=>sb(Hp({},"__esModule",{value:!0}),r);var lb=(r,e,i)=>{if(!e.has(r))throw TypeError("Cannot "+i)};var C=(r,e,i)=>(lb(r,e,"read from private field"),i?i.call(r):e.get(r)),xe=(r,e,i)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,i)},Ye=(r,e,i,o)=>(lb(r,e,"write to private field"),o?o.call(r,i):e.set(r,i),i),mb=(r,e,i,o)=>({set _(a){Ye(r,e,a,i)},get _(){return C(r,e,o)}});var F,Os,fe=n(()=>{F=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return this.#e.some(i=>e instanceof i)}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,i){return this.filter(o=>{let a=o[e];return a instanceof Function?a.bind(o)()===i:o[e]===i})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(i=>{if(!this.accepts(i))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${i}'.`);this.#t.includes(i)||this.#t.push(i)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(i=>{let o=this.#t.indexOf(i);o>-1&&this.#t.splice(o,1)})}};t(F,"EntityRegistry");Os=F});var mc,$,ft=n(()=>{mc=class{#e;#t;#r;constructor(e,i,o){this.#e=i,this.#t=o,this.#r=e}data(...e){return this.#t(...e)}key(){return this.#e}type(){return this.#r}};t(mc,"AdditionalData");$=mc});var pc,te,Tt=n(()=>{fe();ft();pc=class extends F{constructor(){super($)}getByType(e){return this.filter(i=>i.type()===e||Object.prototype.isPrototypeOf.call(i.type(),e)||Object.prototype.isPrototypeOf.call(i.type().prototype,e))}};t(pc,"AdditionalDataRegistry");te=new pc});var PW,XO,pb=n(()=>{Z();PW=t(r=>{let e=r instanceof ve?r.sourceClass():r,i=[];for(;e instanceof Function;)i.push(e),e=Object.getPrototypeOf(e);return i.map(o=>o.name)},"generateInheritance"),XO=PW});var uc,wW,_p,k,ve,Z=n(()=>{Tt();fe();pb();uc={},wW=t(r=>{let e=r.sourceClass().name,i=uc[e];return i||(uc[e]=0),i>=Number.MAX_SAFE_INTEGER&&(uc[e]=BigInt(i)),e+"-"+(++uc[e]).toString(36)},"idProvider"),_p=t((r,e,i=a=>a,o=te)=>{if(r=i(r),r instanceof Os&&(r=r.entries()),Array.isArray(r))return r.map(a=>_p(a,e,i,o));if(r instanceof k){let a=r.id();if(!(a in e)){let s={_:r.sourceClass().name,__:XO(r)};e[a]=s,r.keys().forEach(l=>{let u=r[l]instanceof Function?r[l]():r[l];s[l]=_p(u,e,i,o)}),o.getByType(r.sourceClass()).forEach(l=>{s[l.key()]=_p(l.data(r),e,i,o)})}return{"#ref":a}}return r instanceof Function?{_:r.name,__:XO(r)}:r&&r instanceof Object?Object.entries(r).reduce((a,[s,l])=>(a[s]=_p(l,e,i,o),a),{}):r},"toPlainObject"),k=class{#e;#t=["id"];constructor(){this.#e=wW(this)}addKey(...e){this.#t.push(...e)}id(){return this.#e}keys(){return this.#t}sourceClass(){return this.constructor}toPlainObject(e=o=>o,i=te){let o={};return{hierarchy:_p(this,o,e,i),objects:o}}};t(k,"DataObject");ve=k});var mm,nr,Fn=n(()=>{Z();mm=class extends k{#e;#t;constructor(e,i){super(),this.#e=e,this.#t=i,this.addKey("value")}player(){return this.#e}value(){return this.#t}};t(mm,"PlayerAction");nr=mm});var cc,yi,Cl=n(()=>{Fn();cc=class extends nr{};t(cc,"MandatoryPlayerAction");yi=cc});var Rs,ub=n(()=>{Cl();Rs=class extends yi{};t(Rs,"ActiveUnit")});var xs,cb=n(()=>{Fn();xs=class extends nr{};t(xs,"InactiveUnit")});var eR=n(()=>{ub();cb()});var yc,x,M=n(()=>{Z();yc=class extends ve{};t(yc,"Advance");x=yc});var _e,yb,to=n(()=>{_e=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return typeof e=="function"&&this.#e.some(i=>Object.prototype.isPrototypeOf.call(i,e)||Object.prototype.isPrototypeOf.call(i.prototype,e))}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,i){return this.filter(o=>{let a=o[e];return a instanceof Function?a.bind(o)()===i:o[e]===i})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(i=>{if(!this.accepts(i))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${i}'.`);this.#t.includes(i)||this.#t.push(i)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(i=>{let o=this.#t.indexOf(i);o>-1&&this.#t.splice(o,1)})}};t(_e,"ConstructorRegistry");yb=_e});var fc,R,U=n(()=>{M();to();fc=class extends _e{constructor(){super(x)}};t(fc,"AdvanceRegistry");R=new fc});var pm,m,I=n(()=>{pm=class{#e=null;constructor(e){e&&(this.#e=e)}validate(...e){return this.#e===null?!0:this.#e(...e)}};t(pm,"Criterion");m=pm});var dc,gc,tR=n(()=>{I();dc=class extends m{#e=[];constructor(...e){super(),e.forEach(i=>{this.#e.push(i)})}criteria(){return this.#e}validate(...e){return this.#e.every(i=>i.validate(...e))}};t(dc,"Criteria");gc=dc});var hc,kn,Oc=n(()=>{tR();hc=class extends gc{};t(hc,"And");kn=hc});var Rc,p,v=n(()=>{Rc=class{#e;constructor(e){this.#e=e}apply(...e){return this.#e(...e)}};t(Rc,"Effect");p=Rc});var xc,_r,vs=n(()=>{xc=class{#e;constructor(e=2e3){this.#e=e}value(){return this.#e}};t(xc,"Priority");_r=xc});var ga,Yn,Tl=n(()=>{vs();ga=class extends _r{constructor(){super(1e3)}};t(ga,"High");Yn=ga});var tt,fb,rR=n(()=>{vs();tt=class extends _r{constructor(){super(3e3)}};t(tt,"Low");fb=tt});var um,db=n(()=>{vs();um=class extends _r{constructor(){super(2e3)}};t(um,"Normal")});var ha=n(()=>{Tl();rR();db()});var vc,g,A=n(()=>{Oc();I();v();ha();vc=class{#e;#t=!0;#r;#i=new um;constructor(...e){let i=[];e.forEach(o=>{if(o instanceof p){if(this.#r)throw new TypeError("Rule: effect already specified, but another was provided.");this.#r=o;return}if(o instanceof m){i.push(o);return}this.#i=o}),i.length&&(this.#e=new kn(...i))}disable(){this.#t=!1}enable(){this.#t=!0}enabled(){return this.#t}priority(){return this.#i}process(...e){if(!!this.#t&&this.#r instanceof p)return this.#r.apply(...e)}validate(...e){return this.#t?this.#e instanceof m?this.#e.validate(...e):!0:!1}};t(vc,"Rule");g=vc});var bc,d,w=n(()=>{fe();A();bc=class extends F{#e=new Map;constructor(){super(g)}entries(){return super.entries().sort((e,i)=>e.priority().value()-i.priority().value())}get(e){return this.#e.has(e)||this.#e.set(e,this.filter(i=>i.enabled()&&i instanceof e)),this.#e.get(e)||[]}invalidateCache(e){this.#e.delete(e instanceof g?e.constructor:e)}process(e,...i){return this.get(e).filter(o=>o.validate(...i)).map(o=>o.process(...i))}register(...e){super.register(...e),e.forEach(i=>this.invalidateCache(i))}unregister(...e){super.unregister(...e),e.forEach(i=>this.invalidateCache(i))}};t(bc,"RuleRegistry");d=new bc});var Cc,bs,Tc=n(()=>{A();Cc=class extends g{};t(Cc,"Complete");bs=Cc});var Pc,wc,iR=n(()=>{A();Pc=class extends g{};t(Pc,"Cost");wc=Pc});var Ic,Ac,oR=n(()=>{A();Ic=class extends g{};t(Ic,"Requirements");Ac=Ic});var Cs,W,De=n(()=>{Z();Cs=class extends k{#e=[];#t=null;constructor(e=0,i="initial"){super(),this.addKey("value","values"),this.add(e,i)}add(e,i=""){if(e instanceof Cs)return this.add(e.value(),i);this.#e.push([e,i]),this.#t=null}clone(){return new this.constructor(this)}set(e,i=""){if(this.#e.splice(0),e instanceof Cs)return this.set(e.value(),i);this.#e.push([e,i]),this.#t=e}subtract(e,i=""){if(e instanceof Cs)return this.subtract(e.value(),i);this.#e.push([-e,i]),this.#t=null}value(){return this.#t===null&&(this.#t=this.#e.reduce((e,[i])=>e+i,0)),this.#t}values(){return this.#e}};t(Cs,"Yield");W=Cs});var Pl,gb=n(()=>{De();Pl=class extends W{};t(Pl,"Research")});var hb=n(()=>{gb()});var Bc,cm,Gc=n(()=>{A();Bc=class extends g{};t(Bc,"Started");cm=Bc});var Uc,ym,Mc=n(()=>{U();Z();w();Tc();iR();oR();hb();Gc();Uc=class extends k{#e;#t=[];#r=null;#i;#o=new Pl(1/0);#n=new Pl(0);#a;constructor(e,i=R,o=d){super(),this.#e=i,this.#i=e,this.#a=o,this.addKey("available","complete","cost","progress","researching")}add(e){this.#n.add(e),this.check()}addAdvance(e){if(this.#t.some(o=>o instanceof e))return;this.#r===e&&(this.#r=null);let i=new e;this.#t.push(i),this.#a.process(bs,this,i)}available(){let e=this.#a.get(Ac);return this.#e.filter(i=>e.filter(o=>o.validate(i,this.#t)).every(o=>o.process(i,this.#t)===!0)&&!this.#t.some(o=>o instanceof i))}check(){if(this.#r!==null&&this.#n.value()>=this.#o.value()){let e=new this.#r;this.#t.push(e),this.#r=null,this.#n.subtract(this.#o),this.#o.set(1/0),this.#a.process(bs,this,e)}}complete(){return this.#t}completed(e){return this.#t.some(i=>i instanceof e)}cost(){return this.#o}player(){return this.#i}progress(){return this.#n}research(e){let[i]=this.#a.process(wc,e,this);this.#o.set(i),this.#r=e,this.#a.process(cm,this,e)}researching(){return this.#r}};t(Uc,"PlayerResearch");ym=Uc});var Dc,L,We=n(()=>{fe();Mc();Dc=class extends F{constructor(){super(ym)}getByPlayer(e){let i=this.getBy("player",e);if(i.length!==1)throw new TypeError("Wrong number of results for player.");return i[0]}};t(Dc,"PlayerResearchRegistry");L=new Dc});var fm,dm,Kp=n(()=>{fm=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}goodyHut(){return this.#e}perform(){}unit(){return this.#t}};t(fm,"Action");dm=fm});var Ts,Ob=n(()=>{We();Kp();Ts=class extends dm{#e;#t;constructor(e,i,o=L,a=()=>Math.random()){super(e,i),this.#e=o,this.#t=a}perform(){let e=this.#e.getByPlayer(this.unit().player()),i=e.available(),o=i[Math.floor(i.length*this.#t())];e.addAdvance(o)}};t(Ts,"Advance")});var Ec,gm,nR=n(()=>{A();Ec=class extends g{};t(Ec,"CanBeWorked");gm=Ec});var Sc,Fc,aR=n(()=>{A();Sc=class extends g{};t(Sc,"Created");Fc=Sc});var kc,Wn,hm=n(()=>{Z();w();aR();kc=class extends k{#e;constructor(e=d){super(),this.#e=e,this.#e.process(Fc,this)}clone(){return new this.constructor(this.#e)}};t(kc,"Terrain");Wn=kc});var _,Rb=n(()=>{hm();_=class extends Wn{};t(_,"Land")});var ar,sR=n(()=>{hm();ar=class extends Wn{};t(ar,"Water")});var sr=n(()=>{Rb();sR()});var Yc,Wc,lR=n(()=>{A();Yc=class extends g{};t(Yc,"YieldModifier");Wc=Yc});var zc,fi,mR=n(()=>{A();zc=class extends g{};t(zc,"Yield");fi=zc});var Om,ue,di=n(()=>{Z();sr();w();qp();De();lR();mR();Om=class extends k{#e;#t=[];#r;#i;#o;#n;#a=new Map;constructor(e,i,o,a,s=d){super(),this.#o=e,this.#n=i,this.#i=o,this.#e=a,this.#r=s,this.addKey("terrain","isCoast","isLand","isWater","x","y","yields")}clearYieldCache(e=null){this.#a.delete(e)}getAdjacent(){return this.getAdjacentDirections().map(e=>this.getNeighbour(e))}getAdjacentDirections(){return["n","e","s","w"]}getNeighbour(e){return e==="n"?this.#e.get(this.#o,this.#n-1):e==="ne"?this.#e.get(this.#o+1,this.#n-1):e==="e"?this.#e.get(this.#o+1,this.#n):e==="se"?this.#e.get(this.#o+1,this.#n+1):e==="s"?this.#e.get(this.#o,this.#n+1):e==="sw"?this.#e.get(this.#o-1,this.#n+1):e==="w"?this.#e.get(this.#o-1,this.#n):this.#e.get(this.#o-1,this.#n-1)}getNeighbouringDirections(){return["n","ne","e","se","s","sw","w","nw"]}getNeighbours(){return this.#t.length||(this.#t=this.getNeighbouringDirections().map(e=>this.getNeighbour(e))),this.#t}getSurroundingArea(e=2){return Rm.fromSurrounding(this,e)}distanceFrom(e){let i=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[o]=i.map(([a,s])=>Math.hypot(this.#o-e.x()+a*this.#e.width(),this.#n-e.y()+s*this.#e.height())).sort((a,s)=>a-s);return o}isCoast(){let e=this;return e.isWater()&&e.getNeighbours().some(i=>i.isLand())||e.isLand()&&e.getNeighbours().some(i=>i.isWater())}isLand(){return this.#i instanceof _}isNeighbourOf(e){return this.getNeighbours().includes(e)}isWater(){return this.#i instanceof ar}map(){return this.#e}score(e=null,i=[[W,3]]){return this.yields(e).map(a=>{let[s]=i.filter(([u])=>a instanceof u),l=s?s[1]||1:0;return a.value()*l}).reduce((a,s)=>a+s,0)}terrain(){return this.#i}setTerrain(e){this.#i=e}x(){return this.#o}y(){return this.#n}yields(e=null){if(!this.#a.has(e)){let i=this.#r.process(fi,this,e).flat();this.#r.process(Wc,this,e,i).flat(),this.#a.set(e,i)}return this.#a.get(e)}};t(Om,"Tile");ue=Om});var xm,Rm,qp=n(()=>{fe();di();xm=class extends F{static from(...e){return new this(...e)}static fromSurrounding(e,i=2){let o=t(a=>{let s=[];for(let l=e.x()-a;l<=e.x()+a;l++)for(let u=e.y()-a;u<=e.y()+a;u++)s.push([l,u]);return s},"gen");return this.from(...o(i).map(([a,s])=>e.map().get(a,s)))}constructor(...e){super(Om),this.register(...e)}push(...e){this.register(...e)}shift(){let[e]=this.entries();return this.unregister(e),e}score(e=null,i=[]){return this.entries().reduce((o,a)=>o+a.score(e,i),0)}yields(e=null){return this.entries().flatMap(i=>i.yields(e))}};t(xm,"Tileset");Rm=xm});var Lc,Ps,Nc=n(()=>{Z();Lc=class extends ve{#e;#t;constructor(e,i){super(),this.#e=i,this.#t=e,this.addKey("city","tile")}city(){return this.#e}tile(){return this.#t}};t(Lc,"WorkedTile");Ps=Lc});var jc,ze,ro=n(()=>{w();nR();fe();qp();Nc();jc=class extends Os{#e;constructor(e=d){super(Ps),this.#e=e}getByCity(e){return this.getBy("city",e)}getByTile(e){let[i]=this.getBy("tile",e);return i??null}getTilesByCity(e){return Rm.from(...this.filter(i=>i.city()===e).map(i=>i.tile()))}register(...e){e.forEach(i=>{let o=i.tile();if(this.getByTile(o)!==null)throw new TypeError(`Tile ${o.x()}, ${o.y()} is already worked!`);super.register(i)})}tileCanBeWorkedBy(e,i){return this.#e.process(gm,e,i).every(o=>o)}tileIsWorked(e){return!!this.getByTile(e)}unregisterByTile(e){let i=this.getByTile(e);i!==null&&this.unregister(i)}};t(jc,"WorkedTileRegistry");ze=new jc});var Hc,lr,wl=n(()=>{A();Hc=class extends g{};t(Hc,"Captured");lr=Hc});var _c,Kc,pR=n(()=>{A();_c=class extends g{};t(_c,"Tiles");Kc=_c});var qc,lt,vm=n(()=>{A();qc=class extends g{};t(qc,"Cost");lt=qc});var Vc,Qo,Jc=n(()=>{A();Vc=class extends g{};t(Vc,"Created");Qo=Vc});var $c,Cr,Il=n(()=>{A();$c=class extends g{};t($c,"Destroyed");Cr=$c});var bm,Xo,Cm=n(()=>{A();bm=class extends g{};t(bm,"Yield");Xo=bm});var Zc,Al,Qc=n(()=>{A();Zc=class extends g{};t(Zc,"YieldModifier");Al=Zc});var Xc,Ke,zn=n(()=>{Z();w();ro();wl();pR();vm();Jc();Il();De();Cm();Qc();Xc=class extends k{#e=!1;#t;#r;#i;#o;#n;#a;#s;constructor(e,i,o,a=d,s=ze){super(),this.#t=o,this.#r=e,this.#i=e,this.#n=i,this.#o=a,this.#s=s,[this.#a]=this.#o.process(Kc,this),this.#o.process(Qo,this),this.addKey("destroyed","name","originalPlayer","player","tile","tiles","tilesWorked","yields")}capture(e){let i=this.#i;this.#i=e,this.#o.process(lr,this,e,i)}destroy(e=null){this.#e=!0,this.#o.process(Cr,this,e)}destroyed(){return this.#e}name(){return this.#t}setName(e){this.#t=e}originalPlayer(){return this.#r}player(){return this.#i}tile(){return this.#n}tiles(){return this.#a}tilesWorked(){return this.#s.getTilesByCity(this)}yields(){let e=[];return[this.#o.get(Xo),this.#o.get(Al),this.#o.get(lt)].flat().forEach(i=>{if(!i.validate(this,e))return;let o=i.process(this,e);if(!!o){if(o instanceof W){e.push(o);return}o.forEach(a=>e.push(a))}}),e}};t(Xc,"City");Ke=Xc});var ey,N,qe=n(()=>{fe();zn();ey=class extends F{constructor(){super(Ke)}getByPlayer(e,i=!1){return i?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){let[i]=this.filter(o=>o.tile()===e&&!o.destroyed());return i??null}};t(ey,"CityRegistry");N=new ey});var ws,xb=n(()=>{qe();w();Kp();zn();ws=class extends dm{#e;constructor(e,i,o=N){super(e,i),this.#e=o}perform(e=d){let i=this.unit().player(),o=new Ke(i,this.goodyHut().tile(),i.civilization().getCityName(!0),e);this.#e.register(o)}};t(ws,"City")});var ty,io,Bl=n(()=>{fe();ty=class extends F{constructor(){super(Function)}accepts(e){return"build"in e}};t(ty,"AvailableCityBuildItemsRegistry");io=new ty});var mt,vb,Tm=n(()=>{I();A();mt=class extends g{process(e,i){let o=super.process(e,i);if(!(o instanceof pm))throw new TypeError("Invalid build rule.");return o}};t(mt,"Build");vb=mt});var ry,iy,uR=n(()=>{Z();ry=class extends ve{#e;constructor(e){super(),this.addKey("value"),this.#e=e}value(){return this.#e}};t(ry,"BuildCost");iy=ry});var Vp,bb,Is,IW,Pm=n(()=>{uR();I();v();A();Vp=class extends g{};t(Vp,"BuildCost");bb=Vp,Is=t((r,e)=>IW([[r,e]]),"buildCost"),IW=t(r=>r.map(([e,i])=>new Vp(new m(o=>o.item()===e),new p(()=>new iy(i)))),"buildCosts")});var oy,ny,cR=n(()=>{w();uR();Pm();Z();oy=class extends ve{#e;#t=new iy(1/0);#r;#i;constructor(e,i=null,o=d){super(),this.#r=e,this.#e=i,this.#i=o,this.addKey("cost","item")}cost(){if(!Number.isFinite(this.#t.value())){let[e]=this.#i.process(bb,this,this.#e);e&&(this.#t=e)}return this.#t}item(){return this.#r}};t(oy,"BuildItem");ny=oy});var Gl,Cb=n(()=>{De();Gl=class extends W{};t(Gl,"BuildProgress")});var Tb=n(()=>{Cb()});var ay,Pb,wb=n(()=>{A();ay=class extends g{};t(ay,"BuildingCancelled");Pb=ay});var sy,gi,wm=n(()=>{A();sy=class extends g{};t(sy,"BuildingComplete");gi=sy});var ly,As,Jp=n(()=>{Bl();Z();w();Tm();cR();Tb();wb();wm();ly=class extends k{#e;#t=null;#r;#i=new Gl(1/0);#o=new Gl;#n;constructor(e,i=io,o=d){super(),this.#e=i,this.#r=e,this.#n=o,this.addKey("available","building","city","cost","progress","remaining")}add(e){this.#o.add(e)}available(){let e=this.#n.get(vb);return this.#e.filter(i=>e.filter(o=>o.validate(this.city(),i)).every(o=>o.process(this.city(),i).validate())).map(i=>new ny(i,this.city(),this.#n))}build(e){let i=this.getAvailable(e);if(!i)throw new TypeError(`Cannot build ${e.name}, it's not available.`);this.#t=i,this.#i.set(this.#t.cost().value())}building(){return this.#t}check(){if(this.#o.value()>=this.#i.value()&&this.#t){let e=this.#t.item().build(this.#r,this.#n);return this.#o.set(0),this.#t=null,this.#i.set(1/0),this.#n.process(gi,this,e),e}return null}city(){return this.#r}cost(){return this.#i}getAvailable(e){return this.available().filter(i=>i.item()===e)[0]}progress(){return this.#o}remaining(){return this.#i.value()-this.#o.value()}revalidate(){this.#t&&!this.getAvailable(this.#t.item())&&(this.#t=null,this.#i.set(1/0),this.#n.process(Pb,this))}};t(ly,"CityBuild");As=ly});var my,kt,Ln=n(()=>{fe();Jp();my=class extends F{constructor(){super(As)}getByCity(e){let i=this.getBy("city",e);if(i.length!==1)throw new TypeError("Wrong number of entities returned.");return i[0]}};t(my,"CityBuildRegistry");kt=new my});var py,oo,$p=n(()=>{A();py=class extends g{};t(py,"Spend");oo=py});var uy,Ib,Ab=n(()=>{A();uy=class extends g{};t(uy,"Rush");Ib=uy});var cy,yy,yR=n(()=>{Ln();w();Z();$p();De();Ab();cy=class extends ve{#e;#t;#r;#i=0;#o;constructor(e,i,o=kt,a=d){super(),this.addKey("value","yield"),this.#e=o,this.#t=e,this.#r=a,this.#o=i}add(e){if(e instanceof W){this.add(e.value());return}this.#i+=e}buy(e){let i=this.#e.getByCity(e),[o]=this.cost(e).filter(s=>s.resource()===this.#o),a=o.value();e.player()!==this.#t||this.value()<a||(this.#r.process(Ib,i,o),i.add(new W(i.remaining())),this.subtract(a))}cost(e){let i=this.#e.getByCity(e);return this.#r.process(oo,i)}player(){return this.#t}set(e){this.#i=0,this.add(e)}subtract(e){if(e instanceof W){this.add(e.value());return}this.#i-=e}value(){return this.#i}yield(){return this.#o}};t(cy,"PlayerTreasury");yy=cy});var fy,hi,Ul=n(()=>{fe();yR();fy=class extends F{constructor(){super(yy)}getByPlayer(e){return this.getBy("player",e)}getByPlayerAndType(e,i){let o=this.filter(a=>a.player()===e&&a.yield()===i);if(o.length!==1)throw new TypeError(`Wrong number of playerTreasuries: ${o.length}`);return o[0]}};t(fy,"PlayerTreasuryRegistry");hi=new fy});var Ee,no,Bs=n(()=>{De();Ee=class extends W{};t(Ee,"Gold");no=Ee});var Gs,Bb=n(()=>{Ul();Kp();Bs();Gs=class extends dm{#e;constructor(e,i,o=hi){super(e,i),this.#e=o}perform(){this.#e.getByPlayerAndType(this.unit().player(),no).add(new no(50))}};t(Gs,"Gold")});var dy,gy,fR=n(()=>{A();dy=class extends g{};t(dy,"Unit");gy=dy});var Us,Gb=n(()=>{Kp();w();fR();Us=class extends fm{#e;#t;constructor(e,i,o=()=>Math.random(),a=d){super(e,i),this.#e=o,this.#t=a}perform(){this.#t.process(gy,this.goodyHut(),this.unit())}};t(Us,"Unit")});var dR=n(()=>{Ob();xb();Bb();Gb()});var Ms,Ub=n(()=>{Fn();Ms=class extends nr{};t(Ms,"ChangeProduction")});var Nn,Mb=n(()=>{Cl();Nn=class extends yi{};t(Nn,"CityBuild")});var gR=n(()=>{Ub();Mb()});var Ds,Db,hy=n(()=>{Ds=class{#e;constructor(e){this.#e=e}player(){return this.#e}takeTurn(){return new Promise((e,i)=>i(new TypeError("Client#takeTurn must be implemented.")))}};t(Ds,"Client");Db=Ds});var Oy,Es,Zp=n(()=>{De();Oy=class extends W{#e;constructor(e,i){super(i),this.#e=e}leader(){return this.#e}};t(Oy,"Trait");Es=Oy});var Ry,xy,hR=n(()=>{fe();Zp();Ry=class extends F{constructor(){super(Es)}getByLeader(e){return this.getBy("leader",e)}getBySubclass(e){return this.filter(i=>i instanceof e)}};t(Ry,"TraitRegistry");xy=new Ry});var vy,le,dt=n(()=>{hR();Z();vy=class extends k{#e=[];constructor(e=xy){super();let i=e.getByLeader(this.sourceClass());this.#e.push(...i),this.addKey("name")}static civilization(){throw new TypeError("Must be implemented in extending class")}name(){throw new TypeError("Must be implemented in extending class")}traits(){return[...this.#e]}};t(vy,"Leader");le=vy});var by,jn,Im=n(()=>{to();dt();by=class extends _e{constructor(){super(le)}getByCivilization(e){return this.getBy("civilization",e)}};t(by,"LeaderRegistry");jn=new by});var Ss,Eb=n(()=>{Fn();Ss=class extends nr{};t(Ss,"AdjustTradeRates")});var OR=n(()=>{Eb()});var Cy,Ae,Tr=n(()=>{A();Cy=class extends g{};t(Cy,"Busy");Ae=Cy});var Ml,Sb,RR=n(()=>{Cl();Ml=class extends yi{};t(Ml,"ChooseResearch");Sb=Ml});var Ty,Py,xR=n(()=>{A();Ty=class extends g{};t(Ty,"Cost");Py=Ty});var Hn,vR,wy=n(()=>{De();Hn=class extends W{};t(Hn,"FoodStorage");vR=Hn});var Iy,Xp,bR=n(()=>{A();Iy=class extends g{};t(Iy,"FoodStorage");Xp=Iy});var Ay,_n,By=n(()=>{A();Ay=class extends g{};t(Ay,"Grow");_n=Ay});var Gy,Am,CR=n(()=>{A();Gy=class extends g{};t(Gy,"Shrink");Am=Gy});var Uy,Dl,My=n(()=>{Z();w();xR();wy();bR();By();CR();Uy=class extends k{#e;#t=new vR(1/0);#r=new vR;#i;#o=1;constructor(e,i=d){super(),this.#e=e,this.#i=i,this.setCost(),this.addKey("cost","progress","size")}add(e){this.#r.add(e)}check(){this.#i.process(Xp,this)}city(){return this.#e}cost(){return this.#t}setCost(){let e=this.#i.process(Py,this);e.length>0&&this.#t.set(e[0],"setCost")}empty(){this.#r.subtract(this.#r.value())}grow(){this.#o++,this.#i.process(_n,this)}progress(){return this.#r}shrink(){this.#o--,this.#i.process(Am,this)}size(){return this.#o}};t(Uy,"CityGrowth");Dl=Uy});var Fs,Fb,Dy=n(()=>{Z();w();Fs=class extends k{static build(e,i=d){throw new TypeError("createFromObject: Must be overridden in extending class")}};t(Fs,"Buildable");Fb=Fs});var Ey,eu,TR=n(()=>{A();Ey=class extends g{};t(Ey,"Created");eu=Ey});var Sy,z,Se=n(()=>{Dy();w();TR();Sy=class extends Fs{#e;#t=!1;#r;constructor(e,i=d){super(),this.addKey("destroyed"),this.#e=e,this.#r=i,this.#r.process(eu,this,e)}static build(e,i=d){return new this(e,i)}city(){return this.#e}destroy(){this.#t=!0}destroyed(){return this.#t}};t(Sy,"CityImprovement");z=Sy});var Fy,be,mr=n(()=>{Z();Fy=class extends k{#e;#t;#r;constructor(e,i,o){super(),this.#e=e,this.#t=i,this.#r=o,this.addKey("name","value")}civilization(){return this.#e}name(){return this.#t}value(){return this.#r}};t(Fy,"Attribute");be=Fy});var Bm,Ce,pr=n(()=>{fe();mr();Bm=class extends F{constructor(){super(be)}getByCivilization(e){return this.getBy("civilization",e)}getByName(e){return this.getBy("name",e)}};t(Bm,"AttributeRegistry");Ce=new Bm});var ky,oe,Kt=n(()=>{ky=class{#e;#t;#r=!1;constructor(e,i,o=!1){this.#e=e,this.#t=i,this.#r=o}name(){return this.#e}civilization(){return this.#t}capital(){return this.#r}};t(ky,"CityName");oe=ky});var Yy,re,Pt=n(()=>{fe();Kt();Yy=class extends F{#e=1;#t;constructor(e=()=>Math.random()){super(oe),this.#t=e}takeByCivilization(e){let[i]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1);return i instanceof oe?(this.unregister(i),i.name()):this.takeUnassociated()}takeCapitalByCivilization(e){let[i]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1).filter(o=>o.capital());return i instanceof oe?(this.unregister(i),i.name()):this.takeByCivilization(e)}takeUnassociated(){let[e]=this.getBy("civilization",null).sort(()=>Math.floor(this.#t()*3)-1);return e instanceof oe?(this.unregister(e),e.name()):`City #${this.#e++}`}};t(Yy,"CityNameRegistry");re=new Yy});var Wy,de,qt=n(()=>{pr();Pt();Z();Wy=class extends k{#e=null;#t;#r=new Bm;constructor(e=Ce,i=re){super(),this.#t=i,this.#r.register(...e.getByCivilization(this.sourceClass())),this.addKey("name","leader","attributes")}attributes(){return this.#r.entries()}name(){return this.constructor.name}leader(){return this.#e}setLeader(e){this.#e=e}getCityName(e=!1){let i=this.sourceClass();return e?this.#t.takeCapitalByCivilization(i):this.#t.takeByCivilization(i)}};t(Wy,"Civilization");de=Wy});var ks,kb=n(()=>{Fn();ks=class extends mm{};t(ks,"CompleteProduction")});var PR=n(()=>{kb()});var El,Ly,Ny=n(()=>{Cl();El=class extends yi{};t(El,"EndTurn");Ly=El});var jy,Hy,wR=n(()=>{jy=class{#e={};on(e,i){e in this.#e||(this.#e[e]=[]),this.#e[e].push(i)}once(e,i){let o=t((...a)=>{i(...a),this.off(e,o)},"onceHandler");this.on(e,o)}off(e,i){if(!(e in this.#e))return;let o=this.#e[e].indexOf(i);o!==-1&&this.#e[e].splice(o,1)}emit(e,...i){e in this.#e&&this.#e[e].forEach(o=>o(...i))}};t(jy,"EventEmitter");Hy=jy});var Sl,Wb,IR=n(()=>{Fn();Sl=class extends nr{};t(Sl,"LaunchSpaceship");Wb=Sl});var _y,Xe,en=n(()=>{A();_y=class extends g{};t(_y,"Action");Xe=_y});var Ky,Oi,Fl=n(()=>{A();Ky=class extends g{};t(Ky,"Added");Oi=Ky});var qy,AR,zb=n(()=>{Fn();qy=class extends nr{};t(qy,"HiddenPlayerAction");AR=qy});var Vy,K,ao=n(()=>{Z();w();en();Fl();zb();Cl();Vy=class extends k{#e=null;#t;constructor(e=d){super(),this.#t=e,this.#t.process(Oi,this),this.addKey("actions","civilization","mandatoryActions")}action(){let[e]=this.actions();return e}actions(){return this.#t.process(Xe,this).flat().filter(e=>!(e instanceof AR))}civilization(){if(this.#e===null)throw new TypeError("Player#civilization is unset.");return this.#e}hasActions(){return!!this.action()}hasMandatoryActions(){return this.actions().some(e=>e instanceof yi)}hiddenActions(){return this.#t.process(Xe,this).flat().filter(e=>e instanceof AR)}mandatoryAction(){let[e]=this.mandatoryActions();return e}mandatoryActions(){return this.actions().filter(e=>e instanceof yi)}setCivilization(e){this.#e=e}};t(Vy,"Player");K=Vy});var Jy,Gm,BR=n(()=>{Tt();Z();di();Jy=class extends k{#e={};#t;#r;#i;constructor(e,i,o=te){super(),this.#t=o,this.#r=i,this.#i=e,this.addKey("isCoast","isLand","isWater","terrain","x","y","yields"),this.setAdditionalData()}addKey(...e){super.addKey(...e)}isCoast(){return this.#i.isCoast()}isLand(){return this.#i.isLand()}isWater(){return this.#i.isWater()}player(){return this.#r}setAdditionalData(){this.#t.getByType(ue).forEach(e=>{this.#e[e.key()]=e.data(this.#i),Object.defineProperty(this,e.key(),{configurable:!0,value:()=>e.data(this.#i)}),this.addKey(e.key())})}terrain(){return this.#i.terrain()}tile(){return this.#i}update(){this.#i.clearYieldCache(this.#r),this.setAdditionalData()}x(){return this.#i.x()}y(){return this.#i.y()}yields(){return this.#i.yields(this.#r)}};t(Jy,"PlayerTile");Gm=Jy});var $y,Lb,Nb=n(()=>{hm();$y=class extends Wn{};t($y,"Unknown");Lb=$y});var Zy,jb,Hb=n(()=>{di();Nb();Zy=class extends ue{constructor(e,i,o){super(e,i,new Lb,o)}};t(Zy,"UndiscoveredTile");jb=Zy});var Qy,Xy,GR=n(()=>{A();Qy=class extends g{};t(Qy,"VisibilityChanged");Xy=Qy});var ef,Um,tf=n(()=>{Z();w();BR();di();Hb();GR();ef=class extends k{#e;#t;#r=[];#i;constructor(e,i,o=d){super(),this.#e=e,this.#i=i,this.#t=o,this.addKey("height","tiles","width")}entries(){return this.#r}filter(e){return this.entries().filter(e)}forEach(e){return this.#r.forEach(e)}get(e,i){let[o]=this.entries().filter(a=>a.x()===e&&a.y()===i);return o||new jb(e,i,this.#i)}getByTile(e){let[i]=this.filter(o=>o.tile()===e);return i??null}height(){return this.#i.height()}includes(e){return e instanceof ue?!!this.getByTile(e):this.#r.includes(e)}map(e){return this.#r.map(e)}player(){return this.#e}register(...e){e.forEach(i=>{this.includes(i)||(this.#r.push(new Gm(i,this.#e)),this.#t.process(Xy,i,this.player()))})}tiles(){return this.entries()}width(){return this.#i.width()}};t(ef,"PlayerWorld");Um=ef});var Ws,qb=n(()=>{Fn();Ws=class extends nr{};t(Ws,"Revolution")});var UR=n(()=>{qb()});var so,Vb=n(()=>{De();so=class extends W{};t(so,"Attack")});var Ri,Jb=n(()=>{De();Ri=class extends W{};t(Ri,"Defence")});var lo,$b,MR=n(()=>{De();lo=class extends W{};t(lo,"Movement");$b=lo});var Em,Zb=n(()=>{MR();Em=class extends $b{};t(Em,"Moves")});var zs,Qb=n(()=>{De();zs=class extends W{};t(zs,"Visibility")});var Sm=n(()=>{Vb();Jb();MR();Zb();Qb()});var wt,DR,xi,Kn,Fm,ER=n(()=>{I();v();A();wt=class extends g{};t(wt,"Action");DR=wt,xi=new m(r=>r.moves().value()>=.1),Kn=new m((r,e,i=r.tile())=>i===e),Fm=new m((r,e,i=r.tile())=>e.isNeighbourOf(i))});var sf,km,SR=n(()=>{A();sf=class extends g{};t(sf,"Activate");km=sf});var lf,Oa,mf=n(()=>{A();lf=class extends g{};t(lf,"Created");Oa=lf});var pf,tn,au=n(()=>{A();pf=class extends g{};t(pf,"Destroyed");tn=pf});var uf,cf,FR=n(()=>{A();uf=class extends g{};t(uf,"Visibility");cf=uf});var Ls,kl,su,Xb,Ym=n(()=>{Sm();I();v();A();Ls=class extends g{};t(Ls,"BaseYield");kl=class extends g{};t(kl,"Yield");su=kl,Xb=t((r,e=1,i=1,o=1,a=1)=>[...[[so,e],[Ri,i],[lo,o],[zs,a]].flatMap(([s,l])=>[new kl(new m(u=>u instanceof r),new m((u,c)=>c instanceof s),new p((u,c)=>c.set(l))),new Ls(new m(u=>u===r),new m((u,c)=>c instanceof s),new p((u,c)=>c.set(l)))])],"unitYield")});var yf,Ge,Ra=n(()=>{Sm();Dy();w();ER();SR();mf();au();FR();Ym();yf=class extends Fs{#e=!0;#t=null;#r;#i=!1;#o=new Em;#n;#a;#s=null;#l;#m=!1;constructor(e,i,o,a=d){super(),this.#r=e,this.#n=i,this.#l=o,this.#a=a,this.addKey("actions","actionsForNeighbours","active","attack","busy","city","defence","destroyed","movement","moves","player","status","tile","visibility","waiting"),this.#a.process(Oa,this)}static build(e,i=d){return new this(e,e.player(),e.tile(),i)}action(e,...i){return e.perform(...i)}actions(e=this.#l,i=this.#l){return typeof e=="string"&&(e=i.getNeighbour(e)),this.#a.process(DR,this,e,i)}actionsForNeighbours(e=this.#l){return e.getNeighbouringDirections().reduce((i,o)=>({...i,[o]:this.#a.process(DR,this,e.getNeighbour(o),e)}),{})}activate(){this.#a.process(km,this)}active(){return this.#e}setActive(e=!0){this.#e=e}applyVisibility(){this.#l.getSurroundingArea(this.visibility().value()).forEach(e=>{this.#a.process(cf,e,this.#n)})}attack(){let[e]=this.yield(new so);return e}busy(){return this.#t}setBusy(e=null){this.#t=e}city(){return this.#r}defence(){let[e]=this.yield(new Ri);return e}destroy(e=null){this.#a.process(tn,this,e)}destroyed(){return this.#i}setDestroyed(){this.#i=!0}movement(){let[e]=this.yield(new lo);return e}moves(){return this.#o}player(){return this.#n}status(){return this.#s}setStatus(e){this.#s=e}tile(){return this.#l}setTile(e){this.#l=e}visibility(){let[e]=this.yield(new zs);return e}waiting(){return this.#m}setWaiting(e=!0){this.#m=e}yield(...e){let i=this.#a.get(su);return e.forEach(o=>i.filter(a=>a.validate(this,o)).forEach(a=>a.process(this,o))),e}};t(yf,"Unit");Ge=yf});var ff,X,It=n(()=>{fe();My();ff=class extends F{constructor(){super(Dl)}getByCity(e){let i=this.getBy("city",e);if(i.length!==1)throw new TypeError("Wrong number of CityGrowths returned.");return i[0]}};t(ff,"CityGrowthRegistry");X=new ff});var Te,Oe,Be=n(()=>{Se();Te=class extends z{};t(Te,"Wonder");Oe=Te});var Wm,vi,Ns=n(()=>{fe();ao();Wm=class extends F{constructor(){super(K)}};t(Wm,"PlayerRegistry");vi=new Wm});var Of,rn,zm=n(()=>{Ns();Of=class extends Wm{};t(Of,"CurrentPlayerRegistry");rn=new Of});var Rf,b,V=n(()=>{wR();Rf=class extends Hy{#e={};#t=!1;debug(e){if(!!this.option("debug"))return e()}emit(e,...i){return this.debug(()=>console.log(`Engine#emit: ${String(e)}: ${i}`)),super.emit(e,...i)}loadPlugins(){return this.emit("plugins:load:start"),new Promise((e,i)=>{this.once("plugins:load:end",()=>e())})}option(e,i=null){return this.#e[e]||i}setOption(e,i){this.#e[e]!==i&&(this.#e[e]=i,this.emit("option:changed",e,i))}start(){this.#t||(this.#t=!0,this.emit("engine:initialise"),this.loadPlugins().then(()=>{this.emit("engine:start")}))}};t(Rf,"Engine");b=new Rf});var xf,ee,Kr=n(()=>{fe();tf();xf=class extends F{constructor(){super(Um)}getByPlayer(e){let i=this.getBy("player",e);if(i.length!==1)throw new TypeError(`Wrong number of player worlds exist for player: ${e.id()}`);return i[0]}};t(xf,"PlayerWorldRegistry");ee=new xf});var vf,ie,Yt=n(()=>{Z();vf=class extends k{#e=0;constructor(){super(),this.addKey("value")}increment(){return this.#e++,this.#e}value(){return this.#e}};t(vf,"Turn");ie=new vf});var bf,j,Ve=n(()=>{fe();Ra();bf=class extends F{constructor(){super(Ge)}getByCity(e){return this.filter(i=>i.city()===e&&!i.destroyed())}getByPlayer(e,i=!1){return i?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){return this.filter(i=>i.tile()===e&&!i.destroyed())}};t(bf,"UnitRegistry");j=new bf});var Cf,js,zR=n(()=>{A();Cf=class extends g{};t(Cf,"Year");js=Cf});var Tf,Lm,LR=n(()=>{Z();w();Yt();zR();Tf=class extends k{#e=new Map;#t;#r;constructor(e=ie,i=d){super(),this.#t=i,this.#r=e,this.addKey("value")}value(e=this.#r.value()){if(!this.#e.has(e)){let[o]=this.#t.process(js,e);this.#e.set(e,o)}let i=this.#e.get(e);if(typeof i!="number")throw new TypeError("Invalid cache result.");return i}};t(Tf,"Year");Lm=new Tf});var Q,on,Yl=n(()=>{De();Q=class extends W{};t(Q,"Food");on=Q});var J,xa,Nm=n(()=>{De();J=class extends W{};t(J,"Production");xa=J});var me,va,ba=n(()=>{De();me=class extends W{};t(me,"Trade");va=me});var Ca=n(()=>{Yl();Nm();ba()});var Wl,Le,mo=n(()=>{Wl=t((r,...e)=>r.reduce((i,o)=>{let a=e.findIndex(s=>o instanceof s);return a===-1||(i[a]+=o.value()),i},e.map(()=>0)),"reduceYields"),Le=t((r,e)=>Wl(r,e).shift()??0,"reduceYield")});var AW,iC,oC,Pf,nC,aC,wf,jm,Hs=n(()=>{It();Ca();Kr();ro();mo();Nc();AW=t(r=>iC(r.tiles().entries(),r),"getHighestValueCityTiles"),iC=t((r,e,i=[[Q,8],[J,3*(Le(e.tilesWorked().yields(e.player()),J)===0?3:1)],[me,1*(Le(e.tilesWorked().yields(e.player()),me)===0?2:1)]])=>r.sort((o,a)=>a.score(e.player(),i)-o.score(e.player(),i)),"sortTiles"),oC=t((r,e=ee,i=ze)=>AW(r).filter(o=>i.tileCanBeWorkedBy(o,r)&&e.getByPlayer(r.player()).includes(o)),"getHighestValueAvailableCityTiles"),Pf=t((r,e=ee,i=X,o=ze)=>{o.getBy("city",r).forEach(a=>o.unregister(a)),o.register(new Ps(r.tile(),r)),nC(r,e,i,o)},"reassignWorkers"),nC=t((r,e=ee,i=X,o=ze)=>{let a=i.getByCity(r);oC(r,e,o).some(s=>r.tilesWorked().length>=a.size()+1?!0:(o.register(new Ps(s,r)),!1))},"assignWorkers"),aC=t((r,e=ee,i=X,o=ze)=>{let[a]=oC(r,e,o);o.register(new Ps(a,r))},"assignWorker"),wf=t((r,e)=>iC(r.tilesWorked().entries().filter(i=>i!==r.tile()),r).slice(e.size()),"reduceWorkers"),jm=nC});var NR,If,qr,_s=n(()=>{De();NR=t(r=>r instanceof W?-r.value():-r,"negate"),If=class extends W{add(e,i=""){super.add(NR(e),i)}set(e,i=""){super.set(NR(e),i)}subtract(e,i=""){super.subtract(NR(e),i)}};t(If,"NegativeYield");qr=t(r=>{["add","set","subtract"].forEach(e=>Object.defineProperty(r.prototype,e,Object.getOwnPropertyDescriptor(If.prototype,e)||Object.create(null)))},"makeNegative")});var nn,Af=n(()=>{ba();_s();nn=class extends va{};t(nn,"Corruption");qr(nn)});var Ks,Bf,gu=n(()=>{De();Ks=class extends W{};t(Ks,"Happiness");Bf=Ks});var bi,sC,hu=n(()=>{De();bi=class extends W{};t(bi,"Luxuries");sC=bi});var Hm,lC,jR=n(()=>{Yl();_s();Hm=class extends on{};t(Hm,"PopulationSupportFood");qr(Hm);lC=Hm});var Vt,Gf=n(()=>{De();Vt=class extends W{};t(Vt,"Research")});var rt,qn,qs=n(()=>{De();rt=class extends W{};t(rt,"Unhappiness");qn=rt});var Vs,mC,HR=n(()=>{Yl();_s();Vs=class extends on{#e;constructor(e=0,i=null){super(e,i?i.id():"none"),this.#e=i,this.addKey("unit")}unit(){return this.#e}};t(Vs,"UnitSupportFood");qr(Vs);mC=Vs});var Js,_R,KR=n(()=>{Nm();_s();Js=class extends xa{#e;constructor(e=0,i=null){super(e,i?i.id():"none"),this.#e=i,this.addKey("unit")}unit(){return this.#e}};t(Js,"UnitSupportProduction");qr(Js);_R=Js});var Ta=n(()=>{Ca();Af();wy();Bs();gu();hu();jR();Gf();ba();qs();HR();KR()});var Jn,Zs,Qs=n(()=>{w();Z();Jn=class extends k{#e;#t;#r;#i;constructor(e,i,o,a=d){super(),this.#e=e,this.#t=a,this.#r=i,this.#i=o,this.addKey("from","to")}forUnit(e){return new this.constructor(this.#e,this.#r,e,this.#t)}from(){return this.#e}perform(...e){}ruleRegistry(){return this.#t}to(){return this.#r}unit(){return this.#i}};t(Jn,"Action");Zs=Jn});var Mf,an,Ru=n(()=>{A();Mf=class extends g{};t(Mf,"Defeated");an=Mf});var Xs,yC=n(()=>{w();Ve();Qs();Ru();Xs=class extends Zs{#e;#t;constructor(e,i,o,a=d,s=j,l=()=>Math.random()){super(e,i,o,a),this.#t=s,this.#e=l}perform(){let[e]=this.#t.getByTile(this.to()).sort((o,a)=>a.defence().value()-o.defence().value()),i=Math.min(1,this.unit().moves().value());if(this.unit().attack().value()*i*this.#e()>=e.defence().value()*this.#e()){this.ruleRegistry().process(an,e,this.unit(),this),this.unit().moves().subtract(i,this.constructor.name);return}this.ruleRegistry().process(an,this.unit(),e,this)}};t(Xs,"Attack")});var Df,fC,dC=n(()=>{Tr();Df=class extends Ae{};t(Df,"BuildingIrrigation");fC=Df});var Ef,q,At=n(()=>{A();Ef=class extends g{};t(Ef,"Moved");q=Ef});var Sf,it,po=n(()=>{Qs();w();Yt();Tr();I();v();At();Sf=class extends Jn{#e;constructor(e,i,o,a=d,s=ie){super(e,i,o,a),this.#e=s}perform(e,i=()=>{},o=Ae){let a=this.#e.value()+e;this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new o(new m(()=>this.#e.value()===a),new p((...s)=>{let l=this.unit();l.setActive(),l.setBusy(),i(...s),this.ruleRegistry().process(q,this.unit(),this)})))}};t(Sf,"DelayedAction");it=Sf});var Ff,Pa,kf=n(()=>{A();Ff=class extends g{};t(Ff,"Built");Pa=Ff});var Yf,sn,Ll=n(()=>{Z();w();kf();Yf=class extends k{#e;constructor(e,i=d){super(),this.#e=e,i.process(Pa,e,this)}tile(){return this.#e}};t(Yf,"TileImprovement");sn=Yf});var Ue,gC,$R=n(()=>{Ll();Ue=class extends sn{};t(Ue,"Irrigation");gC=Ue});var Wf,we,Ci=n(()=>{A();Wf=class extends g{};t(Wf,"MovementCost");we=Wf});var el,hC=n(()=>{dC();po();$R();At();Ci();el=class extends it{perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e||0,()=>{new gC(this.unit().tile())},fC),this.ruleRegistry().process(q,this.unit(),this)}};t(el,"BuildIrrigation")});var zf,OC,RC=n(()=>{Tr();zf=class extends Ae{};t(zf,"BuildingMine");OC=zf});var ot,xC,ZR=n(()=>{Ll();ot=class extends sn{};t(ot,"Mine");xC=ot});var tl,vC=n(()=>{RC();po();ZR();At();Ci();tl=class extends it{perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e||0,()=>{new xC(this.unit().tile())},OC),this.ruleRegistry().process(q,this.unit(),this)}};t(tl,"BuildMine")});var Lf,bC,CC=n(()=>{Tr();Lf=class extends Ae{};t(Lf,"BuildingRoad");bC=Lf});var je,TC,QR=n(()=>{Ll();je=class extends sn{};t(je,"Road");TC=je});var rl,PC=n(()=>{CC();po();At();Ci();QR();rl=class extends it{perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e||0,()=>{new TC(this.unit().tile())},bC),this.ruleRegistry().process(q,this.unit(),this)}};t(rl,"BuildRoad")});var Nf,wC,IC=n(()=>{Tr();Nf=class extends Ae{};t(Nf,"BuildingRailroad");wC=Nf});var ur,AC,XR=n(()=>{Ll();ur=class extends sn{};t(ur,"Railroad");AC=ur});var il,BC=n(()=>{IC();po();At();Ci();XR();il=class extends it{perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e||0,()=>{new AC(this.unit().tile())},wC),this.ruleRegistry().process(q,this.unit(),this)}};t(il,"BuildRailroad")});var jf,xu,ex=n(()=>{A();jf=class extends g{};t(jf,"ValidateMove");xu=jf});var Jt,_m,vu=n(()=>{Qs();At();Ci();ex();Jt=class extends Jn{perform(){return this.validate()?(this.unit().setTile(this.to()),this.ruleRegistry().process(q,this.unit(),this),!0):!1}movementCost(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>i-o);return e}validate(){let[e]=this.ruleRegistry().process(xu,this.unit(),this.movementCost());return e}};t(Jt,"Move");_m=Jt});var Km,GC=n(()=>{w();vu();Km=class extends _m{#e;constructor(e,i,o,a,s=d){super(e,i,o,s),this.#e=a}perform(){return super.perform()?(this.#e.capture(this.unit().player()),!0):!1}};t(Km,"CaptureCity")});var Hf,Je,Ti=n(()=>{Z();Hf=class extends ve{#e;constructor(e){super(),this.#e=e}clone(e=this.terrain()){return new this.constructor(e)}terrain(){return this.#e}};t(Hf,"TerrainFeature");Je=Hf});var tx,_f,gt,ln=n(()=>{fe();Ti();tx=new Map,_f=class extends F{constructor(){super(Je)}getByTerrain(e){return tx.has(e)||tx.set(e,this.getBy("terrain",e)),tx.get(e)}};t(_f,"TerrainFeatureRegistry");gt=new _f});var Kf,UC,MC=n(()=>{Tr();Kf=class extends Ae{};t(Kf,"ClearingForest");UC=Kf});var pe,qm,bu=n(()=>{sr();pe=class extends _{};t(pe,"Plains");qm=pe});var ol,DC=n(()=>{w();ln();Yt();MC();po();At();Ci();bu();ol=class extends it{#e;constructor(e,i,o,a=d,s=gt,l=ie){super(e,i,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e,()=>{let i=new qm,o=this.#e.getByTerrain(this.from().terrain());this.#e.register(...o.map(a=>a.clone(i))),this.#e.unregister(...o),this.from().setTerrain(i)},UC),this.ruleRegistry().process(q,this.unit(),this)}};t(ol,"ClearForest")});var qf,EC,SC=n(()=>{Tr();qf=class extends Ae{};t(qf,"ClearingJungle");EC=qf});var Cu,nl,FC,Vm=n(()=>{ln();I();v();A();Cu=class extends g{};t(Cu,"Feature");nl=Cu,FC=t((r,e,i=.2,o=gt,a=()=>Math.random())=>[new Cu(new m(s=>s===e),new m((s,l)=>l instanceof r),new m(()=>a()<=i),new p((s,l)=>o.register(new s(l))))],"feature")});var Re,al,Jm=n(()=>{sr();Re=class extends _{};t(Re,"Grassland");al=Re});var mn,Vf,Jf=n(()=>{Ti();mn=class extends Je{};t(mn,"Shield");Vf=mn});var sl,kC=n(()=>{w();ln();Yt();SC();po();Vm();Jm();At();Ci();Jf();sl=class extends it{#e;constructor(e,i,o,a=d,s=gt,l=ie){super(e,i,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e,()=>{let i=new al,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(nl,Vf,i),this.#e.unregister(...o),this.from().setTerrain(i)},EC),this.ruleRegistry().process(q,this.unit(),this)}};t(sl,"ClearJungle")});var $f,YC,WC=n(()=>{Tr();$f=class extends Ae{};t($f,"ClearingSwamp");YC=$f});var ll,zC=n(()=>{w();ln();Yt();WC();po();Vm();Jm();At();Ci();Jf();ll=class extends it{#e;constructor(e,i,o,a=d,s=gt,l=ie){super(e,i,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e,()=>{let i=new al,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(nl,Vf,i),this.#e.unregister(...o),this.from().setTerrain(i)},YC),this.ruleRegistry().process(q,this.unit(),this)}};t(ll,"ClearSwamp")});var $m,LC=n(()=>{Qs();$m=class extends Zs{perform(){this.unit().destroy()}};t($m,"Disband")});var ml,NC=n(()=>{w();vu();ml=class extends _m{#e;constructor(e,i,o,a,s=d){super(e,i,o,s),this.#e=a}perform(){return super.perform()?(this.unit().moves().set(0),this.#e.unload(this.unit()),!0):!1}};t(ml,"Disembark")});var Zm,jC=n(()=>{w();Tr();I();vu();At();Zm=class extends _m{#e;constructor(e,i,o,a,s=d){super(e,i,o,s),this.#e=a}perform(){return super.perform()?(this.#e.stow(this.unit()),this.unit().setBusy(new Ae(new m(()=>!1))),this.unit().setActive(!1),this.ruleRegistry().process(q,this.unit(),this),!0):!1}};t(Zm,"Embark")});var Zf,Qm,Qf=n(()=>{Z();Zf=class extends ve{#e;constructor(e){super(),this.#e=e}unit(){return this.#e}};t(Zf,"UnitImprovement");Qm=Zf});var Xf,cr,wa=n(()=>{fe();Qf();Xf=class extends F{constructor(){super(Qm)}getByUnit(e){return this.getBy("unit",e)}};t(Xf,"UnitImprovementRegistry");cr=new Xf});var ed,HC,_C=n(()=>{Tr();ed=class extends Ae{};t(ed,"Fortified");HC=ed});var Pi,KC,rx=n(()=>{Qf();Pi=class extends Qm{};t(Pi,"Fortified");KC=Pi});var td,qC,VC=n(()=>{Tr();td=class extends Ae{};t(td,"Fortifying");qC=td});var pl,JC=n(()=>{w();Yt();wa();_C();I();po();rx();VC();At();Ci();pl=class extends it{#e;constructor(e,i,o,a=d,s=ie,l=cr){super(e,i,o,a,s),this.#e=l}perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e,()=>{this.unit().moves().set(0),this.unit().setActive(!1),this.unit().setBusy(new HC(new m(()=>!1))),this.#e.register(new KC(this.unit()))},qC),this.ruleRegistry().process(q,this.unit(),this)}};t(pl,"Fortify")});var Xm,$C=n(()=>{Pt();w();Qs();zn();At();Xm=class extends Zs{#e;constructor(e,i,o,a=re,s=d){super(e,i,o,s),this.#e=a}perform(){new Ke(this.unit().player(),this.unit().tile(),this.#e.takeCapitalByCivilization(this.unit().player().civilization().constructor),this.ruleRegistry()),this.unit().destroy(),this.ruleRegistry().process(q,this.unit(),this)}};t(Xm,"FoundCity")});var uo,ZC=n(()=>{Qs();uo=class extends Jn{perform(){this.unit().moves().subtract(this.unit().moves())}};t(uo,"NoOrders")});var rd,Fe,Vr=n(()=>{fe();Ll();rd=class extends F{constructor(){super(sn)}getByTile(e){return this.getBy("tile",e)}};t(rd,"TileImprovementRegistry");Fe=new rd});var ul,QC=n(()=>{w();Vr();Yt();po();At();Ci();ul=class extends it{#e;constructor(e,i,o,a=d,s=Fe,l=ie){super(e,i,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e,()=>{let[i]=this.#e.getByTile(this.from());this.#e.unregister(i)}),this.ruleRegistry().process(q,this.unit(),this)}};t(ul,"Pillage")});var et,id,od=n(()=>{sr();et=class extends _{};t(et,"Forest");id=et});var co,XC,ix=n(()=>{Ti();co=class extends Je{};t(co,"Horse");XC=co});var nd,eT,tT=n(()=>{Tr();nd=class extends Ae{};t(nd,"PlantingForest");eT=nd});var cl,rT=n(()=>{w();ln();Yt();po();Vm();od();ix();At();Ci();tT();cl=class extends it{#e;constructor(e,i,o,a=d,s=gt,l=ie){super(e,i,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(we,this.unit(),this).sort((i,o)=>o-i);super.perform(e,()=>{let i=new id,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(nl,XC,i),this.#e.unregister(...o),this.from().setTerrain(i)},eT),this.ruleRegistry().process(q,this.unit(),this)}};t(cl,"PlantForest")});var ad,iT,oT=n(()=>{Tr();ad=class extends Ae{};t(ad,"Sleeping");iT=ad});var Ia,nT,ox=n(()=>{w();Yt();Ve();I();po();v();oT();Ia=class extends it{#e;constructor(e,i,o,a=d,s=ie,l=j){super(e,i,o,a,s),this.#e=l}perform(){this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new iT(new m(()=>this.from().getSurroundingArea(this.unit().visibility().value()).some(e=>this.#e.getByTile(e).some(i=>i.player()!==this.unit().player()))),new p(()=>{this.unit().setActive(),this.unit().setBusy()})))}};t(Ia,"Sleep");nT=Ia});var ep,aT=n(()=>{Qs();ep=class extends Zs{perform(){this.unit().setWaiting(),this.unit().cargo().forEach(e=>{e.moves().set(e.movement()),e.activate()})}};t(ep,"Unload")});var tp=n(()=>{yC();hC();vC();PC();BC();GC();DC();kC();zC();LC();NC();jC();JC();$C();vu();ZC();QC();rT();ox();aT()});var Wt,sT,nx=n(()=>{sr();Wt=class extends _{};t(Wt,"Arctic");sT=Wt});var Ie,lT,ax=n(()=>{sr();Ie=class extends _{};t(Ie,"Desert");lT=Ie});var Me,mT,sx=n(()=>{sr();Me=class extends _{};t(Me,"Hills");mT=Me});var nt,pT,lx=n(()=>{sr();nt=class extends _{};t(nt,"Jungle");pT=nt});var He,uT,mx=n(()=>{sr();He=class extends _{};t(He,"Mountains");uT=He});var pt,cT,px=n(()=>{sR();pt=class extends ar{};t(pt,"Ocean");cT=pt});var ae,sd,ld=n(()=>{sr();ae=class extends _{};t(ae,"River");sd=ae});var at,yT,ux=n(()=>{sr();at=class extends _{};t(at,"Swamp");yT=at});var ht,fT,cx=n(()=>{sr();ht=class extends _{};t(ht,"Tundra");fT=ht});var yo=n(()=>{nx();ax();od();Jm();sx();lx();mx();px();bu();ld();ux();cx()});var zt,yl,rp=n(()=>{Ra();zt=class extends Ge{};t(zt,"Air");yl=zt});var st,md,pd=n(()=>{Ra();st=class extends Ge{};t(st,"Land");md=st});var H,$t=n(()=>{pd();H=class extends md{};t(H,"Fortifiable")});var $e,$n,Nl=n(()=>{Ra();$e=class extends Ge{};t($e,"Naval");$n=$e});var ud,cd,yx=n(()=>{ud=class{#e;#t;constructor(e,i){this.#e=e,this.#t=i}transport(){return this.#e}unit(){return this.#t}};t(ud,"TransportManifest");cd=ud});var yd,Zn,ip=n(()=>{fe();yx();yd=class extends F{constructor(){super(cd)}getByTransport(e){return this.getBy("transport",e)}getByUnit(e){let i=this.getBy("unit",e);if(i.length!==1)throw new TypeError("Wrong number of results.");return i[0]}};t(yd,"TransportRegistry");Zn=new yd});var fd,dd,fx=n(()=>{A();fd=class extends g{};t(fd,"Stowed");dd=fd});var gd,dT,gT=n(()=>{A();gd=class extends g{};t(gd,"Unloaded");dT=gd});var BW,hT,OT=n(()=>{w();ip();fx();yx();gT();BW=t(r=>t(class extends r{#e=d;#t=Zn;canStow(i){return!this.cargo().includes(i)&&this.hasCapacity()}capacity(){return 0}cargo(){return this.#t.getByTransport(this).map(i=>i.unit())}hasCapacity(){return this.#t.getByTransport(this).length<this.capacity()}hasCargo(){return this.#t.getByTransport(this).length>0}setRuleRegistry(i){this.#e=i}setTransportRegistry(i){this.#t=i}stow(i){return!this.hasCapacity()||!this.canStow(i)?!1:(this.#t.register(new cd(this,i)),this.#e.process(dd,i,this),!0)}unload(i){try{let o=this.#t.getByUnit(i);return this.#t.unregister(o),this.#e.process(dT,i,this),!0}catch{return!1}}},"Transport"),"Transport"),hT=BW});var Zt,Qn,jl=n(()=>{w();ip();Nl();OT();Zt=class extends hT($n){constructor(e,i,o,a=d,s=Zn){super(e,i,o,a),this.setRuleRegistry(a),this.setTransportRegistry(s)}};t(Zt,"NavalTransport");Qn=Zt});var Pr,dx=n(()=>{pd();Pr=class extends md{};t(Pr,"Worker")});var Xn=n(()=>{rp();$t();pd();Nl();jl();dx()});var pn,RT=n(()=>{Ti();pn=class extends Je{};t(pn,"Coal")});var un,xT=n(()=>{Ti();un=class extends Je{};t(un,"Fish")});var wi,vT=n(()=>{Ti();wi=class extends Je{};t(wi,"Game")});var cn,bT=n(()=>{Ti();cn=class extends Je{};t(cn,"Gems")});var yn,CT=n(()=>{Ti();yn=class extends Je{};t(yn,"Gold")});var Ii,TT=n(()=>{Ti();Ii=class extends Je{};t(Ii,"Oasis")});var fn,PT=n(()=>{Ti();fn=class extends Je{};t(fn,"Oil")});var dn,wT=n(()=>{Ti();dn=class extends Je{};t(dn,"Seal")});var Tu=n(()=>{RT();xT();vT();bT();CT();ix();TT();PT();wT();Jf()});var hd,Hl,gx=n(()=>{A();hd=class extends g{};t(hd,"Action");Hl=hd});var Od,Rd,hx=n(()=>{A();Od=class extends g{};t(Od,"ActionPerformed");Rd=Od});var xd,op,Ox=n(()=>{A();xd=class extends g{};t(xd,"Discovered");op=xd});var vd,bd,Rx=n(()=>{Z();w();gx();hx();Ox();vd=class extends k{#e;#t;constructor(e,i=d){super(),this.#e=i,this.#t=e,this.addKey("tile")}action(e){e.perform(),this.#e.process(Rd,this,e)}actions(e){return this.#e.process(Hl,this,e)}process(e){this.#e.process(op,this,e)}tile(){return this.#t}};t(vd,"GoodyHut");bd=vd});var Cd,Jr,fl=n(()=>{Rx();fe();Cd=class extends F{constructor(){super(bd)}getByTile(e){let i=this.filter(o=>o.tile()===e);return i.length===0?null:i[0]}};t(Cd,"GoodyHutRegistry");Jr=new Cd});var IT=n(()=>{Ll()});var ea=n(()=>{$R();ZR();IT();QR();XR()});var Td,AT,BT=n(()=>{Td=class{#e;#t;#r;constructor(e,i,o){this.#e=o,this.#t=i,this.#r=e}end(){return this.#e}generate(){throw new Error(`PathFinder#generate: Must be overridden in '${this.constructor.name}'.`)}start(){return this.#t}unit(){return this.#r}};t(Td,"PathFinder");AT=Td});var Pd,wd,xx=n(()=>{to();BT();Pd=class extends _e{constructor(){super(AT)}};t(Pd,"PathFinderRegistry");wd=new Pd});var Id,$r,dl=n(()=>{Z();Id=class extends ve{};t(Id,"Government");$r=Id});var Ad,np,Bd=n(()=>{to();dl();Ad=class extends _e{constructor(){super($r)}};t(Ad,"AvailableGovernmentRegistry");np=new Ad});var Gd,Pu,vx=n(()=>{A();Gd=class extends g{};t(Gd,"Availability");Pu=Gd});var Ud,wu,bx=n(()=>{A();Ud=class extends g{};t(Ud,"Changed");wu=Ud});var Md,Dd,Cx=n(()=>{Bd();Z();w();vx();bx();Md=class extends k{#e;#t=null;#r;#i;constructor(e,i=np,o=d){super(),this.#r=e,this.#e=i,this.#i=o,this.addKey("available","current")}available(){return this.#e.filter(e=>this.#i.get(Pu).some(i=>i.validate(e,this.#r)))}current(){return this.#t}is(...e){return e.some(i=>this.#t instanceof i)}player(){return this.#r}set(e){this.#t=e,this.#i.process(wu,this.#r,e)}};t(Md,"PlayerGovernment");Dd=Md});var Ed,Ot,gn=n(()=>{fe();Cx();Ed=class extends F{constructor(){super(Dd)}getByPlayer(e){let i=this.getBy("player",e);if(i.length!==1)throw new TypeError("Wrong number of PlayerGovernments for player.");return i[0]}};t(Ed,"PlayerGovernmentRegistry");Ot=new Ed});var Sd,Fd,Tx=n(()=>{hy();Im();Sd=class extends Ds{#e;#t;constructor(e,i=jn,o=()=>Math.random()){super(e),this.#e=i,this.#t=o}chooseCivilization(e){let i=e[Math.floor(e.length*this.#t())],o=this.player(),a=new i;o.setCivilization(a),this.chooseLeader(a)}chooseLeader(e){let i=this.#e.getByCivilization(e.constructor),o=i[Math.floor(this.#t()*i.length)];e.setLeader(new o)}};t(Sd,"AIClient");Fd=Sd});var GT=n(()=>{rx()});var Aa,UT=n(()=>{Qf();Aa=class extends Qm{};t(Aa,"Veteran")});var MT=n(()=>{UT()});var Iu=n(()=>{GT();MT()});var ta,Au,kd=n(()=>{M();ta=class extends x{};t(ta,"AdvancedFlight");Au=ta});var fo,DT,Px=n(()=>{M();fo=class extends x{};t(fo,"Alphabet");DT=fo});var Ai,ET,wx=n(()=>{M();Ai=class extends x{};t(Ai,"Astronomy");ET=Ai});var ra,ST,Ix=n(()=>{M();ra=class extends x{};t(ra,"AtomicTheory");ST=ra});var Qt,Bu,Yd=n(()=>{M();Qt=class extends x{};t(Qt,"Automobile");Bu=Qt});var Bi,FT,Ax=n(()=>{M();Bi=class extends x{};t(Bi,"Banking");FT=Bi});var go,kT,Bx=n(()=>{M();go=class extends x{};t(go,"BridgeBuilding");kT=go});var ho,Wd,zd=n(()=>{M();ho=class extends x{};t(ho,"BronzeWorking");Wd=ho});var Gi,YT,Gx=n(()=>{M();Gi=class extends x{};t(Gi,"CeremonialBurial");YT=Gi});var hn,WT,Ux=n(()=>{M();hn=class extends x{};t(hn,"Chemistry");WT=hn});var Ba,Gu,Ld=n(()=>{M();Ba=class extends x{};t(Ba,"Chivalry");Gu=Ba});var wr,zT,Mx=n(()=>{M();wr=class extends x{};t(wr,"CodeOfLaws");zT=wr});var On,Uu,Nd=n(()=>{M();On=class extends x{};t(On,"Combustion");Uu=On});var Bt,LT,Dx=n(()=>{M();Bt=class extends x{};t(Bt,"Communism");LT=Bt});var Ui,NT,Ex=n(()=>{M();Ui=class extends x{};t(Ui,"Computers");NT=Ui});var Ga,_l,jd=n(()=>{M();Ga=class extends x{};t(Ga,"Conscription");_l=Ga});var Zr,jT,Sx=n(()=>{M();Zr=class extends x{};t(Zr,"Construction");jT=Zr});var Oo,HT,Fx=n(()=>{M();Oo=class extends x{};t(Oo,"Corporation");HT=Oo});var Mi,_T,kx=n(()=>{M();Mi=class extends x{};t(Mi,"Currency");_T=Mi});var Ro,KT,Yx=n(()=>{M();Ro=class extends x{};t(Ro,"Democracy");KT=Ro});var Ir,qT,Wx=n(()=>{M();Ir=class extends x{};t(Ir,"Electricity");qT=Ir});var Rt,VT,zx=n(()=>{M();Rt=class extends x{};t(Rt,"Electronics");VT=Rt});var Rn,JT,Lx=n(()=>{M();Rn=class extends x{};t(Rn,"Engineering");JT=Rn});var xn,$T,Nx=n(()=>{M();xn=class extends x{};t(xn,"Explosives");$T=xn});var ia,ZT,jx=n(()=>{M();ia=class extends x{};t(ia,"Feudalism");ZT=ia});var oa,Hd,_d=n(()=>{M();oa=class extends x{};t(oa,"Flight");Hd=oa});var Ua,QT,Hx=n(()=>{M();Ua=class extends x{};t(Ua,"FusionPower");QT=Ua});var vn,XT,_x=n(()=>{M();vn=class extends x{};t(vn,"GeneticEngineering");XT=vn});var yr,ap,Kd=n(()=>{M();yr=class extends x{};t(yr,"Gunpowder");ap=yr});var Ma,qd,Vd=n(()=>{M();Ma=class extends x{};t(Ma,"HorsebackRiding");qd=Ma});var fr,Mu,Jd=n(()=>{M();fr=class extends x{};t(fr,"Industrialization");Mu=fr});var Ar,eP,Kx=n(()=>{M();Ar=class extends x{};t(Ar,"Invention");eP=Ar});var bn,$d,Zd=n(()=>{M();bn=class extends x{};t(bn,"IronWorking");$d=bn});var Da,Qd,Xd=n(()=>{M();Da=class extends x{};t(Da,"LaborUnion");Qd=Da});var Br,tP,qx=n(()=>{M();Br=class extends x{};t(Br,"Literacy");tP=Br});var Qr,Du,eg=n(()=>{M();Qr=class extends x{};t(Qr,"Magnetism");Du=Qr});var xo,tg,rg=n(()=>{M();xo=class extends x{};t(xo,"MapMaking");tg=xo});var Xt,rP,Vx=n(()=>{M();Xt=class extends x{};t(Xt,"Masonry");rP=Xt});var Gr,ig,og=n(()=>{M();Gr=class extends x{};t(Gr,"MassProduction");ig=Gr});var Di,ng,ag=n(()=>{M();Di=class extends x{};t(Di,"Mathematics");ng=Di});var Ei,iP,Jx=n(()=>{M();Ei=class extends x{};t(Ei,"Medicine");iP=Ei});var Cn,Eu,sg=n(()=>{M();Cn=class extends x{};t(Cn,"Metallurgy");Eu=Cn});var Xr,oP,$x=n(()=>{M();Xr=class extends x{};t(Xr,"Monarchy");oP=Xr});var er,nP,Zx=n(()=>{M();er=class extends x{};t(er,"Mysticism");nP=er});var Si,Su,lg=n(()=>{M();Si=class extends x{};t(Si,"Navigation");Su=Si});var ei,aP,Qx=n(()=>{M();ei=class extends x{};t(ei,"NuclearFission");aP=ei});var vo,sP,Xx=n(()=>{M();vo=class extends x{};t(vo,"NuclearPower");sP=vo});var ti,lP,ev=n(()=>{M();ti=class extends x{};t(ti,"Philosophy");lP=ti});var Fi,mP,tv=n(()=>{M();Fi=class extends x{};t(Fi,"Physics");mP=Fi});var Tn,Fu,mg=n(()=>{M();Tn=class extends x{};t(Tn,"Plastics");Fu=Tn});var Pn,pP,rv=n(()=>{M();Pn=class extends x{};t(Pn,"Pottery");pP=Pn});var ri,uP,iv=n(()=>{M();ri=class extends x{};t(ri,"Railroad");uP=ri});var wn,cP,ov=n(()=>{M();wn=class extends x{};t(wn,"Recycling");cP=wn});var ki,yP,nv=n(()=>{M();ki=class extends x{};t(ki,"Refining");yP=ki});var Gt,fP,av=n(()=>{M();Gt=class extends x{};t(Gt,"Religion");fP=Gt});var In,Ea,ku=n(()=>{M();In=class extends x{};t(In,"Robotics");Ea=In});var na,pg,ug=n(()=>{M();na=class extends x{};t(na,"Rocketry");pg=na});var bo,cg,yg=n(()=>{M();bo=class extends x{};t(bo,"SpaceFlight");cg=bo});var aa,fg,dg=n(()=>{M();aa=class extends x{};t(aa,"SteamEngine");fg=aa});var sa,gg,hg=n(()=>{M();sa=class extends x{};t(sa,"Steel");gg=sa});var Co,dP,sv=n(()=>{M();Co=class extends x{};t(Co,"Superconductor");dP=Co});var Yi,gP,lv=n(()=>{M();Yi=class extends x{};t(Yi,"TheRepublic");gP=Yi});var Sa,Og,Rg=n(()=>{M();Sa=class extends x{};t(Sa,"TheWheel");Og=Sa});var To,hP,mv=n(()=>{M();To=class extends x{};t(To,"TheoryOfGravity");hP=To});var An,xg,vg=n(()=>{M();An=class extends x{};t(An,"Trade");xg=An});var dr,OP,pv=n(()=>{M();dr=class extends x{};t(dr,"University");OP=dr});var Wi,bg,Cg=n(()=>{M();Wi=class extends x{};t(Wi,"Writing");bg=Wi});var Ur=n(()=>{kd();Px();wx();Ix();Yd();Ax();Bx();zd();Gx();Ux();Ld();Mx();Nd();Dx();Ex();jd();Sx();Fx();kx();Yx();Wx();zx();Lx();Nx();jx();_d();Hx();_x();Kd();Vd();Jd();Kx();Zd();Xd();qx();eg();rg();Vx();og();ag();Jx();sg();$x();Zx();lg();Qx();Xx();ev();tv();mg();rv();iv();ov();nv();av();ku();ug();yg();dg();hg();sv();lv();Rg();mv();vg();pv();Cg()});var zi,RP=n(()=>{dl();zi=class extends $r{};t(zi,"Anarchy")});var Ut,xP=n(()=>{dl();Ut=class extends $r{};t(Ut,"Communism")});var ut,vP=n(()=>{dl();ut=class extends $r{};t(ut,"Democracy")});var tr,bP=n(()=>{dl();tr=class extends $r{};t(tr,"Despotism")});var ct,CP=n(()=>{dl();ct=class extends $r{};t(ct,"Monarchy")});var xt,TP=n(()=>{dl();xt=class extends $r{};t(xt,"Republic")});var Bn=n(()=>{RP();xP();vP();bP();CP();TP()});var ii,PP=n(()=>{Se();ii=class extends z{};t(ii,"Aqueduct")});var gr,wP=n(()=>{Se();gr=class extends z{};t(gr,"Bank")});var oi,IP=n(()=>{Se();oi=class extends z{};t(oi,"Barracks")});var hr,AP=n(()=>{Se();hr=class extends z{};t(hr,"Cathedral")});var Po,BP=n(()=>{Se();Po=class extends z{};t(Po,"CityWalls")});var ni,GP=n(()=>{Se();ni=class extends z{};t(ni,"Colosseum")});var Mr,UP=n(()=>{Se();Mr=class extends z{};t(Mr,"Courthouse")});var rr,MP=n(()=>{Se();rr=class extends z{};t(rr,"Factory")});var ai,DP=n(()=>{Se();ai=class extends z{};t(ai,"Granary")});var Mt,EP=n(()=>{Se();Mt=class extends z{};t(Mt,"HydroPlant")});var Dr,SP=n(()=>{Se();Dr=class extends z{};t(Dr,"Library")});var Er,FP=n(()=>{Se();Er=class extends z{};t(Er,"ManufacturingPlant")});var Or,kP=n(()=>{Se();Or=class extends z{};t(Or,"Marketplace")});var wo,YP=n(()=>{Se();wo=class extends z{};t(wo,"MassTransit")});var Dt,WP=n(()=>{Se();Dt=class extends z{};t(Dt,"NuclearPlant")});var vt,zP,uv=n(()=>{Se();vt=class extends z{};t(vt,"Palace");zP=vt});var Et,LP=n(()=>{Se();Et=class extends z{};t(Et,"PowerPlant")});var Io,NP=n(()=>{Se();Io=class extends z{};t(Io,"RecyclingCenter")});var Ao,jP=n(()=>{Se();Ao=class extends z{};t(Ao,"SdiDefence")});var Lt,HP=n(()=>{Se();Lt=class extends z{};t(Lt,"Temple")});var Sr,_P=n(()=>{Se();Sr=class extends z{};t(Sr,"University")});var Li=n(()=>{PP();wP();IP();AP();BP();GP();UP();MP();DP();EP();SP();FP();kP();YP();WP();uv();LP();NP();jP();HP();_P()});var Tg,gl,KP=n(()=>{xx();qp();Tg=class extends xm{#e=1/0;end(){return this.entries()[this.length-1]}static for(e,i,o,a=wd){let[s]=a.entries().map(l=>new l(e,i,o)).map(l=>l.generate()).sort((l,u)=>l.movementCost()-u.movementCost());return s&&(s.shift(),s)}movementCost(){return this.#e}setMovementCost(e){this.#e=e}push(...e){e.forEach(i=>{let o=this.end();if(this.length>0&&!i.isNeighbourOf(o))throw new TypeError(`Tile#push: Invalid element passed, ${i.x()},${i.y()} is not a neighbour of ${o.x()},${o.y()}.`);super.push(i)})}start(){return this.entries()[0]}};t(Tg,"Path");gl=Tg});var Bo,qP=n(()=>{$t();Bo=class extends H{};t(Bo,"Artillery")});var Go,VP=n(()=>{Nl();Go=class extends $n{};t(Go,"Battleship")});var si,JP=n(()=>{rp();si=class extends yl{};t(si,"Bomber")});var Ni,$P=n(()=>{$t();Ni=class extends H{};t(Ni,"Cannon")});var Uo,ZP=n(()=>{$t();Uo=class extends H{};t(Uo,"Caravan")});var Mo,QP=n(()=>{rp();jl();Mo=class extends Qn{canStow(e){return e instanceof yl&&super.canStow(e)}capacity(){return 8}};t(Mo,"Carrier")});var ji,XP=n(()=>{$t();ji=class extends H{};t(ji,"Catapult")});var Hi,ew=n(()=>{$t();Hi=class extends H{};t(Hi,"Chariot")});var Do,tw=n(()=>{Nl();Do=class extends $n{};t(Do,"Cruiser")});var Eo,rw=n(()=>{$t();Eo=class extends H{};t(Eo,"Diplomat")});var Rr,iw=n(()=>{rp();Rr=class extends yl{};t(Rr,"Fighter")});var _i,ow=n(()=>{jl();_i=class extends Qn{capacity(){return 4}};t(_i,"Frigate")});var Fr,nw=n(()=>{$t();Fr=class extends H{};t(Fr,"Horseman")});var Ki,aw=n(()=>{Nl();Ki=class extends $n{};t(Ki,"Ironclad")});var qi,sw=n(()=>{$t();qi=class extends H{};t(qi,"Knight")});var So,lw=n(()=>{$t();So=class extends H{};t(So,"MechanizedInfantry")});var Vi,mw=n(()=>{$t();Vi=class extends H{};t(Vi,"Musketman")});var xr,pw=n(()=>{rp();xr=class extends yl{};t(xr,"Nuclear")});var Fo,uw=n(()=>{$t();Fo=class extends H{};t(Fo,"Rifleman")});var Ji,cw=n(()=>{jl();Ji=class extends Qn{capacity(){return 3}};t(Ji,"Sail")});var Ze,yw,cv=n(()=>{dx();Ze=class extends Pr{};t(Ze,"Settlers");yw=Ze});var $i,fw=n(()=>{$t();$i=class extends H{};t($i,"Spearman")});var li,dw=n(()=>{Nl();li=class extends $n{};t(li,"Submarine")});var kr,gw=n(()=>{$t();kr=class extends H{};t(kr,"Swordman")});var ko,hw=n(()=>{$t();ko=class extends H{};t(ko,"Tank")});var Yo,Ow=n(()=>{jl();Yo=class extends Qn{capacity(){return 8}};t(Yo,"Transport")});var Yr,Rw=n(()=>{jl();Yr=class extends Qn{capacity(){return 2}};t(Yr,"Trireme")});var Wo,xw=n(()=>{$t();Wo=class extends H{};t(Wo,"Warrior")});var zo=n(()=>{qP();VP();JP();$P();ZP();QP();XP();ew();tw();rw();iw();ow();nw();aw();sw();lw();mw();pw();uw();cw();cv();fw();dw();gw();hw();Ow();Rw();xw()});var Pg,wg,la,sp=n(()=>{Sm();tp();Ln();It();qe();yo();V();Ca();Xn();Tu();fl();ea();Im();xx();gn();We();Ul();Kr();w();ln();Vr();wa();Ve();Tx();Ym();Jp();Ny();Iu();Bs();Ur();Bn();Li();KP();Mc();zo();di();Ra();Be();Hs();Pg=t((r,e,i=N)=>{let o=i.getByTile(r);return o===null?!1:o.player()===e},"hasPlayerCity"),wg=class extends Fd{#e=e=>{let i=this.#A.option("earth",!1),o=this.#p.getByPlayer(this.player()).length===0;if(i&&o)return!0;let a=this.#I.getByTerrain(e.terrain());return(e.terrain()instanceof Re||e.terrain()instanceof ae||e.terrain()instanceof pe||a.some(s=>s instanceof Ii)||a.some(s=>s instanceof wi))&&e.getSurroundingArea().score(this.player(),[[Q,4],[J,2],[me,1]])>=160&&!e.getSurroundingArea(4).filter(s=>this.#p.getByTile(s)!==null).length};#t=e=>[Ie,pe,Re,ae].some(i=>e.terrain()instanceof i)&&!this.#O.getByTile(e).some(i=>i instanceof Ue)&&e.getSurroundingArea().some(i=>Pg(i,this.player(),this.#p))&&[...e.getAdjacent(),e].some(i=>i.terrain()instanceof ae||i.isCoast()||this.#O.getByTile(i).some(o=>o instanceof Ue)&&this.#p.getByTile(i)===null);#r=e=>[Me,He].some(i=>e.terrain()instanceof i)&&!this.#O.getByTile(e).some(i=>i instanceof ot)&&e.getSurroundingArea().some(i=>Pg(i,this.player(),this.#p));#i=e=>!this.#O.getByTile(e).some(i=>i instanceof je)&&e.getSurroundingArea().some(i=>Pg(i,this.player(),this.#p));#o=new Map;#n=new Map;#a=new Map;#s=[];#l=[];#m=[];#g=[];#y=[];#f=[];#u=[];#p;#v;#R;#b;#d;#C;#T;#P;#h;#w;#I;#O;#x;#c;#A;constructor(e,i=N,o=kt,a=X,s=Jr,l=jn,u=wd,c=Ot,y=L,f=hi,h=ee,G=d,D=gt,B=Fe,E=cr,Y=j,ce=b){super(e,l),this.#p=i,this.#v=o,this.#R=a,this.#b=s,this.#d=u,this.#C=c,this.#T=y,this.#P=f,this.#h=h,this.#w=G,this.#I=D,this.#x=E,this.#O=B,this.#c=Y,this.#A=ce}scoreUnitMove(e,i){let o=e.actions(i),{attack:a,buildIrrigation:s,buildMine:l,buildRoad:u,captureCity:c,disembark:y,embark:f,fortify:h,foundCity:G,noOrders:D}=o.reduce((ye,Qe)=>({...ye,[Qe.constructor.name.replace(/^./,ci=>ci.toLowerCase())]:Qe}),{});if(!o.length||o.length===1&&D||e instanceof H&&o.length===2&&h&&D)return-1;let B=0;this.#b.getByTile(i)!==null&&(B+=60),(G&&this.#e(i)||l&&this.#r(i)||s&&this.#t(i)||u&&this.#i(i))&&(B+=24);let Y=this.#c.getByTile(i).sort((ye,Qe)=>Qe.defence().value()-ye.defence().value()),[ce]=Y,Ft=Y.some(ye=>ye.player()===this.player());e instanceof Zt&&e.hasCapacity()&&Y.length&&Ft&&(B+=10),e instanceof Zt&&e.hasCargo()&&i.isCoast()&&i.isWater()&&(B+=16),f&&(B+=16),y&&(B+=16),c&&(B+=100),a&&e.attack()>ce.defence()&&(B+=24*(e.attack().value()-ce.defence().value())),a&&e.attack().value()>=ce.defence().value()&&(B+=16),a&&e.attack().value()>=ce.defence().value()*(2/3)&&(B+=8);let Hr=this.#h.getByPlayer(this.player()),sm=i.getNeighbours().filter(ye=>!Hr.includes(ye)).length;sm>0&&(B+=sm*3);let lm=this.#a.get(e);return lm instanceof ue&&i.distanceFrom(lm)<e.tile().distanceFrom(lm)&&(B+=14),(this.#o.get(e)||[]).includes(i)||(B*=4),B}moveUnit(e){let i=0;for(;e.active()&&e.moves().value()>=.1;){if(i++>1e3){console.log("SimpleAIClient#moveUnit: loopCheck: aborting"),console.log(`${e.player().civilization().name()} ${e.constructor.name}`),console.log(e.actions()),console.log(e.actionsForNeighbours()),e.action(new uo(e.tile(),e.tile(),e));return}let o=this.#n.get(e);if(o){let y=o.shift(),[f]=e.actions(y).filter(h=>h instanceof Jt);if(f){e.action(f),o.length===0&&this.#n.delete(e);return}if(o.length>0){let h=gl.for(e,e.tile(),o.end());if(h){this.#n.set(e,h);continue}}this.#n.delete(e)}let[a]=e.tile().getNeighbours().map(y=>[y,this.scoreUnitMove(e,y)]).filter(([,y])=>y>-1).sort(([,y],[,f])=>f-y||Math.floor(Math.random()*3)-1).map(([y])=>y);if(!a){e.action(new uo(e.tile(),e.tile(),e));return}let s=e.actions(a),[l]=s,u=this.#o.get(e)||[],c=this.#a.get(e);if(!l){e.action(new uo(e.tile(),e.tile(),e));return}c===a&&this.#a.delete(e),u.push(a),this.#o.set(e,u.slice(-50)),e.action(l)}e.moves().value()>0&&e.action(new uo(e.tile(),e.tile(),e))}preProcessTurn(){this.#s.splice(0),this.#l.splice(0),this.#m.splice(0),this.#g.splice(0),this.#y.splice(0),this.#f.splice(0),this.#u.splice(0);let e=this.#h.getByPlayer(this.player());e.entries().forEach(i=>{let o=i.tile(),a=this.#p.getByTile(o),s=this.#c.getBy("tile",o),l=this.#u.includes(o)&&![...this.#a.values(),...[...this.#n.values()].map(u=>u.end())].includes(o);a&&a.player()===this.player()&&!s.length&&!this.#u.includes(o)&&!l?this.#u.push(o):a&&a.player()!==this.player()&&a.originalPlayer()===this.player()?this.#s.push(o):a&&a.player()!==this.player()&&!this.#l.includes(o)?this.#l.push(o):s.length&&s.some(u=>u.player()!==this.player())&&this.#m.includes(o)?this.#m.push(o):o.isLand()&&o.getNeighbours().some(u=>!e.includes(u))&&!this.#y.includes(o)&&!l?this.#y.push(o):o.isWater()&&o.getNeighbours().some(u=>!e.includes(u))&&this.#f.includes(o)&&!l&&this.#f.push(o),this.#e(o)&&this.#g.includes(o)&&!l&&this.#g.push(o)}),this.#p.getByPlayer(this.player()).forEach(i=>{let o=this.#c.getByTile(i.tile());jm(i,this.#h,this.#R),!o.length&&!this.#u.includes(i.tile())&&this.#u.push(i.tile())})}takeTurn(){return new Promise((e,i)=>{try{let o=0;this.preProcessTurn();let[a]=this.#C.filter(l=>l.player()===this.player()),[s]=this.#T.filter(l=>l.player()===this.player());for(s.completed(Xr)&&!a.is(ct)&&a.set(new ct);this.player().hasMandatoryActions();){let l=this.player().mandatoryAction(),u=l.value();if(o++>1e3){console.log(""),console.log(""),console.log(u),u instanceof Ge&&(console.log(u.actions()),u.tile().getNeighbours().forEach(c=>console.log(u.actions(c))),console.log(u.active()),console.log(u.busy()),console.log(u.moves().value()),console.log(this.#x.getByUnit(u))),u.action(new uo(u.tile(),u.tile(),u)),console.error("SimpleAIClient: Couldn't pick an action to do.");break}if(u instanceof Ge){let c=u,y=c.tile(),f=this.#a.get(c),h=c.actions(),{buildIrrigation:G,buildMine:D,buildRoad:B,fortify:E,foundCity:Y,unload:ce}=h.reduce((ke,ye)=>({...ke,[ye.constructor.name.replace(/^./,Qe=>Qe.toLowerCase())]:ye}),{}),Ft=this.#c.getByTile(y);if(this.#o.get(c)||this.#o.set(c,[c.tile()]),c instanceof Zt&&ce&&y.isCoast()&&c.cargo().some(ke=>!y.getNeighbours().some(ye=>(this.#o.get(ke)||[]).includes(ye)))){c.action(ce),c.setWaiting();continue}if(c instanceof Pr){Y&&this.#e(y)?c.action(Y):G&&this.#t(y)?c.action(G):D&&this.#r(y)?c.action(D):B&&this.#i(y)?c.action(B):!f&&this.#g.length&&this.#a.set(c,this.#g.shift()),this.moveUnit(c);continue}let[sm]=Ft.filter(ke=>this.#x.getByUnit(ke).some(ye=>ye instanceof Pi)&&c.defence()>ke.defence()),lm=this.#p.getByTile(y);if(E&&lm&&(sm||Ft.length<=Math.ceil(this.#R.getByCity(lm).size()/5))){c.action(E),sm&&sm.activate();continue}if(!f){if(c instanceof H&&c.defence().value()>0&&this.#u.length>0){let[ke]=this.#u.sort((Qe,ci)=>Qe.distanceFrom(c.tile())-ci.distanceFrom(c.tile())),ye=gl.for(c,c.tile(),ke,this.#d);ye&&(this.#u.splice(this.#u.indexOf(ke),1),this.#n.set(c,ye))}else if(c.attack().value()>0&&this.#s.length>0){let[ke]=this.#s.filter(Qe=>c instanceof st&&Qe.isLand()).sort((Qe,ci)=>Qe.distanceFrom(c.tile())-ci.distanceFrom(c.tile())),ye=gl.for(c,c.tile(),ke,this.#d);ye&&(this.#s.splice(this.#s.indexOf(ke),1),this.#n.set(c,ye))}else if(c.attack().value()>0&&this.#m.length>0){let[ke]=this.#m.filter(Qe=>c instanceof st&&Qe.isLand()||c instanceof $e&&Qe.isWater()).sort((Qe,ci)=>Qe.distanceFrom(c.tile())-ci.distanceFrom(c.tile())),ye=gl.for(c,c.tile(),ke,this.#d);ye&&(this.#m.splice(this.#m.indexOf(ke),1),this.#n.set(c,ye))}else if(c instanceof st&&c.attack().value()>0&&this.#l.length>0){let[ke]=this.#l.sort((Qe,ci)=>Qe.distanceFrom(c.tile())-ci.distanceFrom(c.tile())),ye=gl.for(c,c.tile(),ke,this.#d);ye&&(this.#l.splice(this.#l.indexOf(ke),1),this.#n.set(c,ye))}else if(c instanceof st&&this.#y.length>0){let[ke]=this.#y.sort((Qe,ci)=>Qe.distanceFrom(c.tile())-ci.distanceFrom(c.tile())),ye=gl.for(c,c.tile(),ke,this.#d);ye&&(this.#y.splice(this.#y.indexOf(ke),1),this.#n.set(c,ye))}else if(c instanceof $e&&this.#f.length>0){let[ke]=this.#f.sort((Qe,ci)=>Qe.distanceFrom(c.tile())-ci.distanceFrom(c.tile())),ye=gl.for(c,c.tile(),ke,this.#d);ye&&(this.#f.splice(this.#f.indexOf(ke),1),this.#n.set(c,ye))}}this.moveUnit(c);continue}if(u instanceof As){this.buildItemInCity(u.city());continue}if(u instanceof ym){let c=u.available();c.length&&u.research(c[Math.floor(c.length*Math.random())]);continue}if(l instanceof Ly)break;console.log(`Can't process: '${u.constructor.name}'`);break}e()}catch(o){if(typeof o=="string"){i(new Error(o));return}if(o instanceof Error){i(o);return}i(new Error(`An unknown error occurred: ${o}`))}})}buildItemInCity(e){let i=e.tile(),o=this.#v.getByCity(e),a=this.#c.getByTile(i),s=o.available(),l=[vt,Ze],u=s.filter(E=>!l.includes(E.item())&&!Object.prototype.isPrototypeOf.call(Oe,E.item())),c=s.filter(E=>Object.prototype.isPrototypeOf.call(Oe,E.item())),y=u.filter(E=>Object.prototype.isPrototypeOf.call(Ge,E.item())),f=u[Math.floor(u.length*Math.random())].item(),h=t(E=>{let[[Y]]=y.map(ce=>{let Ft=ce.item(),Hr=new E;return this.#w.process(Ls,Ft,Hr),[Ft,Hr]}).sort(([,ce],[,Ft])=>Ft.value()-ce.value());return Y},"getUnitByYield"),G=(E=>()=>E||(E=h(Ri)))(),D=(E=>()=>E||(E=h(so)))();if(this.#c.getByTile(i).length<2&&G()){o.build(G());return}let B=this.#R.getByCity(o.city());if(s.some(E=>E.item()===Ze)&&!this.#c.getByCity(o.city()).some(E=>E instanceof Ze)&&this.#c.getByPlayer(this.player()).filter(E=>E instanceof Ze).length<3&&B.size()>1){o.build(Ze);return}if(this.#s.length>0||this.#l.length>0||this.#m.length>4){o.build(D());return}if(a.filter(E=>this.#x.getByUnit(E).filter(Y=>Y instanceof Pi)).length<2||this.#u.length){o.build(G());return}if(o.city().yields().filter(E=>E instanceof J).some(E=>E.value()>4)){let E=c.map(Y=>Y.item());o.build(E[Math.floor(Math.random()*E.length)])}f&&o.build(f)}cityLost(e,i,o){if(!i)return;let a=this.#h.getByPlayer(this.player());if(o){this.#l.push(...a.entries().filter(s=>Pg(s.tile(),this.player(),this.#p)).map(s=>s.tile())),this.#m.push(...a.entries().filter(s=>this.#c.getByTile(s.tile()).some(l=>l.player()===i)).map(s=>s.tile()));return}this.#s.push(e.tile())}unitDestroyed(e,i){let o=this.#p.getByTile(e.tile()),a=this.#c.getByTile(e.tile());o&&o.player()===this.player()&&a.length<2&&(this.buildItemInCity(o),this.#P.getByPlayerAndType(this.player(),no).buy(o))}};t(wg,"SimpleAIClient");la=wg});var Ig,Lo,Kl=n(()=>{fe();hy();Ig=class extends F{constructor(){super(Db)}getByPlayer(e){let i=this.getBy("player",e);if(i.length!==1)throw new TypeError("Wrong number of Clients for Player.");return i[0]}};t(Ig,"ClientRegistry");Lo=new Ig});var Fa,ql,lp=n(()=>{qt();Fa=class extends de{};t(Fa,"American");ql=Fa});var GW={};var vw=n(()=>{lp();mr();pr();Object.entries({people:"American",nation:"America",colors:["#0055A4","#FFF"]}).forEach(([r,e])=>Ce.register(new be(ql,r,e)))});var UW={};var bw=n(()=>{lp();Kt();Pt();["Washington","New York","Los Angeles","Chicago","Houston","Phoenix","Philadelphia","San Antonio","San Diego","Dallas","San Jose","Austin","Jacksonville","Fort Worth","Columbus","San Francisco","Charlotte","Indianapolis","Seattle","Denver","Boston","El Paso","Detroit","Nashville","Portland","Memphis","Oklahoma City","Las Vegas","Louisville","Baltimore","Milwaukee","Albuquerque","Tucson","Fresno","Mesa","Sacramento","Atlanta","Kansas City","Colorado Springs","Miami","Raleigh","Omaha","Long Beach","Virginia Beach","Oakland","Minneapolis","Tulsa","Arlington","Tampa","New Orleans","Wichita","Cleveland","Bakersfield","Aurora","Anaheim","Honolulu","Santa Ana","Riverside","Corpus Christi","Lexington","Stockton","Henderson","Saint Paul","St. Louis","Cincinnati","Pittsburgh","Greensboro","Anchorage","Plano","Lincoln","Orlando","Irvine","Newark","Toledo","Durham","Chula Vista","Fort Wayne","Jersey City","St. Petersburg","Laredo","Madison","Chandler","Buffalo","Lubbock","Scottsdale","Reno","Glendale","Gilbert","Winston\u2013Salem","North Las Vegas","Norfolk","Chesapeake","Garland","Irving","Hialeah","Fremont","Boise","Richmond","Baton Rouge","Spokane","Des Moines","Tacoma","San Bernardino","Modesto","Fontana","Santa Clarita","Birmingham","Oxnard","Fayetteville","Moreno Valley","Rochester","Glendale","Huntington Beach","Salt Lake City","Grand Rapids","Amarillo","Yonkers","Aurora","Montgomery","Akron","Little Rock","Huntsville","Augusta","Port St. Lucie","Grand Prairie","Columbus","Tallahassee","Overland Park","Tempe","McKinney","Mobile","Cape Coral","Shreveport","Frisco","Knoxville","Worcester","Brownsville","Vancouver","Fort Lauderdale","Sioux Falls","Ontario","Chattanooga","Providence","Newport News","Rancho Cucamonga","Santa Rosa","Oceanside","Salem","Elk Grove","Garden Grove","Pembroke Pines","Peoria","Eugene","Corona","Cary","Springfield","Fort Collins","Jackson","Alexandria","Hayward","Lancaster","Lakewood","Clarksville","Palmdale","Salinas","Springfield","Hollywood","Pasadena","Sunnyvale","Macon","Kansas City","Pomona","Escondido","Killeen","Naperville","Joliet","Bellevue","Rockford","Savannah","Paterson","Torrance","Bridgeport","McAllen","Mesquite","Syracuse","Midland","Pasadena","Murfreesboro","Miramar","Dayton","Fullerton","Olathe","Orange","Thornton","Roseville","Denton","Waco","Surprise","Carrollton","West Valley City","Charleston","Warren","Hampton","Gainesville","Visalia","Coral Springs","Columbia","Cedar Rapids","Sterling Heights","New Haven","Stamford","Concord","Kent","Santa Clara","Elizabeth","Round Rock","Thousand Oaks","Lafayette","Athens","Topeka","Simi Valley","Fargo","Norman","Columbia","Abilene","Wilmington","Hartford","Victorville","Pearland","Vallejo","Ann Arbor","Berkeley","Allentown","Richardson","Odessa","Arvada","Cambridge","Sugar Land","Beaumont","Lansing","Evansville","Rochester","Independence","Fairfield","Provo","Clearwater","College Station","West Jordan","Carlsbad","El Monte","Murrieta","Temecula","Springfield","Palm Bay","Costa Mesa","Westminster","North Charleston","Miami Gardens","Manchester","High Point","Downey","Clovis","Pompano Beach","Pueblo","Elgin","Lowell","Antioch","West Palm Beach","Peoria","Everett","Ventura","Centennial","Lakeland","Gresham","Richmond","Billings","Inglewood","Broken Arrow","Sandy Springs","Jurupa Valley","Hillsboro","Waterbury","Santa Maria","Boulder","Greeley","Daly City","Meridian","Lewisville","Davie","West Covina","League City","Tyler","Norwalk","San Mateo","Green Bay","Wichita Falls","Sparks","Lakewood","Burbank","Rialto","Allen","El Cajon","Las Cruces","Renton","Davenport","South Bend","Vista","Tuscaloosa","Clinton","Edison","Woodbridge","San Angelo","Kenosha","Vacaville"].forEach((r,e)=>re.register(new oe(r,ql,e===0)))});var Tw=T(Cw=>{"use strict";Object.defineProperty(Cw,"__esModule",{value:!0});vw();bw()});var ka,mp,Yu=n(()=>{qt();ka=class extends de{};t(ka,"Aztec");mp=ka});var MW={};var Pw=n(()=>{Yu();mr();pr();Object.entries({people:"Aztec",nation:"Aztec",colors:["#A1DAB5","#EA6B76"]}).forEach(([r,e])=>Ce.register(new be(mp,r,e)))});var DW={};var ww=n(()=>{Yu();Kt();Pt();["Tenochtitlan","Teotihuacan","Tlatelolco","Texcoco","Tlaxcala","Calixtlahuaca","Xochicalco","Tlacopan","Atzcapotzalco","Tzintzuntzan","Malinalco","Tula","Tamuin","Teayo","Cempoala","Chalco","Tlalmanalco","Ixtapaluca","Huexotla","Tepexpan","Tepetlaoxtoc","Chiconautla","Zitlaltepec","Coyotepec","Tequixquiac","Jilotzingo","Tlapanaloya","Tultitan","Ecatepec","Coatepec","Chalchiuites","Chiauhita","Chapultepec","Itzapalapa","Ayotzinco","Iztapam"].forEach((r,e)=>re.register(new oe(r,mp,e===0)))});var Aw=T(Iw=>{"use strict";Object.defineProperty(Iw,"__esModule",{value:!0});Pw();ww()});var Ya,pp,Wu=n(()=>{qt();Ya=class extends de{};t(Ya,"Babylonian");pp=Ya});var EW={};var Bw=n(()=>{Wu();mr();pr();Object.entries({people:"Babylonian",nation:"Babylon",colors:["#D0B8A6","#2f7b00"]}).forEach(([r,e])=>Ce.register(new be(pp,r,e)))});var SW={};var Gw=n(()=>{Wu();Kt();Pt();["Babilim","Eshnunna","Diniktum","Tutub","Der","Sippar","Kutha","Jemdet Nasr","Kish","Borsippa","Mashkan-shapir","Dilbat","Nippur","Marad","Adab","Isin","Kisurra","Shuruppak","Bad-tibira","Zabalam","Umma","Girsu","Lagash","Urum","Uruk","Larsa","Ur","Kuara","Eridu","Akshak","Akkad"].forEach((r,e)=>re.register(new oe(r,pp,e===0)))});var Mw=T(Uw=>{"use strict";Object.defineProperty(Uw,"__esModule",{value:!0});Bw();Gw()});var Wa,up,zu=n(()=>{qt();Wa=class extends de{};t(Wa,"Chinese");up=Wa});var FW={};var Dw=n(()=>{zu();mr();pr();Object.entries({people:"Chinese",nation:"China",colors:["#ee1c25","#ff0"]}).forEach(([r,e])=>Ce.register(new be(up,r,e)))});var kW={};var Ew=n(()=>{zu();Kt();Pt();["Beijing","Shanghai","Chongqing","Tianjin","Guangzhou","Shenzhen\u2020","Chengdu","Nanjing","Wuhan","Xi'an","Hangzhou","Dongguan","Foshan","Shenyang","Harbin","Qingdao","Dalian","Jinan","Zhengzhou","Changsha","Kunming","Changchun","\xDCr\xFCmqi","Shantou","Hefei","Shijiazhuang","Ningbo","Taiyuan","Nanning","Xiamen\u2020","Fuzhou","Changzhou","Wenzhou","Nanchang","Tangshan","Guiyang","Wuxi","Lanzhou","Zhongshan","Handan","Huai'an","Weifang","Zibo","Shaoxing","Yantai","Huizhou","Luoyang","Nantong","Baotou","Liuzhou"].forEach((r,e)=>re.register(new oe(r,up,e===0)))});var Fw=T(Sw=>{"use strict";Object.defineProperty(Sw,"__esModule",{value:!0});Dw();Ew()});var za,cp,Lu=n(()=>{qt();za=class extends de{};t(za,"Egyptian");cp=za});var YW={};var kw=n(()=>{Lu();mr();pr();Object.entries({people:"Egyptian",nation:"Egypt",colors:["#CE1126","#FFF"]}).forEach(([r,e])=>Ce.register(new be(cp,r,e)))});var WW={};var Yw=n(()=>{Lu();Kt();Pt();["Cairo","Alexandria","Gizeh","Shubra El-Kheima","Port Said","Suez","Luxor","al-Mansura","El-Mahalla El-Kubra","Tanta","Asyut","Ismailia","Fayyum","Zagazig","Aswan","Damietta","Damanhur","al-Minya","Beni Suef","Qena","Sohag","Hurghada","6th of October City","Shibin El Kom","Banha","Kafr el-Sheikh","Arish","Mallawi","10th of Ramadan City","Bilbais","Marsa Matruh","Idfu","Mit Ghamr","Al-Hamidiyya","Desouk","Qalyub","Abu Kabir","Kafr el-Dawwar","Girga","Akhmim","Matarey"].forEach((r,e)=>re.register(new oe(r,cp,e===0)))});var zw=T(Ww=>{"use strict";Object.defineProperty(Ww,"__esModule",{value:!0});kw();Yw()});var La,Vl,yp=n(()=>{qt();La=class extends de{};t(La,"English");Vl=La});var zW={};var Lw=n(()=>{yp();mr();pr();Object.entries({people:"English",nation:"England",colors:["#FFF","#C8102E"]}).forEach(([r,e])=>Ce.register(new be(Vl,r,e)))});var LW={};var Nw=n(()=>{yp();Kt();Pt();["London","Birmingham","Liverpool","Leeds","Sheffield","Bristol","Manchester","Leicester","Coventry","Kingston upon Hull","Stoke-on-Trent","Wolverhampton","Nottingham","Plymouth","Southampton","Reading","Derby","Dudley","Newcastle upon Tyne","Northampton","Portsmouth","Luton","Preston","Sunderland","Norwich","Walsall","Bournemouth","Southend-on-Sea","Swindon","Huddersfield","Poole","Oxford","Middlesbrough","Blackpool","Oldbury","Boldon","Ipswich","York","West Bromwich","Peterborough","Stockport","Brighton","Slough","Gloucester","Rotherham","Cambridge","Exeter","Eastbourne","Sutton Coldfield","Blackburn","Colchester","Oldham","St Helens","Woking","Chesterfield","Crawley"].forEach((r,e)=>re.register(new oe(r,Vl,e===0)))});var Hw=T(jw=>{"use strict";Object.defineProperty(jw,"__esModule",{value:!0});Lw();Nw()});var Na,fp,Nu=n(()=>{qt();Na=class extends de{};t(Na,"French");fp=Na});var NW={};var _w=n(()=>{Nu();mr();pr();Object.entries({people:"French",nation:"France",colors:["#FFF","#0055A4"]}).forEach(([r,e])=>Ce.register(new be(fp,r,e)))});var jW={};var Kw=n(()=>{Nu();Kt();Pt();["Paris","Marseille","Lyon","Toulouse","Nice","Nantes","Strasbourg","Montpellier","Bordeaux","Lille","Rennes","Reims","Le Havre","Saint-\xC9tienne","Toulon","Grenoble","Dijon","N\xEEmes","Angers","Villeurbanne","Le Mans","Saint-Denis","Aix-en-Provence","Clermont-Ferrand","Brest","Limoges","Tours","Amiens","Perpignan","Metz","Besan\xE7on","Boulogne-Billancourt","Orl\xE9ans","Mulhouse","Rouen","Saint-Denis","Caen","Argenteuil","Saint-Paul","Montreuil","Nancy","Roubaix","Tourcoing","Nanterre","Avignon","Vitry-sur-Seine","Cr\xE9teil","Dunkirk","Poitiers","Asni\xE8res-sur-Seine","Courbevoie","Versailles","Colombes","Fort-de-France","Aulnay-sous-Bois","Saint-Pierre","Rueil-Malmaison","Pau","Aubervilliers","Le Tampon","Champigny-sur-Marne","Antibes","B\xE9ziers","La Rochelle","Saint-Maur-des-Foss\xE9s","Cannes","Calais","Saint-Nazaire","M\xE9rignac","Drancy","Colmar","Ajaccio","Bourges","Issy-les-Moulineaux","Levallois-Perret","La Seyne-sur-Mer","Quimper","Noisy-le-Grand","Villeneuve-d'Ascq","Neuilly-sur-Seine","Valence","Antony","Cergy","V\xE9nissieux","Pessac","Troyes","Clichy","Ivry-sur-Seine","Chamb\xE9ry","Lorient","Les Abymes","Montauban","Sarcelles","Niort","Villejuif","Saint-Andr\xE9","Hy\xE8res","Saint-Quentin","Beauvais","\xC9pinay-sur-Seine","Cayenne","Maisons-Alfort","Cholet","Meaux","Chelles","Pantin","\xC9vry","Fontenay-sous-Bois","Fr\xE9jus","Vannes","Bondy","Le Blanc-Mesnil","La Roche-sur-Yon","Saint-Louis","Arles","Clamart","Narbonne","Annecy","Sartrouville","Grasse","Laval","Belfort","Bobigny","\xC9vreux","Vincennes","Montrouge","Sevran","Albi","Charleville-M\xE9zi\xE8res","Suresnes","Martigues","Corbeil-Essonnes","Saint-Ouen","Bayonne","Cagnes-sur-Mer","Brive-la-Gaillarde","Carcassonne","Massy","Blois","Aubagne","Saint-Brieuc","Ch\xE2teauroux","Chalon-sur-Sa\xF4ne","Mantes-la-Jolie","Meudon","Saint-Malo","Ch\xE2lons-en-Champagne","Alfortville","S\xE8te","Salon-de-Provence","Vaulx-en-Velin","Puteaux","Rosny-sous-Bois","Saint-Herblain","Gennevilliers","Le Cannet","Livry-Gargan","Saint-Priest","Istres","Valenciennes","Choisy-le-Roi","Caluire-et-Cuire","Boulogne-sur-Mer","Bastia","Angoul\xEAme","Garges-l\xE8s-Gonesse","Castres","Thionville","Wattrelos","Talence","Saint-Laurent-du-Maroni","Douai","Noisy-le-Sec","Tarbes","Arras","Al\xE8s","La Courneuve","Bourg-en-Bresse","Compi\xE8gne","Gap","Melun","Le Lamentin","Rez\xE9","Saint-Germain-en-Laye","Marcq-en-Bar\u0153ul","Gagny","Anglet","Draguignan","Chartres","Bron","Bagneux","Colomiers","Saint-Martin-d'H\xE8res","Pontault-Combault","Montlu\xE7on","Jou\xE9-l\xE8s-Tours","Saint-Joseph","Poissy","Savigny-sur-Orge","Cherbourg-Octeville","Mont\xE9limar","Villefranche-sur-Sa\xF4ne","Stains","Saint-Beno\xEEt","Bagnolet","Ch\xE2tillon","Le Port","Sainte-Genevi\xE8ve-des-Bois","\xC9chirolles","Roanne","Villepinte","Saint-Chamond","Conflans-Sainte-Honorine","Auxerre","Nevers","Neuilly-sur-Marne","La Ciotat","Tremblay-en-France","Thonon-les-Bains","Vitrolles","Haguenau","Six-Fours-les-Plages","Agen","Creil","Annemasse","Saint-Rapha\xEBl","Marignane","Romans-sur-Is\xE8re","Montigny-le-Bretonneux","Le Perreux-sur-Marne","Franconville","M\xE2con","Saint-Leu","Cambrai","Ch\xE2tenay-Malabry","Sainte-Marie","Villeneuve-Saint-Georges","Houilles","\xC9pinal","Lens","Li\xE9vin","Les Mureaux","Schiltigheim","La Possession","Meyzieu","Dreux","Nogent-sur-Marne","Plaisir","Mont-de-Marsan","Palaiseau","Ch\xE2tellerault","Goussainville","L'Ha\xFF-les-Roses","Viry-Ch\xE2tillon","Vigneux-sur-Seine","Chatou","Trappes","Clichy-sous-Bois","Rillieux-la-Pape","Villenave-'Ornon","Maubeuge","Charenton-le-Pont","Malakoff","Matoury","Dieppe","Athis-Mons","Savigny-le-Temple","P\xE9rigueux","Baie-Mahault","Vandoeuvre-l\xE8s-Nancy","Pontoise","Aix-les-Bains","Cachan","Vienne","Thiais","Orange","Saint-M\xE9dard-en-Jalles","Villemomble","Saint-Cloud","Saint-Laurent-du-Var","Yerres","Saint-\xC9tienne-du-Rouvray","Sotteville-l\xE8s-Rouen","Draveil","Le Chesnay","Bois-Colombes","Le Plessis-Robinson","La Garenne-Colombes","Lambersart","Soissons","Pierrefitte-sur-Seine","Carpentras","Villiers-sur-Marne","Vanves","Menton","Bergerac","Ermont","Bezons","Grigny","Guyancourt","Saumur","Herblay","Ris-Orangis","Villiers-le-Bel","Bourgoin-Jallieu","Vierzon","Le Gosier","D\xE9cines-Charpieu","H\xE9nin-Beaumont","Fresnes","Aurillac","Sannois","Vallauris","Illkirch-Graffenstaden","Alen\xE7on","\xC9lancourt","Tournefeuille","B\xE8gles","Gonesse","Oullins","Brunoy","Taverny","Armenti\xE8res","Montfermeil","Rambouillet","Villeparisis","Le Kremlin-Bic\xEAtre","Sucy-en-Brie","Kourou","Montb\xE9liard","Romainville","Cavaillon","Saint-Dizier","Br\xE9tigny-sur-Orge","Saint-S\xE9bastien-sur-Loire","Saintes","La Teste-de-Buch","Villeneuve-la-Garenne","B\xE9thune","Bussy-Saint-Georges","Vichy","La Garde","Agde","Laon","Sens","Lunel","Miramas","Biarritz","Le Grand-Quevilly","Orvault","Les Ulis","Champs-sur-Marne","Rochefort","Muret","Sainte-Anne","Eaubonne","\xC9tampes","Gradignan","Vernon","Petit-Bourg","Libourne","Abbeville","Rodez","Saint-Ouen-l'Aum\xF4ne","Torcy","Maisons-Laffitte","Montgeron","Villeneuve-sur-Lot","Cormeilles-en-Parisis","\xC9pernay","S\xE8vres","Dole","Le Robert","Le Bouscat","Blagnac","Frontignan","Cenon","Mandelieu-la-Napoule","Vertou","Les Lilas","Bruay-la-Buissi\xE8re","Les Pavillons-sous-Bois","Chaumont","Roissy-en-Brie","Le Moule","Le Petit-Quevilly","Manosque","Saint-Mand\xE9","Fontenay-aux-Roses","Orly","Le Creusot","Oyonnax","La Madeleine","Sainte-Suzanne","Millau","Combs-la-Ville","Fontaine","Deuil-la-Barre","Coudekerque-Branche","Auch","Lanester","Beaune","Montigny-l\xE8s-Metz","Hazebrouck","Longjumeau","Sainte-Foy-l\xE8s-Lyon","Forbach","Sarreguemines","Mons-en-Bar\u0153ul","La Valette-du-Var","H\xE9rouville-Saint-Clair","Morsang-sur-Orge","Grande-Synthe","La Celle-Saint-Cloud","Lisieux","Croix","Dammarie-les-Lys","V\xE9lizy-Villacoublay","Wasquehal","Saint-Gratien","Halluin","Neuilly-Plaisance","Montmorency","Dax","Lagny-sur-Marne","Le M\xE9e-sur-Seine","Saint-Genis-Laval","Fleury-les-Aubrais","Loos","Gif-sur-Yvette","Denain","Saint-Di\xE9-des-Vosges","Sainte-Rose","Saint-Michel-sur-Orge"].forEach((r,e)=>re.register(new oe(r,fp,e===0)))});var Vw=T(qw=>{"use strict";Object.defineProperty(qw,"__esModule",{value:!0});_w();Kw()});var ja,Jl,dp=n(()=>{qt();ja=class extends de{};t(ja,"German");Jl=ja});var HW={};var Jw=n(()=>{dp();mr();pr();Object.entries({people:"German",nation:"Germany",colors:["#000","#FC0"]}).forEach(([r,e])=>Ce.register(new be(Jl,r,e)))});var _W={};var $w=n(()=>{dp();Kt();Pt();["Berlin","Hamburg","Munich","Cologne","Frankfurt","Stuttgart","D\xFCsseldorf","Dortmund","Essen","Leipzig","Bremen","Dresden","Hanover","Nuremberg","Duisburg","Bochum","Wuppertal","Bielefeld","Bonn","M\xFCnster","Karlsruhe","Mannheim","Augsburg","Wiesbaden","Gelsenkirchen","M\xF6nchengladbach","Braunschweig","Chemnitz","Kiel","Aachen","Halle","Magdeburg","Freiburg","Krefeld","L\xFCbeck","Oberhausen","Erfurt","Mainz","Rostock","Kassel","Hagen","Hamm","Saarbr\xFCcken","M\xFClheim an der Ruhr","Potsdam","Ludwigshafen am Rhein","Oldenburg","Leverkusen","Osnabr\xFCck","Solingen"].forEach((r,e)=>re.register(new oe(r,Jl,e===0)))});var Qw=T(Zw=>{"use strict";Object.defineProperty(Zw,"__esModule",{value:!0});Jw();$w()});var Ha,gp,ju=n(()=>{qt();Ha=class extends de{};t(Ha,"Greek");gp=Ha});var KW={};var Xw=n(()=>{ju();mr();pr();Object.entries({people:"Greek",nation:"Greece",colors:["#2175D8","#FFF"]}).forEach(([r,e])=>Ce.register(new be(gp,r,e)))});var qW={};var eI=n(()=>{ju();Kt();Pt();["Athens","Thessaloniki","Patras","Piraeus","Larissa","Heraklion","Peristeri","Kallithea","Acharnes","Kalamaria","Nikaia","Glyfada","Volos","Ilio","Ilioupoli","Keratsini","Evosmos","Chalandri","Nea Smyrni","Marousi","Agios Dimitrios","Zografou","Egaleo","Nea Ionia","Ioannina","Palaio Faliro","Korydallos","Trikala","Vyronas","Agia Paraskevi","Galatsi","Agrinio","Chalcis","Petroupoli","Serres","Alexandroupoli","Xanthi","Katerini","Kalamata","Kavala","Chania","Lamia","Komotini","Irakleio","Rhodes","Kifissia","Stavroupoli","Chaidari","Drama","Veria","Alimos","Kozani","Polichni","Karditsa","Sykies","Ampelokipoi","Pylaia","Agioi Anargyroi","Argyroupoli","Ano Liosia","Nea Ionia","Rethymno","Ptolemaida","Tripoli","Cholargos","Vrilissia","Aspropyrgos","Corinth","Gerakas","Metamorfosi","Giannitsa","Voula","Kamatero","Mytilene","Neapoli","Eleftherio-Kordelio","Chios","Agia Varvara","Kaisariani","Nea Filadelfeia","Moschato","Perama","Salamina","Eleusis","Corfu","Pyrgos","Megara","Kilkis","Dafni","Thebes","Melissia","Argos","Arta","Artemida","Livadeia","Pefki","Oraiokastro","Aigio","Kos","Koropi","Preveza","Naousa","Orestiada","Peraia","Edessa","Florina","Panorama","Nea Erythraia1","Elliniko1","Amaliada","Pallini","Sparta","Agios Ioannis Rentis","Thermi","Vari","Nea Makri","Tavros","Alexandreia","Menemeni","Paiania","Kalyvia Thorikou","Nafplio","Drapetsona","Efkarpia","Papagou","Nafpaktos","Kastoria","Grevena","Pefka","Nea Alikarnassos","Missolonghi","Gazi","Ierapetra","Kalymnos","Rafina","Loutraki","Agios Nikolaos","Ermoupoli","Ialysos","Mandra","Tyrnavos","Glyka Nera","Ymittos","Neo Psychiko"].forEach((r,e)=>re.register(new oe(r,gp,e===0)))});var rI=T(tI=>{"use strict";Object.defineProperty(tI,"__esModule",{value:!0});Xw();eI()});var _a,hp,Hu=n(()=>{qt();_a=class extends de{};t(_a,"Indian");hp=_a});var VW={};var iI=n(()=>{Hu();mr();pr();Object.entries({people:"Indian",nation:"India",colors:["#138808","#FF9933"]}).forEach(([r,e])=>Ce.register(new be(hp,r,e)))});var JW={};var oI=n(()=>{Hu();Kt();Pt();["Delhi","Mumbai","Bangalore","Hyderabad","Ahmedabad","Chennai","Kolkata","Surat","Pune","Jaipur","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivli","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Dhanbad","Amritsar","Navi Mumbai","Allahabad","Howrah","Ranchi","Gwalior","Jabalpur","Coimbatore","Vijayawada","Jodhpur","Madurai","Raipur","Kota","Chandigarh","Guwahati","Solapur","Hubli\u2013Dharwad","Tiruchirappalli","Bareilly","Moradabad","Mysore","Tiruppur","Gurgaon","Aligarh","Jalandhar","Bhubaneswar","Salem","Mira-Bhayandar","Warangal","Jalgaon","Guntur","Bhiwandi","Saharanpur","Gorakhpur","Bikaner","Amravati","Noida","Jamshedpur","Bhilai","Cuttack","Firozabad","Kochi","Nellore","Bhavnagar","Dehradun","Durgapur","Asansol","Rourkela","Nanded","Kolhapur","Ajmer","Akola","Gulbarga","Jamnagar","Ujjain","Loni","Siliguri","Jhansi","Ulhasnagar","Jammu","Sangli-Miraj & Kupwad","Mangalore","Erode","Belgaum","Ambattur","Tirunelveli","Malegaon","Gaya","Thiruvananthapuram","Udaipur","Maheshtala","Davanagere","Kozhikode","Kurnool","Rajpur Sonarpur","Rajahmundry","Bokaro","South Dumdum","Bellary","Patiala","Gopalpur","Agartala","Bhagalpur","Muzaffarnagar","Bhatpara","Panihati","Latur","Dhule","Tirupati","Rohtak","Korba","Bhilwara","Berhampur","Muzaffarpur","Ahmednagar","Mathura","Kollam","Avadi","Kadapa","Kamarhati","Sambalpur","Bilaspur","Shahjahanpur","Satara","Bijapur","Kakinada","Rampur","Shimoga","Chandrapur","Junagadh","Thrissur","Alwar","Bardhaman","Kulti","Nizamabad","Parbhani","Tumkur","Khammam","Ozhukarai","Bihar Sharif","Panipat","Darbhanga","Bally","Aizawl","Dewas","Ichalkaranji","Karnal","Bathinda","Jalna","Eluru","Barasat","Kirari Suleman Nagar","Purnia","Satna","Mau","Sonipat","Farrukhabad","Sagar","Durg","Imphal","Ratlam","Hapur","Arrah","Anantapur","Karimnagar","Etawah","Ambarnath","North Dumdum","Bharatpur","Begusarai","New Delhi","Gandhidham","Baranagar","Tiruvottiyur","Pondicherry","Sikar","Thoothukudi","Rewa","Mirzapur","Raichur","Pali","Ramagundam","Haridwar","Vijayanagaram","Katihar","Nagercoil","Sri Ganganagar","Karawal Nagar","Mango","Thanjavur","Bulandshahr","Uluberia","Katni","Sambhal","Singrauli","Nadiad","Secunderabad","Naihati","Yamunanagar","Bidhannagar","Pallavaram","Bidar","Munger","Panchkula","Burhanpur","Raurkela Industrial Township","Kharagpur","Dindigul","Gandhinagar","Hospet","Nangloi Jat","Malda","Ongole","Deoghar","Chapra","Haldia","Khandwa","Nandyal","Morena","Amroha","Anand","Bhind","Bhalswa Jahangir Pur","Madhyamgram","Bhiwani","Berhampore","Ambala","Morbi","Fatehpur","Raebareli","Mahaboobnagar","Chittoor","Bhusawal","Orai","Bahraich","Vellore","Mehsana","Raiganj","Sirsa","Danapur","Serampore","Sultan Pur Majra","Guna","Jaunpur","Panvel","Shivpuri","Surendranagar Dudhrej","Unnao","Chinsurah","Alappuzha","Kottayam","Machilipatnam","Shimla","Adoni","Udupi","Tenali","Proddatur","Saharsa","Hindupur","Sasaram","Hajipur","Bhimavaram","Kumbakonam","Dehri","Madanapalle","Siwan","Bettiah","Guntakal","Srikakulam","Motihari","Dharmavaram","Gudivada","Phagwara","Narasaraopet","Suryapet","Miryalaguda","Tadipatri","Karaikudi","Kishanganj","Jamalpur","Ballia","Kavali","Tadepalligudem","Amaravati","Buxar","Jehanabad","Aurangabad","Gangtok"].forEach((r,e)=>re.register(new oe(r,hp,e===0)))});var aI=T(nI=>{"use strict";Object.defineProperty(nI,"__esModule",{value:!0});iI();oI()});var Ka,Op,_u=n(()=>{qt();Ka=class extends de{};t(Ka,"Mongol");Op=Ka});var $W={};var sI=n(()=>{_u();mr();pr();Object.entries({people:"Mongol",nation:"Mongolia",colors:["#DA2032","#0066B3"]}).forEach(([r,e])=>Ce.register(new be(Op,r,e)))});var ZW={};var lI=n(()=>{_u();Kt();Pt();["Ulaanbaatar","Erdenet","Darkhan","Choibalsan","M\xF6r\xF6n","Nalaikh","Bayankhongor","\xD6lgii","Khovd","Arvaikheer","Ulaangom","Baganuur","Sainshand","Tsetserleg","S\xFCkhbaatar","\xD6nd\xF6rkhaan","Dalanzadgad","Z\xFC\xFCnkharaa","Uliastai","Altai","Baruun-Urt","Mandalgovi","Zuunmod","Zamyn-\xDC\xFCd","Bulgan","Kharkhorin","Choir","Bor-\xD6nd\xF6r","Sharyngo"].forEach((r,e)=>re.register(new oe(r,Op,e===0)))});var pI=T(mI=>{"use strict";Object.defineProperty(mI,"__esModule",{value:!0});sI();lI()});var qa,Rp,Ku=n(()=>{qt();qa=class extends de{};t(qa,"Roman");Rp=qa});var QW={};var uI=n(()=>{Ku();mr();pr();Object.entries({people:"Roman",nation:"Rome",colors:["#A20101","#D1B24F"]}).forEach(([r,e])=>Ce.register(new be(Rp,r,e)))});var XW={};var cI=n(()=>{Ku();Kt();Pt();["Roma","Ariminum","Belum","Placentia","Tarraco","Italica","Mod","Salernum","Bononia","Forum Livii","Regium Lepidi","Aquileia","Ascrivium","Valentia Edetanorum","Scalabis","Villa Euracini","Palma","Colonia Narbo Martius","Massa","Pistoria","Segovia","Gerunda","Pompaelo","Naissus","Brigantium","Florentia","Vesontio","Lutetia Parisiorum","Atuatuca Tungrorum","Iulia Romula Hispalis","Augusta Raurica","Noviodunum","Lugdunum","Siscia","Marsonia","Augusta Treverorum","Castra Legionis","Augusta Taurinorum","Augusta Praetoria Salassorum","Emerita Augusta","Norba Caesarina","Lucus Augusta","Caesarea","Bracara Augusta","Novaesium","Castra Vetera","Pons Drusi","Ovilava","Iuvavum","Augusta Vindelicorum","Turicum","Asturica Augusta","Borbetomagus","Caesaraugusta","Sirmium","Sorviodurum","Mogontiacum","Argentoratum","Bonna","Noviomagus","Castellum apud Confluentes","Divodurum","Caesaromagus","Ambianum","Faventia Paterna Barcino","Abila","Lousonna","Ulpia Noviomagus Batavorum","Rigomagus","Aquae Mattiacorum","Mursa","Emona","Vindonissa","Aventicum","Praetorium Agrippinae","Lugdunum Batavorum","Aequum","Londinium","Albanianis","Lauri","Durovernum Cantiacorum","Regulbium","Rutupiae","Viminacium","Camulodunum","Traiectum","Matilo","Forum Hadriani","Nigrum Pullum","Lindum Colonia","Ratae Corieltauvorum","Durocobrivis","Colonia Agrippina","Durocornovium","Verulamium","Letocetum","Dubris","Danum","Mediolanum","Isca Dumnoniorum","Blestium","Viroconium Cornoviorum","Aquae Sulis","Durnovaria","Lindinis","Ad Flexum","Clausentum","Venta Belgarum","Calleva Atrebatum","Duroliponte","Concangis","Condate","Corinium Dobunnorum","Eboracum","Luguvalium","Arae Flaviae","Isca Augusta","Lagentium","Lopodunum","Moridunum","Venta Silurum","Deva Victrix","Mamucium","Olicana","Vinovia","Bonames","Coria","Gerulata","Vindobona","Biriciana","Cannstatt Castrum","Colonia Nervia Glevensium","Sumelocenna","Lopodunum","Traiectum ad Nicrem","Castra Batavar","Nida","Lactodurum","Bovium","Burgodunum","Lentia","Aquae Granni","Complutum","Aeminium","Traiectum ad Mosam","Coriovallum","Portus Lemanis","Andautonia","Salona","Cibalae","Aquae Helveticae","Aquincum","Apulum","Pons Aelius","Durovigutum","Aelia Capitolina","Ala","Castra Regina","Theranda","Pomaria","Partiscum","Gesoriacum","Aurelia Aquensis","Urbs Aurelianorum","Venetiae","Ragusium"].forEach((r,e)=>re.register(new oe(r,Rp,e===0)))});var fI=T(yI=>{"use strict";Object.defineProperty(yI,"__esModule",{value:!0});uI();cI()});var Va,$l,xp=n(()=>{qt();Va=class extends de{};t(Va,"Russian");$l=Va});var ez={};var dI=n(()=>{xp();mr();pr();Object.entries({people:"Russian",nation:"Russia",colors:["#0032A0","#DA291C"]}).forEach(([r,e])=>Ce.register(new be($l,r,e)))});var tz={};var gI=n(()=>{xp();Kt();Pt();["Moscow","Saint Petersburg","Novosibirsk","Yekaterinburg","Nizhny Novgorod","Kazan","Chelyabinsk","Omsk","Samara","Ufa","Rostov-on-Don","Krasnoyarsk","Voronezh","Perm","Volgograd","Krasnodar","Saratov","Tyumen","Makhachkala","Tolyatti","Barnaul","Ulyanovsk","Izhevsk","Vladivostok","Irkutsk","Khabarovsk","Yaroslavl","Tomsk","Orenburg","Kemerovo","Novokuznetsk","Tula","Ryazan","Kirov","Astrakhan","Naberezhnye Chelny","Sochi","Penza","Lipetsk","Cheboksary","Balashikha","Kaliningrad","Kursk","Stavropol","Ulan-Ude","Bryansk","Tver","Magnitogorsk","Ivanovo","Belgorod","Surgut","Vladimir","Arkhangelsk","Nizhny Tagil","Kaluga","Chita","Saransk","Yakutsk","Smolensk","Podolsk","Volzhsky","Vladikavkaz","Vologda","Cherepovets","Kurgan","Oryol","Grozny","Murmansk","Tambov","Petrozavodsk","Sterlitamak","Kostroma","Nizhnevartovsk","Novorossiysk","Yoshkar-Ola","Taganrog","Komsomolsk-on-Amur","Khimki","Syktyvkar","Nalchik","Nizhnekamsk","Shakhty","Dzerzhinsk","Bratsk","Orsk","Angarsk","Engels","Blagoveshchensk","Stary Oskol","Veliky Novgorod","Korolyov","Pskov","Mytishchi","Biysk","Lyubertsy","Prokopyevsk","Yuzhno-Sakhalinsk","Balakovo","Armavir","Rybinsk","Severodvinsk","Abakan","Petropavlovsk-Kamchatsky","Norilsk","Syzran","Volgodonsk","Ussuriysk","Kamensk-Uralsky","Novocherkassk","Zlatoust","Elektrostal","Almetyevsk","Krasnogorsk","Salavat","Miass","Nakhodka","Kopeysk","Pyatigorsk","Rubtsovsk","Berezniki","Kolomna","Maykop","Odintsovo","Khasavyurt","Kovrov","Kislovodsk","Neftekamsk","Nefteyugansk","Novocheboksarsk","Serpukhov","Shchyolkovo","Novomoskovsk","Bataysk","Pervouralsk","Domodedovo","Derbent","Cherkessk","Orekhovo-Zuyevo","Nevinnomyssk","Dimitrovgrad","Nazran","Kyzyl","Oktyabrsky","Obninsk","Kaspiysk","Novy Urengoy","Ramenskoye","Kamyshin","Murom","Zhukovsky"].forEach((r,e)=>re.register(new oe(r,$l,e===0)))});var OI=T(hI=>{"use strict";Object.defineProperty(hI,"__esModule",{value:!0});dI();gI()});var Ja,vp,qu=n(()=>{qt();Ja=class extends de{};t(Ja,"Zulu");vp=Ja});var rz={};var RI=n(()=>{qu();mr();pr();Object.entries({people:"Zulu",nation:"Zulus",colors:["#FFFD1E","#000"]}).forEach(([r,e])=>Ce.register(new be(vp,r,e)))});var iz={};var xI=n(()=>{qu();Kt();Pt();["uMgungundlovu","Nobamba","Bulawayo","KwaDukuza","Nongoma","oNdini","Nodwengu","Ndondakusuka","Babanango","Khangela","Kwahlomendlini","Hlobane","eThekwini","Mlambongwenya","Eziqwaqweni","Isiphezi","Masotsheni","Mtunzini","Nyakamubi","Hlatikulu","Mthonjaneni","Empangeni","Pongola","Tungela","Kwamashu","Ingwavuma","Hluhluwe","Mtubatuba","Mhlahlandlela","Mthatha","Maseru","Lobamba","Qunu"].forEach((r,e)=>re.register(new oe(r,vp,e===0)))});var bI=T(vI=>{"use strict";Object.defineProperty(vI,"__esModule",{value:!0});RI();xI()});var oz={};var CI=n(()=>{U();kd();R.register(Au)});var PI=T(TI=>{"use strict";Object.defineProperty(TI,"__esModule",{value:!0});CI()});var nz={};var wI=n(()=>{U();Px();R.register(DT)});var AI=T(II=>{"use strict";Object.defineProperty(II,"__esModule",{value:!0});wI()});var az={};var BI=n(()=>{U();wx();R.register(ET)});var UI=T(GI=>{"use strict";Object.defineProperty(GI,"__esModule",{value:!0});BI()});var sz={};var MI=n(()=>{U();Ix();R.register(ST)});var EI=T(DI=>{"use strict";Object.defineProperty(DI,"__esModule",{value:!0});MI()});var lz={};var SI=n(()=>{U();Yd();R.register(Bu)});var kI=T(FI=>{"use strict";Object.defineProperty(FI,"__esModule",{value:!0});SI()});var mz={};var YI=n(()=>{U();Ax();R.register(FT)});var zI=T(WI=>{"use strict";Object.defineProperty(WI,"__esModule",{value:!0});YI()});var pz={};var LI=n(()=>{U();Bx();R.register(kT)});var jI=T(NI=>{"use strict";Object.defineProperty(NI,"__esModule",{value:!0});LI()});var uz={};var HI=n(()=>{U();zd();R.register(Wd)});var KI=T(_I=>{"use strict";Object.defineProperty(_I,"__esModule",{value:!0});HI()});var cz={};var qI=n(()=>{U();Gx();R.register(YT)});var JI=T(VI=>{"use strict";Object.defineProperty(VI,"__esModule",{value:!0});qI()});var yz={};var $I=n(()=>{U();Ux();R.register(WT)});var QI=T(ZI=>{"use strict";Object.defineProperty(ZI,"__esModule",{value:!0});$I()});var fz={};var XI=n(()=>{U();Ld();R.register(Gu)});var tA=T(eA=>{"use strict";Object.defineProperty(eA,"__esModule",{value:!0});XI()});var dz={};var rA=n(()=>{U();Mx();R.register(zT)});var oA=T(iA=>{"use strict";Object.defineProperty(iA,"__esModule",{value:!0});rA()});var gz={};var nA=n(()=>{U();Nd();R.register(Uu)});var sA=T(aA=>{"use strict";Object.defineProperty(aA,"__esModule",{value:!0});nA()});var hz={};var lA=n(()=>{U();Dx();R.register(LT)});var pA=T(mA=>{"use strict";Object.defineProperty(mA,"__esModule",{value:!0});lA()});var Oz={};var uA=n(()=>{U();Ex();R.register(NT)});var yA=T(cA=>{"use strict";Object.defineProperty(cA,"__esModule",{value:!0});uA()});var Rz={};var fA=n(()=>{U();jd();R.register(_l)});var gA=T(dA=>{"use strict";Object.defineProperty(dA,"__esModule",{value:!0});fA()});var xz={};var hA=n(()=>{U();Sx();R.register(jT)});var RA=T(OA=>{"use strict";Object.defineProperty(OA,"__esModule",{value:!0});hA()});var vz={};var xA=n(()=>{U();Fx();R.register(HT)});var bA=T(vA=>{"use strict";Object.defineProperty(vA,"__esModule",{value:!0});xA()});var bz={};var CA=n(()=>{U();kx();R.register(_T)});var PA=T(TA=>{"use strict";Object.defineProperty(TA,"__esModule",{value:!0});CA()});var Cz={};var wA=n(()=>{U();Yx();R.register(KT)});var AA=T(IA=>{"use strict";Object.defineProperty(IA,"__esModule",{value:!0});wA()});var Tz={};var BA=n(()=>{U();Wx();R.register(qT)});var UA=T(GA=>{"use strict";Object.defineProperty(GA,"__esModule",{value:!0});BA()});var Pz={};var MA=n(()=>{U();zx();R.register(VT)});var EA=T(DA=>{"use strict";Object.defineProperty(DA,"__esModule",{value:!0});MA()});var wz={};var SA=n(()=>{U();Lx();R.register(JT)});var kA=T(FA=>{"use strict";Object.defineProperty(FA,"__esModule",{value:!0});SA()});var Iz={};var YA=n(()=>{U();Nx();R.register($T)});var zA=T(WA=>{"use strict";Object.defineProperty(WA,"__esModule",{value:!0});YA()});var Az={};var LA=n(()=>{U();jx();R.register(ZT)});var jA=T(NA=>{"use strict";Object.defineProperty(NA,"__esModule",{value:!0});LA()});var Bz={};var HA=n(()=>{U();_d();R.register(Hd)});var KA=T(_A=>{"use strict";Object.defineProperty(_A,"__esModule",{value:!0});HA()});var Gz={};var qA=n(()=>{U();Hx();R.register(QT)});var JA=T(VA=>{"use strict";Object.defineProperty(VA,"__esModule",{value:!0});qA()});var Uz={};var $A=n(()=>{U();_x();R.register(XT)});var QA=T(ZA=>{"use strict";Object.defineProperty(ZA,"__esModule",{value:!0});$A()});var Mz={};var XA=n(()=>{U();Kd();R.register(ap)});var tB=T(eB=>{"use strict";Object.defineProperty(eB,"__esModule",{value:!0});XA()});var Dz={};var rB=n(()=>{U();Vd();R.register(qd)});var oB=T(iB=>{"use strict";Object.defineProperty(iB,"__esModule",{value:!0});rB()});var Ez={};var nB=n(()=>{U();Jd();R.register(Mu)});var sB=T(aB=>{"use strict";Object.defineProperty(aB,"__esModule",{value:!0});nB()});var Sz={};var lB=n(()=>{U();Kx();R.register(eP)});var pB=T(mB=>{"use strict";Object.defineProperty(mB,"__esModule",{value:!0});lB()});var Fz={};var uB=n(()=>{U();Zd();R.register($d)});var yB=T(cB=>{"use strict";Object.defineProperty(cB,"__esModule",{value:!0});uB()});var kz={};var fB=n(()=>{U();Xd();R.register(Qd)});var gB=T(dB=>{"use strict";Object.defineProperty(dB,"__esModule",{value:!0});fB()});var Yz={};var hB=n(()=>{U();qx();R.register(tP)});var RB=T(OB=>{"use strict";Object.defineProperty(OB,"__esModule",{value:!0});hB()});var Wz={};var xB=n(()=>{U();eg();R.register(Du)});var bB=T(vB=>{"use strict";Object.defineProperty(vB,"__esModule",{value:!0});xB()});var zz={};var CB=n(()=>{U();rg();R.register(tg)});var PB=T(TB=>{"use strict";Object.defineProperty(TB,"__esModule",{value:!0});CB()});var Lz={};var wB=n(()=>{U();Vx();R.register(rP)});var AB=T(IB=>{"use strict";Object.defineProperty(IB,"__esModule",{value:!0});wB()});var Nz={};var BB=n(()=>{U();og();R.register(ig)});var UB=T(GB=>{"use strict";Object.defineProperty(GB,"__esModule",{value:!0});BB()});var jz={};var MB=n(()=>{U();ag();R.register(ng)});var EB=T(DB=>{"use strict";Object.defineProperty(DB,"__esModule",{value:!0});MB()});var Hz={};var SB=n(()=>{U();Jx();R.register(iP)});var kB=T(FB=>{"use strict";Object.defineProperty(FB,"__esModule",{value:!0});SB()});var _z={};var YB=n(()=>{U();sg();R.register(Eu)});var zB=T(WB=>{"use strict";Object.defineProperty(WB,"__esModule",{value:!0});YB()});var Kz={};var LB=n(()=>{U();$x();R.register(oP)});var jB=T(NB=>{"use strict";Object.defineProperty(NB,"__esModule",{value:!0});LB()});var qz={};var HB=n(()=>{U();Zx();R.register(nP)});var KB=T(_B=>{"use strict";Object.defineProperty(_B,"__esModule",{value:!0});HB()});var Vz={};var qB=n(()=>{U();lg();R.register(Su)});var JB=T(VB=>{"use strict";Object.defineProperty(VB,"__esModule",{value:!0});qB()});var Jz={};var $B=n(()=>{U();Qx();R.register(aP)});var QB=T(ZB=>{"use strict";Object.defineProperty(ZB,"__esModule",{value:!0});$B()});var $z={};var XB=n(()=>{U();Xx();R.register(sP)});var tG=T(eG=>{"use strict";Object.defineProperty(eG,"__esModule",{value:!0});XB()});var Zz={};var rG=n(()=>{U();ev();R.register(lP)});var oG=T(iG=>{"use strict";Object.defineProperty(iG,"__esModule",{value:!0});rG()});var Qz={};var nG=n(()=>{U();tv();R.register(mP)});var sG=T(aG=>{"use strict";Object.defineProperty(aG,"__esModule",{value:!0});nG()});var Xz={};var lG=n(()=>{U();mg();R.register(Fu)});var pG=T(mG=>{"use strict";Object.defineProperty(mG,"__esModule",{value:!0});lG()});var eL={};var uG=n(()=>{U();rv();R.register(pP)});var yG=T(cG=>{"use strict";Object.defineProperty(cG,"__esModule",{value:!0});uG()});var tL={};var fG=n(()=>{U();iv();R.register(uP)});var gG=T(dG=>{"use strict";Object.defineProperty(dG,"__esModule",{value:!0});fG()});var rL={};var hG=n(()=>{U();ov();R.register(cP)});var RG=T(OG=>{"use strict";Object.defineProperty(OG,"__esModule",{value:!0});hG()});var iL={};var xG=n(()=>{U();nv();R.register(yP)});var bG=T(vG=>{"use strict";Object.defineProperty(vG,"__esModule",{value:!0});xG()});var oL={};var CG=n(()=>{U();av();R.register(fP)});var PG=T(TG=>{"use strict";Object.defineProperty(TG,"__esModule",{value:!0});CG()});var nL={};var wG=n(()=>{U();ku();R.register(Ea)});var AG=T(IG=>{"use strict";Object.defineProperty(IG,"__esModule",{value:!0});wG()});var aL={};var BG=n(()=>{U();ug();R.register(pg)});var UG=T(GG=>{"use strict";Object.defineProperty(GG,"__esModule",{value:!0});BG()});var sL={};var MG=n(()=>{U();yg();R.register(cg)});var EG=T(DG=>{"use strict";Object.defineProperty(DG,"__esModule",{value:!0});MG()});var lL={};var SG=n(()=>{U();dg();R.register(fg)});var kG=T(FG=>{"use strict";Object.defineProperty(FG,"__esModule",{value:!0});SG()});var mL={};var YG=n(()=>{U();hg();R.register(gg)});var zG=T(WG=>{"use strict";Object.defineProperty(WG,"__esModule",{value:!0});YG()});var pL={};var LG=n(()=>{U();sv();R.register(dP)});var jG=T(NG=>{"use strict";Object.defineProperty(NG,"__esModule",{value:!0});LG()});var uL={};var HG=n(()=>{U();mv();R.register(hP)});var KG=T(_G=>{"use strict";Object.defineProperty(_G,"__esModule",{value:!0});HG()});var cL={};var qG=n(()=>{U();lv();R.register(gP)});var JG=T(VG=>{"use strict";Object.defineProperty(VG,"__esModule",{value:!0});qG()});var yL={};var $G=n(()=>{U();Rg();R.register(Og)});var QG=T(ZG=>{"use strict";Object.defineProperty(ZG,"__esModule",{value:!0});$G()});var fL={};var XG=n(()=>{U();vg();R.register(xg)});var tU=T(eU=>{"use strict";Object.defineProperty(eU,"__esModule",{value:!0});XG()});var dL={};var rU=n(()=>{U();pv();R.register(OP)});var oU=T(iU=>{"use strict";Object.defineProperty(iU,"__esModule",{value:!0});rU()});var gL={};var nU=n(()=>{U();Cg();R.register(bg)});var sU=T(aU=>{"use strict";Object.defineProperty(aU,"__esModule",{value:!0});nU()});var hL,lU,mU=n(()=>{wm();v();V();hL=t((r=b)=>[new gi(new p((e,i)=>{r.emit("city:building-complete",e,i)}))],"getRules"),lU=hL});var OL,pU,uU=n(()=>{qe();Ve();ro();nR();v();OL=t((r=N,e=j,i=ze)=>[new gm(new p(o=>!i.tileIsWorked(o))),new gm(new p((o,a)=>!e.getByTile(o).some(s=>s.player()!==a.player()))),new gm(new p((o,a)=>{let s=r.getByTile(o);return s===null?!0:s===a}))],"getRules"),pU=OL});var RL,cU,yU=n(()=>{qe();It();Ln();Ve();V();wl();v();Hs();Kr();ro();RL=t((r=N,e=j,i=X,o=kt,a=b,s=ee,l=ze)=>[new lr(new p(u=>o.getByCity(u).progress().set(0))),new lr(new p(u=>i.getByCity(u).shrink())),new lr(new p((u,c,y)=>{a.emit("city:captured",u,c,y)})),new lr(new p(u=>e.getByCity(u).forEach(c=>c.destroy()))),new lr(new p(u=>Pf(u,s,i,l)))],"getRules"),cU=RL});var xL,fU,dU=n(()=>{Xn();Bn();It();gn();Ve();vm();I();v();jR();zo();HR();KR();xL=t((r=X,e=Ot,i=j)=>[new lt(new p(o=>new lC(r.getByCity(o).size()*2))),...[[Ze,1,zi,tr],[Ze,2,Ut,ut,ct,xt]].map(([o,a,...s])=>new lt(new m(l=>i.getByCity(l).some(u=>u instanceof o)),new m(l=>e.getByPlayer(l.player()).is(...s)),new p(l=>i.getByCity(l).filter(u=>u instanceof o).map(u=>new mC(a,u))))),new lt(new m(o=>e.getByPlayer(o.player()).is(zi,tr)),new m(o=>{let a=r.getByCity(o);return i.getByCity(o).filter(s=>[zt,H,$e,Pr].some(l=>s instanceof l)).length>a.size()}),new p(o=>{let a=r.getByCity(o);return i.getByCity(o).filter(s=>[zt,H,$e,Pr].some(l=>s instanceof l)).slice(a.size()).map(s=>new _R(1,s))})),new lt(new m(o=>e.getByPlayer(o.player()).is(Ut,ut,ct,xt)),new p(o=>i.getByCity(o).filter(a=>[zt,H,$e,Pr].some(s=>a instanceof s)).map(a=>new _R(1,a))))],"getRules"),fU=xL});var Ag,bp,Bg=n(()=>{A();Ag=class extends g{};t(Ag,"TileReassigned");bp=Ag});var vL,gU,hU=n(()=>{Bl();Ln();It();qe();V();ea();Kr();w();Vr();ro();Jp();My();Jc();I();v();Bg();Nc();Hs();vL=t((r=Fe,e=kt,i=X,o=N,a=ee,s=d,l=io,u=b,c=ze)=>[...[Ue,je].map(y=>new Qo(new m(f=>r.getByTile(f.tile()).every(h=>!(h instanceof y))),new p(f=>r.register(new y(f.tile()))))),new Qo(new p(y=>e.register(new As(y,l,s)))),new Qo(new p(y=>i.register(new Dl(y,s)))),new Qo(new p(y=>o.register(y))),new Qo(new p(y=>{u.emit("city:created",y)})),new Qo(new p(y=>{let f=c.getByTile(y.tile());f!==null&&c.unregister(f),c.register(new Ps(y.tile(),y)),f!==null&&s.process(bp,f.city(),f.tile()),jm(y,a,i,c)}))],"getRules"),gU=vL});var bL,OU,RU=n(()=>{qe();V();Vr();Ve();Il();v();ea();ro();bL=t((r=Fe,e=N,i=b,o=j,a=ze)=>[new Cr(new p(s=>r.getByTile(s.tile()).filter(l=>l instanceof Ue).forEach(l=>r.unregister(l)))),new Cr(new p((s,l)=>{i.emit("city:destroyed",s,l)})),new Cr(new p(s=>o.getByCity(s).forEach(l=>l.destroy()))),new Cr(new p(s=>a.getByCity(s).forEach(l=>a.unregister(l))))],"getRules"),OU=bL});var Gg,Ug,yv=n(()=>{A();Gg=class extends g{};t(Gg,"FoodExhausted");Ug=Gg});var CL,xU,vU=n(()=>{v();yv();CL=t(()=>[new Ug(new p(r=>r.shrink()))],"getRules"),xU=CL});var TL,bU,CU=n(()=>{w();I();v();bR();yv();TL=t((r=d)=>[new Xp(new m(e=>e.progress().value()>=e.cost().value()),new p(e=>e.grow())),new Xp(new m(e=>e.progress().value()<0),new p(e=>{r.process(Ug,e)}))],"getRules"),bU=TL});var PL,TU,PU=n(()=>{It();Kr();I();v();By();Hs();ro();PL=t((r=X,e=ee,i=ze)=>[new _n(new p(o=>o.empty())),new _n(new p(o=>o.cost().set((o.size()+1)*10,"city-grow"))),new _n(new m(o=>o.city().tilesWorked().length<o.size()+1),new p(o=>aC(o.city(),e,r,i))),new _n(new m(o=>o.city().tilesWorked().length>o.size()+1),new p(o=>wf(o.city(),o).forEach(a=>i.unregisterByTile(a))))],"getRules"),TU=PL});var wL,wU,IU=n(()=>{xR();v();wL=t(()=>[new Py(new p(r=>10*(r.size()+1)))],"getRules"),wU=wL});var Mg,No,Zl=n(()=>{A();Mg=class extends g{};t(Mg,"CivilDisorder");No=Mg});var Dg,jo,Cp=n(()=>{A();Dg=class extends g{};t(Dg,"ProcessYield");jo=Dg});var Eg,Ql,Sg=n(()=>{A();Eg=class extends g{};t(Eg,"Unsupported");Ql=Eg});var IL,AU,BU=n(()=>{Ln();It();Ca();Ta();w();Ve();Zl();I();v();Cp();Sg();IL=t((r=kt,e=X,i=j,o=d)=>[new jo(new m(a=>a instanceof Q),new p((a,s,l)=>{let u=e.getByCity(s),c=new Hn(a);l.forEach(y=>{if(!(y instanceof Vs)||c.value()>=0)return;let f=y.unit();f!==null&&(o.process(Ql,s,f,y),c.subtract(y))}),u.add(c),u.check()})),new jo(new m(a=>a instanceof J),new p((a,s,l)=>{let u=r.getByCity(s),c=a.clone();l.filter(f=>f instanceof Js).sort((f,h)=>(f.unit()?.tile().distanceFrom(s.tile())??0)-(h.unit()?.tile().distanceFrom(s.tile())??0)).forEach(f=>{if(c.value()>=0)return;let h=f.unit();h!==null&&(o.process(Ql,s,h,f),c.subtract(f))});let y=s.yields();o.process(No,s,y).some(f=>f)||u.add(c),u.check()}))],"getRules"),AU=IL});var AL,GU,UU=n(()=>{It();Kr();I();v();CR();Hs();ro();AL=t((r=X,e=ee,i=ze)=>[new Am(new m(o=>o.size()>0),new p(o=>o.cost().set((o.size()+1)*10,"city-shrink"))),new Am(new m(o=>o.size()>0),new m(o=>o.city().tilesWorked().length>o.size()+1),new p(o=>wf(o.city(),o).forEach(a=>i.unregisterByTile(a)))),new Am(new m(o=>o.size()<=0),new p(o=>o.city().destroy()))],"getRules"),GU=AL});var BL,MU,DU=n(()=>{It();Kr();ro();v();Bg();Hs();BL=t((r=ee,e=X,i=ze)=>[new bp(new p(o=>jm(o,r,e,i)))],"getRules"),MU=BL});var GL,EU,SU=n(()=>{v();pR();qp();GL=t(()=>[new Kc(new p(r=>Rm.from(...r.tile().getSurroundingArea(2).filter((e,i)=>![0,4,20,24].includes(i)))))],"getRules"),EU=GL});var Fg,Pe,vr=n(()=>{Se();fe();Fg=class extends F{constructor(){super(z)}getByCity(e,i=!1){return this.filter(o=>o.city()===e&&!o.destroyed())}};t(Fg,"CityImprovementRegistry");Pe=new Fg});var UL,FU,kU=n(()=>{Bn();vr();Ta();gn();v();ha();uv();vs();Cm();mo();UL=t((r=Pe,e=Ot)=>[new Xo(new ga,new p((i,o)=>{let a=e.getByPlayer(i.player()),[s]=r.filter(y=>y instanceof zP&&i.player()===y.city().player()).map(y=>y.city()),l=Le(o,me),u=a.is(Ut)?10:a.is(ut)?0:s?s.tile().distanceFrom(i.tile()):32,[c]=[[zi,8],[Ut,20],[ut,0],[tr,12],[ct,16],[xt,24]].filter(([y])=>a.is(y)).map(([,y])=>y);return new nn(c?Math.min(Math.floor(l*u*3/(10*c)),l):0,u.toFixed(2))})),new Xo(new _r(0),new p(i=>i.tilesWorked().entries().flatMap(o=>o.yields(i.player()).flatMap(a=>new a.constructor(a.value(),o.id()+": "+a.values().map(([,s])=>s).join("-"))))))],"getRules"),FU=UL});var ML,YU,WU=n(()=>{gR();Ln();qe();en();I();v();ML=t((r=kt,e=N)=>[new Xe(new m(i=>e.getByPlayer(i).map(o=>r.getByCity(o)).some(o=>!o.building())),new p(i=>e.getByPlayer(i).map(o=>r.getByCity(o)).filter(o=>!o.building()).map(o=>new Nn(i,o)))),new Xe(new m(i=>e.getByPlayer(i).map(o=>r.getByCity(o)).some(o=>!!o.building())),new p(i=>e.getByPlayer(i).map(o=>r.getByCity(o)).filter(o=>!!o.building()).map(o=>new Ms(i,o))))],"getRules"),YU=ML});var DL,zU,LU=n(()=>{It();qe();V();tp();I();Ru();v();DL=t((r=N,e=X,i=b)=>[new an(new m((o,a,s)=>s instanceof Xs&&s.to()===o.tile()&&r.getByTile(s.to())!==null),new p(o=>{let a=r.getByTile(o.tile());e.getByCity(a).shrink()})),new an(new p((o,a,s)=>i.emit("unit:defeated",o,a,s)))],"getRules"),zU=DL});var EL,NU,jU=n(()=>{w();ro();I();v();At();Bg();EL=t((r=d,e=ze)=>[new q(new m(i=>i.moves().value()===0),new m((i,o)=>e.tileIsWorked(o.to())),new m((i,o)=>{let a=e.getByTile(o.to());return a.city().player()===i.player()?!1:!e.tileCanBeWorkedBy(a.tile(),a.city())}),new p((i,o)=>{let a=e.getByTile(o.to());e.unregister(a),r.process(bp,a.city(),o.to())}))],"getRules"),NU=EL});var SL,HU,_U=n(()=>{v();Sg();SL=t(()=>[new Ql(new p((r,e)=>e.destroy()))],"getRules"),HU=SL});var FL={};var KU=n(()=>{mU();uU();yU();dU();hU();RU();vU();CU();PU();IU();BU();UU();DU();SU();kU();w();WU();LU();jU();_U();d.register(...lU(),...pU(),...cU(),...fU(),...gU(),...OU(),...xU(),...bU(),...TU(),...wU(),...AU(),...GU(),...EU(),...MU(),...FU(),...YU(),...zU(),...NU(),...HU())});var VU=T(qU=>{"use strict";Object.defineProperty(qU,"__esModule",{value:!0});KU()});var kg,Yg,fv=n(()=>{gu();qs();mo();kg=t((r,e=r.city().yields())=>{let i=r.city(),o=new Array(r.size()).fill(1),[a,s]=Wl(e,Bf,qn),l=o.length-1;for(;s>0&&l>-1;)o[l--]=0,s--;for(l=0;a>0&&l<o.length;)o[l]===0&&(o[l]=1,a--),o[l]===1&&(o[l++]=2,a--),o[l]===2&&l++;return o},"calculateCitizenState"),Yg=t(r=>r.reduce(([e,i,o],a)=>[e+(a===0?1:0),i+(a===1?1:0),o+(a===2?1:0)],[0,0,0]),"citizenSummary")});var Wg,Tp,zg=n(()=>{A();Wg=class extends g{};t(Wg,"CelebrateLeader");Tp=Wg});var kL,JU,$U=n(()=>{It();fv();zg();I();v();kL=t((r=X)=>[new Tp(new m(e=>r.getByCity(e).size()>2),new p((e,i=e.yields())=>{let o=r.getByCity(e),a=kg(o,i),[s,,l]=Yg(a);return s===0&&Math.floor(l)>=o.size()/2}))],"getRules"),JU=kL});var YL,ZU,QU=n(()=>{It();fv();Zl();v();YL=t((r=X)=>[new No(new p((e,i=e.yields())=>{let o=r.getByCity(e),a=kg(o,i),[s,,l]=Yg(a);return s>l}))],"getRules"),ZU=YL});var Xl,XU=n(()=>{qs();_s();Xl=class extends qn{#e;constructor(e,i){super(e,i.id()),this.#e=i,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t(Xl,"CityImprovementContent");qr(Xl)});var Pp,eM=n(()=>{gu();Pp=class extends Bf{};t(Pp,"LuxuryHappiness")});var em,tM=n(()=>{qs();_s();em=class extends qn{#e;constructor(e,i){super(e,i.id()),this.#e=i,this.addKey("unit")}unit(){return this.#e}};t(em,"MartialLaw");qr(em)});var $a,rM=n(()=>{qs();$a=class extends qn{#e;constructor(e,i){super(e,i.id()),this.#e=i,this.addKey("unit")}unit(){return this.#e}};t($a,"MilitaryUnhappiness")});var wp,iM=n(()=>{qs();wp=class extends qn{};t(wp,"PopulationUnhappiness")});var Lg=n(()=>{Gf()});var Ng=n(()=>{XU();Ta();gu();hu();eM();tM();rM();iM();Ca();Lg();qs()});var jg,Wr,Hg=n(()=>{tR();jg=class extends gc{validate(...e){return!this.criteria().length||this.criteria().some(i=>i.validate(...e))}};t(jg,"Or");Wr=jg});var WL,oM,nM=n(()=>{Bn();Li();It();Ng();vr();gn();We();w();Ve();vm();I();v();Xn();Tl();ha();Ur();Hg();mo();WL=t((r=d,e=X,i=Pe,o=Ot,a=L,s=j)=>[new lt(new m(l=>o.getByPlayer(l.player()).is(zi,Ut,tr,ct)),new p((l,u)=>s.getByTile(l.tile()).filter(c=>c instanceof H).slice(0,Math.min(4,Le(u,rt))).map(c=>new em(1,c)))),...[[Lt,1],[Lt,1,er],[ni,3],[hr,4]].map(([l,u,...c])=>new lt(new tt,new m(y=>i.getByCity(y).some(f=>f instanceof l)),new Wr(new m(y=>c.length===0),new m(y=>c.every(f=>a.getByPlayer(y.player()).completed(f)))),new m((y,f)=>Le(f,rt)>0),new p((y,f)=>new Xl(Math.min(u,Le(f,rt)),i.getByCity(y).filter(h=>h instanceof l)[0])))),new lt(new Yn,new p((l,u)=>new Pp(Math.floor(Le(u,bi)/2),bi.name)))],"getRules"),oM=WL});var zL,aM,sM=n(()=>{Xn();It();Bn();Ng();gn();Ve();Cm();I();v();zL=t((r=X,e=Ot,i=j)=>[new Xo(new m(o=>r.getByCity(o).size()-5>0),new p(o=>new wp(Math.max(r.getByCity(o).size()-5,0)))),...[[xt,1],[ut,2]].map(([o,a])=>new Xo(new m(s=>{try{return e.getByPlayer(s.player()).is(o)}catch{return!1}}),new m(s=>i.getByCity(s).filter(l=>[zt,H,$e].some(u=>l instanceof u)&&l.tile()!==s.tile()).length>0),new p(s=>i.getByCity(s).filter(l=>[zt,H,$e].some(u=>l instanceof u)&&l.tile()!==s.tile()).map(l=>new $a(a,l)))))],"getRules"),aM=zL});var _g,lM,mM=n(()=>{Fn();_g=class extends nr{};t(_g,"CivilDisorder");lM=_g});var Kg,ma,Vu=n(()=>{A();Kg=class extends g{};t(Kg,"TurnStart");ma=Kg});var Ip,Ju,LL,pM,dv=n(()=>{It();qe();V();w();zg();Zl();v();ha();Vu();Ip=new Set,Ju=new Set,LL=t((r=N,e=d,i=b,o=X)=>[new ma(new tt,new p(a=>r.getByPlayer(a).forEach(s=>{let l=e.process(No,s,s.yields()).some(c=>c),u=e.process(Tp,s,s.yields()).some(c=>c);l&&i.emit("city:civil-disorder",s),l&&!Ip.has(s)&&Ip.add(s),!l&&Ip.has(s)&&(i.emit("city:order-restored",s),Ip.delete(s)),u&&!Ju.has(s)&&(i.emit("city:leader-celebration",s),Ju.add(s)),!u&&Ju.has(s)&&(i.emit("city:leader-celebration-ended",s),Ju.delete(s))}))),new ma(new tt,new p(a=>r.getByPlayer(a).forEach(s=>{if(!Ju.has(s))return;o.getByCity(s).grow()})))],"getRules"),pM=LL});var NL,uM,cM=n(()=>{qe();en();mM();v();dv();NL=t((r=N)=>[new Xe(new p(e=>r.getByPlayer(e).filter(i=>Ip.has(i)).map(i=>new lM(e,i))))],"getRules"),uM=NL});var jL={};var yM=n(()=>{$U();QU();nM();sM();w();cM();dv();d.register(...JU(),...aM(),...ZU(),...oM(),...uM(),...pM())});var dM=T(fM=>{"use strict";Object.defineProperty(fM,"__esModule",{value:!0});yM()});var HL={};var gM=n(()=>{Li();Bl();io.register(ii,gr,oi,hr,Po,ni,Mr,rr,ai,Mt,Dr,Er,Or,wo,Dt,vt,Et,Io,Ao,Lt,Sr)});var _L,hM,OM=n(()=>{Li();Ur();Tm();vr();We();I();v();_L=t((r=Pe,e=L)=>[new mt(new p((i,o)=>new m(()=>!r.getByCity(i).some(a=>a instanceof o)))),...[[ii,Zr],[Po,Xt],[ni,Zr],[Mr,wr],[ai,Pn],[Dr,Wi],[Or,Mi],[vt,Xt],[Lt,Gi],[gr,Bi],[hr,Gt],[rr,fr],[Mt,Rt],[wo,Gr],[Er,In],[Dt,vo],[Et,ki],[Io,wn],[Ao,Co],[Sr,dr]].map(([i,o])=>new mt(new m((a,s)=>s===i),new p(a=>new m(()=>e.getByPlayer(a.player()).completed(o))))),...[[gr,Or],[Sr,Dr],[Mt,rr],[Dt,rr],[Et,rr],[Er,Mt,Dt,Et]].map(([i,...o])=>new mt(new m((a,s)=>s===i),new p(a=>new m(()=>r.getByCity(a).some(s=>o.some(l=>s instanceof l)))))),...[[Mr,vt],[Mt,Dt,Et],[Dt,Et,Mt],[Et,Mt,Dt]].map(([i,...o])=>new mt(new m((a,s)=>s===i),new p(a=>new m(()=>r.getByCity(a).every(s=>!o.some(l=>s instanceof l))))))],"getRules"),hM=_L});var KL,RM,xM=n(()=>{Li();Pm();KL=t(()=>[...[[ii,120],[oi,40],[Po,120],[ni,100],[Mr,80],[ai,60],[Dr,80],[Or,80],[vt,200],[Lt,40],[gr,120],[hr,160],[rr,200],[Mt,240],[wo,160],[Er,320],[Dt,160],[Et,160],[Io,200],[Ao,200],[Sr,160]].flatMap(([r,e])=>Is(r,e))],"getRules"),RM=KL});var qL,vM,bM=n(()=>{vr();wl();v();Li();Be();qL=t((r=Pe,e=()=>Math.random())=>[new lr(new p(i=>{let o=r.getByCity(i).filter(s=>!(s instanceof Oe)),[a]=o.filter(s=>s instanceof vt);for(a&&(a.destroy(),o.splice(o.indexOf(a),1));o.length>0&&e()>.7;){let s=o[Math.floor(e()*o.length)];if(!s)break;s.destroy(),o.splice(o.indexOf(s),1)}}))],"getRules"),vM=qL});var he,gv=n(()=>{Bs();_s();he=class extends no{#e;constructor(e=0,i=null){super(e,i?i.id():"none"),this.#e=i,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t(he,"CityImprovementMaintenanceGold");qr(he)});var qg=n(()=>{Ta();gv();Af();wy();hu();Lg();ba()});var VL,CM,TM=n(()=>{Li();Ur();vr();We();qg();vm();I();v();VL=t((r=Pe,e=L)=>[...[[ii,he,2],[gr,he,3],[hr,he,3],[Po,he,2],[ni,he,2],[Mr,he,1],[rr,he,4],[ai,he,1],[Mt,he,4],[Dr,he,1],[Er,he,6],[Or,he,1],[wo,he,4],[Dt,he,2],[vt,he,0],[Et,he,4],[Io,he,2],[Ao,he,4],[Lt,he,1],[Sr,he,3]].map(([i,o,a])=>new lt(new m(s=>r.getByCity(s).some(l=>l instanceof i)),new p(s=>{let[l]=r.getByCity(s).filter(u=>u instanceof i);return new o(a,l)}))),...[[oi,he,0,null,yr],[oi,he,1,yr,Qt],[oi,he,2,Qt,null]].map(([i,o,a,s,l])=>new lt(new m(u=>r.getByCity(u).some(c=>c instanceof i)),new m(u=>s===null||e.getByPlayer(u.player()).completed(s)),new m(u=>l===null||!e.getByPlayer(u.player()).completed(l)),new p(u=>{let[c]=r.getByCity(u).filter(y=>y instanceof i);return new o(a,c)})))],"getRules"),CM=VL});var JL,PM,wM=n(()=>{vr();qe();w();Jc();I();v();Li();JL=t((r=N,e=Pe,i=d)=>[new Qo(new m(o=>r.getByPlayer(o.player()).length===0),new p(o=>e.register(new vt(o,i))))],"getRules"),PM=JL});var $L,IM,AM=n(()=>{vr();I();Il();v();$L=t((r=Pe)=>[new Cr(new m(e=>r.getByCity(e).length>0),new p(e=>r.getByCity(e).forEach(i=>i.destroy())))],"getRules"),IM=$L});var ZL,BM,GM=n(()=>{Li();vr();I();v();qg();By();ZL=t((r=Pe)=>[new _n(new m(e=>!r.getByCity(e.city()).some(i=>i instanceof ii)),new m(e=>e.size()>10),new p(e=>e.shrink())),new _n(new m(e=>r.getByCity(e.city()).some(i=>i instanceof ai)),new p(e=>e.add(new Hn(e.cost().value()/2))))],"getRules"),BM=ZL});var QL,UM,MM=n(()=>{vr();V();TR();v();QL=t((r=Pe,e=b)=>[new eu(new p(i=>r.register(i))),new eu(new p((i,o)=>{e.emit("city-improvement:created",i,o)}))],"getRules"),UM=QL});var XL,DM,EM=n(()=>{Li();vr();qg();I();v();rR();Qc();mo();XL=t((r=Pe)=>[...[[Or,Ee,.5],[Or,bi,.5],[gr,Ee,.5],[gr,bi,.5],[Dr,Vt,.5],[Sr,Vt,.5],[rr,J,.5],[Et,J,.5],[Mt,J,.5],[Dt,J,.5],[Er,J,.5],[Mr,nn,.5]].map(([e,i,o])=>new Al(new fb,new m(a=>r.getByCity(a).some(s=>s instanceof e)),new p((a,s)=>new i(Math.floor(Le(s,i)*o),e.name))))],"getRules"),DM=XL});var eN,SM,FM=n(()=>{vr();wa();Li();mf();I();v();Iu();eN=t((r=Pe,e=cr)=>[new Oa(new m(i=>i.city()!==null),new m(i=>r.getByCity(i.city()).some(o=>o instanceof oi)),new p(i=>e.register(new Aa(i))))],"getRules"),SM=eN});var tN={};var kM=n(()=>{w();OM();xM();bM();TM();wM();AM();GM();MM();EM();FM();d.register(...hM(),...RM(),...vM(),...CM(),...PM(),...IM(),...BM(),...UM(),...DM(),...SM())});var WM=T(YM=>{"use strict";Object.defineProperty(YM,"__esModule",{value:!0});gM();kM()});var LM={};lc(LM,{default:()=>rN,registerCityNames:()=>zM});var zM,rN,NM=n(()=>{Kt();Pt();zM=t((r=re)=>{["Bergen","Cannae","Capua","Cordoba","Cremona","Crete","Cunaxa","Damascus","Dublin","Genoa","Ghent","Issus","Lisbon","Mecca","Melbourne","Milan","Naples","Pisa","Prague","Salamis","Salzburg","Seville","Sidon","Sydney","Tarsus","Toronto","Turin","Tyre","Utica","Venice","Verona"].forEach(e=>r.register(new oe(e,null)))},"registerCityNames"),rN=zM});var hv=n(()=>{lp();Yu();Wu();zu();Lu();yp();Nu();dp();ju();Hu();_u();Ku();xp();qu()});var Vg,Jg,Ov=n(()=>{to();qt();Vg=class extends _e{constructor(){super(de)}};t(Vg,"CivilizationRegistry");Jg=new Vg});var HM={};lc(HM,{default:()=>iN,registerCivilizations:()=>jM});var jM,iN,_M=n(()=>{hv();Ov();jM=t((r=Jg)=>{r.register(Fa,ka,Ya,Wa,za,La,Na,ja,Ha,_a,Ka,qa,Va,Ja)},"registerCivilizations"),iN=jM});var Za,KM=n(()=>{dt();lp();Za=class extends le{static civilization(){return ql}name(){return"Abraham Lincoln"}};t(Za,"AbrahamLincoln")});var qM=n(()=>{dt();lp()});var VM=n(()=>{KM();qM()});var Qa,JM=n(()=>{dt();Yu();Qa=class extends le{static civilization(){return mp}name(){return"Moctezuma II"}};t(Qa,"MoctezumaII")});var $M=n(()=>{JM()});var Xa,ZM=n(()=>{dt();Wu();Xa=class extends le{static civilization(){return pp}name(){return"Hammurabi"}};t(Xa,"Hammurabi")});var QM=n(()=>{ZM()});var es,XM=n(()=>{dt();zu();es=class extends le{static civilization(){return up}name(){return"Mao Zedong"}};t(es,"MaoZedong")});var eD=n(()=>{XM()});var ts,tD=n(()=>{dt();Lu();ts=class extends le{static civilization(){return cp}name(){return"Ramesses II"}};t(ts,"RamessesII")});var rD=n(()=>{tD()});var rs,iD=n(()=>{dt();yp();rs=class extends le{static civilization(){return Vl}name(){return"Elizabeth I"}};t(rs,"ElizabethI")});var oD=n(()=>{dt();yp()});var nD=n(()=>{iD();oD()});var is,aD=n(()=>{dt();Nu();is=class extends le{static civilization(){return fp}name(){return"Napoleon I"}};t(is,"NapoleonI")});var sD=n(()=>{aD()});var os,lD=n(()=>{dt();dp();os=class extends le{static civilization(){return Jl}name(){return"Frederick the Great"}};t(os,"FrederickTheGreat")});var mD=n(()=>{dt();dp()});var pD=n(()=>{lD();mD()});var ns,uD=n(()=>{dt();ju();ns=class extends le{static civilization(){return gp}name(){return"Alexander the Great"}};t(ns,"AlexanderTheGreat")});var cD=n(()=>{uD()});var as,yD=n(()=>{dt();Hu();as=class extends le{static civilization(){return hp}name(){return"Mahatma Gandhi"}};t(as,"MahatmaGandhi")});var fD=n(()=>{yD()});var ss,dD=n(()=>{dt();_u();ss=class extends le{static civilization(){return Op}name(){return"Genghis Khan"}};t(ss,"GenghisKhan")});var gD=n(()=>{dD()});var ls,hD=n(()=>{dt();Ku();ls=class extends le{static civilization(){return Rp}name(){return"Julius Caesar"}};t(ls,"JuliusCaesar")});var OD=n(()=>{hD()});var RD=n(()=>{dt();xp()});var ms,xD=n(()=>{dt();xp();ms=class extends le{static civilization(){return $l}name(){return"Joseph Stalin"}};t(ms,"JosephStalin")});var vD=n(()=>{RD();xD()});var ps,bD=n(()=>{dt();qu();ps=class extends le{static civilization(){return vp}name(){return"Shaka"}};t(ps,"Shaka")});var CD=n(()=>{bD()});var Rv=n(()=>{VM();$M();QM();eD();rD();nD();sD();pD();cD();fD();gD();OD();vD();CD()});var PD={};lc(PD,{default:()=>oN,registerLeaders:()=>TD});var TD,oN,wD=n(()=>{Rv();Im();TD=t((r=jn)=>{r.register(Za,Qa,Xa,es,ts,rs,is,os,ns,as,ss,ls,ms,ps)},"registerLeaders"),oN=TD});var $g,Ap,Zg=n(()=>{Zp();$g=class extends Es{};t($g,"Aggression");Ap=$g});var Qg,Bp,ID=n(()=>{Zg();Qg=class extends Ap{constructor(e){super(e,1)}};t(Qg,"Aggressive");Bp=Qg});var Xg,Gp,eh=n(()=>{Zp();Xg=class extends Es{};t(Xg,"Militarism");Gp=Xg});var th,us,AD=n(()=>{eh();th=class extends Gp{constructor(e){super(e,0)}};t(th,"Civilized");us=th});var rh,Up,ih=n(()=>{Zp();rh=class extends Es{};t(rh,"Development");Up=rh});var oh,Mp,BD=n(()=>{ih();oh=class extends Up{constructor(e){super(e,1)}};t(oh,"Expansionist");Mp=oh});var nh,ah,GD=n(()=>{Zg();nh=class extends Ap{constructor(e){super(e,0)}};t(nh,"Friendly");ah=nh});var sh,lh,UD=n(()=>{eh();sh=class extends Gp{constructor(e){super(e,1)}};t(sh,"Militaristic");lh=sh});var mh,tm,MD=n(()=>{Zg();mh=class extends Ap{constructor(e){super(e,.5)}};t(mh,"Normal");tm=mh});var ph,Dp,DD=n(()=>{ih();ph=class extends Up{constructor(e){super(e,.5)}};t(ph,"Normal");Dp=ph});var uh,ch,ED=n(()=>{eh();uh=class extends Gp{constructor(e){super(e,.5)}};t(uh,"Normal");ch=uh});var yh,$u,SD=n(()=>{ih();yh=class extends Up{constructor(e){super(e,0)}};t(yh,"Perfectionist");$u=yh});var kD={};lc(kD,{default:()=>nN,registerTraits:()=>FD});var FD,nN,YD=n(()=>{Rv();hR();ID();AD();BD();GD();UD();MD();DD();ED();SD();FD=t((r=xy)=>{[[Za,ah,Dp,us],[Qa,tm,$u,us],[Xa,ah,$u,us],[es,tm,Dp,us],[ts,tm,Dp,us],[rs,tm,Mp,ch],[is,Bp,Mp,us],[os,Bp,$u,us],[ns,tm,Mp,lh],[as,ah,$u,ch],[ss,Bp,Mp,lh],[ls,tm,Mp,us],[ms,Bp,Dp,lh],[ps,Bp,Dp,ch]].forEach(([e,...i])=>i.forEach(o=>r.register(new o(e))))},"registerTraits"),nN=FD});var zD=T(WD=>{"use strict";Object.defineProperty(WD,"__esModule",{value:!0});var aN=(NM(),O(LM)),sN=(_M(),O(HM)),lN=(wD(),O(PD)),mN=(YD(),O(kD));(0,aN.default)();(0,sN.default)();(0,lN.default)();(0,mN.default)()});var fh,dh,xv=n(()=>{A();fh=class extends g{};t(fh,"Yield");dh=fh});var gh,bt,pa=n(()=>{w();Dy();xv();gh=class extends Fb{#e;#t;constructor(e,i=d){super(),this.#e=e,this.#t=i,this.addKey("city","yields")}static build(e,i=d){return new this(e,i)}city(){return this.#e}yields(){return this.#t.process(dh,this).flat()}};t(gh,"Part");bt=gh});var Nt,cs,vv=n(()=>{pa();Nt=class extends bt{};t(Nt,"Fuel");cs=Nt});var jt,Zu,bv=n(()=>{pa();jt=class extends bt{};t(jt,"Habitation");Zu=jt});var hh,rm,Oh=n(()=>{A();hh=class extends g{};t(hh,"ChooseSlot");rm=hh});var Rh,im,Cv=n(()=>{A();Rh=class extends g{};t(Rh,"Active");im=Rh});var LD,xh,vh,Tv=n(()=>{Z();w();Oh();Cv();LD=t((r,e,i)=>e<=r&&r<i,"isBetween"),xh=class extends k{#e=new Map;#t;#r;#i=[];#o;constructor(e,i,o,a=d){super(),this.addKey("activeSlots","height","inactiveSlots","slots","width"),this.#t=e,this.#r=a,this.#o=i,this.#i.push(...o)}activeSlots(){return this.#i.filter(e=>this.#r.process(im,e,this).every(i=>i))}get(e,i){if(e<0||e>=this.#o||i<0||i>=this.#t)return null;let o=[e,i].toString();if(!this.#e.has(o)){let[a]=this.#i.filter(s=>LD(e,s.x(),s.x()+s.width())&&LD(i,s.y(),s.y()+s.height()));this.#e.set(o,a??null)}return this.#e.get(o)}getAdjacent(e){let i=new Set;for(let o=e.x(),a=e.x()+e.width()-1;o<=a;o++){let s=this.get(o,e.y()-1),l=this.get(o,e.y()+e.height());s&&i.add(s),l&&i.add(l)}for(let o=e.y(),a=e.y()+e.height()-1;o<=a;o++){let s=this.get(e.x()-1,o),l=this.get(e.x()+e.width(),o);s&&i.add(s),l&&i.add(l)}return[...i.values()].filter(o=>o!==e)}getFreeSlot(e){let[i]=this.#r.process(rm,e,this);return i??null}height(){return this.#t}inactiveSlots(){return this.#i.filter(e=>this.#r.process(im,e,this).some(i=>!i))}slots(){return this.#i}width(){return this.#o}};t(xh,"Layout");vh=xh});var ir,Qu,Pv=n(()=>{pa();ir=class extends bt{};t(ir,"LifeSupport");Qu=ir});var br,Xu,wv=n(()=>{pa();br=class extends bt{};t(br,"Power");Xu=br});var St,ys,Iv=n(()=>{pa();St=class extends bt{};t(St,"Propulsion");ys=St});var bh,S,ND=n(()=>{Z();bh=class extends k{#e=[];#t;#r=null;#i;#o;#n;constructor(e,i,o,a,s){super(),this.addKey("height","part","width","x","y"),this.#t=o,this.#i=a,this.#o=e,this.#n=i,this.#e.push(...s)}accepts(e){return this.#e.some(i=>e instanceof i)}empty(){return this.#r===null}fill(e){!this.accepts(e)||(this.#r=e)}height(){return this.#t}part(){return this.#r}width(){return this.#i}x(){return this.#o}y(){return this.#n}};t(bh,"Slot");S=bh});var Ct,se,Av=n(()=>{pa();Ct=class extends bt{};t(Ct,"Structural");se=Ct});var Ch,jD,HD=n(()=>{w();vv();bv();Tv();Pv();wv();Iv();ND();Av();Ch=class extends vh{constructor(e=d){super(12,12,[new S(9,0,1,1,[cs]),new S(10,0,1,2,[ys]),new S(1,1,2,2,[Xu]),new S(5,1,2,2,[Xu]),new S(8,1,1,1,[se]),new S(9,1,1,1,[se]),new S(10,1,1,1,[se]),new S(8,2,1,1,[se]),new S(9,2,1,1,[cs]),new S(10,2,1,2,[ys]),new S(0,3,1,1,[se]),new S(1,3,1,1,[se]),new S(2,3,1,1,[se]),new S(3,3,1,1,[se]),new S(4,3,1,1,[se]),new S(5,3,1,1,[se]),new S(6,3,1,1,[se]),new S(7,3,1,1,[se]),new S(8,3,1,1,[se]),new S(9,3,1,1,[cs]),new S(10,3,1,2,[ys]),new S(0,4,2,2,[Qu]),new S(2,4,2,2,[Zu]),new S(4,4,2,2,[Qu]),new S(6,4,2,2,[Zu]),new S(8,4,1,1,[se]),new S(9,4,1,1,[se]),new S(10,4,1,1,[se]),new S(8,5,1,1,[se]),new S(9,5,1,1,[cs]),new S(10,5,1,2,[ys]),new S(0,6,2,2,[Zu]),new S(2,6,2,2,[Qu]),new S(4,6,2,2,[Zu]),new S(6,6,2,2,[Qu]),new S(8,6,1,1,[se]),new S(9,6,1,1,[cs]),new S(10,6,1,2,[ys]),new S(8,7,1,1,[se]),new S(9,7,1,1,[se]),new S(10,7,1,1,[se]),new S(0,8,1,1,[se]),new S(1,8,1,1,[se]),new S(2,8,1,1,[se]),new S(3,8,1,1,[se]),new S(4,8,1,1,[se]),new S(5,8,1,1,[se]),new S(6,8,1,1,[se]),new S(7,8,1,1,[se]),new S(8,8,1,1,[se]),new S(9,8,1,1,[cs]),new S(10,8,1,2,[ys]),new S(1,9,2,2,[Xu]),new S(5,9,2,2,[Xu]),new S(8,9,1,1,[se]),new S(9,9,1,1,[cs]),new S(10,9,1,2,[ys]),new S(8,10,1,1,[se]),new S(9,10,1,1,[se]),new S(10,10,1,1,[se]),new S(9,11,1,1,[cs]),new S(10,11,1,2,[ys])],e)}};t(Ch,"Default");jD=Ch});var Th,Ep,Ph=n(()=>{to();Tv();Th=class extends yb{constructor(){super(vh)}};t(Th,"LayoutRegistry");Ep=new Th});var pN={};var _D=n(()=>{HD();Ph();Ep.register(jD)});var qD=T(KD=>{"use strict";Object.defineProperty(KD,"__esModule",{value:!0});_D()});var wh,Ih,Bv=n(()=>{wh=class{#e=[];constructor(...e){this.#e.push(...e)}isBetween(...e){return e.every(i=>this.#e.includes(i))&&e.length===this.#e.length}players(){return this.#e}};t(wh,"Interaction");Ih=wh});var Ah,VD,JD=n(()=>{fe();Bv();Ah=class extends F{constructor(){super(Ih)}getByPlayer(e){return this.entries().filter(i=>i.players().includes(e))}getByPlayers(...e){return this.entries().filter(i=>i.isBetween(...e))}};t(Ah,"InteractionRegistry");VD=new Ah});var Sp,$D=n(()=>{Bv();Sp=class extends Ih{constructor(...e){let i=e.map(o=>o.player());super(...i)}};t(Sp,"Contact")});var ZD=n(()=>{$D()});var uN,QD,XD=n(()=>{JD();Ve();ZD();I();v();At();uN=t((r=VD,e=j)=>[new q(new m(i=>i.tile().getNeighbours().some(o=>e.getByTile(o).some(a=>a.player()!==i.player()))),new p(i=>i.tile().getNeighbours().forEach(o=>e.getByTile(o).filter(a=>a.player()!==i.player()).forEach(a=>r.register(new Sp(i,a))))))],"getRules"),QD=uN});var cN={};var eE=n(()=>{w();XD();d.register(...QD())});var rE=T(tE=>{"use strict";Object.defineProperty(tE,"__esModule",{value:!0});eE()});var Bh,Gh,Gv=n(()=>{Bh=class{#e;#t;#r;constructor(e,i,o){this.#e=e,this.#t=i,this.#r=o}civilizationType(){return this.#e}mapGenerator(){return this.#t}startTile(){return this.#r}startTileForMap(e){let{x:i,y:o}=this.#r;return e.get(i,o)}};t(Bh,"CivilizationStartTile");Gh=Bh});var yN,Gn,Uv=n(()=>{yN=t((r,e,i,o)=>{for(;i<0;)i+=e;for(;o<0;)o+=r;return i=i%e,o=o%r,o*e+i},"coordsToIndex"),Gn=yN});var fN,om,Uh=n(()=>{fN=t((r,e,i)=>{let o=r*e;for(;i<0;)i+=o;return i=i%o,[i%e,Math.floor(i/e)]},"indexToCoords"),om=fN});var dN,iE,oE=n(()=>{Uh();dN=t((r,e,i,o)=>{let[a,s]=om(r,e,i),[l,u]=om(r,e,o),c=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[y]=c.map(([f,h])=>[f*e,h*r]).map(([f,h])=>[a-l+f,s-u+h]).map(f=>Math.hypot(...f)).sort((f,h)=>f-h);return y},"distanceFrom"),iE=dN});var gN,nm,Mv=n(()=>{Uv();Uh();gN=t((r,e,i,o=!0)=>{let[a,s]=om(r,e,i),l=Gn(r,e,a,s-1),u=Gn(r,e,a+1,s-1),c=Gn(r,e,a+1,s),y=Gn(r,e,a+1,s),f=Gn(r,e,a,s+1),h=Gn(r,e,a-1,s+1),G=Gn(r,e,a-1,s),D=Gn(r,e,a-1,s-1);return o?[l,c,f,G]:[l,u,c,y,f,h,G,D]},"getNeighbours"),nm=gN});var Fp,Mh,Dh=n(()=>{Uv();oE();Mv();Uh();Fp=class{#e;#t;#r;constructor(e,i,o={}){this.#e=e,this.#t=o,this.#r=i}coordsToIndex(e,i){return Gn(this.#e,this.#r,e,i)}distanceFrom(e,i){return iE(this.#e,this.#r,e,i)}generate(){throw new Error(`Generator#generate(): Must be overridden in '${this.constructor.name}'.`)}getNeighbours(e,i=!0){return nm(this.#e,this.#r,e,i)}height(){return this.#e}indexToCoords(e){return om(this.#e,this.#r,e)}options(){return this.#t}width(){return this.#r}};t(Fp,"Generator");Mh=Fp});var hN,Eh,kp,Sh=n(()=>{nx();ax();od();Dh();Jm();sx();lx();mx();px();bu();ld();ux();cx();hN={A:sT,D:lT,F:id,G:al,H:mT,J:pT,M:uT,O:cT,P:qm,R:sd,S:yT,T:fT},Eh=class extends Mh{async generate(){return Array.from(`OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOAAAAAAAOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOAAOAOAAAOAAAAAAAAOOOOOOAOOOOOGGOOOOOTAGOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOTTTTAOOOOAAAAAAAAOOOOAAAAAATOOOOOAAOOOOOOOOOOOOOOOAAOOOOOTOOOOOOOOOOOOOOOOOO
OOOTTTTTTTTTAAOAOAAAAAOOOAAAAATOOOOOOOOOOOOOOOAOOOOOFFAAFFFFFOOFFFOOOOFFFOOOOOOO
OTPTGPPPPTTTTTOTAAAOOAOOOAAAATOOOOOOOOOOOOOOOAOOAAOFFGAFFFFFFFAFFFFFFFFFFOTOOOOO
OOOOOPGTPTOOTTAAAAAAAAOOAAGGOOOOOOOOOOGAAOOOOOOGOGFFFGFFFFFFFFAFFAFFFFFGFGGOOOOO
OOOOOGGFGPPTTAAOOOAOTOOOAGOOOOAOOOOOOAFGFPGFOAAFGTGFFFFFFFFFFFFFFFGFFGOGFFOOOOOO
OOOOPMGFPPPPTTOOOATAAOOOOOOOOOOOOOOOGFPGGFOFFFFFFGFFFFFFFFFFFFFFGFFFFGOOFOOOOOOO
OOOOPMGFGPPOTTTAATTTTOOOOOOOOOOHOOOPFGOGGGFFFGFGGGFFFFFFFFFFFFFFFFFFOOOOFGOOOOOO
OOOOPHFFGPGOPPPOPTTTTOOOOOOOOOGROOOOOPOGFGFFGFFFGFGFGGFGGFFFGFFFFFFFGOOOOPOOOOOO
OOOOGGHFGPPPPPPPPPTPPOOOOOOOOOOFOOOFOOOFFFRFFFFRGFPFFPFGPFGFFOFFFFFGPPGOOOOOOOOO
OOOGGGMGGGPPPOPPPPPOPOOOOOOOOOGGOOOGPPFFFGRRFRRRGGFGGGGGPGGFFFFDPPPPPPOOOOOOOOOO
OOOGGFMGRGRPGORRGOPOOOOOOOOOOOOOOGRGGGGFFGFRFRPGPGGGGGPPPPPPPPPPPPPPGPGOOOOOOOOO
OOGGGMMGRGRGGGGOOOOOOOOOOOOOOOOOGGRMMGGGGPGRPRRPPPPPPPPPPPPPPPPPPPPPGPGOPGOOOOOO
OOGGPPHGRRRGGGOOOOOOOOOOOOOOOOOOPGGGGFGRRGPRPDOOPPOPPPDPDDDPPPPPPDPPPGOOGOOOOOOO
OOGFPPFGGRGGGPOOOOOOOOOOOOOOOOPPPPOGHOOGRFOOOHPOGPPDPDPDDPPPPPPDDPPOPGOOMGOOOOOO
OOGPPDDGGRGGOOOOOOOOOOOOOOOOOOPPPOOOGHOOOGPPPPPOPPPPDPPHPDDDDDDPPPGOOOOOOPOOOOOO
OOPOGDDPOOOPOOOOOOOOOOOOOOOOOOOOOOOOOGOOOOOPPPPGPPPPPPHHMHHHHHHHHMHPGOOGOOOOOOOO
OOPOGDDOOOOPOOOOOOOOOOOOOOOOOOGPPDDOOOOOOOOPPRRHPPPDPPHPGHMMMMMHHHPPPGOOOOOOOOOO
OOOOGDGOOOOOOOOOOOOOOOOOOOOOOODPHHPPPGODPOPPPGRRPPPPPHHRDPGMHHMHHPPRRROOOOOOOOOO
OOOOGGPOPOOOGPOOOOOOOOOOOOOOOPPHDDDPPPPDDRGDPPDOPPPPHPRRDGGGHHHHHPGPPPOOOOOOOOOO
OOOOOGGPGOOOOGPOOOOOOOOOOOOOPPDDDDDPDDDDDRDOPDDOOOOHHRRDPGGRGGGHGPGGPOOOOOOOOOOO
OOOOOOOOGGOOOOOOOOOOOOOOOOOOPDDDDDDDDDDDSRSODDDDDDOOOOPPGGGRRPPGFGGGOOOGOOOOOOOO
OOOOOOOOOGOOOOOOOOOOOOOOOOOPDDDDDDPPPDDDDRDOOPDDDDPOOOOGGGGGOOGGGGGOOOOPGOOOOOOO
OOOOOOOOOPPOGPPGOOOOOOOOOOODDDDDDDPDDDDDDRDDOODDDDOOOOOOGGGOOOPPGGOOOOOGGOOOOOOO
OOOOOOOOOOPGFPPPGOOOOOOOOOODDDDDDDDPDPDPPDHHDOOPDOOOOOOOGGOOOOOGGGGOOOOOFGOOOOOO
OOOOOOOOOOOGHGGGGGGOOOOOOOOPPDPPPPDDDPPPPPPMDPOOGOOOOOOOPGOOOOOOOGGOOOOOOGOOOOOO
OOOOOOOOOOOHJJJGGGGROOOOOOOOPPDPPPPPPPPPPPPHMDPOOOOOOOOOOGOOOOOOOOOOOPOOOOOOOOOO
OOOOOOOOOOGHJRRJJRRRGOOOOOOOOPPPGOPPGPGGGGGGMDDPOOOOOOOOOOOOOOOOOOOGPPOOGPOOOOOO
OOOOOOOOOOPGJJRRRRJGFGGOOOOOOOOOOOOGGGGJJJGGODPPOOOOOOOOOOOOOOOGFGOOPGFGGGOGOOOO
OOOOOOOOOOOFGGJJGJJFGGGPOOOOOOOOOOOGGJJRRRGGHPPOOOOOOOOOOOOOOOOOGFOOGOPGOOOPGGOO
OOOOOOOOOOOGHGGGGGGGGGGOOOOOOOOOOOOGGRRRJJHOGGOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOGGO
OOOOOOOOOOOOGMFGGGGGGPOOOOOOOOOOOOOOGRJJJGHMGOOOOOOOOOOOOOOOOOOOOPPOOOOOGOOOOOOO
OOOOOOOOOOOOGFMGGFGPPPOOOOOOOOOOOOOORRGGGGGMPOOOOOOOOOOOOOOOOOOOOOGOOOOOOOPGOOOO
OOOOOOOOOOOOOOHMGGRPGGOOOOOOOOOOOOOOOGGGGGGHGOOOOOOOOOOOOOOOOOOOOOOOOOOGGPGPGGOO
OOOOOOOOOOOOOOGHGGRGGOOOOOOOOOOOOOOOODPPGGGGGGOOOOOOOOOOOOOOOOOOOOOOOOOGGPPPPGOO
OOOOOOOOOOOOOOGMGPRROOOOOOOOOOOOOOOOPPPPPPPGGGOPOOOOOOOOOOOOOOOOOOOOGGPPPDDDPPPO
OOOOOOOOOOOOOOGMGGGPOOOOOOOOOOOOOOOOHPDDPPGGOOOPOOOOOOOOOOOOOOOOOOOGGGPDDDDDDPFO
OOOOOOOOOOOOOOPMGGGOOOOOOOOOOOOOOOOOOPPDPPGGOOOGOOOOOOOOOOOOOOOOOOOGPDDDDDDDDPPO
OOOOOOOOOOOOOOOMGPOOOOOOOOOOOOOOOOOOOHPPPGGGOOGPOOOOOOOOOOOOOOOOOOOGDDDDDPDDDPGO
OOOOOOOOOOOOOOOGGOOOOOOOOOOOOOOOOOOOOHPPGHGOOOPOOOOOOOOOOOOOOOOOOOODDDDDDDPDDHFO
OOOOOOOOOOOOOOOPGOOOOOOOOOOOOOOOOOOOOODPGHGOOOOOOOOOOOOOOOOOOOOOOOODDDOOGDDDHGOO
OOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOPGGGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOGHHHGOOO
OOOOOOOOOOOOOOOOFOOOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOPGOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
`.replace(/\n/g,"")).map(e=>new hN[e])}height(){return 50}width(){return 80}};t(Eh,"Earth");kp=Eh});var Fh,nE,aE=n(()=>{Gv();Sh();Fh=class extends Gh{constructor(e,i){super(e,kp,i)}};t(Fh,"EarthStartTile");nE=Fh});var ec,LGe,sE,lE=n(()=>{Gv();fe();ec=class extends Os{constructor(){super(Gh)}getByCivilization(e){let[i]=this.getBy("civilizationType",e);if(!i)throw new TypeError(`${e.name} does not have a registered start tile.`);return i}getStartTileByCivilizationAndWorld(e,i){return this.getByCivilization(e).startTileForMap(i)}};t(ec,"CivilizationStartTileRegistry");LGe=new ec,sE=ec});var kh,Yh,Dv=n(()=>{lE();Sh();kh=class extends sE{entries(){return super.entries().filter(e=>e.mapGenerator()===kp)}};t(kh,"EarthStartTileRegistry");Yh=new kh});var ON={};var mE=n(()=>{hv();aE();Dv();Yh.register(...[[Fa,{x:12,y:18}],[ka,{x:5,y:23}],[Ya,{x:45,y:22}],[Wa,{x:66,y:19}],[za,{x:41,y:24}],[La,{x:31,y:14}],[Na,{x:33,y:16}],[ja,{x:38,y:15}],[Ha,{x:39,y:18}],[_a,{x:57,y:26}],[Ka,{x:49,y:19}],[qa,{x:36,y:19}],[Va,{x:44,y:12}],[Ja,{x:42,y:42}]].map(([r,e])=>new nE(r,e)))});var uE=T(pE=>{"use strict";Object.defineProperty(pE,"__esModule",{value:!0});mE()});var RN,cE,yE=n(()=>{I();v();zR();RN=t(()=>[new js(new m(r=>r<252),new p(r=>r*20-4020)),new js(new m(r=>r>251),new m(r=>r<302),new p(r=>(r-151)*10+1e3)),new js(new m(r=>r>301),new m(r=>r<352),new p(r=>(r-201)*5+1500)),new js(new m(r=>r>351),new m(r=>r<402),new p(r=>(r-251)*2+1750)),new js(new m(r=>r>401),new p(r=>r-301+1850))],"getRules"),cE=RN});var xN={};var fE=n(()=>{w();yE();d.register(...cE())});var gE=T(dE=>{"use strict";Object.defineProperty(dE,"__esModule",{value:!0});fE()});var vN,hE,OE=n(()=>{dR();qe();yo();We();gx();I();v();Yl();Nm();ba();vN=t((r=L,e=N)=>[new Hl(new m((i,o)=>r.getByPlayer(o.player()).available().length>0),new p((i,o)=>new Ts(i,o))),new Hl(new m(i=>[Re,pe,ae].some(o=>i.tile().terrain()instanceof o)),new m((i,o)=>i.tile().getSurroundingArea().score(null,[[on,8],[xa,3],[va,1]])>=150),new m(i=>i.tile().getSurroundingArea(4).every(o=>e.getByTile(o)===null)),new p((i,o)=>new ws(i,o))),new Hl(new p((i,o)=>new Gs(i,o))),new Hl(new p((i,o)=>new Us(i,o)))],"getRules"),hE=vN});var bN,RE,xE=n(()=>{V();hx();v();bN=t((r=b)=>[new Rd(new p((e,i)=>{r.emit("goody-hut:action-performed",e,i)}))],"getRules"),RE=bN});var CN,vE,bE=n(()=>{V();fl();Ox();v();CN=t((r=Jr,e=b,i=()=>Math.random())=>[new op(new p(o=>r.unregister(o))),new op(new p((o,a)=>{let s=o.actions(a),l=s[Math.floor(s.length*i())];o.action(l)})),new op(new p((o,a)=>{e.emit("goody-hut:discovered",o,a)}))],"getRules"),vE=CN});var Wh,Yp,Ev=n(()=>{A();Wh=class extends g{};t(Wh,"Distribution");Yp=Wh});var TN,CE,TE=n(()=>{fl();I();Ev();TN=t((r=Jr,e=()=>Math.random())=>[new Yp(new m(i=>i.isLand())),new Yp(new m(i=>i.getSurroundingArea(3).every(o=>r.getByTile(o)===null))),new Yp(new m(()=>e()<.05))],"getRules"),CE=TN});var PN,PE,wE=n(()=>{fl();zo();w();v();fR();PN=t((r=Jr,e=()=>Math.random(),i=d)=>[new gy(new p((o,a)=>{let s=[Fr,kr],l=s[Math.floor(s.length*e())];return new l(null,a.player(),a.tile(),i)}))],"getRules"),PE=PN});var wN,IE,AE=n(()=>{fl();I();v();At();wN=t((r=Jr)=>[new q(new m(e=>r.getByTile(e.tile())!==null),new p(e=>{r.getByTile(e.tile()).process(e)}))],"getRules"),IE=wN});var zh,hl,Lh=n(()=>{A();zh=class extends g{};t(zh,"Built");hl=zh});var IN,BE,GE=n(()=>{fl();w();Lh();v();Rx();Ev();IN=t((r=Jr,e=d)=>[new hl(new p(i=>{let o=e.get(Yp);i.forEach(a=>{o.every(s=>s.validate(a))&&r.register(new bd(a))})}))],"getRules"),BE=IN});var AN={};var UE=n(()=>{OE();xE();bE();TE();wE();w();AE();GE();d.register(...hE(),...RE(),...vE(),...CE(),...PE(),...IE(),...BE())});var DE=T(ME=>{"use strict";Object.defineProperty(ME,"__esModule",{value:!0});UE()});var BN={};var EE=n(()=>{Bn();Bd();np.register(Ut,ut,tr,ct,xt)});var GN,SE,FE=n(()=>{gn();Bn();I();v();UR();en();GN=t((r=Ot)=>[new Xe(new m(e=>!r.getByPlayer(e).is(zi)),new p(e=>[new Ws(e,r.getByPlayer(e))]))],"getRules"),SE=GN});var UN,kE,YE=n(()=>{Bd();gn();w();Fl();Bn();v();Tl();Cx();UN=t((r=np,e=Ot,i=d)=>[new Oi(new Yn,new p(o=>{let a=new Dd(o,r,i);a.set(new tr),e.register(a)}))],"getRules"),kE=UN});var MN,WE,zE=n(()=>{Ur();Bn();We();vx();I();MN=t((r=L)=>[new Pu(new m(e=>e===tr)),...[[Ut,Bt],[ut,Ro],[ct,Xr],[xt,Yi]].map(([e,i])=>new Pu(new m(o=>o===e),new m((o,a)=>r.getByPlayer(a).completed(i))))],"getRules"),WE=MN});var DN,LE,NE=n(()=>{V();Kr();bx();I();v();DN=t((r=b,e=ee)=>[new wu(new p((i,o)=>{r.emit("player:government:changed",i,o)})),new wu(new m(i=>{try{return e.getByPlayer(i),!0}catch(o){if(o instanceof TypeError&&o.message.match(/Wrong number of player worlds exist/))return!1;throw o}}),new p(i=>{e.getByPlayer(i).entries().forEach(a=>a.tile().clearYieldCache(i))}))],"getRules"),LE=DN});var EN={};var jE=n(()=>{w();FE();YE();zE();NE();d.register(...SE(),...kE(),...WE(),...LE())});var _E=T(HE=>{"use strict";Object.defineProperty(HE,"__esModule",{value:!0});EE();jE()});var Nh,KE,qE=n(()=>{A();Nh=class extends g{};t(Nh,"TurnEnd");KE=Nh});var SN,VE,JE=n(()=>{zm();V();w();qE();SN=t((r=rn,e=d,i=b)=>[["player:turn-end",o=>{r.unregister(o),e.process(KE,o);let[a]=r.entries();if(!a){i.emit("turn:end");return}i.emit("player:turn-start",a)}]],"getEvents"),VE=SN});var FN,$E,ZE=n(()=>{Kl();V();w();Vu();FN=t((r=Lo,e=b,i=d)=>[["player:turn-start",o=>{i.process(ma,o),r.getByPlayer(o).takeTurn().catch(s=>console.error(s)).finally(()=>{e.emit("player:turn-end",o)})}]],"getEvents"),$E=FN});var kN,QE,XE=n(()=>{zm();V();Ns();kN=t((r=vi,e=rn,i=b)=>[["turn:start",()=>{e.register(...r.entries());let[o]=e.entries();i.emit("player:turn-start",o)}]],"getEvents"),QE=kN});var YN={};var e0=n(()=>{V();JE();ZE();XE();[...VE(),...$E(),...QE()].forEach(([r,e])=>b.on(r,e))});var jh,ua,tc=n(()=>{A();jh=class extends g{};t(jh,"Defeated");ua=jh});var WN,t0,r0=n(()=>{qe();w();wl();I();tc();v();WN=t((r=N,e=d)=>[new lr(new m((i,o,a)=>r.getByPlayer(a).filter(s=>s!==i).length===0),new p((i,o,a)=>{e.process(ua,a,o)}))],"getRules"),t0=WN});var zN,i0,o0=n(()=>{qe();w();I();tc();Il();v();zN=t((r=N,e=d)=>[new Cr(new m((i,o)=>r.getByPlayer(i.player()).filter(a=>a!==i).length===0),new p((i,o)=>e.process(ua,i.player(),o)))],"getRules"),i0=zN});var Sv,LN,n0,a0=n(()=>{en();I();v();Ny();vs();Sv=new Xe(new _r(9001),new m(r=>{Sv.disable();let e=r.mandatoryActions();return Sv.enable(),e.length===0}),new p(r=>[new Ly(r,null)])),LN=t(()=>[Sv],"getRules"),n0=LN});var NN,s0,l0=n(()=>{V();Fl();v();NN=t((r=b)=>[new Oi(new p(e=>{r.emit("player:added",e)}))],"getRules"),s0=NN});var jN,m0,p0=n(()=>{zm();V();Ns();I();tc();v();jN=t((r=rn,e=vi,i=b)=>[new ua(new m(o=>r.includes(o)),new p(o=>r.unregister(o))),new ua(new m(o=>e.includes(o)),new p(o=>e.unregister(o))),new ua(new p((o,a)=>{i.emit("player:defeated",o,a)}))],"getRules"),m0=jN});var Hh,_h,Fv=n(()=>{A();Hh=class extends g{};t(Hh,"Spawn");_h=Hh});var HN,u0,c0=n(()=>{w();v();cv();Fv();HN=t((r=d)=>[new _h(new p((e,i)=>{new yw(null,e,i,r)}))],"getRules"),u0=HN});var _N,y0,f0=n(()=>{qe();w();Ve();v();Yl();Tl();Cp();Nm();ba();Vu();mo();_N=t((r=d,e=N,i=j)=>[new ma(new Yn,new p(o=>{e.getByPlayer(o).forEach(a=>{let s=a.yields();Wl(s,on,xa,va).reduce((l,u,c)=>(l[c].set(u,"Consolidated"),l),[new on(0,"Consolidated"),new xa(0,"Consolidated"),new va(0,"Consolidated")]).forEach(l=>r.process(jo,l,a,s))})})),new ma(new p(o=>i.getByPlayer(o).forEach(a=>{if(a.destroyed())return;a.moves().set(a.movement());let s=a.busy();if(!s){a.setActive(),a.setWaiting(!1);return}!s.validate()||s.process()})))],"getRules"),y0=_N});var KN,d0,g0=n(()=>{V();v();GR();KN=t((r=b)=>[new Xy(new p((e,i)=>{r.emit("player:visibility-changed",e,i)}))],"getRules"),d0=KN});var qN,h0,O0=n(()=>{Ns();Kr();kf();v();qN=t((r=vi,e=ee)=>[new Pa(new p(i=>{i.clearYieldCache(null),r.forEach(o=>{e.getByPlayer(o).getByTile(i)!==null&&i.clearYieldCache(o)})}))],"getRules"),h0=qN});var VN,R0,x0=n(()=>{qe();w();I();tc();au();v();VN=t((r=N,e=d)=>[new tn(new m((i,o)=>r.getByPlayer(i.player()).length===0),new p((i,o)=>e.process(ua,i.player(),o)))],"getRules"),R0=VN});var JN,v0,b0=n(()=>{Kr();v();FR();JN=t((r=ee)=>[new cf(new p((e,i)=>{e.clearYieldCache(i);let o=r.getByPlayer(i);o.register(e),o.getByTile(e).update()}))],"getRules"),v0=JN});var Kh,qh,kv=n(()=>{A();Kh=class extends g{};t(Kh,"PickStartTile");qh=Kh});var $N,C0,T0=n(()=>{Ov();Kl();V();Ns();Kr();w();Lh();v();Yl();Jm();kv();bu();tf();Nm();ld();ba();Fv();$N=t((r=Jg,e=Lo,i=b,o=vi,a=ee,s=d,l=()=>Math.random())=>[new hl(new p(u=>o.entries().forEach(c=>a.register(new Um(c,u))))),new hl(new p(u=>{let c=new Map,y=new Map,f=t((B,E=null)=>(c.has(B)||c.set(B,B.score(E,[[on,8],[xa,3],[va,1]])),c.get(B)),"tileScore"),h=t((B,E=null)=>(y.has(B)||y.set(B,B.getSurroundingArea().entries().reduce((Y,ce)=>Y+f(ce,E),0)),y.get(B)),"areaScore");i.emit("world:generate-start-tiles");let G=[],D=u.entries().filter(B=>[al,qm,sd].some(E=>B.terrain()instanceof E)).map(B=>({tile:B,score:h(B)})).sort(({score:B},{score:E})=>E-B).map(({tile:B})=>B);i.emit("world:start-tiles",D),e.entries().reduce((B,E)=>B.then(async()=>{let Y=E.player();await E.chooseCivilization(r.entries()),r.unregister(Y.civilization().sourceClass());let[ce]=s.process(qh,u,Y,G);if(!ce)throw new TypeError("Not enough `startingSquare`s.");G.push(ce),s.process(_h,Y,ce)}),Promise.resolve()).then(()=>i.emit("game:start"))})),new hl(new p(u=>{i.emit("world:built",u)}))],"getRules"),C0=$N});var ZN={};var P0=n(()=>{r0();o0();w();a0();l0();p0();c0();f0();g0();O0();x0();b0();T0();d.register(...t0(),...i0(),...n0(),...s0(),...m0(),...u0(),...y0(),...d0(),...h0(),...R0(),...v0(),...C0())});var I0=T(w0=>{"use strict";Object.defineProperty(w0,"__esModule",{value:!0});e0();P0()});var QN={};var A0=n(()=>{Ur();U();R.register(ta,fo,Ai,ra,Qt,Bi,go,ho,Gi,hn,Ba,wr,On,Bt,Ui,Ga,Zr,Oo,Mi,Ro,Ir,Rt,Rn,xn,ia,oa,Ua,vn,yr,Ma,fr,Ar,bn,Da,Br,Qr,xo,Xt,Gr,Di,Ei,Cn,Xr,er,Si,ei,vo,ti,Fi,Tn,Pn,ri,wn,ki,Gt,In,na,bo,aa,sa,Co,Yi,Sa,To,An,dr,Wi)});var B0=n(()=>{RR()});var XN,G0,U0=n(()=>{We();en();B0();I();v();XN=t((r=L)=>[new Xe(new m(e=>r.getByPlayer(e).researching()===null),new m(e=>r.getByPlayer(e).available().length>0),new p(e=>[new Ml(e,r.getByPlayer(e))]))],"getRules"),G0=XN});var ej,M0,D0=n(()=>{U();We();w();Fl();v();Mc();ej=t((r=R,e=L,i=d,o=()=>Math.random())=>[new Oi(new p(a=>e.register(new ym(a,r,i)))),new Oi(new p(a=>{let s=e.getByPlayer(a);for(let l=0,u=Math.min(s.available().length,Math.floor(4*o()));l<u;l++){let c=s.available();s.addAdvance(c[Math.floor(o()*c.length)])}}))],"getRules"),M0=ej});var tj,E0,S0=n(()=>{We();wl();v();I();tj=t((r=L,e=()=>Math.random())=>[new lr(new m((i,o,a)=>r.getByPlayer(a).complete().some(s=>!r.getByPlayer(o).completed(s.constructor))),new p((i,o,a)=>{let s=r.getByPlayer(o),l=r.getByPlayer(a).complete().filter(u=>!s.completed(u.constructor));s.addAdvance(l.map(u=>u.constructor)[Math.floor(e()*l.length)])}))],"getRules"),E0=tj});var rj,F0,k0=n(()=>{V();Tc();v();rj=t((r=b)=>[new bs(new p((e,i)=>{r.emit("player:research-complete",e,i)}))],"getRules"),F0=rj});var ij,Y0,W0=n(()=>{iR();v();ij=t(()=>[new wc(new p((r,e)=>(e.complete().length+1)*(6+2*0)))],"getRules"),Y0=ij});var oj,z0,L0=n(()=>{We();w();Zl();I();v();Cp();Lg();oj=t((r=L,e=d)=>[new jo(new m(i=>i instanceof Vt),new m((i,o,a)=>!e.process(No,o,a).some(s=>s)),new p((i,o)=>r.getByPlayer(o.player()).add(i)))],"getRules"),z0=oj});var nj,N0,j0=n(()=>{Ur();I();v();oR();nj=t(()=>[...[[ta,oa,Ir],[Ai,Di,er],[ra,To,Fi],[Qt,On,sa],[Bi,Yi,An],[go,Zr,bn],[hn,dr,Ei],[Ba,ia,Ma],[wr,fo],[On,ki,xn],[Bt,ti,fr],[Ui,Rt,Di],[Ga,xn,Yi],[Zr,Mi,Xt],[Oo,Bi,fr],[Mi,ho],[Ro,ti,Br],[Ir,Cn,Qr],[Rt,Rn,Ir],[Rn,Zr,Sa],[xn,yr,hn],[ia,Xt,Xr],[oa,On,Fi],[Ua,vo,Co],[vn,Oo,Ei],[yr,Ar,bn],[fr,ri,Bi],[Ar,Rn,Br],[bn,ho],[Da,Gr,Bt],[Br,wr,Wi],[Qr,Si,Fi],[xo,fo],[Gr,Oo,Qt],[Di,fo,Xt],[Ei,ti,An],[Cn,yr,dr],[Xr,wr,er],[er,Gi],[Si,Ai,xo],[ei,Gr,ra],[vo,ei,Rt],[ti,er,Br],[Fi,Si,Di],[Tn,ki,bo],[ri,go,aa],[wn,Ro,Gr],[ki,Oo,hn],[Gt,ti,Wi],[In,Ui,Tn],[na,Rt,ta],[bo,Ui,na],[aa,Ar,Fi],[sa,Cn,fr],[Co,Gr,Tn],[Yi,wr,Br],[To,Ai,dr],[An,wr,Mi],[dr,ti,Di],[Wi,fo]].map(([r,...e])=>new Ac(new m(i=>i===r),new p((i,o)=>e.every(a=>o.some(s=>s instanceof a)))))],"getRules"),N0=nj});var aj,H0,_0=n(()=>{V();v();Gc();aj=t((r=b)=>[new cm(new p((e,i)=>{r.emit("player:research",e,i)}))],"getRules"),H0=aj});var sj={};var K0=n(()=>{U0();D0();S0();k0();W0();w();L0();j0();_0();d.register(...G0(),...M0(),...E0(),...F0(),...Y0(),...z0(),...N0(),...H0())});var V0=T(q0=>{"use strict";Object.defineProperty(q0,"__esModule",{value:!0});A0();K0()});var fs=n(()=>{vv();bv();Pv();wv();Iv();Av()});var lj={};var J0=n(()=>{fs();Bl();io.register(Nt,jt,ir,br,St,Ct)});var Vh,Jh,Yv=n(()=>{A();Vh=class extends g{};t(Vh,"Built");Jh=Vh});var $h,Zh,Wv=n(()=>{A();$h=class extends g{};t($h,"ChanceOfSuccess");Zh=$h});var Qh,Xh,zv=n(()=>{A();Qh=class extends g{};t(Qh,"FlightTime");Xh=Qh});var eO,tO,Lv=n(()=>{A();eO=class extends g{};t(eO,"Landed");tO=eO});var rO,$0,Z0=n(()=>{A();rO=class extends g{};t(rO,"Launch");$0=rO});var iO,rc,Nv=n(()=>{A();iO=class extends g{};t(iO,"Lost");rc=iO});var oO,Wp,nO=n(()=>{Z();w();Yt();Yv();Wv();Oh();zv();Lv();Z0();Nv();oO=class extends k{#e=!1;#t;#r;#i;#o;#n=null;#a;constructor(e,i,o=d,a=ie,s=()=>Math.random()){super(),this.#r=e,this.#t=i,this.#o=o,this.#a=a,this.#i=s,this.addKey("activeParts","chanceOfSuccess","flightTime","inactiveParts","launched","layout","player","successful","yields")}activeParts(){return this.#t.activeSlots().filter(e=>!e.empty()).map(e=>e.part())}add(e){let[i]=this.#o.process(rm,e,this.#t);!i||(i.fill(e),this.#o.process(Jh,e,this))}chanceOfSuccess(){return Math.max(...this.#o.process(Zh,this),0)}check(){if(!(this.#n!==null||this.#e===!1||this.#e+this.flightTime()<this.#a.value())){if(this.#n=this.chanceOfSuccess()>this.#i(),this.#n){this.#o.process(tO,this);return}this.#o.process(rc,this)}}flightTime(){return Math.min(...this.#o.process(Xh,this),1/0)}inactiveParts(){return this.#t.inactiveSlots().filter(e=>!e.empty()).map(e=>e.part())}launch(){this.#o.process($0,this),this.#e=this.#a.value()}launched(){return this.#e}layout(){return this.#t}player(){return this.#r}successful(){return this.#n}yields(){return this.activeParts().flatMap(e=>e.yields())}};t(oO,"Spaceship");Wp=oO});var aO,Ho,am=n(()=>{fe();nO();aO=class extends F{constructor(){super(Wp)}getActiveByPlayer(e){let[i]=this.getBy("player",e).filter(o=>o.launched()===!1||o.successful()===null);return i||null}};t(aO,"SpaceshipRegistry");Ho=new aO});var sO,yt,Un=n(()=>{fe();Be();sO=class extends F{constructor(){super(Oe)}getByCity(e){return this.getBy("city",e)}getByPlayer(e){return this.filter(i=>i.city().player()===e)}};t(sO,"WonderRegistry");yt=new sO});var Mn,lO,mO=n(()=>{Be();Mn=class extends Te{};t(Mn,"ApolloProgram");lO=Mn});var mj,Q0,X0=n(()=>{Tm();fs();We();am();Un();mO();I();v();pa();mg();ku();yg();mj=t((r=yt,e=L,i=Ho)=>[new mt(new m((o,a)=>Object.prototype.isPrototypeOf.call(bt,a)),new p(()=>new m(()=>r.some(o=>o instanceof lO)))),new mt(new m((o,a)=>Object.prototype.isPrototypeOf.call(bt,a)),new p(o=>new m(()=>{let a=i.getActiveByPlayer(o.player());return a===null?!1:a.launched()===!1}))),...[[Ct,cg],[Nt,Fu],[St,Fu],[jt,Ea],[ir,Ea],[br,Ea]].map(([o,a])=>new mt(new m((s,l)=>l===o),new p(s=>new m(()=>e.getByPlayer(s.player()).completed(a)))))],"getRules"),Q0=mj});var pj,eS,tS=n(()=>{Pm();fs();pj=t(()=>[...[[Nt,160],[jt,320],[ir,320],[br,320],[St,160],[Ct,80]].flatMap(([r,e])=>Is(r,e))],"getRules"),eS=pj});var uj,rS,iS=n(()=>{zm();Ph();w();am();Yt();mO();wm();I();v();pa();nO();uj=t((r=rn,e=Ho,i=Ep,o=d,a=ie,s=()=>Math.random())=>[new gi(new m((l,u)=>u instanceof lO),new p(()=>{let[l]=i.entries(),u=new l(o);r.entries().forEach(c=>e.register(new Wp(c,u,o,a,s)))})),new gi(new m((l,u)=>u instanceof bt),new m((l,u)=>e.getActiveByPlayer(u.city().player())!==null),new p((l,u)=>{let c=u;e.getActiveByPlayer(c.city().player()).add(c)}))],"getRules"),rS=uj});var pO,Ol,jv=n(()=>{Z();pO=class extends ve{#e;#t;constructor(e,i){super(),this.addKey("resource","value"),this.#e=e,this.#t=i}resource(){return this.#e}value(){return this.#t}};t(pO,"SpendCost");Ol=pO});var cj,oS,nS=n(()=>{I();v();Bs();pa();$p();jv();cj=t(()=>[new oo(new m(r=>r.building()!==null&&Object.isPrototypeOf.call(bt,r.building().item())),new m(r=>r.progress().value()===0),new p(r=>new Ol(no,r.remaining()*8))),new oo(new m(r=>r.building()!==null&&Object.isPrototypeOf.call(bt,r.building().item())),new m(r=>r.progress().value()>0),new p(r=>new Ol(no,r.remaining()*4)))],"getRules"),oS=cj});var yj,aS,sS=n(()=>{am();en();I();v();IR();yj=t((r=Ho)=>[new Xe(new m(e=>r.getActiveByPlayer(e)!==null),new p(e=>[new Wb(e,r.getActiveByPlayer(e))]))],"getRules"),aS=yj});var Hv,fj,lS,mS=n(()=>{fs();Cv();I();v();Hv=new im(new m(r=>r.part()instanceof St),new p((r,e)=>{Hv.disable();let i=e.activeSlots();return Hv.enable(),e.getAdjacent(r).some(o=>o.part()instanceof Nt&&i.includes(o))})),fj=t(()=>[new im(new p(r=>r.part()!==null)),new im(new m(r=>[Nt,jt,ir,br].some(e=>r.part()instanceof e)),new p((r,e)=>e.getAdjacent(r).some(i=>i.part()instanceof Ct))),Hv],"getRules"),lS=fj});var dj,pS,uS=n(()=>{V();Yv();v();dj=t((r=b)=>[new Jh(new p(e=>{r.emit("player:spaceship:part-built",e.city().player())}))],"getRules"),pS=dj});var Dn,cS=n(()=>{De();Dn=class extends W{};t(Dn,"Energy")});var ca,yS=n(()=>{De();ca=class extends W{};t(ca,"LifeSupport")});var Zi,fS=n(()=>{De();Zi=class extends W{};t(Zi,"Mass")});var Rl,dS=n(()=>{De();Rl=class extends W{};t(Rl,"Population")});var uO=n(()=>{cS();yS();fS();dS()});var gj,gS,hS=n(()=>{uO();fs();Wv();v();gj=t(()=>[new Zh(new p(r=>{let[e,i,o,a,s]=r.yields().reduce(([h,G,D,B,E],Y)=>(Y instanceof Dn&&Y.value()>0&&(h+=Y.value()),Y instanceof Dn&&Y.value()<0&&(G+=Math.abs(Y.value())),Y instanceof ca&&Y.value()>0&&(D+=Y.value()),Y instanceof ca&&Y.value()<0&&(B+=Math.abs(Y.value())),Y instanceof Rl&&(E+=Y.value()),[h,G,D,B,E]),[0,0,0,0,0]),[l,u]=r.activeParts().reduce(([h,G],D)=>(D instanceof Nt&&h++,D instanceof St&&G++,[h,G]),[0,0]);if([e,o,s,l,u].some(h=>h===0))return 0;let c=Math.min(l/u,1),y=Math.min(a/o,1),f=Math.min(i/e,1);return c*y*f}))],"getRules"),gS=gj});var hj,OS,RS=n(()=>{Oh();I();v();fs();hj=t(()=>[new rm(new m(r=>r instanceof Ct),new m((r,e)=>e.slots().filter(i=>i.accepts(r)&&i.empty()).length>0),new p((r,e)=>{let i=e.slots().filter(a=>a.accepts(r)&&a.empty()),[o]=i.sort((a,s)=>e.getAdjacent(s).filter(l=>l.part()instanceof Ct).length-e.getAdjacent(a).filter(l=>l.part()instanceof Ct).length||e.getAdjacent(s).filter(l=>!l.empty()).length-e.getAdjacent(a).filter(l=>!l.empty()).length||Math.abs(a.x()-8)-Math.abs(s.x()-8)||Math.abs(a.y()-6)-Math.abs(s.y()-6));return o})),new rm(new m(r=>!(r instanceof Ct)),new m((r,e)=>e.slots().filter(i=>i.accepts(r)&&i.empty()).length>0),new p((r,e)=>{let i=e.slots().filter(a=>a.accepts(r)&&a.empty()),[o]=i.sort((a,s)=>e.getAdjacent(s).filter(l=>!l.empty()).length-e.getAdjacent(a).filter(l=>!l.empty()).length||Math.abs(a.x()-8)-Math.abs(s.x()-8)||Math.abs(a.y()-6)-Math.abs(s.y()-6));return o}))],"getRules"),OS=hj});var Oj,xS,vS=n(()=>{Yt();LR();zv();v();uO();fs();mo();Oj=t((r=Lm,e=ie)=>[new Xh(new p(i=>{let o=Le(i.yields(),Zi),a=i.activeParts().reduce((y,f)=>y+(f instanceof St?1:0),0),s=Math.trunc(o/20/(1+a*10)*10)/10,l=r.value(),u=l+s,c=e.value();for(;r.value(c)<u;)c++;return c}))],"getRules"),xS=Oj});var Rj,bS,CS=n(()=>{V();v();Lv();Rj=t((r=b)=>[new tO(new p(e=>{r.emit("player:spaceship:landed",e.player())}))],"getRules"),bS=Rj});var xj,TS,PS=n(()=>{V();Ph();w();am();Yt();v();Nv();nO();xj=t((r=Ho,e=Ep,i=d,o=ie,a=b,s=()=>Math.random())=>[new rc(new p(l=>{a.emit("player:spaceship:lost",l.player())})),new rc(new p(l=>{let[u]=e.entries(),c=new u(i);r.register(new Wp(l.player(),c,i,o,s))}))],"getRules"),TS=xj});var vj,wS,IS=n(()=>{uO();fs();I();v();xv();vj=t(()=>[...[[Nt,Zi,400],[jt,Dn,-50],[jt,ca,-100],[jt,Zi,1600],[jt,Rl,1e4],[ir,Dn,-50],[ir,ca,100],[ir,Zi,1600],[br,Dn,100],[br,Zi,400],[St,Zi,400],[Ct,Zi,100]].map(([r,e,i])=>new dh(new m(o=>o instanceof r),new p(o=>new e(i,o.id()))))],"getRules"),wS=vj});var cO,yO,_v=n(()=>{A();cO=class extends g{};t(cO,"Start");yO=cO});var bj,AS,BS=n(()=>{am();v();_v();bj=t((r=Ho)=>[new yO(new p(()=>{r.entries().forEach(e=>e.check())}))],"getRules"),AS=bj});var Cj={};var GS=n(()=>{X0();tS();iS();nS();w();sS();mS();uS();hS();RS();vS();CS();PS();IS();BS();d.register(...Q0(),...eS(),...rS(),...oS(),...aS(),...lS(),...pS(),...gS(),...OS(),...xS(),...bS(),...TS(),...wS(),...AS())});var MS=T(US=>{"use strict";Object.defineProperty(US,"__esModule",{value:!0});J0();GS()});var fO,xl,ic=n(()=>{De();fO=class extends W{};t(fO,"TradeRate");xl=fO});var ds,DS=n(()=>{hu();ic();ds=class extends xl{};t(ds,"Luxuries"),ds.tradeYield=sC});var gs,ES=n(()=>{Gf();ic();gs=class extends xl{};t(gs,"Research"),gs.tradeYield=Vt});var hs,SS=n(()=>{Bs();ic();hs=class extends xl{};t(hs,"Tax"),hs.tradeYield=no});var Kv=n(()=>{DS();ES();SS()});var dO,vl,oc=n(()=>{to();ic();dO=class extends _e{constructor(){super(xl)}};t(dO,"AvailableTradeRateRegistry");vl=new dO});var Tj={};var FS=n(()=>{Kv();oc();vl.register(ds,gs,hs)});var kS=n(()=>{Af();ba()});var gO,hO,qv=n(()=>{Z();gO=class extends k{#e;#t=[];constructor(e,...i){super(),this.#e=e,this.#t=i,this.addKey("all")}all(){return[...this.#t]}balance(e){if(this.total()===100)return;let i=100-e.value(),o=this.#t.filter(s=>s!==e),a=o.reduce((s,l)=>s+l.value(),0);o.forEach(s=>s.set(s.value()/a*i)),this.total()<100&&o[Math.floor(o.length*Math.random())].add(100-this.total()),this.total()>100&&o[Math.floor(o.length*Math.random())].subtract(100-this.total())}get(e){let[i]=this.#t.filter(o=>o instanceof e);return i}player(){return this.#e}set(e,i){let o=this.get(e);o.set(i),this.balance(o)}setAll(e){if(e.reduce((i,[,o])=>i+o,0)!==100)throw new TypeError("Invalid rates provided, must sum to 100.");e.forEach(([i,o])=>this.get(i).set(o))}total(){return this.#t.reduce((e,i)=>e+i.value(),0)}};t(gO,"PlayerTradeRates");hO=gO});var OO,bl,nc=n(()=>{fe();qv();OO=class extends F{constructor(){super(hO)}getByPlayer(e){let i=this.getBy("player",e);if(i.length!==1)throw new TypeError("Wrong number of PlayerTradeRates for player");return i[0]}};t(OO,"PlayerTradeRatesRegistry");bl=new OO});var Pj,YS,WS=n(()=>{oc();kS();nc();v();Cm();mo();Pj=t((r=vl,e=bl)=>[new bm(new p((i,o)=>{let a=e.getByPlayer(i.player()),s=Math.max(0,Le(o,me)),l=s;return r.entries().map(u=>{let c=u.tradeYield,y=Math.min(Math.ceil(s*(a.get(u).value()/100)),l);return l-=y,new c(y,u.name)})}))],"getRules"),YS=Pj});var wj,zS,LS=n(()=>{nc();en();OR();v();wj=t((r=bl)=>[new Xe(new p(e=>[new Ss(e,r.getByPlayer(e))]))],"getRules"),zS=wj});var Ij,NS,jS=n(()=>{oc();nc();Kv();Fl();v();qv();Ij=t((r=vl,e=bl)=>[new Oi(new p(i=>{let o=[new hs(50),new gs(50),new ds(0)],a=r.entries(),s=new hO(i,...a.map(l=>{let[u]=o.filter(c=>c instanceof l);return new l(u||0)}));e.register(s)}))],"getRules"),NS=Ij});var RO,Aj,HS,_S=n(()=>{oc();qe();w();v();Tl();Cp();Vu();mo();RO=[],Aj=t((r=d,e=N,i=vl)=>[new ma(new Yn,new p(o=>{RO.length===0&&i.entries().forEach(a=>RO.push(a.tradeYield)),e.getByPlayer(o).forEach(a=>{let s=a.yields();Wl(s,...RO).reduce((l,u,c)=>(l[c].set(u,"Consolidated"),l),RO.map(l=>new l)).forEach(l=>r.process(jo,l,a,s))})}))],"getRules"),HS=Aj});var Bj={};var KS=n(()=>{w();WS();LS();jS();_S();d.register(...YS(),...zS(),...NS(),...HS())});var VS=T(qS=>{"use strict";Object.defineProperty(qS,"__esModule",{value:!0});FS();KS()});var xO=n(()=>{gv();Bs()});var Gj,JS,$S=n(()=>{Se();I();v();xO();$p();jv();Ra();Gj=t(()=>[new oo(new m(r=>r.building()!==null&&Object.isPrototypeOf.call(Ge,r.building().item())),new m(r=>r.progress().value()===0),new p(r=>{let e=r.remaining()/10;return new Ol(Ee,Math.floor((e+4)*10*e))})),new oo(new m(r=>r.building()!==null&&Object.isPrototypeOf.call(Ge,r.building().item())),new m(r=>r.progress().value()>0),new p(r=>{let e=r.remaining()/10;return new Ol(Ee,Math.floor(5*e**2+20*e))})),new oo(new m(r=>r.building()!==null&&Object.isPrototypeOf.call(z,r.building().item())),new m(r=>r.progress().value()===0),new p(r=>new Ol(Ee,r.remaining()*4))),new oo(new m(r=>r.building()!==null&&Object.isPrototypeOf.call(z,r.building().item())),new m(r=>r.progress().value()>0),new p(r=>new Ol(Ee,r.remaining()*2)))],"getRules"),JS=Gj});var Uj,ZS,QS=n(()=>{Ln();qe();en();PR();v();Uj=t((r=N,e=kt)=>[new Xe(new p(i=>r.getByPlayer(i).map(o=>new ks(i,e.getByCity(o)))))],"getRules"),ZS=Uj});var Mj,XS,eF=n(()=>{Ul();Fl();v();xO();yR();Mj=t((r=hi)=>[new Oi(new p(e=>r.register(new yy(e,Ee))))],"getRules"),XS=Mj});var vO,bO,Vv=n(()=>{A();vO=class extends g{};t(vO,"Updated");bO=vO});var Dj,tF,rF=n(()=>{xO();vr();V();Ul();w();cR();Zl();I();v();Cp();Vv();Dj=t((r=hi,e=d,i=Pe,o=b)=>[new jo(new m(a=>a instanceof Ee),new p((a,s,l)=>{let u=r.getByPlayerAndType(s.player(),Ee);l.forEach(c=>{if(c instanceof he){if(u.value()<c.value()){let y=c.cityImprovement(),f=new ny(y.constructor,s,e);i.unregister(y),u.add(f.cost().value()),o.emit("city:unsupported-improvement",s,y);return}u.subtract(c.value())}})})),new jo(new m(a=>a instanceof Ee),new m((a,s,l)=>!e.process(No,s,l).some(u=>u)),new p((a,s)=>{let l=r.getByPlayerAndType(s.player(),Ee);l.add(a),e.process(bO,l,s)}))],"getRules"),tF=Dj});var Ej,iF,oF=n(()=>{V();I();v();Vv();Ej=t((r=b)=>[new bO(new m(e=>e.value()<0),new p((e,i)=>{r.emit("player:treasury-exhausted",e.player(),e,i)}))],"getRules"),iF=Ej});var Sj={};var nF=n(()=>{w();$S();QS();eF();rF();oF();d.register(...JS(),...ZS(),...XS(),...tF(),...iF())});var sF=T(aF=>{"use strict";Object.defineProperty(aF,"__esModule",{value:!0});nF()});var Fj={};var lF=n(()=>{zo();Bl();io.register(Bo,Go,si,Ni,Uo,Mo,ji,Hi,Do,Eo,Rr,_i,Fr,Ki,qi,So,Vi,xr,Fo,Ji,Ze,$i,li,kr,ko,Yo,Yr,Wo)});var CO,zp,Jv=n(()=>{A();CO=class extends g{};t(CO,"Available");zp=CO});var TO,mF,PO,kj,pF,uF=n(()=>{ER();Xn();tp();Pt();qe();yo();ea();sr();w();ln();Vr();ip();Yt();Ve();wa();Oc();Jv();I();v();Hg();zo();TO=new m((r,e,i=r.tile())=>r instanceof st),mF=new m((r,e,i=r.tile())=>r instanceof $e),PO=t((r,e)=>e.getByTile(r)!==null,"tileHasCity"),kj=t((r=re,e=N,i=d,o=Fe,a=cr,s=j,l=gt,u=Zn,c=ie)=>[new wt(Fm,xi,new Wr(new kn(TO,new m((y,f,h=y.tile())=>h.isLand()),new m((y,f)=>f.isLand()),new m((y,f)=>s.getByTile(f).every(h=>h.player()===y.player()))),new kn(mF,new Wr(new m((y,f,h=y.tile())=>h.isWater()),new m((y,f,h=y.tile())=>e.getByTile(h)?.player()===y.player())),new Wr(new m((y,f)=>f.isWater()),new m((y,f)=>e.getByTile(f)?.player()===y.player()))),new m(y=>y instanceof zt)),new Wr(new m((y,f)=>!(y instanceof st)),new m((y,f,h=y.tile())=>!(h.getNeighbours().some(G=>s.getByTile(G).some(D=>D instanceof st&&D.tile().terrain()instanceof _&&D.player()!==y.player()))&&f.getNeighbours().some(G=>s.getByTile(G).some(D=>D instanceof st&&D.tile().terrain()instanceof _&&D.player()!==y.player())))),new m((y,f)=>s.getByTile(f).filter(h=>h.player()===y.player()).length>0),new m((y,f)=>{let h=e.getByTile(f);return h===null?!1:h.player()===y.player()})),new m((y,f)=>{let h=e.getByTile(f);return h===null?!0:h.player()===y.player()}),new m((y,f)=>!s.getByTile(f).some(h=>h.player()!==y.player())),new p((y,f,h=y.tile())=>new Jt(h,f,y,i))),new wt(Fm,xi,new m((y,f)=>s.getByTile(f).some(h=>h.player()!==y.player())),new Wr(new kn(new m(y=>y instanceof zt),new Wr(new m((y,f)=>!s.getByTile(f).every(h=>h instanceof zt)),new m((y,f)=>y instanceof Rr))),new kn(TO,new Wr(new m((y,f)=>PO(f,e)),new m((y,f)=>s.getByTile(f).some(h=>h instanceof st)))),new kn(mF,new Wr(new m((y,f)=>!(y instanceof li)),new m((y,f)=>f.isWater())))),new p((y,f,h=y.tile())=>new Xs(h,f,y,i,s))),new wt(Fm,xi,TO,new m((y,f)=>PO(f,e)),new m((y,f)=>s.getByTile(f).length===0),new m((y,f)=>e.getByTile(f).player()!==y.player()),new p((y,f,h=y.tile())=>{let G=e.getByTile(f);return new Km(h,f,y,G,i)})),new wt(xi,Kn,new m(y=>y instanceof H),new m((y,f)=>o.getByTile(f).filter(h=>[Ue,ot,ur,je].some(G=>h instanceof G)).length>0),new p((y,f,h=y.tile())=>new ul(h,f,y,i,o,c))),new wt(xi,Kn,new m(y=>y instanceof H),new m((y,f,h=y.tile())=>h.isLand()),new p((y,f,h=y.tile())=>new pl(h,f,y,i,c,a))),new wt(xi,Kn,new p((y,f,h=y.tile())=>new Ia(h,f,y,i,c))),new wt(xi,Kn,new p((y,f,h=y.tile())=>new $m(h,f,y,i))),new wt(Kn,new p((y,f,h=y.tile())=>new uo(h,f,y,i))),new wt(xi,Kn,new m(y=>y instanceof Ze),new m((y,f,h=y.tile())=>h.isLand()),new m((y,f,h=y.tile())=>!PO(h,e)),new p((y,f,h=y.tile())=>new Xm(h,f,y,r,i))),...[[Ue,el,new Wr(new m((y,f,h=y.tile())=>h.terrain()instanceof ae),new m((y,f,h=y.tile())=>h.getAdjacent().some(G=>G.terrain()instanceof ae||G.terrain()instanceof ar||o.getByTile(G).some(D=>D instanceof Ue)&&!PO(G,e))))],[ot,tl],[je,rl],[ur,il,new m((y,f)=>o.getByTile(f).some(h=>h instanceof je))]].map(([y,f,...h])=>new wt(new m(G=>G instanceof Pr),xi,new m((G,D,B=G.tile())=>i.get(zp).some(E=>E.validate(B,y,G.player()))),Kn,...h,new p((G,D,B=G.tile())=>new f(B,D,G,i,c)))),...[[nt,sl],[et,ol],[pe,cl],[at,ll]].map(([y,f])=>new wt(xi,Kn,new m(h=>h instanceof Pr),new m((h,G,D=h.tile())=>D.terrain()instanceof y),new p((h,G,D=h.tile())=>new f(D,G,h,i,l,c)))),new wt(Fm,xi,TO,new m((y,f)=>f.terrain()instanceof ar),new m((y,f)=>s.getByTile(f).every(h=>h.player()===y.player())),new m((y,f)=>s.getByTile(f).filter(h=>h instanceof Zt).some(h=>h.hasCapacity()&&h.canStow(y))),new p((y,f,h=y.tile())=>{let[G]=s.getByTile(f).filter(D=>D instanceof Zt).filter(D=>D.hasCapacity()&&D.canStow(y));return new Zm(h,f,y,G,i)})),new wt(Fm,new m(y=>{try{return u.getByUnit(y),!0}catch{return!1}}),new Wr(new m((y,f)=>!(y instanceof st)),new m((y,f)=>f.isLand())),new m((y,f,h=y.tile())=>u.getByUnit(y).transport().tile()===h),new p((y,f,h=y.tile())=>{let G=u.getByUnit(y).transport();return new ml(h,f,y,G,i)})),new wt(xi,Kn,new m(y=>y instanceof Zt),new m(y=>y.hasCargo()),new m((y,f)=>f.getNeighbours().some(h=>h.isLand())),new p((y,f,h=y.tile())=>new ep(h,f,y,i)))],"getRules"),pF=kj});var Yj,cF,yF=n(()=>{wa();SR();I();v();Iu();Yj=t((r=cr)=>[new km(new m(e=>e.moves().value()>0),new p(e=>e.setActive())),new km(new m(e=>e.busy()!==null),new p(e=>e.setBusy())),...[Pi].map(e=>new km(new m(i=>r.getByUnit(i).some(o=>o instanceof e)),new p(i=>r.unregister(...r.getByUnit(i).filter(o=>o instanceof e)))))],"getRules"),cF=Yj});var Wj,fF,dF=n(()=>{Tm();zo();We();kd();Yd();zd();Ld();Nd();jd();I();v();_d();Kd();Vd();Jd();Zd();Xd();eg();rg();og();ag();sg();Xn();lg();ku();ug();dg();hg();Rg();vg();Cg();Wj=t((r=L)=>[new mt(new m((e,i)=>Object.prototype.isPrototypeOf.call($e,i)),new p(e=>new m(()=>e.tile().isCoast()))),...[[Bo,Ea],[Go,gg],[si,Au],[Ni,Eu],[Mo,Au],[Uo,xg],[ji,ng],[Hi,Og],[Do,Uu],[Eo,bg],[Rr,Hd],[_i,Du],[Fr,qd],[Ki,fg],[qi,Gu],[So,Qd],[Vi,ap],[xr,pg],[Fo,_l],[Ji,Su],[$i,Wd],[li,ig],[kr,$d],[ko,Bu],[Yo,Mu],[Yr,tg]].map(([e,i])=>new mt(new m((o,a)=>a===e),new p(o=>new m(()=>r.getByPlayer(o.player()).completed(i))))),...[[Ni,Ea],[ji,Eu],[Hi,Gu],[_i,Mu],[Fr,_l],[Ki,Uu],[qi,Bu],[Vi,_l],[Ji,Du],[$i,ap],[kr,_l],[Yr,Su],[Wo,ap]].map(([e,i])=>new mt(new m((o,a)=>a===e),new p(o=>new m(()=>!r.getByPlayer(o.player()).completed(i)))))],"getRules"),fF=Wj});var zj,gF,hF=n(()=>{Pm();zo();zj=t(()=>[...[[Bo,80],[Go,160],[si,120],[Ni,40],[Uo,50],[Mo,160],[ji,40],[Hi,40],[Do,80],[Eo,30],[Rr,60],[_i,40],[Fr,20],[Ki,50],[qi,40],[So,50],[Vi,30],[xr,160],[Fo,30],[Ji,40],[Ze,40],[$i,20],[li,50],[kr,20],[ko,80],[Yo,50],[Yr,40],[Wo,10]].flatMap(([r,e])=>Is(r,e))],"getRules"),gF=zj});var Lj,OF,RF=n(()=>{It();wm();I();v();zo();Lj=t((r=X)=>[new gi(new m((e,i)=>i instanceof Ze),new p(e=>r.getByCity(e.city()).shrink()))],"getRules"),OF=Lj});var Nj,xF,vF=n(()=>{V();Ve();mf();v();Nj=t((r=j,e=b)=>[new Oa(new p(i=>r.register(i))),new Oa(new p(i=>i.applyVisibility())),new Oa(new p(i=>i.moves().set(i.movement()))),new Oa(new p(i=>{e.emit("unit:created",i)}))],"getRules"),xF=Nj});var jj,bF,CF=n(()=>{qe();V();w();Vr();Ve();I();Ru();au();v();jj=t((r=N,e=d,i=Fe,o=j,a=b)=>[new an(new p((s,l)=>{a.emit("unit:defeated",s,l),e.process(tn,s,l.player())})),new an(new m(s=>r.getByTile(s.tile())===null),new m(s=>o.getByTile(s.tile()).filter(l=>l!==s&&l.player()===s.player()).length>0),new p((s,l)=>o.getByTile(s.tile()).forEach(u=>{u!==s&&u.player()===s.player()&&e.process(tn,s,l.player())})))],"getRules"),bF=jj});var Hj,TF,PF=n(()=>{V();wa();Ve();au();v();Hj=t((r=j,e=cr,i=b)=>[new tn(new p((o,a)=>{i.emit("unit:destroyed",o,a)})),new tn(new p(o=>{o.setActive(!1),o.setDestroyed()})),new tn(new p(o=>e.getByUnit(o).forEach(a=>e.unregister(a))))],"getRules"),TF=Hj});var wO,Lp,$v=n(()=>{A();wO=class extends g{};t(wO,"LostAtSea");Lp=wO});var _j,wF,IF=n(()=>{V();v();$v();_j=t((r=b)=>[new Lp(new p(e=>{r.emit("unit:lost-at-sea",e)})),new Lp(new p(e=>e.destroy(null)))],"getRules"),wF=_j});var IO,Kj,AF,BF=n(()=>{zo();qe();tp();V();w();ip();Yt();Oc();I();v();Tl();$v();At();Hg();Xn();IO=new Map,Kj=t((r=Zn,e=d,i=()=>Math.random(),o=b,a=N,s=ie)=>[new q(new p((l,u)=>{o.emit("unit:moved",l,u)})),new q(new p(l=>l.applyVisibility())),new q(new m(l=>l.moves().value()<=.1),new p(l=>l.moves().set(0))),new q(new m(l=>l.moves().value()<.1),new p(l=>l.setActive(!1))),new q(new m(l=>l instanceof Zt),new m((l,u)=>u instanceof Jt),new m(l=>l.hasCargo()),new p((l,u)=>l.cargo().forEach(c=>c.action(u.forUnit(c))))),new q(new m((l,u)=>u instanceof ml),new p(l=>{let u=r.getByUnit(l);u.transport().unload(l),r.unregister(u)})),new q(new m(l=>l instanceof Yr),new m(l=>l.moves().value()===0),new m(l=>!l.tile().isCoast()),new m(()=>i()<=.5),new p(l=>{e.process(Lp,l)})),...[[si,1],[Rr,0],[xr,0]].flatMap(([l,u])=>[new q(new Yn,new m(c=>c instanceof l),new m(c=>c.moves().value()===0),new m(c=>!IO.has(c)),new p(c=>{IO.set(c,s.value())})),new q(new m(c=>c instanceof l),new m(c=>c.moves().value()===0),new Wr(new m(c=>a.getByTile(c.tile())!==null),new m(c=>!!r.getByUnit(c))),new p(c=>{IO.delete(c)})),new q(new m(c=>c instanceof l),new m(c=>c.moves().value()===0),new kn(new m(c=>a.getByTile(c.tile())===null),new m(c=>!r.getByUnit(c))),new m(c=>(IO.get(c)??s.value())+u<=s.value()),new p(c=>{e.process(Lp,c)}))])],"getRules"),AF=Kj});var GF,qj,UF,MF=n(()=>{yo();Xn();tp();ea();Vr();ip();I();v();Ci();GF=[[Wt,2],[Ie,1],[et,2],[Re,1],[Me,2],[nt,2],[He,3],[pt,1],[pe,1],[ae,1],[at,2],[ht,1]],qj=t((r=Fe,e=Zn)=>[...GF.map(([i,o])=>new we(new m((a,s)=>s instanceof Jt),new m(a=>a instanceof st),new m((a,s)=>s.to().terrain()instanceof i),new p(()=>o))),new we(new m((i,o)=>o instanceof Jt),new m(i=>i instanceof zt||i instanceof $e),new p(()=>1)),new we(new m((i,o)=>o instanceof Jt),new m(i=>i instanceof st),new m((i,o)=>r.getByTile(o.from()).some(a=>a instanceof je)),new m((i,o)=>r.getByTile(o.to()).some(a=>a instanceof je)),new p(()=>1/3)),new we(new m((i,o)=>o instanceof Jt),new m(i=>i instanceof st),new m((i,o)=>r.getByTile(o.from()).some(a=>a instanceof ur)),new m((i,o)=>r.getByTile(o.to()).some(a=>a instanceof ur)),new p(()=>0)),new we(new m((i,o)=>o instanceof Jt),new m(i=>i instanceof st),new m(i=>{try{return e.getByUnit(i),!0}catch{return!1}}),new m(i=>e.getByUnit(i).transport()instanceof Zt),new p(()=>0)),...[[el,2],[tl,3],[rl,1],[il,2],[ol,2],[sl,3],[ll,3],[pl,1],[ul,1],[cl,3],[Ia,0]].flatMap(([i,o])=>GF.map(([a,s])=>new we(new m((l,u)=>u instanceof i),new m(l=>l.tile().terrain()instanceof a),new p(()=>o*s))))],"getRules"),UF=qj});var Vj,DF,EF=n(()=>{eR();Ve();en();I();v();Vj=t((r=j)=>[new Xe(new m(e=>r.getByPlayer(e).some(i=>i.active()&&i.moves().value())),new p(e=>r.getByPlayer(e).filter(i=>i.active()&&i.moves().value()>0).sort((i,o)=>(i.waiting()?1:0)-(o.waiting()?1:0)).map(i=>new Rs(e,i)))),new Xe(new m(e=>r.getByPlayer(e).some(i=>!i.active()||!i.moves().value())),new p(e=>r.getByPlayer(e).filter(i=>!i.active()||i.moves().value()===0).sort((i,o)=>(i.waiting()?1:0)-(o.waiting()?1:0)).map(i=>new xs(e,i))))],"getRules"),DF=Vj});var Jj,SF,FF=n(()=>{v();ox();fx();Jj=t(()=>[new dd(new p(r=>r.action(new nT(r.tile(),r.tile(),r))))],"getRules"),SF=Jj});var $j,kF,YF=n(()=>{Sm();zo();Iu();w();wa();Ym();Ym();I();v();$j=t((r=cr,e=d)=>[...[[Bo,12,2,2],[Go,18,12,4,2],[si,12,1,8,2],[Ni,8],[Uo,0],[Mo,1,12,5,2],[ji,6],[Hi,4,1,2],[Do,6,6,6,2],[Eo,0,0,2],[Rr,4,2,10,2],[_i,2,2,3],[Fr,2,1,2],[Ki,4,4,4],[qi,4,2,2],[So,6,6,3],[Vi,3,2],[xr,99,0,16],[Fo,3,5],[Ji,1,1,3],[Ze,0],[$i,1,2],[li,8,2,3,2],[kr,3],[ko,10,5,3],[Yo,0,3,4],[Yr,1,0,3],[Wo]].flatMap(([i,o=1,a=1,s=1,l=1])=>Xb(i,o,a,s,l)),...[[Pi,1,Ri],[Aa,.5,so,Ri]].flatMap(([i,o,...a])=>a.map(s=>new kl(new m((l,u)=>u instanceof s),new m(l=>r.getByUnit(l).some(u=>u instanceof i)),new p((l,u)=>{let c=new s;e.process(Ls,l.constructor,c),u.add(c.value()*o,i.name)}))))],"getRules"),kF=$j});var Zj,WF,zF=n(()=>{V();v();Sg();Zj=t((r=b)=>[new Ql(new p((e,i)=>{r.emit("unit:unsupported",e,i)}))],"getRules"),WF=Zj});var Qj,LF,NF=n(()=>{I();v();ex();Qj=t((r=()=>Math.random())=>[new xu(new m((e,i)=>e.moves().value()>=i),new p((e,i)=>(e.moves().subtract(i),!0))),new xu(new m((e,i)=>e.moves().value()<i),new p((e,i)=>{let o=e.moves().value();return e.moves().set(0),o>=i*.5*r()}))],"getRules"),LF=Qj});var Xj={};var jF=n(()=>{uF();yF();dF();hF();RF();vF();CF();PF();w();IF();BF();MF();EF();FF();YF();zF();NF();d.register(...pF(),...cF(),...fF(),...gF(),...OF(),...xF(),...bF(),...TF(),...wF(),...AF(),...UF(),...DF(),...SF(),...kF(),...WF(),...LF())});var _F=T(HF=>{"use strict";Object.defineProperty(HF,"__esModule",{value:!0});lF();jF()});var zr,KF=n(()=>{Be();zr=class extends Oe{};t(zr,"Colossus")});var mi,qF=n(()=>{Be();mi=class extends Oe{};t(mi,"CopernicusObservatory")});var _o,VF=n(()=>{Be();_o=class extends Te{};t(_o,"CureForCancer")});var Ko,JF=n(()=>{Be();Ko=class extends Te{};t(Ko,"DarwinsVoyage")});var Lr,$F=n(()=>{Be();Lr=class extends Oe{};t(Lr,"GreatLibrary")});var qo,ZF=n(()=>{Be();qo=class extends Oe{};t(qo,"GreatWall")});var pi,QF=n(()=>{Be();pi=class extends Oe{};t(pi,"HangingGardens")});var ya,XF=n(()=>{Be();ya=class extends Te{};t(ya,"HooverDam")});var Vo,ek=n(()=>{Be();Vo=class extends Te{};t(Vo,"IsaacNewtonsCollege")});var Qi,tk=n(()=>{Be();Qi=class extends Te{};t(Qi,"JsBachsCathedral")});var ui,rk=n(()=>{Be();ui=class extends Te{};t(ui,"Lighthouse")});var Jo,ik=n(()=>{Be();Jo=class extends Oe{};t(Jo,"MagellansExpedition")});var En,ok=n(()=>{Be();En=class extends Te{};t(En,"ManhattanProject")});var Nr,nk=n(()=>{Be();Nr=class extends Te{};t(Nr,"MichelangelosChapel")});var or,ak=n(()=>{Be();or=class extends Oe{};t(or,"Oracle")});var $o,sk=n(()=>{Be();$o=class extends Oe{};t($o,"Pyramids")});var Zo,lk=n(()=>{Be();Zo=class extends Te{};t(Zo,"SetiProgram")});var jr,mk=n(()=>{Be();jr=class extends Te{};t(jr,"ShakespearesTheatre")});var fa,pk=n(()=>{Be();fa=class extends Te{};t(fa,"UnitedNations")});var Xi,uk=n(()=>{Be();Xi=class extends Te{};t(Xi,"WomensSuffrage")});var da=n(()=>{mO();KF();qF();VF();JF();$F();ZF();QF();XF();ek();tk();rk();ik();ok();nk();ak();sk();lk();mk();pk();uk()});var eH={};var ck=n(()=>{da();Bl();io.register(Mn,zr,mi,_o,Ko,Lr,qo,pi,ya,Vo,Qi,ui,Jo,En,Nr,or,$o,Zo,jr,fa,Xi)});var tH,yk,fk=n(()=>{da();Ur();Tm();We();Un();I();v();Be();zo();tH=t((r=L,e=yt)=>[new mt(new m((i,o)=>Object.isPrototypeOf.call(Oe,o)),new p((i,o)=>new m(()=>e.filter(a=>a instanceof o).length===0))),...[[zr,ho],[mi,Ai],[Lr,Br],[qo,Xt],[pi,Pn],[ui,xo],[Jo,Si],[or,Gi],[$o,Xt],[Mn,bo],[_o,vn],[Ko,ri],[ya,Rt],[Vo,To],[Qi,Gt],[En,ei],[Nr,Gt],[Zo,Ui],[jr,Ei],[fa,Bt],[Xi,fr]].map(([i,o])=>new mt(new m((a,s)=>s===i),new p(a=>new m(()=>r.getByPlayer(a.player()).completed(o))))),...[[xr,En]].map(([i,o])=>new mt(new m((a,s)=>s===i),new p(()=>new m(()=>e.some(a=>a instanceof o)))))],"getRules"),yk=tH});var rH,dk,gk=n(()=>{da();Pm();rH=t(()=>[...[[Mn,600],[zr,200],[mi,300],[_o,600],[Ko,300],[Lr,300],[qo,300],[pi,300],[ya,600],[Vo,400],[Qi,400],[ui,200],[Jo,400],[En,600],[Nr,300],[or,300],[$o,300],[Zo,600],[jr,400],[fa,600],[Xi,600]].flatMap(([r,e])=>Is(r,e))],"getRules"),dk=rH});var iH,hk,Ok=n(()=>{Ln();V();We();w();Un();wm();I();da();v();Gc();Be();iH=t((r=kt,e=L,i=d,o=yt,a=b)=>[new gi(new m((s,l)=>l instanceof Oe),new p((s,l)=>{let u=l.constructor;o.register(l),r.filter(c=>c.building()?.item()===u).forEach(c=>c.revalidate())})),new gi(new m((s,l)=>l instanceof Oe),new p((s,l)=>{a.emit("wonder:built",l,s.city())})),new gi(new m((s,l)=>l instanceof Ko),new p(s=>{let l=e.getByPlayer(s.city().player()),u=t(y=>{let f=new cm(new m(h=>h===l),new p(()=>{i.unregister(f),y()}));i.register(f)},"createOnStarted"),c=t(()=>{l.add(l.cost()),u(()=>l.add(l.cost()))},"completeResearch");if(l.researching()===null){u(()=>c());return}c()}))],"getRules"),hk=iH});var Np,eo,ac=n(()=>{Un();I();Np=t((r,e=yt)=>new m(i=>e.getByCity(i).some(o=>o instanceof r)),"cityHasWonder"),eo=t((r,e=yt)=>new m(i=>e.getByPlayer(i.player()).some(o=>o instanceof r)),"playerHasWonder")});var Rk,Sn,AO,sc=n(()=>{We();I();Rk=t((r,e=L)=>new m(i=>e.getByPlayer(i.player()).completed(r)),"discoveredByPlayer"),Sn=t((r,e=L)=>new m(()=>r===null||!e.some(i=>i.completed(r))),"notDiscoveredByAnyPlayer"),AO=t((r,e=L)=>new m(i=>r===null||!e.getByPlayer(i.player()).completed(r)),"notDiscoveredByPlayer")});var BO,xk=n(()=>{vr();I();BO=t((r,e=Pe)=>new m(i=>e.getByCity(i).some(o=>o instanceof r)),"hasCityImprovement")});var oH,vk,bk=n(()=>{Li();vr();Ur();da();gn();We();Ve();Un();ac();sc();vm();I();v();ha();Ng();vs();Ta();xk();mo();oH=t((r=Pe,e=Ot,i=L,o=j,a=yt)=>[new lt(new tt,eo(or,a),BO(Lt,r),AO(er,i),Sn(Gt,i),new p((s,l)=>new rt(-Math.min(1,Le(l,rt)),or.name))),new lt(new tt,eo(or,a),BO(Lt,r),Rk(er,i),Sn(Gt,i),new p((s,l)=>new rt(-Math.min(2,Le(l,rt)),or.name))),new lt(new _r(4e3),Np(jr,a),Sn(Rt,i),new p((s,l)=>new rt(-Le(l,rt),jr.name))),new lt(new tt,eo(Qi,a),new p((s,l)=>new rt(-Math.min(2,Le(l,rt)),Qi.name))),new lt(new tt,eo(Nr,a),BO(hr,r),Sn(Bt,i),new p((s,l)=>new rt(-Math.min(4,Le(l,rt)),Nr.name))),new lt(new tt,eo(Xi,a),new m((s,l)=>l.some(u=>u instanceof $a)),new p((s,l)=>l.flatMap(u=>u instanceof $a?new rt(-1,Xi.name):[])))],"getRules"),vk=oH});var nH,Ck,Tk=n(()=>{Un();Il();I();v();nH=t((r=yt)=>[new Cr(new m(e=>r.getByCity(e).length>0),new p(e=>r.getByCity(e).forEach(i=>r.unregister(i))))],"getRules"),Ck=nH});var aH,Pk,wk=n(()=>{da();Ur();Ta();We();Un();ac();Cm();v();vs();sc();aH=t((r=L,e=yt)=>[new Xo(new _r(500),Np(zr,e),Sn(Ir,r),new p(i=>new me(i.tilesWorked().filter(o=>o.yields().some(a=>a instanceof me)).length,zr.name))),...[[pi,1,Ar],[_o,1,null]].map(([i,o,a])=>new Xo(eo(i,e),Sn(a,r),new p(()=>new Ks(o,i.name))))],"getRules"),Pk=aH});var sH,Ik,Ak=n(()=>{da();We();Un();ac();Ur();v();ha();Ta();Qc();sc();mo();sH=t((r=L,e=yt)=>[...[[mi,Vt,1,Qt]].map(([i,o,a,s])=>new Al(new tt,Np(i,e),Sn(s,r),new p((l,u)=>new o(Le(u,o)*a,i.name)))),...[[Zo,Vt,.5,null]].map(([i,o,a,s])=>new Al(new tt,eo(i,e),Sn(s,r),new p((l,u)=>new o(Le(u,o)*a,i.name))))],"getRules"),Ik=sH});var GO,UO,Zv=n(()=>{A();GO=class extends g{};t(GO,"Obsolete");UO=GO});var lH,Bk,Gk=n(()=>{Ur();da();We();w();Un();Tc();I();v();Zv();lH=t((r=L,e=d,i=yt)=>[new bs(new m(()=>i.some(o=>o instanceof Lr)),new m((o,a)=>{let[s]=i.filter(u=>u instanceof Lr).map(u=>u.city().player());return!r.getByPlayer(s).completed(a.sourceClass())}),new m((o,a)=>r.filter(s=>s.completed(a.sourceClass())).length>=3),new p((o,a)=>{let[s]=i.filter(u=>u instanceof Lr).map(u=>u.city().player());return r.getByPlayer(s).addAdvance(a.sourceClass())})),...[[zr,Ir],[mi,Qt],[Lr,dr],[qo,yr],[pi,Ar],[Vo,ei],[ui,Qr],[Nr,Bt],[or,Gt],[$o,Bt],[jr,Rt]].map(([o,a])=>new bs(new m(()=>i.entries().some(s=>s instanceof o)),new m((s,l)=>l instanceof a),new p(()=>{let[s]=i.filter(l=>l instanceof o);e.process(UO,s,s.city())})))],"getRules"),Bk=lH});var mH,Uk,Mk=n(()=>{da();We();Un();I();v();ha();Ur();Sm();Xn();Ym();sc();ac();mH=t((r=yt,e=L)=>[new su(new tt,new m((i,o)=>o instanceof lo),new m(i=>i instanceof $e),eo(ui,r),AO(Qr,e),new p((i,o)=>o.add(1))),new su(new tt,new m((i,o)=>o instanceof lo),new m(i=>i instanceof $e),eo(Jo,r),new p((i,o)=>o.add(1)))],"getRules"),Uk=mH});var pH,Dk,Ek=n(()=>{V();v();Zv();pH=t((r=b)=>[new UO(new p((e,i)=>{r.emit("wonder:obsolete",e,i)}))],"getRules"),Dk=pH});var uH={};var Sk=n(()=>{fk();gk();Ok();bk();Tk();wk();Ak();w();Gk();Mk();Ek();d.register(...yk(),...dk(),...hk(),...vk(),...Ck(),...Pk(),...Ik(),...Bk(),...Uk(),...Dk())});var kk=T(Fk=>{"use strict";Object.defineProperty(Fk,"__esModule",{value:!0});ck();Sk()});var cH,Yk,Wk=n(()=>{yo();ea();We();Ur();Vr();Jv();I();cH=t((r=L,e=Fe)=>[...[[Ue,Ie,Re,Me,pe,ae],[ot,Ie,Me,He],[je,Wt,Ie,et,Re,Me,nt,He,pe,at,ht]].map(([i,...o])=>new zp(new m((a,s)=>s===i),new m(a=>o.some(s=>a.terrain()instanceof s)),new m((a,s)=>!e.getByTile(a).some(l=>l instanceof s)))),...[[je,go,ae]].map(([i,o,...a])=>new zp(new m((s,l)=>l===i),new m(s=>a.some(l=>s.terrain()instanceof l)),new m((s,l)=>!e.getByTile(s).some(u=>u instanceof l)),new m((s,l,u)=>r.getByPlayer(u).completed(o)))),...[[ur,ri,je,Wt,Ie,et,Re,Me,nt,He,pe,ae,at,ht]].map(([i,o,a,...s])=>new zp(new m((l,u)=>u===i),new m(l=>s.some(u=>l.terrain()instanceof u)),new m((l,u)=>!e.getByTile(l).some(c=>c instanceof u)),new m(l=>e.getByTile(l).some(u=>u instanceof a)),new m((l,u,c)=>r.getByPlayer(c).completed(o))))],"getRules"),Yk=cH});var yH,zk,Lk=n(()=>{V();ea();Vr();kf();I();v();yH=t((r=Fe,e=b)=>[new Pa(new m((i,o)=>r.getByTile(i).every(a=>o.constructor!==a.constructor)),new p((i,o)=>r.register(o))),new Pa(new p(i=>i.clearYieldCache(null))),new Pa(new p((i,o)=>{e.emit("tile-improvement:built",i,o)})),...[[ot,Ue],[Ue,ot]].map(([i,o])=>new Pa(new m((a,s)=>s instanceof i),new m(a=>r.getByTile(a).some(s=>s instanceof o)),new p(a=>r.unregister(...r.getByTile(a).filter(s=>s instanceof o)))))],"getRules"),zk=yH});var MO,DO,Qv=n(()=>{to();Ti();MO=class extends _e{constructor(){super(Je)}};t(MO,"AvailableTerrainFeatureRegistry");DO=new MO});var fH,Nk,jk=n(()=>{Qv();w();aR();v();Vm();fH=t((r=d,e=DO)=>[new Fc(new p(i=>{let o=r.get(nl);e.entries().forEach(a=>o.filter(s=>s.validate(a,i)).forEach(s=>s.process(a,i)))}))],"getRules"),Nk=fH});var Ht,Xv=n(()=>{A();Ht=class extends g{};t(Ht,"Distribution")});var dH,Hk,_k=n(()=>{yo();Xv();sr();I();v();dH=t(()=>[new Ht(new m(r=>r===Wt),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:0,to:.01,fill:!0},{from:.01,to:.02},{from:.98,to:.99},{from:.99,to:1,fill:!0}])),new Ht(new m(r=>r===Ie),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.4,to:.45},{from:.45,to:.55,coverage:.025,cluster:!0,clusterChance:.1},{from:.55,to:.6}])),new Ht(new m(r=>r===et),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.05,to:.2},{from:.2,to:.4,cluster:!0,clusterChance:.1,coverage:.1},{from:.4,to:.6},{from:.6,to:.8,cluster:!0,clusterChance:.1,coverage:.1},{from:.8,to:.95}])),new Ht(new m(r=>r===Re),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{fill:!0}])),new Ht(new m(r=>r===Me),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.1,to:.9,path:!0,pathChance:.1,coverage:.06}])),new Ht(new m(r=>r===nt),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.3,to:.45,cluster:!0,clusterChance:.2,coverage:.08},{from:.55,to:.7,cluster:!0,clusterChance:.2,coverage:.08}])),new Ht(new m(r=>r===He),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.01,to:.1,coverage:.3,path:!0},{from:.1,to:.9,path:!0},{from:.9,to:.99,coverage:.3,path:!0}])),new Ht(new m(r=>r===pt),new m((r,e)=>e.some(i=>i.constructor===ar)),new p(()=>[{fill:!0}])),new Ht(new m(r=>r===pe),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.01,to:.2,coverage:.3},{from:.2,to:.4},{from:.1,to:.4,cluster:!0},{from:.4,to:.6},{from:.6,to:.8},{from:.6,to:.9,cluster:!0},{from:.8,to:.99,coverage:.3}])),new Ht(new m(r=>r===ae),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.1,to:.9,coverage:.1,path:!0,pathChance:.5}])),new Ht(new m(r=>r===at),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.2,to:.4,cluster:!0},{from:.6,to:.8,cluster:!0}])),new Ht(new m(r=>r===ht),new m((r,e)=>e.some(i=>i instanceof _)),new p(()=>[{from:.01,to:.15,cluster:!0,coverage:.15},{from:.85,to:.99,cluster:!0,coverage:.15}]))],"getRules"),Hk=dH});var EO,SO,eb=n(()=>{A();EO=class extends g{};t(EO,"DistributionGroups");SO=EO});var gH,Kk,qk=n(()=>{yo();v();eb();gH=t(()=>[new SO(new p(()=>[pt,Re,at,He,nt,Me,et,Ie,pe,ht,Wt,ae]))],"getRules"),Kk=gH});var hH,Vk,Jk=n(()=>{yo();Tu();ln();Vm();hH=t((r=gt)=>[...[[pn,.2,Me],[un,.2,pt],[wi,.2,et,ht],[cn,.2,nt],[yn,.2,He],[co,.2,pe],[Ii,.2,Ie],[fn,.2,at],[dn,.2,Wt],[mn,.5,Re,ae]].flatMap(([i,o,...a])=>a.flatMap(s=>FC(s,i,o,r)))],"getRules"),Vk=hH});var FO,kO,$k=n(()=>{A();FO=class extends g{};t(FO,"Pillaged");kO=FO});var OH,Zk,Qk=n(()=>{V();Vr();$k();I();v();OH=t((r=Fe,e=b)=>[new kO(new m((i,o)=>r.getByTile(i).includes(o)),new p((i,o)=>r.unregister(o))),new kO(new p(i=>i.clearYieldCache(null))),new kO(new p((i,o)=>{e.emit("tile-improvement:pillaged",i,o)}))],"getRules"),Zk=OH});var tb,rb,ib,RH,xH,vH,bH,Xk,e1=n(()=>{Dv();V();Ca();yo();v();kv();tb=new Map,rb=new Map,ib=new Map,RH=t((r,e=null)=>(rb.has(r)||rb.set(r,r.score(e,[[Q,8],[J,3],[me,1]])),rb.get(r)),"tileScore"),xH=t((r,e=null)=>(ib.has(r)||ib.set(r,r.getSurroundingArea().entries().reduce((i,o)=>i+RH(o,e),0)),ib.get(r)),"areaScore"),vH=t((r,e=b)=>{if(!tb.has(r)){e.emit("world:generate-start-tiles");let i=r.entries().filter(o=>[Re,pe,ae].some(a=>o.terrain()instanceof a)).map(o=>({tile:o,score:xH(o)})).sort(({score:o},{score:a})=>a-o).map(({tile:o})=>o);tb.set(r,i),e.emit("world:start-tiles",i)}return tb.get(r)},"pickStartTiles"),bH=t((r=Yh,e=b,i=()=>Math.random())=>[new qh(new p((o,a,s)=>{if(e.option("earth",!1))try{return r.getStartTileByCivilizationAndWorld(a.civilization().sourceClass(),o)}catch{s.push(...r.entries().map(c=>c.startTileForMap(o)))}let l=vH(o,e);return l.forEach(u=>{s.some(c=>c.distanceFrom(u)<=4)&&l.splice(l.indexOf(u),1)}),l[Math.floor(l.length*i())]}))],"getRules"),Xk=bH});var YO,jp,WO=n(()=>{Dh();to();YO=class extends _e{constructor(){super(Mh)}};t(YO,"GeneratorRegistry");jp=new YO});var zO,LO,ob=n(()=>{A();zO=class extends g{};t(zO,"PickGenerator");LO=zO});var NO,jO,nb=n(()=>{A();NO=class extends g{};t(NO,"Start");jO=NO});var HO,t1,r1=n(()=>{Z();w();Lh();fe();di();HO=class extends k{#e;#t;#r;#i=new Os(ue);#o;constructor(e,i=d){super(),this.#e=e,this.#t=e.height(),this.#o=e.width(),this.#r=i,this.addKey("height","tiles","width")}build(){return new Promise(e=>{this.#e.generate().then(i=>{i.forEach((o,a)=>{let s=new ue(a%this.#o,Math.floor(a/this.#o),o,this,this.#r);this.#i.register(s)}),this.#r.process(hl,this),e(this)})})}entries(){return this.#i.entries()}filter(e){return this.entries().filter(e)}forEach(e){return this.#i.forEach(e)}get(e,i){return this.entries()[this.#e.coordsToIndex(e,i)]}height(){return this.#t}includes(e){return this.#i.includes(e)}map(e){return this.#i.map(e)}register(...e){this.#i.register(...e)}tiles(){return this.entries()}width(){return this.#o}};t(HO,"World");t1=HO});var CH,i1,o1=n(()=>{WO();w();V();v();ob();nb();r1();CH=t((r=d,e=jp,i=b)=>[new jO(new p(()=>{let[o]=r.process(LO),a=new o(parseInt(i.option("height",100),10),parseInt(i.option("width",160),10),{landCoverage:parseFloat(i.option("landCoverage",.4)),landSize:parseFloat(i.option("landSize",.2)),maxIterations:parseInt(i.option("maxIterations",20),10)});new t1(a,r).build()}))],"getRules"),i1=CH});var TH,n1,a1=n(()=>{Tu();yo();Ca();ea();Bn();gn();ln();Vr();I();v();mR();TH=t((r=Fe,e=gt,i=Ot)=>[...[[Q,et,1],[Q,Re,2],[Q,Me,1],[Q,nt,1],[Q,pt,1],[Q,pe,1],[Q,ae,2],[Q,at,1],[Q,ht,1],[J,Ie,1],[J,et,2],[J,He,1],[J,pe,1]].map(([o,a,s])=>new fi(new m(l=>l.terrain()instanceof a),new p(()=>new o(s,a.name)))),...[[J,pn,2],[Q,un,1],[Q,wi,1],[me,cn,2],[me,yn,3],[J,co,1],[Q,Ii,2],[J,fn,3],[Q,dn,2],[J,mn,1]].map(([o,a,s])=>new fi(new m(l=>e.getByTerrain(l.terrain()).some(u=>u instanceof a)),new p(()=>new o(s,a.name)))),...[[J,pn,1],[Q,un,1],[Q,wi,1],[me,cn,2],[me,yn,2],[J,co,1],[Q,Ii,1],[J,fn,1],[Q,dn,1]].map(([o,a,s])=>new fi(new m((l,u)=>{if(!u)return!1;try{return i.getByPlayer(u).is(Ut,ut,ct,xt)}catch{return!1}}),new m(l=>e.getByTerrain(l.terrain()).some(u=>u instanceof a)),new p(()=>new o(s,a.name)))),new fi(new m(o=>o.terrain()instanceof pt),new p(()=>new me(2,pt.name))),new fi(new m(o=>o.terrain()instanceof ae),new p(()=>new me(1))),new fi(new m((o,a)=>{if(!a)return!1;try{return i.getByPlayer(a).is(ut,xt)}catch{return!1}}),new m(o=>o.terrain()instanceof ae||o.terrain()instanceof pt),new p(()=>new me(1,pt.name))),...[[Ie,Q,Ue,1],[Ie,J,ot,1],[Me,Q,Ue,1],[Me,J,ot,2],[He,J,ot,1],[pe,Q,Ue,1]].map(([o,a,s,l])=>new fi(new m(u=>u.terrain()instanceof o),new m(u=>r.getByTile(u).some(c=>c instanceof s)),new p(()=>new a(l,s.name)))),...[[Ie,J,ot,1],[Re,Q,Ue,1],[Me,J,ot,1],[He,J,ot,1],[ae,Q,Ue,1]].map(([o,a,s,l])=>new fi(new m((u,c)=>{if(!c)return!1;try{return i.getByPlayer(c).is(Ut,ut,ct,xt)}catch{return!1}}),new m(u=>u.terrain()instanceof o),new m(u=>r.getByTile(u).some(c=>c instanceof s)),new p(()=>new a(l,s.name)))),...[Ie,Re,pe].map(o=>new fi(new m(a=>a.terrain()instanceof o),new m(a=>r.getByTile(a).some(s=>s instanceof je)),new p(()=>new me(1,je.name)))),...[Ie,Re,pe].map(o=>new fi(new m((a,s)=>{if(!s)return!1;try{return i.getByPlayer(s).is(ut,xt)}catch{return!1}}),new m(a=>a.terrain()instanceof o),new m(a=>r.getByTile(a).some(s=>s instanceof je)),new p(()=>new me(1,je.name))))],"getRules"),n1=TH});var PH,s1,l1=n(()=>{Ca();Vr();I();v();ha();ea();lR();PH=t((r=Fe)=>[...[[Q,.5],[J,.5],[me,.5]].map(([e,i])=>new Wc(new ga,new m((o,a,s)=>s.some(l=>l instanceof e)),new m(o=>r.getByTile(o).some(a=>a instanceof ur)),new p((o,a,s)=>{let l=s.filter(u=>u instanceof e).reduce((u,c)=>u+c.value(),0);s.push(new e(Math.floor(l*i),ur.name))})))],"getRules"),s1=PH});var wH,m1,p1=n(()=>{V();WO();Sh();v();ob();wH=t((r=jp,e=b,i=()=>Math.random())=>[new LO(new p(()=>{if(e.option("earth",!1))return kp;let o=r.entries();if(o.length===0)throw new TypeError("No available `World` generators.");return o[Math.floor(o.length*i())]}))],"getRules"),m1=wH});var IH={};var u1=n(()=>{Wk();Lk();jk();_k();qk();Jk();w();Qk();e1();o1();a1();l1();p1();d.register(...Yk(),...zk(),...Nk(),...Hk(),...Kk(),...Vk(),...Zk(),...Xk(),...i1(),...n1(),...s1(),...m1())});var _O,KO,ab=n(()=>{to();hm();_O=class extends _e{constructor(){super(Wn)}};t(_O,"TerrainRegistry");KO=new _O});var AH={};var c1=n(()=>{yo();ab();KO.register(Wt,Ie,et,Re,Me,nt,He,pt,pe,ae,at,ht)});var BH={};var y1=n(()=>{Tu();Qv();DO.register(pn,un,wi,cn,yn,co,Ii,fn,dn,mn)});var d1=T(f1=>{"use strict";Object.defineProperty(f1,"__esModule",{value:!0});u1();c1();y1()});var GH,g1,h1=n(()=>{qe();ft();ao();di();GH=t((r=N)=>[new $(K,"cities",e=>r.getByPlayer(e)),new $(ue,"city",e=>r.getByTile(e))],"getAdditionalData"),g1=GH});var UH,O1,R1=n(()=>{ro();ft();di();UH=t((r=ze)=>[new $(ue,"workedBy",e=>r.getByTile(e)?.city()??null)],"getAdditionalData"),O1=UH});var MH={};var x1=n(()=>{h1();Tt();R1();te.register(...g1(),...O1())});var b1=T(v1=>{"use strict";Object.defineProperty(v1,"__esModule",{value:!0});x1()});var DH,C1,T1=n(()=>{Ln();ft();zn();DH=t((r=kt)=>[new $(Ke,"build",e=>r.getByCity(e))],"getAdditionalData"),C1=DH});var EH={};var P1=n(()=>{T1();Tt();te.register(...C1())});var I1=T(w1=>{"use strict";Object.defineProperty(w1,"__esModule",{value:!0});P1()});var SH,A1,B1=n(()=>{It();ft();zn();SH=t((r=X)=>[new $(Ke,"growth",e=>r.getByCity(e))],"getAdditionalData"),A1=SH});var FH={};var G1=n(()=>{Tt();B1();te.register(...A1())});var M1=T(U1=>{"use strict";Object.defineProperty(U1,"__esModule",{value:!0});G1()});var kH,D1,E1=n(()=>{w();ft();zg();zn();Zl();kH=t((r=d)=>[new $(Ke,"civilDisorder",e=>r.process(No,e,e.yields()).some(i=>i)),new $(Ke,"celebrateLeader",e=>r.process(Tp,e,e.yields()).some(i=>i))],"getAdditionalData"),D1=kH});var YH={};var S1=n(()=>{E1();Tt();te.register(...D1())});var k1=T(F1=>{"use strict";Object.defineProperty(F1,"__esModule",{value:!0});S1()});var WH,Y1,W1=n(()=>{vr();ft();zn();WH=t((r=Pe)=>[new $(Ke,"improvements",e=>r.getByCity(e))],"getAdditionalData"),Y1=WH});var zH={};var z1=n(()=>{Tt();W1();te.register(...Y1())});var N1=T(L1=>{"use strict";Object.defineProperty(L1,"__esModule",{value:!0});z1()});var LH,j1,H1=n(()=>{fl();ft();di();LH=t((r=Jr)=>[new $(ue,"goodyHut",e=>r.getByTile(e))],"getAdditionalData"),j1=LH});var NH={};var _1=n(()=>{Tt();H1();te.register(...j1())});var q1=T(K1=>{"use strict";Object.defineProperty(K1,"__esModule",{value:!0});_1()});var jH,V1,J1=n(()=>{gn();ft();ao();jH=t((r=Ot)=>[new $(K,"government",e=>r.getByPlayer(e))],"getAdditionalData"),V1=jH});var HH={};var $1=n(()=>{J1();Tt();te.register(...V1())});var Q1=T(Z1=>{"use strict";Object.defineProperty(Z1,"__esModule",{value:!0});$1()});var _H,X1,eY=n(()=>{Kr();ft();ao();_H=t((r=ee)=>[new $(K,"world",e=>r.getByPlayer(e))],"getAdditionalData"),X1=_H});var KH={};var tY=n(()=>{Tt();eY();te.register(...X1())});var iY=T(rY=>{"use strict";Object.defineProperty(rY,"__esModule",{value:!0});tY()});var qH,oY,nY=n(()=>{We();ft();ao();qH=t((r=L)=>[new $(K,"research",e=>r.getByPlayer(e))],"getAdditionalData"),oY=qH});var VH={};var aY=n(()=>{Tt();nY();te.register(...oY())});var lY=T(sY=>{"use strict";Object.defineProperty(sY,"__esModule",{value:!0});aY()});var JH,mY,pY=n(()=>{am();ft();ao();JH=t((r=Ho)=>[new $(K,"spaceship",e=>r.getActiveByPlayer(e))],"getAdditionalData"),mY=JH});var $H={};var uY=n(()=>{Tt();pY();te.register(...mY())});var yY=T(cY=>{"use strict";Object.defineProperty(cY,"__esModule",{value:!0});uY()});var ZH,fY,dY=n(()=>{ln();ft();hm();ZH=t((r=gt)=>[new $(Wn,"features",e=>r.getByTerrain(e))],"getAdditionalData"),fY=ZH});var QH={};var gY=n(()=>{Tt();dY();te.register(...fY())});var OY=T(hY=>{"use strict";Object.defineProperty(hY,"__esModule",{value:!0});gY()});var XH,RY,xY=n(()=>{Vr();ft();di();XH=t((r=Fe)=>[new $(ue,"improvements",e=>r.getByTile(e))],"getAdditionalData"),RY=XH});var e_={};var vY=n(()=>{Tt();xY();te.register(...RY())});var CY=T(bY=>{"use strict";Object.defineProperty(bY,"__esModule",{value:!0});vY()});var t_,TY,PY=n(()=>{nc();ft();ao();t_=t((r=bl)=>[new $(K,"rates",e=>r.getByPlayer(e))],"getAdditionalData"),TY=t_});var r_={};var wY=n(()=>{Tt();PY();te.register(...TY())});var AY=T(IY=>{"use strict";Object.defineProperty(IY,"__esModule",{value:!0});wY()});var i_,BY,GY=n(()=>{w();ft();Jp();$p();i_=t((r=d)=>[new $(As,"spendCost",e=>r.process(oo,e))],"getAdditionalData"),BY=i_});var o_,UY,MY=n(()=>{Ul();ft();ao();o_=t((r=hi)=>[new $(K,"treasuries",e=>r.getByPlayer(e))],"getAdditionalData"),UY=o_});var n_={};var DY=n(()=>{Tt();GY();MY();te.register(...BY(),...UY())});var SY=T(EY=>{"use strict";Object.defineProperty(EY,"__esModule",{value:!0});DY()});var qO,FY,kY=n(()=>{A();qO=class extends g{};t(qO,"End");FY=qO});var a_,YY,WY=n(()=>{V();w();Yt();kY();nb();_v();a_=t((r=d,e=b,i=ie)=>[["engine:start",()=>{r.process(jO)}],...["game:start","turn:end"].map(o=>[o,()=>{e.emit("turn:start",i.increment())}]),["turn:end",()=>{r.process(FY,i)}],["turn:start",()=>{r.process(yO,i)}]],"getEvents"),YY=a_});var s_={};var zY=n(()=>{V();WY();[...YY()].forEach(([r,e])=>{b.on(r,e)})});var NY=T(LY=>{"use strict";Object.defineProperty(LY,"__esModule",{value:!0});zY()});var l_,jY,HY=n(()=>{Ve();ft();zn();ao();di();l_=t((r=j)=>[new $(Ke,"units",e=>r.getByCity(e)),new $(K,"units",e=>r.getByPlayer(e,!0)),new $(ue,"units",e=>r.getByTile(e))],"getAdditionalData"),jY=l_});var m_={};var _Y=n(()=>{Tt();HY();te.register(...jY())});var qY=T(KY=>{"use strict";Object.defineProperty(KY,"__esModule",{value:!0});_Y()});var p_,VY,JY=n(()=>{wa();ft();Ra();p_=t((r=cr)=>[new $(Ge,"improvements",e=>r.getByUnit(e))],"getAdditionalData"),VY=p_});var u_={};var $Y=n(()=>{Tt();JY();te.register(...VY())});var QY=T(ZY=>{"use strict";Object.defineProperty(ZY,"__esModule",{value:!0});$Y()});var VO,XY,eW=n(()=>{to();Tx();VO=class extends _e{constructor(){super(Fd)}};t(VO,"AIClientRegistry");XY=new VO});var c_={};var tW=n(()=>{eW();sp();XY.register(la)});var y_,rW,iW=n(()=>{Kl();Ve();wl();I();v();sp();y_=t((r=j,e=Lo)=>[new lr(new m((i,o)=>e.getByPlayer(o)instanceof la),new p((i,o,a)=>e.getByPlayer(o).cityLost(i,a,!1)))],"getRules"),rW=y_});var f_,oW,nW=n(()=>{Kl();Ve();I();Il();v();sp();f_=t((r=j,e=Lo)=>[new Cr(new m(i=>e.getByPlayer(i.player())instanceof la),new p((i,o)=>e.getByPlayer(i.player()).cityLost(i,o,!0)))],"getRules"),oW=f_});var d_,aW,sW=n(()=>{Kl();Ve();I();Ru();v();sp();d_=t((r=j,e=Lo)=>[new an(new m(i=>e.getByPlayer(i.player())instanceof la),new p((i,o)=>e.getByPlayer(i.player()).unitDestroyed(i,o&&o.player())))],"getRules"),aW=d_});var g_={};var lW=n(()=>{w();iW();nW();sW();d.register(...rW(),...aW(),...oW())});var pW=T(mW=>{"use strict";Object.defineProperty(mW,"__esModule",{value:!0});tW();lW()});var JO,uW,cW=n(()=>{Xv();Dh();sr();w();ab();eb();Mv();JO=class extends Fp{#e;#t;#r;#i;#o;#n;#a;#s;#l;#m;constructor(e=100,i=160,o={},a=d,s=KO,l=()=>Math.random()){super(e,i);let{landCoverage:u=.4,landSize:c=.2,maxIterations:y=10,clusterChance:f=.05,coverage:h=.25,pathChance:G=.05}=o;this.#e=u,this.#t=c,this.#r=y,this.#i=f,this.#o=h,this.#n=G,this.#l=a,this.#m=s,this.#s=l,this.#a=new Array(this.height()*this.width()).fill(0).map(()=>new ar)}async generateIslands(){let e=this.height(),i=this.width(),o=this.#t+this.#s()*.2,a=this.#e,s=this.#r,l=Math.ceil(e*i/100*o),u=new Array(e*i).fill(0);for(;u.length===0||u.filter(c=>c===1).length/u.length<a;){let c={},y=[],f=[],h=Math.floor(e*i*Math.random()),G=t(D=>{D in c||(c[D]=0),c[D]++},"flagAsSeen");for(u[h]=1,y.push(h),G(h),f.push(...nm(e,i,h));f.length;){let D=f.shift();if((c[D]||0)<=s&&(Math.random()>.3?(u[D]=1,y.push(D),nm(e,i,D).filter(B=>f.indexOf(B)===-1).forEach(B=>f.push(B))):nm(e,i,D).forEach(B=>{let E=f.indexOf(B);E>-1&&f.splice(E,1)}),G(D)),y.length>l||u.filter(B=>B===1).length/u.length>=a)break}if(u.filter(D=>D===1).length/u.length>=a)break}this.#a=u.map(c=>c===1?new _:new ar)}generate(){return this.generateIslands().then(()=>this.populateTerrain().then(()=>this.#a))}getNeighbours(e,i=!0){return nm(this.height(),this.width(),e,i)}populateTerrain(){return new Promise(e=>{let i=this.#l.get(Ht);this.#l.get(SO).filter(o=>o.validate()).map(o=>{let a=o.process();if(!a)throw new TypeError("Unexpected data from DistributionGroups.");return a}).forEach(o=>o.forEach(a=>i.filter(s=>s.validate(a,this.#a)).map(s=>{let l=s.process(a,this.#a);if(!l)throw new TypeError("Unexpected data from Distribution.");return l}).forEach(s=>s.forEach(({cluster:l=!1,clusterChance:u=this.#i,coverage:c=this.#o,fill:y=!1,from:f=0,path:h=!1,pathChance:G=this.#n,to:D=1})=>{let B=Object.keys(this.#a).map(Y=>parseInt(Y,10)).filter(Y=>this.#a[Y]instanceof a.__proto__).filter(Y=>Y>=f*this.height()*this.width()&&Y<=D*this.height()*this.width());if(y){B.forEach(Y=>{this.#a[Y]=new a});return}let E=B.length*c;for(;E>0;){let Y=B[Math.floor(this.#s()*B.length)];if(this.#a[Y]=new a,E--,l){let ce=this.getNeighbours(Y).filter(Ft=>!(this.#a[Ft]instanceof a));for(;ce.length&&E>0;){let Ft=ce.shift();u>=this.#s()/this.distanceFrom(Y,Ft)&&(this.#a[Ft]=new a,E--,ce.push(...this.getNeighbours(Ft).filter(Hr=>!(this.#a[Hr]instanceof a)).filter(Hr=>this.#a[Hr]instanceof a.__proto__).filter(Hr=>!ce.includes(Hr))))}}if(h){let ce=Y;for(;G>=this.#s();){let Ft=this.getNeighbours(ce).filter(Hr=>this.#a[Hr]instanceof a.__proto__&&!(this.#a[Hr]instanceof a));ce=Ft[Math.floor(this.#s()*Ft.length)],this.#a[ce]=new a,E--}}}})))),e()})}};t(JO,"BaseGenerator");uW=JO});var h_={};var yW=n(()=>{cW();WO();jp.register(uW)});var dW=T(fW=>{"use strict";Object.defineProperty(fW,"__esModule",{value:!0});yW()});var O_={};var j$e,H$e,_$e,K$e,q$e,V$e,J$e,$$e,Z$e,Q$e,X$e,e8e,t8e,r8e,i8e,o8e,n8e,a8e,s8e,l8e,m8e,p8e,u8e,c8e,y8e,f8e,d8e,g8e,h8e,O8e,R8e,x8e,v8e,b8e,C8e,T8e,P8e,w8e,I8e,A8e,B8e,G8e,U8e,M8e,D8e,E8e,S8e,F8e,k8e,Y8e,W8e,z8e,L8e,N8e,j8e,H8e,_8e,K8e,q8e,V8e,J8e,$8e,Z8e,Q8e,X8e,e9e,t9e,r9e,i9e,o9e,n9e,a9e,s9e,l9e,m9e,p9e,u9e,c9e,y9e,f9e,d9e,g9e,h9e,O9e,R9e,x9e,v9e,b9e,C9e,T9e,P9e,w9e,I9e,A9e,B9e,G9e,U9e,M9e,D9e,E9e,S9e,F9e,k9e,Y9e,W9e,z9e,L9e,N9e,j9e,H9e,_9e,K9e,q9e,V9e,J9e,$9e,Z9e,Q9e,gW=n(()=>{"use strict";j$e=P(Tw()),H$e=P(Aw()),_$e=P(Mw()),K$e=P(Fw()),q$e=P(zw()),V$e=P(Hw()),J$e=P(Vw()),$$e=P(Qw()),Z$e=P(rI()),Q$e=P(aI()),X$e=P(pI()),e8e=P(fI()),t8e=P(OI()),r8e=P(bI()),i8e=P(PI()),o8e=P(AI()),n8e=P(UI()),a8e=P(EI()),s8e=P(kI()),l8e=P(zI()),m8e=P(jI()),p8e=P(KI()),u8e=P(JI()),c8e=P(QI()),y8e=P(tA()),f8e=P(oA()),d8e=P(sA()),g8e=P(pA()),h8e=P(yA()),O8e=P(gA()),R8e=P(RA()),x8e=P(bA()),v8e=P(PA()),b8e=P(AA()),C8e=P(UA()),T8e=P(EA()),P8e=P(kA()),w8e=P(zA()),I8e=P(jA()),A8e=P(KA()),B8e=P(JA()),G8e=P(QA()),U8e=P(tB()),M8e=P(oB()),D8e=P(sB()),E8e=P(pB()),S8e=P(yB()),F8e=P(gB()),k8e=P(RB()),Y8e=P(bB()),W8e=P(PB()),z8e=P(AB()),L8e=P(UB()),N8e=P(EB()),j8e=P(kB()),H8e=P(zB()),_8e=P(jB()),K8e=P(KB()),q8e=P(JB()),V8e=P(QB()),J8e=P(tG()),$8e=P(oG()),Z8e=P(sG()),Q8e=P(pG()),X8e=P(yG()),e9e=P(gG()),t9e=P(RG()),r9e=P(bG()),i9e=P(PG()),o9e=P(AG()),n9e=P(UG()),a9e=P(EG()),s9e=P(kG()),l9e=P(zG()),m9e=P(jG()),p9e=P(KG()),u9e=P(JG()),c9e=P(QG()),y9e=P(tU()),f9e=P(oU()),d9e=P(sU()),g9e=P(VU()),h9e=P(dM()),O9e=P(WM()),R9e=P(zD()),x9e=P(qD()),v9e=P(rE()),b9e=P(uE()),C9e=P(gE()),T9e=P(DE()),P9e=P(_E()),w9e=P(I0()),I9e=P(V0()),A9e=P(MS()),B9e=P(VS()),G9e=P(sF()),U9e=P(_F()),M9e=P(kk()),D9e=P(d1()),E9e=P(b1()),S9e=P(I1()),F9e=P(M1()),k9e=P(k1()),Y9e=P(N1()),W9e=P(q1()),z9e=P(Q1()),L9e=P(iY()),N9e=P(lY()),j9e=P(yY()),H9e=P(OY()),_9e=P(CY()),K9e=P(AY()),q9e=P(SY()),V9e=P(NY()),J9e=P(qY()),$9e=P(QY()),Z9e=P(pW()),Q9e=P(dW())});eR();dR();gR();hy();Im();var Qp=class extends Ds{#e;#t;constructor(e,i=jn,o=()=>Math.random()){super(e),this.#e=i,this.#t=o}chooseCivilization(e){let i=e[Math.floor(e.length*this.#t())],o=this.player(),a=new i;o.setCivilization(a),this.chooseLeader(a)}chooseLeader(e){let i=this.#e.getByCivilization(e.constructor),o=i[Math.floor(i.length*this.#t())];e.setLeader(new o)}};t(Qp,"Client");OR();Tr();RR();zn();My();Se();qt();PR();Z();var Ys,zy=class{constructor(){xe(this,Ys,[])}add(e,i,o=null){C(this,Ys).push({[e]:{type:"add",index:o,value:i}})}clear(){C(this,Ys).splice(0)}remove(e,i=null){C(this,Ys).push({[e]:{type:"remove",index:i}})}transferData(){return C(this,Ys).slice(0).map(e=>{let i={};return Object.entries(e).forEach(([o,{type:a,index:s,value:l}])=>{i[o]={type:a,index:s,value:typeof l=="function"?l():l}}),i})}update(e,i,o=null){C(this,Ys).push({[e]:{type:"update",index:o,value:i}})}};t(zy,"DataQueue"),Ys=new WeakMap;var Yb=zy;Ny();wR();IR();Cl();ao();BR();tf();var rf=class extends Error{constructor(e,i,o){super(e)}};t(rf,"RetryFailed");var _b=rf;var tu,ru,Mm,iu,Dm,ou,nu,of=class{constructor(e,i=5,o=100){xe(this,tu,0);xe(this,ru,void 0);xe(this,Mm,void 0);xe(this,iu,void 0);xe(this,Dm,void 0);xe(this,ou,void 0);xe(this,nu,void 0);Ye(this,Mm,e),Ye(this,iu,i),Ye(this,Dm,setInterval(()=>this.run(),o)),Ye(this,ru,new Promise((a,s)=>{Ye(this,nu,a),Ye(this,ou,s)}))}run(){if(++mb(this,tu)._>C(this,iu)){clearInterval(C(this,Dm)),C(this,ou).call(this,new _b("Retry failed.",C(this,Mm),C(this,tu)));return}C(this,Mm).call(this)&&(clearInterval(C(this,Dm)),C(this,nu).call(this))}then(){return C(this,ru)}};t(of,"Retryable"),tu=new WeakMap,ru=new WeakMap,Mm=new WeakMap,iu=new WeakMap,Dm=new WeakMap,ou=new WeakMap,nu=new WeakMap;var Kb=of;UR();Z();var nf=class extends ve{constructor(e){super(),Object.assign(this,e),this.addKey(...Object.keys(e))}};t(nf,"TransferObject");var af=nf;di();Ra();Z();It();var lu,mu,pu,uu,kR=class extends ve{constructor(i,o,a,s){super();xe(this,lu,void 0);xe(this,mu,void 0);xe(this,pu,{size:0});xe(this,uu,void 0);Ye(this,lu,i),Ye(this,mu,a),C(this,pu).size=s,Ye(this,uu,o),this.addKey("_","growth","name","player","tile")}static fromCity(i){let o=X.getByCity(i);return new kR(i.name(),i.tile(),i.player(),o.size())}_(){return"City"}name(){return C(this,lu)}player(){return C(this,mu)}growth(){return C(this,pu)}tile(){return C(this,uu)}},df=kR;t(df,"City"),lu=new WeakMap,mu=new WeakMap,pu=new WeakMap,uu=new WeakMap;var eC=df;Z();var cu,YR=class extends ve{constructor(i){super();xe(this,cu,void 0);Ye(this,cu,i),this.addKey("_","civilization")}static fromPlayer(i){return new YR(i.civilization())}_(){return"Player"}civilization(){return C(this,cu)}},gf=YR;t(gf,"Player"),cu=new WeakMap;var tC=gf;Z();var yu,fu,du,WR=class extends ve{constructor(i,o,a){super();xe(this,yu,void 0);xe(this,fu,void 0);xe(this,du,void 0);Ye(this,yu,i),Ye(this,fu,o),Ye(this,du,a),this.addKey("_","tile","player")}static fromUnit(i){return new WR(i.constructor.name,i.tile(),i.player())}_(){return C(this,yu)}player(){return C(this,du)}tile(){return C(this,fu)}},hf=WR;t(hf,"Unit"),yu=new WeakMap,fu=new WeakMap,du=new WeakMap;var rC=hf;Be();U();qe();zm();V();Im();Ns();We();Ul();Kr();Yt();Ve();LR();Hs();Ta();var uC=t(r=>r instanceof ve?{"#ref":r.id()}:r,"referenceObject"),Ne=t((...r)=>e=>r.some(i=>e instanceof i)?uC(e):e,"filterToReference"),pC=t((...r)=>e=>r.some(i=>e instanceof i)?e:uC(e),"filterToReferenceAllExcept"),qR=new Map,VR=new Map,JR=new Map,ge,ne,zl,$s,Vn,Ou,Uf=class extends Qp{constructor(i,o,a){super(i);xe(this,ge,t((i=o=>o)=>o=>o instanceof K&&o!==this.player()?(qR.has(o)||qR.set(o,tC.fromPlayer(o)),qR.get(o)):o instanceof Ge&&o.player()!==this.player()?(VR.has(o)||VR.set(o,rC.fromUnit(o)),VR.get(o)):o instanceof Ke&&o.player()!==this.player()?(JR.has(o)||JR.set(o,eC.fromCity(o)),JR.get(o)):o instanceof ue?ee.getByPlayer(this.player()).get(o.x(),o.y()):o instanceof Ae?{_:o.constructor.name}:i(o),"#dataFilter"));xe(this,ne,new Yb);xe(this,zl,void 0);xe(this,$s,void 0);xe(this,Vn,void 0);xe(this,Ou,!1);Ye(this,zl,new Hy),Ye(this,Vn,o),Ye(this,$s,a),C(this,$s).call(this,"action",(...s)=>{C(this,zl).emit("action",...s)}),C(this,$s).call(this,"cheat",({name:s,value:l})=>{if(s==="RevealMap"){let u=ee.getByPlayer(this.player()),[c]=u.entries();c.tile().map().entries().forEach(y=>{if(u.includes(y))return;u.register(y);let f=u.getByTile(y);C(this,ne).add(u.id(),()=>y.toPlainObject(C(this,ge).call(this)),`entries[${u.entries().indexOf(f)}]`)})}if(s==="GrantAdvance"){let[u]=R.filter(y=>y.name===l),c=L.getByPlayer(this.player());if(!u||c.completed(u))return;c.addAdvance(u),C(this,ne).add(c.id(),c.toPlainObject(C(this,ge).call(this,Ne(K))))}if(s==="GrantGold"){let u=hi.getByPlayerAndType(this.player(),Ee);u.add(l),C(this,ne).add(u.id(),u.toPlainObject(C(this,ge).call(this,Ne(K))))}if(s==="ModifyUnit"){let{unitId:u,properties:c}=l,[y]=j.getBy("id",u);if(!y)return;["attack","defence","moves","movement","visibility"].forEach(f=>{f in c&&y[f]().set(c[f])}),C(this,ne).add(y.id(),y.toPlainObject(C(this,ge).call(this,Ne(K))))}this.sendPatchData()}),b.on("engine:plugins:load:failed",(s,l)=>{console.log(s+" failed to load"),console.error(l)}),b.on("player:visibility-changed",(s,l)=>{if(l!==this.player())return;let u=ee.getByPlayer(this.player()),c=u.getByTile(s);if(c===null){new Kb(()=>{let y=u.getByTile(s);return y===null?!1:(C(this,ne).add(u.id(),()=>s.toPlainObject(C(this,ge).call(this,Ne(K))),`tiles[${u.entries().indexOf(y)}]`),!0)},2,20);return}C(this,ne).add(u.id(),()=>c.toPlainObject(C(this,ge).call(this,Ne(K))),`tiles[${u.entries().indexOf(c)}]`)}),["unit:created","unit:defeated"].forEach(s=>{b.on(s,l=>{let u=ee.getByPlayer(this.player()),c=u.getByTile(l.tile());if(!!c&&(C(this,ne).update(c.id(),()=>c.toPlainObject(C(this,ge).call(this,Ne(K)))),l.player()===this.player())){if(s==="unit:created"){let y=j.getByPlayer(this.player()),f=y.indexOf(l),h=j.getByCity(l.city()),G=h.indexOf(l),D=j.getByTile(l.tile()),B=D.indexOf(l);C(this,ne).add(i.id(),()=>l.toPlainObject(C(this,ge).call(this,Ne(ue,K,Gm,Ke))),`units[${f}]`),C(this,ne).add(c.id(),()=>l.toPlainObject(C(this,ge).call(this,Ne(Ge))),`units[${B}]`),l.city()!==null&&C(this,ne).add(l.city().id(),()=>l.toPlainObject(C(this,ge).call(this,Ne(Ge))),`units[${G}]`);return}C(this,ne).update(this.player().id(),()=>this.player().toPlainObject(C(this,ge).call(this,pC(K,Ge))))}})}),["unit:destroyed"].forEach(s=>{b.on(s,(l,u)=>{l.player()===this.player()&&l.city()!==null&&C(this,ne).update(l.city().id(),()=>l.city().toPlainObject(C(this,ge).call(this,Ne(Nn,Dl,z,K,Gm,ue,Ge))))})}),["unit:moved"].forEach(s=>{b.on(s,(l,u)=>{let c=ee.getByPlayer(this.player()),y=c.getByTile(u.from()),f=c.getByTile(u.to());!y&&!f||(y&&C(this,ne).update(y.id(),()=>y.toPlainObject(C(this,ge).call(this,Ne(K,Ke)))),f&&C(this,ne).update(f.id(),()=>f.toPlainObject(C(this,ge).call(this,Ne(K,Ke)))),l.player()===this.player()&&l.city()!==null&&C(this,ne).update(l.city().id(),()=>l.city().toPlainObject(C(this,ge).call(this,Ne(Nn,Dl,z,K,Gm,ue,Ge)))))})}),["tile-improvement:built","tile-improvement:pillaged"].forEach(s=>{b.on(s,l=>{let u=ee.getByPlayer(this.player()),c=u.getByTile(l);c&&C(this,ne).update(c.id(),()=>c.toPlainObject(C(this,ge).call(this,Ne(K,Ke))))})}),b.on("city:captured",(s,l,u)=>{if(u===this.player()){N.getByPlayer(this.player()).indexOf(s)!==-1&&C(this,ne).update(this.player().id(),()=>this.player().toPlainObject(C(this,ge).call(this,pC(K)))),this.sendNotification(`${l.civilization().name()} have captured our city ${s.name()}!`);return}if(l===this.player()){this.sendNotification(`We have captured ${s.name()} from ${u.civilization().name()}!`);return}}),["city:created","city:captured","city:destroyed","city:grow","city:shrink"].forEach(s=>{b.on(s,l=>{let u=ee.getByPlayer(this.player()),c=u.getByTile(l.tile());!c||C(this,ne).update(c.id(),()=>c.toPlainObject(C(this,ge).call(this,Ne(K))))})}),b.on("city:shrink",s=>{s.player()===this.player()&&this.sendNotification(`Population decrease in ${s.name()}.`)}),b.on("city:unit-unsupported",(s,l)=>{s.player()===this.player()&&this.sendNotification(`${s.name()} cannot support ${l.constructor.name}.`)}),b.on("city:unsupported-improvement",(s,l)=>{s.player()===this.player()&&this.sendNotification(`${s.name()} cannot support ${l.constructor.name}.`)}),b.on("city:food-storage-exhausted",s=>{s.player()===this.player()&&this.sendNotification(`Food storage exhausted in ${s.name()}!`)}),b.on("city:building-complete",(s,l)=>{let u=ee.getByPlayer(this.player());if(s.city().player()!==this.player()&&l instanceof Oe){this.sendNotification(`${u.getByTile(s.city().tile())?s.city().name():"A faraway city"} has completed work on ${l.constructor.name}!`);return}s.city().player()!==this.player()&&!(l instanceof Oe)||(C(this,ne).update(s.id(),()=>s.toPlainObject(C(this,ge).call(this,Ne(ue,Ge,K)))),this.sendNotification(`${s.city().name()} has completed work on ${l.constructor.name}!`))}),b.on("player:research-complete",(s,l)=>{s.player()===this.player()&&(C(this,ne).update(s.id(),()=>s.toPlainObject(C(this,ge).call(this,Ne(K)))),this.sendNotification(`You have discovered the secrets of ${l.constructor.name}!`))}),b.on("goody-hut:action-performed",(s,l)=>{let u=s.tile();if(!!j.getByTile(u).some(y=>y.player()===this.player())){if(l instanceof Ts){this.sendNotification("You have discovered scrolls of ancient wisdom...");return}if(l instanceof ws){this.sendNotification("You have discovered an advanced tribe...");return}if(l instanceof Gs){this.sendNotification("You have discovered valuable treasure...");return}if(l instanceof Us){this.sendNotification("You have discovered a friendly tribe of skilled mercenaries...");return}}}),b.on("player:defeated",(s,l)=>{s===this.player()&&(this.sendNotification("You have been defeated!"),vi.unregister(...vi.entries()),rn.unregister(...rn.entries()),C(this,Vn).call(this,"restart",null)),this.sendNotification(`${s.civilization().name()} defeated${l?` by ${l.civilization().name()}`:""}.`)}),b.on("city:civil-disorder",s=>{s.player()===this.player()&&this.sendNotification(`Civil disorder in ${s.name()}!`)}),b.on("city:order-restored",s=>{s.player()===this.player()&&this.sendNotification(`Order restored in ${s.name()}!`)}),b.on("city:leader-celebration",s=>{s.player()===this.player()&&this.sendNotification(`We love the leader celebrations in ${s.name()}!`)}),b.on("city:leader-celebration-ended",s=>{s.player()===this.player()&&this.sendNotification(`We love the leader celebrations cancelled in ${s.name()}!`)}),b.on("player:spaceship:part-built",s=>{this.player()!==s&&this.sendNotification(`Component added to ${s.civilization().name()} spaceship.`)}),b.on("player:spaceship:lost",s=>{this.player()===s&&this.sendNotification("Our spaceship was lost in space.")}),b.on("player:spaceship:landed",s=>{this.player()===s&&this.sendNotification("Our spaceship has landed on Alpha Centauri!")})}chooseCivilization(i){let o=t(a=>(this.player().setCivilization(new a),this.chooseLeader(this.player().civilization())),"makeChoice");return new Promise((a,s)=>{if(i.length===1){let[l]=i;o(l).then(()=>a());return}C(this,Vn).call(this,"chooseCivilization",new af({choices:i}).toPlainObject()),C(this,$s).call(this,"chooseCivilization",l=>{let[u]=i.filter(c=>c.name===l);if(!u){s(`Invalid civilization ${l} (options: ${i.map(c=>c.name).join(", ")})`);return}o(u).then(()=>a())})})}chooseLeader(i){return new Promise((o,a)=>{let s=jn.getByCivilization(i.constructor);if(s.length===1){let[l]=s;i.setLeader(new l),o();return}C(this,Vn).call(this,"chooseLeader",new af({choices:s}).toPlainObject()),C(this,$s).call(this,"chooseLeader",l=>{let[u]=s.filter(c=>c.name===l);if(!u){a(`Invalid civilization ${l} (options: ${s.map(c=>c.name).join(", ")})`);return}i.setLeader(new u),o()})})}handleAction(...i){let[o]=i,a=this.player(),s=a.actions(),l=s.filter(f=>f instanceof yi),{name:u,id:c}=o;if(u==="ReassignWorkers"){let[f]=N.getBy("id",o.city);return f&&(Pf(f),C(this,ne).update(f.id(),f.toPlainObject(C(this,ge).call(this,Ne(K,ue))))),!1}if(u==="EndTurn")return l.length===1&&l.every(f=>f instanceof El);if(!u)return console.log("action not specified: ",o),!1;let[y]=s.filter(f=>f.constructor.name===u&&c===(f.value()?f.value().id():void 0));if(!y)return console.log("action not specified"),!1;if(y instanceof Rs){let{unitAction:f,target:h}=o,G=y.value(),B=[...G.actions(),...Object.values(G.actionsForNeighbours())].flat().filter(Y=>Y.constructor.name===f);for(;B.length!==1;){if(B.length===0)return console.log(`action not found: ${f}`),!1;let[Y]=ee.getByPlayer(this.player()).filter(ce=>ce.id()===h);if(!Y)return console.log(`tile not found: ${h}`),!1;if(B=B.filter(ce=>ce.to()===Y.tile()),B.length>1&&!h)return console.log(`too many actions found: ${f} (${B.length})`),!1}let[E]=B;return E.perform(),!1}if(y instanceof xs){let f=y.value();return f.moves().value()>0&&C(this,ne).update(f.id(),f.toPlainObject(C(this,ge).call(this,Ne(K,ue)))),f.activate(),!1}if(y instanceof Nn||y instanceof Ms){let f=y.value(),{chosen:h}=o;if(!h)return console.log("no build item specified"),!1;let[G]=f.available().filter(D=>D.item().name===h);return G?(f.build(G.item()),!1):(console.log(`build item not available: ${h}`),!1)}if(y instanceof Sb){let f=y.value(),{chosen:h}=o;if(!h)return this.sendNotification("no build item specified"),!1;let[G]=f.available().filter(D=>D.name===h);return G?(f.research(G),!1):(console.log(`build item not available: ${h}`),!1)}if(y instanceof ks){let f=y.value(),h=hi.getByPlayerAndType(this.player(),Ee);return h.buy(f.city()),C(this,ne).update(h.id(),h.toPlainObject(C(this,ge).call(this,Ne(K)))),!1}if(y instanceof Ws){let f=y.value(),{chosen:h}=o,[G]=f.available().filter(B=>B.name===h);if(!G)return console.error(`Government type: '${h}' not found.`),!1;f.set(new G);let D=ee.getByPlayer(this.player());return C(this,ne).update(D.id(),D.toPlainObject(C(this,ge).call(this,Ne(K)))),N.getByPlayer(this.player()).forEach(B=>C(this,ne).update(B.id(),B.toPlainObject(C(this,ge).call(this,Ne(K,ue,Ge))))),!1}if(y instanceof Ss){let f=y.value(),{value:h}=o;return f.setAll(h.map(([G,D])=>{let[B]=f.all().filter(E=>E.constructor.name===G);return[B.constructor,D]})),N.getByPlayer(this.player()).forEach(G=>C(this,ne).update(G.id(),G.toPlainObject(C(this,ge).call(this,Ne(K,ue,Ge))))),!1}return y instanceof Sl?(y.value().launch(),!1):(console.log(`unhandled action: ${JSON.stringify(o)}`),!1)}sendInitialData(){let i={player:this.player(),turn:ie,year:Lm},o=new af(i);C(this,Vn).call(this,"gameData",o.toPlainObject(C(this,ge).call(this))),Ye(this,Ou,!0)}sendPatchData(){C(this,Vn).call(this,"gameDataPatch",C(this,ne).transferData()),C(this,ne).clear()}sendNotification(i){C(this,Vn).call(this,"gameNotification",{message:i})}takeTurn(){return new Promise((i,o)=>{C(this,Ou)||this.sendInitialData(),setTimeout(()=>{C(this,ne).update(ie.id(),()=>ie.toPlainObject()),C(this,ne).update(Lm.id(),()=>Lm.toPlainObject()),C(this,ne).add(this.player().id(),()=>this.player().toPlainObject(C(this,ge).call(this,Ne(ue,de)))),this.sendPatchData()},1);let a=t((...s)=>{try{if(this.handleAction(...s)){C(this,zl).off("action",a),this.sendPatchData(),setTimeout(()=>i(),100);return}C(this,ne).update(this.player().id(),()=>this.player().toPlainObject(C(this,ge).call(this,Ne(Um,ue,Ke)))),this.sendPatchData()}catch(l){o(l)}},"listener");C(this,zl).on("action",a)})}};t(Uf,"DataTransferClient"),ge=new WeakMap,ne=new WeakMap,zl=new WeakMap,$s=new WeakMap,Vn=new WeakMap,Ou=new WeakMap;var cC=Uf;ao();sp();Kl();V();Ns();var _t,$O=class{constructor(e){xe(this,_t,void 0);Ye(this,_t,e),e.receive("start",()=>{this.bindEvents(),this.start()}),e.receive("setOption",({name:i,value:o})=>{C(this,_t).send("notification",`setting ${i} to ${o}`),b.setOption(i,o)}),e.receive("getOptions",i=>e.send("getOptions",i.reduce((o,a)=>(o[a]=b.option(a),o),{}))),e.receive("setOptions",i=>{Object.entries(i).forEach(([o,a])=>b.setOption(o,a)),e.send("setOptions")})}bindEvents(){C(this,_t).send("notification","binding events"),b.on("engine:initialise",()=>C(this,_t).send("notification","initialising...")),b.on("engine:plugins:load:success",e=>C(this,_t).send("notification",`loaded plugin: ${e}`)),b.on("engine:plugins-loaded",()=>C(this,_t).send("notification","plugins loaded")),b.on("engine:start",()=>C(this,_t).send("notification","starting...")),b.on("world:generate-start-tiles",()=>C(this,_t).send("notification","generating start tiles...")),b.on("world:built",()=>C(this,_t).send("notification","world built")),b.on("game:start",()=>C(this,_t).send("notification","game start")),b.on("turn:start",e=>C(this,_t).send("notification",`turn start ${e}`)),b.on("player:turn-start",e=>C(this,_t).send("notification",`player turn-start: ${e.civilization().constructor.name}`))}start(){b.on("engine:start",()=>{new Array(parseInt(b.option("players"),10)).fill(0).forEach((e,i)=>{let o=new K,a=i===0?new cC(o,(s,l)=>C(this,_t).send(s,l),(s,l)=>C(this,_t).receive(s,l)):new la(o);vi.register(o),Lo.register(a),C(this,_t).send("notification","generating world...")})}),b.start(),Promise.resolve().then(()=>(gW(),O_)).then(()=>b.emit("plugins:load:end"))}};t($O,"Game"),_t=new WeakMap;var hW=$O;var ZO=class{async request(e){return new Promise(i=>{this.send(e.channel(),...e.args()),this.receiveOnce(e.channel(),o=>i(o))})}};t(ZO,"AbstractTransport");var OW=ZO;var QO=class extends OW{receive(e,i){addEventListener("message",({data:{channel:o,data:a}})=>{o===e&&i(a)})}receiveOnce(e,i){addEventListener("message",({data:{channel:o,data:a}})=>{o===e&&i(a)},{once:!0})}send(e,i){postMessage({channel:e,data:i})}};t(QO,"ParentTransport");var RW=QO;var uZe=new hW(new RW);})();
//# sourceMappingURL=backend.js.map
