"use strict";(()=>{var vj=Object.create;var bc=Object.defineProperty;var bj=Object.getOwnPropertyDescriptor;var Cj=Object.getOwnPropertyNames;var Tj=Object.getPrototypeOf,Pj=Object.prototype.hasOwnProperty;var t=(i,e)=>bc(i,"name",{value:e,configurable:!0});var n=(i,e)=>()=>(i&&(e=i(i=0)),e);var w=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),qu=(i,e)=>{for(var r in e)bc(i,r,{get:e[r],enumerable:!0})},bT=(i,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Cj(e))!Pj.call(i,a)&&a!==r&&bc(i,a,{get:()=>e[a],enumerable:!(o=bj(e,a))||o.enumerable});return i};var A=(i,e,r)=>(r=i!=null?vj(Tj(i)):{},bT(e||!i||!i.__esModule?bc(r,"default",{value:i,enumerable:!0}):r,i)),v=i=>bT(bc({},"__esModule",{value:!0}),i);var CT=(i,e,r)=>{if(!e.has(i))throw TypeError("Cannot "+r)};var P=(i,e,r)=>(CT(i,e,"read from private field"),r?r.call(i):e.get(i)),ie=(i,e,r)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,r)},le=(i,e,r,o)=>(CT(i,e,"write to private field"),o?o.call(i,r):e.set(i,r),r),TT=(i,e,r,o)=>({set _(a){le(i,e,a,r)},get _(){return P(i,e,o)}});var W,rl,Re=n(()=>{W=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return this.#e.some(r=>e instanceof r)}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,r){return this.filter(o=>{let a=o[e];return a instanceof Function?a.bind(o)()===r:o[e]===r})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(r=>{if(!this.accepts(r))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${r}'.`);this.#t.includes(r)||this.#t.push(r)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(r=>{let o=this.#t.indexOf(r);o>-1&&this.#t.splice(o,1)})}};t(W,"EntityRegistry");rl=W});var Vu,ee,bt=n(()=>{Vu=class{#e;#t;#r;constructor(e,r,o){this.#e=r,this.#t=o,this.#r=e}data(...e){return this.#t(...e)}key(){return this.#e}type(){return this.#r}};t(Vu,"AdditionalData");ee=Vu});var Ju,ae,Et=n(()=>{Re();bt();Ju=class extends W{constructor(){super(ee)}getByType(e){return this.filter(r=>r.type()===e||Object.prototype.isPrototypeOf.call(r.type(),e)||Object.prototype.isPrototypeOf.call(r.type().prototype,e))}};t(Ju,"AdditionalDataRegistry");ae=new Ju});var Ij,xR,PT=n(()=>{J();Ij=t(i=>{let e=i instanceof ue?i.sourceClass():i,r=[];for(;e instanceof Function;)r.push(e),e=Object.getPrototypeOf(e);return r.map(o=>o.name)},"generateInheritance"),xR=Ij});var $u,wj,Cc,S,ue,J=n(()=>{Et();Re();PT();$u={},wj=t(i=>{let e=i.sourceClass().name,r=$u[e];return r||($u[e]=0),r>=Number.MAX_SAFE_INTEGER&&($u[e]=BigInt(r)),e+"-"+(++$u[e]).toString(36)},"idProvider"),Cc=t((i,e,r=a=>a,o=ae)=>{if(i=r(i),i instanceof rl&&(i=i.entries()),Array.isArray(i))return i.map(a=>Cc(a,e,r,o));if(i instanceof S){let a=i.id();if(!(a in e)){let s={_:i.sourceClass().name,__:xR(i)};e[a]=s,i.keys().forEach(l=>{let c=i[l]instanceof Function?i[l]():i[l];s[l]=Cc(c,e,r,o)}),o.getByType(i.sourceClass()).forEach(l=>{s[l.key()]=Cc(l.data(i),e,r,o)})}return{"#ref":a}}return i instanceof Function?{_:i.name,__:xR(i)}:i&&i instanceof Object?Object.entries(i).reduce((a,[s,l])=>(a[s]=Cc(l,e,r,o),a),{}):i},"toPlainObject"),S=class{#e;#t=["id"];constructor(){this.#e=wj(this)}addKey(...e){this.#t.push(...e)}id(){return this.#e}keys(){return this.#t}sourceClass(){return this.constructor}toPlainObject(e=o=>o,r=ae){let o={};return{hierarchy:Cc(this,o,e,r),objects:o}}};t(S,"DataObject");ue=S});var Um,br,fa=n(()=>{J();Um=class extends S{#e;#t;constructor(e,r){super(),this.#e=e,this.#t=r,this.addKey("value")}player(){return this.#e}value(){return this.#t}};t(Um,"PlayerAction");br=Um});var Zu,Hi,ql=n(()=>{fa();Zu=class extends br{};t(Zu,"MandatoryPlayerAction");Hi=Zu});var ln,OR=n(()=>{ql();ln=class extends Hi{};t(ln,"ActiveUnit")});var IT=n(()=>{OR();OR()});var mn,RR=n(()=>{fa();mn=class extends br{};t(mn,"InactiveUnit")});var wT=n(()=>{RR();RR()});var AT=n(()=>{IT();wT()});var vR=n(()=>{AT()});var il,BT=n(()=>{fa();il=class extends br{};t(il,"ChangeProduction")});var ya,GT=n(()=>{ql();ya=class extends Hi{};t(ya,"CityBuild")});var bR=n(()=>{BT();GT()});var Qu,MT,UT=n(()=>{J();Qu=class extends S{#e;constructor(e){super(),this.addKey("value"),this.#e=e}value(){return this.#e}};t(Qu,"Choice");MT=Qu});var ol,Dm,Tc=n(()=>{J();UT();ol=class extends S{#e=[];#t;#r;constructor(e,r,o){super(),this.addKey("choices","data","key"),e.forEach(a=>this.#e.push(new MT(a))),this.#t=o,this.#r=r}choices(){return this.#e}data(){return this.#t}key(){return this.#r}};t(ol,"ChoiceMeta");Dm=ol});var nl,DT,Xu=n(()=>{nl=class{#e;#t;constructor(e,r=()=>Math.random()){this.#e=e,this.#t=r}async chooseFromList(e){let r=e.choices(),o=r[Math.floor(this.#t()*r.length)];return console.log(e.key()),console.log(o),console.log(this.player()),o.value()}player(){return this.#e}async takeTurn(){throw new TypeError("Client#takeTurn must be implemented.")}};t(nl,"Client");DT=nl});var ef,Vl,tf=n(()=>{Xu();ef=class extends nl{};t(ef,"AIClient");Vl=ef});var al,ET=n(()=>{fa();al=class extends br{};t(al,"AdjustTradeRates")});var CR=n(()=>{ET()});var Em,m,D=n(()=>{Em=class{#e=null;constructor(e){e&&(this.#e=e)}validate(...e){return this.#e===null?!0:this.#e(...e)}};t(Em,"Criterion");m=Em});var rf,of,TR=n(()=>{D();rf=class extends m{#e=[];constructor(...e){super(),e.forEach(r=>{this.#e.push(r)})}criteria(){return this.#e}validate(...e){return this.#e.every(r=>r.validate(...e))}};t(rf,"Criteria");of=rf});var nf,da,af=n(()=>{TR();nf=class extends of{};t(nf,"And");da=nf});var sf,p,T=n(()=>{sf=class{#e;constructor(e){this.#e=e}apply(...e){return this.#e(...e)}};t(sf,"Effect");p=sf});var lf,bi,sl=n(()=>{lf=class{#e;constructor(e=2e3){this.#e=e}value(){return this.#e}};t(lf,"Priority");bi=lf});var Ja,ga,Jl=n(()=>{sl();Ja=class extends bi{constructor(){super(1e3)}};t(Ja,"High");ga=Ja});var ot,kT,PR=n(()=>{sl();ot=class extends bi{constructor(){super(3e3)}};t(ot,"Low");kT=ot});var km,ST=n(()=>{sl();km=class extends bi{constructor(){super(2e3)}};t(km,"Normal")});var $a=n(()=>{Jl();PR();ST()});var mf,g,U=n(()=>{af();D();T();$a();mf=class{#e;#t=!0;#r;#i=new km;constructor(...e){let r=[];e.forEach(o=>{if(o instanceof p){if(this.#r)throw new TypeError("Rule: effect already specified, but another was provided.");this.#r=o;return}if(o instanceof m){r.push(o);return}this.#i=o}),r.length&&(this.#e=new da(...r))}disable(){this.#t=!1}enable(){this.#t=!0}enabled(){return this.#t}priority(){return this.#i}process(...e){if(!!this.#t&&this.#r instanceof p)return this.#r.apply(...e)}validate(...e){return this.#t?this.#e instanceof m?this.#e.validate(...e):!0:!1}};t(mf,"Rule");g=mf});var pf,ke,Kr=n(()=>{U();pf=class extends g{};t(pf,"Busy");ke=pf});var $l,FT,IR=n(()=>{ql();$l=class extends Hi{};t($l,"ChooseResearch");FT=$l});var Zl,f,YT,M=n(()=>{Re();U();Zl=class extends W{#e=new Map;constructor(){super(g)}entries(){return super.entries().sort((e,r)=>e.priority().value()-r.priority().value())}get(e){return this.#e.has(e)||this.#e.set(e,this.filter(r=>r.enabled()&&r instanceof e)),this.#e.get(e)||[]}invalidateCache(e){this.#e.delete(e instanceof g?e.constructor:e)}process(e,...r){return this.get(e).filter(o=>o.validate(...r)).map(o=>o.process(...r))}register(...e){super.register(...e),e.forEach(r=>this.invalidateCache(r))}unregister(...e){super.unregister(...e),e.forEach(r=>this.invalidateCache(r))}};t(Zl,"RuleRegistry");f=new Zl,YT=Zl});var cf,Sm,wR=n(()=>{U();cf=class extends g{};t(cf,"CanBeWorked");Sm=cf});var uf,ff,AR=n(()=>{U();uf=class extends g{};t(uf,"Created");ff=uf});var yf,ha,Fm=n(()=>{J();M();AR();yf=class extends S{#e;constructor(e=f){super(),this.#e=e,this.#e.process(ff,this)}clone(){return new this.constructor(this.#e)}};t(yf,"Terrain");ha=yf});var $,NT=n(()=>{Fm();$=class extends ha{};t($,"Land")});var Cr,BR=n(()=>{Fm();Cr=class extends ha{};t(Cr,"Water")});var Tr=n(()=>{NT();BR()});var ll,j,je=n(()=>{J();ll=class extends S{#e=[];#t=null;constructor(e=0,r="initial"){super(),this.addKey("value","values"),this.add(e,r)}add(e,r=""){if(e instanceof ll)return this.add(e.value(),r);this.#e.push([e,r]),this.#t=null}clone(){return new this.constructor(this)}set(e,r=""){if(this.#e.splice(0),e instanceof ll)return this.set(e.value(),r);this.#e.push([e,r]),this.#t=e}subtract(e,r=""){if(e instanceof ll)return this.subtract(e.value(),r);this.#e.push([-e,r]),this.#t=null}value(){return this.#t===null&&(this.#t=this.#e.reduce((e,[r])=>e+r,0)),this.#t}values(){return this.#e}};t(ll,"Yield");j=ll});var df,gf,GR=n(()=>{U();df=class extends g{};t(df,"YieldModifier");gf=df});var hf,_i,MR=n(()=>{U();hf=class extends g{};t(hf,"Yield");_i=hf});var Ym,fe,Ki=n(()=>{J();Tr();M();Pc();je();GR();MR();Ym=class extends S{#e;#t=[];#r;#i;#o;#a;#n=new Map;constructor(e,r,o,a,s=f){super(),this.#o=e,this.#a=r,this.#i=o,this.#e=a,this.#r=s,this.addKey("terrain","isCoast","isLand","isWater","x","y","yields")}clearYieldCache(e=null){this.#n.delete(e)}getAdjacent(){return this.getAdjacentDirections().map(e=>this.getNeighbour(e))}getAdjacentDirections(){return["n","e","s","w"]}getNeighbour(e){return e==="n"?this.#e.get(this.#o,this.#a-1):e==="ne"?this.#e.get(this.#o+1,this.#a-1):e==="e"?this.#e.get(this.#o+1,this.#a):e==="se"?this.#e.get(this.#o+1,this.#a+1):e==="s"?this.#e.get(this.#o,this.#a+1):e==="sw"?this.#e.get(this.#o-1,this.#a+1):e==="w"?this.#e.get(this.#o-1,this.#a):this.#e.get(this.#o-1,this.#a-1)}getNeighbouringDirections(){return["n","ne","e","se","s","sw","w","nw"]}getNeighbours(){return this.#t.length||(this.#t=this.getNeighbouringDirections().map(e=>this.getNeighbour(e))),this.#t}getSurroundingArea(e=2){return Nm.fromSurrounding(this,e)}distanceFrom(e){let r=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[o]=r.map(([a,s])=>Math.hypot(this.#o-e.x()+a*this.#e.width(),this.#a-e.y()+s*this.#e.height())).sort((a,s)=>a-s);return o}isCoast(){let e=this;return e.isWater()&&e.getNeighbours().some(r=>r.isLand())||e.isLand()&&e.getNeighbours().some(r=>r.isWater())}isLand(){return this.#i instanceof $}isNeighbourOf(e){return this.getNeighbours().includes(e)}isWater(){return this.#i instanceof Cr}map(){return this.#e}score(e=null,r=[[j,3]]){return this.yields(e).map(a=>{let[s]=r.filter(([c])=>a instanceof c),l=s?s[1]||1:0;return a.value()*l}).reduce((a,s)=>a+s,0)}terrain(){return this.#i}setTerrain(e){this.#i=e}x(){return this.#o}y(){return this.#a}yields(e=null){if(!this.#n.has(e)){let r=this.#r.process(_i,this,e).flat();this.#r.process(gf,this,e,r).flat(),this.#n.set(e,r)}return this.#n.get(e)}};t(Ym,"Tile");fe=Ym});var Wm,Nm,Pc=n(()=>{Re();Ki();Wm=class extends W{static from(...e){return new this(...e)}static fromSurrounding(e,r=2){let o=t(a=>{let s=[];for(let l=e.x()-a;l<=e.x()+a;l++)for(let c=e.y()-a;c<=e.y()+a;c++)s.push([l,c]);return s},"gen");return this.from(...o(r).map(([a,s])=>e.map().get(a,s)))}constructor(...e){super(Ym),this.register(...e)}push(...e){this.register(...e)}shift(){let[e]=this.entries();return this.unregister(e),e}score(e=null,r=[]){return this.entries().reduce((o,a)=>o+a.score(e,r),0)}yields(e=null){return this.entries().flatMap(r=>r.yields(e))}};t(Wm,"Tileset");Nm=Wm});var xf,ml,Of=n(()=>{J();xf=class extends ue{#e;#t;constructor(e,r){super(),this.#e=r,this.#t=e,this.addKey("city","tile")}city(){return this.#e}tile(){return this.#t}};t(xf,"WorkedTile");ml=xf});var Rf,Me,Ci=n(()=>{M();wR();Re();Pc();Of();Rf=class extends rl{#e;constructor(e=f){super(ml),this.#e=e}getByCity(e){return this.getBy("city",e)}getByTile(e){let[r]=this.getBy("tile",e);return r??null}getTilesByCity(e){return Nm.from(...this.filter(r=>r.city()===e).map(r=>r.tile()))}register(...e){e.forEach(r=>{let o=r.tile();if(this.getByTile(o)!==null)throw new TypeError(`Tile ${o.x()}, ${o.y()} is already worked!`);super.register(r)})}tileCanBeWorkedBy(e,r){return this.#e.process(Sm,e,r).every(o=>o)}tileIsWorked(e){return!!this.getByTile(e)}unregisterByTile(e){let r=this.getByTile(e);r!==null&&this.unregister(r)}};t(Rf,"WorkedTileRegistry");Me=new Rf});var vf,Pr,Ql=n(()=>{U();vf=class extends g{};t(vf,"Captured");Pr=vf});var bf,Cf,UR=n(()=>{U();bf=class extends g{};t(bf,"Tiles");Cf=bf});var Tf,yt,Lm=n(()=>{U();Tf=class extends g{};t(Tf,"Cost");yt=Tf});var Pf,pn,If=n(()=>{U();Pf=class extends g{};t(Pf,"Created");pn=Pf});var wf,qr,Xl=n(()=>{U();wf=class extends g{};t(wf,"Destroyed");qr=wf});var jm,cn,zm=n(()=>{U();jm=class extends g{};t(jm,"Yield");cn=jm});var Af,em,Bf=n(()=>{U();Af=class extends g{};t(Af,"YieldModifier");em=Af});var Gf,Ze,xa=n(()=>{J();M();Ci();Ql();UR();Lm();If();Xl();je();zm();Bf();Gf=class extends S{#e=!1;#t;#r;#i;#o;#a;#n;#l;constructor(e,r,o,a=f,s=Me){super(),this.#t=o,this.#r=e,this.#i=e,this.#a=r,this.#o=a,this.#l=s,[this.#n]=this.#o.process(Cf,this),this.#o.process(pn,this),this.addKey("destroyed","name","originalPlayer","player","tile","tiles","tilesWorked","yields")}capture(e){let r=this.#i;this.#i=e,this.#o.process(Pr,this,e,r)}destroy(e=null){this.#e=!0,this.#o.process(qr,this,e)}destroyed(){return this.#e}name(){return this.#t}setName(e){this.#t=e}originalPlayer(){return this.#r}player(){return this.#i}tile(){return this.#a}tiles(){return this.#n}tilesWorked(){return this.#l.getTilesByCity(this)}yields(){let e=[];return[this.#o.get(cn),this.#o.get(em),this.#o.get(yt)].flat().forEach(r=>{if(!r.validate(this,e))return;let o=r.process(this,e);if(!!o){if(o instanceof j){e.push(o);return}o.forEach(a=>e.push(a))}}),e}};t(Gf,"City");Ze=Gf});var Mf,Uf,DR=n(()=>{U();Mf=class extends g{};t(Mf,"Cost");Uf=Mf});var Oa,ER,Df=n(()=>{je();Oa=class extends j{};t(Oa,"FoodStorage");ER=Oa});var Ef,Ic,kR=n(()=>{U();Ef=class extends g{};t(Ef,"FoodStorage");Ic=Ef});var kf,Ra,Sf=n(()=>{U();kf=class extends g{};t(kf,"Grow");Ra=kf});var Ff,Hm,SR=n(()=>{U();Ff=class extends g{};t(Ff,"Shrink");Hm=Ff});var Yf,tm,Nf=n(()=>{J();M();DR();Df();kR();Sf();SR();Yf=class extends S{#e;#t=new ER(1/0);#r=new ER;#i;#o=1;constructor(e,r=f){super(),this.#e=e,this.#i=r,this.setCost(),this.addKey("cost","progress","size")}add(e){this.#r.add(e)}check(){this.#i.process(Ic,this)}city(){return this.#e}cost(){return this.#t}setCost(){let e=this.#i.process(Uf,this);e.length>0&&this.#t.set(e[0],"setCost")}empty(){this.#r.subtract(this.#r.value())}grow(){this.#o++,this.#i.process(Ra,this)}progress(){return this.#r}shrink(){this.#o--,this.#i.process(Hm,this)}size(){return this.#o}};t(Yf,"CityGrowth");tm=Yf});var pl,WT,Wf=n(()=>{J();M();pl=class extends S{static build(e,r=f){throw new TypeError("createFromObject: Must be overridden in extending class")}};t(pl,"Buildable");WT=pl});var Lf,wc,FR=n(()=>{U();Lf=class extends g{};t(Lf,"Created");wc=Lf});var jf,z,ze=n(()=>{Wf();M();FR();jf=class extends pl{#e;#t=!1;#r;constructor(e,r=f){super(),this.addKey("destroyed"),this.#e=e,this.#r=r,this.#r.process(wc,this,e)}static build(e,r=f){return new this(e,r)}city(){return this.#e}destroy(){this.#t=!0}destroyed(){return this.#t}};t(jf,"CityImprovement");z=jf});var zf,Ae,Ir=n(()=>{J();zf=class extends S{#e;#t;#r;constructor(e,r,o){super(),this.#e=e,this.#t=r,this.#r=o,this.addKey("name","value")}civilization(){return this.#e}name(){return this.#t}value(){return this.#r}};t(zf,"Attribute");Ae=zf});var _m,ve,nr=n(()=>{Re();Ir();_m=class extends W{constructor(){super(Ae)}getByCivilization(e){return this.getBy("civilization",e)}getByName(e){return this.getBy("name",e)}};t(_m,"AttributeRegistry");ve=new _m});var Hf,me,ar=n(()=>{Hf=class{#e;#t;#r=!1;constructor(e,r,o=!1){this.#e=e,this.#t=r,this.#r=o}name(){return this.#e}civilization(){return this.#t}capital(){return this.#r}};t(Hf,"CityName");me=Hf});var _f,oe,Ct=n(()=>{Re();ar();_f=class extends W{#e=1;#t;constructor(e=()=>Math.random()){super(me),this.#t=e}takeByCivilization(e){let[r]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1);return r instanceof me?(this.unregister(r),r.name()):this.takeUnassociated()}takeCapitalByCivilization(e){let[r]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1).filter(o=>o.capital());return r instanceof me?(this.unregister(r),r.name()):this.takeByCivilization(e)}takeUnassociated(){let[e]=this.getBy("civilization",null).sort(()=>Math.floor(this.#t()*3)-1);return e instanceof me?(this.unregister(e),e.name()):`City #${this.#e++}`}};t(_f,"CityNameRegistry");oe=new _f});var Kf,he,sr=n(()=>{nr();Ct();J();Kf=class extends S{#e=null;#t;#r=new _m;constructor(e=ve,r=oe){super(),this.#t=r,this.#r.register(...e.getByCivilization(this.sourceClass())),this.addKey("name","leader","attributes")}attributes(){return this.#r.entries()}name(){return this.constructor.name}leader(){return this.#e}setLeader(e){this.#e=e}getCityName(e=!1){let r=this.sourceClass();return e?this.#t.takeCapitalByCivilization(r):this.#t.takeByCivilization(r)}};t(Kf,"Civilization");he=Kf});var cl,LT=n(()=>{fa();cl=class extends Um{};t(cl,"CompleteProduction")});var YR=n(()=>{LT()});var rm,Vf,Jf=n(()=>{ql();rm=class extends Hi{};t(rm,"EndTurn");Vf=rm});var $f,Zf,NR=n(()=>{$f=class{#e={};on(e,r){e in this.#e||(this.#e[e]=[]),this.#e[e].push(r)}once(e,r){let o=t((...a)=>{r(...a),this.off(e,o)},"onceHandler");this.on(e,o)}off(e,r){if(!(e in this.#e))return;let o=this.#e[e].indexOf(r);o!==-1&&this.#e[e].splice(o,1)}emit(e,...r){e in this.#e&&this.#e[e].forEach(o=>o(...r))}};t($f,"EventEmitter");Zf=$f});var te,un,im=n(()=>{je();te=class extends j{};t(te,"Food");un=te});var Q,Za,Km=n(()=>{je();Q=class extends j{};t(Q,"Production");Za=Q});var ye,Qa,Xa=n(()=>{je();ye=class extends j{};t(ye,"Trade");Qa=ye});var es=n(()=>{im();Km();Xa()});var WR,Qf,Ti,fl=n(()=>{je();WR=t(i=>i instanceof j?-i.value():-i,"negate"),Qf=class extends j{add(e,r=""){super.add(WR(e),r)}set(e,r=""){super.set(WR(e),r)}subtract(e,r=""){super.subtract(WR(e),r)}};t(Qf,"NegativeYield");Ti=t(i=>{["add","set","subtract"].forEach(e=>Object.defineProperty(i.prototype,e,Object.getOwnPropertyDescriptor(Qf.prototype,e)||Object.create(null)))},"makeNegative")});var fn,Xf=n(()=>{Xa();fl();fn=class extends Qa{};t(fn,"Corruption");Ti(fn)});var Qe,Pi,ts=n(()=>{je();Qe=class extends j{};t(Qe,"Gold");Pi=Qe});var yl,ey,Ac=n(()=>{je();yl=class extends j{};t(yl,"Happiness");ey=yl});var qi,zT,Bc=n(()=>{je();qi=class extends j{};t(qi,"Luxuries");zT=qi});var qm,HT,LR=n(()=>{im();fl();qm=class extends un{};t(qm,"PopulationSupportFood");Ti(qm);HT=qm});var lr,ty=n(()=>{je();lr=class extends j{};t(lr,"Research")});var nt,va,dl=n(()=>{je();nt=class extends j{};t(nt,"Unhappiness");va=nt});var gl,_T,jR=n(()=>{im();fl();gl=class extends un{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(gl,"UnitSupportFood");Ti(gl);_T=gl});var hl,zR,HR=n(()=>{Km();fl();hl=class extends Za{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(hl,"UnitSupportProduction");Ti(hl);zR=hl});var rs=n(()=>{es();Xf();Df();ts();Ac();Bc();LR();ty();Xa();dl();jR();HR()});var ry,rt,yn=n(()=>{U();ry=class extends g{};t(ry,"Action");rt=ry});var iy,Vi,om=n(()=>{U();iy=class extends g{};t(iy,"Added");Vi=iy});var oy,_R,KT=n(()=>{fa();oy=class extends br{};t(oy,"HiddenPlayerAction");_R=oy});var ny,H,Vr=n(()=>{J();M();yn();om();KT();ql();ny=class extends S{#e=null;#t;constructor(e=f){super(),this.#t=e,this.#t.process(Vi,this),this.addKey("actions","civilization","mandatoryActions")}action(){let[e]=this.actions();return e}actions(){return this.#t.process(rt,this).flat().filter(e=>!(e instanceof _R))}civilization(){if(this.#e===null)throw new TypeError("Player#civilization is unset.");return this.#e}hasActions(){return!!this.action()}hasMandatoryActions(){return this.actions().some(e=>e instanceof Hi)}hiddenActions(){return this.#t.process(rt,this).flat().filter(e=>e instanceof _R)}mandatoryAction(){let[e]=this.mandatoryActions();return e}mandatoryActions(){return this.actions().filter(e=>e instanceof Hi)}setCivilization(e){this.#e=e}};t(ny,"Player");H=ny});var ay,qT,VT=n(()=>{U();ay=class extends g{};t(ay,"Created");qT=ay});var xl,Z,at=n(()=>{J();xl=class extends S{#e=0;constructor(){super(),this.addKey("value")}increment(){return this.#e++,this.#e}value(){return this.#e}};t(xl,"Turn");Z=new xl});var To,JT,Vm=n(()=>{J();M();Vr();VT();at();To=class extends S{#e=new Set;#t=f;#r=Z;#i;constructor(...e){super(),e.forEach(r=>{r instanceof H&&this.#e.add(r),r instanceof Zl&&(this.#t=r),r instanceof xl&&(this.#r=r)}),this.#i=this.#r.value(),this.addKey("players","when"),this.#t.process(qT,this)}isBetween(...e){let r=Array.from(new Set(e));return r.every(o=>this.#e.has(o))&&r.length===this.#e.size}players(){return Array.from(this.#e)}ruleRegistry(){return this.#t}when(){return this.#i}};t(To,"Interaction");JT=To});var Ol,$T,sy=n(()=>{Vm();M();Ol=class extends To{#e;#t;constructor(e,r,o=f){super(...r.players(),o),this.#e=e,this.#t=r,this.addKey("by","for","negotiation")}by(){return this.#e}for(){return this.players().filter(e=>e!==this.#e)}negotiation(){return this.#t}};t(Ol,"Action");$T=Ol});var ly,Jm,my=n(()=>{U();ly=class extends g{};t(ly,"Step");Jm=ly});var py,$m,KR=n(()=>{U();py=class extends g{};t(py,"Resolved");$m=py});var Zm,Rl,Qm=n(()=>{sy();M();my();KR();Zm=class extends Ol{#e=null;constructor(e,r,o=f){super(e,r,o),this.addKey("resolution","resolved")}choices(){return this.ruleRegistry().process(Jm,this.negotiation())}resolution(){return this.#e}async resolve(e){this.#e=e,await Promise.all(this.ruleRegistry().process($m,e,this))}resolved(){return this.#e!==null}};t(Zm,"Proposal");Rl=Zm});var cy,Po,Gc=n(()=>{Qm();cy=class extends Rl{};t(cy,"Initiate");Po=cy});var nm,ZT,qR=n(()=>{fa();nm=class extends br{};t(nm,"LaunchSpaceship");ZT=nm});var Io,QT=n(()=>{je();Io=class extends j{};t(Io,"Attack")});var Ji,XT=n(()=>{je();Ji=class extends j{};t(Ji,"Defence")});var wo,eP,VR=n(()=>{je();wo=class extends j{};t(wo,"Movement");eP=wo});var Xm,tP=n(()=>{VR();Xm=class extends eP{};t(Xm,"Moves")});var vl,rP=n(()=>{je();vl=class extends j{};t(vl,"Visibility")});var ep=n(()=>{QT();XT();VR();tP();rP()});var dt,JR,$i,ba,tp,$R=n(()=>{D();T();U();dt=class extends g{};t(dt,"Action");JR=dt,$i=new m(i=>i.moves().value()>=.1),ba=new m((i,e,r=i.tile())=>r===e),tp=new m((i,e,r=i.tile())=>e.isNeighbourOf(r))});var uy,rp,ZR=n(()=>{U();uy=class extends g{};t(uy,"Activate");rp=uy});var fy,is,yy=n(()=>{U();fy=class extends g{};t(fy,"Created");is=fy});var dy,dn,Mc=n(()=>{U();dy=class extends g{};t(dy,"Destroyed");dn=dy});var gy,hy,QR=n(()=>{U();gy=class extends g{};t(gy,"Visibility");hy=gy});var bl,am,Uc,iP,ip=n(()=>{ep();D();T();U();bl=class extends g{};t(bl,"BaseYield");am=class extends g{};t(am,"Yield");Uc=am,iP=t((i,e=1,r=1,o=1,a=1)=>[...[[Io,e],[Ji,r],[wo,o],[vl,a]].flatMap(([s,l])=>[new am(new m(c=>c instanceof i),new m((c,u)=>u instanceof s),new p((c,u)=>u.set(l))),new bl(new m(c=>c===i),new m((c,u)=>u instanceof s),new p((c,u)=>u.set(l)))])],"unitYield")});var xy,Ue,os=n(()=>{ep();Wf();M();$R();ZR();yy();Mc();QR();ip();xy=class extends pl{#e=!0;#t=null;#r;#i=!1;#o=new Xm;#a;#n;#l=null;#s;#m=!1;constructor(e,r,o,a=f){super(),this.#r=e,this.#a=r,this.#s=o,this.#n=a,this.addKey("actions","actionsForNeighbours","active","attack","busy","city","defence","destroyed","movement","moves","player","status","tile","visibility","waiting"),this.#n.process(is,this)}static build(e,r=f){return new this(e,e.player(),e.tile(),r)}action(e,...r){return e.perform(...r)}actions(e=this.#s,r=this.#s){return typeof e=="string"&&(e=r.getNeighbour(e)),this.#n.process(JR,this,e,r)}actionsForNeighbours(e=this.#s){return e.getNeighbouringDirections().reduce((r,o)=>({...r,[o]:this.#n.process(JR,this,e.getNeighbour(o),e)}),{})}activate(){this.#n.process(rp,this)}active(){return this.#e}setActive(e=!0){this.#e=e}applyVisibility(){this.#s.getSurroundingArea(this.visibility().value()).forEach(e=>{this.#n.process(hy,e,this.#a)})}attack(){let[e]=this.yield(new Io);return e}busy(){return this.#t}setBusy(e=null){this.#t=e}city(){return this.#r}defence(){let[e]=this.yield(new Ji);return e}destroy(e=null){this.#n.process(dn,this,e)}destroyed(){return this.#i}setDestroyed(){this.#i=!0}movement(){let[e]=this.yield(new wo);return e}moves(){return this.#o}player(){return this.#a}status(){return this.#l}setStatus(e){this.#l=e}tile(){return this.#s}setTile(e){this.#s=e}visibility(){let[e]=this.yield(new vl);return e}waiting(){return this.#m}setWaiting(e=!0){this.#m=e}yield(...e){let r=this.#n.get(Uc);return e.forEach(o=>r.filter(a=>a.validate(this,o)).forEach(a=>a.process(this,o))),e}};t(xy,"Unit");Ue=xy});var Oy,_,Ke=n(()=>{Re();os();Oy=class extends W{constructor(){super(Ue)}getByCity(e){return this.filter(r=>r.city()===e&&!r.destroyed())}getByPlayer(e,r=!1){return r?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){return this.filter(r=>r.tile()===e&&!r.destroyed())}};t(Oy,"UnitRegistry");_=new Oy});var Ca,Cl,Tl=n(()=>{M();J();Ca=class extends S{#e;#t;#r;#i;constructor(e,r,o,a=f){super(),this.#e=e,this.#t=a,this.#r=r,this.#i=o,this.addKey("from","to")}forUnit(e){return new this.constructor(this.#e,this.#r,e,this.#t)}from(){return this.#e}perform(...e){}ruleRegistry(){return this.#t}to(){return this.#r}unit(){return this.#i}};t(Ca,"Action");Cl=Ca});var Ry,gn,Dc=n(()=>{U();Ry=class extends g{};t(Ry,"Defeated");gn=Ry});var vy,K,st=n(()=>{U();vy=class extends g{};t(vy,"Moved");K=vy});var Zi,XR=n(()=>{M();Ke();Tl();Dc();st();Zi=class extends Cl{#e;#t;constructor(e,r,o,a=f,s=_,l=()=>Math.random()){super(e,r,o,a),this.#t=s,this.#e=l}perform(){let[e]=this.#t.getByTile(this.to()).sort((o,a)=>a.defence().value()-o.defence().value()),r=Math.min(1,this.unit().moves().value());if(this.unit().attack().value()*r*this.#e()>=e.defence().value()*this.#e()){this.ruleRegistry().process(gn,e,this.unit(),this),this.unit().moves().subtract(r,this.constructor.name),this.ruleRegistry().process(K,this.unit(),this);return}this.ruleRegistry().process(gn,this.unit(),e,this),this.ruleRegistry().process(K,this.unit(),this)}};t(Zi,"Attack")});var oP=n(()=>{XR();XR()});var by,nP,aP=n(()=>{Kr();by=class extends ke{};t(by,"BuildingIrrigation");nP=by});var Cy,lt,Ao=n(()=>{Tl();M();at();Kr();D();T();st();Cy=class extends Ca{#e;constructor(e,r,o,a=f,s=Z){super(e,r,o,a),this.#e=s}perform(e,r=()=>{},o=ke){let a=this.#e.value()+e;this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new o(new m(()=>this.#e.value()===a),new p((...s)=>{let l=this.unit();l.setActive(),l.setBusy(),r(...s),this.ruleRegistry().process(K,this.unit(),this)})))}};t(Cy,"DelayedAction");lt=Cy});var Ty,ns,Py=n(()=>{U();Ty=class extends g{};t(Ty,"Built");ns=Ty});var Iy,hn,sm=n(()=>{J();M();Py();Iy=class extends S{#e;constructor(e,r=f){super(),this.#e=e,r.process(ns,e,this)}tile(){return this.#e}};t(Iy,"TileImprovement");hn=Iy});var Fe,sP,ev=n(()=>{sm();Fe=class extends hn{};t(Fe,"Irrigation");sP=Fe});var wy,De,Qi=n(()=>{U();wy=class extends g{};t(wy,"MovementCost");De=wy});var xn,tv=n(()=>{aP();Ao();ev();st();Qi();xn=class extends lt{perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new sP(this.unit().tile())},nP),this.ruleRegistry().process(K,this.unit(),this)}};t(xn,"BuildIrrigation")});var lP=n(()=>{tv();tv()});var Ay,mP,pP=n(()=>{Kr();Ay=class extends ke{};t(Ay,"BuildingMine");mP=Ay});var mt,cP,rv=n(()=>{sm();mt=class extends hn{};t(mt,"Mine");cP=mt});var On,iv=n(()=>{pP();Ao();rv();st();Qi();On=class extends lt{perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new cP(this.unit().tile())},mP),this.ruleRegistry().process(K,this.unit(),this)}};t(On,"BuildMine")});var uP=n(()=>{iv();iv()});var By,fP,yP=n(()=>{Kr();By=class extends ke{};t(By,"BuildingRailroad");fP=By});var wr,dP,ov=n(()=>{sm();wr=class extends hn{};t(wr,"Railroad");dP=wr});var Rn,nv=n(()=>{yP();Ao();st();Qi();ov();Rn=class extends lt{perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new dP(this.unit().tile())},fP),this.ruleRegistry().process(K,this.unit(),this)}};t(Rn,"BuildRailroad")});var gP=n(()=>{nv();nv()});var Gy,hP,xP=n(()=>{Kr();Gy=class extends ke{};t(Gy,"BuildingRoad");hP=Gy});var qe,OP,av=n(()=>{sm();qe=class extends hn{};t(qe,"Road");OP=qe});var vn,sv=n(()=>{xP();Ao();st();Qi();av();vn=class extends lt{perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new OP(this.unit().tile())},hP),this.ruleRegistry().process(K,this.unit(),this)}};t(vn,"BuildRoad")});var RP=n(()=>{sv();sv()});var My,Ec,lv=n(()=>{U();My=class extends g{};t(My,"ValidateMove");Ec=My});var pt,op,np=n(()=>{Tl();st();Qi();lv();pt=class extends Ca{perform(){return this.validate()?(this.unit().setTile(this.to()),this.ruleRegistry().process(K,this.unit(),this),!0):!1}movementCost(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>r-o);return e}validate(){let[e]=this.ruleRegistry().process(Ec,this.unit(),this.movementCost());return e}};t(pt,"Move");op=pt});var bn,mv=n(()=>{M();np();bn=class extends op{#e;constructor(e,r,o,a,s=f){super(e,r,o,s),this.#e=a}perform(){return super.perform()?(this.#e.capture(this.unit().player()),!0):!1}};t(bn,"CaptureCity")});var vP=n(()=>{mv();mv()});var Uy,Xe,Xi=n(()=>{J();Uy=class extends ue{#e;constructor(e){super(),this.#e=e}clone(e=this.terrain()){return new this.constructor(e)}terrain(){return this.#e}};t(Uy,"TerrainFeature");Xe=Uy});var pv,Dy,Tt,Cn=n(()=>{Re();Xi();pv=new Map,Dy=class extends W{constructor(){super(Xe)}getByTerrain(e){return pv.has(e)||pv.set(e,this.getBy("terrain",e)),pv.get(e)}};t(Dy,"TerrainFeatureRegistry");Tt=new Dy});var Ey,bP,CP=n(()=>{Kr();Ey=class extends ke{};t(Ey,"ClearingForest");bP=Ey});var de,ap,kc=n(()=>{Tr();de=class extends ${};t(de,"Plains");ap=de});var Tn,cv=n(()=>{M();Cn();at();CP();Ao();st();Qi();kc();Tn=class extends lt{#e;constructor(e,r,o,a=f,s=Tt,l=Z){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new ap,o=this.#e.getByTerrain(this.from().terrain());this.#e.register(...o.map(a=>a.clone(r))),this.#e.unregister(...o),this.from().setTerrain(r)},bP),this.ruleRegistry().process(K,this.unit(),this)}};t(Tn,"ClearForest")});var TP=n(()=>{cv();cv()});var ky,PP,IP=n(()=>{Kr();ky=class extends ke{};t(ky,"ClearingJungle");PP=ky});var Sc,Pl,wP,sp=n(()=>{Cn();D();T();U();Sc=class extends g{};t(Sc,"Feature");Pl=Sc,wP=t((i,e,r=.2,o=Tt,a=()=>Math.random())=>[new Sc(new m(s=>s===e),new m((s,l)=>l instanceof i),new m(()=>a()<=r),new p((s,l)=>o.register(new s(l))))],"feature")});var Te,Il,lp=n(()=>{Tr();Te=class extends ${};t(Te,"Grassland");Il=Te});var Pn,Sy,Fy=n(()=>{Xi();Pn=class extends Xe{};t(Pn,"Shield");Sy=Pn});var In,uv=n(()=>{M();Cn();at();IP();Ao();sp();lp();st();Qi();Fy();In=class extends lt{#e;constructor(e,r,o,a=f,s=Tt,l=Z){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new Il,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(Pl,Sy,r),this.#e.unregister(...o),this.from().setTerrain(r)},PP),this.ruleRegistry().process(K,this.unit(),this)}};t(In,"ClearJungle")});var AP=n(()=>{uv();uv()});var Yy,BP,GP=n(()=>{Kr();Yy=class extends ke{};t(Yy,"ClearingSwamp");BP=Yy});var wn,fv=n(()=>{M();Cn();at();GP();Ao();sp();lp();st();Qi();Fy();wn=class extends lt{#e;constructor(e,r,o,a=f,s=Tt,l=Z){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new Il,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(Pl,Sy,r),this.#e.unregister(...o),this.from().setTerrain(r)},BP),this.ruleRegistry().process(K,this.unit(),this)}};t(wn,"ClearSwamp")});var MP=n(()=>{fv();fv()});var as,yv=n(()=>{Tl();st();as=class extends Cl{perform(){this.unit().destroy(),this.ruleRegistry().process(K,this.unit(),this)}};t(as,"Disband")});var UP=n(()=>{yv();yv()});var An,dv=n(()=>{M();np();An=class extends op{#e;constructor(e,r,o,a,s=f){super(e,r,o,s),this.#e=a}perform(){return super.perform()?(this.unit().moves().set(0),this.#e.unload(this.unit()),!0):!1}};t(An,"Disembark")});var DP=n(()=>{dv();dv()});var ss,gv=n(()=>{M();Kr();D();np();st();ss=class extends op{#e;constructor(e,r,o,a,s=f){super(e,r,o,s),this.#e=a}perform(){return super.perform()?(this.#e.stow(this.unit()),this.unit().setBusy(new ke(new m(()=>!1))),this.unit().setActive(!1),this.ruleRegistry().process(K,this.unit(),this),!0):!1}};t(ss,"Embark")});var EP=n(()=>{gv();gv()});var Ny,mp,Wy=n(()=>{J();Ny=class extends ue{#e;constructor(e){super(),this.#e=e}unit(){return this.#e}};t(Ny,"UnitImprovement");mp=Ny});var Ly,Ar,ls=n(()=>{Re();Wy();Ly=class extends W{constructor(){super(mp)}getByUnit(e){return this.getBy("unit",e)}};t(Ly,"UnitImprovementRegistry");Ar=new Ly});var jy,kP,SP=n(()=>{Kr();jy=class extends ke{};t(jy,"Fortified");kP=jy});var Jr,FP,zy=n(()=>{Wy();Jr=class extends mp{};t(Jr,"Fortified");FP=Jr});var Hy,YP,NP=n(()=>{Kr();Hy=class extends ke{};t(Hy,"Fortifying");YP=Hy});var Bn,hv=n(()=>{M();at();ls();SP();D();Ao();zy();NP();st();Qi();Bn=class extends lt{#e;constructor(e,r,o,a=f,s=Z,l=Ar){super(e,r,o,a,s),this.#e=l}perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{this.unit().moves().set(0),this.unit().setActive(!1),this.unit().setBusy(new kP(new m(()=>!1))),this.#e.register(new FP(this.unit()))},YP),this.ruleRegistry().process(K,this.unit(),this)}};t(Bn,"Fortify")});var WP=n(()=>{hv();hv()});var ms,xv=n(()=>{Ct();M();Ci();Tl();xa();st();ms=class extends Cl{#e;#t;constructor(e,r,o,a=oe,s=f,l=Me){super(e,r,o,s),this.#e=a,this.#t=l}perform(){new Ze(this.unit().player(),this.unit().tile(),this.#e.takeCapitalByCivilization(this.unit().player().civilization().constructor),this.ruleRegistry(),this.#t),this.unit().destroy(),this.ruleRegistry().process(K,this.unit(),this)}};t(ms,"FoundCity")});var LP=n(()=>{xv();xv()});var jP=n(()=>{np();np()});var Gn,Ov=n(()=>{Tl();Gn=class extends Ca{perform(){this.unit().moves().subtract(this.unit().moves())}};t(Gn,"NoOrders")});var zP=n(()=>{Ov();Ov()});var _y,He,Ii=n(()=>{Re();sm();_y=class extends W{constructor(){super(hn)}getByTile(e){return this.getBy("tile",e)}};t(_y,"TileImprovementRegistry");He=new _y});var Mn,Rv=n(()=>{M();Ii();at();Ao();st();Qi();Mn=class extends lt{#e;constructor(e,r,o,a=f,s=He,l=Z){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let[r]=this.#e.getByTile(this.from());this.#e.unregister(r)}),this.ruleRegistry().process(K,this.unit(),this)}};t(Mn,"Pillage")});var HP=n(()=>{Rv();Rv()});var it,Ky,qy=n(()=>{Tr();it=class extends ${};t(it,"Forest");Ky=it});var Bo,_P,vv=n(()=>{Xi();Bo=class extends Xe{};t(Bo,"Horse");_P=Bo});var Vy,KP,qP=n(()=>{Kr();Vy=class extends ke{};t(Vy,"PlantingForest");KP=Vy});var Un,bv=n(()=>{M();Cn();at();Ao();sp();qy();vv();st();Qi();qP();Un=class extends lt{#e;constructor(e,r,o,a=f,s=Tt,l=Z){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(De,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new Ky,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(Pl,_P,r),this.#e.unregister(...o),this.from().setTerrain(r)},KP),this.ruleRegistry().process(K,this.unit(),this)}};t(Un,"PlantForest")});var VP=n(()=>{bv();bv()});var Jy,JP,$P=n(()=>{Kr();Jy=class extends ke{};t(Jy,"Sleeping");JP=Jy});var Go,ZP,$y=n(()=>{M();at();Ke();D();Ao();T();$P();Go=class extends lt{#e;constructor(e,r,o,a=f,s=Z,l=_){super(e,r,o,a,s),this.#e=l}perform(){this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new JP(new m(()=>this.from().getSurroundingArea(this.unit().visibility().value()).some(e=>this.#e.getByTile(e).some(r=>r.player()!==this.unit().player()))),new p(()=>{this.unit().setActive(),this.unit().setBusy()})))}};t(Go,"Sleep");ZP=Go});var QP=n(()=>{$y();$y()});var Dn,XP=n(()=>{M();Ke();Zy();Dn=class extends Zi{#e;constructor(e,r,o,a,s=f,l=_){super(e,r,o,s,l),this.#e=a,this.addKey("enemy")}enemy(){return this.#e}};t(Dn,"SneakAttack")});var En,eI=n(()=>{M();Zy();En=class extends bn{#e;constructor(e,r,o,a,s,l=f){super(e,r,o,a,l),this.#e=s,this.addKey("enemy")}enemy(){return this.#e}};t(En,"SneakCaptureCity")});var ps,Cv=n(()=>{Tl();st();ps=class extends Cl{perform(){this.unit().setWaiting(),this.unit().cargo().forEach(e=>{e.moves().set(e.movement()),e.activate()}),this.ruleRegistry().process(K,this.unit(),this)}};t(ps,"Unload")});var tI=n(()=>{Cv();Cv()});var Zy=n(()=>{oP();lP();uP();gP();RP();vP();TP();AP();MP();UP();DP();EP();WP();LP();jP();zP();HP();VP();QP();XP();eI();tI()});var lm=n(()=>{Zy()});var Qy,Xy,Tv=n(()=>{U();Qy=class extends g{};t(Qy,"Interaction");Xy=Qy});var ed,cs,td=n(()=>{sy();ed=class extends $T{};t(ed,"Terminate");cs=ed});var rd,rI,iI=n(()=>{rd=class extends Error{};t(rd,"Terminated");rI=rd});var id,Pv,oI=n(()=>{id=class extends Error{};t(id,"Unsupported");Pv=id});var od,pp,Iv=n(()=>{Vm();Tv();Vr();my();td();iI();oI();od=class extends To{#e=[];constructor(...e){if(e.filter(o=>o instanceof H).length!==2)throw new Pv;super(...e);let[r]=e.filter(o=>o instanceof H);if(!r)throw new Pv("Not enough `Player`s for `Negotiation`.");this.addKey("interactions","lastInteraction","terminated")}interactions(){return this.#e}lastInteraction(){return this.#e.length===0?null:this.#e[this.#e.length-1]}nextSteps(){let e=this.ruleRegistry().process(Jm,this);return e.length===0&&e.push(new cs(this.players()[0],this,this.ruleRegistry())),e}proceed(e){if(this.terminated())throw new rI;this.#e.push(e),this.ruleRegistry().process(Xy,e,this)}terminated(){return this.#e.some(e=>e instanceof cs)}};t(od,"Negotiation");pp=od});var ad,sd,wv=n(()=>{U();ad=class extends g{};t(ad,"Yield");sd=ad});var ld,ct,kn=n(()=>{M();Wf();wv();ld=class extends WT{#e;#t;constructor(e,r=f){super(),this.#e=e,this.#t=r,this.addKey("city","yields")}static build(e,r=f){return new this(e,r)}city(){return this.#e}yields(){return this.#t.process(sd,this).flat()}};t(ld,"Part");ct=ld});var md,cp,Av=n(()=>{Et();J();Ki();md=class extends S{#e={};#t;#r;#i;constructor(e,r,o=ae){super(),this.#t=o,this.#r=r,this.#i=e,this.addKey("isCoast","isLand","isWater","terrain","x","y","yields"),this.setAdditionalData()}addKey(...e){super.addKey(...e)}isCoast(){return this.#i.isCoast()}isLand(){return this.#i.isLand()}isWater(){return this.#i.isWater()}player(){return this.#r}setAdditionalData(){this.#t.getByType(fe).forEach(e=>{this.#e[e.key()]=e.data(this.#i),Object.defineProperty(this,e.key(),{configurable:!0,value:()=>e.data(this.#i)}),this.addKey(e.key())})}terrain(){return this.#i.terrain()}tile(){return this.#i}update(){this.#i.clearYieldCache(this.#r),this.setAdditionalData()}x(){return this.#i.x()}y(){return this.#i.y()}yields(){return this.#i.yields(this.#r)}};t(md,"PlayerTile");cp=md});var pd,nI,aI=n(()=>{Fm();pd=class extends ha{};t(pd,"Unknown");nI=pd});var cd,sI,lI=n(()=>{Ki();aI();cd=class extends fe{constructor(e,r,o){super(e,r,new nI,o)}};t(cd,"UndiscoveredTile");sI=cd});var ud,fd,Bv=n(()=>{U();ud=class extends g{};t(ud,"VisibilityChanged");fd=ud});var yd,up,dd=n(()=>{J();M();Av();Ki();lI();Bv();yd=class extends S{#e;#t;#r=[];#i;constructor(e,r,o=f){super(),this.#e=e,this.#i=r,this.#t=o,this.addKey("height","tiles","width")}entries(){return this.#r}filter(e){return this.entries().filter(e)}forEach(e){return this.#r.forEach(e)}get(e,r){let[o]=this.entries().filter(a=>a.x()===e&&a.y()===r);return o||new sI(e,r,this.#i)}getByTile(e){let[r]=this.filter(o=>o.tile()===e);return r??null}height(){return this.#i.height()}includes(e){return e instanceof fe?!!this.getByTile(e):this.#r.includes(e)}map(e){return this.#r.map(e)}player(){return this.#e}register(...e){e.forEach(r=>{this.includes(r)||(this.#r.push(new cp(r,this.#e)),this.#t.process(fd,r,this.player()))})}tiles(){return this.entries()}width(){return this.#i.width()}};t(yd,"PlayerWorld");up=yd});var xd,Mo,mm=n(()=>{sy();M();xd=class extends Ol{#e;constructor(e,r,o=f){super(e,r.negotiation(),o),this.#e=r,this.addKey("proposal")}proposal(){return this.#e}};t(xd,"Resolution");Mo=xd});var wl,cI=n(()=>{fa();wl=class extends br{};t(wl,"Revolution")});var Gv=n(()=>{cI()});var vd,re,kt=n(()=>{Re();Nf();vd=class extends W{constructor(){super(tm)}getByCity(e){let r=this.getBy("city",e);if(r.length!==1)throw new TypeError("Wrong number of CityGrowths returned.");return r[0]}};t(vd,"CityGrowthRegistry");re=new vd});var Be,Pe,Se=n(()=>{ze();Be=class extends z{};t(Be,"Wonder");Pe=Be});var Pd,C,k=n(()=>{J();Pd=class extends ue{};t(Pd,"Advance");C=Pd});var et,hI,Uo=n(()=>{et=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return typeof e=="function"&&this.#e.some(r=>Object.prototype.isPrototypeOf.call(r,e)||Object.prototype.isPrototypeOf.call(r.prototype,e))}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,r){return this.filter(o=>{let a=o[e];return a instanceof Function?a.bind(o)()===r:o[e]===r})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(r=>{if(!this.accepts(r))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${r}'.`);this.#t.includes(r)||this.#t.push(r)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(r=>{let o=this.#t.indexOf(r);o>-1&&this.#t.splice(o,1)})}};t(et,"ConstructorRegistry");hI=et});var Id,b,E=n(()=>{k();Uo();Id=class extends et{constructor(){super(C)}};t(Id,"AdvanceRegistry");b=new Id});var wd,V,tt=n(()=>{Re();xa();wd=class extends W{constructor(){super(Ze)}getByPlayer(e,r=!1){return r?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){let[r]=this.filter(o=>o.tile()===e&&!o.destroyed());return r??null}};t(wd,"CityRegistry");V=new wd});var Ad,qt,Ta=n(()=>{Re();Xu();Ad=class extends W{constructor(){super(DT)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of Clients for Player.");return r[0]}};t(Ad,"ClientRegistry");qt=new Ad});var xp,eo,Al=n(()=>{Re();Vr();xp=class extends W{constructor(){super(H)}};t(xp,"PlayerRegistry");eo=new xp});var Bd,Sn,Op=n(()=>{Al();Bd=class extends xp{};t(Bd,"CurrentPlayerRegistry");Sn=new Bd});var Gd,I,X=n(()=>{NR();Gd=class extends Zf{#e={};#t=!1;debug(e){if(!!this.option("debug"))return e()}emit(e,...r){return this.debug(()=>console.log(`Engine#emit: ${String(e)}: ${r}`)),super.emit(e,...r)}loadPlugins(){return this.emit("plugins:load:start"),new Promise((e,r)=>{this.once("plugins:load:end",()=>e())})}option(e,r=null){return this.#e[e]||r}setOption(e,r){this.#e[e]!==r&&(this.#e[e]=r,this.emit("option:changed",e,r))}start(){this.#t||(this.#t=!0,this.emit("engine:initialise"),this.loadPlugins().then(()=>{this.emit("engine:start")}))}};t(Gd,"Engine");I=new Gd});var Md,mr,us=n(()=>{Re();Vm();Md=class extends W{constructor(){super(To)}getByPlayer(e){return this.entries().filter(r=>r.players().includes(e))}getByPlayers(...e){return this.entries().filter(r=>r.isBetween(...e))}};t(Md,"InteractionRegistry");mr=new Md});var Ud,Bl,Dd=n(()=>{U();Ud=class extends g{};t(Ud,"Complete");Bl=Ud});var Ed,kd,Ev=n(()=>{U();Ed=class extends g{};t(Ed,"Cost");kd=Ed});var Sd,Fd,kv=n(()=>{U();Sd=class extends g{};t(Sd,"Requirements");Fd=Sd});var pm,xI=n(()=>{je();pm=class extends j{};t(pm,"Research")});var OI=n(()=>{xI()});var Yd,Rp,Nd=n(()=>{U();Yd=class extends g{};t(Yd,"Started");Rp=Yd});var Wd,vp,Ld=n(()=>{E();J();M();Dd();Ev();kv();OI();Nd();Wd=class extends S{#e;#t=[];#r=null;#i;#o=new pm(1/0);#a=new pm(0);#n;constructor(e,r=b,o=f){super(),this.#e=r,this.#i=e,this.#n=o,this.addKey("available","complete","cost","progress","researching")}add(e){this.#a.add(e),this.check()}addAdvance(e){if(this.#t.some(o=>o instanceof e))return;this.#r===e&&(this.#r=null);let r=new e;this.#t.push(r),this.#n.process(Bl,this,r)}available(){let e=this.#n.get(Fd);return this.#e.filter(r=>e.filter(o=>o.validate(r,this.#t)).every(o=>o.process(r,this.#t)===!0)&&!this.#t.some(o=>o instanceof r))}check(){if(this.#r!==null&&this.#a.value()>=this.#o.value()){let e=new this.#r;this.#t.push(e),this.#r=null,this.#a.subtract(this.#o),this.#o.set(1/0),this.#n.process(Bl,this,e)}}complete(){return this.#t}completed(e){return this.#t.some(r=>r instanceof e)}cost(){return this.#o}player(){return this.#i}progress(){return this.#a}research(e){let[r]=this.#n.process(kd,e,this);this.#o.set(r),this.#r=e,this.#n.process(Rp,this,e)}researching(){return this.#r}};t(Wd,"PlayerResearch");vp=Wd});var jd,L,Ye=n(()=>{Re();Ld();jd=class extends W{constructor(){super(vp)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of results for player.");return r[0]}};t(jd,"PlayerResearchRegistry");L=new jd});var zd,Do,cm=n(()=>{Re();zd=class extends W{constructor(){super(Function)}accepts(e){return"build"in e}};t(zd,"AvailableCityBuildItemsRegistry");Do=new zd});var gt,RI,bp=n(()=>{D();U();gt=class extends g{process(e,r){let o=super.process(e,r);if(!(o instanceof Em))throw new TypeError("Invalid build rule.");return o}};t(gt,"Build");RI=gt});var Hd,_d,Sv=n(()=>{J();Hd=class extends ue{#e;constructor(e){super(),this.addKey("value"),this.#e=e}value(){return this.#e}};t(Hd,"BuildCost");_d=Hd});var Qc,vI,Gl,Aj,Cp=n(()=>{Sv();D();T();U();Qc=class extends g{};t(Qc,"BuildCost");vI=Qc,Gl=t((i,e)=>Aj([[i,e]]),"buildCost"),Aj=t(i=>i.map(([e,r])=>new Qc(new m(o=>o.item()===e),new p(()=>new _d(r)))),"buildCosts")});var Kd,qd,Fv=n(()=>{M();Sv();Cp();J();Kd=class extends ue{#e;#t=new _d(1/0);#r;#i;constructor(e,r=null,o=f){super(),this.#r=e,this.#e=r,this.#i=o,this.addKey("cost","item")}cost(){if(!Number.isFinite(this.#t.value())){let[e]=this.#i.process(vI,this,this.#e);e&&(this.#t=e)}return this.#t}item(){return this.#r}};t(Kd,"BuildItem");qd=Kd});var um,bI=n(()=>{je();um=class extends j{};t(um,"BuildProgress")});var CI=n(()=>{bI()});var Vd,TI,PI=n(()=>{U();Vd=class extends g{};t(Vd,"BuildingCancelled");TI=Vd});var Jd,to,Tp=n(()=>{U();Jd=class extends g{};t(Jd,"BuildingComplete");to=Jd});var $d,Ml,Xc=n(()=>{cm();J();M();bp();Fv();CI();PI();Tp();$d=class extends S{#e;#t=null;#r;#i=new um(1/0);#o=new um;#a;constructor(e,r=Do,o=f){super(),this.#e=r,this.#r=e,this.#a=o,this.addKey("available","building","city","cost","progress","remaining")}add(e){this.#o.add(e)}available(){let e=this.#a.get(RI);return this.#e.filter(r=>e.filter(o=>o.validate(this.city(),r)).every(o=>o.process(this.city(),r).validate())).map(r=>new qd(r,this.city(),this.#a))}build(e){let r=this.getAvailable(e);if(!r)throw new TypeError(`Cannot build ${e.name}, it's not available.`);this.#t=r,this.#i.set(this.#t.cost().value())}building(){return this.#t}check(){if(this.#o.value()>=this.#i.value()&&this.#t){let e=this.#t.item().build(this.#r,this.#a);return this.#o.set(0),this.#t=null,this.#i.set(1/0),this.#a.process(to,this,e),e}return null}city(){return this.#r}cost(){return this.#i}getAvailable(e){return this.available().filter(r=>r.item()===e)[0]}progress(){return this.#o}remaining(){return this.#i.value()-this.#o.value()}revalidate(){this.#t&&!this.getAvailable(this.#t.item())&&(this.#t=null,this.#i.set(1/0),this.#a.process(TI,this))}};t($d,"CityBuild");Ml=$d});var Zd,Vt,Pa=n(()=>{Re();Xc();Zd=class extends W{constructor(){super(Ml)}getByCity(e){let r=this.getBy("city",e);if(r.length!==1)throw new TypeError("Wrong number of entities returned.");return r[0]}};t(Zd,"CityBuildRegistry");Vt=new Zd});var Qd,Eo,eu=n(()=>{U();Qd=class extends g{};t(Qd,"Spend");Eo=Qd});var Xd,II,wI=n(()=>{U();Xd=class extends g{};t(Xd,"Rush");II=Xd});var eg,tg,Yv=n(()=>{Pa();M();J();eu();je();wI();eg=class extends ue{#e;#t;#r;#i=0;#o;constructor(e,r,o=Vt,a=f){super(),this.addKey("value","yield"),this.#e=o,this.#t=e,this.#r=a,this.#o=r}add(e){if(e instanceof j){this.add(e.value());return}this.#i+=e}buy(e){let r=this.#e.getByCity(e),[o]=this.cost(e).filter(s=>s.resource()===this.#o),a=o.value();e.player()!==this.#t||this.value()<a||(this.#r.process(II,r,o),r.add(new j(r.remaining())),this.subtract(a))}cost(e){let r=this.#e.getByCity(e);return this.#r.process(Eo,r)}player(){return this.#t}set(e){this.#i=0,this.add(e)}subtract(e){if(e instanceof j){this.add(e.value());return}this.#i-=e}value(){return this.#i}yield(){return this.#o}};t(eg,"PlayerTreasury");tg=eg});var rg,ro,fm=n(()=>{Re();Yv();rg=class extends W{constructor(){super(tg)}getByPlayer(e){return this.getBy("player",e)}getByPlayerAndType(e,r){let o=this.filter(a=>a.player()===e&&a.yield()===r);if(o.length!==1)throw new TypeError(`Wrong number of playerTreasuries: ${o.length}`);return o[0]}};t(rg,"PlayerTreasuryRegistry");ro=new rg});var ig,ne,wi=n(()=>{Re();dd();ig=class extends W{constructor(){super(up)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError(`Wrong number of player worlds exist for player: ${e.id()}`);return r[0]}};t(ig,"PlayerWorldRegistry");ne=new ig});var og,Ul,Nv=n(()=>{U();og=class extends g{};t(og,"Year");Ul=og});var ng,Pp,Wv=n(()=>{J();M();at();Nv();ng=class extends S{#e=new Map;#t;#r;constructor(e=Z,r=f){super(),this.#t=r,this.#r=e,this.addKey("value")}value(e=this.#r.value()){if(!this.#e.has(e)){let[o]=this.#t.process(Ul,e);this.#e.set(e,o)}let r=this.#e.get(e);if(typeof r!="number")throw new TypeError("Invalid cache result.");return r}};t(ng,"Year");Pp=new ng});var ym,Ve,ko=n(()=>{ym=t((i,...e)=>i.reduce((r,o)=>{let a=e.findIndex(s=>o instanceof s);return a===-1||(r[a]+=o.value()),r},e.map(()=>0)),"reduceYields"),Ve=t((i,e)=>ym(i,e).shift()??0,"reduceYield")});var Bj,AI,BI,ag,GI,MI,sg,Ip,Dl=n(()=>{kt();es();wi();Ci();ko();Of();Bj=t(i=>AI(i.tiles().entries(),i),"getHighestValueCityTiles"),AI=t((i,e,r=[[te,8],[Q,3*(Ve(e.tilesWorked().yields(e.player()),Q)===0?3:1)],[ye,1*(Ve(e.tilesWorked().yields(e.player()),ye)===0?2:1)]])=>i.sort((o,a)=>a.score(e.player(),r)-o.score(e.player(),r)),"sortTiles"),BI=t((i,e=ne,r=Me)=>Bj(i).filter(o=>r.tileCanBeWorkedBy(o,i)&&e.getByPlayer(i.player()).includes(o)),"getHighestValueAvailableCityTiles"),ag=t((i,e=ne,r=re,o=Me)=>{o.getBy("city",i).forEach(a=>o.unregister(a)),o.register(new ml(i.tile(),i)),GI(i,e,r,o)},"reassignWorkers"),GI=t((i,e=ne,r=re,o=Me)=>{let a=r.getByCity(i);BI(i,e,o).some(s=>i.tilesWorked().length>=a.size()+1?!0:(o.register(new ml(s,i)),!1))},"assignWorkers"),MI=t((i,e=ne,r=re,o=Me)=>{let[a]=BI(i,e,o);o.register(new ml(a,i))},"assignWorker"),sg=t((i,e)=>AI(i.tilesWorked().entries().filter(r=>r!==i.tile()),i).slice(e.size()),"reduceWorkers"),Ip=GI});var Jt,kI,zv=n(()=>{Tr();Jt=class extends ${};t(Jt,"Arctic");kI=Jt});var Ee,SI,Hv=n(()=>{Tr();Ee=class extends ${};t(Ee,"Desert");SI=Ee});var Ne,FI,_v=n(()=>{Tr();Ne=class extends ${};t(Ne,"Hills");FI=Ne});var ut,YI,Kv=n(()=>{Tr();ut=class extends ${};t(ut,"Jungle");YI=ut});var Je,NI,qv=n(()=>{Tr();Je=class extends ${};t(Je,"Mountains");NI=Je});var ht,WI,Vv=n(()=>{BR();ht=class extends Cr{};t(ht,"Ocean");WI=ht});var pe,cg,ug=n(()=>{Tr();pe=class extends ${};t(pe,"River");cg=pe});var ft,LI,Jv=n(()=>{Tr();ft=class extends ${};t(ft,"Swamp");LI=ft});var It,jI,$v=n(()=>{Tr();It=class extends ${};t(It,"Tundra");jI=It});var Fo=n(()=>{zv();Hv();qy();lp();_v();Kv();qv();Vv();kc();ug();Jv();$v()});var xt,El,gm=n(()=>{os();xt=class extends Ue{};t(xt,"Air");El=xt});var zI=n(()=>{gm();gm()});var $e,fg,iu=n(()=>{os();$e=class extends Ue{};t($e,"Land");fg=$e});var q,$t=n(()=>{iu();q=class extends fg{};t(q,"Fortifiable")});var HI=n(()=>{$t();$t()});var _I=n(()=>{iu();iu()});var We,Ia,kl=n(()=>{os();We=class extends Ue{};t(We,"Naval");Ia=We});var KI=n(()=>{kl();kl()});var yg,dg,Zv=n(()=>{yg=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}transport(){return this.#e}unit(){return this.#t}};t(yg,"TransportManifest");dg=yg});var gg,wa,wp=n(()=>{Re();Zv();gg=class extends W{constructor(){super(dg)}getByTransport(e){return this.getBy("transport",e)}getByUnit(e){let r=this.getBy("unit",e);if(r.length!==1)throw new TypeError("Wrong number of results.");return r[0]}};t(gg,"TransportRegistry");wa=new gg});var hg,xg,Qv=n(()=>{U();hg=class extends g{};t(hg,"Stowed");xg=hg});var Og,qI,VI=n(()=>{U();Og=class extends g{};t(Og,"Unloaded");qI=Og});var Rg,JI,vg=n(()=>{M();wp();Qv();Zv();VI();Rg=t(i=>t(class extends i{#e=f;#t=wa;canStow(r){return!this.cargo().includes(r)&&this.hasCapacity()}capacity(){return 0}cargo(){return this.#t.getByTransport(this).map(r=>r.unit())}hasCapacity(){return this.#t.getByTransport(this).length<this.capacity()}hasCargo(){return this.#t.getByTransport(this).length>0}setRuleRegistry(r){this.#e=r}setTransportRegistry(r){this.#t=r}stow(r){return!this.hasCapacity()||!this.canStow(r)?!1:(this.#t.register(new dg(this,r)),this.#e.process(xg,r,this),!0)}unload(r){try{let o=this.#t.getByUnit(r);return this.#t.unregister(o),this.#e.process(qI,r,this),!0}catch{return!1}}},"Transport"),"Transport"),JI=Rg});var wt,Aa,Sl=n(()=>{M();wp();kl();vg();wt=class extends JI(Ia){constructor(e,r,o,a=f,s=wa){super(e,r,o,a),this.setRuleRegistry(a),this.setTransportRegistry(s)}};t(wt,"NavalTransport");Aa=wt});var $I=n(()=>{Sl();Sl()});var ZI=n(()=>{vg();vg()});var Zt,bg=n(()=>{iu();Zt=class extends fg{};t(Zt,"Worker")});var QI=n(()=>{bg();bg()});var XI=n(()=>{zI();HI();_I();KI();$I();ZI();QI()});var Ba=n(()=>{XI()});var Fn,ew=n(()=>{Xi();Fn=class extends Xe{};t(Fn,"Coal")});var Yn,tw=n(()=>{Xi();Yn=class extends Xe{};t(Yn,"Fish")});var io,rw=n(()=>{Xi();io=class extends Xe{};t(io,"Game")});var Nn,iw=n(()=>{Xi();Nn=class extends Xe{};t(Nn,"Gems")});var Wn,ow=n(()=>{Xi();Wn=class extends Xe{};t(Wn,"Gold")});var oo,nw=n(()=>{Xi();oo=class extends Xe{};t(oo,"Oasis")});var Ln,aw=n(()=>{Xi();Ln=class extends Xe{};t(Ln,"Oil")});var jn,sw=n(()=>{Xi();jn=class extends Xe{};t(jn,"Seal")});var ou=n(()=>{ew();tw();rw();iw();ow();vv();nw();aw();sw();Fy()});var Cg,hm,Xv=n(()=>{U();Cg=class extends g{};t(Cg,"Action");hm=Cg});var Tg,Pg,eb=n(()=>{U();Tg=class extends g{};t(Tg,"ActionPerformed");Pg=Tg});var Ig,Ap,tb=n(()=>{U();Ig=class extends g{};t(Ig,"Discovered");Ap=Ig});var wg,Ag,rb=n(()=>{J();M();Xv();eb();tb();wg=class extends S{#e;#t;constructor(e,r=f){super(),this.#e=r,this.#t=e,this.addKey("tile")}action(e){this.#e.process(Pg,this,e),e.perform()}actions(e){return this.#e.process(hm,this,e)}process(e){this.#e.process(Ap,this,e)}tile(){return this.#t}};t(wg,"GoodyHut");Ag=wg});var Bg,Ai,Fl=n(()=>{rb();Re();Bg=class extends W{constructor(){super(Ag)}getByTile(e){let r=this.filter(o=>o.tile()===e);return r.length===0?null:r[0]}};t(Bg,"GoodyHutRegistry");Ai=new Bg});var lw=n(()=>{sm()});var Ga=n(()=>{ev();rv();lw();av();ov()});var Gg,mw,pw=n(()=>{Gg=class{#e;#t;#r;constructor(e,r,o){this.#e=o,this.#t=r,this.#r=e}end(){return this.#e}generate(){throw new Error(`PathFinder#generate: Must be overridden in '${this.constructor.name}'.`)}start(){return this.#t}unit(){return this.#r}};t(Gg,"PathFinder");mw=Gg});var Mg,Ug,ib=n(()=>{Uo();pw();Mg=class extends et{constructor(){super(mw)}};t(Mg,"PathFinderRegistry");Ug=new Mg});var Dg,Bi,Yl=n(()=>{J();Dg=class extends ue{};t(Dg,"Government");Bi=Dg});var Eg,Bp,kg=n(()=>{Uo();Yl();Eg=class extends et{constructor(){super(Bi)}};t(Eg,"AvailableGovernmentRegistry");Bp=new Eg});var Sg,nu,ob=n(()=>{U();Sg=class extends g{};t(Sg,"Availability");nu=Sg});var Fg,au,nb=n(()=>{U();Fg=class extends g{};t(Fg,"Changed");au=Fg});var Yg,Ng,ab=n(()=>{kg();J();M();ob();nb();Yg=class extends S{#e;#t=null;#r;#i;constructor(e,r=Bp,o=f){super(),this.#r=e,this.#e=r,this.#i=o,this.addKey("available","current")}available(){return this.#e.filter(e=>this.#i.get(nu).some(r=>r.validate(e,this.#r)))}current(){return this.#t}is(...e){return e.some(r=>this.#t instanceof r)}player(){return this.#r}set(e){this.#t=e,this.#i.process(au,this.#r,e)}};t(Yg,"PlayerGovernment");Ng=Yg});var Wg,At,zn=n(()=>{Re();ab();Wg=class extends W{constructor(){super(Ng)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of PlayerGovernments for player.");return r[0]}};t(Wg,"PlayerGovernmentRegistry");At=new Wg});var Lg,Hn,jg=n(()=>{mm();Lg=class extends Mo{};t(Lg,"Accept");Hn=Lg});var zg,Ma,Hg=n(()=>{M();Qm();zg=class extends Rl{#e;constructor(e,r,o,a=f){super(r,o,a),this.#e=e,this.addKey("advances")}advances(){return this.#e}};t(zg,"ExchangeKnowledge");Ma=zg});var cw=n(()=>{zy();zy()});var _n,sb=n(()=>{Wy();_n=class extends mp{};t(_n,"Veteran")});var uw=n(()=>{sb();sb()});var fw=n(()=>{cw();uw()});var su=n(()=>{fw()});var Ua,lu,_g=n(()=>{k();Ua=class extends C{};t(Ua,"AdvancedFlight");lu=Ua});var Yo,yw,lb=n(()=>{k();Yo=class extends C{};t(Yo,"Alphabet");yw=Yo});var no,dw,mb=n(()=>{k();no=class extends C{};t(no,"Astronomy");dw=no});var Da,gw,pb=n(()=>{k();Da=class extends C{};t(Da,"AtomicTheory");gw=Da});var pr,mu,Kg=n(()=>{k();pr=class extends C{};t(pr,"Automobile");mu=pr});var ao,hw,cb=n(()=>{k();ao=class extends C{};t(ao,"Banking");hw=ao});var No,xw,ub=n(()=>{k();No=class extends C{};t(No,"BridgeBuilding");xw=No});var Wo,qg,Vg=n(()=>{k();Wo=class extends C{};t(Wo,"BronzeWorking");qg=Wo});var so,Ow,fb=n(()=>{k();so=class extends C{};t(so,"CeremonialBurial");Ow=so});var Kn,Rw,yb=n(()=>{k();Kn=class extends C{};t(Kn,"Chemistry");Rw=Kn});var fs,pu,Jg=n(()=>{k();fs=class extends C{};t(fs,"Chivalry");pu=fs});var $r,vw,db=n(()=>{k();$r=class extends C{};t($r,"CodeOfLaws");vw=$r});var qn,cu,$g=n(()=>{k();qn=class extends C{};t(qn,"Combustion");cu=qn});var St,bw,gb=n(()=>{k();St=class extends C{};t(St,"Communism");bw=St});var lo,Cw,hb=n(()=>{k();lo=class extends C{};t(lo,"Computers");Cw=lo});var ys,xm,Zg=n(()=>{k();ys=class extends C{};t(ys,"Conscription");xm=ys});var Gi,Tw,xb=n(()=>{k();Gi=class extends C{};t(Gi,"Construction");Tw=Gi});var Lo,Pw,Ob=n(()=>{k();Lo=class extends C{};t(Lo,"Corporation");Pw=Lo});var mo,Iw,Rb=n(()=>{k();mo=class extends C{};t(mo,"Currency");Iw=mo});var jo,ww,vb=n(()=>{k();jo=class extends C{};t(jo,"Democracy");ww=jo});var Zr,Aw,bb=n(()=>{k();Zr=class extends C{};t(Zr,"Electricity");Aw=Zr});var Bt,Bw,Cb=n(()=>{k();Bt=class extends C{};t(Bt,"Electronics");Bw=Bt});var Vn,Gw,Tb=n(()=>{k();Vn=class extends C{};t(Vn,"Engineering");Gw=Vn});var Jn,Mw,Pb=n(()=>{k();Jn=class extends C{};t(Jn,"Explosives");Mw=Jn});var Ea,Uw,Ib=n(()=>{k();Ea=class extends C{};t(Ea,"Feudalism");Uw=Ea});var ka,Qg,Xg=n(()=>{k();ka=class extends C{};t(ka,"Flight");Qg=ka});var ds,Dw,wb=n(()=>{k();ds=class extends C{};t(ds,"FusionPower");Dw=ds});var $n,Ew,Ab=n(()=>{k();$n=class extends C{};t($n,"GeneticEngineering");Ew=$n});var Br,Gp,eh=n(()=>{k();Br=class extends C{};t(Br,"Gunpowder");Gp=Br});var gs,th,rh=n(()=>{k();gs=class extends C{};t(gs,"HorsebackRiding");th=gs});var Gr,uu,ih=n(()=>{k();Gr=class extends C{};t(Gr,"Industrialization");uu=Gr});var Qr,kw,Bb=n(()=>{k();Qr=class extends C{};t(Qr,"Invention");kw=Qr});var Zn,oh,nh=n(()=>{k();Zn=class extends C{};t(Zn,"IronWorking");oh=Zn});var hs,ah,sh=n(()=>{k();hs=class extends C{};t(hs,"LaborUnion");ah=hs});var Xr,Sw,Gb=n(()=>{k();Xr=class extends C{};t(Xr,"Literacy");Sw=Xr});var Mi,fu,lh=n(()=>{k();Mi=class extends C{};t(Mi,"Magnetism");fu=Mi});var zo,mh,ph=n(()=>{k();zo=class extends C{};t(zo,"MapMaking");mh=zo});var cr,Fw,Mb=n(()=>{k();cr=class extends C{};t(cr,"Masonry");Fw=cr});var ei,ch,uh=n(()=>{k();ei=class extends C{};t(ei,"MassProduction");ch=ei});var po,fh,yh=n(()=>{k();po=class extends C{};t(po,"Mathematics");fh=po});var co,Yw,Ub=n(()=>{k();co=class extends C{};t(co,"Medicine");Yw=co});var Qn,yu,dh=n(()=>{k();Qn=class extends C{};t(Qn,"Metallurgy");yu=Qn});var Ui,Nw,Db=n(()=>{k();Ui=class extends C{};t(Ui,"Monarchy");Nw=Ui});var ur,Ww,Eb=n(()=>{k();ur=class extends C{};t(ur,"Mysticism");Ww=ur});var uo,du,gh=n(()=>{k();uo=class extends C{};t(uo,"Navigation");du=uo});var Di,Lw,kb=n(()=>{k();Di=class extends C{};t(Di,"NuclearFission");Lw=Di});var Ho,jw,Sb=n(()=>{k();Ho=class extends C{};t(Ho,"NuclearPower");jw=Ho});var Ei,zw,Fb=n(()=>{k();Ei=class extends C{};t(Ei,"Philosophy");zw=Ei});var fo,Hw,Yb=n(()=>{k();fo=class extends C{};t(fo,"Physics");Hw=fo});var Xn,gu,hh=n(()=>{k();Xn=class extends C{};t(Xn,"Plastics");gu=Xn});var ea,_w,Nb=n(()=>{k();ea=class extends C{};t(ea,"Pottery");_w=ea});var ki,Kw,Wb=n(()=>{k();ki=class extends C{};t(ki,"Railroad");Kw=ki});var ta,qw,Lb=n(()=>{k();ta=class extends C{};t(ta,"Recycling");qw=ta});var yo,Vw,jb=n(()=>{k();yo=class extends C{};t(yo,"Refining");Vw=yo});var Ft,Jw,zb=n(()=>{k();Ft=class extends C{};t(Ft,"Religion");Jw=Ft});var ra,xs,hu=n(()=>{k();ra=class extends C{};t(ra,"Robotics");xs=ra});var Sa,xh,Oh=n(()=>{k();Sa=class extends C{};t(Sa,"Rocketry");xh=Sa});var _o,Rh,vh=n(()=>{k();_o=class extends C{};t(_o,"SpaceFlight");Rh=_o});var Fa,bh,Ch=n(()=>{k();Fa=class extends C{};t(Fa,"SteamEngine");bh=Fa});var Ya,Th,Ph=n(()=>{k();Ya=class extends C{};t(Ya,"Steel");Th=Ya});var Ko,$w,Hb=n(()=>{k();Ko=class extends C{};t(Ko,"Superconductor");$w=Ko});var go,Zw,_b=n(()=>{k();go=class extends C{};t(go,"TheRepublic");Zw=go});var Os,Ih,wh=n(()=>{k();Os=class extends C{};t(Os,"TheWheel");Ih=Os});var qo,Qw,Kb=n(()=>{k();qo=class extends C{};t(qo,"TheoryOfGravity");Qw=qo});var ia,Ah,Bh=n(()=>{k();ia=class extends C{};t(ia,"Trade");Ah=ia});var Mr,Xw,qb=n(()=>{k();Mr=class extends C{};t(Mr,"University");Xw=Mr});var ho,Gh,Mh=n(()=>{k();ho=class extends C{};t(ho,"Writing");Gh=ho});var ti=n(()=>{_g();lb();mb();pb();Kg();cb();ub();Vg();fb();yb();Jg();db();$g();gb();hb();Zg();xb();Ob();Rb();vb();bb();Cb();Tb();Pb();Ib();Xg();wb();Ab();eh();rh();ih();Bb();nh();sh();Gb();lh();ph();Mb();uh();yh();Ub();dh();Db();Eb();gh();kb();Sb();Fb();Yb();hh();Nb();Wb();Lb();jb();zb();hu();Oh();vh();Ch();Ph();Hb();_b();wh();Kb();Bh();qb();Mh()});var xo,eA=n(()=>{Yl();xo=class extends Bi{};t(xo,"Anarchy")});var Yt,tA=n(()=>{Yl();Yt=class extends Bi{};t(Yt,"Communism")});var Ot,rA=n(()=>{Yl();Ot=class extends Bi{};t(Ot,"Democracy")});var fr,iA=n(()=>{Yl();fr=class extends Bi{};t(fr,"Despotism")});var Rt,oA=n(()=>{Yl();Rt=class extends Bi{};t(Rt,"Monarchy")});var Gt,nA=n(()=>{Yl();Gt=class extends Bi{};t(Gt,"Republic")});var oa=n(()=>{eA();tA();rA();iA();oA();nA()});var Uh,Na,Dh=n(()=>{Qm();Uh=class extends Rl{};t(Uh,"OfferPeace");Na=Uh});var Si,aA=n(()=>{ze();Si=class extends z{};t(Si,"Aqueduct")});var Ur,sA=n(()=>{ze();Ur=class extends z{};t(Ur,"Bank")});var Fi,lA=n(()=>{ze();Fi=class extends z{};t(Fi,"Barracks")});var Dr,mA=n(()=>{ze();Dr=class extends z{};t(Dr,"Cathedral")});var Vo,pA=n(()=>{ze();Vo=class extends z{};t(Vo,"CityWalls")});var Yi,cA=n(()=>{ze();Yi=class extends z{};t(Yi,"Colosseum")});var ri,uA=n(()=>{ze();ri=class extends z{};t(ri,"Courthouse")});var yr,fA=n(()=>{ze();yr=class extends z{};t(yr,"Factory")});var Ni,yA=n(()=>{ze();Ni=class extends z{};t(Ni,"Granary")});var Nt,dA=n(()=>{ze();Nt=class extends z{};t(Nt,"HydroPlant")});var ii,gA=n(()=>{ze();ii=class extends z{};t(ii,"Library")});var oi,hA=n(()=>{ze();oi=class extends z{};t(oi,"ManufacturingPlant")});var Er,xA=n(()=>{ze();Er=class extends z{};t(Er,"Marketplace")});var Jo,OA=n(()=>{ze();Jo=class extends z{};t(Jo,"MassTransit")});var Wt,RA=n(()=>{ze();Wt=class extends z{};t(Wt,"NuclearPlant")});var Mt,vA,Vb=n(()=>{ze();Mt=class extends z{};t(Mt,"Palace");vA=Mt});var Lt,bA=n(()=>{ze();Lt=class extends z{};t(Lt,"PowerPlant")});var $o,CA=n(()=>{ze();$o=class extends z{};t($o,"RecyclingCenter")});var Zo,TA=n(()=>{ze();Zo=class extends z{};t(Zo,"SdiDefence")});var Qt,PA=n(()=>{ze();Qt=class extends z{};t(Qt,"Temple")});var ni,IA=n(()=>{ze();ni=class extends z{};t(ni,"University")});var Oo=n(()=>{aA();sA();lA();mA();pA();cA();uA();fA();yA();dA();gA();hA();xA();OA();RA();Vb();bA();CA();TA();PA();IA()});var Eh,Nl,wA=n(()=>{ib();Pc();Eh=class extends Wm{#e=1/0;end(){return this.entries()[this.length-1]}static for(e,r,o,a=Ug){let[s]=a.entries().map(l=>new l(e,r,o)).map(l=>l.generate()).sort((l,c)=>l.movementCost()-c.movementCost());return s&&(s.shift(),s)}movementCost(){return this.#e}setMovementCost(e){this.#e=e}push(...e){e.forEach(r=>{let o=this.end();if(this.length>0&&!r.isNeighbourOf(o))throw new TypeError(`Tile#push: Invalid element passed, ${r.x()},${r.y()} is not a neighbour of ${o.x()},${o.y()}.`);super.push(r)})}start(){return this.entries()[0]}};t(Eh,"Path");Nl=Eh});var ai,Jb=n(()=>{$t();ai=class extends q{};t(ai,"Artillery")});var AA=n(()=>{Jb();Jb()});var si,$b=n(()=>{kl();si=class extends Ia{};t(si,"Battleship")});var BA=n(()=>{$b();$b()});var dr,Zb=n(()=>{gm();dr=class extends El{};t(dr,"Bomber")});var GA=n(()=>{Zb();Zb()});var kr,Qb=n(()=>{$t();kr=class extends q{};t(kr,"Cannon")});var MA=n(()=>{Qb();Qb()});var li,Xb=n(()=>{$t();li=class extends q{};t(li,"Caravan")});var UA=n(()=>{Xb();Xb()});var mi,eC=n(()=>{gm();Sl();mi=class extends Aa{canStow(e){return e instanceof El&&super.canStow(e)}capacity(){return 8}};t(mi,"Carrier")});var DA=n(()=>{eC();eC()});var Sr,tC=n(()=>{$t();Sr=class extends q{};t(Sr,"Catapult")});var EA=n(()=>{tC();tC()});var Fr,rC=n(()=>{$t();Fr=class extends q{};t(Fr,"Chariot")});var kA=n(()=>{rC();rC()});var pi,iC=n(()=>{kl();pi=class extends Ia{};t(pi,"Cruiser")});var SA=n(()=>{iC();iC()});var ci,oC=n(()=>{$t();ci=class extends q{};t(ci,"Diplomat")});var FA=n(()=>{oC();oC()});var jt,nC=n(()=>{gm();jt=class extends El{};t(jt,"Fighter")});var YA=n(()=>{nC();nC()});var Yr,aC=n(()=>{Sl();Yr=class extends Aa{capacity(){return 4}};t(Yr,"Frigate")});var NA=n(()=>{aC();aC()});var Xt,sC=n(()=>{$t();Xt=class extends q{};t(Xt,"Horseman")});var WA=n(()=>{sC();sC()});var Nr,lC=n(()=>{kl();Nr=class extends Ia{};t(Nr,"Ironclad")});var LA=n(()=>{lC();lC()});var Wr,mC=n(()=>{$t();Wr=class extends q{};t(Wr,"Knight")});var jA=n(()=>{mC();mC()});var ui,pC=n(()=>{$t();ui=class extends q{};t(ui,"MechanizedInfantry")});var zA=n(()=>{pC();pC()});var Lr,cC=n(()=>{$t();Lr=class extends q{};t(Lr,"Musketman")});var HA=n(()=>{cC();cC()});var zt,uC=n(()=>{gm();zt=class extends El{};t(zt,"Nuclear")});var _A=n(()=>{uC();uC()});var fi,fC=n(()=>{$t();fi=class extends q{};t(fi,"Rifleman")});var KA=n(()=>{fC();fC()});var jr,yC=n(()=>{Sl();jr=class extends Aa{capacity(){return 3}};t(jr,"Sail")});var qA=n(()=>{yC();yC()});var Le,VA,kh=n(()=>{bg();Le=class extends Zt{};t(Le,"Settlers");VA=Le});var JA=n(()=>{kh();kh()});var zr,dC=n(()=>{$t();zr=class extends q{};t(zr,"Spearman")});var $A=n(()=>{dC();dC()});var gr,gC=n(()=>{kl();gr=class extends Ia{};t(gr,"Submarine")});var ZA=n(()=>{gC();gC()});var er,hC=n(()=>{$t();er=class extends q{};t(er,"Swordman")});var QA=n(()=>{hC();hC()});var yi,xC=n(()=>{$t();yi=class extends q{};t(yi,"Tank")});var XA=n(()=>{xC();xC()});var di,OC=n(()=>{Sl();di=class extends Aa{capacity(){return 8}};t(di,"Transport")});var eB=n(()=>{OC();OC()});var tr,RC=n(()=>{Sl();tr=class extends Aa{capacity(){return 2}};t(tr,"Trireme")});var tB=n(()=>{RC();RC()});var gi,vC=n(()=>{$t();gi=class extends q{};t(gi,"Warrior")});var rB=n(()=>{vC();vC()});var iB=n(()=>{AA();BA();GA();MA();UA();DA();EA();kA();SA();FA();YA();NA();WA();LA();jA();zA();HA();_A();KA();qA();JA();$A();ZA();QA();XA();eB();tB();rB()});var Qo=n(()=>{iB()});var oB,Uj,Dj,Sh,Wa,Mp=n(()=>{ep();lm();Tc();Pa();kt();tt();Ta();Fo();X();es();Ba();ou();Fl();us();Ga();ib();zn();Ye();fm();wi();M();Cn();Ii();at();ls();Ke();jg();tf();ip();Xc();Jf();Hg();su();ts();Gc();ti();oa();Iv();Dh();Oo();wA();Ld();mm();Qo();Ki();os();Se();Dl();oB=t((i,e)=>new Promise((r,o)=>setTimeout(()=>e===void 0?r():o(e),i)),"awaitTimeout"),Uj=t((i,e,r=V)=>{let o=r.getByTile(i);return o===null?!1:o.player()===e},"hasPlayerCity"),Dj=15,Sh=class extends Vl{#e=e=>this.#u.getByPlayer(this.player()).some(r=>r.tiles().includes(e));#t=e=>{let r=this.#U.option("earth",!1),o=this.#u.getByPlayer(this.player()).length===0;if(r&&o)return!0;let a=this.#G.getByTerrain(e.terrain());return(e.terrain()instanceof Te||e.terrain()instanceof pe||e.terrain()instanceof de||a.some(s=>s instanceof oo)||a.some(s=>s instanceof io))&&e.getSurroundingArea().score(this.player(),[[te,4],[Q,2],[ye,1]])>=160&&!e.getSurroundingArea(4).filter(s=>this.#u.getByTile(s)!==null).length};#r=e=>[Ee,de,Te,pe].some(r=>e.terrain()instanceof r)&&!this.#R.getByTile(e).some(r=>r instanceof Fe)&&this.#e(e)&&[...e.getAdjacent(),e].some(r=>r.terrain()instanceof pe||r.isCoast()||this.#R.getByTile(r).some(o=>o instanceof Fe)&&this.#u.getByTile(r)===null);#i=e=>[Ne,Je].some(r=>e.terrain()instanceof r)&&!this.#R.getByTile(e).some(r=>r instanceof mt)&&this.#e(e);#o=e=>!this.#R.getByTile(e).some(r=>r instanceof qe)&&this.#e(e);#a=new Map;#n=new Map;#l=new Map;#s=[];#m=[];#f=[];#h=[];#y=[];#d=[];#c=[];#u;#T;#v;#P;#I;#C;#g;#w;#A;#B;#x;#O;#G;#R;#M;#b;#p;#U;constructor(e,r=V,o=Vt,a=re,s=Ai,l=Ug,c=At,u=L,y=ro,h=ne,G=f,Y=Tt,d=He,O=Ar,x=_,R=I,B=qt,N=mr,Ie=Z){super(e),this.#u=r,this.#T=o,this.#v=a,this.#P=B,this.#I=s,this.#C=N,this.#g=l,this.#w=c,this.#A=u,this.#B=y,this.#x=h,this.#O=G,this.#G=Y,this.#M=Ie,this.#b=O,this.#R=d,this.#p=x,this.#U=R}scoreUnitMove(e,r){let o=e.actions(r),{attack:a,buildIrrigation:s,buildMine:l,buildRoad:c,captureCity:u,disembark:y,embark:h,fortify:G,foundCity:Y,noOrders:d,sneakAttack:O}=o.reduce((we,vr)=>({...we,[vr.constructor.name.replace(/^./,Rj=>Rj.toLowerCase())]:vr}),{});if(O&&!this.shouldAttack(O))return-10;if(!o.length||o.length===1&&d||e instanceof q&&o.length===2&&G&&d)return-1;let x=0;this.#I.getByTile(r)!==null&&(x+=60),(Y&&this.#t(r)||l&&this.#i(r)||s&&this.#r(r)||c&&this.#o(r))&&(x+=24);let B=this.#p.getByTile(r).sort((we,vr)=>vr.defence().value()-we.defence().value()),[N]=B,Ie=B.some(we=>we.player()===this.player());e instanceof wt&&e.hasCapacity()&&B.length&&Ie&&(x+=10),e instanceof wt&&e.hasCargo()&&r.isCoast()&&r.isWater()&&(x+=16),h&&(x+=16),y&&(x+=16),u&&(x+=100),a&&e.attack()>N.defence()&&(x+=24*(e.attack().value()-N.defence().value())),a&&e.attack().value()>=N.defence().value()&&(x+=16),a&&e.attack().value()>=N.defence().value()*(2/3)&&(x+=8);let Rr=this.#x.getByPlayer(this.player()),Kt=r.getNeighbours().filter(we=>!Rr.includes(we)).length;Kt>0&&(x+=Kt*3);let xe=this.#l.get(e);return xe instanceof fe&&r.distanceFrom(xe)<e.tile().distanceFrom(xe)&&(x+=14),(this.#a.get(e)||[]).includes(r)||(x*=4),x}async moveUnit(e){let r=0;for(;e.active()&&e.moves().value()>=.1;){if(r++>1e3){console.log("SimpleAIClient#moveUnit: loopCheck: aborting"),console.log(`${e.player().civilization().name()} ${e.constructor.name}`),console.log(e.actions()),console.log(e.actionsForNeighbours()),this.noOrders(e);return}let o=this.#n.get(e);if(o){let y=o.shift(),[h]=e.actions(y).filter(G=>G instanceof pt);if(h){e.action(h),o.length===0&&this.#n.delete(e),await this.canNegotiate(e);continue}if(o.length>0){let G=Nl.for(e,e.tile(),o.end());if(G){this.#n.set(e,G);continue}}this.#n.delete(e)}let[a]=e.tile().getNeighbours().map(y=>[y,this.scoreUnitMove(e,y)]).filter(([,y])=>y>-1).sort(([,y],[,h])=>h-y||Math.floor(Math.random()*3)-1).map(([y])=>y);if(!a){this.noOrders(e);return}let s=e.actions(a),[l]=s,c=this.#a.get(e)||[],u=this.#l.get(e);if(!l||(l instanceof Dn||l instanceof En)&&!this.shouldAttack(l)){this.noOrders(e);return}u===a&&this.#l.delete(e),c.push(a),this.#a.set(e,c.slice(-50)),e.action(l)}await this.canNegotiate(e),e.moves().value()>0&&this.noOrders(e)}preProcessTurn(){this.#s.splice(0),this.#m.splice(0),this.#f.splice(0),this.#h.splice(0),this.#y.splice(0),this.#d.splice(0),this.#c.splice(0);let e=this.#x.getByPlayer(this.player());e.entries().forEach(r=>{let o=r.tile(),a=this.#u.getByTile(o),s=this.#p.getBy("tile",o),l=this.#c.includes(o)&&![...this.#l.values(),...[...this.#n.values()].map(c=>c.end())].includes(o);a&&a.player()===this.player()&&!s.length&&!this.#c.includes(o)&&!l?this.#c.push(o):a&&a.player()!==this.player()&&a.originalPlayer()===this.player()?this.#s.push(o):a&&a.player()!==this.player()&&!this.#m.includes(o)?this.#m.push(o):s.length&&s.some(c=>c.player()!==this.player())&&this.#f.includes(o)?this.#f.push(o):o.isLand()&&o.getNeighbours().some(c=>!e.includes(c))&&!this.#y.includes(o)&&!l?this.#y.push(o):o.isWater()&&o.getNeighbours().some(c=>!e.includes(c))&&this.#d.includes(o)&&!l&&this.#d.push(o),this.#t(o)&&this.#h.includes(o)&&!l&&this.#h.push(o)}),this.#u.getByPlayer(this.player()).forEach(r=>{let o=this.#p.getByTile(r.tile());Ip(r,this.#x,this.#v),!o.length&&!this.#c.includes(r.tile())&&this.#c.push(r.tile())})}async chooseFromList(e){if(e.key()!=="negotiation.next-step")return super.chooseFromList(e);let r=t(a=>a instanceof Ma?30:a instanceof Na?20:a instanceof Hn?10:0,"score"),[o]=e.choices().sort((a,s)=>r(s.value())-r(a.value()));return o.value()}takeTurn(){return new Promise(async(e,r)=>{try{let o=0;this.preProcessTurn();let[a]=this.#w.filter(l=>l.player()===this.player()),[s]=this.#A.filter(l=>l.player()===this.player());for(s.completed(Ui)&&!a.is(Rt)&&a.set(new Rt);this.player().hasMandatoryActions();){let l=this.player().mandatoryAction(),c=l.value();if(o++>1e3){console.log(""),console.log(""),console.log(c),c instanceof Ue&&(console.log(c.actions()),c.tile().getNeighbours().forEach(u=>console.log(c.actions(u))),console.log(c.active()),console.log(c.busy()),console.log(c.moves().value()),console.log(this.#b.getByUnit(c))),this.noOrders(c),console.error("SimpleAIClient: Couldn't pick an action to do.");break}if(c instanceof Ue){let u=c,y=u.tile(),h=this.#l.get(u),G=u.actions(),{buildIrrigation:Y,buildMine:d,buildRoad:O,fortify:x,foundCity:R,unload:B}=G.reduce((xe,Oe)=>({...xe,[Oe.constructor.name.replace(/^./,we=>we.toLowerCase())]:Oe}),{}),N=this.#p.getByTile(y);if(this.#a.get(u)||this.#a.set(u,[u.tile()]),u instanceof wt&&B&&y.isCoast()&&u.cargo().some(xe=>!y.getNeighbours().some(Oe=>(this.#a.get(xe)||[]).includes(Oe)))){u.action(B),u.setWaiting();continue}if(u instanceof Zt){R&&this.#t(y)?u.action(R):Y&&this.#r(y)?u.action(Y):d&&this.#i(y)?u.action(d):O&&this.#o(y)?u.action(O):!h&&this.#h.length&&this.#l.set(u,this.#h.shift()),await this.moveUnit(u);continue}let[Rr]=N.filter(xe=>this.#b.getByUnit(xe).some(Oe=>Oe instanceof Jr)&&u.defence()>xe.defence()),Kt=this.#u.getByTile(y);if(x&&Kt&&(Rr||N.length<=Math.ceil(this.#v.getByCity(Kt).size()/5))){u.action(x),Rr&&Rr.activate();continue}if(!h){if(u instanceof q&&u.defence().value()>0&&this.#c.length>0){let[xe]=this.#c.sort((we,vr)=>we.distanceFrom(u.tile())-vr.distanceFrom(u.tile())),Oe=Nl.for(u,u.tile(),xe,this.#g);Oe&&(this.#c.splice(this.#c.indexOf(xe),1),this.#n.set(u,Oe))}else if(u.attack().value()>0&&this.#s.length>0){let[xe]=this.#s.filter(we=>u instanceof $e&&we.isLand()).sort((we,vr)=>we.distanceFrom(u.tile())-vr.distanceFrom(u.tile())),Oe=Nl.for(u,u.tile(),xe,this.#g);Oe&&(this.#s.splice(this.#s.indexOf(xe),1),this.#n.set(u,Oe))}else if(u.attack().value()>0&&this.#f.length>0){let[xe]=this.#f.filter(we=>u instanceof $e&&we.isLand()||u instanceof We&&we.isWater()).sort((we,vr)=>we.distanceFrom(u.tile())-vr.distanceFrom(u.tile())),Oe=Nl.for(u,u.tile(),xe,this.#g);Oe&&(this.#f.splice(this.#f.indexOf(xe),1),this.#n.set(u,Oe))}else if(u instanceof $e&&u.attack().value()>0&&this.#m.length>0){let[xe]=this.#m.sort((we,vr)=>we.distanceFrom(u.tile())-vr.distanceFrom(u.tile())),Oe=Nl.for(u,u.tile(),xe,this.#g);Oe&&(this.#m.splice(this.#m.indexOf(xe),1),this.#n.set(u,Oe))}else if(u instanceof $e&&this.#y.length>0){let[xe]=this.#y.sort((we,vr)=>we.distanceFrom(u.tile())-vr.distanceFrom(u.tile())),Oe=Nl.for(u,u.tile(),xe,this.#g);Oe&&(this.#y.splice(this.#y.indexOf(xe),1),this.#n.set(u,Oe))}else if(u instanceof We&&this.#d.length>0){let[xe]=this.#d.sort((we,vr)=>we.distanceFrom(u.tile())-vr.distanceFrom(u.tile())),Oe=Nl.for(u,u.tile(),xe,this.#g);Oe&&(this.#d.splice(this.#d.indexOf(xe),1),this.#n.set(u,Oe))}}await this.moveUnit(u);continue}if(c instanceof Ml){this.buildItemInCity(c.city());continue}if(c instanceof vp){let u=c.available();u.length&&c.research(u[Math.floor(u.length*Math.random())]);continue}if(l instanceof Vf)break;console.log(`Can't process: '${c.constructor.name}'`);break}e()}catch(o){if(typeof o=="string"){r(new Error(o));return}if(o instanceof Error){r(o);return}r(new Error(`An unknown error occurred: ${o}`))}})}buildItemInCity(e){let r=e.tile(),o=this.#T.getByCity(e),a=this.#p.getByTile(r),s=o.available(),l=[Mt,Le],c=s.filter(x=>!l.includes(x.item())&&!Object.prototype.isPrototypeOf.call(Pe,x.item())),u=s.filter(x=>Object.prototype.isPrototypeOf.call(Pe,x.item())),y=c.filter(x=>Object.prototype.isPrototypeOf.call(Ue,x.item())),h=c[Math.floor(c.length*Math.random())].item(),G=t(x=>{let[[R]]=y.map(B=>{let N=B.item(),Ie=new x;return this.#O.process(bl,N,Ie),[N,Ie]}).sort(([,B],[,N])=>N.value()-B.value());return R},"getUnitByYield"),Y=(x=>()=>x||(x=G(Ji)))(),d=(x=>()=>x||(x=G(Io)))();if(this.#p.getByTile(r).length<2&&Y()){o.build(Y());return}let O=this.#v.getByCity(o.city());if(s.some(x=>x.item()===Le)&&!this.#p.getByCity(o.city()).some(x=>x instanceof Le)&&this.#p.getByPlayer(this.player()).filter(x=>x instanceof Le).length<3&&O.size()>1){o.build(Le);return}if(this.#s.length>0||this.#m.length>0||this.#f.length>4){o.build(d());return}if(a.filter(x=>this.#b.getByUnit(x).filter(R=>R instanceof Jr)).length<2||this.#c.length){o.build(Y());return}if(o.city().yields().filter(x=>x instanceof Q).some(x=>x.value()>4)){let x=u.map(R=>R.item());o.build(x[Math.floor(Math.random()*x.length)])}h&&o.build(h)}cityLost(e,r,o){if(!r)return;let a=this.#x.getByPlayer(this.player());if(o){this.#m.push(...a.entries().filter(s=>Uj(s.tile(),this.player(),this.#u)).map(s=>s.tile())),this.#f.push(...a.entries().filter(s=>this.#p.getByTile(s.tile()).some(l=>l.player()===r)).map(s=>s.tile()));return}this.#s.push(e.tile())}unitDestroyed(e,r){let o=this.#u.getByTile(e.tile()),a=this.#p.getByTile(e.tile());o&&o.player()===this.player()&&a.length<2&&(this.buildItemInCity(o),this.#B.getByPlayerAndType(this.player(),Pi).buy(o))}async canNegotiate(e){let r=Array.from(new Set(e.tile().getNeighbours().flatMap(o=>this.#p.getByTile(o).map(a=>a.player()).filter(a=>a!==this.player()))));r.length!==0&&await r.filter(o=>this.#C.getByPlayer(o).filter(a=>a instanceof pp&&a.isBetween(o,this.player())).every(a=>this.#M.value()-a.when()>Dj)).reduce((o,a)=>o.then(()=>this.handleNegotiation(a)),Promise.resolve())}async handleNegotiation(e){let r=new pp(this.player(),e,this.#O);for(r.proceed(new Po(this.player(),r,this.#O));!r.terminated();){let o=r.lastInteraction();if(await(o!==null?o.for():r.players().slice(1)).reduce(async(s,l)=>s.then(async()=>{let c=this.#P.getByPlayer(l),u=r.nextSteps(),h=await Promise.race([c.chooseFromList(new ol(u,"negotiation.next-step",r)),c instanceof Vl?oB(500,new Error(`Timeout waiting for ${c.player().id()} (${c.player().civilization().sourceClass().name}) - sent ${u.length} options`)):new Promise(()=>{})]);!h||(r.proceed(h),h instanceof Mo&&await h.proposal().resolve(h),await oB(20))}).catch(c=>console.error(c)),Promise.resolve()),r.terminated())break}return this.#C.register(r),r}noOrders(e){e.action(new Gn(e.tile(),e.tile(),e,this.#O))}shouldAttack(e){return!1}};t(Sh,"SimpleAIClient");Wa=Sh});var Rs,Om,Up=n(()=>{sr();Rs=class extends he{};t(Rs,"American");Om=Rs});var Ej={};var nB=n(()=>{Up();Ir();nr();Object.entries({people:"American",nation:"America",colors:["#0055A4","#FFF"]}).forEach(([i,e])=>ve.register(new Ae(Om,i,e)))});var kj={};var aB=n(()=>{Up();ar();Ct();["Washington","New York","Los Angeles","Chicago","Houston","Phoenix","Philadelphia","San Antonio","San Diego","Dallas","San Jose","Austin","Jacksonville","Fort Worth","Columbus","San Francisco","Charlotte","Indianapolis","Seattle","Denver","Boston","El Paso","Detroit","Nashville","Portland","Memphis","Oklahoma City","Las Vegas","Louisville","Baltimore","Milwaukee","Albuquerque","Tucson","Fresno","Mesa","Sacramento","Atlanta","Kansas City","Colorado Springs","Miami","Raleigh","Omaha","Long Beach","Virginia Beach","Oakland","Minneapolis","Tulsa","Arlington","Tampa","New Orleans","Wichita","Cleveland","Bakersfield","Aurora","Anaheim","Honolulu","Santa Ana","Riverside","Corpus Christi","Lexington","Stockton","Henderson","Saint Paul","St. Louis","Cincinnati","Pittsburgh","Greensboro","Anchorage","Plano","Lincoln","Orlando","Irvine","Newark","Toledo","Durham","Chula Vista","Fort Wayne","Jersey City","St. Petersburg","Laredo","Madison","Chandler","Buffalo","Lubbock","Scottsdale","Reno","Glendale","Gilbert","Winston\u2013Salem","North Las Vegas","Norfolk","Chesapeake","Garland","Irving","Hialeah","Fremont","Boise","Richmond","Baton Rouge","Spokane","Des Moines","Tacoma","San Bernardino","Modesto","Fontana","Santa Clarita","Birmingham","Oxnard","Fayetteville","Moreno Valley","Rochester","Huntington Beach","Salt Lake City","Grand Rapids","Amarillo","Yonkers","Montgomery","Akron","Little Rock","Huntsville","Augusta","Port St. Lucie","Grand Prairie","Tallahassee","Overland Park","Tempe","McKinney","Mobile","Cape Coral","Shreveport","Frisco","Knoxville","Worcester","Brownsville","Vancouver","Fort Lauderdale","Sioux Falls","Ontario","Chattanooga","Providence","Newport News","Rancho Cucamonga","Santa Rosa","Oceanside","Salem","Elk Grove","Garden Grove","Pembroke Pines","Peoria","Eugene","Corona","Cary","Springfield","Fort Collins","Jackson","Alexandria","Hayward","Lancaster","Lakewood","Clarksville","Palmdale","Salinas","Hollywood","Pasadena","Sunnyvale","Macon","Pomona","Escondido","Killeen","Naperville","Joliet","Bellevue","Rockford","Savannah","Paterson","Torrance","Bridgeport","McAllen","Mesquite","Syracuse","Midland","Murfreesboro","Miramar","Dayton","Fullerton","Olathe","Orange","Thornton","Roseville","Denton","Waco","Surprise","Carrollton","West Valley City","Charleston","Warren","Hampton","Gainesville","Visalia","Coral Springs","Columbia","Cedar Rapids","Sterling Heights","New Haven","Stamford","Concord","Kent","Santa Clara","Elizabeth","Round Rock","Thousand Oaks","Lafayette","Athens","Topeka","Simi Valley","Fargo","Norman","Abilene","Wilmington","Hartford","Victorville","Pearland","Vallejo","Ann Arbor","Berkeley","Allentown","Richardson","Odessa","Arvada","Cambridge","Sugar Land","Beaumont","Lansing","Evansville","Independence","Fairfield","Provo","Clearwater","College Station","West Jordan","Carlsbad","El Monte","Murrieta","Temecula","Palm Bay","Costa Mesa","Westminster","North Charleston","Miami Gardens","Manchester","High Point","Downey","Clovis","Pompano Beach","Pueblo","Elgin","Lowell","Antioch","West Palm Beach","Everett","Ventura","Centennial","Lakeland","Gresham","Billings","Inglewood","Broken Arrow","Sandy Springs","Jurupa Valley","Hillsboro","Waterbury","Santa Maria","Boulder","Greeley","Daly City","Meridian","Lewisville","Davie","West Covina","League City","Tyler","Norwalk","San Mateo","Green Bay","Wichita Falls","Sparks","Burbank","Rialto","Allen","El Cajon","Las Cruces","Renton","Davenport","South Bend","Vista","Tuscaloosa","Clinton","Edison","Woodbridge","San Angelo","Kenosha","Vacaville"].forEach((i,e)=>oe.register(new me(i,Om,e===0)))});var lB=w(sB=>{"use strict";Object.defineProperty(sB,"__esModule",{value:!0});nB();aB()});var vs,Dp,xu=n(()=>{sr();vs=class extends he{};t(vs,"Aztec");Dp=vs});var Sj={};var mB=n(()=>{xu();Ir();nr();Object.entries({people:"Aztec",nation:"Aztec",colors:["#A1DAB5","#EA6B76"]}).forEach(([i,e])=>ve.register(new Ae(Dp,i,e)))});var Fj={};var pB=n(()=>{xu();ar();Ct();["Tenochtitlan","Teotihuacan","Tlatelolco","Texcoco","Tlaxcala","Calixtlahuaca","Xochicalco","Tlacopan","Atzcapotzalco","Tzintzuntzan","Malinalco","Tula","Tamuin","Teayo","Cempoala","Chalco","Tlalmanalco","Ixtapaluca","Huexotla","Tepexpan","Tepetlaoxtoc","Chiconautla","Zitlaltepec","Coyotepec","Tequixquiac","Jilotzingo","Tlapanaloya","Tultitan","Ecatepec","Coatepec","Chalchiuites","Chiauhita","Chapultepec","Itzapalapa","Ayotzinco","Iztapam"].forEach((i,e)=>oe.register(new me(i,Dp,e===0)))});var uB=w(cB=>{"use strict";Object.defineProperty(cB,"__esModule",{value:!0});mB();pB()});var bs,Ep,Ou=n(()=>{sr();bs=class extends he{};t(bs,"Babylonian");Ep=bs});var Yj={};var fB=n(()=>{Ou();Ir();nr();Object.entries({people:"Babylonian",nation:"Babylon",colors:["#D0B8A6","#2f7b00"]}).forEach(([i,e])=>ve.register(new Ae(Ep,i,e)))});var Nj={};var yB=n(()=>{Ou();ar();Ct();["Babilim","Eshnunna","Diniktum","Tutub","Der","Sippar","Kutha","Jemdet Nasr","Kish","Borsippa","Mashkan-shapir","Dilbat","Nippur","Marad","Adab","Isin","Kisurra","Shuruppak","Bad-tibira","Zabalam","Umma","Girsu","Lagash","Urum","Uruk","Larsa","Ur","Kuara","Eridu","Akshak","Akkad"].forEach((i,e)=>oe.register(new me(i,Ep,e===0)))});var gB=w(dB=>{"use strict";Object.defineProperty(dB,"__esModule",{value:!0});fB();yB()});var Cs,kp,Ru=n(()=>{sr();Cs=class extends he{};t(Cs,"Chinese");kp=Cs});var Wj={};var hB=n(()=>{Ru();Ir();nr();Object.entries({people:"Chinese",nation:"China",colors:["#ee1c25","#ff0"]}).forEach(([i,e])=>ve.register(new Ae(kp,i,e)))});var Lj={};var xB=n(()=>{Ru();ar();Ct();["Beijing","Shanghai","Chongqing","Tianjin","Guangzhou","Shenzhen","Chengdu","Nanjing","Wuhan","Xi'an","Hangzhou","Dongguan","Foshan","Shenyang","Harbin","Qingdao","Dalian","Jinan","Zhengzhou","Changsha","Kunming","Changchun","\xDCr\xFCmqi","Shantou","Hefei","Shijiazhuang","Ningbo","Taiyuan","Nanning","Xiamen","Fuzhou","Changzhou","Wenzhou","Nanchang","Tangshan","Guiyang","Wuxi","Lanzhou","Zhongshan","Handan","Huai'an","Weifang","Zibo","Shaoxing","Yantai","Huizhou","Luoyang","Nantong","Baotou","Liuzhou"].forEach((i,e)=>oe.register(new me(i,kp,e===0)))});var RB=w(OB=>{"use strict";Object.defineProperty(OB,"__esModule",{value:!0});hB();xB()});var Ts,Sp,vu=n(()=>{sr();Ts=class extends he{};t(Ts,"Egyptian");Sp=Ts});var jj={};var vB=n(()=>{vu();Ir();nr();Object.entries({people:"Egyptian",nation:"Egypt",colors:["#CE1126","#FFF"]}).forEach(([i,e])=>ve.register(new Ae(Sp,i,e)))});var zj={};var bB=n(()=>{vu();ar();Ct();["Cairo","Alexandria","Gizeh","Shubra El-Kheima","Port Said","Suez","Luxor","al-Mansura","El-Mahalla El-Kubra","Tanta","Asyut","Ismailia","Fayyum","Zagazig","Aswan","Damietta","Damanhur","al-Minya","Beni Suef","Qena","Sohag","Hurghada","6th of October City","Shibin El Kom","Banha","Kafr el-Sheikh","Arish","Mallawi","10th of Ramadan City","Bilbais","Marsa Matruh","Idfu","Mit Ghamr","Al-Hamidiyya","Desouk","Qalyub","Abu Kabir","Kafr el-Dawwar","Girga","Akhmim","Matarey"].forEach((i,e)=>oe.register(new me(i,Sp,e===0)))});var TB=w(CB=>{"use strict";Object.defineProperty(CB,"__esModule",{value:!0});vB();bB()});var Ps,Rm,Fp=n(()=>{sr();Ps=class extends he{};t(Ps,"English");Rm=Ps});var Hj={};var PB=n(()=>{Fp();Ir();nr();Object.entries({people:"English",nation:"England",colors:["#FFF","#C8102E"]}).forEach(([i,e])=>ve.register(new Ae(Rm,i,e)))});var _j={};var IB=n(()=>{Fp();ar();Ct();["London","Birmingham","Liverpool","Leeds","Sheffield","Bristol","Manchester","Leicester","Coventry","Kingston upon Hull","Stoke-on-Trent","Wolverhampton","Nottingham","Plymouth","Southampton","Reading","Derby","Dudley","Newcastle upon Tyne","Northampton","Portsmouth","Luton","Preston","Sunderland","Norwich","Walsall","Bournemouth","Southend-on-Sea","Swindon","Huddersfield","Poole","Oxford","Middlesbrough","Blackpool","Oldbury","Boldon","Ipswich","York","West Bromwich","Peterborough","Stockport","Brighton","Slough","Gloucester","Rotherham","Cambridge","Exeter","Eastbourne","Sutton Coldfield","Blackburn","Colchester","Oldham","St Helens","Woking","Chesterfield","Crawley"].forEach((i,e)=>oe.register(new me(i,Rm,e===0)))});var AB=w(wB=>{"use strict";Object.defineProperty(wB,"__esModule",{value:!0});PB();IB()});var Is,Yp,bu=n(()=>{sr();Is=class extends he{};t(Is,"French");Yp=Is});var Kj={};var BB=n(()=>{bu();Ir();nr();Object.entries({people:"French",nation:"France",colors:["#FFF","#0055A4"]}).forEach(([i,e])=>ve.register(new Ae(Yp,i,e)))});var qj={};var GB=n(()=>{bu();ar();Ct();["Paris","Marseille","Lyon","Toulouse","Nice","Nantes","Strasbourg","Montpellier","Bordeaux","Lille","Rennes","Reims","Le Havre","Saint-\xC9tienne","Toulon","Grenoble","Dijon","N\xEEmes","Angers","Villeurbanne","Le Mans","Saint-Denis","Aix-en-Provence","Clermont-Ferrand","Brest","Limoges","Tours","Amiens","Perpignan","Metz","Besan\xE7on","Boulogne-Billancourt","Orl\xE9ans","Mulhouse","Rouen","Caen","Argenteuil","Saint-Paul","Montreuil","Nancy","Roubaix","Tourcoing","Nanterre","Avignon","Vitry-sur-Seine","Cr\xE9teil","Dunkirk","Poitiers","Asni\xE8res-sur-Seine","Courbevoie","Versailles","Colombes","Fort-de-France","Aulnay-sous-Bois","Saint-Pierre","Rueil-Malmaison","Pau","Aubervilliers","Le Tampon","Champigny-sur-Marne","Antibes","B\xE9ziers","La Rochelle","Saint-Maur-des-Foss\xE9s","Cannes","Calais","Saint-Nazaire","M\xE9rignac","Drancy","Colmar","Ajaccio","Bourges","Issy-les-Moulineaux","Levallois-Perret","La Seyne-sur-Mer","Quimper","Noisy-le-Grand","Villeneuve-d'Ascq","Neuilly-sur-Seine","Valence","Antony","Cergy","V\xE9nissieux","Pessac","Troyes","Clichy","Ivry-sur-Seine","Chamb\xE9ry","Lorient","Les Abymes","Montauban","Sarcelles","Niort","Villejuif","Saint-Andr\xE9","Hy\xE8res","Saint-Quentin","Beauvais","\xC9pinay-sur-Seine","Cayenne","Maisons-Alfort","Cholet","Meaux","Chelles","Pantin","\xC9vry","Fontenay-sous-Bois","Fr\xE9jus","Vannes","Bondy","Le Blanc-Mesnil","La Roche-sur-Yon","Saint-Louis","Arles","Clamart","Narbonne","Annecy","Sartrouville","Grasse","Laval","Belfort","Bobigny","\xC9vreux","Vincennes","Montrouge","Sevran","Albi","Charleville-M\xE9zi\xE8res","Suresnes","Martigues","Corbeil-Essonnes","Saint-Ouen","Bayonne","Cagnes-sur-Mer","Brive-la-Gaillarde","Carcassonne","Massy","Blois","Aubagne","Saint-Brieuc","Ch\xE2teauroux","Chalon-sur-Sa\xF4ne","Mantes-la-Jolie","Meudon","Saint-Malo","Ch\xE2lons-en-Champagne","Alfortville","S\xE8te","Salon-de-Provence","Vaulx-en-Velin","Puteaux","Rosny-sous-Bois","Saint-Herblain","Gennevilliers","Le Cannet","Livry-Gargan","Saint-Priest","Istres","Valenciennes","Choisy-le-Roi","Caluire-et-Cuire","Boulogne-sur-Mer","Bastia","Angoul\xEAme","Garges-l\xE8s-Gonesse","Castres","Thionville","Wattrelos","Talence","Saint-Laurent-du-Maroni","Douai","Noisy-le-Sec","Tarbes","Arras","Al\xE8s","La Courneuve","Bourg-en-Bresse","Compi\xE8gne","Gap","Melun","Le Lamentin","Rez\xE9","Saint-Germain-en-Laye","Marcq-en-Bar\u0153ul","Gagny","Anglet","Draguignan","Chartres","Bron","Bagneux","Colomiers","Saint-Martin-d'H\xE8res","Pontault-Combault","Montlu\xE7on","Jou\xE9-l\xE8s-Tours","Saint-Joseph","Poissy","Savigny-sur-Orge","Cherbourg-Octeville","Mont\xE9limar","Villefranche-sur-Sa\xF4ne","Stains","Saint-Beno\xEEt","Bagnolet","Ch\xE2tillon","Le Port","Sainte-Genevi\xE8ve-des-Bois","\xC9chirolles","Roanne","Villepinte","Saint-Chamond","Conflans-Sainte-Honorine","Auxerre","Nevers","Neuilly-sur-Marne","La Ciotat","Tremblay-en-France","Thonon-les-Bains","Vitrolles","Haguenau","Six-Fours-les-Plages","Agen","Creil","Annemasse","Saint-Rapha\xEBl","Marignane","Romans-sur-Is\xE8re","Montigny-le-Bretonneux","Le Perreux-sur-Marne","Franconville","M\xE2con","Saint-Leu","Cambrai","Ch\xE2tenay-Malabry","Sainte-Marie","Villeneuve-Saint-Georges","Houilles","\xC9pinal","Lens","Li\xE9vin","Les Mureaux","Schiltigheim","La Possession","Meyzieu","Dreux","Nogent-sur-Marne","Plaisir","Mont-de-Marsan","Palaiseau","Ch\xE2tellerault","Goussainville","L'Ha\xFF-les-Roses","Viry-Ch\xE2tillon","Vigneux-sur-Seine","Chatou","Trappes","Clichy-sous-Bois","Rillieux-la-Pape","Villenave-'Ornon","Maubeuge","Charenton-le-Pont","Malakoff","Matoury","Dieppe","Athis-Mons","Savigny-le-Temple","P\xE9rigueux","Baie-Mahault","Vandoeuvre-l\xE8s-Nancy","Pontoise","Aix-les-Bains","Cachan","Vienne","Thiais","Orange","Saint-M\xE9dard-en-Jalles","Villemomble","Saint-Cloud","Saint-Laurent-du-Var","Yerres","Saint-\xC9tienne-du-Rouvray","Sotteville-l\xE8s-Rouen","Draveil","Le Chesnay","Bois-Colombes","Le Plessis-Robinson","La Garenne-Colombes","Lambersart","Soissons","Pierrefitte-sur-Seine","Carpentras","Villiers-sur-Marne","Vanves","Menton","Bergerac","Ermont","Bezons","Grigny","Guyancourt","Saumur","Herblay","Ris-Orangis","Villiers-le-Bel","Bourgoin-Jallieu","Vierzon","Le Gosier","D\xE9cines-Charpieu","H\xE9nin-Beaumont","Fresnes","Aurillac","Sannois","Vallauris","Illkirch-Graffenstaden","Alen\xE7on","\xC9lancourt","Tournefeuille","B\xE8gles","Gonesse","Oullins","Brunoy","Taverny","Armenti\xE8res","Montfermeil","Rambouillet","Villeparisis","Le Kremlin-Bic\xEAtre","Sucy-en-Brie","Kourou","Montb\xE9liard","Romainville","Cavaillon","Saint-Dizier","Br\xE9tigny-sur-Orge","Saint-S\xE9bastien-sur-Loire","Saintes","La Teste-de-Buch","Villeneuve-la-Garenne","B\xE9thune","Bussy-Saint-Georges","Vichy","La Garde","Agde","Laon","Sens","Lunel","Miramas","Biarritz","Le Grand-Quevilly","Orvault","Les Ulis","Champs-sur-Marne","Rochefort","Muret","Sainte-Anne","Eaubonne","\xC9tampes","Gradignan","Vernon","Petit-Bourg","Libourne","Abbeville","Rodez","Saint-Ouen-l'Aum\xF4ne","Torcy","Maisons-Laffitte","Montgeron","Villeneuve-sur-Lot","Cormeilles-en-Parisis","\xC9pernay","S\xE8vres","Dole","Le Robert","Le Bouscat","Blagnac","Frontignan","Cenon","Mandelieu-la-Napoule","Vertou","Les Lilas","Bruay-la-Buissi\xE8re","Les Pavillons-sous-Bois","Chaumont","Roissy-en-Brie","Le Moule","Le Petit-Quevilly","Manosque","Saint-Mand\xE9","Fontenay-aux-Roses","Orly","Le Creusot","Oyonnax","La Madeleine","Sainte-Suzanne","Millau","Combs-la-Ville","Fontaine","Deuil-la-Barre","Coudekerque-Branche","Auch","Lanester","Beaune","Montigny-l\xE8s-Metz","Hazebrouck","Longjumeau","Sainte-Foy-l\xE8s-Lyon","Forbach","Sarreguemines","Mons-en-Bar\u0153ul","La Valette-du-Var","H\xE9rouville-Saint-Clair","Morsang-sur-Orge","Grande-Synthe","La Celle-Saint-Cloud","Lisieux","Croix","Dammarie-les-Lys","V\xE9lizy-Villacoublay","Wasquehal","Saint-Gratien","Halluin","Neuilly-Plaisance","Montmorency","Dax","Lagny-sur-Marne","Le M\xE9e-sur-Seine","Saint-Genis-Laval","Fleury-les-Aubrais","Loos","Gif-sur-Yvette","Denain","Saint-Di\xE9-des-Vosges","Sainte-Rose","Saint-Michel-sur-Orge"].forEach((i,e)=>oe.register(new me(i,Yp,e===0)))});var UB=w(MB=>{"use strict";Object.defineProperty(MB,"__esModule",{value:!0});BB();GB()});var ws,vm,Np=n(()=>{sr();ws=class extends he{};t(ws,"German");vm=ws});var Vj={};var DB=n(()=>{Np();Ir();nr();Object.entries({people:"German",nation:"Germany",colors:["#000","#FC0"]}).forEach(([i,e])=>ve.register(new Ae(vm,i,e)))});var Jj={};var EB=n(()=>{Np();ar();Ct();["Berlin","Hamburg","Munich","Cologne","Frankfurt","Stuttgart","D\xFCsseldorf","Dortmund","Essen","Leipzig","Bremen","Dresden","Hanover","Nuremberg","Duisburg","Bochum","Wuppertal","Bielefeld","Bonn","M\xFCnster","Karlsruhe","Mannheim","Augsburg","Wiesbaden","Gelsenkirchen","M\xF6nchengladbach","Braunschweig","Chemnitz","Kiel","Aachen","Halle","Magdeburg","Freiburg","Krefeld","L\xFCbeck","Oberhausen","Erfurt","Mainz","Rostock","Kassel","Hagen","Hamm","Saarbr\xFCcken","M\xFClheim an der Ruhr","Potsdam","Ludwigshafen am Rhein","Oldenburg","Leverkusen","Osnabr\xFCck","Solingen"].forEach((i,e)=>oe.register(new me(i,vm,e===0)))});var SB=w(kB=>{"use strict";Object.defineProperty(kB,"__esModule",{value:!0});DB();EB()});var As,Wp,Cu=n(()=>{sr();As=class extends he{};t(As,"Greek");Wp=As});var $j={};var FB=n(()=>{Cu();Ir();nr();Object.entries({people:"Greek",nation:"Greece",colors:["#2175D8","#FFF"]}).forEach(([i,e])=>ve.register(new Ae(Wp,i,e)))});var Zj={};var YB=n(()=>{Cu();ar();Ct();["Athens","Thessaloniki","Patras","Piraeus","Larissa","Heraklion","Peristeri","Kallithea","Acharnes","Kalamaria","Nikaia","Glyfada","Volos","Ilio","Ilioupoli","Keratsini","Evosmos","Chalandri","Nea Smyrni","Marousi","Agios Dimitrios","Zografou","Egaleo","Nea Ionia","Ioannina","Palaio Faliro","Korydallos","Trikala","Vyronas","Agia Paraskevi","Galatsi","Agrinio","Chalcis","Petroupoli","Serres","Alexandroupoli","Xanthi","Katerini","Kalamata","Kavala","Chania","Lamia","Komotini","Irakleio","Rhodes","Kifissia","Stavroupoli","Chaidari","Drama","Veria","Alimos","Kozani","Polichni","Karditsa","Sykies","Ampelokipoi","Pylaia","Agioi Anargyroi","Argyroupoli","Ano Liosia","Rethymno","Ptolemaida","Tripoli","Cholargos","Vrilissia","Aspropyrgos","Corinth","Gerakas","Metamorfosi","Giannitsa","Voula","Kamatero","Mytilene","Neapoli","Eleftherio-Kordelio","Chios","Agia Varvara","Kaisariani","Nea Filadelfeia","Moschato","Perama","Salamina","Eleusis","Corfu","Pyrgos","Megara","Kilkis","Dafni","Thebes","Melissia","Argos","Arta","Artemida","Livadeia","Pefki","Oraiokastro","Aigio","Kos","Koropi","Preveza","Naousa","Orestiada","Peraia","Edessa","Florina","Panorama","Nea Erythraia1","Elliniko1","Amaliada","Pallini","Sparta","Agios Ioannis Rentis","Thermi","Vari","Nea Makri","Tavros","Alexandreia","Menemeni","Paiania","Kalyvia Thorikou","Nafplio","Drapetsona","Efkarpia","Papagou","Nafpaktos","Kastoria","Grevena","Pefka","Nea Alikarnassos","Missolonghi","Gazi","Ierapetra","Kalymnos","Rafina","Loutraki","Agios Nikolaos","Ermoupoli","Ialysos","Mandra","Tyrnavos","Glyka Nera","Ymittos","Neo Psychiko"].forEach((i,e)=>oe.register(new me(i,Wp,e===0)))});var WB=w(NB=>{"use strict";Object.defineProperty(NB,"__esModule",{value:!0});FB();YB()});var Bs,Lp,Tu=n(()=>{sr();Bs=class extends he{};t(Bs,"Indian");Lp=Bs});var Qj={};var LB=n(()=>{Tu();Ir();nr();Object.entries({people:"Indian",nation:"India",colors:["#138808","#FF9933"]}).forEach(([i,e])=>ve.register(new Ae(Lp,i,e)))});var Xj={};var jB=n(()=>{Tu();ar();Ct();["Delhi","Mumbai","Bangalore","Hyderabad","Ahmedabad","Chennai","Kolkata","Surat","Pune","Jaipur","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivli","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Dhanbad","Amritsar","Navi Mumbai","Allahabad","Howrah","Ranchi","Gwalior","Jabalpur","Coimbatore","Vijayawada","Jodhpur","Madurai","Raipur","Kota","Chandigarh","Guwahati","Solapur","Hubli\u2013Dharwad","Tiruchirappalli","Bareilly","Moradabad","Mysore","Tiruppur","Gurgaon","Aligarh","Jalandhar","Bhubaneswar","Salem","Mira-Bhayandar","Warangal","Jalgaon","Guntur","Bhiwandi","Saharanpur","Gorakhpur","Bikaner","Amravati","Noida","Jamshedpur","Bhilai","Cuttack","Firozabad","Kochi","Nellore","Bhavnagar","Dehradun","Durgapur","Asansol","Rourkela","Nanded","Kolhapur","Ajmer","Akola","Gulbarga","Jamnagar","Ujjain","Loni","Siliguri","Jhansi","Ulhasnagar","Jammu","Sangli-Miraj & Kupwad","Mangalore","Erode","Belgaum","Ambattur","Tirunelveli","Malegaon","Gaya","Thiruvananthapuram","Udaipur","Maheshtala","Davanagere","Kozhikode","Kurnool","Rajpur Sonarpur","Rajahmundry","Bokaro","South Dumdum","Bellary","Patiala","Gopalpur","Agartala","Bhagalpur","Muzaffarnagar","Bhatpara","Panihati","Latur","Dhule","Tirupati","Rohtak","Korba","Bhilwara","Berhampur","Muzaffarpur","Ahmednagar","Mathura","Kollam","Avadi","Kadapa","Kamarhati","Sambalpur","Bilaspur","Shahjahanpur","Satara","Bijapur","Kakinada","Rampur","Shimoga","Chandrapur","Junagadh","Thrissur","Alwar","Bardhaman","Kulti","Nizamabad","Parbhani","Tumkur","Khammam","Ozhukarai","Bihar Sharif","Panipat","Darbhanga","Bally","Aizawl","Dewas","Ichalkaranji","Karnal","Bathinda","Jalna","Eluru","Barasat","Kirari Suleman Nagar","Purnia","Satna","Mau","Sonipat","Farrukhabad","Sagar","Durg","Imphal","Ratlam","Hapur","Arrah","Anantapur","Karimnagar","Etawah","Ambarnath","North Dumdum","Bharatpur","Begusarai","New Delhi","Gandhidham","Baranagar","Tiruvottiyur","Pondicherry","Sikar","Thoothukudi","Rewa","Mirzapur","Raichur","Pali","Ramagundam","Haridwar","Vijayanagaram","Katihar","Nagercoil","Sri Ganganagar","Karawal Nagar","Mango","Thanjavur","Bulandshahr","Uluberia","Katni","Sambhal","Singrauli","Nadiad","Secunderabad","Naihati","Yamunanagar","Bidhannagar","Pallavaram","Bidar","Munger","Panchkula","Burhanpur","Raurkela Industrial Township","Kharagpur","Dindigul","Gandhinagar","Hospet","Nangloi Jat","Malda","Ongole","Deoghar","Chapra","Haldia","Khandwa","Nandyal","Morena","Amroha","Anand","Bhind","Bhalswa Jahangir Pur","Madhyamgram","Bhiwani","Berhampore","Ambala","Morbi","Fatehpur","Raebareli","Mahaboobnagar","Chittoor","Bhusawal","Orai","Bahraich","Vellore","Mehsana","Raiganj","Sirsa","Danapur","Serampore","Sultan Pur Majra","Guna","Jaunpur","Panvel","Shivpuri","Surendranagar Dudhrej","Unnao","Chinsurah","Alappuzha","Kottayam","Machilipatnam","Shimla","Adoni","Udupi","Tenali","Proddatur","Saharsa","Hindupur","Sasaram","Hajipur","Bhimavaram","Kumbakonam","Dehri","Madanapalle","Siwan","Bettiah","Guntakal","Srikakulam","Motihari","Dharmavaram","Gudivada","Phagwara","Narasaraopet","Suryapet","Miryalaguda","Tadipatri","Karaikudi","Kishanganj","Jamalpur","Ballia","Kavali","Tadepalligudem","Amaravati","Buxar","Jehanabad","Gangtok"].forEach((i,e)=>oe.register(new me(i,Lp,e===0)))});var HB=w(zB=>{"use strict";Object.defineProperty(zB,"__esModule",{value:!0});LB();jB()});var Gs,jp,Pu=n(()=>{sr();Gs=class extends he{};t(Gs,"Mongol");jp=Gs});var ez={};var _B=n(()=>{Pu();Ir();nr();Object.entries({people:"Mongol",nation:"Mongolia",colors:["#DA2032","#0066B3"]}).forEach(([i,e])=>ve.register(new Ae(jp,i,e)))});var tz={};var KB=n(()=>{Pu();ar();Ct();["Ulaanbaatar","Erdenet","Darkhan","Choibalsan","M\xF6r\xF6n","Nalaikh","Bayankhongor","\xD6lgii","Khovd","Arvaikheer","Ulaangom","Baganuur","Sainshand","Tsetserleg","S\xFCkhbaatar","\xD6nd\xF6rkhaan","Dalanzadgad","Z\xFC\xFCnkharaa","Uliastai","Altai","Baruun-Urt","Mandalgovi","Zuunmod","Zamyn-\xDC\xFCd","Bulgan","Kharkhorin","Choir","Bor-\xD6nd\xF6r","Sharyngo"].forEach((i,e)=>oe.register(new me(i,jp,e===0)))});var VB=w(qB=>{"use strict";Object.defineProperty(qB,"__esModule",{value:!0});_B();KB()});var Ms,zp,Iu=n(()=>{sr();Ms=class extends he{};t(Ms,"Roman");zp=Ms});var rz={};var JB=n(()=>{Iu();Ir();nr();Object.entries({people:"Roman",nation:"Rome",colors:["#A20101","#D1B24F"]}).forEach(([i,e])=>ve.register(new Ae(zp,i,e)))});var iz={};var $B=n(()=>{Iu();ar();Ct();["Roma","Ariminum","Belum","Placentia","Tarraco","Italica","Mod","Salernum","Bononia","Forum Livii","Regium Lepidi","Aquileia","Ascrivium","Valentia Edetanorum","Scalabis","Villa Euracini","Palma","Colonia Narbo Martius","Massa","Pistoria","Segovia","Gerunda","Pompaelo","Naissus","Brigantium","Florentia","Vesontio","Lutetia Parisiorum","Atuatuca Tungrorum","Iulia Romula Hispalis","Augusta Raurica","Noviodunum","Lugdunum","Siscia","Marsonia","Augusta Treverorum","Castra Legionis","Augusta Taurinorum","Augusta Praetoria Salassorum","Emerita Augusta","Norba Caesarina","Lucus Augusta","Caesarea","Bracara Augusta","Novaesium","Castra Vetera","Pons Drusi","Ovilava","Iuvavum","Augusta Vindelicorum","Turicum","Asturica Augusta","Borbetomagus","Caesaraugusta","Sirmium","Sorviodurum","Mogontiacum","Argentoratum","Bonna","Noviomagus","Castellum apud Confluentes","Divodurum","Caesaromagus","Ambianum","Faventia Paterna Barcino","Abila","Lousonna","Ulpia Noviomagus Batavorum","Rigomagus","Aquae Mattiacorum","Mursa","Emona","Vindonissa","Aventicum","Praetorium Agrippinae","Lugdunum Batavorum","Aequum","Londinium","Albanianis","Lauri","Durovernum Cantiacorum","Regulbium","Rutupiae","Viminacium","Camulodunum","Traiectum","Matilo","Forum Hadriani","Nigrum Pullum","Lindum Colonia","Ratae Corieltauvorum","Durocobrivis","Colonia Agrippina","Durocornovium","Verulamium","Letocetum","Dubris","Danum","Mediolanum","Isca Dumnoniorum","Blestium","Viroconium Cornoviorum","Aquae Sulis","Durnovaria","Lindinis","Ad Flexum","Clausentum","Venta Belgarum","Calleva Atrebatum","Duroliponte","Concangis","Condate","Corinium Dobunnorum","Eboracum","Luguvalium","Arae Flaviae","Isca Augusta","Lagentium","Lopodunum","Moridunum","Venta Silurum","Deva Victrix","Mamucium","Olicana","Vinovia","Bonames","Coria","Gerulata","Vindobona","Biriciana","Cannstatt Castrum","Colonia Nervia Glevensium","Sumelocenna","Traiectum ad Nicrem","Castra Batavar","Nida","Lactodurum","Bovium","Burgodunum","Lentia","Aquae Granni","Complutum","Aeminium","Traiectum ad Mosam","Coriovallum","Portus Lemanis","Andautonia","Salona","Cibalae","Aquae Helveticae","Aquincum","Apulum","Pons Aelius","Durovigutum","Aelia Capitolina","Ala","Castra Regina","Theranda","Pomaria","Partiscum","Gesoriacum","Aurelia Aquensis","Urbs Aurelianorum","Venetiae","Ragusium"].forEach((i,e)=>oe.register(new me(i,zp,e===0)))});var QB=w(ZB=>{"use strict";Object.defineProperty(ZB,"__esModule",{value:!0});JB();$B()});var Us,bm,Hp=n(()=>{sr();Us=class extends he{};t(Us,"Russian");bm=Us});var oz={};var XB=n(()=>{Hp();Ir();nr();Object.entries({people:"Russian",nation:"Russia",colors:["#0032A0","#DA291C"]}).forEach(([i,e])=>ve.register(new Ae(bm,i,e)))});var nz={};var eG=n(()=>{Hp();ar();Ct();["Moscow","Saint Petersburg","Novosibirsk","Yekaterinburg","Nizhny Novgorod","Kazan","Chelyabinsk","Omsk","Samara","Ufa","Rostov-on-Don","Krasnoyarsk","Voronezh","Perm","Volgograd","Krasnodar","Saratov","Tyumen","Makhachkala","Tolyatti","Barnaul","Ulyanovsk","Izhevsk","Vladivostok","Irkutsk","Khabarovsk","Yaroslavl","Tomsk","Orenburg","Kemerovo","Novokuznetsk","Tula","Ryazan","Kirov","Astrakhan","Naberezhnye Chelny","Sochi","Penza","Lipetsk","Cheboksary","Balashikha","Kaliningrad","Kursk","Stavropol","Ulan-Ude","Bryansk","Tver","Magnitogorsk","Ivanovo","Belgorod","Surgut","Vladimir","Arkhangelsk","Nizhny Tagil","Kaluga","Chita","Saransk","Yakutsk","Smolensk","Podolsk","Volzhsky","Vladikavkaz","Vologda","Cherepovets","Kurgan","Oryol","Grozny","Murmansk","Tambov","Petrozavodsk","Sterlitamak","Kostroma","Nizhnevartovsk","Novorossiysk","Yoshkar-Ola","Taganrog","Komsomolsk-on-Amur","Khimki","Syktyvkar","Nalchik","Nizhnekamsk","Shakhty","Dzerzhinsk","Bratsk","Orsk","Angarsk","Engels","Blagoveshchensk","Stary Oskol","Veliky Novgorod","Korolyov","Pskov","Mytishchi","Biysk","Lyubertsy","Prokopyevsk","Yuzhno-Sakhalinsk","Balakovo","Armavir","Rybinsk","Severodvinsk","Abakan","Petropavlovsk-Kamchatsky","Norilsk","Syzran","Volgodonsk","Ussuriysk","Kamensk-Uralsky","Novocherkassk","Zlatoust","Elektrostal","Almetyevsk","Krasnogorsk","Salavat","Miass","Nakhodka","Kopeysk","Pyatigorsk","Rubtsovsk","Berezniki","Kolomna","Maykop","Odintsovo","Khasavyurt","Kovrov","Kislovodsk","Neftekamsk","Nefteyugansk","Novocheboksarsk","Serpukhov","Shchyolkovo","Novomoskovsk","Bataysk","Pervouralsk","Domodedovo","Derbent","Cherkessk","Orekhovo-Zuyevo","Nevinnomyssk","Dimitrovgrad","Nazran","Kyzyl","Oktyabrsky","Obninsk","Kaspiysk","Novy Urengoy","Ramenskoye","Kamyshin","Murom","Zhukovsky"].forEach((i,e)=>oe.register(new me(i,bm,e===0)))});var rG=w(tG=>{"use strict";Object.defineProperty(tG,"__esModule",{value:!0});XB();eG()});var Ds,_p,wu=n(()=>{sr();Ds=class extends he{};t(Ds,"Zulu");_p=Ds});var az={};var iG=n(()=>{wu();Ir();nr();Object.entries({people:"Zulu",nation:"Zulus",colors:["#FFFD1E","#000"]}).forEach(([i,e])=>ve.register(new Ae(_p,i,e)))});var sz={};var oG=n(()=>{wu();ar();Ct();["uMgungundlovu","Nobamba","Bulawayo","KwaDukuza","Nongoma","oNdini","Nodwengu","Ndondakusuka","Babanango","Khangela","Kwahlomendlini","Hlobane","eThekwini","Mlambongwenya","Eziqwaqweni","Isiphezi","Masotsheni","Mtunzini","Nyakamubi","Hlatikulu","Mthonjaneni","Empangeni","Pongola","Tungela","Kwamashu","Ingwavuma","Hluhluwe","Mtubatuba","Mhlahlandlela","Mthatha","Maseru","Lobamba","Qunu"].forEach((i,e)=>oe.register(new me(i,_p,e===0)))});var aG=w(nG=>{"use strict";Object.defineProperty(nG,"__esModule",{value:!0});iG();oG()});var lz={};var sG=n(()=>{E();_g();b.register(lu)});var mG=w(lG=>{"use strict";Object.defineProperty(lG,"__esModule",{value:!0});sG()});var mz={};var pG=n(()=>{E();lb();b.register(yw)});var uG=w(cG=>{"use strict";Object.defineProperty(cG,"__esModule",{value:!0});pG()});var pz={};var fG=n(()=>{E();mb();b.register(dw)});var dG=w(yG=>{"use strict";Object.defineProperty(yG,"__esModule",{value:!0});fG()});var cz={};var gG=n(()=>{E();pb();b.register(gw)});var xG=w(hG=>{"use strict";Object.defineProperty(hG,"__esModule",{value:!0});gG()});var uz={};var OG=n(()=>{E();Kg();b.register(mu)});var vG=w(RG=>{"use strict";Object.defineProperty(RG,"__esModule",{value:!0});OG()});var fz={};var bG=n(()=>{E();cb();b.register(hw)});var TG=w(CG=>{"use strict";Object.defineProperty(CG,"__esModule",{value:!0});bG()});var yz={};var PG=n(()=>{E();ub();b.register(xw)});var wG=w(IG=>{"use strict";Object.defineProperty(IG,"__esModule",{value:!0});PG()});var dz={};var AG=n(()=>{E();Vg();b.register(qg)});var GG=w(BG=>{"use strict";Object.defineProperty(BG,"__esModule",{value:!0});AG()});var gz={};var MG=n(()=>{E();fb();b.register(Ow)});var DG=w(UG=>{"use strict";Object.defineProperty(UG,"__esModule",{value:!0});MG()});var hz={};var EG=n(()=>{E();yb();b.register(Rw)});var SG=w(kG=>{"use strict";Object.defineProperty(kG,"__esModule",{value:!0});EG()});var xz={};var FG=n(()=>{E();Jg();b.register(pu)});var NG=w(YG=>{"use strict";Object.defineProperty(YG,"__esModule",{value:!0});FG()});var Oz={};var WG=n(()=>{E();db();b.register(vw)});var jG=w(LG=>{"use strict";Object.defineProperty(LG,"__esModule",{value:!0});WG()});var Rz={};var zG=n(()=>{E();$g();b.register(cu)});var _G=w(HG=>{"use strict";Object.defineProperty(HG,"__esModule",{value:!0});zG()});var vz={};var KG=n(()=>{E();gb();b.register(bw)});var VG=w(qG=>{"use strict";Object.defineProperty(qG,"__esModule",{value:!0});KG()});var bz={};var JG=n(()=>{E();hb();b.register(Cw)});var ZG=w($G=>{"use strict";Object.defineProperty($G,"__esModule",{value:!0});JG()});var Cz={};var QG=n(()=>{E();Zg();b.register(xm)});var eM=w(XG=>{"use strict";Object.defineProperty(XG,"__esModule",{value:!0});QG()});var Tz={};var tM=n(()=>{E();xb();b.register(Tw)});var iM=w(rM=>{"use strict";Object.defineProperty(rM,"__esModule",{value:!0});tM()});var Pz={};var oM=n(()=>{E();Ob();b.register(Pw)});var aM=w(nM=>{"use strict";Object.defineProperty(nM,"__esModule",{value:!0});oM()});var Iz={};var sM=n(()=>{E();Rb();b.register(Iw)});var mM=w(lM=>{"use strict";Object.defineProperty(lM,"__esModule",{value:!0});sM()});var wz={};var pM=n(()=>{E();vb();b.register(ww)});var uM=w(cM=>{"use strict";Object.defineProperty(cM,"__esModule",{value:!0});pM()});var Az={};var fM=n(()=>{E();bb();b.register(Aw)});var dM=w(yM=>{"use strict";Object.defineProperty(yM,"__esModule",{value:!0});fM()});var Bz={};var gM=n(()=>{E();Cb();b.register(Bw)});var xM=w(hM=>{"use strict";Object.defineProperty(hM,"__esModule",{value:!0});gM()});var Gz={};var OM=n(()=>{E();Tb();b.register(Gw)});var vM=w(RM=>{"use strict";Object.defineProperty(RM,"__esModule",{value:!0});OM()});var Mz={};var bM=n(()=>{E();Pb();b.register(Mw)});var TM=w(CM=>{"use strict";Object.defineProperty(CM,"__esModule",{value:!0});bM()});var Uz={};var PM=n(()=>{E();Ib();b.register(Uw)});var wM=w(IM=>{"use strict";Object.defineProperty(IM,"__esModule",{value:!0});PM()});var Dz={};var AM=n(()=>{E();Xg();b.register(Qg)});var GM=w(BM=>{"use strict";Object.defineProperty(BM,"__esModule",{value:!0});AM()});var Ez={};var MM=n(()=>{E();wb();b.register(Dw)});var DM=w(UM=>{"use strict";Object.defineProperty(UM,"__esModule",{value:!0});MM()});var kz={};var EM=n(()=>{E();Ab();b.register(Ew)});var SM=w(kM=>{"use strict";Object.defineProperty(kM,"__esModule",{value:!0});EM()});var Sz={};var FM=n(()=>{E();eh();b.register(Gp)});var NM=w(YM=>{"use strict";Object.defineProperty(YM,"__esModule",{value:!0});FM()});var Fz={};var WM=n(()=>{E();rh();b.register(th)});var jM=w(LM=>{"use strict";Object.defineProperty(LM,"__esModule",{value:!0});WM()});var Yz={};var zM=n(()=>{E();ih();b.register(uu)});var _M=w(HM=>{"use strict";Object.defineProperty(HM,"__esModule",{value:!0});zM()});var Nz={};var KM=n(()=>{E();Bb();b.register(kw)});var VM=w(qM=>{"use strict";Object.defineProperty(qM,"__esModule",{value:!0});KM()});var Wz={};var JM=n(()=>{E();nh();b.register(oh)});var ZM=w($M=>{"use strict";Object.defineProperty($M,"__esModule",{value:!0});JM()});var Lz={};var QM=n(()=>{E();sh();b.register(ah)});var eU=w(XM=>{"use strict";Object.defineProperty(XM,"__esModule",{value:!0});QM()});var jz={};var tU=n(()=>{E();Gb();b.register(Sw)});var iU=w(rU=>{"use strict";Object.defineProperty(rU,"__esModule",{value:!0});tU()});var zz={};var oU=n(()=>{E();lh();b.register(fu)});var aU=w(nU=>{"use strict";Object.defineProperty(nU,"__esModule",{value:!0});oU()});var Hz={};var sU=n(()=>{E();ph();b.register(mh)});var mU=w(lU=>{"use strict";Object.defineProperty(lU,"__esModule",{value:!0});sU()});var _z={};var pU=n(()=>{E();Mb();b.register(Fw)});var uU=w(cU=>{"use strict";Object.defineProperty(cU,"__esModule",{value:!0});pU()});var Kz={};var fU=n(()=>{E();uh();b.register(ch)});var dU=w(yU=>{"use strict";Object.defineProperty(yU,"__esModule",{value:!0});fU()});var qz={};var gU=n(()=>{E();yh();b.register(fh)});var xU=w(hU=>{"use strict";Object.defineProperty(hU,"__esModule",{value:!0});gU()});var Vz={};var OU=n(()=>{E();Ub();b.register(Yw)});var vU=w(RU=>{"use strict";Object.defineProperty(RU,"__esModule",{value:!0});OU()});var Jz={};var bU=n(()=>{E();dh();b.register(yu)});var TU=w(CU=>{"use strict";Object.defineProperty(CU,"__esModule",{value:!0});bU()});var $z={};var PU=n(()=>{E();Db();b.register(Nw)});var wU=w(IU=>{"use strict";Object.defineProperty(IU,"__esModule",{value:!0});PU()});var Zz={};var AU=n(()=>{E();Eb();b.register(Ww)});var GU=w(BU=>{"use strict";Object.defineProperty(BU,"__esModule",{value:!0});AU()});var Qz={};var MU=n(()=>{E();gh();b.register(du)});var DU=w(UU=>{"use strict";Object.defineProperty(UU,"__esModule",{value:!0});MU()});var Xz={};var EU=n(()=>{E();kb();b.register(Lw)});var SU=w(kU=>{"use strict";Object.defineProperty(kU,"__esModule",{value:!0});EU()});var eH={};var FU=n(()=>{E();Sb();b.register(jw)});var NU=w(YU=>{"use strict";Object.defineProperty(YU,"__esModule",{value:!0});FU()});var tH={};var WU=n(()=>{E();Fb();b.register(zw)});var jU=w(LU=>{"use strict";Object.defineProperty(LU,"__esModule",{value:!0});WU()});var rH={};var zU=n(()=>{E();Yb();b.register(Hw)});var _U=w(HU=>{"use strict";Object.defineProperty(HU,"__esModule",{value:!0});zU()});var iH={};var KU=n(()=>{E();hh();b.register(gu)});var VU=w(qU=>{"use strict";Object.defineProperty(qU,"__esModule",{value:!0});KU()});var oH={};var JU=n(()=>{E();Nb();b.register(_w)});var ZU=w($U=>{"use strict";Object.defineProperty($U,"__esModule",{value:!0});JU()});var nH={};var QU=n(()=>{E();Wb();b.register(Kw)});var eD=w(XU=>{"use strict";Object.defineProperty(XU,"__esModule",{value:!0});QU()});var aH={};var tD=n(()=>{E();Lb();b.register(qw)});var iD=w(rD=>{"use strict";Object.defineProperty(rD,"__esModule",{value:!0});tD()});var sH={};var oD=n(()=>{E();jb();b.register(Vw)});var aD=w(nD=>{"use strict";Object.defineProperty(nD,"__esModule",{value:!0});oD()});var lH={};var sD=n(()=>{E();zb();b.register(Jw)});var mD=w(lD=>{"use strict";Object.defineProperty(lD,"__esModule",{value:!0});sD()});var mH={};var pD=n(()=>{E();hu();b.register(xs)});var uD=w(cD=>{"use strict";Object.defineProperty(cD,"__esModule",{value:!0});pD()});var pH={};var fD=n(()=>{E();Oh();b.register(xh)});var dD=w(yD=>{"use strict";Object.defineProperty(yD,"__esModule",{value:!0});fD()});var cH={};var gD=n(()=>{E();vh();b.register(Rh)});var xD=w(hD=>{"use strict";Object.defineProperty(hD,"__esModule",{value:!0});gD()});var uH={};var OD=n(()=>{E();Ch();b.register(bh)});var vD=w(RD=>{"use strict";Object.defineProperty(RD,"__esModule",{value:!0});OD()});var fH={};var bD=n(()=>{E();Ph();b.register(Th)});var TD=w(CD=>{"use strict";Object.defineProperty(CD,"__esModule",{value:!0});bD()});var yH={};var PD=n(()=>{E();Hb();b.register($w)});var wD=w(ID=>{"use strict";Object.defineProperty(ID,"__esModule",{value:!0});PD()});var dH={};var AD=n(()=>{E();Kb();b.register(Qw)});var GD=w(BD=>{"use strict";Object.defineProperty(BD,"__esModule",{value:!0});AD()});var gH={};var MD=n(()=>{E();_b();b.register(Zw)});var DD=w(UD=>{"use strict";Object.defineProperty(UD,"__esModule",{value:!0});MD()});var hH={};var ED=n(()=>{E();wh();b.register(Ih)});var SD=w(kD=>{"use strict";Object.defineProperty(kD,"__esModule",{value:!0});ED()});var xH={};var FD=n(()=>{E();Bh();b.register(Ah)});var ND=w(YD=>{"use strict";Object.defineProperty(YD,"__esModule",{value:!0});FD()});var OH={};var WD=n(()=>{E();qb();b.register(Xw)});var jD=w(LD=>{"use strict";Object.defineProperty(LD,"__esModule",{value:!0});WD()});var RH={};var zD=n(()=>{E();Mh();b.register(Gh)});var _D=w(HD=>{"use strict";Object.defineProperty(HD,"__esModule",{value:!0});zD()});var vH,KD,qD=n(()=>{Tp();T();X();vH=t((i=I)=>[new to(new p((e,r)=>{i.emit("city:building-complete",e,r)}))],"getRules"),KD=vH});var bH,VD,JD=n(()=>{tt();Ke();Ci();wR();T();bH=t((i=V,e=_,r=Me)=>[new Sm(new p(o=>!r.tileIsWorked(o))),new Sm(new p((o,a)=>!e.getByTile(o).some(s=>s.player()!==a.player()))),new Sm(new p((o,a)=>{let s=i.getByTile(o);return s===null?!0:s===a}))],"getRules"),VD=bH});var CH,$D,ZD=n(()=>{tt();kt();Pa();Ke();X();Ql();T();Dl();wi();Ci();CH=t((i=V,e=_,r=re,o=Vt,a=I,s=ne,l=Me)=>[new Pr(new p(c=>o.getByCity(c).progress().set(0))),new Pr(new p(c=>r.getByCity(c).shrink())),new Pr(new p((c,u,y)=>{a.emit("city:captured",c,u,y)})),new Pr(new p(c=>e.getByCity(c).forEach(u=>u.destroy()))),new Pr(new p(c=>ag(c,s,r,l)))],"getRules"),$D=CH});var TH,QD,XD=n(()=>{Ba();oa();kt();zn();Ke();Lm();D();T();LR();Qo();jR();HR();TH=t((i=re,e=At,r=_)=>[new yt(new p(o=>new HT(i.getByCity(o).size()*2))),...[[Le,1,xo,fr],[Le,2,Yt,Ot,Rt,Gt]].map(([o,a,...s])=>new yt(new m(l=>r.getByCity(l).some(c=>c instanceof o)),new m(l=>e.getByPlayer(l.player()).is(...s)),new p(l=>r.getByCity(l).filter(c=>c instanceof o).map(c=>new _T(a,c))))),new yt(new m(o=>e.getByPlayer(o.player()).is(xo,fr)),new m(o=>{let a=i.getByCity(o);return r.getByCity(o).filter(s=>[xt,q,We,Zt].some(l=>s instanceof l)).length>a.size()}),new p(o=>{let a=i.getByCity(o);return r.getByCity(o).filter(s=>[xt,q,We,Zt].some(l=>s instanceof l)).slice(a.size()).map(s=>new zR(1,s))})),new yt(new m(o=>e.getByPlayer(o.player()).is(Yt,Ot,Rt,Gt)),new p(o=>r.getByCity(o).filter(a=>[xt,q,We,Zt].some(s=>a instanceof s)).map(a=>new zR(1,a))))],"getRules"),QD=TH});var Fh,Kp,Yh=n(()=>{U();Fh=class extends g{};t(Fh,"TileReassigned");Kp=Fh});var PH,eE,tE=n(()=>{cm();Pa();kt();tt();X();Ga();wi();M();Ii();Ci();Xc();Nf();If();D();T();Yh();Of();Dl();PH=t((i=He,e=Vt,r=re,o=V,a=ne,s=f,l=Do,c=I,u=Me)=>[...[Fe,qe].map(y=>new pn(new m(h=>i.getByTile(h.tile()).every(G=>!(G instanceof y))),new p(h=>i.register(new y(h.tile()))))),new pn(new p(y=>e.register(new Ml(y,l,s)))),new pn(new p(y=>r.register(new tm(y,s)))),new pn(new p(y=>o.register(y))),new pn(new p(y=>{c.emit("city:created",y)})),new pn(new p(y=>{let h=u.getByTile(y.tile());h!==null&&u.unregister(h),u.register(new ml(y.tile(),y)),h!==null&&s.process(Kp,h.city(),h.tile()),Ip(y,a,r,u)}))],"getRules"),eE=PH});var IH,rE,iE=n(()=>{tt();X();Ii();Ke();Xl();T();Ga();Ci();IH=t((i=He,e=V,r=I,o=_,a=Me)=>[new qr(new p(s=>i.getByTile(s.tile()).filter(l=>l instanceof Fe).forEach(l=>i.unregister(l)))),new qr(new p((s,l)=>{r.emit("city:destroyed",s,l)})),new qr(new p(s=>o.getByCity(s).forEach(l=>l.destroy()))),new qr(new p(s=>a.getByCity(s).forEach(l=>a.unregister(l))))],"getRules"),rE=IH});var Nh,Wh,bC=n(()=>{U();Nh=class extends g{};t(Nh,"FoodExhausted");Wh=Nh});var wH,oE,nE=n(()=>{T();bC();wH=t(()=>[new Wh(new p(i=>i.shrink()))],"getRules"),oE=wH});var AH,aE,sE=n(()=>{M();D();T();kR();bC();AH=t((i=f)=>[new Ic(new m(e=>e.progress().value()>=e.cost().value()),new p(e=>e.grow())),new Ic(new m(e=>e.progress().value()<0),new p(e=>{i.process(Wh,e)}))],"getRules"),aE=AH});var BH,lE,mE=n(()=>{kt();wi();D();T();Sf();Dl();Ci();BH=t((i=re,e=ne,r=Me)=>[new Ra(new p(o=>o.empty())),new Ra(new p(o=>o.cost().set((o.size()+1)*10,"city-grow"))),new Ra(new m(o=>o.city().tilesWorked().length<o.size()+1),new p(o=>MI(o.city(),e,i,r))),new Ra(new m(o=>o.city().tilesWorked().length>o.size()+1),new p(o=>sg(o.city(),o).forEach(a=>r.unregisterByTile(a))))],"getRules"),lE=BH});var GH,pE,cE=n(()=>{DR();T();GH=t(()=>[new Uf(new p(i=>10*(i.size()+1)))],"getRules"),pE=GH});var Lh,La,qp=n(()=>{U();Lh=class extends g{};t(Lh,"CivilDisorder");La=Lh});var jh,na,Vp=n(()=>{U();jh=class extends g{};t(jh,"ProcessYield");na=jh});var zh,Cm,Hh=n(()=>{U();zh=class extends g{};t(zh,"Unsupported");Cm=zh});var MH,uE,fE=n(()=>{Pa();kt();es();rs();M();Ke();qp();D();T();Vp();Hh();MH=t((i=Vt,e=re,r=_,o=f)=>[new na(new m(a=>a instanceof te),new p((a,s,l)=>{let c=e.getByCity(s),u=new Oa(a);l.forEach(y=>{if(!(y instanceof gl)||u.value()>=0)return;let h=y.unit();h!==null&&(o.process(Cm,s,h,y),u.subtract(y))}),c.add(u),c.check()})),new na(new m(a=>a instanceof Q),new p((a,s,l)=>{let c=i.getByCity(s),u=a.clone();l.filter(h=>h instanceof hl).sort((h,G)=>(G.unit()?.tile().distanceFrom(s.tile())??0)-(h.unit()?.tile().distanceFrom(s.tile())??0)).forEach(h=>{if(u.value()>=0)return;let G=h.unit();G!==null&&(o.process(Cm,s,G,h),u.subtract(h))});let y=s.yields();o.process(La,s,y).some(h=>h)||c.add(u),c.check()}))],"getRules"),uE=MH});var UH,yE,dE=n(()=>{kt();wi();D();T();SR();Dl();Ci();UH=t((i=re,e=ne,r=Me)=>[new Hm(new m(o=>o.size()>0),new p(o=>o.cost().set((o.size()+1)*10,"city-shrink"))),new Hm(new m(o=>o.size()>0),new m(o=>o.city().tilesWorked().length>o.size()+1),new p(o=>sg(o.city(),o).forEach(a=>r.unregisterByTile(a)))),new Hm(new m(o=>o.size()<=0),new p(o=>o.city().destroy()))],"getRules"),yE=UH});var DH,gE,hE=n(()=>{kt();wi();Ci();T();Yh();Dl();DH=t((i=ne,e=re,r=Me)=>[new Kp(new p(o=>Ip(o,i,e,r)))],"getRules"),gE=DH});var EH,xE,OE=n(()=>{T();UR();Pc();EH=t(()=>[new Cf(new p(i=>Nm.from(...i.tile().getSurroundingArea(2).filter((e,r)=>![0,4,20,24].includes(r)))))],"getRules"),xE=EH});var _h,Ge,Hr=n(()=>{ze();Re();_h=class extends W{constructor(){super(z)}getByCity(e,r=!1){return this.filter(o=>o.city()===e&&!o.destroyed())}};t(_h,"CityImprovementRegistry");Ge=new _h});var kH,RE,vE=n(()=>{oa();Hr();rs();zn();T();$a();Vb();sl();zm();ko();kH=t((i=Ge,e=At)=>[new cn(new Ja,new p((r,o)=>{let a=e.getByPlayer(r.player()),[s]=i.filter(y=>y instanceof vA&&r.player()===y.city().player()).map(y=>y.city()),l=Ve(o,ye),c=a.is(Yt)?10:a.is(Ot)?0:s?s.tile().distanceFrom(r.tile()):32,[u]=[[xo,8],[Yt,20],[Ot,0],[fr,12],[Rt,16],[Gt,24]].filter(([y])=>a.is(y)).map(([,y])=>y);return new fn(u?Math.min(Math.floor(l*c*3/(10*u)),l):0,c.toFixed(2))})),new cn(new bi(0),new p(r=>r.tilesWorked().entries().flatMap(o=>o.yields(r.player()).flatMap(a=>new a.constructor(a.value(),o.id()+": "+a.values().map(([,s])=>s).join("-"))))))],"getRules"),RE=kH});var SH,bE,CE=n(()=>{bR();Pa();tt();yn();D();T();SH=t((i=Vt,e=V)=>[new rt(new m(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).some(o=>!o.building())),new p(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).filter(o=>!o.building()).map(o=>new ya(r,o)))),new rt(new m(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).some(o=>!!o.building())),new p(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).filter(o=>!!o.building()).map(o=>new il(r,o))))],"getRules"),bE=SH});var FH,TE,PE=n(()=>{kt();tt();X();lm();D();Dc();T();FH=t((i=V,e=re,r=I)=>[new gn(new m((o,a,s)=>s instanceof Zi&&s.to()===o.tile()&&i.getByTile(s.to())!==null),new p(o=>{let a=i.getByTile(o.tile());e.getByCity(a).shrink()})),new gn(new p((o,a,s)=>r.emit("unit:defeated",o,a,s)))],"getRules"),TE=FH});var YH,IE,wE=n(()=>{M();Ci();D();T();st();Yh();YH=t((i=f,e=Me)=>[new K(new m(r=>r.moves().value()===0),new m((r,o)=>e.tileIsWorked(o.to())),new m((r,o)=>{let a=e.getByTile(o.to());return a.city().player()===r.player()?!1:!e.tileCanBeWorkedBy(a.tile(),a.city())}),new p((r,o)=>{let a=e.getByTile(o.to());e.unregister(a),i.process(Kp,a.city(),o.to())}))],"getRules"),IE=YH});var NH,AE,BE=n(()=>{T();Hh();NH=t(()=>[new Cm(new p((i,e)=>e.destroy()))],"getRules"),AE=NH});var WH={};var GE=n(()=>{qD();JD();ZD();XD();tE();iE();nE();sE();mE();cE();fE();dE();hE();OE();vE();M();CE();PE();wE();BE();f.register(...KD(),...VD(),...$D(),...QD(),...eE(),...rE(),...oE(),...aE(),...lE(),...pE(),...uE(),...yE(),...xE(),...gE(),...RE(),...bE(),...TE(),...IE(),...AE())});var UE=w(ME=>{"use strict";Object.defineProperty(ME,"__esModule",{value:!0});GE()});var Kh,qh,CC=n(()=>{Ac();dl();ko();Kh=t((i,e=i.city().yields())=>{let r=i.city(),o=new Array(i.size()).fill(1),[a,s]=ym(e,ey,va),l=o.length-1;for(;s>0&&l>-1;)o[l--]=0,s--;for(l=0;a>0&&l<o.length;)o[l]===0&&(o[l]=1,a--),o[l]===1&&(o[l++]=2,a--),o[l]===2&&l++;return o},"calculateCitizenState"),qh=t(i=>i.reduce(([e,r,o],a)=>[e+(a===0?1:0),r+(a===1?1:0),o+(a===2?1:0)],[0,0,0]),"citizenSummary")});var Vh,Jp,Jh=n(()=>{U();Vh=class extends g{};t(Vh,"CelebrateLeader");Jp=Vh});var LH,DE,EE=n(()=>{kt();CC();Jh();D();T();LH=t((i=re)=>[new Jp(new m(e=>i.getByCity(e).size()>2),new p((e,r=e.yields())=>{let o=i.getByCity(e),a=Kh(o,r),[s,,l]=qh(a);return s===0&&Math.floor(l)>=o.size()/2}))],"getRules"),DE=LH});var jH,kE,SE=n(()=>{kt();CC();qp();T();jH=t((i=re)=>[new La(new p((e,r=e.yields())=>{let o=i.getByCity(e),a=Kh(o,r),[s,,l]=qh(a);return s>l}))],"getRules"),kE=jH});var Tm,FE=n(()=>{dl();fl();Tm=class extends va{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t(Tm,"CityImprovementContent");Ti(Tm)});var $p,YE=n(()=>{Ac();$p=class extends ey{};t($p,"LuxuryHappiness")});var Pm,NE=n(()=>{dl();fl();Pm=class extends va{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(Pm,"MartialLaw");Ti(Pm)});var Es,WE=n(()=>{dl();Es=class extends va{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(Es,"MilitaryUnhappiness")});var Zp,LE=n(()=>{dl();Zp=class extends va{};t(Zp,"PopulationUnhappiness")});var $h=n(()=>{ty()});var Zh=n(()=>{FE();rs();Ac();Bc();YE();NE();WE();LE();es();$h();dl()});var Qh,hi,Xh=n(()=>{TR();Qh=class extends of{validate(...e){return!this.criteria().length||this.criteria().some(r=>r.validate(...e))}};t(Qh,"Or");hi=Qh});var zH,jE,zE=n(()=>{oa();Oo();kt();Zh();Hr();zn();Ye();M();Ke();Lm();D();T();Ba();Jl();$a();ti();Xh();ko();zH=t((i=f,e=re,r=Ge,o=At,a=L,s=_)=>[new yt(new m(l=>o.getByPlayer(l.player()).is(xo,Yt,fr,Rt)),new p((l,c)=>s.getByTile(l.tile()).filter(u=>u instanceof q).slice(0,Math.min(4,Ve(c,nt))).map(u=>new Pm(1,u)))),...[[Qt,1],[Qt,1,ur],[Yi,3],[Dr,4]].map(([l,c,...u])=>new yt(new ot,new m(y=>r.getByCity(y).some(h=>h instanceof l)),new hi(new m(y=>u.length===0),new m(y=>u.every(h=>a.getByPlayer(y.player()).completed(h)))),new m((y,h)=>Ve(h,nt)>0),new p((y,h)=>new Tm(Math.min(c,Ve(h,nt)),r.getByCity(y).filter(G=>G instanceof l)[0])))),new yt(new ga,new p((l,c)=>new $p(Math.floor(Ve(c,qi)/2),qi.name)))],"getRules"),jE=zH});var HH,HE,_E=n(()=>{Ba();kt();oa();Zh();zn();Ke();zm();D();T();HH=t((i=re,e=At,r=_)=>[new cn(new m(o=>i.getByCity(o).size()-5>0),new p(o=>new Zp(Math.max(i.getByCity(o).size()-5,0)))),...[[Gt,1],[Ot,2]].map(([o,a])=>new cn(new m(s=>{try{return e.getByPlayer(s.player()).is(o)}catch{return!1}}),new m(s=>r.getByCity(s).filter(l=>[xt,q,We].some(c=>l instanceof c)&&l.tile()!==s.tile()).length>0),new p(s=>r.getByCity(s).filter(l=>[xt,q,We].some(c=>l instanceof c)&&l.tile()!==s.tile()).map(l=>new Es(a,l)))))],"getRules"),HE=HH});var ex,KE,qE=n(()=>{fa();ex=class extends br{};t(ex,"CivilDisorder");KE=ex});var tx,ja,Au=n(()=>{U();tx=class extends g{};t(tx,"TurnStart");ja=tx});var Qp,Bu,_H,VE,TC=n(()=>{kt();tt();X();M();Jh();qp();T();$a();Au();Qp=new Set,Bu=new Set,_H=t((i=V,e=f,r=I,o=re)=>[new ja(new ot,new p(a=>i.getByPlayer(a).forEach(s=>{let l=e.process(La,s,s.yields()).some(u=>u),c=e.process(Jp,s,s.yields()).some(u=>u);l&&r.emit("city:civil-disorder",s),l&&!Qp.has(s)&&Qp.add(s),!l&&Qp.has(s)&&(r.emit("city:order-restored",s),Qp.delete(s)),c&&!Bu.has(s)&&(r.emit("city:leader-celebration",s),Bu.add(s)),!c&&Bu.has(s)&&(r.emit("city:leader-celebration-ended",s),Bu.delete(s))}))),new ja(new ot,new p(a=>i.getByPlayer(a).forEach(s=>{if(!Bu.has(s))return;o.getByCity(s).grow()})))],"getRules"),VE=_H});var KH,JE,$E=n(()=>{tt();yn();qE();T();TC();KH=t((i=V)=>[new rt(new p(e=>i.getByPlayer(e).filter(r=>Qp.has(r)).map(r=>new KE(e,r))))],"getRules"),JE=KH});var qH={};var ZE=n(()=>{EE();SE();zE();_E();M();$E();TC();f.register(...DE(),...HE(),...kE(),...jE(),...JE(),...VE())});var XE=w(QE=>{"use strict";Object.defineProperty(QE,"__esModule",{value:!0});ZE()});var VH={};var e0=n(()=>{Oo();cm();Do.register(Si,Ur,Fi,Dr,Vo,Yi,ri,yr,Ni,Nt,ii,oi,Er,Jo,Wt,Mt,Lt,$o,Zo,Qt,ni)});var JH,t0,r0=n(()=>{Oo();ti();bp();Hr();Ye();D();T();JH=t((i=Ge,e=L)=>[new gt(new p((r,o)=>new m(()=>!i.getByCity(r).some(a=>a instanceof o)))),...[[Si,Gi],[Vo,cr],[Yi,Gi],[ri,$r],[Ni,ea],[ii,ho],[Er,mo],[Mt,cr],[Qt,so],[Ur,ao],[Dr,Ft],[yr,Gr],[Nt,Bt],[Jo,ei],[oi,ra],[Wt,Ho],[Lt,yo],[$o,ta],[Zo,Ko],[ni,Mr]].map(([r,o])=>new gt(new m((a,s)=>s===r),new p(a=>new m(()=>e.getByPlayer(a.player()).completed(o))))),...[[Ur,Er],[ni,ii],[Nt,yr],[Wt,yr],[Lt,yr],[oi,Nt,Wt,Lt]].map(([r,...o])=>new gt(new m((a,s)=>s===r),new p(a=>new m(()=>i.getByCity(a).some(s=>o.some(l=>s instanceof l)))))),...[[ri,Mt],[Nt,Wt,Lt],[Wt,Lt,Nt],[Lt,Nt,Wt]].map(([r,...o])=>new gt(new m((a,s)=>s===r),new p(a=>new m(()=>i.getByCity(a).every(s=>!o.some(l=>s instanceof l))))))],"getRules"),t0=JH});var $H,i0,o0=n(()=>{Oo();Cp();$H=t(()=>[...[[Si,120],[Fi,40],[Vo,120],[Yi,100],[ri,80],[Ni,60],[ii,80],[Er,80],[Mt,200],[Qt,40],[Ur,120],[Dr,160],[yr,200],[Nt,240],[Jo,160],[oi,320],[Wt,160],[Lt,160],[$o,200],[Zo,200],[ni,160]].flatMap(([i,e])=>Gl(i,e))],"getRules"),i0=$H});var ZH,n0,a0=n(()=>{Hr();Ql();T();Oo();Se();ZH=t((i=Ge,e=()=>Math.random())=>[new Pr(new p(r=>{let o=i.getByCity(r).filter(s=>!(s instanceof Pe)),[a]=o.filter(s=>s instanceof Mt);for(a&&(a.destroy(),o.splice(o.indexOf(a),1));o.length>0&&e()>.7;){let s=o[Math.floor(e()*o.length)];if(!s)break;s.destroy(),o.splice(o.indexOf(s),1)}}))],"getRules"),n0=ZH});var Ce,PC=n(()=>{ts();fl();Ce=class extends Pi{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t(Ce,"CityImprovementMaintenanceGold");Ti(Ce)});var rx=n(()=>{rs();PC();Xf();Df();Bc();$h();Xa()});var QH,s0,l0=n(()=>{Oo();ti();Hr();Ye();rx();Lm();D();T();QH=t((i=Ge,e=L)=>[...[[Si,Ce,2],[Ur,Ce,3],[Dr,Ce,3],[Vo,Ce,2],[Yi,Ce,2],[ri,Ce,1],[yr,Ce,4],[Ni,Ce,1],[Nt,Ce,4],[ii,Ce,1],[oi,Ce,6],[Er,Ce,1],[Jo,Ce,4],[Wt,Ce,2],[Mt,Ce,0],[Lt,Ce,4],[$o,Ce,2],[Zo,Ce,4],[Qt,Ce,1],[ni,Ce,3]].map(([r,o,a])=>new yt(new m(s=>i.getByCity(s).some(l=>l instanceof r)),new p(s=>{let[l]=i.getByCity(s).filter(c=>c instanceof r);return new o(a,l)}))),...[[Fi,Ce,0,null,Br],[Fi,Ce,1,Br,pr],[Fi,Ce,2,pr,null]].map(([r,o,a,s,l])=>new yt(new m(c=>i.getByCity(c).some(u=>u instanceof r)),new m(c=>s===null||e.getByPlayer(c.player()).completed(s)),new m(c=>l===null||!e.getByPlayer(c.player()).completed(l)),new p(c=>{let[u]=i.getByCity(c).filter(y=>y instanceof r);return new o(a,u)})))],"getRules"),s0=QH});var XH,m0,p0=n(()=>{Hr();tt();M();If();D();T();Oo();XH=t((i=V,e=Ge,r=f)=>[new pn(new m(o=>i.getByPlayer(o.player()).length===0),new p(o=>e.register(new Mt(o,r))))],"getRules"),m0=XH});var e_,c0,u0=n(()=>{Hr();D();Xl();T();e_=t((i=Ge)=>[new qr(new m(e=>i.getByCity(e).length>0),new p(e=>i.getByCity(e).forEach(r=>r.destroy())))],"getRules"),c0=e_});var t_,f0,y0=n(()=>{Oo();Hr();D();T();rx();Sf();t_=t((i=Ge)=>[new Ra(new m(e=>!i.getByCity(e.city()).some(r=>r instanceof Si)),new m(e=>e.size()>10),new p(e=>e.shrink())),new Ra(new m(e=>i.getByCity(e.city()).some(r=>r instanceof Ni)),new p(e=>e.add(new Oa(e.cost().value()/2))))],"getRules"),f0=t_});var r_,d0,g0=n(()=>{Hr();X();FR();T();r_=t((i=Ge,e=I)=>[new wc(new p(r=>i.register(r))),new wc(new p((r,o)=>{e.emit("city-improvement:created",r,o)}))],"getRules"),d0=r_});var i_,h0,x0=n(()=>{Oo();Hr();rx();D();T();PR();Bf();ko();i_=t((i=Ge)=>[...[[Er,Qe,.5],[Er,qi,.5],[Ur,Qe,.5],[Ur,qi,.5],[ii,lr,.5],[ni,lr,.5],[yr,Q,.5],[Lt,Q,.5],[Nt,Q,.5],[Wt,Q,.5],[oi,Q,.5],[ri,fn,.5]].map(([e,r,o])=>new em(new kT,new m(a=>i.getByCity(a).some(s=>s instanceof e)),new p((a,s)=>new r(Math.floor(Ve(s,r)*o),e.name))))],"getRules"),h0=i_});var o_,O0,R0=n(()=>{Hr();ls();Oo();yy();D();T();su();o_=t((i=Ge,e=Ar)=>[new is(new m(r=>r.city()!==null),new m(r=>i.getByCity(r.city()).some(o=>o instanceof Fi)),new p(r=>e.register(new _n(r))))],"getRules"),O0=o_});var n_={};var v0=n(()=>{M();r0();o0();a0();l0();p0();u0();y0();g0();x0();R0();f.register(...t0(),...i0(),...n0(),...s0(),...m0(),...c0(),...f0(),...d0(),...h0(),...O0())});var C0=w(b0=>{"use strict";Object.defineProperty(b0,"__esModule",{value:!0});e0();v0()});var P0={};qu(P0,{default:()=>a_,registerCityNames:()=>T0});var T0,a_,I0=n(()=>{ar();Ct();T0=t((i=oe)=>{["Bergen","Cannae","Capua","Cordoba","Cremona","Crete","Cunaxa","Damascus","Dublin","Genoa","Ghent","Issus","Lisbon","Mecca","Melbourne","Milan","Naples","Pisa","Prague","Salamis","Salzburg","Seville","Sidon","Sydney","Tarsus","Toronto","Turin","Tyre","Utica","Venice","Verona"].forEach(e=>i.register(new me(e,null)))},"registerCityNames"),a_=T0});var IC=n(()=>{Up();xu();Ou();Ru();vu();Fp();bu();Np();Cu();Tu();Pu();Iu();Hp();wu()});var ix,ox,wC=n(()=>{Uo();sr();ix=class extends et{constructor(){super(he)}};t(ix,"CivilizationRegistry");ox=new ix});var A0={};qu(A0,{default:()=>s_,registerCivilizations:()=>w0});var w0,s_,B0=n(()=>{IC();wC();w0=t((i=ox)=>{i.register(Rs,vs,bs,Cs,Ts,Ps,Is,ws,As,Bs,Gs,Ms,Us,Ds)},"registerCivilizations"),s_=w0});var nx,Wl,Gu=n(()=>{je();nx=class extends j{#e;constructor(e,r){super(r),this.#e=e}leader(){return this.#e}};t(nx,"Trait");Wl=nx});var ax,Xp,sx=n(()=>{Re();Gu();ax=class extends W{constructor(){super(Wl)}getByLeader(e){return this.getBy("leader",e)}getBySubclass(e){return this.filter(r=>r instanceof e)}};t(ax,"TraitRegistry");Xp=new ax});var lx,ge,Ut=n(()=>{sx();J();lx=class extends S{#e=[];constructor(e=Xp){super();let r=e.getByLeader(this.sourceClass());this.#e.push(...r),this.addKey("name")}static civilization(){throw new TypeError("Must be implemented in extending class")}name(){throw new TypeError("Must be implemented in extending class")}traits(){return[...this.#e]}};t(lx,"Leader");ge=lx});var ks,G0=n(()=>{Ut();Up();ks=class extends ge{static civilization(){return Om}name(){return"Abraham Lincoln"}};t(ks,"AbrahamLincoln")});var M0=n(()=>{Ut();Up()});var U0=n(()=>{G0();M0()});var Ss,D0=n(()=>{Ut();xu();Ss=class extends ge{static civilization(){return Dp}name(){return"Moctezuma II"}};t(Ss,"MoctezumaII")});var E0=n(()=>{D0()});var Fs,k0=n(()=>{Ut();Ou();Fs=class extends ge{static civilization(){return Ep}name(){return"Hammurabi"}};t(Fs,"Hammurabi")});var S0=n(()=>{k0()});var Ys,F0=n(()=>{Ut();Ru();Ys=class extends ge{static civilization(){return kp}name(){return"Mao Zedong"}};t(Ys,"MaoZedong")});var Y0=n(()=>{F0()});var Ns,N0=n(()=>{Ut();vu();Ns=class extends ge{static civilization(){return Sp}name(){return"Ramesses II"}};t(Ns,"RamessesII")});var W0=n(()=>{N0()});var Ws,L0=n(()=>{Ut();Fp();Ws=class extends ge{static civilization(){return Rm}name(){return"Elizabeth I"}};t(Ws,"ElizabethI")});var j0=n(()=>{Ut();Fp()});var z0=n(()=>{L0();j0()});var Ls,H0=n(()=>{Ut();bu();Ls=class extends ge{static civilization(){return Yp}name(){return"Napoleon I"}};t(Ls,"NapoleonI")});var _0=n(()=>{H0()});var js,K0=n(()=>{Ut();Np();js=class extends ge{static civilization(){return vm}name(){return"Frederick the Great"}};t(js,"FrederickTheGreat")});var q0=n(()=>{Ut();Np()});var V0=n(()=>{K0();q0()});var zs,J0=n(()=>{Ut();Cu();zs=class extends ge{static civilization(){return Wp}name(){return"Alexander the Great"}};t(zs,"AlexanderTheGreat")});var $0=n(()=>{J0()});var Hs,Z0=n(()=>{Ut();Tu();Hs=class extends ge{static civilization(){return Lp}name(){return"Mahatma Gandhi"}};t(Hs,"MahatmaGandhi")});var Q0=n(()=>{Z0()});var _s,X0=n(()=>{Ut();Pu();_s=class extends ge{static civilization(){return jp}name(){return"Genghis Khan"}};t(_s,"GenghisKhan")});var ek=n(()=>{X0()});var Ks,tk=n(()=>{Ut();Iu();Ks=class extends ge{static civilization(){return zp}name(){return"Julius Caesar"}};t(Ks,"JuliusCaesar")});var rk=n(()=>{tk()});var ik=n(()=>{Ut();Hp()});var qs,ok=n(()=>{Ut();Hp();qs=class extends ge{static civilization(){return bm}name(){return"Joseph Stalin"}};t(qs,"JosephStalin")});var nk=n(()=>{ik();ok()});var Vs,ak=n(()=>{Ut();wu();Vs=class extends ge{static civilization(){return _p}name(){return"Shaka"}};t(Vs,"Shaka")});var sk=n(()=>{ak()});var AC=n(()=>{U0();E0();S0();Y0();W0();z0();_0();V0();$0();Q0();ek();rk();nk();sk()});var mx,px,BC=n(()=>{Uo();Ut();mx=class extends et{constructor(){super(ge)}getByCivilization(e){return this.getBy("civilization",e)}};t(mx,"LeaderRegistry");px=new mx});var mk={};qu(mk,{default:()=>l_,registerLeaders:()=>lk});var lk,l_,pk=n(()=>{AC();BC();lk=t((i=px)=>{i.register(ks,Ss,Fs,Ys,Ns,Ws,Ls,js,zs,Hs,_s,Ks,qs,Vs)},"registerLeaders"),l_=lk});var cx,ec,ux=n(()=>{Gu();cx=class extends Wl{};t(cx,"Aggression");ec=cx});var fx,tc,ck=n(()=>{ux();fx=class extends ec{constructor(e){super(e,1)}};t(fx,"Aggressive");tc=fx});var yx,rc,dx=n(()=>{Gu();yx=class extends Wl{};t(yx,"Militarism");rc=yx});var gx,Js,uk=n(()=>{dx();gx=class extends rc{constructor(e){super(e,0)}};t(gx,"Civilized");Js=gx});var hx,ic,xx=n(()=>{Gu();hx=class extends Wl{};t(hx,"Development");ic=hx});var Ox,oc,fk=n(()=>{xx();Ox=class extends ic{constructor(e){super(e,1)}};t(Ox,"Expansionist");oc=Ox});var Rx,vx,yk=n(()=>{ux();Rx=class extends ec{constructor(e){super(e,0)}};t(Rx,"Friendly");vx=Rx});var bx,Cx,dk=n(()=>{dx();bx=class extends rc{constructor(e){super(e,1)}};t(bx,"Militaristic");Cx=bx});var Tx,Im,gk=n(()=>{ux();Tx=class extends ec{constructor(e){super(e,.5)}};t(Tx,"Normal");Im=Tx});var Px,nc,hk=n(()=>{xx();Px=class extends ic{constructor(e){super(e,.5)}};t(Px,"Normal");nc=Px});var Ix,wx,xk=n(()=>{dx();Ix=class extends rc{constructor(e){super(e,.5)}};t(Ix,"Normal");wx=Ix});var Ax,Mu,Ok=n(()=>{xx();Ax=class extends ic{constructor(e){super(e,0)}};t(Ax,"Perfectionist");Mu=Ax});var vk={};qu(vk,{default:()=>m_,registerTraits:()=>Rk});var Rk,m_,bk=n(()=>{AC();sx();ck();uk();fk();yk();dk();gk();hk();xk();Ok();Rk=t((i=Xp)=>{[[ks,vx,nc,Js],[Ss,Im,Mu,Js],[Fs,vx,Mu,Js],[Ys,Im,nc,Js],[Ns,Im,nc,Js],[Ws,Im,oc,wx],[Ls,tc,oc,Js],[js,tc,Mu,Js],[zs,Im,oc,Cx],[Hs,vx,Mu,wx],[_s,tc,oc,Cx],[Ks,Im,oc,Js],[qs,tc,nc,Cx],[Vs,tc,nc,wx]].forEach(([e,...r])=>r.forEach(o=>i.register(new o(e))))},"registerTraits"),m_=Rk});var Tk=w(Ck=>{"use strict";Object.defineProperty(Ck,"__esModule",{value:!0});var p_=(I0(),v(P0)),c_=(B0(),v(A0)),u_=(pk(),v(mk)),f_=(bk(),v(vk));(0,p_.default)();(0,c_.default)();(0,u_.default)();(0,f_.default)()});var rr,$s,GC=n(()=>{kn();rr=class extends ct{};t(rr,"Fuel");$s=rr});var ir,Uu,MC=n(()=>{kn();ir=class extends ct{};t(ir,"Habitation");Uu=ir});var Bx,wm,Gx=n(()=>{U();Bx=class extends g{};t(Bx,"ChooseSlot");wm=Bx});var Mx,Am,UC=n(()=>{U();Mx=class extends g{};t(Mx,"Active");Am=Mx});var Pk,Ux,Dx,DC=n(()=>{J();M();Gx();UC();Pk=t((i,e,r)=>e<=i&&i<r,"isBetween"),Ux=class extends S{#e=new Map;#t;#r;#i=[];#o;constructor(e,r,o,a=f){super(),this.addKey("activeSlots","height","inactiveSlots","slots","width"),this.#t=e,this.#r=a,this.#o=r,this.#i.push(...o)}activeSlots(){return this.#i.filter(e=>this.#r.process(Am,e,this).every(r=>r))}get(e,r){if(e<0||e>=this.#o||r<0||r>=this.#t)return null;let o=[e,r].toString();if(!this.#e.has(o)){let[a]=this.#i.filter(s=>Pk(e,s.x(),s.x()+s.width())&&Pk(r,s.y(),s.y()+s.height()));this.#e.set(o,a??null)}return this.#e.get(o)}getAdjacent(e){let r=new Set;for(let o=e.x(),a=e.x()+e.width()-1;o<=a;o++){let s=this.get(o,e.y()-1),l=this.get(o,e.y()+e.height());s&&r.add(s),l&&r.add(l)}for(let o=e.y(),a=e.y()+e.height()-1;o<=a;o++){let s=this.get(e.x()-1,o),l=this.get(e.x()+e.width(),o);s&&r.add(s),l&&r.add(l)}return[...r.values()].filter(o=>o!==e)}getFreeSlot(e){let[r]=this.#r.process(wm,e,this);return r??null}height(){return this.#t}inactiveSlots(){return this.#i.filter(e=>this.#r.process(Am,e,this).some(r=>!r))}slots(){return this.#i}width(){return this.#o}};t(Ux,"Layout");Dx=Ux});var hr,Du,EC=n(()=>{kn();hr=class extends ct{};t(hr,"LifeSupport");Du=hr});var _r,Eu,kC=n(()=>{kn();_r=class extends ct{};t(_r,"Power");Eu=_r});var Ht,Zs,SC=n(()=>{kn();Ht=class extends ct{};t(Ht,"Propulsion");Zs=Ht});var Ex,F,Ik=n(()=>{J();Ex=class extends S{#e=[];#t;#r=null;#i;#o;#a;constructor(e,r,o,a,s){super(),this.addKey("height","part","width","x","y"),this.#t=o,this.#i=a,this.#o=e,this.#a=r,this.#e.push(...s)}accepts(e){return this.#e.some(r=>e instanceof r)}empty(){return this.#r===null}fill(e){!this.accepts(e)||(this.#r=e)}height(){return this.#t}part(){return this.#r}width(){return this.#i}x(){return this.#o}y(){return this.#a}};t(Ex,"Slot");F=Ex});var Dt,ce,FC=n(()=>{kn();Dt=class extends ct{};t(Dt,"Structural");ce=Dt});var kx,wk,Ak=n(()=>{M();GC();MC();DC();EC();kC();SC();Ik();FC();kx=class extends Dx{constructor(e=f){super(12,12,[new F(9,0,1,1,[$s]),new F(10,0,1,2,[Zs]),new F(1,1,2,2,[Eu]),new F(5,1,2,2,[Eu]),new F(8,1,1,1,[ce]),new F(9,1,1,1,[ce]),new F(10,1,1,1,[ce]),new F(8,2,1,1,[ce]),new F(9,2,1,1,[$s]),new F(10,2,1,2,[Zs]),new F(0,3,1,1,[ce]),new F(1,3,1,1,[ce]),new F(2,3,1,1,[ce]),new F(3,3,1,1,[ce]),new F(4,3,1,1,[ce]),new F(5,3,1,1,[ce]),new F(6,3,1,1,[ce]),new F(7,3,1,1,[ce]),new F(8,3,1,1,[ce]),new F(9,3,1,1,[$s]),new F(10,3,1,2,[Zs]),new F(0,4,2,2,[Du]),new F(2,4,2,2,[Uu]),new F(4,4,2,2,[Du]),new F(6,4,2,2,[Uu]),new F(8,4,1,1,[ce]),new F(9,4,1,1,[ce]),new F(10,4,1,1,[ce]),new F(8,5,1,1,[ce]),new F(9,5,1,1,[$s]),new F(10,5,1,2,[Zs]),new F(0,6,2,2,[Uu]),new F(2,6,2,2,[Du]),new F(4,6,2,2,[Uu]),new F(6,6,2,2,[Du]),new F(8,6,1,1,[ce]),new F(9,6,1,1,[$s]),new F(10,6,1,2,[Zs]),new F(8,7,1,1,[ce]),new F(9,7,1,1,[ce]),new F(10,7,1,1,[ce]),new F(0,8,1,1,[ce]),new F(1,8,1,1,[ce]),new F(2,8,1,1,[ce]),new F(3,8,1,1,[ce]),new F(4,8,1,1,[ce]),new F(5,8,1,1,[ce]),new F(6,8,1,1,[ce]),new F(7,8,1,1,[ce]),new F(8,8,1,1,[ce]),new F(9,8,1,1,[$s]),new F(10,8,1,2,[Zs]),new F(1,9,2,2,[Eu]),new F(5,9,2,2,[Eu]),new F(8,9,1,1,[ce]),new F(9,9,1,1,[$s]),new F(10,9,1,2,[Zs]),new F(8,10,1,1,[ce]),new F(9,10,1,1,[ce]),new F(10,10,1,1,[ce]),new F(9,11,1,1,[$s]),new F(10,11,1,2,[Zs])],e)}};t(kx,"Default");wk=kx});var Sx,ac,Fx=n(()=>{Uo();DC();Sx=class extends hI{constructor(){super(Dx)}};t(Sx,"LayoutRegistry");ac=new Sx});var y_={};var Bk=n(()=>{Ak();Fx();ac.register(wk)});var Mk=w(Gk=>{"use strict";Object.defineProperty(Gk,"__esModule",{value:!0});Bk()});var d_,Uk,Dk=n(()=>{us();T();Tv();d_=t((i=mr)=>[new Xy(new p(e=>i.register(e)))],"getRules"),Uk=d_});var Yx,aa,Ek=n(()=>{mm();Yx=class extends Mo{};t(Yx,"Acknowledge");aa=Yx});var Nx,za,YC=n(()=>{mm();Nx=class extends Mo{};t(Nx,"Decline");za=Nx});var Wx,Lx,kk=n(()=>{M();Qm();Wx=class extends Rl{#e;constructor(e,r,o,a=f){super(r,o,a),this.#e=e,this.addKey("tribute")}tribute(){return this.#e}};t(Wx,"DemandTribute");Lx=Wx});var jx,xr,Sk=n(()=>{Qm();M();jx=class extends Zm{#e;constructor(e,r,o,a=f){super(e,o,a),this.#e=r,this.addKey("key")}key(){return this.#e}};t(jx,"Dialogue");xr=jx});var zx,ku,NC=n(()=>{J();at();zx=class extends S{#e;#t;constructor(e,r=Z){super(),this.#e=e,this.#t=r,this.addKey("expired","expiry")}expired(){return this.#e<=this.#t.value()}expiry(){return this.#e}};t(zx,"Expiry");ku=zx});var Hx,_x,WC=n(()=>{NC();Hx=class extends ku{constructor(){super(1/0)}expired(){return!1}};t(Hx,"Never");_x=Hx});var Kx,LC,jC=n(()=>{Vm();at();NC();WC();Vr();M();Kx=class extends To{#e=new _x;#t=Z;constructor(...e){super(...e.filter(r=>r instanceof H||r instanceof YT)),this.addKey("expired","expiry"),e.forEach(r=>{r instanceof ku&&(this.#e=r),r instanceof xl&&(this.#t=r)})}active(){return!this.expiry().expired()}expire(){this.#e=new ku(this.#t.value())}expired(){return this.#e.expired()}expiry(){return this.#e}};t(Kx,"Declaration");LC=Kx});var Wi,Su,Fu=n(()=>{jC();Wi=class extends LC{};t(Wi,"Peace");Su=Wi});var g_,Fk,Yk=n(()=>{us();Ye();M();jg();Ek();D();YC();kk();Sk();T();Hg();ts();Gc();Dh();Fu();mm();my();td();g_=t((i=f,e=mr,r=L)=>{let o=t((R,...B)=>B.includes(R.key().split(".")[0]),"dialogueNamespaceMatches"),a=t(R=>new m(B=>!e.getByPlayers(...B.players()).some(N=>N instanceof R&&N.negotiation()===B)),"onlyOncePerNegotiation"),s=t(R=>new m(B=>B.lastInteraction()instanceof Mo&&B.lastInteraction().proposal()instanceof R),"lastInteractionWasResolutionForAction"),l=t((...R)=>new m(B=>B.lastInteraction()instanceof aa&&B.lastInteraction().proposal()instanceof xr&&o(B.lastInteraction().proposal(),...R)),"lastInteractionWasAcknowledgeForDialogueWithNamespace"),c=t(R=>R.lastInteraction()===null?R.players()[0]:R.lastInteraction().for()[0],"getNextBy"),u=t(R=>new p(B=>new R(c(B),B,i)),"proposalAction"),y=t(R=>new p(B=>new R(c(B),B.lastInteraction(),i)),"resolutionAction"),h=t((R,B)=>new p(N=>new R(c(N),B,N,i)),"dialogueAction"),G=t(R=>new m(B=>{let N=B.lastInteraction();return N instanceof xr&&o(N,R)}),"lastInteractionWasDialogueWithNamespace"),Y=t((...R)=>e.getByPlayers(...R).some(B=>B instanceof Su&&B.active()),"hasPeaceTreaty"),d={standardTopics:[[new m(R=>!R.interactions().some(B=>B instanceof za&&B.proposal()instanceof Ma)),new m(R=>{let[B,N]=R.players().map(Kt=>r.getByPlayer(Kt)),Ie=B.complete().filter(Kt=>!N.completed(Kt.sourceClass())),Rr=N.complete().filter(Kt=>!B.completed(Kt.sourceClass()));return Ie.length>0&&Rr.length>0}),new p(R=>{let B=R.lastInteraction(),[N,Ie]=B!==null?[B.by(),...B.for()]:R.players(),[Rr,Kt]=[N,Ie].map(Oe=>r.getByPlayer(Oe)),xe=Kt.complete().filter(Oe=>!Rr.completed(Oe.sourceClass()));return new Ma(xe,c(R),R,i)})],[a(Na),new m(R=>!Y(...R.players())),u(Na)],[h(xr,"handover")]]},O=[[y(Hn)],[y(za)]];return[...[[[null],[[u(Po)]]],[[Po],O],[[za,s(Po)],[[u(cs)]]],[[Hn,s(Po),new m(R=>!Y(...R.players()))],[[h(xr,"welcome.no-peace")]]],[[Hn,s(Po),new m(R=>Y(...R.players()))],[[h(xr,"welcome.peace")]]],[[xr,G("welcome")],[[y(aa)]]],[[Na],O],[[za,s(Na)],[[h(xr,"decline-peace.neutral")]]],[[Hn,s(Na)],[[h(xr,"accept-peace.neutral")]]],[[xr,G("decline-peace")],[[y(aa)]]],[[aa,l("decline-peace")],[[new p(R=>new cs(c(R),R,i))]]],[[aa,l("decline-demand")],[[new p(R=>new cs(c(R),R,i))]]],[[aa,new m(R=>R.lastInteraction()instanceof aa&&R.lastInteraction().proposal()instanceof xr&&!["decline-demand","decline-peace"].includes(R.lastInteraction().proposal().key()))],d.standardTopics],[[xr,G("accept-peace")],[[y(aa)]]],[[Lx],[[y(za)]]],[[za,s(Lx)],[[h(xr,"decline-demand.neutral")]]],[[xr,G("decline-demand")],[[y(aa)]]],[[xr,G("accept-demand")],[[y(aa)]]],[[Ma],O],[[za,s(Ma)],d.standardTopics],[[Hn,s(Ma)],d.standardTopics],[[xr,G("handover")],[[h(xr,"welcome-peace")],[new p(R=>new Lx(new Pi(50),c(R),R,i))]]]].flatMap(([[R,...B],N])=>N.map(([...Ie])=>new Jm(new m(Rr=>R===null?Rr.lastInteraction()===null:Rr.lastInteraction()instanceof R),...B,...Ie)))]},"getRules"),Fk=g_});var h_,Nk,Wk=n(()=>{Ta();M();us();Ye();jg();Tc();D();YC();T();Hg();Gc();WC();Dh();Fu();KR();td();h_=t((i=f,e=mr,r=L,o=qt)=>[new $m(new m((a,s)=>a instanceof za&&s instanceof Po),new p(async(a,s)=>s.negotiation().proceed(new cs(a.by(),s.negotiation(),i)))),new $m(new m((a,s)=>a instanceof Hn&&s instanceof Na),new p(async(a,s)=>e.register(new Su(...s.players(),new _x,i)))),new $m(new m((a,s)=>a instanceof Hn&&s instanceof Ma),new p(async(a,s)=>{let l=r.getByPlayer(a.by()),c=r.getByPlayer(a.for()[0]),u=l.complete().filter(O=>!c.completed(O.sourceClass())),y=c.complete().filter(O=>!l.completed(O.sourceClass())),h=o.getByPlayer(a.by()),G=await h.chooseFromList(new Dm(y.map(O=>O.sourceClass()),"diplomacy.exchange-knowledge",a)),Y=o.getByPlayer(a.for()[0]),d=await Y.chooseFromList(new Dm(u.map(O=>O.sourceClass()),"diplomacy.exchange-knowledge",a));l.addAdvance(G),c.addAdvance(d)}))],"getRules"),Nk=h_});var sc,Lk=n(()=>{Vm();sc=class extends JT{constructor(...e){let r=e.map(o=>o.player());super(...r)}};t(sc,"Contact")});var jk=n(()=>{Lk()});var x_,zk,Hk=n(()=>{us();Ke();jk();D();T();st();x_=t((i=mr,e=_)=>[new K(new m(r=>r.tile().getNeighbours().some(o=>e.getByTile(o).some(a=>a.player()!==r.player()))),new p(r=>r.tile().getNeighbours().forEach(o=>e.getByTile(o).filter(a=>a.player()!==r.player()).forEach(a=>i.register(new sc(r,a))))))],"getRules"),zk=x_});var O_={};var _k=n(()=>{M();Dk();Yk();Wk();Hk();f.register(...Uk(),...Fk(),...Nk(),...zk())});var qk=w(Kk=>{"use strict";Object.defineProperty(Kk,"__esModule",{value:!0});_k()});var qx,Vx,zC=n(()=>{qx=class{#e;#t;#r;constructor(e,r,o){this.#e=e,this.#t=r,this.#r=o}civilizationType(){return this.#e}mapGenerator(){return this.#t}startTile(){return this.#r}startTileForMap(e){let{x:r,y:o}=this.#r;return e.get(r,o)}};t(qx,"CivilizationStartTile");Vx=qx});var R_,sa,HC=n(()=>{R_=t((i,e,r,o)=>{for(;r<0;)r+=e;for(;o<0;)o+=i;return r=r%e,o=o%i,o*e+r},"coordsToIndex"),sa=R_});var v_,Bm,Jx=n(()=>{v_=t((i,e,r)=>{let o=i*e;for(;r<0;)r+=o;return r=r%o,[r%e,Math.floor(r/e)]},"indexToCoords"),Bm=v_});var b_,Vk,Jk=n(()=>{Jx();b_=t((i,e,r,o)=>{let[a,s]=Bm(i,e,r),[l,c]=Bm(i,e,o),u=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[y]=u.map(([h,G])=>[h*e,G*i]).map(([h,G])=>[a-l+h,s-c+G]).map(h=>Math.hypot(...h)).sort((h,G)=>h-G);return y},"distanceFrom"),Vk=b_});var C_,Gm,_C=n(()=>{HC();Jx();C_=t((i,e,r,o=!0)=>{let[a,s]=Bm(i,e,r),l=sa(i,e,a,s-1),c=sa(i,e,a+1,s-1),u=sa(i,e,a+1,s),y=sa(i,e,a+1,s),h=sa(i,e,a,s+1),G=sa(i,e,a-1,s+1),Y=sa(i,e,a-1,s),d=sa(i,e,a-1,s-1);return o?[l,u,h,Y]:[l,c,u,y,h,G,Y,d]},"getNeighbours"),Gm=C_});var lc,$x,Zx=n(()=>{HC();Jk();_C();Jx();lc=class{#e;#t;#r;constructor(e,r,o={}){this.#e=e,this.#t=o,this.#r=r}coordsToIndex(e,r){return sa(this.#e,this.#r,e,r)}distanceFrom(e,r){return Vk(this.#e,this.#r,e,r)}generate(){throw new Error(`Generator#generate(): Must be overridden in '${this.constructor.name}'.`)}getNeighbours(e,r=!0){return Gm(this.#e,this.#r,e,r)}height(){return this.#e}indexToCoords(e){return Bm(this.#e,this.#r,e)}options(){return this.#t}width(){return this.#r}};t(lc,"Generator");$x=lc});var T_,Qx,mc,Xx=n(()=>{zv();Hv();qy();Zx();lp();_v();Kv();qv();Vv();kc();ug();Jv();$v();T_={A:kI,D:SI,F:Ky,G:Il,H:FI,J:YI,M:NI,O:WI,P:ap,R:cg,S:LI,T:jI},Qx=class extends $x{async generate(){return Array.from(`OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOAAAAAAAOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOAAOAOAAAOAAAAAAAAOOOOOOAOOOOOGGOOOOOTAGOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOTTTTAOOOOAAAAAAAAOOOOAAAAAATOOOOOAAOOOOOOOOOOOOOOOAAOOOOOTOOOOOOOOOOOOOOOOOO
OOOTTTTTTTTTAAOAOAAAAAOOOAAAAATOOOOOOOOOOOOOOOAOOOOOFFAAFFFFFOOFFFOOOOFFFOOOOOOO
OTPTGPPPPTTTTTOTAAAOOAOOOAAAATOOOOOOOOOOOOOOOAOOAAOFFGAFFFFFFFAFFFFFFFFFFOTOOOOO
OOOOOPGTPTOOTTAAAAAAAAOOAAGGOOOOOOOOOOGAAOOOOOOGOGFFFGFFFFFFFFAFFAFFFFFGFGGOOOOO
OOOOOGGFGPPTTAAOOOAOTOOOAGOOOOAOOOOOOAFGFPGFOAAFGTGFFFFFFFFFFFFFFFGFFGOGFFOOOOOO
OOOOPMGFPPPPTTOOOATAAOOOOOOOOOOOOOOOGFPGGFOFFFFFFGFFFFFFFFFFFFFFGFFFFGOOFOOOOOOO
OOOOPMGFGPPOTTTAATTTTOOOOOOOOOOHOOOPFGOGGGFFFGFGGGFFFFFFFFFFFFFFFFFFOOOOFGOOOOOO
OOOOPHFFGPGOPPPOPTTTTOOOOOOOOOGROOOOOPOGFGFFGFFFGFGFGGFGGFFFGFFFFFFFGOOOOPOOOOOO
OOOOGGHFGPPPPPPPPPTPPOOOOOOOOOOFOOOFOOOFFFRFFFFRGFPFFPFGPFGFFOFFFFFGPPGOOOOOOOOO
OOOGGGMGGGPPPOPPPPPOPOOOOOOOOOGGOOOGPPFFFGRRFRRRGGFGGGGGPGGFFFFDPPPPPPOOOOOOOOOO
OOOGGFMGRGRPGORRGOPOOOOOOOOOOOOOOGRGGGGFFGFRFRPGPGGGGGPPPPPPPPPPPPPPGPGOOOOOOOOO
OOGGGMMGRGRGGGGOOOOOOOOOOOOOOOOOGGRMMGGGGPGRPRRPPPPPPPPPPPPPPPPPPPPPGPGOPGOOOOOO
OOGGPPHGRRRGGGOOOOOOOOOOOOOOOOOOPGGGGFGRRGPRPDOOPPOPPPDPDDDPPPPPPDPPPGOOGOOOOOOO
OOGFPPFGGRGGGPOOOOOOOOOOOOOOOOPPPPOGHOOGRFOOOHPOGPPDPDPDDPPPPPPDDPPOPGOOMGOOOOOO
OOGPPDDGGRGGOOOOOOOOOOOOOOOOOOPPPOOOGHOOOGPPPPPOPPPPDPPHPDDDDDDPPPGOOOOOOPOOOOOO
OOPOGDDPOOOPOOOOOOOOOOOOOOOOOOOOOOOOOGOOOOOPPPPGPPPPPPHHMHHHHHHHHMHPGOOGOOOOOOOO
OOPOGDDOOOOPOOOOOOOOOOOOOOOOOOGPPDDOOOOOOOOPPRRHPPPDPPHPGHMMMMMHHHPPPGOOOOOOOOOO
OOOOGDGOOOOOOOOOOOOOOOOOOOOOOODPHHPPPGODPOPPPGRRPPPPPHHRDPGMHHMHHPPRRROOOOOOOOOO
OOOOGGPOPOOOGPOOOOOOOOOOOOOOOPPHDDDPPPPDDRGDPPDOPPPPHPRRDGGGHHHHHPGPPPOOOOOOOOOO
OOOOOGGPGOOOOGPOOOOOOOOOOOOOPPDDDDDPDDDDDRDOPDDOOOOHHRRDPGGRGGGHGPGGPOOOOOOOOOOO
OOOOOOOOGGOOOOOOOOOOOOOOOOOOPDDDDDDDDDDDSRSODDDDDDOOOOPPGGGRRPPGFGGGOOOGOOOOOOOO
OOOOOOOOOGOOOOOOOOOOOOOOOOOPDDDDDDPPPDDDDRDOOPDDDDPOOOOGGGGGOOGGGGGOOOOPGOOOOOOO
OOOOOOOOOPPOGPPGOOOOOOOOOOODDDDDDDPDDDDDDRDDOODDDDOOOOOOGGGOOOPPGGOOOOOGGOOOOOOO
OOOOOOOOOOPGFPPPGOOOOOOOOOODDDDDDDDPDPDPPDHHDOOPDOOOOOOOGGOOOOOGGGGOOOOOFGOOOOOO
OOOOOOOOOOOGHGGGGGGOOOOOOOOPPDPPPPDDDPPPPPPMDPOOGOOOOOOOPGOOOOOOOGGOOOOOOGOOOOOO
OOOOOOOOOOOHJJJGGGGROOOOOOOOPPDPPPPPPPPPPPPHMDPOOOOOOOOOOGOOOOOOOOOOOPOOOOOOOOOO
OOOOOOOOOOGHJRRJJRRRGOOOOOOOOPPPGOPPGPGGGGGGMDDPOOOOOOOOOOOOOOOOOOOGPPOOGPOOOOOO
OOOOOOOOOOPGJJRRRRJGFGGOOOOOOOOOOOOGGGGJJJGGODPPOOOOOOOOOOOOOOOGFGOOPGFGGGOGOOOO
OOOOOOOOOOOFGGJJGJJFGGGPOOOOOOOOOOOGGJJRRRGGHPPOOOOOOOOOOOOOOOOOGFOOGOPGOOOPGGOO
OOOOOOOOOOOGHGGGGGGGGGGOOOOOOOOOOOOGGRRRJJHOGGOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOGGO
OOOOOOOOOOOOGMFGGGGGGPOOOOOOOOOOOOOOGRJJJGHMGOOOOOOOOOOOOOOOOOOOOPPOOOOOGOOOOOOO
OOOOOOOOOOOOGFMGGFGPPPOOOOOOOOOOOOOORRGGGGGMPOOOOOOOOOOOOOOOOOOOOOGOOOOOOOPGOOOO
OOOOOOOOOOOOOOHMGGRPGGOOOOOOOOOOOOOOOGGGGGGHGOOOOOOOOOOOOOOOOOOOOOOOOOOGGPGPGGOO
OOOOOOOOOOOOOOGHGGRGGOOOOOOOOOOOOOOOODPPGGGGGGOOOOOOOOOOOOOOOOOOOOOOOOOGGPPPPGOO
OOOOOOOOOOOOOOGMGPRROOOOOOOOOOOOOOOOPPPPPPPGGGOPOOOOOOOOOOOOOOOOOOOOGGPPPDDDPPPO
OOOOOOOOOOOOOOGMGGGPOOOOOOOOOOOOOOOOHPDDPPGGOOOPOOOOOOOOOOOOOOOOOOOGGGPDDDDDDPFO
OOOOOOOOOOOOOOPMGGGOOOOOOOOOOOOOOOOOOPPDPPGGOOOGOOOOOOOOOOOOOOOOOOOGPDDDDDDDDPPO
OOOOOOOOOOOOOOOMGPOOOOOOOOOOOOOOOOOOOHPPPGGGOOGPOOOOOOOOOOOOOOOOOOOGDDDDDPDDDPGO
OOOOOOOOOOOOOOOGGOOOOOOOOOOOOOOOOOOOOHPPGHGOOOPOOOOOOOOOOOOOOOOOOOODDDDDDDPDDHFO
OOOOOOOOOOOOOOOPGOOOOOOOOOOOOOOOOOOOOODPGHGOOOOOOOOOOOOOOOOOOOOOOOODDDOOGDDDHGOO
OOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOPGGGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOGHHHGOOO
OOOOOOOOOOOOOOOOFOOOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOPGOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
`.replace(/\n/g,"")).map(e=>new T_[e])}height(){return 50}width(){return 80}};t(Qx,"Earth");mc=Qx});var eO,$k,Zk=n(()=>{zC();Xx();eO=class extends Vx{constructor(e,r){super(e,mc,r)}};t(eO,"EarthStartTile");$k=eO});var Yu,aYe,Qk,Xk=n(()=>{zC();Re();Yu=class extends rl{constructor(){super(Vx)}getByCivilization(e){let[r]=this.getBy("civilizationType",e);if(!r)throw new TypeError(`${e.name} does not have a registered start tile.`);return r}getStartTileByCivilizationAndWorld(e,r){return this.getByCivilization(e).startTileForMap(r)}};t(Yu,"CivilizationStartTileRegistry");aYe=new Yu,Qk=Yu});var tO,rO,KC=n(()=>{Xk();Xx();tO=class extends Qk{entries(){return super.entries().filter(e=>e.mapGenerator()===mc)}};t(tO,"EarthStartTileRegistry");rO=new tO});var P_={};var eS=n(()=>{IC();Zk();KC();rO.register(...[[Rs,{x:12,y:18}],[vs,{x:5,y:23}],[bs,{x:45,y:22}],[Cs,{x:66,y:19}],[Ts,{x:41,y:24}],[Ps,{x:31,y:14}],[Is,{x:33,y:16}],[ws,{x:38,y:15}],[As,{x:39,y:18}],[Bs,{x:57,y:26}],[Gs,{x:49,y:19}],[Ms,{x:36,y:19}],[Us,{x:44,y:12}],[Ds,{x:42,y:42}]].map(([i,e])=>new $k(i,e)))});var rS=w(tS=>{"use strict";Object.defineProperty(tS,"__esModule",{value:!0});eS()});var I_,iS,oS=n(()=>{D();T();Nv();I_=t(()=>[new Ul(new m(i=>i<252),new p(i=>i*20-4020)),new Ul(new m(i=>i>251),new m(i=>i<302),new p(i=>(i-151)*10+1e3)),new Ul(new m(i=>i>301),new m(i=>i<352),new p(i=>(i-201)*5+1500)),new Ul(new m(i=>i>351),new m(i=>i<402),new p(i=>(i-251)*2+1750)),new Ul(new m(i=>i>401),new p(i=>i-301+1850))],"getRules"),iS=I_});var w_={};var nS=n(()=>{M();oS();f.register(...iS())});var sS=w(aS=>{"use strict";Object.defineProperty(aS,"__esModule",{value:!0});nS()});var pc,cc,Nu=n(()=>{pc=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}goodyHut(){return this.#e}perform(){}unit(){return this.#t}};t(pc,"Action");cc=pc});var uc,lS=n(()=>{Ye();Nu();uc=class extends cc{#e;#t;constructor(e,r,o=L,a=()=>Math.random()){super(e,r),this.#e=o,this.#t=a}perform(){let e=this.#e.getByPlayer(this.unit().player()),r=e.available(),o=r[Math.floor(r.length*this.#t())];e.addAdvance(o)}};t(uc,"Advance")});var fc,mS=n(()=>{tt();M();Nu();xa();fc=class extends cc{#e;constructor(e,r,o=V){super(e,r),this.#e=o}perform(e=f){let r=this.unit().player(),o=new Ze(r,this.goodyHut().tile(),r.civilization().getCityName(!0),e);this.#e.register(o)}};t(fc,"City")});var yc,pS=n(()=>{fm();Nu();ts();yc=class extends cc{#e;constructor(e,r,o=ro){super(e,r),this.#e=o}perform(){this.#e.getByPlayerAndType(this.unit().player(),Pi).add(new Pi(50))}};t(yc,"Gold")});var iO,oO,qC=n(()=>{U();iO=class extends g{};t(iO,"Unit");oO=iO});var dc,cS=n(()=>{Nu();M();qC();dc=class extends pc{#e;#t;constructor(e,r,o=()=>Math.random(),a=f){super(e,r),this.#e=o,this.#t=a}perform(){this.#t.process(oO,this.goodyHut(),this.unit())}};t(dc,"Unit")});var uS=n(()=>{lS();mS();pS();cS()});var A_,fS,yS=n(()=>{uS();tt();Fo();Ye();Xv();D();T();im();Km();Xa();A_=t((i=L,e=V)=>[new hm(new m((r,o)=>i.getByPlayer(o.player()).available().length>0),new p((r,o)=>new uc(r,o))),new hm(new m(r=>[Te,de,pe].some(o=>r.tile().terrain()instanceof o)),new m((r,o)=>r.tile().getSurroundingArea().score(null,[[un,8],[Za,3],[Qa,1]])>=150),new m(r=>r.tile().getSurroundingArea(4).every(o=>e.getByTile(o)===null)),new p((r,o)=>new fc(r,o))),new hm(new p((r,o)=>new yc(r,o))),new hm(new p((r,o)=>new dc(r,o)))],"getRules"),fS=A_});var B_,dS,gS=n(()=>{X();eb();T();B_=t((i=I)=>[new Pg(new p((e,r)=>{i.emit("goody-hut:action-performed",e,r)}))],"getRules"),dS=B_});var G_,hS,xS=n(()=>{X();Fl();tb();T();G_=t((i=Ai,e=I,r=()=>Math.random())=>[new Ap(new p(o=>i.unregister(o))),new Ap(new p((o,a)=>{let s=o.actions(a),l=s[Math.floor(s.length*r())];o.action(l)})),new Ap(new p((o,a)=>{e.emit("goody-hut:discovered",o,a)}))],"getRules"),hS=G_});var nO,gc,VC=n(()=>{U();nO=class extends g{};t(nO,"Distribution");gc=nO});var M_,OS,RS=n(()=>{Fl();D();VC();M_=t((i=Ai,e=()=>Math.random())=>[new gc(new m(r=>r.isLand())),new gc(new m(r=>r.getSurroundingArea(3).every(o=>i.getByTile(o)===null))),new gc(new m(()=>e()<.05))],"getRules"),OS=M_});var U_,vS,bS=n(()=>{Fl();Qo();M();T();qC();U_=t((i=Ai,e=()=>Math.random(),r=f)=>[new oO(new p((o,a)=>{let s=[Xt,er],l=s[Math.floor(s.length*e())];return new l(null,a.player(),a.tile(),r)}))],"getRules"),vS=U_});var D_,CS,TS=n(()=>{Fl();D();T();st();D_=t((i=Ai)=>[new K(new m(e=>i.getByTile(e.tile())!==null),new p(e=>{i.getByTile(e.tile()).process(e)}))],"getRules"),CS=D_});var aO,Ll,sO=n(()=>{U();aO=class extends g{};t(aO,"Built");Ll=aO});var E_,PS,IS=n(()=>{Fl();M();sO();T();rb();VC();E_=t((i=Ai,e=f)=>[new Ll(new p(r=>{let o=e.get(gc);r.forEach(a=>{o.every(s=>s.validate(a))&&i.register(new Ag(a))})}))],"getRules"),PS=E_});var k_={};var wS=n(()=>{yS();gS();xS();RS();bS();M();TS();IS();f.register(...fS(),...dS(),...hS(),...OS(),...vS(),...CS(),...PS())});var BS=w(AS=>{"use strict";Object.defineProperty(AS,"__esModule",{value:!0});wS()});var S_={};var GS=n(()=>{oa();kg();Bp.register(Yt,Ot,fr,Rt,Gt)});var F_,MS,US=n(()=>{zn();oa();D();T();Gv();yn();F_=t((i=At)=>[new rt(new m(e=>!i.getByPlayer(e).is(xo)),new p(e=>[new wl(e,i.getByPlayer(e))]))],"getRules"),MS=F_});var Y_,DS,ES=n(()=>{kg();zn();M();om();oa();T();Jl();ab();Y_=t((i=Bp,e=At,r=f)=>[new Vi(new ga,new p(o=>{let a=new Ng(o,i,r);a.set(new fr),e.register(a)}))],"getRules"),DS=Y_});var N_,kS,SS=n(()=>{ti();oa();Ye();ob();D();N_=t((i=L)=>[new nu(new m(e=>e===fr)),...[[Yt,St],[Ot,jo],[Rt,Ui],[Gt,go]].map(([e,r])=>new nu(new m(o=>o===e),new m((o,a)=>i.getByPlayer(a).completed(r))))],"getRules"),kS=N_});var W_,FS,YS=n(()=>{X();wi();nb();D();T();W_=t((i=I,e=ne)=>[new au(new p((r,o)=>{i.emit("player:government:changed",r,o)})),new au(new m(r=>{try{return e.getByPlayer(r),!0}catch(o){if(o instanceof TypeError&&o.message.match(/Wrong number of player worlds exist/))return!1;throw o}}),new p(r=>{e.getByPlayer(r).entries().forEach(a=>a.tile().clearYieldCache(r))}))],"getRules"),FS=W_});var L_={};var NS=n(()=>{M();US();ES();SS();YS();f.register(...MS(),...DS(),...kS(),...FS())});var LS=w(WS=>{"use strict";Object.defineProperty(WS,"__esModule",{value:!0});GS();NS()});var lO,jS,zS=n(()=>{U();lO=class extends g{};t(lO,"TurnEnd");jS=lO});var j_,HS,_S=n(()=>{Op();X();M();zS();j_=t((i=Sn,e=f,r=I)=>[["player:turn-end",o=>{i.unregister(o),e.process(jS,o);let[a]=i.entries();if(!a){r.emit("turn:end");return}r.emit("player:turn-start",a)}]],"getEvents"),HS=j_});var z_,KS,qS=n(()=>{Ta();X();M();Au();z_=t((i=qt,e=I,r=f)=>[["player:turn-start",o=>{r.process(ja,o),i.getByPlayer(o).takeTurn().catch(s=>console.error(s)).finally(()=>{e.emit("player:turn-end",o)})}]],"getEvents"),KS=z_});var H_,VS,JS=n(()=>{Op();X();Al();H_=t((i=eo,e=Sn,r=I)=>[["turn:start",()=>{e.register(...i.entries());let[o]=e.entries();r.emit("player:turn-start",o)}]],"getEvents"),VS=H_});var __={};var $S=n(()=>{X();_S();qS();JS();[...HS(),...KS(),...VS()].forEach(([i,e])=>I.on(i,e))});var mO,Ha,Wu=n(()=>{U();mO=class extends g{};t(mO,"Defeated");Ha=mO});var K_,ZS,QS=n(()=>{tt();M();Ql();D();Wu();T();K_=t((i=V,e=f)=>[new Pr(new m((r,o,a)=>i.getByPlayer(a).filter(s=>s!==r).length===0),new p((r,o,a)=>{e.process(Ha,a,o)}))],"getRules"),ZS=K_});var q_,XS,eF=n(()=>{tt();M();D();Wu();Xl();T();q_=t((i=V,e=f)=>[new qr(new m((r,o)=>i.getByPlayer(r.player()).filter(a=>a!==r).length===0),new p((r,o)=>e.process(Ha,r.player(),o)))],"getRules"),XS=q_});var JC,V_,tF,rF=n(()=>{yn();D();T();Jf();sl();JC=new rt(new bi(9001),new m(i=>{JC.disable();let e=i.mandatoryActions();return JC.enable(),e.length===0}),new p(i=>[new Vf(i,null)])),V_=t(()=>[JC],"getRules"),tF=V_});var J_,iF,oF=n(()=>{X();om();T();J_=t((i=I)=>[new Vi(new p(e=>{i.emit("player:added",e)}))],"getRules"),iF=J_});var $_,nF,aF=n(()=>{Op();X();Al();D();Wu();T();$_=t((i=Sn,e=eo,r=I)=>[new Ha(new m(o=>i.includes(o)),new p(o=>i.unregister(o))),new Ha(new m(o=>e.includes(o)),new p(o=>e.unregister(o))),new Ha(new p((o,a)=>{r.emit("player:defeated",o,a)}))],"getRules"),nF=$_});var pO,cO,$C=n(()=>{U();pO=class extends g{};t(pO,"Spawn");cO=pO});var Z_,sF,lF=n(()=>{M();T();kh();$C();Z_=t((i=f)=>[new cO(new p((e,r)=>{new VA(null,e,r,i)}))],"getRules"),sF=Z_});var Q_,mF,pF=n(()=>{tt();M();Ke();T();im();Jl();Vp();Km();Xa();Au();ko();Q_=t((i=f,e=V,r=_)=>[new ja(new ga,new p(o=>{e.getByPlayer(o).forEach(a=>{let s=a.yields();ym(s,un,Za,Qa).reduce((l,c,u)=>(l[u].set(c,"Consolidated"),l),[new un(0,"Consolidated"),new Za(0,"Consolidated"),new Qa(0,"Consolidated")]).forEach(l=>i.process(na,l,a,s))})})),new ja(new p(o=>r.getByPlayer(o).forEach(a=>{if(a.destroyed())return;a.moves().set(a.movement());let s=a.busy();if(!s){a.setActive(),a.setWaiting(!1);return}!s.validate()||s.process()})))],"getRules"),mF=Q_});var X_,cF,uF=n(()=>{X();T();Bv();X_=t((i=I)=>[new fd(new p((e,r)=>{i.emit("player:visibility-changed",e,r)}))],"getRules"),cF=X_});var eK,fF,yF=n(()=>{Al();wi();Py();T();eK=t((i=eo,e=ne)=>[new ns(new p(r=>{r.clearYieldCache(null),i.forEach(o=>{e.getByPlayer(o).getByTile(r)!==null&&r.clearYieldCache(o)})}))],"getRules"),fF=eK});var tK,dF,gF=n(()=>{tt();M();D();Wu();Mc();T();tK=t((i=V,e=f)=>[new dn(new m((r,o)=>i.getByPlayer(r.player()).length===0),new p((r,o)=>e.process(Ha,r.player(),o)))],"getRules"),dF=tK});var rK,hF,xF=n(()=>{wi();T();QR();rK=t((i=ne)=>[new hy(new p((e,r)=>{e.clearYieldCache(r);let o=i.getByPlayer(r);o.register(e),o.getByTile(e).update()}))],"getRules"),hF=rK});var uO,fO,ZC=n(()=>{U();uO=class extends g{};t(uO,"PickStartTile");fO=uO});var iK,OF,RF=n(()=>{nr();Ct();wC();Ta();X();BC();Al();wi();M();sx();sO();Tc();T();im();lp();ZC();kc();dd();Km();ug();$C();Xa();iK=t((i=ox,e=qt,r=I,o=eo,a=ne,s=f,l=px,c=ve,u=oe,y=Xp)=>[new Ll(new p(h=>o.entries().forEach(G=>a.register(new up(G,h))))),new Ll(new p(h=>{let G=new Map,Y=new Map,d=t((B,N=null)=>(G.has(B)||G.set(B,B.score(N,[[un,8],[Za,3],[Qa,1]])),G.get(B)),"tileScore"),O=t((B,N=null)=>(Y.has(B)||Y.set(B,B.getSurroundingArea().entries().reduce((Ie,Rr)=>Ie+d(Rr,N),0)),Y.get(B)),"areaScore");r.emit("world:generate-start-tiles");let x=[],R=h.entries().filter(B=>[Il,ap,cg].some(N=>B.terrain()instanceof N)).map(B=>({tile:B,score:O(B)})).sort(({score:B},{score:N})=>N-B).map(({tile:B})=>B);r.emit("world:start-tiles",R),e.entries().reduce((B,N)=>B.then(async()=>{let Ie=N.player(),Rr=await N.chooseFromList(new Dm(i.entries(),"choose-civilization")),Kt=new Rr(c,u);Ie.setCivilization(Kt);let xe=await N.chooseFromList(new Dm(l.getByCivilization(Kt.sourceClass()),"choose-leader")),Oe=new xe(y);Kt.setLeader(Oe),i.unregister(Kt.sourceClass()),l.unregister(Oe.sourceClass());let[we]=s.process(fO,h,Ie,x);if(!we)throw new TypeError("Not enough `startingSquare`s.");x.push(we),s.process(cO,Ie,we)}),Promise.resolve()).then(()=>r.emit("game:start"))})),new Ll(new p(h=>{r.emit("world:built",h)}))],"getRules"),OF=iK});var oK={};var vF=n(()=>{QS();eF();M();rF();oF();aF();lF();pF();uF();yF();gF();xF();RF();f.register(...ZS(),...XS(),...tF(),...iF(),...nF(),...sF(),...mF(),...cF(),...fF(),...dF(),...hF(),...OF())});var CF=w(bF=>{"use strict";Object.defineProperty(bF,"__esModule",{value:!0});$S();vF()});var nK={};var TF=n(()=>{ti();E();b.register(Ua,Yo,no,Da,pr,ao,No,Wo,so,Kn,fs,$r,qn,St,lo,ys,Gi,Lo,mo,jo,Zr,Bt,Vn,Jn,Ea,ka,ds,$n,Br,gs,Gr,Qr,Zn,hs,Xr,Mi,zo,cr,ei,po,co,Qn,Ui,ur,uo,Di,Ho,Ei,fo,Xn,ea,ki,ta,yo,Ft,ra,Sa,_o,Fa,Ya,Ko,go,Os,qo,ia,Mr,ho)});var PF=n(()=>{IR()});var aK,IF,wF=n(()=>{Ye();yn();PF();D();T();aK=t((i=L)=>[new rt(new m(e=>i.getByPlayer(e).researching()===null),new m(e=>i.getByPlayer(e).available().length>0),new p(e=>[new $l(e,i.getByPlayer(e))]))],"getRules"),IF=aK});var sK,AF,BF=n(()=>{E();Ye();M();om();T();Ld();sK=t((i=b,e=L,r=f,o=()=>Math.random())=>[new Vi(new p(a=>e.register(new vp(a,i,r)))),new Vi(new p(a=>{let s=e.getByPlayer(a);for(let l=0,c=Math.min(s.available().length,Math.floor(4*o()));l<c;l++){let u=s.available();s.addAdvance(u[Math.floor(o()*u.length)])}}))],"getRules"),AF=sK});var lK,GF,MF=n(()=>{Ye();Ql();T();D();lK=t((i=L,e=()=>Math.random())=>[new Pr(new m((r,o,a)=>i.getByPlayer(a).complete().some(s=>!i.getByPlayer(o).completed(s.constructor))),new p((r,o,a)=>{let s=i.getByPlayer(o),l=i.getByPlayer(a).complete().filter(c=>!s.completed(c.constructor));s.addAdvance(l.map(c=>c.constructor)[Math.floor(e()*l.length)])}))],"getRules"),GF=lK});var mK,UF,DF=n(()=>{X();Dd();T();mK=t((i=I)=>[new Bl(new p((e,r)=>{i.emit("player:research-complete",e,r)}))],"getRules"),UF=mK});var pK,EF,kF=n(()=>{Ev();T();pK=t(()=>[new kd(new p((i,e)=>(e.complete().length+1)*(6+2*0)))],"getRules"),EF=pK});var cK,SF,FF=n(()=>{Ye();M();qp();D();T();Vp();$h();cK=t((i=L,e=f)=>[new na(new m(r=>r instanceof lr),new m((r,o,a)=>!e.process(La,o,a).some(s=>s)),new p((r,o)=>i.getByPlayer(o.player()).add(r)))],"getRules"),SF=cK});var uK,YF,NF=n(()=>{ti();D();T();kv();uK=t(()=>[...[[Ua,ka,Zr],[no,po,ur],[Da,qo,fo],[pr,qn,Ya],[ao,go,ia],[No,Gi,Zn],[Kn,Mr,co],[fs,Ea,gs],[$r,Yo],[qn,yo,Jn],[St,Ei,Gr],[lo,Bt,po],[ys,Jn,go],[Gi,mo,cr],[Lo,ao,Gr],[mo,Wo],[jo,Ei,Xr],[Zr,Qn,Mi],[Bt,Vn,Zr],[Vn,Gi,Os],[Jn,Br,Kn],[Ea,cr,Ui],[ka,qn,fo],[ds,Ho,Ko],[$n,Lo,co],[Br,Qr,Zn],[Gr,ki,ao],[Qr,Vn,Xr],[Zn,Wo],[hs,ei,St],[Xr,$r,ho],[Mi,uo,fo],[zo,Yo],[ei,Lo,pr],[po,Yo,cr],[co,Ei,ia],[Qn,Br,Mr],[Ui,$r,ur],[ur,so],[uo,no,zo],[Di,ei,Da],[Ho,Di,Bt],[Ei,ur,Xr],[fo,uo,po],[Xn,yo,_o],[ki,No,Fa],[ta,jo,ei],[yo,Lo,Kn],[Ft,Ei,ho],[ra,lo,Xn],[Sa,Bt,Ua],[_o,lo,Sa],[Fa,Qr,fo],[Ya,Qn,Gr],[Ko,ei,Xn],[go,$r,Xr],[qo,no,Mr],[ia,$r,mo],[Mr,Ei,po],[ho,Yo]].map(([i,...e])=>new Fd(new m(r=>r===i),new p((r,o)=>e.every(a=>o.some(s=>s instanceof a)))))],"getRules"),YF=uK});var fK,WF,LF=n(()=>{X();T();Nd();fK=t((i=I)=>[new Rp(new p((e,r)=>{i.emit("player:research",e,r)}))],"getRules"),WF=fK});var yK={};var jF=n(()=>{wF();BF();MF();DF();kF();M();FF();NF();LF();f.register(...IF(),...AF(),...GF(),...UF(),...EF(),...SF(),...YF(),...WF())});var HF=w(zF=>{"use strict";Object.defineProperty(zF,"__esModule",{value:!0});TF();jF()});var Qs=n(()=>{GC();MC();EC();kC();SC();FC()});var dK={};var _F=n(()=>{Qs();cm();Do.register(rr,ir,hr,_r,Ht,Dt)});var yO,dO,QC=n(()=>{U();yO=class extends g{};t(yO,"Built");dO=yO});var gO,hO,XC=n(()=>{U();gO=class extends g{};t(gO,"ChanceOfSuccess");hO=gO});var xO,OO,eT=n(()=>{U();xO=class extends g{};t(xO,"FlightTime");OO=xO});var RO,vO,tT=n(()=>{U();RO=class extends g{};t(RO,"Landed");vO=RO});var bO,KF,qF=n(()=>{U();bO=class extends g{};t(bO,"Launch");KF=bO});var CO,Lu,rT=n(()=>{U();CO=class extends g{};t(CO,"Lost");Lu=CO});var TO,hc,PO=n(()=>{J();M();at();QC();XC();Gx();eT();tT();qF();rT();TO=class extends S{#e=!1;#t;#r;#i;#o;#a=null;#n;constructor(e,r,o=f,a=Z,s=()=>Math.random()){super(),this.#r=e,this.#t=r,this.#o=o,this.#n=a,this.#i=s,this.addKey("activeParts","chanceOfSuccess","flightTime","inactiveParts","launched","layout","player","successful","yields")}activeParts(){return this.#t.activeSlots().filter(e=>!e.empty()).map(e=>e.part())}add(e){let[r]=this.#o.process(wm,e,this.#t);!r||(r.fill(e),this.#o.process(dO,e,this))}chanceOfSuccess(){return Math.max(...this.#o.process(hO,this),0)}check(){if(!(this.#a!==null||this.#e===!1||this.#e+this.flightTime()<this.#n.value())){if(this.#a=this.chanceOfSuccess()>this.#i(),this.#a){this.#o.process(vO,this);return}this.#o.process(Lu,this)}}flightTime(){return Math.min(...this.#o.process(OO,this),1/0)}inactiveParts(){return this.#t.inactiveSlots().filter(e=>!e.empty()).map(e=>e.part())}launch(){this.#o.process(KF,this),this.#e=this.#n.value()}launched(){return this.#e}layout(){return this.#t}player(){return this.#r}successful(){return this.#a}yields(){return this.activeParts().flatMap(e=>e.yields())}};t(TO,"Spaceship");hc=TO});var IO,Xo,Mm=n(()=>{Re();PO();IO=class extends W{constructor(){super(hc)}getActiveByPlayer(e){let[r]=this.getBy("player",e).filter(o=>o.launched()===!1||o.successful()===null);return r||null}};t(IO,"SpaceshipRegistry");Xo=new IO});var wO,vt,la=n(()=>{Re();Se();wO=class extends W{constructor(){super(Pe)}getByCity(e){return this.getBy("city",e)}getByPlayer(e){return this.filter(r=>r.city().player()===e)}};t(wO,"WonderRegistry");vt=new wO});var ma,AO,BO=n(()=>{Se();ma=class extends Be{};t(ma,"ApolloProgram");AO=ma});var gK,VF,JF=n(()=>{bp();Qs();Ye();Mm();la();BO();D();T();kn();hh();hu();vh();gK=t((i=vt,e=L,r=Xo)=>[new gt(new m((o,a)=>Object.prototype.isPrototypeOf.call(ct,a)),new p(()=>new m(()=>i.some(o=>o instanceof AO)))),new gt(new m((o,a)=>Object.prototype.isPrototypeOf.call(ct,a)),new p(o=>new m(()=>{let a=r.getActiveByPlayer(o.player());return a===null?!1:a.launched()===!1}))),...[[Dt,Rh],[rr,gu],[Ht,gu],[ir,xs],[hr,xs],[_r,xs]].map(([o,a])=>new gt(new m((s,l)=>l===o),new p(s=>new m(()=>e.getByPlayer(s.player()).completed(a)))))],"getRules"),VF=gK});var hK,$F,ZF=n(()=>{Cp();Qs();hK=t(()=>[...[[rr,160],[ir,320],[hr,320],[_r,320],[Ht,160],[Dt,80]].flatMap(([i,e])=>Gl(i,e))],"getRules"),$F=hK});var xK,QF,XF=n(()=>{Op();Fx();M();Mm();at();BO();Tp();D();T();kn();PO();xK=t((i=Sn,e=Xo,r=ac,o=f,a=Z,s=()=>Math.random())=>[new to(new m((l,c)=>c instanceof AO),new p(()=>{let[l]=r.entries(),c=new l(o);i.entries().forEach(u=>e.register(new hc(u,c,o,a,s)))})),new to(new m((l,c)=>c instanceof ct),new m((l,c)=>e.getActiveByPlayer(c.city().player())!==null),new p((l,c)=>{let u=c;e.getActiveByPlayer(u.city().player()).add(u)}))],"getRules"),QF=xK});var GO,jl,iT=n(()=>{J();GO=class extends ue{#e;#t;constructor(e,r){super(),this.addKey("resource","value"),this.#e=e,this.#t=r}resource(){return this.#e}value(){return this.#t}};t(GO,"SpendCost");jl=GO});var OK,e1,t1=n(()=>{D();T();ts();kn();eu();iT();OK=t(()=>[new Eo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(ct,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>new jl(Pi,i.remaining()*8))),new Eo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(ct,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>new jl(Pi,i.remaining()*4)))],"getRules"),e1=OK});var RK,r1,i1=n(()=>{Mm();yn();D();T();qR();RK=t((i=Xo)=>[new rt(new m(e=>i.getActiveByPlayer(e)!==null),new p(e=>[new ZT(e,i.getActiveByPlayer(e))]))],"getRules"),r1=RK});var oT,vK,o1,n1=n(()=>{Qs();UC();D();T();oT=new Am(new m(i=>i.part()instanceof Ht),new p((i,e)=>{oT.disable();let r=e.activeSlots();return oT.enable(),e.getAdjacent(i).some(o=>o.part()instanceof rr&&r.includes(o))})),vK=t(()=>[new Am(new p(i=>i.part()!==null)),new Am(new m(i=>[rr,ir,hr,_r].some(e=>i.part()instanceof e)),new p((i,e)=>e.getAdjacent(i).some(r=>r.part()instanceof Dt))),oT],"getRules"),o1=vK});var bK,a1,s1=n(()=>{X();QC();T();bK=t((i=I)=>[new dO(new p(e=>{i.emit("player:spaceship:part-built",e.city().player())}))],"getRules"),a1=bK});var pa,l1=n(()=>{je();pa=class extends j{};t(pa,"Energy")});var _a,m1=n(()=>{je();_a=class extends j{};t(_a,"LifeSupport")});var Ro,p1=n(()=>{je();Ro=class extends j{};t(Ro,"Mass")});var zl,c1=n(()=>{je();zl=class extends j{};t(zl,"Population")});var MO=n(()=>{l1();m1();p1();c1()});var CK,u1,f1=n(()=>{MO();Qs();XC();T();CK=t(()=>[new hO(new p(i=>{let[e,r,o,a,s]=i.yields().reduce(([G,Y,d,O,x],R)=>(R instanceof pa&&R.value()>0&&(G+=R.value()),R instanceof pa&&R.value()<0&&(Y+=Math.abs(R.value())),R instanceof _a&&R.value()>0&&(d+=R.value()),R instanceof _a&&R.value()<0&&(O+=Math.abs(R.value())),R instanceof zl&&(x+=R.value()),[G,Y,d,O,x]),[0,0,0,0,0]),[l,c]=i.activeParts().reduce(([G,Y],d)=>(d instanceof rr&&G++,d instanceof Ht&&Y++,[G,Y]),[0,0]);if([e,o,s,l,c].some(G=>G===0))return 0;let u=Math.min(l/c,1),y=Math.min(a/o,1),h=Math.min(r/e,1);return u*y*h}))],"getRules"),u1=CK});var TK,y1,d1=n(()=>{Gx();D();T();Qs();TK=t(()=>[new wm(new m(i=>i instanceof Dt),new m((i,e)=>e.slots().filter(r=>r.accepts(i)&&r.empty()).length>0),new p((i,e)=>{let r=e.slots().filter(a=>a.accepts(i)&&a.empty()),[o]=r.sort((a,s)=>e.getAdjacent(s).filter(l=>l.part()instanceof Dt).length-e.getAdjacent(a).filter(l=>l.part()instanceof Dt).length||e.getAdjacent(s).filter(l=>!l.empty()).length-e.getAdjacent(a).filter(l=>!l.empty()).length||Math.abs(a.x()-8)-Math.abs(s.x()-8)||Math.abs(a.y()-6)-Math.abs(s.y()-6));return o})),new wm(new m(i=>!(i instanceof Dt)),new m((i,e)=>e.slots().filter(r=>r.accepts(i)&&r.empty()).length>0),new p((i,e)=>{let r=e.slots().filter(a=>a.accepts(i)&&a.empty()),[o]=r.sort((a,s)=>e.getAdjacent(s).filter(l=>!l.empty()).length-e.getAdjacent(a).filter(l=>!l.empty()).length||Math.abs(a.x()-8)-Math.abs(s.x()-8)||Math.abs(a.y()-6)-Math.abs(s.y()-6));return o}))],"getRules"),y1=TK});var PK,g1,h1=n(()=>{at();Wv();eT();T();MO();Qs();ko();PK=t((i=Pp,e=Z)=>[new OO(new p(r=>{let o=Ve(r.yields(),Ro),a=r.activeParts().reduce((y,h)=>y+(h instanceof Ht?1:0),0),s=Math.trunc(o/20/(1+a*10)*10)/10,l=i.value(),c=l+s,u=e.value();for(;i.value(u)<c;)u++;return u}))],"getRules"),g1=PK});var IK,x1,O1=n(()=>{X();T();tT();IK=t((i=I)=>[new vO(new p(e=>{i.emit("player:spaceship:landed",e.player())}))],"getRules"),x1=IK});var wK,R1,v1=n(()=>{X();Fx();M();Mm();at();T();rT();PO();wK=t((i=Xo,e=ac,r=f,o=Z,a=I,s=()=>Math.random())=>[new Lu(new p(l=>{a.emit("player:spaceship:lost",l.player())})),new Lu(new p(l=>{let[c]=e.entries(),u=new c(r);i.register(new hc(l.player(),u,r,o,s))}))],"getRules"),R1=wK});var AK,b1,C1=n(()=>{MO();Qs();D();T();wv();AK=t(()=>[...[[rr,Ro,400],[ir,pa,-50],[ir,_a,-100],[ir,Ro,1600],[ir,zl,1e4],[hr,pa,-50],[hr,_a,100],[hr,Ro,1600],[_r,pa,100],[_r,Ro,400],[Ht,Ro,400],[Dt,Ro,100]].map(([i,e,r])=>new sd(new m(o=>o instanceof i),new p(o=>new e(r,o.id()))))],"getRules"),b1=AK});var UO,DO,nT=n(()=>{U();UO=class extends g{};t(UO,"Start");DO=UO});var BK,T1,P1=n(()=>{Mm();T();nT();BK=t((i=Xo)=>[new DO(new p(()=>{i.entries().forEach(e=>e.check())}))],"getRules"),T1=BK});var GK={};var I1=n(()=>{JF();ZF();XF();t1();M();i1();n1();s1();f1();d1();h1();O1();v1();C1();P1();f.register(...VF(),...$F(),...QF(),...e1(),...r1(),...o1(),...a1(),...u1(),...y1(),...g1(),...x1(),...R1(),...b1(),...T1())});var A1=w(w1=>{"use strict";Object.defineProperty(w1,"__esModule",{value:!0});_F();I1()});var EO,Hl,ju=n(()=>{je();EO=class extends j{};t(EO,"TradeRate");Hl=EO});var Xs,B1=n(()=>{Bc();ju();Xs=class extends Hl{};t(Xs,"Luxuries"),Xs.tradeYield=zT});var el,G1=n(()=>{ty();ju();el=class extends Hl{};t(el,"Research"),el.tradeYield=lr});var tl,M1=n(()=>{ts();ju();tl=class extends Hl{};t(tl,"Tax"),tl.tradeYield=Pi});var aT=n(()=>{B1();G1();M1()});var kO,_l,zu=n(()=>{Uo();ju();kO=class extends et{constructor(){super(Hl)}};t(kO,"AvailableTradeRateRegistry");_l=new kO});var MK={};var U1=n(()=>{aT();zu();_l.register(Xs,el,tl)});var D1=n(()=>{Xf();Xa()});var SO,FO,sT=n(()=>{J();SO=class extends S{#e;#t=[];constructor(e,...r){super(),this.#e=e,this.#t=r,this.addKey("all")}all(){return[...this.#t]}balance(e){if(this.total()===100)return;let r=100-e.value(),o=this.#t.filter(s=>s!==e),a=o.reduce((s,l)=>s+l.value(),0);o.forEach(s=>s.set(s.value()/a*r)),this.total()<100&&o[Math.floor(o.length*Math.random())].add(100-this.total()),this.total()>100&&o[Math.floor(o.length*Math.random())].subtract(100-this.total())}get(e){let[r]=this.#t.filter(o=>o instanceof e);return r}player(){return this.#e}set(e,r){let o=this.get(e);o.set(r),this.balance(o)}setAll(e){if(e.reduce((r,[,o])=>r+o,0)!==100)throw new TypeError("Invalid rates provided, must sum to 100.");e.forEach(([r,o])=>this.get(r).set(o))}total(){return this.#t.reduce((e,r)=>e+r.value(),0)}};t(SO,"PlayerTradeRates");FO=SO});var YO,Kl,Hu=n(()=>{Re();sT();YO=class extends W{constructor(){super(FO)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of PlayerTradeRates for player");return r[0]}};t(YO,"PlayerTradeRatesRegistry");Kl=new YO});var UK,E1,k1=n(()=>{zu();D1();Hu();T();zm();ko();UK=t((i=_l,e=Kl)=>[new jm(new p((r,o)=>{let a=e.getByPlayer(r.player()),s=Math.max(0,Ve(o,ye)),l=s;return i.entries().map(c=>{let u=c.tradeYield,y=Math.min(Math.ceil(s*(a.get(c).value()/100)),l);return l-=y,new u(y,c.name)})}))],"getRules"),E1=UK});var DK,S1,F1=n(()=>{Hu();yn();CR();T();DK=t((i=Kl)=>[new rt(new p(e=>[new al(e,i.getByPlayer(e))]))],"getRules"),S1=DK});var EK,Y1,N1=n(()=>{zu();Hu();aT();om();T();sT();EK=t((i=_l,e=Kl)=>[new Vi(new p(r=>{let o=[new tl(50),new el(50),new Xs(0)],a=i.entries(),s=new FO(r,...a.map(l=>{let[c]=o.filter(u=>u instanceof l);return new l(c||0)}));e.register(s)}))],"getRules"),Y1=EK});var NO,kK,W1,L1=n(()=>{zu();tt();M();T();Jl();Vp();Au();ko();NO=[],kK=t((i=f,e=V,r=_l)=>[new ja(new ga,new p(o=>{NO.length===0&&r.entries().forEach(a=>NO.push(a.tradeYield)),e.getByPlayer(o).forEach(a=>{let s=a.yields();ym(s,...NO).reduce((l,c,u)=>(l[u].set(c,"Consolidated"),l),NO.map(l=>new l)).forEach(l=>i.process(na,l,a,s))})}))],"getRules"),W1=kK});var SK={};var j1=n(()=>{M();k1();F1();N1();L1();f.register(...E1(),...S1(),...Y1(),...W1())});var H1=w(z1=>{"use strict";Object.defineProperty(z1,"__esModule",{value:!0});U1();j1()});var WO=n(()=>{PC();ts()});var FK,_1,K1=n(()=>{ze();D();T();WO();eu();iT();os();FK=t(()=>[new Eo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Ue,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>{let e=i.remaining()/10;return new jl(Qe,Math.floor((e+4)*10*e))})),new Eo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Ue,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>{let e=i.remaining()/10;return new jl(Qe,Math.floor(5*e**2+20*e))})),new Eo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(z,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>new jl(Qe,i.remaining()*4))),new Eo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(z,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>new jl(Qe,i.remaining()*2)))],"getRules"),_1=FK});var YK,q1,V1=n(()=>{Pa();tt();yn();YR();T();YK=t((i=V,e=Vt)=>[new rt(new p(r=>i.getByPlayer(r).map(o=>new cl(r,e.getByCity(o)))))],"getRules"),q1=YK});var NK,J1,$1=n(()=>{fm();om();T();WO();Yv();NK=t((i=ro)=>[new Vi(new p(e=>i.register(new tg(e,Qe))))],"getRules"),J1=NK});var WK,Z1,Q1=n(()=>{WO();Hr();X();fm();M();Fv();D();T();Vp();WK=t((i=ro,e=f,r=Ge,o=I)=>[new na(new m(a=>a instanceof Qe),new p((a,s,l)=>{let c=i.getByPlayerAndType(s.player(),Qe);l.forEach(u=>{if(u instanceof Qe&&(c.add(u),u instanceof Ce&&c.value()<0)){let y=u.cityImprovement(),h=new qd(y.constructor,s,e);r.unregister(y),c.add(h.cost().value()),o.emit("city:unsupported-improvement",s,y);return}})}))],"getRules"),Z1=WK});var LO,X1,eY=n(()=>{U();LO=class extends g{};t(LO,"Updated");X1=LO});var LK,tY,rY=n(()=>{X();D();T();eY();LK=t((i=I)=>[new X1(new m(e=>e.value()<0),new p((e,r)=>{i.emit("player:treasury-exhausted",e.player(),e,r)}))],"getRules"),tY=LK});var jK={};var iY=n(()=>{M();K1();V1();$1();Q1();rY();f.register(..._1(),...q1(),...J1(),...Z1(),...tY())});var nY=w(oY=>{"use strict";Object.defineProperty(oY,"__esModule",{value:!0});iY()});var zK={};var aY=n(()=>{Qo();cm();Do.register(ai,si,dr,kr,li,mi,Sr,Fr,pi,ci,jt,Yr,Xt,Nr,Wr,ui,Lr,zt,fi,jr,Le,zr,gr,er,yi,di,tr,gi)});var jO,xc,lT=n(()=>{U();jO=class extends g{};t(jO,"Available");xc=jO});var sY=n(()=>{Fu();Fu()});var mT=n(()=>{jC()});var lY=n(()=>{mT();mT()});var pT=n(()=>{sY();lY()});var zO,mY,HO,_K,pY,cY=n(()=>{$R();Ba();lm();Ct();tt();Qo();Fo();us();Ga();Tr();M();Cn();Ii();wp();at();Ke();ls();Ci();af();lT();D();T();Xh();pT();zO=new m((i,e,r=i.tile())=>i instanceof $e),mY=new m((i,e,r=i.tile())=>i instanceof We),HO=t((i,e)=>e.getByTile(i)!==null,"tileHasCity"),_K=t((i=oe,e=V,r=f,o=He,a=Ar,s=_,l=Tt,c=wa,u=Z,y=mr,h=Me)=>{let G=[tp,$i,new m((d,O)=>s.getByTile(O).some(x=>x.player()!==d.player())),new hi(new da(new m(d=>d instanceof xt),new hi(new m((d,O)=>!s.getByTile(O).every(x=>x instanceof xt)),new m((d,O)=>d instanceof jt))),new da(zO,new hi(new m((d,O)=>HO(O,e)),new m((d,O)=>s.getByTile(O).some(x=>x instanceof $e)))),new da(mY,new hi(new m((d,O)=>!(d instanceof gr)),new m((d,O)=>O.isWater()))))],Y=[tp,$i,zO,new m((d,O)=>HO(O,e)),new m((d,O)=>s.getByTile(O).length===0),new m((d,O)=>e.getByTile(O).player()!==d.player())];return[new dt(tp,$i,new hi(new da(zO,new m((d,O,x=d.tile())=>x.isLand()),new m((d,O)=>O.isLand()),new m((d,O)=>s.getByTile(O).every(x=>x.player()===d.player()))),new da(mY,new hi(new m((d,O,x=d.tile())=>x.isWater()),new m((d,O,x=d.tile())=>e.getByTile(x)?.player()===d.player())),new hi(new m((d,O)=>O.isWater()),new m((d,O)=>e.getByTile(O)?.player()===d.player()))),new m(d=>d instanceof xt)),new hi(new m((d,O)=>!(d instanceof $e)),new m((d,O,x=d.tile())=>!(x.getNeighbours().some(R=>s.getByTile(R).some(B=>B instanceof $e&&B.tile().terrain()instanceof $&&B.player()!==d.player()))&&O.getNeighbours().some(R=>s.getByTile(R).some(B=>B instanceof $e&&B.tile().terrain()instanceof $&&B.player()!==d.player())))),new m((d,O)=>s.getByTile(O).filter(x=>x.player()===d.player()).length>0),new m((d,O)=>{let x=e.getByTile(O);return x===null?!1:x.player()===d.player()})),new m((d,O)=>{let x=e.getByTile(O);return x===null?!0:x.player()===d.player()}),new m((d,O)=>!s.getByTile(O).some(x=>x.player()!==d.player())),new p((d,O,x=d.tile())=>new pt(x,O,d,r))),new dt(...G,new m((d,O)=>s.getByTile(O).every(x=>y.getByPlayers(d.player(),x.player()).filter(R=>R instanceof Wi).every(R=>R.expired()))),new p((d,O,x=d.tile())=>new Zi(x,O,d,r,s))),new dt(...G,new m((d,O)=>s.getByTile(O).every(x=>y.getByPlayers(d.player(),x.player()).some(R=>R instanceof Wi&&R.active()))),new p((d,O,x=d.tile())=>{let R=Array.from(new Set(s.getByTile(O).filter(B=>y.getByPlayers(d.player(),B.player()).some(N=>N instanceof Wi&&N.active())).map(B=>B.player())));return R.length>1&&(console.warn("Multiple targets for declaring war:"),console.warn(R),console.warn("core-unit/Rules/Unit/action.ts")),new Dn(x,O,d,R[0],r,s)})),new dt(...Y,new m((d,O)=>{let x=e.getByTile(O);return y.getByPlayers(d.player(),x.player()).filter(R=>R instanceof Wi).every(R=>R.expired())}),new p((d,O,x=d.tile())=>{let R=e.getByTile(O);return new bn(x,O,d,R,r)})),new dt(...Y,new m((d,O)=>{let x=e.getByTile(O);return y.getByPlayers(d.player(),x.player()).filter(R=>R instanceof Wi).some(R=>R.active())}),new p((d,O,x=d.tile())=>{let R=e.getByTile(O);return new En(x,O,d,R,R.player(),r)})),new dt($i,ba,new m(d=>d instanceof q),new m((d,O)=>o.getByTile(O).filter(x=>[Fe,mt,wr,qe].some(R=>x instanceof R)).length>0),new p((d,O,x=d.tile())=>new Mn(x,O,d,r,o,u))),new dt($i,ba,new m(d=>d instanceof q),new m((d,O,x=d.tile())=>x.isLand()),new p((d,O,x=d.tile())=>new Bn(x,O,d,r,u,a))),new dt($i,ba,new p((d,O,x=d.tile())=>new Go(x,O,d,r,u))),new dt($i,ba,new p((d,O,x=d.tile())=>new as(x,O,d,r))),new dt(ba,new p((d,O,x=d.tile())=>new Gn(x,O,d,r))),new dt($i,ba,new m(d=>d instanceof Le),new m((d,O,x=d.tile())=>x.isLand()),new m((d,O,x=d.tile())=>!HO(x,e)),new p((d,O,x=d.tile())=>new ms(x,O,d,i,r,h))),...[[Fe,xn,new hi(new m((d,O,x=d.tile())=>x.terrain()instanceof pe),new m((d,O,x=d.tile())=>x.getAdjacent().some(R=>R.terrain()instanceof pe||R.terrain()instanceof Cr||o.getByTile(R).some(B=>B instanceof Fe)&&!HO(R,e))))],[mt,On],[qe,vn],[wr,Rn,new m((d,O)=>o.getByTile(O).some(x=>x instanceof qe))]].map(([d,O,...x])=>new dt(new m(R=>R instanceof Zt),$i,new m((R,B,N=R.tile())=>r.get(xc).some(Ie=>Ie.validate(N,d,R.player()))),ba,...x,new p((R,B,N=R.tile())=>new O(N,B,R,r,u)))),...[[ut,In],[it,Tn],[de,Un],[ft,wn]].map(([d,O])=>new dt($i,ba,new m(x=>x instanceof Zt),new m((x,R,B=x.tile())=>B.terrain()instanceof d),new p((x,R,B=x.tile())=>new O(B,R,x,r,l,u)))),new dt(tp,$i,zO,new m((d,O)=>O.terrain()instanceof Cr),new m((d,O)=>s.getByTile(O).every(x=>x.player()===d.player())),new m((d,O)=>s.getByTile(O).filter(x=>x instanceof wt).some(x=>x.hasCapacity()&&x.canStow(d))),new p((d,O,x=d.tile())=>{let[R]=s.getByTile(O).filter(B=>B instanceof wt).filter(B=>B.hasCapacity()&&B.canStow(d));return new ss(x,O,d,R,r)})),new dt(tp,new m(d=>{try{return c.getByUnit(d),!0}catch{return!1}}),new hi(new m((d,O)=>!(d instanceof $e)),new m((d,O)=>O.isLand())),new m((d,O,x=d.tile())=>c.getByUnit(d).transport().tile()===x),new p((d,O,x=d.tile())=>{let R=c.getByUnit(d).transport();return new An(x,O,d,R,r)})),new dt($i,ba,new m(d=>d instanceof wt),new m(d=>d.hasCargo()),new m((d,O)=>O.getNeighbours().some(x=>x.isLand())),new p((d,O,x=d.tile())=>new ps(x,O,d,r)))]},"getRules"),pY=_K});var KK,uY,fY=n(()=>{ls();ZR();D();T();su();KK=t((i=Ar)=>[new rp(new m(e=>e.moves().value()>0),new p(e=>e.setActive())),new rp(new m(e=>e.busy()!==null),new p(e=>e.setBusy())),...[Jr].map(e=>new rp(new m(r=>i.getByUnit(r).some(o=>o instanceof e)),new p(r=>i.unregister(...i.getByUnit(r).filter(o=>o instanceof e)))))],"getRules"),uY=KK});var qK,yY,dY=n(()=>{bp();Qo();Ye();_g();Kg();Vg();Jg();$g();Zg();D();T();Xg();eh();rh();ih();nh();sh();lh();ph();uh();yh();dh();Ba();gh();hu();Oh();Ch();Ph();wh();Bh();Mh();qK=t((i=L)=>[new gt(new m((e,r)=>Object.prototype.isPrototypeOf.call(We,r)),new p(e=>new m(()=>e.tile().isCoast()))),...[[ai,xs],[si,Th],[dr,lu],[kr,yu],[mi,lu],[li,Ah],[Sr,fh],[Fr,Ih],[pi,cu],[ci,Gh],[jt,Qg],[Yr,fu],[Xt,th],[Nr,bh],[Wr,pu],[ui,ah],[Lr,Gp],[zt,xh],[fi,xm],[jr,du],[zr,qg],[gr,ch],[er,oh],[yi,mu],[di,uu],[tr,mh]].map(([e,r])=>new gt(new m((o,a)=>a===e),new p(o=>new m(()=>i.getByPlayer(o.player()).completed(r))))),...[[kr,xs],[Sr,yu],[Fr,pu],[Yr,uu],[Xt,xm],[Nr,cu],[Wr,mu],[Lr,xm],[jr,fu],[zr,Gp],[er,xm],[tr,du],[gi,Gp]].map(([e,r])=>new gt(new m((o,a)=>a===e),new p(o=>new m(()=>!i.getByPlayer(o.player()).completed(r)))))],"getRules"),yY=qK});var VK,gY,hY=n(()=>{Cp();Qo();VK=t(()=>[...[[ai,80],[si,160],[dr,120],[kr,40],[li,50],[mi,160],[Sr,40],[Fr,40],[pi,80],[ci,30],[jt,60],[Yr,40],[Xt,20],[Nr,50],[Wr,40],[ui,50],[Lr,30],[zt,160],[fi,30],[jr,40],[Le,40],[zr,20],[gr,50],[er,20],[yi,80],[di,50],[tr,40],[gi,10]].flatMap(([i,e])=>Gl(i,e))],"getRules"),gY=VK});var JK,xY,OY=n(()=>{kt();Tp();D();T();Qo();JK=t((i=re)=>[new to(new m((e,r)=>r instanceof Le),new p(e=>i.getByCity(e.city()).shrink()))],"getRules"),xY=JK});var $K,RY,vY=n(()=>{X();Ke();yy();T();$K=t((i=_,e=I)=>[new is(new p(r=>i.register(r))),new is(new p(r=>r.applyVisibility())),new is(new p(r=>r.moves().set(r.movement()))),new is(new p(r=>{e.emit("unit:created",r)}))],"getRules"),RY=$K});var ZK,bY,CY=n(()=>{tt();X();M();Ii();Ke();D();Dc();Mc();T();ZK=t((i=V,e=f,r=He,o=_,a=I)=>[new gn(new p((s,l)=>{a.emit("unit:defeated",s,l),e.process(dn,s,l.player())})),new gn(new m(s=>i.getByTile(s.tile())===null),new m(s=>o.getByTile(s.tile()).filter(l=>l!==s&&l.player()===s.player()).length>0),new p((s,l)=>o.getByTile(s.tile()).forEach(c=>{c!==s&&c.player()===s.player()&&e.process(dn,s,l.player())})))],"getRules"),bY=ZK});var QK,TY,PY=n(()=>{X();ls();Ke();Mc();T();QK=t((i=_,e=Ar,r=I)=>[new dn(new p((o,a)=>{r.emit("unit:destroyed",o,a)})),new dn(new p(o=>{o.setActive(!1),o.setDestroyed()})),new dn(new p(o=>e.getByUnit(o).forEach(a=>e.unregister(a))))],"getRules"),TY=QK});var _O,Oc,cT=n(()=>{U();_O=class extends g{};t(_O,"LostAtSea");Oc=_O});var XK,IY,wY=n(()=>{X();T();cT();XK=t((i=I)=>[new Oc(new p(e=>{i.emit("unit:lost-at-sea",e)})),new Oc(new p(e=>e.destroy(null)))],"getRules"),IY=XK});var KO,e2,AY,BY=n(()=>{Qo();tt();lm();X();us();M();wp();at();af();D();T();Jl();cT();st();Xh();Ba();pT();KO=new Map,e2=t((i=wa,e=f,r=()=>Math.random(),o=I,a=V,s=Z,l=mr)=>[new K(new p((c,u)=>{o.emit("unit:moved",c,u)})),new K(new p(c=>c.applyVisibility())),new K(new m(c=>c.moves().value()<.3),new p(c=>{c.moves().set(0),c.setActive(!1)})),new K(new m(c=>c instanceof wt),new m((c,u)=>u instanceof pt),new m(c=>c.hasCargo()),new p((c,u)=>c.cargo().forEach(y=>y.action(u.forUnit(y))))),new K(new m((c,u)=>u instanceof An),new p(c=>{let u=i.getByUnit(c);u.transport().unload(c),i.unregister(u)})),new K(new m(c=>c instanceof tr),new m(c=>c.moves().value()===0),new m(c=>!c.tile().isCoast()),new m(()=>r()<=.5),new p(c=>{e.process(Oc,c)})),...[[dr,1],[jt,0],[zt,0]].flatMap(([c,u])=>[new K(new ga,new m(y=>y instanceof c),new m(y=>y.moves().value()===0),new m(y=>!KO.has(y)),new p(y=>{KO.set(y,s.value())})),new K(new m(y=>y instanceof c),new m(y=>y.moves().value()===0),new hi(new m(y=>a.getByTile(y.tile())!==null),new m(y=>!!i.getByUnit(y))),new p(y=>{KO.delete(y)})),new K(new m(y=>y instanceof c),new m(y=>y.moves().value()===0),new da(new m(y=>a.getByTile(y.tile())===null),new m(y=>!i.getByUnit(y))),new m(y=>(KO.get(y)??s.value())+u<=s.value()),new p(y=>{e.process(Oc,y)}))]),new K(new m((c,u)=>u instanceof Dn||u instanceof En),new p((c,u)=>{l.getByPlayers(c.player(),u.enemy()).filter(h=>h instanceof Wi&&h.active()).forEach(h=>h.expire())}))],"getRules"),AY=e2});var GY,t2,MY,UY=n(()=>{Fo();Ba();lm();Ga();Ii();wp();D();T();Qi();GY=[[Jt,2],[Ee,1],[it,2],[Te,1],[Ne,2],[ut,2],[Je,3],[ht,1],[de,1],[pe,1],[ft,2],[It,1]],t2=t((i=He,e=wa)=>[...GY.map(([r,o])=>new De(new m((a,s)=>s instanceof pt),new m(a=>a instanceof $e),new m((a,s)=>s.to().terrain()instanceof r),new p(()=>o))),new De(new m((r,o)=>o instanceof pt),new m(r=>r instanceof xt||r instanceof We),new p(()=>1)),new De(new m((r,o)=>o instanceof pt),new m(r=>r instanceof $e),new m((r,o)=>i.getByTile(o.from()).some(a=>a instanceof qe)),new m((r,o)=>i.getByTile(o.to()).some(a=>a instanceof qe)),new p(()=>1/3)),new De(new m((r,o)=>o instanceof pt),new m(r=>r instanceof $e),new m((r,o)=>i.getByTile(o.from()).some(a=>a instanceof wr)),new m((r,o)=>i.getByTile(o.to()).some(a=>a instanceof wr)),new p(()=>0)),new De(new m((r,o)=>o instanceof pt),new m(r=>r instanceof $e),new m(r=>{try{return e.getByUnit(r),!0}catch{return!1}}),new m(r=>e.getByUnit(r).transport()instanceof wt),new p(()=>0)),...[[xn,2],[On,3],[vn,1],[Rn,2],[Tn,2],[In,3],[wn,3],[Bn,1],[Mn,1],[Un,3],[Go,0]].flatMap(([r,o])=>GY.map(([a,s])=>new De(new m((l,c)=>c instanceof r),new m(l=>l.tile().terrain()instanceof a),new p(()=>o*s))))],"getRules"),MY=t2});var r2,DY,EY=n(()=>{vR();Ke();yn();D();T();r2=t((i=_)=>[new rt(new m(e=>i.getByPlayer(e).some(r=>r.active()&&r.moves().value())),new p(e=>i.getByPlayer(e).filter(r=>r.active()&&r.moves().value()>0).sort((r,o)=>(r.waiting()?1:0)-(o.waiting()?1:0)).map(r=>new ln(e,r)))),new rt(new m(e=>i.getByPlayer(e).some(r=>!r.active()||!r.moves().value())),new p(e=>i.getByPlayer(e).filter(r=>!r.active()||r.moves().value()===0).sort((r,o)=>(r.waiting()?1:0)-(o.waiting()?1:0)).map(r=>new mn(e,r))))],"getRules"),DY=r2});var i2,kY,SY=n(()=>{T();$y();Qv();i2=t(()=>[new xg(new p(i=>i.action(new ZP(i.tile(),i.tile(),i))))],"getRules"),kY=i2});var o2,FY,YY=n(()=>{ep();Qo();su();M();ls();ip();ip();D();T();o2=t((i=Ar,e=f)=>[...[[ai,12,2,2],[si,18,12,4,2],[dr,12,1,8,2],[kr,8],[li,0],[mi,1,12,5,2],[Sr,6],[Fr,4,1,2],[pi,6,6,6,2],[ci,0,0,2],[jt,4,2,10,2],[Yr,2,2,3],[Xt,2,1,2],[Nr,4,4,4],[Wr,4,2,2],[ui,6,6,3],[Lr,3,2],[zt,99,0,16],[fi,3,5],[jr,1,1,3],[Le,0],[zr,1,2],[gr,8,2,3,2],[er,3],[yi,10,5,3],[di,0,3,4],[tr,1,0,3],[gi]].flatMap(([r,o=1,a=1,s=1,l=1])=>iP(r,o,a,s,l)),...[[Jr,1,Ji],[_n,.5,Io,Ji]].flatMap(([r,o,...a])=>a.map(s=>new am(new m((l,c)=>c instanceof s),new m(l=>i.getByUnit(l).some(c=>c instanceof r)),new p((l,c)=>{let u=new s;e.process(bl,l.constructor,u),c.add(u.value()*o,r.name)}))))],"getRules"),FY=o2});var n2,NY,WY=n(()=>{X();T();Hh();n2=t((i=I)=>[new Cm(new p((e,r)=>{i.emit("unit:unsupported",e,r)}))],"getRules"),NY=n2});var a2,LY,jY=n(()=>{D();T();lv();a2=t((i=()=>Math.random())=>[new Ec(new m((e,r)=>e.moves().value()>=r),new p((e,r)=>(e.moves().subtract(r),!0))),new Ec(new m((e,r)=>e.moves().value()<r),new p((e,r)=>{let o=e.moves().value();return e.moves().set(0),o>=r*.5*i()}))],"getRules"),LY=a2});var s2={};var zY=n(()=>{cY();fY();dY();hY();OY();vY();CY();PY();M();wY();BY();UY();EY();SY();YY();WY();jY();f.register(...pY(),...uY(),...yY(),...gY(),...xY(),...RY(),...bY(),...TY(),...IY(),...AY(),...MY(),...DY(),...kY(),...FY(),...NY(),...LY())});var _Y=w(HY=>{"use strict";Object.defineProperty(HY,"__esModule",{value:!0});aY();zY()});var xi,KY=n(()=>{Se();xi=class extends Pe{};t(xi,"Colossus")});var Li,qY=n(()=>{Se();Li=class extends Pe{};t(Li,"CopernicusObservatory")});var en,VY=n(()=>{Se();en=class extends Be{};t(en,"CureForCancer")});var tn,JY=n(()=>{Se();tn=class extends Be{};t(tn,"DarwinsVoyage")});var Oi,$Y=n(()=>{Se();Oi=class extends Pe{};t(Oi,"GreatLibrary")});var rn,ZY=n(()=>{Se();rn=class extends Pe{};t(rn,"GreatWall")});var ji,QY=n(()=>{Se();ji=class extends Pe{};t(ji,"HangingGardens")});var Ka,XY=n(()=>{Se();Ka=class extends Be{};t(Ka,"HooverDam")});var on,eN=n(()=>{Se();on=class extends Be{};t(on,"IsaacNewtonsCollege")});var vo,tN=n(()=>{Se();vo=class extends Be{};t(vo,"JsBachsCathedral")});var zi,rN=n(()=>{Se();zi=class extends Be{};t(zi,"Lighthouse")});var nn,iN=n(()=>{Se();nn=class extends Pe{};t(nn,"MagellansExpedition")});var ca,oN=n(()=>{Se();ca=class extends Be{};t(ca,"ManhattanProject")});var Ri,nN=n(()=>{Se();Ri=class extends Be{};t(Ri,"MichelangelosChapel")});var Or,aN=n(()=>{Se();Or=class extends Pe{};t(Or,"Oracle")});var an,sN=n(()=>{Se();an=class extends Pe{};t(an,"Pyramids")});var sn,lN=n(()=>{Se();sn=class extends Be{};t(sn,"SetiProgram")});var vi,mN=n(()=>{Se();vi=class extends Be{};t(vi,"ShakespearesTheatre")});var qa,pN=n(()=>{Se();qa=class extends Be{};t(qa,"UnitedNations")});var bo,cN=n(()=>{Se();bo=class extends Be{};t(bo,"WomensSuffrage")});var Va=n(()=>{BO();KY();qY();VY();JY();$Y();ZY();QY();XY();eN();tN();rN();iN();oN();nN();aN();sN();lN();mN();pN();cN()});var l2={};var uN=n(()=>{Va();cm();Do.register(ma,xi,Li,en,tn,Oi,rn,ji,Ka,on,vo,zi,nn,ca,Ri,Or,an,sn,vi,qa,bo)});var m2,fN,yN=n(()=>{Va();ti();bp();Ye();la();D();T();Se();Qo();m2=t((i=L,e=vt)=>[new gt(new m((r,o)=>Object.isPrototypeOf.call(Pe,o)),new p((r,o)=>new m(()=>e.filter(a=>a instanceof o).length===0))),...[[xi,Wo],[Li,no],[Oi,Xr],[rn,cr],[ji,ea],[zi,zo],[nn,uo],[Or,so],[an,cr],[ma,_o],[en,$n],[tn,ki],[Ka,Bt],[on,qo],[vo,Ft],[ca,Di],[Ri,Ft],[sn,lo],[vi,co],[qa,St],[bo,Gr]].map(([r,o])=>new gt(new m((a,s)=>s===r),new p(a=>new m(()=>i.getByPlayer(a.player()).completed(o))))),...[[zt,ca]].map(([r,o])=>new gt(new m((a,s)=>s===r),new p(()=>new m(()=>e.some(a=>a instanceof o)))))],"getRules"),fN=m2});var p2,dN,gN=n(()=>{Va();Cp();p2=t(()=>[...[[ma,600],[xi,200],[Li,300],[en,600],[tn,300],[Oi,300],[rn,300],[ji,300],[Ka,600],[on,400],[vo,400],[zi,200],[nn,400],[ca,600],[Ri,300],[Or,300],[an,300],[sn,600],[vi,400],[qa,600],[bo,600]].flatMap(([i,e])=>Gl(i,e))],"getRules"),dN=p2});var c2,hN,xN=n(()=>{Pa();X();Ye();M();la();Tp();D();Va();T();Nd();Se();c2=t((i=Vt,e=L,r=f,o=vt,a=I)=>[new to(new m((s,l)=>l instanceof Pe),new p((s,l)=>{let c=l.constructor;o.register(l),i.filter(u=>u.building()?.item()===c).forEach(u=>u.revalidate())})),new to(new m((s,l)=>l instanceof Pe),new p((s,l)=>{a.emit("wonder:built",l,s.city())})),new to(new m((s,l)=>l instanceof tn),new p(s=>{let l=e.getByPlayer(s.city().player()),c=t(y=>{let h=new Rp(new m(G=>G===l),new p(()=>{r.unregister(h),y()}));r.register(h)},"createOnStarted"),u=t(()=>{l.add(l.cost()),c(()=>l.add(l.cost()))},"completeResearch");if(l.researching()===null){c(()=>u());return}u()}))],"getRules"),hN=c2});var Rc,Co,_u=n(()=>{la();D();Rc=t((i,e=vt)=>new m(r=>e.getByCity(r).some(o=>o instanceof i)),"cityHasWonder"),Co=t((i,e=vt)=>new m(r=>e.getByPlayer(r.player()).some(o=>o instanceof i)),"playerHasWonder")});var ON,ua,qO,Ku=n(()=>{Ye();D();ON=t((i,e=L)=>new m(r=>e.getByPlayer(r.player()).completed(i)),"discoveredByPlayer"),ua=t((i,e=L)=>new m(()=>i===null||!e.some(r=>r.completed(i))),"notDiscoveredByAnyPlayer"),qO=t((i,e=L)=>new m(r=>i===null||!e.getByPlayer(r.player()).completed(i)),"notDiscoveredByPlayer")});var VO,RN=n(()=>{Hr();D();VO=t((i,e=Ge)=>new m(r=>e.getByCity(r).some(o=>o instanceof i)),"hasCityImprovement")});var u2,vN,bN=n(()=>{Oo();Hr();ti();Va();zn();Ye();Ke();la();_u();Ku();Lm();D();T();$a();Zh();sl();rs();RN();ko();u2=t((i=Ge,e=At,r=L,o=_,a=vt)=>[new yt(new ot,Co(Or,a),VO(Qt,i),qO(ur,r),ua(Ft,r),new p((s,l)=>new nt(-Math.min(1,Ve(l,nt)),Or.name))),new yt(new ot,Co(Or,a),VO(Qt,i),ON(ur,r),ua(Ft,r),new p((s,l)=>new nt(-Math.min(2,Ve(l,nt)),Or.name))),new yt(new bi(4e3),Rc(vi,a),ua(Bt,r),new p((s,l)=>new nt(-Ve(l,nt),vi.name))),new yt(new ot,Co(vo,a),new p((s,l)=>new nt(-Math.min(2,Ve(l,nt)),vo.name))),new yt(new ot,Co(Ri,a),VO(Dr,i),ua(St,r),new p((s,l)=>new nt(-Math.min(4,Ve(l,nt)),Ri.name))),new yt(new ot,Co(bo,a),new m((s,l)=>l.some(c=>c instanceof Es)),new p((s,l)=>l.flatMap(c=>c instanceof Es?new nt(-1,bo.name):[])))],"getRules"),vN=u2});var f2,CN,TN=n(()=>{la();Xl();D();T();f2=t((i=vt)=>[new qr(new m(e=>i.getByCity(e).length>0),new p(e=>i.getByCity(e).forEach(r=>i.unregister(r))))],"getRules"),CN=f2});var y2,PN,IN=n(()=>{Va();ti();rs();Ye();la();_u();zm();T();sl();Ku();y2=t((i=L,e=vt)=>[new cn(new bi(500),Rc(xi,e),ua(Zr,i),new p(r=>new ye(r.tilesWorked().filter(o=>o.yields().some(a=>a instanceof ye)).length,xi.name))),...[[ji,1,Qr],[en,1,null]].map(([r,o,a])=>new cn(Co(r,e),ua(a,i),new p(()=>new yl(o,r.name))))],"getRules"),PN=y2});var d2,wN,AN=n(()=>{Va();Ye();la();_u();ti();T();$a();rs();Bf();Ku();ko();d2=t((i=L,e=vt)=>[...[[Li,lr,1,pr]].map(([r,o,a,s])=>new em(new ot,Rc(r,e),ua(s,i),new p((l,c)=>new o(Ve(c,o)*a,r.name)))),...[[sn,lr,.5,null]].map(([r,o,a,s])=>new em(new ot,Co(r,e),ua(s,i),new p((l,c)=>new o(Ve(c,o)*a,r.name))))],"getRules"),wN=d2});var JO,$O,uT=n(()=>{U();JO=class extends g{};t(JO,"Obsolete");$O=JO});var g2,BN,GN=n(()=>{ti();Va();Ye();M();la();Dd();D();T();uT();g2=t((i=L,e=f,r=vt)=>[new Bl(new m(()=>r.some(o=>o instanceof Oi)),new m((o,a)=>{let[s]=r.filter(c=>c instanceof Oi).map(c=>c.city().player());return!i.getByPlayer(s).completed(a.sourceClass())}),new m((o,a)=>i.filter(s=>s.completed(a.sourceClass())).length>=3),new p((o,a)=>{let[s]=r.filter(c=>c instanceof Oi).map(c=>c.city().player());return i.getByPlayer(s).addAdvance(a.sourceClass())})),...[[xi,Zr],[Li,pr],[Oi,Mr],[rn,Br],[ji,Qr],[on,Di],[zi,Mi],[Ri,St],[Or,Ft],[an,St],[vi,Bt]].map(([o,a])=>new Bl(new m(()=>r.entries().some(s=>s instanceof o)),new m((s,l)=>l instanceof a),new p(()=>{let[s]=r.filter(l=>l instanceof o);e.process($O,s,s.city())})))],"getRules"),BN=g2});var h2,MN,UN=n(()=>{Va();Ye();la();D();T();$a();ti();ep();Ba();ip();Ku();_u();h2=t((i=vt,e=L)=>[new Uc(new ot,new m((r,o)=>o instanceof wo),new m(r=>r instanceof We),Co(zi,i),qO(Mi,e),new p((r,o)=>o.add(1))),new Uc(new ot,new m((r,o)=>o instanceof wo),new m(r=>r instanceof We),Co(nn,i),new p((r,o)=>o.add(1)))],"getRules"),MN=h2});var x2,DN,EN=n(()=>{X();T();uT();x2=t((i=I)=>[new $O(new p((e,r)=>{i.emit("wonder:obsolete",e,r)}))],"getRules"),DN=x2});var O2={};var kN=n(()=>{yN();gN();xN();bN();TN();IN();AN();M();GN();UN();EN();f.register(...fN(),...dN(),...hN(),...vN(),...CN(),...PN(),...wN(),...BN(),...MN(),...DN())});var FN=w(SN=>{"use strict";Object.defineProperty(SN,"__esModule",{value:!0});uN();kN()});var R2,YN,NN=n(()=>{Fo();Ga();Ye();ti();Ii();lT();D();R2=t((i=L,e=He)=>[...[[Fe,Ee,Te,Ne,de,pe],[mt,Ee,Ne,Je],[qe,Jt,Ee,it,Te,Ne,ut,Je,de,ft,It]].map(([r,...o])=>new xc(new m((a,s)=>s===r),new m(a=>o.some(s=>a.terrain()instanceof s)),new m((a,s)=>!e.getByTile(a).some(l=>l instanceof s)))),...[[qe,No,pe]].map(([r,o,...a])=>new xc(new m((s,l)=>l===r),new m(s=>a.some(l=>s.terrain()instanceof l)),new m((s,l)=>!e.getByTile(s).some(c=>c instanceof l)),new m((s,l,c)=>i.getByPlayer(c).completed(o)))),...[[wr,ki,qe,Jt,Ee,it,Te,Ne,ut,Je,de,pe,ft,It]].map(([r,o,a,...s])=>new xc(new m((l,c)=>c===r),new m(l=>s.some(c=>l.terrain()instanceof c)),new m((l,c)=>!e.getByTile(l).some(u=>u instanceof c)),new m(l=>e.getByTile(l).some(c=>c instanceof a)),new m((l,c,u)=>i.getByPlayer(u).completed(o))))],"getRules"),YN=R2});var v2,WN,LN=n(()=>{X();Ga();Ii();Py();D();T();v2=t((i=He,e=I)=>[new ns(new m((r,o)=>i.getByTile(r).every(a=>o.constructor!==a.constructor)),new p((r,o)=>i.register(o))),new ns(new p(r=>r.clearYieldCache(null))),new ns(new p((r,o)=>{e.emit("tile-improvement:built",r,o)})),...[[mt,Fe],[Fe,mt]].map(([r,o])=>new ns(new m((a,s)=>s instanceof r),new m(a=>i.getByTile(a).some(s=>s instanceof o)),new p(a=>i.unregister(...i.getByTile(a).filter(s=>s instanceof o)))))],"getRules"),WN=v2});var ZO,QO,fT=n(()=>{Uo();Xi();ZO=class extends et{constructor(){super(Xe)}};t(ZO,"AvailableTerrainFeatureRegistry");QO=new ZO});var b2,jN,zN=n(()=>{fT();M();AR();T();sp();b2=t((i=f,e=QO)=>[new ff(new p(r=>{let o=i.get(Pl);e.entries().forEach(a=>o.filter(s=>s.validate(a,r)).forEach(s=>s.process(a,r)))}))],"getRules"),jN=b2});var or,yT=n(()=>{U();or=class extends g{};t(or,"Distribution")});var C2,HN,_N=n(()=>{Fo();yT();Tr();D();T();C2=t(()=>[new or(new m(i=>i===Jt),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:0,to:.01,fill:!0},{from:.01,to:.02},{from:.98,to:.99},{from:.99,to:1,fill:!0}])),new or(new m(i=>i===Ee),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.4,to:.45},{from:.45,to:.55,coverage:.025,cluster:!0,clusterChance:.1},{from:.55,to:.6}])),new or(new m(i=>i===it),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.05,to:.2},{from:.2,to:.4,cluster:!0,clusterChance:.1,coverage:.1},{from:.4,to:.6},{from:.6,to:.8,cluster:!0,clusterChance:.1,coverage:.1},{from:.8,to:.95}])),new or(new m(i=>i===Te),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{fill:!0}])),new or(new m(i=>i===Ne),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.1,to:.9,path:!0,pathChance:.1,coverage:.06}])),new or(new m(i=>i===ut),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.3,to:.45,cluster:!0,clusterChance:.2,coverage:.08},{from:.55,to:.7,cluster:!0,clusterChance:.2,coverage:.08}])),new or(new m(i=>i===Je),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.01,to:.1,coverage:.3,path:!0},{from:.1,to:.9,path:!0},{from:.9,to:.99,coverage:.3,path:!0}])),new or(new m(i=>i===ht),new m((i,e)=>e.some(r=>r.constructor===Cr)),new p(()=>[{fill:!0}])),new or(new m(i=>i===de),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.01,to:.2,coverage:.3},{from:.2,to:.4},{from:.1,to:.4,cluster:!0},{from:.4,to:.6},{from:.6,to:.8},{from:.6,to:.9,cluster:!0},{from:.8,to:.99,coverage:.3}])),new or(new m(i=>i===pe),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.1,to:.9,coverage:.1,path:!0,pathChance:.5}])),new or(new m(i=>i===ft),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.2,to:.4,cluster:!0},{from:.6,to:.8,cluster:!0}])),new or(new m(i=>i===It),new m((i,e)=>e.some(r=>r instanceof $)),new p(()=>[{from:.01,to:.15,cluster:!0,coverage:.15},{from:.85,to:.99,cluster:!0,coverage:.15}]))],"getRules"),HN=C2});var XO,eR,dT=n(()=>{U();XO=class extends g{};t(XO,"DistributionGroups");eR=XO});var T2,KN,qN=n(()=>{Fo();T();dT();T2=t(()=>[new eR(new p(()=>[ht,Te,ft,Je,ut,Ne,it,Ee,de,It,Jt,pe]))],"getRules"),KN=T2});var P2,VN,JN=n(()=>{Fo();ou();Cn();sp();P2=t((i=Tt)=>[...[[Fn,.2,Ne],[Yn,.2,ht],[io,.2,it,It],[Nn,.2,ut],[Wn,.2,Je],[Bo,.2,de],[oo,.2,Ee],[Ln,.2,ft],[jn,.2,Jt],[Pn,.5,Te,pe]].flatMap(([r,o,...a])=>a.flatMap(s=>wP(s,r,o,i)))],"getRules"),VN=P2});var tR,rR,$N=n(()=>{U();tR=class extends g{};t(tR,"Pillaged");rR=tR});var I2,ZN,QN=n(()=>{X();Ii();$N();D();T();I2=t((i=He,e=I)=>[new rR(new m((r,o)=>i.getByTile(r).includes(o)),new p((r,o)=>i.unregister(o))),new rR(new p(r=>r.clearYieldCache(null))),new rR(new p((r,o)=>{e.emit("tile-improvement:pillaged",r,o)}))],"getRules"),ZN=I2});var gT,hT,xT,w2,A2,B2,G2,XN,eW=n(()=>{KC();X();es();Fo();T();ZC();gT=new Map,hT=new Map,xT=new Map,w2=t((i,e=null)=>(hT.has(i)||hT.set(i,i.score(e,[[te,8],[Q,3],[ye,1]])),hT.get(i)),"tileScore"),A2=t((i,e=null)=>(xT.has(i)||xT.set(i,i.getSurroundingArea().entries().reduce((r,o)=>r+w2(o,e),0)),xT.get(i)),"areaScore"),B2=t((i,e=I)=>{if(!gT.has(i)){e.emit("world:generate-start-tiles");let r=i.entries().filter(o=>[Te,de,pe].some(a=>o.terrain()instanceof a)).map(o=>({tile:o,score:A2(o)})).sort(({score:o},{score:a})=>a-o).map(({tile:o})=>o);gT.set(i,r),e.emit("world:start-tiles",r)}return gT.get(i)},"pickStartTiles"),G2=t((i=rO,e=I,r=()=>Math.random())=>[new fO(new p((o,a,s)=>{if(e.option("earth",!1))try{return i.getStartTileByCivilizationAndWorld(a.civilization().sourceClass(),o)}catch{s.push(...i.entries().map(u=>u.startTileForMap(o)))}let l=B2(o,e);return l.forEach(c=>{s.some(u=>u.distanceFrom(c)<=4)&&l.splice(l.indexOf(c),1)}),l[Math.floor(l.length*r())]}))],"getRules"),XN=G2});var iR,vc,oR=n(()=>{Zx();Uo();iR=class extends et{constructor(){super($x)}};t(iR,"GeneratorRegistry");vc=new iR});var nR,aR,OT=n(()=>{U();nR=class extends g{};t(nR,"PickGenerator");aR=nR});var sR,lR,RT=n(()=>{U();sR=class extends g{};t(sR,"Start");lR=sR});var mR,tW,rW=n(()=>{J();M();sO();Re();Ki();mR=class extends S{#e;#t;#r;#i=new rl(fe);#o;constructor(e,r=f){super(),this.#e=e,this.#t=e.height(),this.#o=e.width(),this.#r=r,this.addKey("height","tiles","width")}build(){return new Promise(e=>{this.#e.generate().then(r=>{r.forEach((o,a)=>{let s=new fe(a%this.#o,Math.floor(a/this.#o),o,this,this.#r);this.#i.register(s)}),this.#r.process(Ll,this),e(this)})})}entries(){return this.#i.entries()}filter(e){return this.entries().filter(e)}forEach(e){return this.#i.forEach(e)}get(e,r){return this.entries()[this.#e.coordsToIndex(e,r)]}height(){return this.#t}includes(e){return this.#i.includes(e)}map(e){return this.#i.map(e)}register(...e){this.#i.register(...e)}tiles(){return this.entries()}width(){return this.#o}};t(mR,"World");tW=mR});var M2,iW,oW=n(()=>{oR();M();X();T();OT();RT();rW();M2=t((i=f,e=vc,r=I)=>[new lR(new p(()=>{let[o]=i.process(aR),a=new o(parseInt(r.option("height",100),10),parseInt(r.option("width",160),10),{landCoverage:parseFloat(r.option("landCoverage",.4)),landSize:parseFloat(r.option("landSize",.2)),maxIterations:parseInt(r.option("maxIterations",20),10)});new tW(a,i).build()}))],"getRules"),iW=M2});var U2,nW,aW=n(()=>{ou();Fo();es();Ga();oa();zn();Cn();Ii();D();T();MR();U2=t((i=He,e=Tt,r=At)=>[...[[te,it,1],[te,Te,2],[te,Ne,1],[te,ut,1],[te,ht,1],[te,de,1],[te,pe,2],[te,ft,1],[te,It,1],[Q,Ee,1],[Q,it,2],[Q,Je,1],[Q,de,1]].map(([o,a,s])=>new _i(new m(l=>l.terrain()instanceof a),new p(()=>new o(s,a.name)))),...[[Q,Fn,2],[te,Yn,1],[te,io,1],[ye,Nn,2],[ye,Wn,3],[Q,Bo,1],[te,oo,2],[Q,Ln,3],[te,jn,2],[Q,Pn,1]].map(([o,a,s])=>new _i(new m(l=>e.getByTerrain(l.terrain()).some(c=>c instanceof a)),new p(()=>new o(s,a.name)))),...[[Q,Fn,1],[te,Yn,1],[te,io,1],[ye,Nn,2],[ye,Wn,2],[Q,Bo,1],[te,oo,1],[Q,Ln,1],[te,jn,1]].map(([o,a,s])=>new _i(new m((l,c)=>{if(!c)return!1;try{return r.getByPlayer(c).is(Yt,Ot,Rt,Gt)}catch{return!1}}),new m(l=>e.getByTerrain(l.terrain()).some(c=>c instanceof a)),new p(()=>new o(s,a.name)))),new _i(new m(o=>o.terrain()instanceof ht),new p(()=>new ye(2,ht.name))),new _i(new m(o=>o.terrain()instanceof pe),new p(()=>new ye(1))),new _i(new m((o,a)=>{if(!a)return!1;try{return r.getByPlayer(a).is(Ot,Gt)}catch{return!1}}),new m(o=>o.terrain()instanceof pe||o.terrain()instanceof ht),new p(()=>new ye(1,ht.name))),...[[Ee,te,Fe,1],[Ee,Q,mt,1],[Ne,te,Fe,1],[Ne,Q,mt,2],[Je,Q,mt,1],[de,te,Fe,1]].map(([o,a,s,l])=>new _i(new m(c=>c.terrain()instanceof o),new m(c=>i.getByTile(c).some(u=>u instanceof s)),new p(()=>new a(l,s.name)))),...[[Ee,Q,mt,1],[Te,te,Fe,1],[Ne,Q,mt,1],[Je,Q,mt,1],[pe,te,Fe,1]].map(([o,a,s,l])=>new _i(new m((c,u)=>{if(!u)return!1;try{return r.getByPlayer(u).is(Yt,Ot,Rt,Gt)}catch{return!1}}),new m(c=>c.terrain()instanceof o),new m(c=>i.getByTile(c).some(u=>u instanceof s)),new p(()=>new a(l,s.name)))),...[Ee,Te,de].map(o=>new _i(new m(a=>a.terrain()instanceof o),new m(a=>i.getByTile(a).some(s=>s instanceof qe)),new p(()=>new ye(1,qe.name)))),...[Ee,Te,de].map(o=>new _i(new m((a,s)=>{if(!s)return!1;try{return r.getByPlayer(s).is(Ot,Gt)}catch{return!1}}),new m(a=>a.terrain()instanceof o),new m(a=>i.getByTile(a).some(s=>s instanceof qe)),new p(()=>new ye(1,qe.name))))],"getRules"),nW=U2});var D2,sW,lW=n(()=>{es();Ii();D();T();$a();Ga();GR();D2=t((i=He)=>[...[[te,.5],[Q,.5],[ye,.5]].map(([e,r])=>new gf(new Ja,new m((o,a,s)=>s.some(l=>l instanceof e)),new m(o=>i.getByTile(o).some(a=>a instanceof wr)),new p((o,a,s)=>{let l=s.filter(c=>c instanceof e).reduce((c,u)=>c+u.value(),0);s.push(new e(Math.floor(l*r),wr.name))})))],"getRules"),sW=D2});var E2,mW,pW=n(()=>{X();oR();Xx();T();OT();E2=t((i=vc,e=I,r=()=>Math.random())=>[new aR(new p(()=>{if(e.option("earth",!1))return mc;let o=i.entries();if(o.length===0)throw new TypeError("No available `World` generators.");return o[Math.floor(o.length*r())]}))],"getRules"),mW=E2});var k2={};var cW=n(()=>{NN();LN();zN();_N();qN();JN();M();QN();eW();oW();aW();lW();pW();f.register(...YN(),...WN(),...jN(),...HN(),...KN(),...VN(),...ZN(),...XN(),...iW(),...nW(),...sW(),...mW())});var pR,cR,vT=n(()=>{Uo();Fm();pR=class extends et{constructor(){super(ha)}};t(pR,"TerrainRegistry");cR=new pR});var S2={};var uW=n(()=>{Fo();vT();cR.register(Jt,Ee,it,Te,Ne,ut,Je,ht,de,pe,ft,It)});var F2={};var fW=n(()=>{ou();fT();QO.register(Fn,Yn,io,Nn,Wn,Bo,oo,Ln,jn,Pn)});var dW=w(yW=>{"use strict";Object.defineProperty(yW,"__esModule",{value:!0});cW();uW();fW()});var Y2,gW,hW=n(()=>{tt();bt();Vr();Ki();Y2=t((i=V)=>[new ee(H,"cities",e=>i.getByPlayer(e)),new ee(fe,"city",e=>i.getByTile(e))],"getAdditionalData"),gW=Y2});var N2,xW,OW=n(()=>{Ci();bt();Ki();N2=t((i=Me)=>[new ee(fe,"workedBy",e=>i.getByTile(e)?.city()??null)],"getAdditionalData"),xW=N2});var W2={};var RW=n(()=>{hW();Et();OW();ae.register(...gW(),...xW())});var bW=w(vW=>{"use strict";Object.defineProperty(vW,"__esModule",{value:!0});RW()});var L2,CW,TW=n(()=>{Pa();bt();xa();L2=t((i=Vt)=>[new ee(Ze,"build",e=>i.getByCity(e))],"getAdditionalData"),CW=L2});var j2={};var PW=n(()=>{TW();Et();ae.register(...CW())});var wW=w(IW=>{"use strict";Object.defineProperty(IW,"__esModule",{value:!0});PW()});var z2,AW,BW=n(()=>{kt();bt();xa();z2=t((i=re)=>[new ee(Ze,"growth",e=>i.getByCity(e))],"getAdditionalData"),AW=z2});var H2={};var GW=n(()=>{Et();BW();ae.register(...AW())});var UW=w(MW=>{"use strict";Object.defineProperty(MW,"__esModule",{value:!0});GW()});var _2,DW,EW=n(()=>{M();bt();Jh();xa();qp();_2=t((i=f)=>[new ee(Ze,"civilDisorder",e=>i.process(La,e,e.yields()).some(r=>r)),new ee(Ze,"celebrateLeader",e=>i.process(Jp,e,e.yields()).some(r=>r))],"getAdditionalData"),DW=_2});var K2={};var kW=n(()=>{EW();Et();ae.register(...DW())});var FW=w(SW=>{"use strict";Object.defineProperty(SW,"__esModule",{value:!0});kW()});var q2,YW,NW=n(()=>{Hr();bt();xa();q2=t((i=Ge)=>[new ee(Ze,"improvements",e=>i.getByCity(e))],"getAdditionalData"),YW=q2});var V2={};var WW=n(()=>{Et();NW();ae.register(...YW())});var jW=w(LW=>{"use strict";Object.defineProperty(LW,"__esModule",{value:!0});WW()});var J2,zW,HW=n(()=>{Fl();bt();Ki();J2=t((i=Ai)=>[new ee(fe,"goodyHut",e=>i.getByTile(e))],"getAdditionalData"),zW=J2});var $2={};var _W=n(()=>{Et();HW();ae.register(...zW())});var qW=w(KW=>{"use strict";Object.defineProperty(KW,"__esModule",{value:!0});_W()});var Z2,VW,JW=n(()=>{zn();bt();Vr();Z2=t((i=At)=>[new ee(H,"government",e=>i.getByPlayer(e))],"getAdditionalData"),VW=Z2});var Q2={};var $W=n(()=>{JW();Et();ae.register(...VW())});var QW=w(ZW=>{"use strict";Object.defineProperty(ZW,"__esModule",{value:!0});$W()});var X2,XW,eL=n(()=>{wi();bt();Vr();X2=t((i=ne)=>[new ee(H,"world",e=>i.getByPlayer(e))],"getAdditionalData"),XW=X2});var eq={};var tL=n(()=>{Et();eL();ae.register(...XW())});var iL=w(rL=>{"use strict";Object.defineProperty(rL,"__esModule",{value:!0});tL()});var tq,oL,nL=n(()=>{Ye();bt();Vr();tq=t((i=L)=>[new ee(H,"research",e=>i.getByPlayer(e))],"getAdditionalData"),oL=tq});var rq={};var aL=n(()=>{Et();nL();ae.register(...oL())});var lL=w(sL=>{"use strict";Object.defineProperty(sL,"__esModule",{value:!0});aL()});var iq,mL,pL=n(()=>{Mm();bt();Vr();iq=t((i=Xo)=>[new ee(H,"spaceship",e=>i.getActiveByPlayer(e))],"getAdditionalData"),mL=iq});var oq={};var cL=n(()=>{Et();pL();ae.register(...mL())});var fL=w(uL=>{"use strict";Object.defineProperty(uL,"__esModule",{value:!0});cL()});var nq,yL,dL=n(()=>{Cn();bt();Fm();nq=t((i=Tt)=>[new ee(ha,"features",e=>i.getByTerrain(e))],"getAdditionalData"),yL=nq});var aq={};var gL=n(()=>{Et();dL();ae.register(...yL())});var xL=w(hL=>{"use strict";Object.defineProperty(hL,"__esModule",{value:!0});gL()});var sq,OL,RL=n(()=>{Ii();bt();Ki();sq=t((i=He)=>[new ee(fe,"improvements",e=>i.getByTile(e))],"getAdditionalData"),OL=sq});var lq={};var vL=n(()=>{Et();RL();ae.register(...OL())});var CL=w(bL=>{"use strict";Object.defineProperty(bL,"__esModule",{value:!0});vL()});var mq,TL,PL=n(()=>{Hu();bt();Vr();mq=t((i=Kl)=>[new ee(H,"rates",e=>i.getByPlayer(e))],"getAdditionalData"),TL=mq});var pq={};var IL=n(()=>{Et();PL();ae.register(...TL())});var AL=w(wL=>{"use strict";Object.defineProperty(wL,"__esModule",{value:!0});IL()});var cq,BL,GL=n(()=>{M();bt();Xc();eu();cq=t((i=f)=>[new ee(Ml,"spendCost",e=>i.process(Eo,e))],"getAdditionalData"),BL=cq});var uq,ML,UL=n(()=>{fm();bt();Vr();uq=t((i=ro)=>[new ee(H,"treasuries",e=>i.getByPlayer(e))],"getAdditionalData"),ML=uq});var fq={};var DL=n(()=>{Et();GL();UL();ae.register(...BL(),...ML())});var kL=w(EL=>{"use strict";Object.defineProperty(EL,"__esModule",{value:!0});DL()});var uR,SL,FL=n(()=>{U();uR=class extends g{};t(uR,"End");SL=uR});var yq,YL,NL=n(()=>{X();M();at();FL();RT();nT();yq=t((i=f,e=I,r=Z)=>[["engine:start",()=>{i.process(lR)}],...["game:start","turn:end"].map(o=>[o,()=>{e.emit("turn:start",r.increment())}]),["turn:end",()=>{i.process(SL,r)}],["turn:start",()=>{i.process(DO,r)}]],"getEvents"),YL=yq});var dq={};var WL=n(()=>{X();NL();[...YL()].forEach(([i,e])=>{I.on(i,e)})});var jL=w(LL=>{"use strict";Object.defineProperty(LL,"__esModule",{value:!0});WL()});var gq,zL,HL=n(()=>{Ke();bt();xa();Vr();Ki();gq=t((i=_)=>[new ee(Ze,"units",e=>i.getByCity(e)),new ee(H,"units",e=>i.getByPlayer(e,!0)),new ee(fe,"units",e=>i.getByTile(e))],"getAdditionalData"),zL=gq});var hq={};var _L=n(()=>{Et();HL();ae.register(...zL())});var qL=w(KL=>{"use strict";Object.defineProperty(KL,"__esModule",{value:!0});_L()});var xq,VL,JL=n(()=>{ls();bt();os();xq=t((i=Ar)=>[new ee(Ue,"improvements",e=>i.getByUnit(e))],"getAdditionalData"),VL=xq});var Oq={};var $L=n(()=>{Et();JL();ae.register(...VL())});var QL=w(ZL=>{"use strict";Object.defineProperty(ZL,"__esModule",{value:!0});$L()});var fR,XL,ej=n(()=>{Uo();tf();fR=class extends et{constructor(){super(Vl)}};t(fR,"AIClientRegistry");XL=new fR});var Rq={};var tj=n(()=>{ej();Mp();XL.register(Wa)});var vq,rj,ij=n(()=>{Ta();Ke();Ql();D();T();Mp();vq=t((i=_,e=qt)=>[new Pr(new m((r,o)=>e.getByPlayer(o)instanceof Wa),new p((r,o,a)=>e.getByPlayer(o).cityLost(r,a,!1)))],"getRules"),rj=vq});var bq,oj,nj=n(()=>{Ta();Ke();D();Xl();T();Mp();bq=t((i=_,e=qt)=>[new qr(new m(r=>e.getByPlayer(r.player())instanceof Wa),new p((r,o)=>e.getByPlayer(r.player()).cityLost(r,o,!0)))],"getRules"),oj=bq});var Cq,aj,sj=n(()=>{Ta();Ke();D();Dc();T();Mp();Cq=t((i=_,e=qt)=>[new gn(new m(r=>e.getByPlayer(r.player())instanceof Wa),new p((r,o)=>e.getByPlayer(r.player()).unitDestroyed(r,o&&o.player())))],"getRules"),aj=Cq});var Tq={};var lj=n(()=>{M();ij();nj();sj();f.register(...rj(),...aj(),...oj())});var pj=w(mj=>{"use strict";Object.defineProperty(mj,"__esModule",{value:!0});tj();lj()});var yR,cj,uj=n(()=>{yT();Zx();Tr();M();vT();dT();_C();yR=class extends lc{#e;#t;#r;#i;#o;#a;#n;#l;#s;#m;constructor(e=100,r=160,o={},a=f,s=cR,l=()=>Math.random()){super(e,r);let{landCoverage:c=.4,landSize:u=.2,maxIterations:y=10,clusterChance:h=.05,coverage:G=.25,pathChance:Y=.05}=o;this.#e=c,this.#t=u,this.#r=y,this.#i=h,this.#o=G,this.#a=Y,this.#s=a,this.#m=s,this.#l=l,this.#n=new Array(this.height()*this.width()).fill(0).map(()=>new Cr)}async generateIslands(){let e=this.height(),r=this.width(),o=this.#t+this.#l()*.2,a=this.#e,s=this.#r,l=Math.ceil(e*r/100*o),c=new Array(e*r).fill(0);for(;c.length===0||c.filter(u=>u===1).length/c.length<a;){let u={},y=[],h=[],G=Math.floor(e*r*Math.random()),Y=t(d=>{d in u||(u[d]=0),u[d]++},"flagAsSeen");for(c[G]=1,y.push(G),Y(G),h.push(...Gm(e,r,G));h.length;){let d=h.shift();if((u[d]||0)<=s&&(Math.random()>.3?(c[d]=1,y.push(d),Gm(e,r,d).filter(O=>h.indexOf(O)===-1).forEach(O=>h.push(O))):Gm(e,r,d).forEach(O=>{let x=h.indexOf(O);x>-1&&h.splice(x,1)}),Y(d)),y.length>l||c.filter(O=>O===1).length/c.length>=a)break}if(c.filter(d=>d===1).length/c.length>=a)break}this.#n=c.map(u=>u===1?new $:new Cr)}generate(){return this.generateIslands().then(()=>this.populateTerrain().then(()=>this.#n))}getNeighbours(e,r=!0){return Gm(this.height(),this.width(),e,r)}populateTerrain(){return new Promise(e=>{let r=this.#s.get(or);this.#s.get(eR).filter(o=>o.validate()).map(o=>{let a=o.process();if(!a)throw new TypeError("Unexpected data from DistributionGroups.");return a}).forEach(o=>o.forEach(a=>r.filter(s=>s.validate(a,this.#n)).map(s=>{let l=s.process(a,this.#n);if(!l)throw new TypeError("Unexpected data from Distribution.");return l}).forEach(s=>s.forEach(({cluster:l=!1,clusterChance:c=this.#i,coverage:u=this.#o,fill:y=!1,from:h=0,path:G=!1,pathChance:Y=this.#a,to:d=1})=>{let O=Object.keys(this.#n).map(R=>parseInt(R,10)).filter(R=>this.#n[R]instanceof a.__proto__).filter(R=>R>=h*this.height()*this.width()&&R<=d*this.height()*this.width());if(y){O.forEach(R=>{this.#n[R]=new a});return}let x=O.length*u;for(;x>0;){let R=O[Math.floor(this.#l()*O.length)];if(this.#n[R]=new a,x--,l){let B=this.getNeighbours(R).filter(N=>!(this.#n[N]instanceof a));for(;B.length&&x>0;){let N=B.shift();c>=this.#l()/this.distanceFrom(R,N)&&(this.#n[N]=new a,x--,B.push(...this.getNeighbours(N).filter(Ie=>!(this.#n[Ie]instanceof a)).filter(Ie=>this.#n[Ie]instanceof a.__proto__).filter(Ie=>!B.includes(Ie))))}}if(G){let B=R;for(;Y>=this.#l();){let N=this.getNeighbours(B).filter(Ie=>this.#n[Ie]instanceof a.__proto__&&!(this.#n[Ie]instanceof a));B=N[Math.floor(this.#l()*N.length)],this.#n[B]=new a,x--}}}})))),e()})}};t(yR,"BaseGenerator");cj=yR});var Pq={};var fj=n(()=>{uj();oR();vc.register(cj)});var dj=w(yj=>{"use strict";Object.defineProperty(yj,"__esModule",{value:!0});fj()});var Iq={};var fot,yot,dot,got,hot,xot,Oot,Rot,vot,bot,Cot,Tot,Pot,Iot,wot,Aot,Bot,Got,Mot,Uot,Dot,Eot,kot,Sot,Fot,Yot,Not,Wot,Lot,jot,zot,Hot,_ot,Kot,qot,Vot,Jot,$ot,Zot,Qot,Xot,ent,tnt,rnt,int,ont,nnt,ant,snt,lnt,mnt,pnt,cnt,unt,fnt,ynt,dnt,gnt,hnt,xnt,Ont,Rnt,vnt,bnt,Cnt,Tnt,Pnt,Int,wnt,Ant,Bnt,Gnt,Mnt,Unt,Dnt,Ent,knt,Snt,Fnt,Ynt,Nnt,Wnt,Lnt,jnt,znt,Hnt,_nt,Knt,qnt,Vnt,Jnt,$nt,Znt,Qnt,Xnt,eat,tat,rat,iat,oat,nat,aat,sat,lat,mat,pat,cat,uat,fat,yat,dat,gat,hat,xat,Oat,Rat,vat,bat,gj=n(()=>{"use strict";fot=A(lB()),yot=A(uB()),dot=A(gB()),got=A(RB()),hot=A(TB()),xot=A(AB()),Oot=A(UB()),Rot=A(SB()),vot=A(WB()),bot=A(HB()),Cot=A(VB()),Tot=A(QB()),Pot=A(rG()),Iot=A(aG()),wot=A(mG()),Aot=A(uG()),Bot=A(dG()),Got=A(xG()),Mot=A(vG()),Uot=A(TG()),Dot=A(wG()),Eot=A(GG()),kot=A(DG()),Sot=A(SG()),Fot=A(NG()),Yot=A(jG()),Not=A(_G()),Wot=A(VG()),Lot=A(ZG()),jot=A(eM()),zot=A(iM()),Hot=A(aM()),_ot=A(mM()),Kot=A(uM()),qot=A(dM()),Vot=A(xM()),Jot=A(vM()),$ot=A(TM()),Zot=A(wM()),Qot=A(GM()),Xot=A(DM()),ent=A(SM()),tnt=A(NM()),rnt=A(jM()),int=A(_M()),ont=A(VM()),nnt=A(ZM()),ant=A(eU()),snt=A(iU()),lnt=A(aU()),mnt=A(mU()),pnt=A(uU()),cnt=A(dU()),unt=A(xU()),fnt=A(vU()),ynt=A(TU()),dnt=A(wU()),gnt=A(GU()),hnt=A(DU()),xnt=A(SU()),Ont=A(NU()),Rnt=A(jU()),vnt=A(_U()),bnt=A(VU()),Cnt=A(ZU()),Tnt=A(eD()),Pnt=A(iD()),Int=A(aD()),wnt=A(mD()),Ant=A(uD()),Bnt=A(dD()),Gnt=A(xD()),Mnt=A(vD()),Unt=A(TD()),Dnt=A(wD()),Ent=A(GD()),knt=A(DD()),Snt=A(SD()),Fnt=A(ND()),Ynt=A(jD()),Nnt=A(_D()),Wnt=A(UE()),Lnt=A(XE()),jnt=A(C0()),znt=A(Tk()),Hnt=A(Mk()),_nt=A(qk()),Knt=A(rS()),qnt=A(sS()),Vnt=A(BS()),Jnt=A(LS()),$nt=A(CF()),Znt=A(HF()),Qnt=A(A1()),Xnt=A(H1()),eat=A(nY()),tat=A(_Y()),rat=A(FN()),iat=A(dW()),oat=A(bW()),nat=A(wW()),aat=A(UW()),sat=A(FW()),lat=A(jW()),mat=A(qW()),pat=A(QW()),cat=A(iL()),uat=A(lL()),fat=A(fL()),yat=A(xL()),dat=A(CL()),gat=A(AL()),hat=A(kL()),xat=A(jL()),Oat=A(qL()),Rat=A(QL()),vat=A(pj()),bat=A(dj())});vR();bR();Tc();Xu();tf();CR();Kr();IR();xa();Nf();ze();sr();YR();J();var ul,qf=class{constructor(){ie(this,ul,[])}add(e,r,o=null){P(this,ul).push({[e]:{type:"add",index:o,value:r}})}clear(){P(this,ul).splice(0)}remove(e,r=null){P(this,ul).push({[e]:{type:"remove",index:r}})}transferData(){return P(this,ul).slice(0).map(e=>{let r={};return Object.entries(e).forEach(([o,{type:a,index:s,value:l}])=>{r[o]={type:a,index:s,value:typeof l=="function"?l():l}}),r})}update(e,r,o=null){P(this,ul).push({[e]:{type:"update",index:o,value:r}})}};t(qf,"DataQueue"),ul=new WeakMap;var jT=qf;Jf();NR();rs();Gc();qR();ql();lm();Iv();J();var Fc,Yc,nd=class extends ue{constructor(r,o){super();ie(this,Fc,void 0);ie(this,Yc,void 0);le(this,Fc,o),le(this,Yc,r),this.addKey("data","key")}data(){return P(this,Fc)}key(){return P(this,Yc)}};t(nd,"Notification"),Fc=new WeakMap,Yc=new WeakMap;var Pt=nd;kn();Vr();Av();dd();var gd=class extends Error{constructor(e,r,o){super(e)}};t(gd,"RetryFailed");var mI=gd;var Nc,Wc,fp,Lc,yp,jc,zc,hd=class{constructor(e,r=5,o=100){ie(this,Nc,0);ie(this,Wc,void 0);ie(this,fp,void 0);ie(this,Lc,void 0);ie(this,yp,void 0);ie(this,jc,void 0);ie(this,zc,void 0);le(this,fp,e),le(this,Lc,r),le(this,yp,setInterval(()=>this.run(),o)),le(this,Wc,new Promise((a,s)=>{le(this,zc,a),le(this,jc,s)}))}run(){if(++TT(this,Nc)._>P(this,Lc)){clearInterval(P(this,yp)),P(this,jc).call(this,new mI("Retry failed.",P(this,fp),P(this,Nc)));return}P(this,fp).call(this)&&(clearInterval(P(this,yp)),P(this,zc).call(this))}then(){return P(this,Wc)}};t(hd,"Retryable"),Nc=new WeakMap,Wc=new WeakMap,fp=new WeakMap,Lc=new WeakMap,yp=new WeakMap,jc=new WeakMap,zc=new WeakMap;var pI=hd;mm();Gv();J();var Hc,_c,Kc,Od=class extends ue{constructor(r,o,a){super();ie(this,Hc,void 0);ie(this,_c,void 0);ie(this,Kc,void 0);le(this,Hc,r),le(this,_c,o),le(this,Kc,a),this.addKey("player","turn","year")}player(){return P(this,Hc)}turn(){return P(this,_c)}year(){return P(this,Kc)}};t(Od,"TransferObject"),Hc=new WeakMap,_c=new WeakMap,Kc=new WeakMap;var uI=Od;Ki();var Rd=class extends Error{};t(Rd,"Timeout");var fI=Rd;os();J();kt();var dp,gp,hp,qc,Mv=class extends ue{constructor(r,o,a,s){super();ie(this,dp,void 0);ie(this,gp,void 0);ie(this,hp,{size:0});ie(this,qc,void 0);le(this,dp,r),le(this,gp,a),P(this,hp).size=s,le(this,qc,o),this.addKey("_","growth","name","player","tile")}static fromCity(r){let o=re.getByCity(r);return new Mv(r.name(),r.tile(),r.player(),o.size())}_(){return"City"}name(){return P(this,dp)}player(){return P(this,gp)}growth(){return P(this,hp)}tile(){return P(this,qc)}update(r){let o=re.getByCity(r);le(this,dp,r.name()),le(this,gp,r.player()),P(this,hp).size=o.size()}},bd=Mv;t(bd,"City"),dp=new WeakMap,gp=new WeakMap,hp=new WeakMap,qc=new WeakMap;var yI=bd;J();var Vc,Uv=class extends ue{constructor(r){super();ie(this,Vc,void 0);le(this,Vc,r),this.addKey("_","civilization")}static fromPlayer(r){return new Uv(r.civilization())}_(){return"Player"}civilization(){return P(this,Vc)}},Cd=Uv;t(Cd,"Player"),Vc=new WeakMap;var dI=Cd;J();var Jc,$c,Zc,Dv=class extends ue{constructor(r,o,a){super();ie(this,Jc,void 0);ie(this,$c,void 0);ie(this,Zc,void 0);le(this,Jc,r),le(this,$c,o),le(this,Zc,a),this.addKey("_","tile","player")}static fromUnit(r){return new Dv(r.constructor.name,r.tile(),r.player())}_(){return P(this,Jc)}player(){return P(this,Zc)}tile(){return P(this,$c)}},Td=Dv;t(Td,"Unit"),Jc=new WeakMap,$c=new WeakMap,Zc=new WeakMap;var gI=Td;Se();E();tt();Ta();Op();X();us();Al();Ye();fm();wi();M();at();Ke();Wv();Dl();var Gj=t((i,e)=>new Promise((r,o)=>setTimeout(()=>e===void 0?r():o(e),i)),"awaitTimeout"),DI=t(i=>i instanceof ue?{"#ref":i.id()}:i,"referenceObject"),_e=t((...i)=>e=>i.some(r=>e instanceof r)?DI(e):e,"filterToReference"),UI=t((...i)=>e=>i.some(r=>e instanceof r)?e:DI(e),"filterToReferenceAllExcept"),Mj=15,Lv=new Map,jv=new Map,tu=new Map,be,se,dm,mg,pg,ru,So,lg=class extends nl{constructor(r,o,a,s){super(r);ie(this,be,t((r=o=>o)=>o=>o instanceof H&&o!==this.player()?(Lv.has(o)||Lv.set(o,dI.fromPlayer(o)),Lv.get(o)):o instanceof Ue&&o.player()!==this.player()?(jv.has(o)||jv.set(o,gI.fromUnit(o)),jv.get(o)):o instanceof Ze&&o.player()!==this.player()?(tu.has(o)||tu.set(o,yI.fromCity(o)),tu.get(o)):o instanceof fe?ne.getByPlayer(this.player()).get(o.x(),o.y()):o instanceof ke?{_:o.constructor.name}:r(o),"#dataFilter"));ie(this,se,new jT);ie(this,dm,void 0);ie(this,mg,void 0);ie(this,pg,void 0);ie(this,ru,!1);ie(this,So,void 0);le(this,dm,new Zf),le(this,So,o),le(this,pg,a),le(this,mg,s),P(this,So).receive("action",(...l)=>P(this,dm).emit("action",...l)),P(this,So).receive("cheat",({name:l,value:c})=>{if(l==="RevealMap"){let u=ne.getByPlayer(this.player()),[y]=u.entries();y.tile().map().entries().forEach(h=>{if(u.includes(h))return;u.register(h);let G=u.getByTile(h);P(this,se).add(u.id(),()=>h.toPlainObject(P(this,be).call(this)),`entries[${u.entries().indexOf(G)}]`)})}if(l==="GrantAdvance"){let[u]=b.filter(h=>h.name===c),y=L.getByPlayer(this.player());if(!u||y.completed(u))return;y.addAdvance(u),P(this,se).add(y.id(),y.toPlainObject(P(this,be).call(this,_e(H))))}if(l==="GrantGold"){let u=ro.getByPlayerAndType(this.player(),Qe);u.add(c),P(this,se).add(u.id(),u.toPlainObject(P(this,be).call(this,_e(H))))}if(l==="ModifyUnit"){let{unitId:u,properties:y}=c,[h]=_.getBy("id",u);if(!h)return;["attack","defence","moves","movement","visibility"].forEach(G=>{G in y&&h[G]().set(y[G])}),P(this,se).add(h.id(),h.toPlainObject(P(this,be).call(this,_e(H))))}this.sendPatchData()}),I.on("engine:plugins:load:failed",(l,c)=>{console.log(l+" failed to load"),console.error(c)}),I.on("player:visibility-changed",(l,c)=>{if(c!==this.player())return;let u=ne.getByPlayer(this.player()),y=u.getByTile(l);if(y===null){new pI(()=>{let h=u.getByTile(l);return h===null?!1:(P(this,se).add(u.id(),()=>l.toPlainObject(P(this,be).call(this,_e(H))),`tiles[${u.entries().indexOf(h)}]`),!0)},2,20);return}P(this,se).add(u.id(),()=>y.toPlainObject(P(this,be).call(this,_e(H))),`tiles[${u.entries().indexOf(y)}]`)}),["unit:created","unit:defeated"].forEach(l=>{I.on(l,c=>{let u=ne.getByPlayer(this.player()),y=u.getByTile(c.tile());if(!!y&&(P(this,se).update(y.id(),()=>y.toPlainObject(P(this,be).call(this,_e(H)))),c.player()===this.player())){if(l==="unit:created"){let h=_.getByPlayer(this.player()),G=h.indexOf(c),Y=_.getByCity(c.city()),d=Y.indexOf(c),O=_.getByTile(c.tile()),x=O.indexOf(c);P(this,se).add(r.id(),()=>c.toPlainObject(P(this,be).call(this,_e(fe,H,cp,Ze))),`units[${G}]`),P(this,se).add(y.id(),()=>c.toPlainObject(P(this,be).call(this,_e(Ue))),`units[${x}]`),c.city()!==null&&P(this,se).add(c.city().id(),()=>c.toPlainObject(P(this,be).call(this,_e(Ue))),`units[${d}]`);return}P(this,se).update(this.player().id(),()=>this.player().toPlainObject(P(this,be).call(this,UI(H,Ue,he))))}})}),["unit:destroyed"].forEach(l=>{I.on(l,(c,u)=>{c.player()===this.player()&&c.city()!==null&&P(this,se).update(c.city().id(),()=>c.city().toPlainObject(P(this,be).call(this,_e(ya,tm,z,H,cp,fe,Ue))))})}),["unit:moved"].forEach(l=>{I.on(l,(c,u)=>{let y=ne.getByPlayer(this.player()),h=y.getByTile(u.from()),G=y.getByTile(u.to());!h&&!G||(h&&P(this,se).update(h.id(),()=>h.toPlainObject(P(this,be).call(this,_e(H,Ze)))),G&&P(this,se).update(G.id(),()=>G.toPlainObject(P(this,be).call(this,_e(H,Ze)))),c.player()===this.player()&&c.city()!==null&&P(this,se).update(c.city().id(),()=>c.city().toPlainObject(P(this,be).call(this,_e(ya,tm,z,H,cp,fe,Ue)))),this.sendPatchData())})}),["tile-improvement:built","tile-improvement:pillaged"].forEach(l=>{I.on(l,c=>{let u=ne.getByPlayer(this.player()),y=u.getByTile(c);y&&P(this,se).update(y.id(),()=>y.toPlainObject(P(this,be).call(this,_e(H,Ze))))})}),I.on("city:captured",(l,c,u)=>{if(u===this.player()){V.getByPlayer(this.player()).indexOf(l)!==-1&&P(this,se).update(this.player().id(),()=>this.player().toPlainObject(P(this,be).call(this,UI(H,he)))),this.sendNotification(new Pt("City.captured-from-us",{city:l,capturingPlayer:c,originalPlayer:u}));return}if(c===this.player()){this.sendNotification(new Pt("City.captured-by-us",{city:l,capturingPlayer:c,originalPlayer:u}));return}}),["city:created","city:captured","city:destroyed","city:grow","city:shrink"].forEach(l=>{I.on(l,c=>{let u=ne.getByPlayer(this.player()),y=u.getByTile(c.tile());if(!!y){if(tu.has(c)){let h=tu.get(c);h.update(c),P(this,se).update(h.id(),()=>h.toPlainObject(P(this,be).call(this,_e(fe,Ue,H))))}P(this,se).update(y.id(),()=>y.toPlainObject(P(this,be).call(this,_e(H))))}})}),I.on("city:shrink",l=>{l.player()===this.player()&&this.sendNotification(new Pt("City.shrink",{city:l}))}),I.on("unit:unsupported",(l,c)=>{l.player()===this.player()&&this.sendNotification(new Pt("City.unit-unsupported",{city:l,unit:c}))}),I.on("city:unsupported-improvement",(l,c)=>{l.player()===this.player()&&this.sendNotification(new Pt("City.improvement-unsupported",{city:l,cityImprovement:c}))}),I.on("city:food-storage-exhausted",l=>{l.player()===this.player()&&this.sendNotification(new Pt("City.food-storage-exhausted",{city:l}))}),I.on("city:building-complete",(l,c)=>{let u=ne.getByPlayer(this.player());if(l.city().player()!==this.player()&&c instanceof Pe){this.sendNotification(new Pt(u.getByTile(l.city().tile())?"Wonder.building-complete.other-player.known":"Wonder.building-complete.other-player.unknown",{cityBuild:l,build:c}));return}if(l.city().player()!==this.player())return;P(this,se).update(l.id(),()=>l.toPlainObject(P(this,be).call(this,_e(fe,Ue,H))));let y=c instanceof Ue?"unit":c instanceof Pe?"wonder":c instanceof z?"city-improvement":c instanceof ct?"spaceship-part":"other";this.sendNotification(new Pt("City.building-complete."+y,{cityBuild:l,build:c}))}),I.on("player:research-complete",(l,c)=>{l.player()===this.player()&&(P(this,se).update(l.id(),()=>l.toPlainObject(P(this,be).call(this,_e(H)))),this.sendNotification(new Pt("Player.research-complete",{playerResearch:l,advance:c})))}),I.on("goody-hut:action-performed",(l,c)=>{let u=l.tile();!_.getByTile(u).some(h=>h.player()===this.player())||this.sendNotification(new Pt(`GoodyHut.action-performed.${c.constructor.name}`,{goodyHut:l,action:c}))}),I.on("player:defeated",(l,c)=>{if(l===this.player()){this.sendNotification(new Pt("Player.defeated.local",{defeatedPlayer:l,player:c})),eo.unregister(...eo.entries()),Sn.unregister(...Sn.entries()),P(this,So).send("restart",null);return}this.sendNotification(new Pt(c===null?"Player.defeated.unknown":"Player.defeated.by",{defeatedPlayer:l,player:c}))}),I.on("city:civil-disorder",l=>{l.player()===this.player()&&this.sendNotification(new Pt("City.civil-disorder",{city:l}))}),I.on("city:order-restored",l=>{l.player()===this.player()&&this.sendNotification(new Pt("City.order-restored",{city:l}))}),I.on("city:leader-celebration",l=>{l.player()===this.player()&&this.sendNotification(new Pt("City.leader-celebration",{city:l}))}),I.on("city:leader-celebration-ended",l=>{l.player()===this.player()&&this.sendNotification(new Pt("City.leader-celebration-ended",{city:l}))}),I.on("player:spaceship:part-built",l=>{this.player()!==l&&this.sendNotification(new Pt("Spaceship.part-built",{player:l}))}),I.on("player:spaceship:lost",l=>{this.player()===l&&this.sendNotification(new Pt("Player.spaceship-lost",{player:l}))}),I.on("player:spaceship:landed",l=>{this.player()===l&&this.sendNotification(new Pt("Player.spaceship-landed",{player:l}))})}async chooseFromList(r){return new Promise(o=>{if(r.choices().length===1&&r.key()!=="negotiation.next-step"){let[a]=r.choices();o(a.value());return}P(this,So).send("chooseFromList",r),P(this,So).receiveOnce("chooseFromList",async a=>{let[s]=r.choices().filter(l=>l.id()===a);if(!s){console.warn(`No choice found for '${a}' against '${r.id()}', using super.`),o(await super.chooseFromList(r));return}o(s.value())})})}async handleAction(...r){let[o]=r,a=this.player(),s=a.actions(),l=s.filter(h=>h instanceof Hi),{name:c,id:u}=o;if(c==="ReassignWorkers"){let[h]=V.getBy("id",o.city);return h&&(ag(h),P(this,se).update(h.id(),h.toPlainObject(P(this,be).call(this,_e(H,fe))))),!1}if(c==="EndTurn")return l.length===1&&l.every(h=>h instanceof rm);if(!c)return console.log("action not specified: ",o),!1;let[y]=s.filter(h=>h.constructor.name===c&&u===(h.value()?h.value().id():void 0));if(!y)return console.log("action not specified"),!1;if(y instanceof ln){let{unitAction:h,target:G}=o,Y=y.value(),O=[...Y.actions(),...Object.values(Y.actionsForNeighbours())].flat().filter(R=>R.constructor.name===h);for(;O.length!==1;){if(O.length===0)return console.log(`action not found: ${h}`),!1;let[R]=ne.getByPlayer(this.player()).filter(B=>B.id()===G);if(!R)return console.log(`tile not found: ${G}`),!1;if(O=O.filter(B=>B.to()===R.tile()),O.length>1&&!G)return console.log(`too many actions found: ${h} (${O.length})`),!1}let[x]=O;return x.perform(),x instanceof pt&&await this.canNegotiate(Y),!1}if(y instanceof mn){let h=y.value();return h.moves().value()>0&&P(this,se).update(h.id(),h.toPlainObject(P(this,be).call(this,_e(H,fe)))),h.activate(),!1}if(y instanceof ya||y instanceof il){let h=y.value(),{chosen:G}=o;if(!G)return console.warn("no build item specified"),!1;let[Y]=h.available().filter(d=>d.item().name===G);return Y?(h.build(Y.item()),!1):(console.log(`build item not available: ${G}`),!1)}if(y instanceof FT){let h=y.value(),{chosen:G}=o;if(!G)return console.warn("no advance specified"),!1;let[Y]=h.available().filter(d=>d.name===G);return Y?(h.research(Y),!1):(console.log(`build item not available: ${G}`),!1)}if(y instanceof cl){let h=y.value(),[G]=ro.getBy("id",o.treasury);return G?(G.buy(h.city()),P(this,se).update(G.id(),G.toPlainObject(P(this,be).call(this,_e(H)))),!1):(console.warn(`No playerTreasury found for id: ${o.treasury}.`),!1)}if(y instanceof wl){let h=y.value(),{chosen:G}=o,[Y]=h.available().filter(O=>O.name===G);if(!Y)return console.error(`Government type: '${G}' not found.`),!1;h.set(new Y);let d=ne.getByPlayer(this.player());return P(this,se).update(d.id(),d.toPlainObject(P(this,be).call(this,_e(H)))),V.getByPlayer(this.player()).forEach(O=>P(this,se).update(O.id(),O.toPlainObject(P(this,be).call(this,_e(H,fe,Ue))))),!1}if(y instanceof al){let h=y.value(),{value:G}=o;return h.setAll(G.map(([Y,d])=>{let[O]=h.all().filter(x=>x.constructor.name===Y);return[O.constructor,d]})),V.getByPlayer(this.player()).forEach(Y=>P(this,se).update(Y.id(),Y.toPlainObject(P(this,be).call(this,_e(H,fe,Ue))))),!1}return y instanceof nm?(y.value().launch(),!1):(console.log(`unhandled action: ${JSON.stringify(o)}`),!1)}sendInitialData(){P(this,So).send("gameData",new uI(this.player(),Z,Pp)),le(this,ru,!0)}sendPatchData(){P(this,So).send("gameDataPatch",P(this,se).transferData()),P(this,se).clear()}sendNotification(r){P(this,So).send("gameNotification",r)}takeTurn(){return new Promise((r,o)=>{P(this,ru)||this.sendInitialData(),setTimeout(()=>{P(this,se).update(Z.id(),()=>Z.toPlainObject()),P(this,se).update(Pp.id(),()=>Pp.toPlainObject()),P(this,se).add(this.player().id(),()=>this.player().toPlainObject(P(this,be).call(this,_e(fe)))),this.sendPatchData()},1);let a=t(async(...s)=>{try{if(await this.handleAction(...s)){P(this,dm).off("action",a),this.sendPatchData(),setTimeout(()=>r(),100);return}P(this,se).update(this.player().id(),()=>this.player().toPlainObject(P(this,be).call(this,_e(up,fe,Ze)))),this.sendPatchData()}catch(l){o(l)}},"listener");P(this,dm).on("action",a)})}async canNegotiate(r){let o=Array.from(new Set(r.tile().getNeighbours().flatMap(a=>_.getByTile(a).map(s=>s.player()).filter(s=>s!==this.player()))));o.length!==0&&await o.filter(a=>mr.getByPlayer(a).filter(s=>s instanceof pp&&s.isBetween(a,this.player())).every(s=>Z.value()-s.when()>Mj)).reduce((a,s)=>a.then(()=>this.handleNegotiation(s)),Promise.resolve())}async handleNegotiation(r){let o=new pp(r,this.player(),f);for(o.proceed(new Po(r,o,f));!o.terminated();){let a=o.lastInteraction();if(await(a!==null?a.for():o.players().slice(1)).reduce((l,c)=>l.then(async()=>{let u=qt.getByPlayer(c),y=o.nextSteps(),G=await Promise.race([u.chooseFromList(new ol(y,"negotiation.next-step",o)),u instanceof Vl?Gj(500,new fI(`Timeout waiting for ${u.player().id()} (${u.player().civilization().sourceClass().name}) - sent ${y.length} options`)):new Promise(()=>{})]);!G||(o.proceed(G),G instanceof Mo&&await G.proposal().resolve(G))}).catch(u=>console.error(u)),Promise.resolve()),o.terminated())break}return mr.register(o),o}};t(lg,"DataTransferClient"),be=new WeakMap,se=new WeakMap,dm=new WeakMap,mg=new WeakMap,pg=new WeakMap,ru=new WeakMap,So=new WeakMap;var EI=lg;Vr();Mp();Ta();X();Al();var _t,dR=class{constructor(e){ie(this,_t,void 0);le(this,_t,e),e.receive("start",()=>{this.bindEvents(),this.start()}),e.receive("setOption",({name:r,value:o})=>{P(this,_t).send("notification",`setting ${r} to ${o}`),I.setOption(r,o)}),e.receive("getOptions",r=>e.send("getOptions",r.reduce((o,a)=>(o[a]=I.option(a),o),{}))),e.receive("setOptions",r=>{Object.entries(r).forEach(([o,a])=>I.setOption(o,a)),e.send("setOptions",null)})}bindEvents(){P(this,_t).send("notification","binding events"),I.on("engine:initialise",()=>P(this,_t).send("notification","initialising...")),I.on("engine:plugins:load:success",e=>P(this,_t).send("notification",`loaded plugin: ${e}`)),I.on("engine:plugins-loaded",()=>P(this,_t).send("notification","plugins loaded")),I.on("engine:start",()=>P(this,_t).send("notification","starting...")),I.on("world:generate-start-tiles",()=>P(this,_t).send("notification","generating start tiles...")),I.on("world:built",()=>P(this,_t).send("notification","world built")),I.on("game:start",()=>P(this,_t).send("notification","game start")),I.on("turn:start",e=>P(this,_t).send("notification",`turn start ${e}`)),I.on("player:turn-start",e=>P(this,_t).send("notification",`player turn-start: ${e.civilization().constructor.name}`))}start(){I.on("engine:start",()=>{new Array(parseInt(I.option("players"),10)).fill(0).forEach((e,r)=>{let o=new H,a=r===0?new EI(o,P(this,_t),(s,l)=>P(this,_t).send(s,l),(s,l)=>P(this,_t).receive(s,l)):new Wa(o);eo.register(o),qt.register(a),P(this,_t).send("notification","generating world...")})}),I.start(),Promise.resolve().then(()=>(gj(),Iq)).then(()=>I.emit("plugins:load:end"))}};t(dR,"Game"),_t=new WeakMap;var hj=dR;var gR=class{async request(e){return new Promise(r=>{this.send(e.channel(),e.args()[0]),this.receiveOnce(e.channel(),o=>r(o))})}};t(gR,"AbstractTransport");var xj=gR;J();var hR=class extends xj{receive(e,r){addEventListener("message",({data:{channel:o,data:a}})=>{e===o&&r(a)})}receiveOnce(e,r){let o=t(({data:{channel:a,data:s}})=>{e===a&&(r(s),removeEventListener("message",o))},"fullHandler");addEventListener("message",o)}send(e,r){r instanceof ue&&(r=r.toPlainObject()),postMessage({channel:e,data:r})}};t(hR,"ParentTransport");var Oj=hR;var Sat=new hj(new Oj);})();
//# sourceMappingURL=backend.js.map
