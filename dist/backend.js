"use strict";(()=>{var YY=Object.create;var kp=Object.defineProperty;var zY=Object.getOwnPropertyDescriptor;var LY=Object.getOwnPropertyNames;var NY=Object.getPrototypeOf,jY=Object.prototype.hasOwnProperty;var t=(i,e)=>kp(i,"name",{value:e,configurable:!0});var n=(i,e)=>()=>(i&&(e=i(i=0)),e);var P=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),ec=(i,e)=>{for(var r in e)kp(i,r,{get:e[r],enumerable:!0})},Nv=(i,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of LY(e))!jY.call(i,s)&&s!==r&&kp(i,s,{get:()=>e[s],enumerable:!(o=zY(e,s))||o.enumerable});return i};var T=(i,e,r)=>(r=i!=null?YY(NY(i)):{},Nv(e||!i||!i.__esModule?kp(r,"default",{value:i,enumerable:!0}):r,i)),O=i=>Nv(kp({},"__esModule",{value:!0}),i);var jv=(i,e,r)=>{if(!e.has(i))throw TypeError("Cannot "+r)};var C=(i,e,r)=>(jv(i,e,"read from private field"),r?r.call(i):e.get(i)),xe=(i,e,r)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,r)},Ye=(i,e,r,o)=>(jv(i,e,"write to private field"),o?o.call(i,r):e.set(i,r),r),Wv=(i,e,r,o)=>({set _(s){Ye(i,e,s,r)},get _(){return C(i,e,o)}});var F,am,ge=n(()=>{F=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return this.#e.some(r=>e instanceof r)}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,r){return this.filter(o=>{let s=o[e];return s instanceof Function?s.bind(o)()===r:o[e]===r})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(r=>{if(!this.accepts(r))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${r}'.`);this.#t.includes(r)||this.#t.push(r)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(r=>{let o=this.#t.indexOf(r);o>-1&&this.#t.splice(o,1)})}};t(F,"EntityRegistry");am=F});var tc,$,bt=n(()=>{tc=class{#e;#t;#r;constructor(e,r,o){this.#e=r,this.#t=o,this.#r=e}data(...e){return this.#t(...e)}key(){return this.#e}type(){return this.#r}};t(tc,"AdditionalData");$=tc});var rc,X,Ct=n(()=>{ge();bt();rc=class extends F{constructor(){super($)}getByType(e){return this.filter(r=>r.type()===e||Object.prototype.isPrototypeOf.call(r.type(),e)||Object.prototype.isPrototypeOf.call(r.type().prototype,e))}};t(rc,"AdditionalDataRegistry");X=new rc});var ic,WY,Yp,k,Ie,Z=n(()=>{Ct();ge();ic={},WY=t(i=>{let e=i.sourceClass().name,r=ic[e];return r||(ic[e]=0),r===Number.MAX_SAFE_INTEGER&&(ic[e]=BigInt(r)),e+"-"+(++ic[e]).toString(36)},"idProvider"),Yp=t((i,e,r=s=>s,o=X)=>{if(i=r(i),i instanceof am&&(i=i.entries()),Array.isArray(i))return i.map(s=>Yp(s,e,r,o));if(i instanceof k){let s=i.id();if(!(s in e)){let a={_:i.sourceClass().name};e[s]=a,i.keys().forEach(l=>{let u=i[l]instanceof Function?i[l]():i[l];a[l]=Yp(u,e,r,o)}),o.getByType(i.sourceClass()).forEach(l=>{a[l.key()]=Yp(l.data(i),e,r,o)})}return{"#ref":s}}return i instanceof Function?{_:i.name}:i&&i instanceof Object?Object.entries(i).reduce((s,[a,l])=>(s[a]=Yp(l,e,r,o),s),{}):i},"toPlainObject"),k=class{#e;#t=["id"];constructor(){this.#e=WY(this)}addKey(...e){this.#t.push(...e)}id(){return this.#e}keys(){return this.#t}sourceClass(){return this.constructor}toPlainObject(e=o=>o,r=X){let o={};return{hierarchy:Yp(this,o,e,r),objects:o}}};t(k,"DataObject");Ie=k});var sm,Nr,ca=n(()=>{Z();sm=class extends k{#e;#t;constructor(e,r){super(),this.#e=e,this.#t=r,this.addKey("value")}player(){return this.#e}value(){return this.#t}};t(sm,"PlayerAction");Nr=sm});var oc,pi,Rl=n(()=>{ca();oc=class extends Nr{};t(oc,"MandatoryPlayerAction");pi=oc});var ds,Hv=n(()=>{Rl();ds=class extends pi{};t(ds,"ActiveUnit")});var gs,_v=n(()=>{ca();gs=class extends Nr{};t(gs,"InactiveUnit")});var SO=n(()=>{Hv();_v()});var nc,x,M=n(()=>{Z();nc=class extends Ie{};t(nc,"Advance");x=nc});var He,Kv,Qi=n(()=>{He=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return typeof e=="function"&&this.#e.some(r=>Object.prototype.isPrototypeOf.call(r,e)||Object.prototype.isPrototypeOf.call(r.prototype,e))}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,r){return this.filter(o=>{let s=o[e];return s instanceof Function?s.bind(o)()===r:o[e]===r})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(r=>{if(!this.accepts(r))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${r}'.`);this.#t.includes(r)||this.#t.push(r)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(r=>{let o=this.#t.indexOf(r);o>-1&&this.#t.splice(o,1)})}};t(He,"ConstructorRegistry");Kv=He});var ac,R,U=n(()=>{M();Qi();ac=class extends He{constructor(){super(x)}};t(ac,"AdvanceRegistry");R=new ac});var lm,m,I=n(()=>{lm=class{#e=null;constructor(e){e&&(this.#e=e)}validate(...e){return this.#e===null?!0:this.#e(...e)}};t(lm,"Criterion");m=lm});var sc,lc,FO=n(()=>{I();sc=class extends m{#e=[];constructor(...e){super(),e.forEach(r=>{this.#e.push(r)})}criteria(){return this.#e}validate(...e){return this.#e.every(r=>r.validate(...e))}};t(sc,"Criteria");lc=sc});var mc,hs,kO=n(()=>{FO();mc=class extends lc{};t(mc,"And");hs=mc});var pc,p,v=n(()=>{pc=class{#e;constructor(e){this.#e=e}apply(...e){return this.#e(...e)}};t(pc,"Effect");p=pc});var uc,jr,Os=n(()=>{uc=class{#e;constructor(e=2e3){this.#e=e}value(){return this.#e}};t(uc,"Priority");jr=uc});var fa,Dn,xl=n(()=>{Os();fa=class extends jr{constructor(){super(1e3)}};t(fa,"High");Dn=fa});var Qe,qv,YO=n(()=>{Os();Qe=class extends jr{constructor(){super(3e3)}};t(Qe,"Low");qv=Qe});var mm,Vv=n(()=>{Os();mm=class extends jr{constructor(){super(2e3)}};t(mm,"Normal")});var ya=n(()=>{xl();YO();Vv()});var cc,g,A=n(()=>{kO();I();v();ya();cc=class{#e;#t=!0;#r;#i=new mm;constructor(...e){let r=[];e.forEach(o=>{if(o instanceof p){if(this.#r)throw new TypeError("Rule: effect already specified, but another was provided.");this.#r=o;return}if(o instanceof m){r.push(o);return}this.#i=o}),r.length&&(this.#e=new hs(...r))}disable(){this.#t=!1}enable(){this.#t=!0}enabled(){return this.#t}priority(){return this.#i}process(...e){if(!!this.#t&&this.#r instanceof p)return this.#r.apply(...e)}validate(...e){return this.#t?this.#e instanceof m?this.#e.validate(...e):!0:!1}};t(cc,"Rule");g=cc});var fc,d,w=n(()=>{ge();A();fc=class extends F{#e=new Map;constructor(){super(g)}entries(){return super.entries().sort((e,r)=>e.priority().value()-r.priority().value())}get(e){return this.#e.has(e)||this.#e.set(e,this.filter(r=>r.enabled()&&r instanceof e)),this.#e.get(e)||[]}invalidateCache(e){this.#e.delete(e instanceof g?e.constructor:e)}process(e,...r){return this.get(e).filter(o=>o.validate(...r)).map(o=>o.process(...r))}register(...e){super.register(...e),e.forEach(r=>this.invalidateCache(r))}unregister(...e){super.unregister(...e),e.forEach(r=>this.invalidateCache(r))}};t(fc,"RuleRegistry");d=new fc});var yc,Rs,dc=n(()=>{A();yc=class extends g{};t(yc,"Complete");Rs=yc});var gc,hc,zO=n(()=>{A();gc=class extends g{};t(gc,"Cost");hc=gc});var Oc,Rc,LO=n(()=>{A();Oc=class extends g{};t(Oc,"Requirements");Rc=Oc});var xs,z,De=n(()=>{Z();xs=class extends k{#e=[];#t=null;constructor(e=0,r="initial"){super(),this.addKey("value","values"),this.add(e,r)}add(e,r=""){if(e instanceof xs)return this.add(e.value(),r);this.#e.push([e,r]),this.#t=null}clone(){return new this.constructor(this)}set(e,r=""){if(this.#e.splice(0),e instanceof xs)return this.set(e.value(),r);this.#e.push([e,r]),this.#t=e}subtract(e,r=""){if(e instanceof xs)return this.subtract(e.value(),r);this.#e.push([-e,r]),this.#t=null}value(){return this.#t===null&&(this.#t=this.#e.reduce((e,[r])=>e+r,0)),this.#t}values(){return this.#e}};t(xs,"Yield");z=xs});var vl,Jv=n(()=>{De();vl=class extends z{};t(vl,"Research")});var $v=n(()=>{Jv()});var xc,pm,vc=n(()=>{A();xc=class extends g{};t(xc,"Started");pm=xc});var bc,um,Cc=n(()=>{U();Z();w();dc();zO();LO();$v();vc();bc=class extends k{#e;#t=[];#r=null;#i;#o=new vl(1/0);#n=new vl(0);#a;constructor(e,r=R,o=d){super(),this.#e=r,this.#i=e,this.#a=o,this.addKey("available","complete","cost","progress","researching")}add(e){this.#n.add(e),this.check()}addAdvance(e){if(this.#t.some(o=>o instanceof e))return;this.#r===e&&(this.#r=null);let r=new e;this.#t.push(r),this.#a.process(Rs,this,r)}available(){let e=this.#a.get(Rc);return this.#e.filter(r=>e.filter(o=>o.validate(r,this.#t)).every(o=>o.process(r,this.#t)===!0)&&!this.#t.some(o=>o instanceof r))}check(){if(this.#r!==null&&this.#n.value()>=this.#o.value()){let e=new this.#r;this.#t.push(e),this.#r=null,this.#n.subtract(this.#o),this.#o.set(1/0),this.#a.process(Rs,this,e)}}complete(){return this.#t}completed(e){return this.#t.some(r=>r instanceof e)}cost(){return this.#o}player(){return this.#i}progress(){return this.#n}research(e){let[r]=this.#a.process(hc,e,this);this.#o.set(r),this.#r=e,this.#a.process(pm,this,e)}researching(){return this.#r}};t(bc,"PlayerResearch");um=bc});var Pc,N,ze=n(()=>{ge();Cc();Pc=class extends F{constructor(){super(um)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of results for player.");return r[0]}};t(Pc,"PlayerResearchRegistry");N=new Pc});var cm,fm,zp=n(()=>{cm=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}goodyHut(){return this.#e}perform(){}unit(){return this.#t}};t(cm,"Action");fm=cm});var vs,Zv=n(()=>{ze();zp();vs=class extends fm{#e;#t;constructor(e,r,o=N,s=()=>Math.random()){super(e,r),this.#e=o,this.#t=s}perform(){let e=this.#e.getByPlayer(this.unit().player()),r=e.available(),o=r[Math.floor(r.length*this.#t())];e.addAdvance(o)}};t(vs,"Advance")});var Tc,xr,bl=n(()=>{A();Tc=class extends g{};t(Tc,"Captured");xr=Tc});var wc,at,ym=n(()=>{A();wc=class extends g{};t(wc,"Cost");at=wc});var Ic,$o,Ac=n(()=>{A();Ic=class extends g{};t(Ic,"Created");$o=Ic});var Bc,Wr,Cl=n(()=>{A();Bc=class extends g{};t(Bc,"Destroyed");Wr=Bc});var Gc,Uc,NO=n(()=>{A();Gc=class extends g{};t(Gc,"Created");Uc=Gc});var Mc,En,dm=n(()=>{Z();w();NO();Mc=class extends k{#e;constructor(e=d){super(),this.#e=e,this.#e.process(Uc,this)}clone(){return new this.constructor(this.#e)}};t(Mc,"Terrain");En=Mc});var _,Qv=n(()=>{dm();_=class extends En{};t(_,"Land")});var or,jO=n(()=>{dm();or=class extends En{};t(or,"Water")});var nr=n(()=>{Qv();jO()});var Dc,Ec,WO=n(()=>{A();Dc=class extends g{};t(Dc,"YieldModifier");Ec=Dc});var Sc,ui,HO=n(()=>{A();Sc=class extends g{};t(Sc,"Yield");ui=Sc});var gm,he,Xi=n(()=>{Z();nr();w();kc();De();WO();HO();gm=class extends k{#e;#t=[];#r;#i;#o;#n;#a=new Map;constructor(e,r,o,s,a=d){super(),this.#o=e,this.#n=r,this.#i=o,this.#e=s,this.#r=a,this.addKey("terrain","isCoast","isLand","isWater","x","y","yields")}clearYieldCache(e=null){this.#a.delete(e)}getAdjacent(){return this.getAdjacentDirections().map(e=>this.getNeighbour(e))}getAdjacentDirections(){return["n","e","s","w"]}getNeighbour(e){return e==="n"?this.#e.get(this.#o,this.#n-1):e==="ne"?this.#e.get(this.#o+1,this.#n-1):e==="e"?this.#e.get(this.#o+1,this.#n):e==="se"?this.#e.get(this.#o+1,this.#n+1):e==="s"?this.#e.get(this.#o,this.#n+1):e==="sw"?this.#e.get(this.#o-1,this.#n+1):e==="w"?this.#e.get(this.#o-1,this.#n):this.#e.get(this.#o-1,this.#n-1)}getNeighbouringDirections(){return["n","ne","e","se","s","sw","w","nw"]}getNeighbours(){return this.#t.length||(this.#t=this.getNeighbouringDirections().map(e=>this.getNeighbour(e))),this.#t}getSurroundingArea(e=2){return Fc.fromSurrounding(this,e)}distanceFrom(e){let r=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[o]=r.map(([s,a])=>Math.hypot(this.#o-e.x()+s*this.#e.width(),this.#n-e.y()+a*this.#e.height())).sort((s,a)=>s-a);return o}isCoast(){let e=this;return e.isWater()&&e.getNeighbours().some(r=>r.isLand())||e.isLand()&&e.getNeighbours().some(r=>r.isWater())}isLand(){return this.#i instanceof _}isNeighbourOf(e){return this.getNeighbours().includes(e)}isWater(){return this.#i instanceof or}map(){return this.#e}score(e=null,r=[[z,3]]){return this.yields(e).map(s=>{let[a]=r.filter(([u])=>s instanceof u),l=a?a[1]||1:0;return s.value()*l}).reduce((s,a)=>s+a,0)}terrain(){return this.#i}setTerrain(e){this.#i=e}x(){return this.#o}y(){return this.#n}yields(e=null){if(!this.#a.has(e)){let r=this.#r.process(ui,this,e).flat();this.#r.process(Ec,this,e,r).flat(),this.#a.set(e,r)}return this.#a.get(e)}};t(gm,"Tile");he=gm});var hm,Fc,kc=n(()=>{ge();Xi();hm=class extends F{static from(...e){return new this(...e)}static fromSurrounding(e,r=2){let o=t(s=>{let a=[];for(let l=e.x()-s;l<=e.x()+s;l++)for(let u=e.y()-s;u<=e.y()+s;u++)a.push([l,u]);return a},"gen");return this.from(...o(r).map(([s,a])=>e.map().get(s,a)))}constructor(...e){super(gm),this.register(...e)}push(...e){this.register(...e)}shift(){let[e]=this.entries();return this.unregister(e),e}score(e=null,r=[]){return this.entries().reduce((o,s)=>o+s.score(e,r),0)}yields(e=null){return this.entries().flatMap(r=>r.yields(e))}};t(hm,"Tileset");Fc=hm});var Om,Zo,Rm=n(()=>{A();Om=class extends g{};t(Om,"Yield");Zo=Om});var Yc,Pl,zc=n(()=>{A();Yc=class extends g{};t(Yc,"YieldModifier");Pl=Yc});var Lc,_e,Sn=n(()=>{Z();w();bl();ym();Ac();Cl();kc();De();Rm();zc();Lc=class extends k{#e=!1;#t;#r;#i;#o;#n;#a;#s=new Fc;constructor(e,r,o,s=d){super(),this.#t=o,this.#r=e,this.#i=e,this.#n=r,this.#a=this.#n.getSurroundingArea(),this.#s.push(r),this.#o=s,this.#o.process($o,this),this.addKey("destroyed","name","originalPlayer","player","tile","tiles","tilesWorked","yields")}capture(e){let r=this.#i;this.#i=e,this.#o.process(xr,this,e,r)}destroy(e=null){this.#e=!0,this.#o.process(Wr,this,e)}destroyed(){return this.#e}name(){return this.#t}setName(e){this.#t=e}originalPlayer(){return this.#r}player(){return this.#i}tile(){return this.#n}tiles(){return this.#a}tilesWorked(){return this.#s}yields(){let e=[];return[this.#o.get(Zo),this.#o.get(Pl),this.#o.get(at)].flat().forEach(r=>{if(!r.validate(this,e))return;let o=r.process(this,e);if(!!o){if(o instanceof z){e.push(o);return}o.forEach(s=>e.push(s))}}),e}};t(Lc,"City");_e=Lc});var Nc,H,Xe=n(()=>{ge();Sn();Nc=class extends F{constructor(){super(_e)}getByPlayer(e,r=!1){return r?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){let[r]=this.filter(o=>o.tile()===e&&!o.destroyed());return r??null}};t(Nc,"CityRegistry");H=new Nc});var bs,Xv=n(()=>{Xe();w();zp();Sn();bs=class extends fm{#e;constructor(e,r,o=H){super(e,r),this.#e=o}perform(e=d){let r=this.unit().player(),o=new _e(r,this.goodyHut().tile(),r.civilization().getCityName(!0),e);this.#e.register(o)}};t(bs,"City")});var jc,eo,Tl=n(()=>{ge();jc=class extends F{constructor(){super(Function)}accepts(e){return"build"in e}};t(jc,"AvailableCityBuildItemsRegistry");eo=new jc});var st,eb,xm=n(()=>{I();A();st=class extends g{process(e,r){let o=super.process(e,r);if(!(o instanceof lm))throw new TypeError("Invalid build rule.");return o}};t(st,"Build");eb=st});var Wc,Hc,_O=n(()=>{Z();Wc=class extends Ie{#e;constructor(e){super(),this.addKey("value"),this.#e=e}value(){return this.#e}};t(Wc,"BuildCost");Hc=Wc});var Lp,tb,Cs,HY,vm=n(()=>{_O();I();v();A();Lp=class extends g{};t(Lp,"BuildCost");tb=Lp,Cs=t((i,e)=>HY([[i,e]]),"buildCost"),HY=t(i=>i.map(([e,r])=>new Lp(new m(o=>o.item()===e),new p(()=>new Hc(r)))),"buildCosts")});var _c,Kc,KO=n(()=>{w();_O();vm();Z();_c=class extends Ie{#e;#t=new Hc(1/0);#r;#i;constructor(e,r=null,o=d){super(),this.#r=e,this.#e=r,this.#i=o,this.addKey("cost","item")}cost(){if(!Number.isFinite(this.#t.value())){let[e]=this.#i.process(tb,this,this.#e);e&&(this.#t=e)}return this.#t}item(){return this.#r}};t(_c,"BuildItem");Kc=_c});var wl,rb=n(()=>{De();wl=class extends z{};t(wl,"BuildProgress")});var ib=n(()=>{rb()});var qc,ob,nb=n(()=>{A();qc=class extends g{};t(qc,"BuildingCancelled");ob=qc});var Vc,ci,bm=n(()=>{A();Vc=class extends g{};t(Vc,"BuildingComplete");ci=Vc});var Jc,Ps,Np=n(()=>{Tl();Z();w();xm();KO();ib();nb();bm();Jc=class extends k{#e;#t=null;#r;#i=new wl(1/0);#o=new wl;#n;constructor(e,r=eo,o=d){super(),this.#e=r,this.#r=e,this.#n=o,this.addKey("available","building","city","cost","progress","remaining")}add(e){this.#o.add(e)}available(){let e=this.#n.get(eb);return this.#e.filter(r=>e.filter(o=>o.validate(this.city(),r)).every(o=>o.process(this.city(),r).validate())).map(r=>new Kc(r,this.city(),this.#n))}build(e){let r=this.getAvailable(e);if(!r)throw new TypeError(`Cannot build ${e.name}, it's not available.`);this.#t=r,this.#i.set(this.#t.cost().value())}building(){return this.#t}check(){if(this.#o.value()>=this.#i.value()&&this.#t){let e=this.#t.item().build(this.#r,this.#n);return this.#o.set(0),this.#t=null,this.#i.set(1/0),this.#n.process(ci,this,e),e}return null}city(){return this.#r}cost(){return this.#i}getAvailable(e){return this.available().filter(r=>r.item()===e)[0]}progress(){return this.#o}remaining(){return this.#i.value()-this.#o.value()}revalidate(){this.#t&&!this.getAvailable(this.#t.item())&&(this.#t=null,this.#i.set(1/0),this.#n.process(ob,this))}};t(Jc,"CityBuild");Ps=Jc});var $c,Et,Fn=n(()=>{ge();Np();$c=class extends F{constructor(){super(Ps)}getByCity(e){let r=this.getBy("city",e);if(r.length!==1)throw new TypeError("Wrong number of entities returned.");return r[0]}};t($c,"CityBuildRegistry");Et=new $c});var Zc,to,jp=n(()=>{A();Zc=class extends g{};t(Zc,"Spend");to=Zc});var Qc,ab,sb=n(()=>{A();Qc=class extends g{};t(Qc,"Rush");ab=Qc});var Xc,ef,qO=n(()=>{Fn();w();Z();jp();De();sb();Xc=class extends Ie{#e;#t;#r;#i=0;#o;constructor(e,r,o=Et,s=d){super(),this.addKey("value","yield"),this.#e=o,this.#t=e,this.#r=s,this.#o=r}add(e){if(e instanceof z){this.add(e.value());return}this.#i+=e}buy(e){let r=this.#e.getByCity(e),[o]=this.cost(e).filter(a=>a.resource()===this.#o),s=o.value();e.player()!==this.#t||this.value()<s||(this.#r.process(ab,r,o),r.add(new z(r.remaining())),this.subtract(s))}cost(e){let r=this.#e.getByCity(e);return this.#r.process(to,r)}player(){return this.#t}set(e){this.#i=0,this.add(e)}subtract(e){if(e instanceof z){this.add(e.value());return}this.#i-=e}value(){return this.#i}yield(){return this.#o}};t(Xc,"PlayerTreasury");ef=Xc});var tf,fi,Il=n(()=>{ge();qO();tf=class extends F{constructor(){super(ef)}getByPlayer(e){return this.getBy("player",e)}getByPlayerAndType(e,r){let o=this.filter(s=>s.player()===e&&s.yield()===r);if(o.length!==1)throw new TypeError(`Wrong number of playerTreasuries: ${o.length}`);return o[0]}};t(tf,"PlayerTreasuryRegistry");fi=new tf});var Ee,ro,Ts=n(()=>{De();Ee=class extends z{};t(Ee,"Gold");ro=Ee});var ws,lb=n(()=>{Il();zp();Ts();ws=class extends fm{#e;constructor(e,r,o=fi){super(e,r),this.#e=o}perform(){this.#e.getByPlayerAndType(this.unit().player(),ro).add(new ro(50))}};t(ws,"Gold")});var rf,of,VO=n(()=>{A();rf=class extends g{};t(rf,"Unit");of=rf});var Is,mb=n(()=>{zp();w();VO();Is=class extends cm{#e;#t;constructor(e,r,o=()=>Math.random(),s=d){super(e,r),this.#e=o,this.#t=s}perform(){this.#t.process(of,this.goodyHut(),this.unit())}};t(Is,"Unit")});var JO=n(()=>{Zv();Xv();lb();mb()});var As,pb=n(()=>{ca();As=class extends Nr{};t(As,"ChangeProduction")});var kn,ub=n(()=>{Rl();kn=class extends pi{};t(kn,"CityBuild")});var $O=n(()=>{pb();ub()});var Bs,cb,nf=n(()=>{Bs=class{#e;constructor(e){this.#e=e}player(){return this.#e}takeTurn(){return new Promise((e,r)=>r(new TypeError("Client#takeTurn must be implemented.")))}};t(Bs,"Client");cb=Bs});var af,Gs,Wp=n(()=>{De();af=class extends z{#e;constructor(e,r){super(r),this.#e=e}leader(){return this.#e}};t(af,"Trait");Gs=af});var sf,lf,ZO=n(()=>{ge();Wp();sf=class extends F{constructor(){super(Gs)}getByLeader(e){return this.getBy("leader",e)}getBySubclass(e){return this.filter(r=>r instanceof e)}};t(sf,"TraitRegistry");lf=new sf});var mf,se,ft=n(()=>{ZO();Z();mf=class extends k{#e=[];constructor(e=lf){super();let r=e.getByLeader(this.sourceClass());this.#e.push(...r),this.addKey("name")}static civilization(){throw new TypeError("Must be implemented in extending class")}name(){throw new TypeError("Must be implemented in extending class")}traits(){return[...this.#e]}};t(mf,"Leader");se=mf});var pf,Yn,Cm=n(()=>{Qi();ft();pf=class extends He{constructor(){super(se)}getByCivilization(e){return this.getBy("civilization",e)}};t(pf,"LeaderRegistry");Yn=new pf});var Us,fb=n(()=>{ca();Us=class extends Nr{};t(Us,"AdjustTradeRates")});var QO=n(()=>{fb()});var uf,Ae,vr=n(()=>{A();uf=class extends g{};t(uf,"Busy");Ae=uf});var Al,yb,XO=n(()=>{Rl();Al=class extends pi{};t(Al,"ChooseResearch");yb=Al});var cf,ff,eR=n(()=>{A();cf=class extends g{};t(cf,"Cost");ff=cf});var zn,tR,yf=n(()=>{De();zn=class extends z{};t(zn,"FoodStorage");tR=zn});var df,_p,rR=n(()=>{A();df=class extends g{};t(df,"FoodStorage");_p=df});var gf,Ln,hf=n(()=>{A();gf=class extends g{};t(gf,"Grow");Ln=gf});var Of,Bl,iR=n(()=>{A();Of=class extends g{};t(Of,"Shrink");Bl=Of});var Rf,Gl,xf=n(()=>{Z();w();eR();yf();rR();hf();iR();Rf=class extends k{#e;#t=new tR(1/0);#r=new tR;#i;#o=1;constructor(e,r=d){super(),this.#e=e,this.#i=r,this.setCost(),this.addKey("cost","progress","size")}add(e){this.#r.add(e)}check(){this.#i.process(_p,this)}city(){return this.#e}cost(){return this.#t}setCost(){let e=this.#i.process(ff,this);e.length>0&&this.#t.set(e[0],"setCost")}empty(){this.#r.subtract(this.#r.value())}grow(){this.#o++,this.#i.process(Ln,this)}progress(){return this.#r}shrink(){this.#o--,this.#i.process(Bl,this)}size(){return this.#o}};t(Rf,"CityGrowth");Gl=Rf});var Ms,db,vf=n(()=>{Z();w();Ms=class extends k{static build(e,r=d){throw new TypeError("createFromObject: Must be overridden in extending class")}};t(Ms,"Buildable");db=Ms});var bf,Kp,oR=n(()=>{A();bf=class extends g{};t(bf,"Created");Kp=bf});var Cf,L,Se=n(()=>{vf();w();oR();Cf=class extends Ms{#e;#t=!1;#r;constructor(e,r=d){super(),this.addKey("destroyed"),this.#e=e,this.#r=r,this.#r.process(Kp,this,e)}static build(e,r=d){return new this(e,r)}city(){return this.#e}destroy(){this.#t=!0}destroyed(){return this.#t}};t(Cf,"CityImprovement");L=Cf});var Pf,ve,ar=n(()=>{Z();Pf=class extends k{#e;#t;#r;constructor(e,r,o){super(),this.#e=e,this.#t=r,this.#r=o,this.addKey("name","value")}civilization(){return this.#e}name(){return this.#t}value(){return this.#r}};t(Pf,"Attribute");ve=Pf});var Pm,be,sr=n(()=>{ge();ar();Pm=class extends F{constructor(){super(ve)}getByCivilization(e){return this.getBy("civilization",e)}getByName(e){return this.getBy("name",e)}};t(Pm,"AttributeRegistry");be=new Pm});var Tf,re,_t=n(()=>{Tf=class{#e;#t;#r=!1;constructor(e,r,o=!1){this.#e=e,this.#t=r,this.#r=o}name(){return this.#e}civilization(){return this.#t}capital(){return this.#r}};t(Tf,"CityName");re=Tf});var wf,ee,Pt=n(()=>{ge();_t();wf=class extends F{#e=1;#t;constructor(e=()=>Math.random()){super(re),this.#t=e}takeByCivilization(e){let[r]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1);return r instanceof re?(this.unregister(r),r.name()):this.takeUnassociated()}takeCapitalByCivilization(e){let[r]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1).filter(o=>o.capital());return r instanceof re?(this.unregister(r),r.name()):this.takeByCivilization(e)}takeUnassociated(){let[e]=this.getBy("civilization",null).sort(()=>Math.floor(this.#t()*3)-1);return e instanceof re?(this.unregister(e),e.name()):`City #${this.#e++}`}};t(wf,"CityNameRegistry");ee=new wf});var If,fe,Kt=n(()=>{sr();Pt();Z();If=class extends k{#e=null;#t;#r=new Pm;constructor(e=be,r=ee){super(),this.#t=r,this.#r.register(...e.getByCivilization(this.sourceClass())),this.addKey("name","leader","attributes")}attributes(){return this.#r.entries()}name(){return this.constructor.name}leader(){return this.#e}setLeader(e){this.#e=e}getCityName(e=!1){let r=this.sourceClass();return e?this.#t.takeCapitalByCivilization(r):this.#t.takeByCivilization(r)}};t(If,"Civilization");fe=If});var Ds,gb=n(()=>{ca();Ds=class extends sm{};t(Ds,"CompleteProduction")});var nR=n(()=>{gb()});var Ul,Bf,Gf=n(()=>{Rl();Ul=class extends pi{};t(Ul,"EndTurn");Bf=Ul});var Uf,Mf,aR=n(()=>{Uf=class{#e={};on(e,r){e in this.#e||(this.#e[e]=[]),this.#e[e].push(r)}once(e,r){let o=t((...s)=>{r(...s),this.off(e,o)},"onceHandler");this.on(e,o)}off(e,r){if(!(e in this.#e))return;let o=this.#e[e].indexOf(r);o!==-1&&this.#e[e].splice(o,1)}emit(e,...r){e in this.#e&&this.#e[e].forEach(o=>o(...r))}};t(Uf,"EventEmitter");Mf=Uf});var Ml,Ob,sR=n(()=>{ca();Ml=class extends Nr{};t(Ml,"LaunchSpaceship");Ob=Ml});var Df,lt,Nn=n(()=>{A();Df=class extends g{};t(Df,"Action");lt=Df});var Ef,yi,Dl=n(()=>{A();Ef=class extends g{};t(Ef,"Added");yi=Ef});var Sf,lR,Rb=n(()=>{ca();Sf=class extends Nr{};t(Sf,"HiddenPlayerAction");lR=Sf});var Ff,K,io=n(()=>{Z();w();Nn();Dl();Rb();Rl();Ff=class extends k{#e=null;#t;constructor(e=d){super(),this.#t=e,this.#t.process(yi,this),this.addKey("actions","civilization","mandatoryActions")}action(){let[e]=this.actions();return e}actions(){return this.#t.process(lt,this).flat().filter(e=>!(e instanceof lR))}civilization(){if(this.#e===null)throw new TypeError("Player#civilization is unset.");return this.#e}hasActions(){return!!this.action()}hasMandatoryActions(){return this.actions().some(e=>e instanceof pi)}hiddenActions(){return this.#t.process(lt,this).flat().filter(e=>e instanceof lR)}mandatoryAction(){let[e]=this.mandatoryActions();return e}mandatoryActions(){return this.actions().filter(e=>e instanceof pi)}setCivilization(e){this.#e=e}};t(Ff,"Player");K=Ff});var kf,Tm,mR=n(()=>{Ct();Z();Xi();kf=class extends k{#e={};#t;#r;#i;constructor(e,r,o=X){super(),this.#t=o,this.#r=r,this.#i=e,this.addKey("isCoast","isLand","isWater","terrain","x","y","yields"),this.setAdditionalData()}addKey(...e){super.addKey(...e)}isCoast(){return this.#i.isCoast()}isLand(){return this.#i.isLand()}isWater(){return this.#i.isWater()}player(){return this.#r}setAdditionalData(){this.#t.getByType(he).forEach(e=>{this.#e[e.key()]=e.data(this.#i),Object.defineProperty(this,e.key(),{configurable:!0,value:()=>e.data(this.#i)}),this.addKey(e.key())})}terrain(){return this.#i.terrain()}tile(){return this.#i}update(){this.#i.clearYieldCache(this.#r),this.setAdditionalData()}x(){return this.#i.x()}y(){return this.#i.y()}yields(){return this.#i.yields(this.#r)}};t(kf,"PlayerTile");Tm=kf});var Yf,xb,vb=n(()=>{dm();Yf=class extends En{};t(Yf,"Unknown");xb=Yf});var zf,bb,Cb=n(()=>{Xi();vb();zf=class extends he{constructor(e,r,o){super(e,r,new xb,o)}};t(zf,"UndiscoveredTile");bb=zf});var Lf,Nf,pR=n(()=>{A();Lf=class extends g{};t(Lf,"VisibilityChanged");Nf=Lf});var jf,wm,Wf=n(()=>{Z();w();mR();Xi();Cb();pR();jf=class extends k{#e;#t;#r=[];#i;constructor(e,r,o=d){super(),this.#e=e,this.#i=r,this.#t=o,this.addKey("height","tiles","width")}entries(){return this.#r}filter(e){return this.entries().filter(e)}forEach(e){return this.#r.forEach(e)}get(e,r){let[o]=this.entries().filter(s=>s.x()===e&&s.y()===r);return o||new bb(e,r,this.#i)}getByTile(e){let[r]=this.filter(o=>o.tile()===e);return r??null}height(){return this.#i.height()}includes(e){return e instanceof he?!!this.getByTile(e):this.#r.includes(e)}map(e){return this.#r.map(e)}player(){return this.#e}register(...e){e.forEach(r=>{this.includes(r)||(this.#r.push(new Tm(r,this.#e)),this.#t.process(Nf,r,this.player()))})}tiles(){return this.entries()}width(){return this.#i.width()}};t(jf,"PlayerWorld");wm=jf});var Ss,wb=n(()=>{ca();Ss=class extends Nr{};t(Ss,"Revolution")});var uR=n(()=>{wb()});var oo,Ib=n(()=>{De();oo=class extends z{};t(oo,"Attack")});var di,Ab=n(()=>{De();di=class extends z{};t(di,"Defence")});var no,Bb,cR=n(()=>{De();no=class extends z{};t(no,"Movement");Bb=no});var Bm,Gb=n(()=>{cR();Bm=class extends Bb{};t(Bm,"Moves")});var Fs,Ub=n(()=>{De();Fs=class extends z{};t(Fs,"Visibility")});var Gm=n(()=>{Ib();Ab();cR();Gb();Ub()});var Tt,fR,gi,jn,Um,yR=n(()=>{I();v();A();Tt=class extends g{};t(Tt,"Action");fR=Tt,gi=new m(i=>i.moves().value()>=.1),jn=new m((i,e,r=i.tile())=>r===e),Um=new m((i,e,r=i.tile())=>e.isNeighbourOf(r))});var Vf,Mm,dR=n(()=>{A();Vf=class extends g{};t(Vf,"Activate");Mm=Vf});var Jf,da,$f=n(()=>{A();Jf=class extends g{};t(Jf,"Created");da=Jf});var Zf,Qo,Qp=n(()=>{A();Zf=class extends g{};t(Zf,"Destroyed");Qo=Zf});var Qf,Xf,gR=n(()=>{A();Qf=class extends g{};t(Qf,"Visibility");Xf=Qf});var ks,El,Xp,Mb,Dm=n(()=>{Gm();I();v();A();ks=class extends g{};t(ks,"BaseYield");El=class extends g{};t(El,"Yield");Xp=El,Mb=t((i,e=1,r=1,o=1,s=1)=>[...[[oo,e],[di,r],[no,o],[Fs,s]].flatMap(([a,l])=>[new El(new m(u=>u instanceof i),new m((u,c)=>c instanceof a),new p((u,c)=>c.set(l))),new ks(new m(u=>u===i),new m((u,c)=>c instanceof a),new p((u,c)=>c.set(l)))])],"unitYield")});var ey,Ge,ga=n(()=>{Gm();vf();w();yR();dR();$f();Qp();gR();Dm();ey=class extends Ms{#e=!0;#t=null;#r;#i=!1;#o=new Bm;#n;#a;#s=null;#l;#m=!1;constructor(e,r,o,s=d){super(),this.#r=e,this.#n=r,this.#l=o,this.#a=s,this.addKey("actions","actionsForNeighbours","active","attack","busy","city","defence","destroyed","movement","moves","player","status","tile","visibility","waiting"),this.#a.process(da,this)}static build(e,r=d){return new this(e,e.player(),e.tile(),r)}action(e,...r){return e.perform(...r)}actions(e=this.#l,r=this.#l){return typeof e=="string"&&(e=r.getNeighbour(e)),this.#a.process(fR,this,e,r)}actionsForNeighbours(e=this.#l){return e.getNeighbouringDirections().reduce((r,o)=>({...r,[o]:this.#a.process(fR,this,e.getNeighbour(o),e)}),{})}activate(){this.#a.process(Mm,this)}active(){return this.#e}setActive(e=!0){this.#e=e}applyVisibility(){this.#l.getSurroundingArea(this.visibility().value()).forEach(e=>{this.#a.process(Xf,e,this.#n)})}attack(){let[e]=this.yield(new oo);return e}busy(){return this.#t}setBusy(e=null){this.#t=e}city(){return this.#r}defence(){let[e]=this.yield(new di);return e}destroy(e=null){this.#a.process(Qo,this,e)}destroyed(){return this.#i}setDestroyed(){this.#i=!0}movement(){let[e]=this.yield(new no);return e}moves(){return this.#o}player(){return this.#n}status(){return this.#s}setStatus(e){this.#s=e}tile(){return this.#l}setTile(e){this.#l=e}visibility(){let[e]=this.yield(new Fs);return e}waiting(){return this.#m}setWaiting(e=!0){this.#m=e}yield(...e){let r=this.#a.get(Xp);return e.forEach(o=>r.filter(s=>s.validate(this,o)).forEach(s=>s.process(this,o))),e}};t(ey,"Unit");Ge=ey});var ty,ie,St=n(()=>{ge();xf();ty=class extends F{constructor(){super(Gl)}getByCity(e){let r=this.getBy("city",e);if(r.length!==1)throw new TypeError("Wrong number of CityGrowths returned.");return r[0]}};t(ty,"CityGrowthRegistry");ie=new ty});var Ce,Oe,Be=n(()=>{Se();Ce=class extends L{};t(Ce,"Wonder");Oe=Ce});var Em,hi,Ys=n(()=>{ge();io();Em=class extends F{constructor(){super(K)}};t(Em,"PlayerRegistry");hi=new Em});var ny,Xo,Sm=n(()=>{Ys();ny=class extends Em{};t(ny,"CurrentPlayerRegistry");Xo=new ny});var ay,b,q=n(()=>{aR();ay=class extends Mf{#e={};#t=!1;debug(e){if(!!this.option("debug"))return e()}emit(e,...r){return this.debug(()=>console.log(`Engine#emit: ${String(e)}: ${r}`)),super.emit(e,...r)}loadPlugins(){return this.emit("plugins:load:start"),new Promise((e,r)=>{this.once("plugins:load:end",()=>e())})}option(e,r=null){return this.#e[e]||r}setOption(e,r){this.#e[e]!==r&&(this.#e[e]=r,this.emit("option:changed",e,r))}start(){this.#t||(this.#t=!0,this.emit("engine:initialise"),this.loadPlugins().then(()=>{this.emit("engine:start")}))}};t(ay,"Engine");b=new ay});var sy,pe,ao=n(()=>{ge();Wf();sy=class extends F{constructor(){super(wm)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError(`Wrong number of player worlds exist for player: ${e.id()}`);return r[0]}};t(sy,"PlayerWorldRegistry");pe=new sy});var ly,te,Ft=n(()=>{Z();ly=class extends k{#e=0;constructor(){super(),this.addKey("value")}increment(){return this.#e++,this.#e}value(){return this.#e}};t(ly,"Turn");te=new ly});var my,W,$e=n(()=>{ge();ga();my=class extends F{constructor(){super(Ge)}getByCity(e){return this.filter(r=>r.city()===e&&!r.destroyed())}getByPlayer(e,r=!1){return r?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){return this.filter(r=>r.tile()===e&&!r.destroyed())}};t(my,"UnitRegistry");W=new my});var py,zs,xR=n(()=>{A();py=class extends g{};t(py,"Year");zs=py});var uy,Fm,vR=n(()=>{Z();w();Ft();xR();uy=class extends k{#e=new Map;#t;#r;constructor(e=te,r=d){super(),this.#t=r,this.#r=e,this.addKey("value")}value(e=this.#r.value()){if(!this.#e.has(e)){let[o]=this.#t.process(zs,e);this.#e.set(e,o)}let r=this.#e.get(e);if(typeof r!="number")throw new TypeError("Invalid cache result.");return r}};t(uy,"Year");Fm=new uy});var Q,en,Sl=n(()=>{De();Q=class extends z{};t(Q,"Food");en=Q});var V,ha,km=n(()=>{De();V=class extends z{};t(V,"Production");ha=V});var le,Oa,Ra=n(()=>{De();le=class extends z{};t(le,"Trade");Oa=le});var xa=n(()=>{Sl();km();Ra()});var Fl,Le,so=n(()=>{Fl=t((i,...e)=>i.reduce((r,o)=>{let s=e.findIndex(a=>o instanceof a);return s===-1||(r[s]+=o.value()),r},e.map(()=>0)),"reduceYields"),Le=t((i,e)=>Fl(i,e).shift()??0,"reduceYield")});var _Y,KY,Fb,kb,Ls,Ym=n(()=>{St();xa();ao();so();_Y=t((i,e=[[Q,8],[V,3*(Le(i.tilesWorked().yields(i.player()),V)===0?3:1)],[le,1*(Le(i.tilesWorked().yields(i.player()),le)===0?3:1)]])=>i.tiles().entries().sort((r,o)=>o.score(i.player(),e)-r.score(i.player(),e)),"getHighestValueCityTiles"),KY=t((i,e=pe)=>_Y(i).filter(r=>e.getByPlayer(i.player()).includes(r)&&!i.tilesWorked().includes(r)&&i.tile()!==r),"getHighestValueAvailableCityTiles"),Fb=t((i,e=pe,r=ie)=>{i.tilesWorked().unregister(...i.tilesWorked().entries()),i.tilesWorked().register(i.tile()),kb(i,e,r)},"reassignWorkers"),kb=t((i,e=pe,r=ie)=>{let o=r.getByCity(i);KY(i,e).some(s=>i.tilesWorked().length>=o.size()+1?!0:(i.tilesWorked().register(s),!1))},"assignWorkers"),Ls=kb});var bR,cy,Hr,Ns=n(()=>{De();bR=t(i=>i instanceof z?-i.value():-i,"negate"),cy=class extends z{add(e,r=""){super.add(bR(e),r)}set(e,r=""){super.set(bR(e),r)}subtract(e,r=""){super.subtract(bR(e),r)}};t(cy,"NegativeYield");Hr=t(i=>{["add","set","subtract"].forEach(e=>Object.defineProperty(i.prototype,e,Object.getOwnPropertyDescriptor(cy.prototype,e)||Object.create(null)))},"makeNegative")});var tn,fy=n(()=>{Ra();Ns();tn=class extends Oa{};t(tn,"Corruption");Hr(tn)});var js,yy,lu=n(()=>{De();js=class extends z{};t(js,"Happiness");yy=js});var Oi,Yb,mu=n(()=>{De();Oi=class extends z{};t(Oi,"Luxuries");Yb=Oi});var zm,zb,CR=n(()=>{Sl();Ns();zm=class extends en{};t(zm,"PopulationSupportFood");Hr(zm);zb=zm});var qt,dy=n(()=>{De();qt=class extends z{};t(qt,"Research")});var et,Wn,Ws=n(()=>{De();et=class extends z{};t(et,"Unhappiness");Wn=et});var Hs,Lb,PR=n(()=>{Sl();Ns();Hs=class extends en{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(Hs,"UnitSupportFood");Hr(Hs);Lb=Hs});var _s,TR,wR=n(()=>{km();Ns();_s=class extends ha{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(_s,"UnitSupportProduction");Hr(_s);TR=_s});var va=n(()=>{xa();fy();yf();Ts();lu();mu();CR();dy();Ra();Ws();PR();wR()});var _n,qs,Vs=n(()=>{w();Z();_n=class extends k{#e;#t;#r;#i;constructor(e,r,o,s=d){super(),this.#e=e,this.#t=s,this.#r=r,this.#i=o,this.addKey("from","to")}forUnit(e){return new this.constructor(this.#e,this.#r,e,this.#t)}from(){return this.#e}perform(...e){}ruleRegistry(){return this.#t}to(){return this.#r}unit(){return this.#i}};t(_n,"Action");qs=_n});var hy,rn,uu=n(()=>{A();hy=class extends g{};t(hy,"Defeated");rn=hy});var Js,Hb=n(()=>{w();$e();Vs();uu();Js=class extends qs{#e;#t;constructor(e,r,o,s=d,a=W,l=()=>Math.random()){super(e,r,o,s),this.#t=a,this.#e=l}perform(){let[e]=this.#t.getByTile(this.to()).sort((o,s)=>s.defence().value()-o.defence().value()),r=Math.min(1,this.unit().moves().value());if(this.unit().attack().value()*r*this.#e()>=e.defence().value()*this.#e()){this.ruleRegistry().process(rn,e,this.unit(),this),this.unit().moves().subtract(r,this.constructor.name);return}this.ruleRegistry().process(rn,this.unit(),e,this)}};t(Js,"Attack")});var Oy,_b,Kb=n(()=>{vr();Oy=class extends Ae{};t(Oy,"BuildingIrrigation");_b=Oy});var Ry,J,kt=n(()=>{A();Ry=class extends g{};t(Ry,"Moved");J=Ry});var xy,tt,lo=n(()=>{Vs();w();Ft();vr();I();v();kt();xy=class extends _n{#e;constructor(e,r,o,s=d,a=te){super(e,r,o,s),this.#e=a}perform(e,r=()=>{},o=Ae){let s=this.#e.value()+e;this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new o(new m(()=>this.#e.value()===s),new p((...a)=>{let l=this.unit();l.setActive(),l.setBusy(),r(...a),this.ruleRegistry().process(J,this.unit(),this)})))}};t(xy,"DelayedAction");tt=xy});var vy,ba,by=n(()=>{A();vy=class extends g{};t(vy,"Built");ba=vy});var Cy,on,Yl=n(()=>{Z();w();by();Cy=class extends k{#e;constructor(e,r=d){super(),this.#e=e,r.process(ba,e,this)}tile(){return this.#e}};t(Cy,"TileImprovement");on=Cy});var Ue,qb,GR=n(()=>{Yl();Ue=class extends on{};t(Ue,"Irrigation");qb=Ue});var Py,Te,Ri=n(()=>{A();Py=class extends g{};t(Py,"MovementCost");Te=Py});var $s,Vb=n(()=>{Kb();lo();GR();kt();Ri();$s=class extends tt{perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new qb(this.unit().tile())},_b),this.ruleRegistry().process(J,this.unit(),this)}};t($s,"BuildIrrigation")});var Ty,Jb,$b=n(()=>{vr();Ty=class extends Ae{};t(Ty,"BuildingMine");Jb=Ty});var rt,Zb,UR=n(()=>{Yl();rt=class extends on{};t(rt,"Mine");Zb=rt});var Zs,Qb=n(()=>{$b();lo();UR();kt();Ri();Zs=class extends tt{perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new Zb(this.unit().tile())},Jb),this.ruleRegistry().process(J,this.unit(),this)}};t(Zs,"BuildMine")});var wy,Xb,eC=n(()=>{vr();wy=class extends Ae{};t(wy,"BuildingRoad");Xb=wy});var je,tC,MR=n(()=>{Yl();je=class extends on{};t(je,"Road");tC=je});var Qs,rC=n(()=>{eC();lo();kt();Ri();MR();Qs=class extends tt{perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new tC(this.unit().tile())},Xb),this.ruleRegistry().process(J,this.unit(),this)}};t(Qs,"BuildRoad")});var Iy,iC,oC=n(()=>{vr();Iy=class extends Ae{};t(Iy,"BuildingRailroad");iC=Iy});var lr,nC,DR=n(()=>{Yl();lr=class extends on{};t(lr,"Railroad");nC=lr});var Xs,aC=n(()=>{oC();lo();kt();Ri();DR();Xs=class extends tt{perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new nC(this.unit().tile())},iC),this.ruleRegistry().process(J,this.unit(),this)}};t(Xs,"BuildRailroad")});var Ay,cu,ER=n(()=>{A();Ay=class extends g{};t(Ay,"ValidateMove");cu=Ay});var Vt,Lm,fu=n(()=>{Vs();kt();Ri();ER();Vt=class extends _n{perform(){return this.validate()?(this.unit().setTile(this.to()),this.ruleRegistry().process(J,this.unit(),this),!0):!1}movementCost(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>r-o);return e}validate(){let[e]=this.ruleRegistry().process(cu,this.unit(),this.movementCost());return e}};t(Vt,"Move");Lm=Vt});var Nm,sC=n(()=>{w();fu();Nm=class extends Lm{#e;constructor(e,r,o,s,a=d){super(e,r,o,a),this.#e=s}perform(){return super.perform()?(this.#e.capture(this.unit().player()),!0):!1}};t(Nm,"CaptureCity")});var By,Ke,xi=n(()=>{Z();By=class extends Ie{#e;constructor(e){super(),this.#e=e}clone(e=this.terrain()){return new this.constructor(e)}terrain(){return this.#e}};t(By,"TerrainFeature");Ke=By});var SR,Gy,yt,nn=n(()=>{ge();xi();SR=new Map,Gy=class extends F{constructor(){super(Ke)}getByTerrain(e){return SR.has(e)||SR.set(e,this.getBy("terrain",e)),SR.get(e)}};t(Gy,"TerrainFeatureRegistry");yt=new Gy});var Uy,lC,mC=n(()=>{vr();Uy=class extends Ae{};t(Uy,"ClearingForest");lC=Uy});var me,jm,yu=n(()=>{nr();me=class extends _{};t(me,"Plains");jm=me});var el,pC=n(()=>{w();nn();Ft();mC();lo();kt();Ri();yu();el=class extends tt{#e;constructor(e,r,o,s=d,a=yt,l=te){super(e,r,o,s,l),this.#e=a}perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new jm,o=this.#e.getByTerrain(this.from().terrain());this.#e.register(...o.map(s=>s.clone(r))),this.#e.unregister(...o),this.from().setTerrain(r)},lC),this.ruleRegistry().process(J,this.unit(),this)}};t(el,"ClearForest")});var My,uC,cC=n(()=>{vr();My=class extends Ae{};t(My,"ClearingJungle");uC=My});var du,tl,fC,Wm=n(()=>{nn();I();v();A();du=class extends g{};t(du,"Feature");tl=du,fC=t((i,e,r=.2,o=yt,s=()=>Math.random())=>[new du(new m(a=>a===e),new m((a,l)=>l instanceof i),new m(()=>s()<=r),new p((a,l)=>o.register(new a(l))))],"feature")});var Re,rl,Hm=n(()=>{nr();Re=class extends _{};t(Re,"Grassland");rl=Re});var an,Dy,Ey=n(()=>{xi();an=class extends Ke{};t(an,"Shield");Dy=an});var il,yC=n(()=>{w();nn();Ft();cC();lo();Wm();Hm();kt();Ri();Ey();il=class extends tt{#e;constructor(e,r,o,s=d,a=yt,l=te){super(e,r,o,s,l),this.#e=a}perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new rl,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(tl,Dy,r),this.#e.unregister(...o),this.from().setTerrain(r)},uC),this.ruleRegistry().process(J,this.unit(),this)}};t(il,"ClearJungle")});var Sy,dC,gC=n(()=>{vr();Sy=class extends Ae{};t(Sy,"ClearingSwamp");dC=Sy});var ol,hC=n(()=>{w();nn();Ft();gC();lo();Wm();Hm();kt();Ri();Ey();ol=class extends tt{#e;constructor(e,r,o,s=d,a=yt,l=te){super(e,r,o,s,l),this.#e=a}perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new rl,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(tl,Dy,r),this.#e.unregister(...o),this.from().setTerrain(r)},dC),this.ruleRegistry().process(J,this.unit(),this)}};t(ol,"ClearSwamp")});var _m,OC=n(()=>{Vs();_m=class extends qs{perform(){this.unit().destroy()}};t(_m,"Disband")});var nl,RC=n(()=>{w();fu();nl=class extends Lm{#e;constructor(e,r,o,s,a=d){super(e,r,o,a),this.#e=s}perform(){return super.perform()?(this.unit().moves().set(0),this.#e.unload(this.unit()),!0):!1}};t(nl,"Disembark")});var Km,xC=n(()=>{w();vr();I();fu();kt();Km=class extends Lm{#e;constructor(e,r,o,s,a=d){super(e,r,o,a),this.#e=s}perform(){return super.perform()?(this.#e.stow(this.unit()),this.unit().setBusy(new Ae(new m(()=>!1))),this.unit().setActive(!1),this.ruleRegistry().process(J,this.unit(),this),!0):!1}};t(Km,"Embark")});var Fy,qm,ky=n(()=>{Z();Fy=class extends Ie{#e;constructor(e){super(),this.#e=e}unit(){return this.#e}};t(Fy,"UnitImprovement");qm=Fy});var Yy,mr,Ca=n(()=>{ge();ky();Yy=class extends F{constructor(){super(qm)}getByUnit(e){return this.getBy("unit",e)}};t(Yy,"UnitImprovementRegistry");mr=new Yy});var zy,vC,bC=n(()=>{vr();zy=class extends Ae{};t(zy,"Fortified");vC=zy});var vi,CC,FR=n(()=>{ky();vi=class extends qm{};t(vi,"Fortified");CC=vi});var Ly,PC,TC=n(()=>{vr();Ly=class extends Ae{};t(Ly,"Fortifying");PC=Ly});var al,wC=n(()=>{w();Ft();Ca();bC();I();lo();FR();TC();kt();Ri();al=class extends tt{#e;constructor(e,r,o,s=d,a=te,l=mr){super(e,r,o,s,a),this.#e=l}perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{this.unit().moves().set(0),this.unit().setActive(!1),this.unit().setBusy(new vC(new m(()=>!1))),this.#e.register(new CC(this.unit()))},PC),this.ruleRegistry().process(J,this.unit(),this)}};t(al,"Fortify")});var Vm,IC=n(()=>{Pt();w();Vs();Sn();kt();Vm=class extends qs{#e;constructor(e,r,o,s=ee,a=d){super(e,r,o,a),this.#e=s}perform(){new _e(this.unit().player(),this.unit().tile(),this.#e.takeCapitalByCivilization(this.unit().player().civilization().constructor),this.ruleRegistry()),this.unit().destroy(),this.ruleRegistry().process(J,this.unit(),this)}};t(Vm,"FoundCity")});var mo,AC=n(()=>{Vs();mo=class extends _n{perform(){this.unit().moves().subtract(this.unit().moves())}};t(mo,"NoOrders")});var Ny,Fe,_r=n(()=>{ge();Yl();Ny=class extends F{constructor(){super(on)}getByTile(e){return this.getBy("tile",e)}};t(Ny,"TileImprovementRegistry");Fe=new Ny});var sl,BC=n(()=>{w();_r();Ft();lo();kt();Ri();sl=class extends tt{#e;constructor(e,r,o,s=d,a=Fe,l=te){super(e,r,o,s,l),this.#e=a}perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let[r]=this.#e.getByTile(this.from());this.#e.unregister(r)}),this.ruleRegistry().process(J,this.unit(),this)}};t(sl,"Pillage")});var Ze,jy,Wy=n(()=>{nr();Ze=class extends _{};t(Ze,"Forest");jy=Ze});var po,GC,kR=n(()=>{xi();po=class extends Ke{};t(po,"Horse");GC=po});var Hy,UC,MC=n(()=>{vr();Hy=class extends Ae{};t(Hy,"PlantingForest");UC=Hy});var ll,DC=n(()=>{w();nn();Ft();lo();Wm();Wy();kR();kt();Ri();MC();ll=class extends tt{#e;constructor(e,r,o,s=d,a=yt,l=te){super(e,r,o,s,l),this.#e=a}perform(){let[e]=this.ruleRegistry().process(Te,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new jy,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(tl,GC,r),this.#e.unregister(...o),this.from().setTerrain(r)},UC),this.ruleRegistry().process(J,this.unit(),this)}};t(ll,"PlantForest")});var _y,EC,SC=n(()=>{vr();_y=class extends Ae{};t(_y,"Sleeping");EC=_y});var Pa,FC,YR=n(()=>{w();Ft();$e();I();lo();v();SC();Pa=class extends tt{#e;constructor(e,r,o,s=d,a=te,l=W){super(e,r,o,s,a),this.#e=l}perform(){this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new EC(new m(()=>this.from().getSurroundingArea(this.unit().visibility().value()).some(e=>this.#e.getByTile(e).some(r=>r.player()!==this.unit().player()))),new p(()=>{this.unit().setActive(),this.unit().setBusy()})))}};t(Pa,"Sleep");FC=Pa});var Jm,kC=n(()=>{Vs();Jm=class extends qs{perform(){this.unit().setWaiting(),this.unit().cargo().forEach(e=>{e.moves().set(e.movement()),e.activate()})}};t(Jm,"Unload")});var $m=n(()=>{Hb();Vb();Qb();rC();aC();sC();pC();yC();hC();OC();RC();xC();wC();IC();fu();AC();BC();DC();YR();kC()});var Yt,YC,zR=n(()=>{nr();Yt=class extends _{};t(Yt,"Arctic");YC=Yt});var we,zC,LR=n(()=>{nr();we=class extends _{};t(we,"Desert");zC=we});var Me,LC,NR=n(()=>{nr();Me=class extends _{};t(Me,"Hills");LC=Me});var it,NC,jR=n(()=>{nr();it=class extends _{};t(it,"Jungle");NC=it});var We,jC,WR=n(()=>{nr();We=class extends _{};t(We,"Mountains");jC=We});var mt,WC,HR=n(()=>{jO();mt=class extends or{};t(mt,"Ocean");WC=mt});var ne,Ky,qy=n(()=>{nr();ne=class extends _{};t(ne,"River");Ky=ne});var ot,HC,_R=n(()=>{nr();ot=class extends _{};t(ot,"Swamp");HC=ot});var dt,_C,KR=n(()=>{nr();dt=class extends _{};t(dt,"Tundra");_C=dt});var uo=n(()=>{zR();LR();Wy();Hm();NR();jR();WR();HR();yu();qy();_R();KR()});var zt,ml,Zm=n(()=>{ga();zt=class extends Ge{};t(zt,"Air");ml=zt});var nt,Vy,Jy=n(()=>{ga();nt=class extends Ge{};t(nt,"Land");Vy=nt});var j,Jt=n(()=>{Jy();j=class extends Vy{};t(j,"Fortifiable")});var qe,Kn,zl=n(()=>{ga();qe=class extends Ge{};t(qe,"Naval");Kn=qe});var $y,Zy,qR=n(()=>{$y=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}transport(){return this.#e}unit(){return this.#t}};t($y,"TransportManifest");Zy=$y});var Qy,qn,Qm=n(()=>{ge();qR();Qy=class extends F{constructor(){super(Zy)}getByTransport(e){return this.getBy("transport",e)}getByUnit(e){let r=this.getBy("unit",e);if(r.length!==1)throw new TypeError("Wrong number of results.");return r[0]}};t(Qy,"TransportRegistry");qn=new Qy});var Xy,ed,VR=n(()=>{A();Xy=class extends g{};t(Xy,"Stowed");ed=Xy});var td,KC,qC=n(()=>{A();td=class extends g{};t(td,"Unloaded");KC=td});var qY,VC,JC=n(()=>{w();Qm();VR();qR();qC();qY=t(i=>t(class extends i{#e=d;#t=qn;canStow(r){return!this.cargo().includes(r)&&this.hasCapacity()}capacity(){return 0}cargo(){return this.#t.getByTransport(this).map(r=>r.unit())}hasCapacity(){return this.#t.getByTransport(this).length<this.capacity()}hasCargo(){return this.#t.getByTransport(this).length>0}setRuleRegistry(r){this.#e=r}setTransportRegistry(r){this.#t=r}stow(r){return!this.hasCapacity()||!this.canStow(r)?!1:(this.#t.register(new Zy(this,r)),this.#e.process(ed,r,this),!0)}unload(r){try{let o=this.#t.getByUnit(r);return this.#t.unregister(o),this.#e.process(KC,r,this),!0}catch{return!1}}},"Transport"),"Transport"),VC=qY});var $t,Vn,Ll=n(()=>{w();Qm();zl();JC();$t=class extends VC(Kn){constructor(e,r,o,s=d,a=qn){super(e,r,o,s),this.setRuleRegistry(s),this.setTransportRegistry(a)}};t($t,"NavalTransport");Vn=$t});var br,JR=n(()=>{Jy();br=class extends Vy{};t(br,"Worker")});var Jn=n(()=>{Zm();Jt();Jy();zl();Ll();JR()});var sn,$C=n(()=>{xi();sn=class extends Ke{};t(sn,"Coal")});var ln,ZC=n(()=>{xi();ln=class extends Ke{};t(ln,"Fish")});var bi,QC=n(()=>{xi();bi=class extends Ke{};t(bi,"Game")});var mn,XC=n(()=>{xi();mn=class extends Ke{};t(mn,"Gems")});var pn,eP=n(()=>{xi();pn=class extends Ke{};t(pn,"Gold")});var Ci,tP=n(()=>{xi();Ci=class extends Ke{};t(Ci,"Oasis")});var un,rP=n(()=>{xi();un=class extends Ke{};t(un,"Oil")});var cn,iP=n(()=>{xi();cn=class extends Ke{};t(cn,"Seal")});var gu=n(()=>{$C();ZC();QC();XC();eP();kR();tP();rP();iP();Ey()});var rd,Nl,$R=n(()=>{A();rd=class extends g{};t(rd,"Action");Nl=rd});var id,od,ZR=n(()=>{A();id=class extends g{};t(id,"ActionPerformed");od=id});var nd,Xm,QR=n(()=>{A();nd=class extends g{};t(nd,"Discovered");Xm=nd});var ad,sd,XR=n(()=>{Z();w();$R();ZR();QR();ad=class extends k{#e;#t;constructor(e,r=d){super(),this.#e=r,this.#t=e,this.addKey("tile")}action(e){e.perform(),this.#e.process(od,this,e)}actions(e){return this.#e.process(Nl,this,e)}process(e){this.#e.process(Xm,this,e)}tile(){return this.#t}};t(ad,"GoodyHut");sd=ad});var ld,Kr,pl=n(()=>{XR();ge();ld=class extends F{constructor(){super(sd)}getByTile(e){let r=this.filter(o=>o.tile()===e);return r.length===0?null:r[0]}};t(ld,"GoodyHutRegistry");Kr=new ld});var oP=n(()=>{Yl()});var $n=n(()=>{GR();UR();oP();MR();DR()});var md,nP,aP=n(()=>{md=class{#e;#t;#r;constructor(e,r,o){this.#e=o,this.#t=r,this.#r=e}end(){return this.#e}generate(){throw new Error(`PathFinder#generate: Must be overridden in '${this.constructor.name}'.`)}start(){return this.#t}unit(){return this.#r}};t(md,"PathFinder");nP=md});var pd,ud,ex=n(()=>{Qi();aP();pd=class extends He{constructor(){super(nP)}};t(pd,"PathFinderRegistry");ud=new pd});var cd,qr,ul=n(()=>{Z();cd=class extends Ie{};t(cd,"Government");qr=cd});var fd,ep,yd=n(()=>{Qi();ul();fd=class extends He{constructor(){super(qr)}};t(fd,"AvailableGovernmentRegistry");ep=new fd});var dd,hu,tx=n(()=>{A();dd=class extends g{};t(dd,"Availability");hu=dd});var gd,Ou,rx=n(()=>{A();gd=class extends g{};t(gd,"Changed");Ou=gd});var hd,Od,ix=n(()=>{yd();Z();w();tx();rx();hd=class extends k{#e;#t=null;#r;#i;constructor(e,r=ep,o=d){super(),this.#r=e,this.#e=r,this.#i=o,this.addKey("available","current")}available(){return this.#e.filter(e=>this.#i.get(hu).some(r=>r.validate(e,this.#r)))}current(){return this.#t}is(...e){return e.some(r=>this.#t instanceof r)}player(){return this.#r}set(e){this.#t=e,this.#i.process(Ou,this.#r,e)}};t(hd,"PlayerGovernment");Od=hd});var Rd,gt,fn=n(()=>{ge();ix();Rd=class extends F{constructor(){super(Od)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of PlayerGovernments for player.");return r[0]}};t(Rd,"PlayerGovernmentRegistry");gt=new Rd});var xd,vd,ox=n(()=>{nf();Cm();xd=class extends Bs{#e;#t;constructor(e,r=Yn,o=()=>Math.random()){super(e),this.#e=r,this.#t=o}chooseCivilization(e){let r=e[Math.floor(e.length*this.#t())],o=this.player(),s=new r;o.setCivilization(s),this.chooseLeader(s)}chooseLeader(e){let r=this.#e.getByCivilization(e.constructor),o=r[Math.floor(this.#t()*r.length)];e.setLeader(new o)}};t(xd,"AIClient");vd=xd});var sP=n(()=>{FR()});var Ta,lP=n(()=>{ky();Ta=class extends qm{};t(Ta,"Veteran")});var mP=n(()=>{lP()});var Ru=n(()=>{sP();mP()});var Zn,xu,bd=n(()=>{M();Zn=class extends x{};t(Zn,"AdvancedFlight");xu=Zn});var co,pP,nx=n(()=>{M();co=class extends x{};t(co,"Alphabet");pP=co});var Pi,uP,ax=n(()=>{M();Pi=class extends x{};t(Pi,"Astronomy");uP=Pi});var Qn,cP,sx=n(()=>{M();Qn=class extends x{};t(Qn,"AtomicTheory");cP=Qn});var Zt,vu,Cd=n(()=>{M();Zt=class extends x{};t(Zt,"Automobile");vu=Zt});var Ti,fP,lx=n(()=>{M();Ti=class extends x{};t(Ti,"Banking");fP=Ti});var fo,yP,mx=n(()=>{M();fo=class extends x{};t(fo,"BridgeBuilding");yP=fo});var yo,Pd,Td=n(()=>{M();yo=class extends x{};t(yo,"BronzeWorking");Pd=yo});var wi,dP,px=n(()=>{M();wi=class extends x{};t(wi,"CeremonialBurial");dP=wi});var yn,gP,ux=n(()=>{M();yn=class extends x{};t(yn,"Chemistry");gP=yn});var wa,bu,wd=n(()=>{M();wa=class extends x{};t(wa,"Chivalry");bu=wa});var Cr,hP,cx=n(()=>{M();Cr=class extends x{};t(Cr,"CodeOfLaws");hP=Cr});var dn,Cu,Id=n(()=>{M();dn=class extends x{};t(dn,"Combustion");Cu=dn});var wt,OP,fx=n(()=>{M();wt=class extends x{};t(wt,"Communism");OP=wt});var Ii,RP,yx=n(()=>{M();Ii=class extends x{};t(Ii,"Computers");RP=Ii});var Ia,jl,Ad=n(()=>{M();Ia=class extends x{};t(Ia,"Conscription");jl=Ia});var Vr,xP,dx=n(()=>{M();Vr=class extends x{};t(Vr,"Construction");xP=Vr});var go,vP,gx=n(()=>{M();go=class extends x{};t(go,"Corporation");vP=go});var Ai,bP,hx=n(()=>{M();Ai=class extends x{};t(Ai,"Currency");bP=Ai});var ho,CP,Ox=n(()=>{M();ho=class extends x{};t(ho,"Democracy");CP=ho});var Pr,PP,Rx=n(()=>{M();Pr=class extends x{};t(Pr,"Electricity");PP=Pr});var ht,TP,xx=n(()=>{M();ht=class extends x{};t(ht,"Electronics");TP=ht});var gn,wP,vx=n(()=>{M();gn=class extends x{};t(gn,"Engineering");wP=gn});var hn,IP,bx=n(()=>{M();hn=class extends x{};t(hn,"Explosives");IP=hn});var Xn,AP,Cx=n(()=>{M();Xn=class extends x{};t(Xn,"Feudalism");AP=Xn});var ea,Bd,Gd=n(()=>{M();ea=class extends x{};t(ea,"Flight");Bd=ea});var Aa,BP,Px=n(()=>{M();Aa=class extends x{};t(Aa,"FusionPower");BP=Aa});var On,GP,Tx=n(()=>{M();On=class extends x{};t(On,"GeneticEngineering");GP=On});var pr,tp,Ud=n(()=>{M();pr=class extends x{};t(pr,"Gunpowder");tp=pr});var Ba,Md,Dd=n(()=>{M();Ba=class extends x{};t(Ba,"HorsebackRiding");Md=Ba});var ur,Pu,Ed=n(()=>{M();ur=class extends x{};t(ur,"Industrialization");Pu=ur});var Tr,UP,wx=n(()=>{M();Tr=class extends x{};t(Tr,"Invention");UP=Tr});var Rn,Sd,Fd=n(()=>{M();Rn=class extends x{};t(Rn,"IronWorking");Sd=Rn});var Ga,kd,Yd=n(()=>{M();Ga=class extends x{};t(Ga,"LaborUnion");kd=Ga});var wr,MP,Ix=n(()=>{M();wr=class extends x{};t(wr,"Literacy");MP=wr});var Jr,Tu,zd=n(()=>{M();Jr=class extends x{};t(Jr,"Magnetism");Tu=Jr});var Oo,Ld,Nd=n(()=>{M();Oo=class extends x{};t(Oo,"MapMaking");Ld=Oo});var Qt,DP,Ax=n(()=>{M();Qt=class extends x{};t(Qt,"Masonry");DP=Qt});var Ir,jd,Wd=n(()=>{M();Ir=class extends x{};t(Ir,"MassProduction");jd=Ir});var Bi,Hd,_d=n(()=>{M();Bi=class extends x{};t(Bi,"Mathematics");Hd=Bi});var Gi,EP,Bx=n(()=>{M();Gi=class extends x{};t(Gi,"Medicine");EP=Gi});var xn,wu,Kd=n(()=>{M();xn=class extends x{};t(xn,"Metallurgy");wu=xn});var $r,SP,Gx=n(()=>{M();$r=class extends x{};t($r,"Monarchy");SP=$r});var Xt,FP,Ux=n(()=>{M();Xt=class extends x{};t(Xt,"Mysticism");FP=Xt});var Ui,Iu,qd=n(()=>{M();Ui=class extends x{};t(Ui,"Navigation");Iu=Ui});var Zr,kP,Mx=n(()=>{M();Zr=class extends x{};t(Zr,"NuclearFission");kP=Zr});var Ro,YP,Dx=n(()=>{M();Ro=class extends x{};t(Ro,"NuclearPower");YP=Ro});var Qr,zP,Ex=n(()=>{M();Qr=class extends x{};t(Qr,"Philosophy");zP=Qr});var Mi,LP,Sx=n(()=>{M();Mi=class extends x{};t(Mi,"Physics");LP=Mi});var vn,Au,Vd=n(()=>{M();vn=class extends x{};t(vn,"Plastics");Au=vn});var bn,NP,Fx=n(()=>{M();bn=class extends x{};t(bn,"Pottery");NP=bn});var Xr,jP,kx=n(()=>{M();Xr=class extends x{};t(Xr,"Railroad");jP=Xr});var Cn,WP,Yx=n(()=>{M();Cn=class extends x{};t(Cn,"Recycling");WP=Cn});var Di,HP,zx=n(()=>{M();Di=class extends x{};t(Di,"Refining");HP=Di});var It,_P,Lx=n(()=>{M();It=class extends x{};t(It,"Religion");_P=It});var Pn,Ua,Bu=n(()=>{M();Pn=class extends x{};t(Pn,"Robotics");Ua=Pn});var ta,Jd,$d=n(()=>{M();ta=class extends x{};t(ta,"Rocketry");Jd=ta});var xo,Zd,Qd=n(()=>{M();xo=class extends x{};t(xo,"SpaceFlight");Zd=xo});var ra,Xd,eg=n(()=>{M();ra=class extends x{};t(ra,"SteamEngine");Xd=ra});var ia,tg,rg=n(()=>{M();ia=class extends x{};t(ia,"Steel");tg=ia});var vo,KP,Nx=n(()=>{M();vo=class extends x{};t(vo,"Superconductor");KP=vo});var Ei,qP,jx=n(()=>{M();Ei=class extends x{};t(Ei,"TheRepublic");qP=Ei});var Ma,ig,og=n(()=>{M();Ma=class extends x{};t(Ma,"TheWheel");ig=Ma});var bo,VP,Wx=n(()=>{M();bo=class extends x{};t(bo,"TheoryOfGravity");VP=bo});var Tn,ng,ag=n(()=>{M();Tn=class extends x{};t(Tn,"Trade");ng=Tn});var cr,JP,Hx=n(()=>{M();cr=class extends x{};t(cr,"University");JP=cr});var Si,sg,lg=n(()=>{M();Si=class extends x{};t(Si,"Writing");sg=Si});var Ar=n(()=>{bd();nx();ax();sx();Cd();lx();mx();Td();px();ux();wd();cx();Id();fx();yx();Ad();dx();gx();hx();Ox();Rx();xx();vx();bx();Cx();Gd();Px();Tx();Ud();Dd();Ed();wx();Fd();Yd();Ix();zd();Nd();Ax();Wd();_d();Bx();Kd();Gx();Ux();qd();Mx();Dx();Ex();Sx();Vd();Fx();kx();Yx();zx();Lx();Bu();$d();Qd();eg();rg();Nx();jx();og();Wx();ag();Hx();lg()});var Fi,$P=n(()=>{ul();Fi=class extends qr{};t(Fi,"Anarchy")});var At,ZP=n(()=>{ul();At=class extends qr{};t(At,"Communism")});var pt,QP=n(()=>{ul();pt=class extends qr{};t(pt,"Democracy")});var er,XP=n(()=>{ul();er=class extends qr{};t(er,"Despotism")});var ut,eT=n(()=>{ul();ut=class extends qr{};t(ut,"Monarchy")});var Ot,tT=n(()=>{ul();Ot=class extends qr{};t(Ot,"Republic")});var wn=n(()=>{$P();ZP();QP();XP();eT();tT()});var ei,rT=n(()=>{Se();ei=class extends L{};t(ei,"Aqueduct")});var fr,iT=n(()=>{Se();fr=class extends L{};t(fr,"Bank")});var ti,oT=n(()=>{Se();ti=class extends L{};t(ti,"Barracks")});var yr,nT=n(()=>{Se();yr=class extends L{};t(yr,"Cathedral")});var Co,aT=n(()=>{Se();Co=class extends L{};t(Co,"CityWalls")});var ri,sT=n(()=>{Se();ri=class extends L{};t(ri,"Colosseum")});var Br,lT=n(()=>{Se();Br=class extends L{};t(Br,"Courthouse")});var tr,mT=n(()=>{Se();tr=class extends L{};t(tr,"Factory")});var ii,pT=n(()=>{Se();ii=class extends L{};t(ii,"Granary")});var Bt,uT=n(()=>{Se();Bt=class extends L{};t(Bt,"HydroPlant")});var Gr,cT=n(()=>{Se();Gr=class extends L{};t(Gr,"Library")});var Ur,fT=n(()=>{Se();Ur=class extends L{};t(Ur,"ManufacturingPlant")});var dr,yT=n(()=>{Se();dr=class extends L{};t(dr,"Marketplace")});var Po,dT=n(()=>{Se();Po=class extends L{};t(Po,"MassTransit")});var Gt,gT=n(()=>{Se();Gt=class extends L{};t(Gt,"NuclearPlant")});var Rt,hT,_x=n(()=>{Se();Rt=class extends L{};t(Rt,"Palace");hT=Rt});var Ut,OT=n(()=>{Se();Ut=class extends L{};t(Ut,"PowerPlant")});var To,RT=n(()=>{Se();To=class extends L{};t(To,"RecyclingCenter")});var wo,xT=n(()=>{Se();wo=class extends L{};t(wo,"SdiDefence")});var Lt,vT=n(()=>{Se();Lt=class extends L{};t(Lt,"Temple")});var Mr,bT=n(()=>{Se();Mr=class extends L{};t(Mr,"University")});var ki=n(()=>{rT();iT();oT();nT();aT();sT();lT();mT();pT();uT();cT();fT();yT();dT();gT();_x();OT();RT();xT();vT();bT()});var mg,cl,CT=n(()=>{ex();kc();mg=class extends hm{#e=1/0;end(){return this.entries()[this.length-1]}static for(e,r,o,s=ud){let[a]=s.entries().map(l=>new l(e,r,o)).map(l=>l.generate()).sort((l,u)=>l.movementCost()-u.movementCost());return a&&(a.shift(),a)}movementCost(){return this.#e}setMovementCost(e){this.#e=e}push(...e){e.forEach(r=>{let o=this.end();if(this.length>0&&!r.isNeighbourOf(o))throw new TypeError(`Tile#push: Invalid element passed, ${r.x()},${r.y()} is not a neighbour of ${o.x()},${o.y()}.`);super.push(r)})}start(){return this.entries()[0]}};t(mg,"Path");cl=mg});var Io,PT=n(()=>{Jt();Io=class extends j{};t(Io,"Artillery")});var Ao,TT=n(()=>{zl();Ao=class extends Kn{};t(Ao,"Battleship")});var oi,wT=n(()=>{Zm();oi=class extends ml{};t(oi,"Bomber")});var Yi,IT=n(()=>{Jt();Yi=class extends j{};t(Yi,"Cannon")});var Bo,AT=n(()=>{Jt();Bo=class extends j{};t(Bo,"Caravan")});var Go,BT=n(()=>{Zm();Ll();Go=class extends Vn{canStow(e){return e instanceof ml&&super.canStow(e)}capacity(){return 8}};t(Go,"Carrier")});var zi,GT=n(()=>{Jt();zi=class extends j{};t(zi,"Catapult")});var Li,UT=n(()=>{Jt();Li=class extends j{};t(Li,"Chariot")});var Uo,MT=n(()=>{zl();Uo=class extends Kn{};t(Uo,"Cruiser")});var Mo,DT=n(()=>{Jt();Mo=class extends j{};t(Mo,"Diplomat")});var gr,ET=n(()=>{Zm();gr=class extends ml{};t(gr,"Fighter")});var Ni,ST=n(()=>{Ll();Ni=class extends Vn{capacity(){return 4}};t(Ni,"Frigate")});var Dr,FT=n(()=>{Jt();Dr=class extends j{};t(Dr,"Horseman")});var ji,kT=n(()=>{zl();ji=class extends Kn{};t(ji,"Ironclad")});var Wi,YT=n(()=>{Jt();Wi=class extends j{};t(Wi,"Knight")});var Do,zT=n(()=>{Jt();Do=class extends j{};t(Do,"MechanizedInfantry")});var Hi,LT=n(()=>{Jt();Hi=class extends j{};t(Hi,"Musketman")});var hr,NT=n(()=>{Zm();hr=class extends ml{};t(hr,"Nuclear")});var Eo,jT=n(()=>{Jt();Eo=class extends j{};t(Eo,"Rifleman")});var _i,WT=n(()=>{Ll();_i=class extends Vn{capacity(){return 3}};t(_i,"Sail")});var Ve,HT,Kx=n(()=>{JR();Ve=class extends br{};t(Ve,"Settlers");HT=Ve});var Ki,_T=n(()=>{Jt();Ki=class extends j{};t(Ki,"Spearman")});var ni,KT=n(()=>{zl();ni=class extends Kn{};t(ni,"Submarine")});var Er,qT=n(()=>{Jt();Er=class extends j{};t(Er,"Swordman")});var So,VT=n(()=>{Jt();So=class extends j{};t(So,"Tank")});var Fo,JT=n(()=>{Ll();Fo=class extends Vn{capacity(){return 8}};t(Fo,"Transport")});var Sr,$T=n(()=>{Ll();Sr=class extends Vn{capacity(){return 2}};t(Sr,"Trireme")});var ko,ZT=n(()=>{Jt();ko=class extends j{};t(ko,"Warrior")});var Yo=n(()=>{PT();TT();wT();IT();AT();BT();GT();UT();MT();DT();ET();ST();FT();kT();YT();zT();LT();NT();jT();WT();Kx();_T();KT();qT();VT();JT();$T();ZT()});var pg,ug,oa,rp=n(()=>{Gm();$m();Fn();St();Xe();uo();q();xa();Jn();gu();pl();$n();Cm();ex();fn();ze();Il();ao();w();nn();_r();Ca();$e();ox();Dm();Np();Gf();Ru();Ts();Ar();wn();ki();CT();Cc();Yo();Xi();ga();Be();Ym();pg=t((i,e,r=H)=>{let o=r.getByTile(i);return o===null?!1:o.player()===e},"hasPlayerCity"),ug=class extends vd{#e=e=>{let r=this.#A.option("earth",!1),o=this.#p.getByPlayer(this.player()).length===0;if(r&&o)return!0;let s=this.#I.getByTerrain(e.terrain());return(e.terrain()instanceof Re||e.terrain()instanceof ne||e.terrain()instanceof me||s.some(a=>a instanceof Ci)||s.some(a=>a instanceof bi))&&e.getSurroundingArea().score(this.player(),[[Q,4],[V,2],[le,1]])>=160&&!e.getSurroundingArea(4).filter(a=>this.#p.getByTile(a)!==null).length};#t=e=>[we,me,Re,ne].some(r=>e.terrain()instanceof r)&&!this.#O.getByTile(e).some(r=>r instanceof Ue)&&e.getSurroundingArea().some(r=>pg(r,this.player(),this.#p))&&[...e.getAdjacent(),e].some(r=>r.terrain()instanceof ne||r.isCoast()||this.#O.getByTile(r).some(o=>o instanceof Ue)&&this.#p.getByTile(r)===null);#r=e=>[Me,We].some(r=>e.terrain()instanceof r)&&!this.#O.getByTile(e).some(r=>r instanceof rt)&&e.getSurroundingArea().some(r=>pg(r,this.player(),this.#p));#i=e=>!this.#O.getByTile(e).some(r=>r instanceof je)&&e.getSurroundingArea().some(r=>pg(r,this.player(),this.#p));#o=new Map;#n=new Map;#a=new Map;#s=[];#l=[];#m=[];#g=[];#f=[];#y=[];#u=[];#p;#v;#R;#b;#d;#C;#P;#T;#h;#w;#I;#O;#x;#c;#A;constructor(e,r=H,o=Et,s=ie,a=Kr,l=Yn,u=ud,c=gt,f=N,y=fi,h=pe,G=d,D=yt,B=Fe,E=mr,Y=W,ue=b){super(e,l),this.#p=r,this.#v=o,this.#R=s,this.#b=a,this.#d=u,this.#C=c,this.#P=f,this.#T=y,this.#h=h,this.#w=G,this.#I=D,this.#x=E,this.#O=B,this.#c=Y,this.#A=ue}scoreUnitMove(e,r){let o=e.actions(r),{attack:s,buildIrrigation:a,buildMine:l,buildRoad:u,captureCity:c,disembark:f,embark:y,fortify:h,foundCity:G,noOrders:D}=o.reduce((ce,Je)=>({...ce,[Je.constructor.name.replace(/^./,mi=>mi.toLowerCase())]:Je}),{});if(!o.length||o.length===1&&D||e instanceof j&&o.length===2&&h&&D)return-1;let B=0;this.#b.getByTile(r)!==null&&(B+=60),(G&&this.#e(r)||l&&this.#r(r)||a&&this.#t(r)||u&&this.#i(r))&&(B+=24);let Y=this.#c.getByTile(r).sort((ce,Je)=>Je.defence().value()-ce.defence().value()),[ue]=Y,Dt=Y.some(ce=>ce.player()===this.player());e instanceof $t&&e.hasCapacity()&&Y.length&&Dt&&(B+=10),e instanceof $t&&e.hasCargo()&&r.isCoast()&&r.isWater()&&(B+=16),y&&(B+=16),f&&(B+=16),c&&(B+=100),s&&e.attack()>ue.defence()&&(B+=24*(e.attack().value()-ue.defence().value())),s&&e.attack().value()>=ue.defence().value()&&(B+=16),s&&e.attack().value()>=ue.defence().value()*(2/3)&&(B+=8);let Lr=this.#h.getByPlayer(this.player()),om=r.getNeighbours().filter(ce=>!Lr.includes(ce)).length;om>0&&(B+=om*3);let nm=this.#a.get(e);return nm instanceof he&&r.distanceFrom(nm)<e.tile().distanceFrom(nm)&&(B+=14),(this.#o.get(e)||[]).includes(r)||(B*=4),B}moveUnit(e){let r=0;for(;e.active()&&e.moves().value()>=.1;){if(r++>1e3){console.log("SimpleAIClient#moveUnit: loopCheck: aborting"),console.log(`${e.player().civilization().name()} ${e.constructor.name}`),console.log(e.actions()),console.log(e.actionsForNeighbours()),e.action(new mo(e.tile(),e.tile(),e));return}let o=this.#n.get(e);if(o){let f=o.shift(),[y]=e.actions(f).filter(h=>h instanceof Vt);if(y){e.action(y),o.length===0&&this.#n.delete(e);return}if(o.length>0){let h=cl.for(e,e.tile(),o.end());if(h){this.#n.set(e,h);continue}}this.#n.delete(e)}let[s]=e.tile().getNeighbours().map(f=>[f,this.scoreUnitMove(e,f)]).filter(([,f])=>f>-1).sort(([,f],[,y])=>y-f||Math.floor(Math.random()*3)-1).map(([f])=>f);if(!s){e.action(new mo(e.tile(),e.tile(),e));return}let a=e.actions(s),[l]=a,u=this.#o.get(e)||[],c=this.#a.get(e);if(!l){e.action(new mo(e.tile(),e.tile(),e));return}c===s&&this.#a.delete(e),u.push(s),this.#o.set(e,u.slice(-50)),e.action(l)}e.moves().value()>0&&e.action(new mo(e.tile(),e.tile(),e))}preProcessTurn(){this.#s.splice(0),this.#l.splice(0),this.#m.splice(0),this.#g.splice(0),this.#f.splice(0),this.#y.splice(0),this.#u.splice(0);let e=this.#h.getByPlayer(this.player());e.entries().forEach(r=>{let o=r.tile(),s=this.#p.getByTile(o),a=this.#c.getBy("tile",o),l=this.#u.includes(o)&&![...this.#a.values(),...[...this.#n.values()].map(u=>u.end())].includes(o);s&&s.player()===this.player()&&!a.length&&!this.#u.includes(o)&&!l?this.#u.push(o):s&&s.player()!==this.player()&&s.originalPlayer()===this.player()?this.#s.push(o):s&&s.player()!==this.player()&&!this.#l.includes(o)?this.#l.push(o):a.length&&a.some(u=>u.player()!==this.player())&&this.#m.includes(o)?this.#m.push(o):o.isLand()&&o.getNeighbours().some(u=>!e.includes(u))&&!this.#f.includes(o)&&!l?this.#f.push(o):o.isWater()&&o.getNeighbours().some(u=>!e.includes(u))&&this.#y.includes(o)&&!l&&this.#y.push(o),this.#e(o)&&this.#g.includes(o)&&!l&&this.#g.push(o)}),this.#p.getByPlayer(this.player()).forEach(r=>{let o=this.#c.getByTile(r.tile());Ls(r,this.#h,this.#R),!o.length&&!this.#u.includes(r.tile())&&this.#u.push(r.tile())})}takeTurn(){return new Promise((e,r)=>{try{let o=0;this.preProcessTurn();let[s]=this.#C.filter(l=>l.player()===this.player()),[a]=this.#P.filter(l=>l.player()===this.player());for(a.completed($r)&&!s.is(ut)&&s.set(new ut);this.player().hasMandatoryActions();){let l=this.player().mandatoryAction(),u=l.value();if(o++>1e3){console.log(""),console.log(""),console.log(u),u instanceof Ge&&(console.log(u.actions()),u.tile().getNeighbours().forEach(c=>console.log(u.actions(c))),console.log(u.active()),console.log(u.busy()),console.log(u.moves().value()),console.log(this.#x.getByUnit(u))),u.action(new mo(u.tile(),u.tile(),u)),console.error("SimpleAIClient: Couldn't pick an action to do.");break}if(u instanceof Ge){let c=u,f=c.tile(),y=this.#a.get(c),h=c.actions(),{buildIrrigation:G,buildMine:D,buildRoad:B,fortify:E,foundCity:Y,unload:ue}=h.reduce((ke,ce)=>({...ke,[ce.constructor.name.replace(/^./,Je=>Je.toLowerCase())]:ce}),{}),Dt=this.#c.getByTile(f);if(this.#o.get(c)||this.#o.set(c,[c.tile()]),c instanceof $t&&ue&&f.isCoast()&&c.cargo().some(ke=>!f.getNeighbours().some(ce=>(this.#o.get(ke)||[]).includes(ce)))){c.action(ue),c.setWaiting();continue}if(c instanceof br){Y&&this.#e(f)?c.action(Y):G&&this.#t(f)?c.action(G):D&&this.#r(f)?c.action(D):B&&this.#i(f)?c.action(B):!y&&this.#g.length&&this.#a.set(c,this.#g.shift()),this.moveUnit(c);continue}let[om]=Dt.filter(ke=>this.#x.getByUnit(ke).some(ce=>ce instanceof vi)&&c.defence()>ke.defence()),nm=this.#p.getByTile(f);if(E&&nm&&(om||Dt.length<=Math.ceil(this.#R.getByCity(nm).size()/5))){c.action(E),om&&om.activate();continue}if(!y){if(c instanceof j&&c.defence().value()>0&&this.#u.length>0){let[ke]=this.#u.sort((Je,mi)=>Je.distanceFrom(c.tile())-mi.distanceFrom(c.tile())),ce=cl.for(c,c.tile(),ke,this.#d);ce&&(this.#u.splice(this.#u.indexOf(ke),1),this.#n.set(c,ce))}else if(c.attack().value()>0&&this.#s.length>0){let[ke]=this.#s.filter(Je=>c instanceof nt&&Je.isLand()).sort((Je,mi)=>Je.distanceFrom(c.tile())-mi.distanceFrom(c.tile())),ce=cl.for(c,c.tile(),ke,this.#d);ce&&(this.#s.splice(this.#s.indexOf(ke),1),this.#n.set(c,ce))}else if(c.attack().value()>0&&this.#m.length>0){let[ke]=this.#m.filter(Je=>c instanceof nt&&Je.isLand()||c instanceof qe&&Je.isWater()).sort((Je,mi)=>Je.distanceFrom(c.tile())-mi.distanceFrom(c.tile())),ce=cl.for(c,c.tile(),ke,this.#d);ce&&(this.#m.splice(this.#m.indexOf(ke),1),this.#n.set(c,ce))}else if(c instanceof nt&&c.attack().value()>0&&this.#l.length>0){let[ke]=this.#l.sort((Je,mi)=>Je.distanceFrom(c.tile())-mi.distanceFrom(c.tile())),ce=cl.for(c,c.tile(),ke,this.#d);ce&&(this.#l.splice(this.#l.indexOf(ke),1),this.#n.set(c,ce))}else if(c instanceof nt&&this.#f.length>0){let[ke]=this.#f.sort((Je,mi)=>Je.distanceFrom(c.tile())-mi.distanceFrom(c.tile())),ce=cl.for(c,c.tile(),ke,this.#d);ce&&(this.#f.splice(this.#f.indexOf(ke),1),this.#n.set(c,ce))}else if(c instanceof qe&&this.#y.length>0){let[ke]=this.#y.sort((Je,mi)=>Je.distanceFrom(c.tile())-mi.distanceFrom(c.tile())),ce=cl.for(c,c.tile(),ke,this.#d);ce&&(this.#y.splice(this.#y.indexOf(ke),1),this.#n.set(c,ce))}}this.moveUnit(c);continue}if(u instanceof Ps){this.buildItemInCity(u.city());continue}if(u instanceof um){let c=u.available();c.length&&u.research(c[Math.floor(c.length*Math.random())]);continue}if(l instanceof Bf)break;console.log(`Can't process: '${u.constructor.name}'`);break}e()}catch(o){if(typeof o=="string"){r(new Error(o));return}if(o instanceof Error){r(o);return}r(new Error(`An unknown error occurred: ${o}`))}})}buildItemInCity(e){let r=e.tile(),o=this.#v.getByCity(e),s=this.#c.getByTile(r),a=o.available(),l=[Rt,Ve],u=a.filter(E=>!l.includes(E.item())&&!Object.prototype.isPrototypeOf.call(Oe,E.item())),c=a.filter(E=>Object.prototype.isPrototypeOf.call(Oe,E.item())),f=u.filter(E=>Object.prototype.isPrototypeOf.call(Ge,E.item())),y=u[Math.floor(u.length*Math.random())].item(),h=t(E=>{let[[Y]]=f.map(ue=>{let Dt=ue.item(),Lr=new E;return this.#w.process(ks,Dt,Lr),[Dt,Lr]}).sort(([,ue],[,Dt])=>Dt.value()-ue.value());return Y},"getUnitByYield"),G=(E=>()=>E||(E=h(di)))(),D=(E=>()=>E||(E=h(oo)))();if(this.#c.getByTile(r).length<2&&G()){o.build(G());return}let B=this.#R.getByCity(o.city());if(a.some(E=>E.item()===Ve)&&!this.#c.getByCity(o.city()).some(E=>E instanceof Ve)&&this.#c.getByPlayer(this.player()).filter(E=>E instanceof Ve).length<3&&B.size()>1){o.build(Ve);return}if(this.#s.length>0||this.#l.length>0||this.#m.length>4){o.build(D());return}if(s.filter(E=>this.#x.getByUnit(E).filter(Y=>Y instanceof vi)).length<2||this.#u.length){o.build(G());return}if(o.city().yields().filter(E=>E instanceof V).some(E=>E.value()>4)){let E=c.map(Y=>Y.item());o.build(E[Math.floor(Math.random()*E.length)])}y&&o.build(y)}cityLost(e,r,o){if(!r)return;let s=this.#h.getByPlayer(this.player());if(o){this.#l.push(...s.entries().filter(a=>pg(a.tile(),this.player(),this.#p)).map(a=>a.tile())),this.#m.push(...s.entries().filter(a=>this.#c.getByTile(a.tile()).some(l=>l.player()===r)).map(a=>a.tile()));return}this.#s.push(e.tile())}unitDestroyed(e,r){let o=this.#p.getByTile(e.tile()),s=this.#c.getByTile(e.tile());o&&o.player()===this.player()&&s.length<2&&(this.buildItemInCity(o),this.#T.getByPlayerAndType(this.player(),ro).buy(o))}};t(ug,"SimpleAIClient");oa=ug});var cg,zo,Wl=n(()=>{ge();nf();cg=class extends F{constructor(){super(cb)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of Clients for Player.");return r[0]}};t(cg,"ClientRegistry");zo=new cg});var Da,Hl,ip=n(()=>{Kt();Da=class extends fe{};t(Da,"American");Hl=Da});var VY={};var QT=n(()=>{ip();ar();sr();Object.entries({people:"American",nation:"America",colors:["#0055A4","#FFF"]}).forEach(([i,e])=>be.register(new ve(Hl,i,e)))});var JY={};var XT=n(()=>{ip();_t();Pt();["Washington","New York","Los Angeles","Chicago","Houston","Phoenix","Philadelphia","San Antonio","San Diego","Dallas","San Jose","Austin","Jacksonville","Fort Worth","Columbus","San Francisco","Charlotte","Indianapolis","Seattle","Denver","Boston","El Paso","Detroit","Nashville","Portland","Memphis","Oklahoma City","Las Vegas","Louisville","Baltimore","Milwaukee","Albuquerque","Tucson","Fresno","Mesa","Sacramento","Atlanta","Kansas City","Colorado Springs","Miami","Raleigh","Omaha","Long Beach","Virginia Beach","Oakland","Minneapolis","Tulsa","Arlington","Tampa","New Orleans","Wichita","Cleveland","Bakersfield","Aurora","Anaheim","Honolulu","Santa Ana","Riverside","Corpus Christi","Lexington","Stockton","Henderson","Saint Paul","St. Louis","Cincinnati","Pittsburgh","Greensboro","Anchorage","Plano","Lincoln","Orlando","Irvine","Newark","Toledo","Durham","Chula Vista","Fort Wayne","Jersey City","St. Petersburg","Laredo","Madison","Chandler","Buffalo","Lubbock","Scottsdale","Reno","Glendale","Gilbert","Winston\u2013Salem","North Las Vegas","Norfolk","Chesapeake","Garland","Irving","Hialeah","Fremont","Boise","Richmond","Baton Rouge","Spokane","Des Moines","Tacoma","San Bernardino","Modesto","Fontana","Santa Clarita","Birmingham","Oxnard","Fayetteville","Moreno Valley","Rochester","Glendale","Huntington Beach","Salt Lake City","Grand Rapids","Amarillo","Yonkers","Aurora","Montgomery","Akron","Little Rock","Huntsville","Augusta","Port St. Lucie","Grand Prairie","Columbus","Tallahassee","Overland Park","Tempe","McKinney","Mobile","Cape Coral","Shreveport","Frisco","Knoxville","Worcester","Brownsville","Vancouver","Fort Lauderdale","Sioux Falls","Ontario","Chattanooga","Providence","Newport News","Rancho Cucamonga","Santa Rosa","Oceanside","Salem","Elk Grove","Garden Grove","Pembroke Pines","Peoria","Eugene","Corona","Cary","Springfield","Fort Collins","Jackson","Alexandria","Hayward","Lancaster","Lakewood","Clarksville","Palmdale","Salinas","Springfield","Hollywood","Pasadena","Sunnyvale","Macon","Kansas City","Pomona","Escondido","Killeen","Naperville","Joliet","Bellevue","Rockford","Savannah","Paterson","Torrance","Bridgeport","McAllen","Mesquite","Syracuse","Midland","Pasadena","Murfreesboro","Miramar","Dayton","Fullerton","Olathe","Orange","Thornton","Roseville","Denton","Waco","Surprise","Carrollton","West Valley City","Charleston","Warren","Hampton","Gainesville","Visalia","Coral Springs","Columbia","Cedar Rapids","Sterling Heights","New Haven","Stamford","Concord","Kent","Santa Clara","Elizabeth","Round Rock","Thousand Oaks","Lafayette","Athens","Topeka","Simi Valley","Fargo","Norman","Columbia","Abilene","Wilmington","Hartford","Victorville","Pearland","Vallejo","Ann Arbor","Berkeley","Allentown","Richardson","Odessa","Arvada","Cambridge","Sugar Land","Beaumont","Lansing","Evansville","Rochester","Independence","Fairfield","Provo","Clearwater","College Station","West Jordan","Carlsbad","El Monte","Murrieta","Temecula","Springfield","Palm Bay","Costa Mesa","Westminster","North Charleston","Miami Gardens","Manchester","High Point","Downey","Clovis","Pompano Beach","Pueblo","Elgin","Lowell","Antioch","West Palm Beach","Peoria","Everett","Ventura","Centennial","Lakeland","Gresham","Richmond","Billings","Inglewood","Broken Arrow","Sandy Springs","Jurupa Valley","Hillsboro","Waterbury","Santa Maria","Boulder","Greeley","Daly City","Meridian","Lewisville","Davie","West Covina","League City","Tyler","Norwalk","San Mateo","Green Bay","Wichita Falls","Sparks","Lakewood","Burbank","Rialto","Allen","El Cajon","Las Cruces","Renton","Davenport","South Bend","Vista","Tuscaloosa","Clinton","Edison","Woodbridge","San Angelo","Kenosha","Vacaville"].forEach((i,e)=>ee.register(new re(i,Hl,e===0)))});var tw=P(ew=>{"use strict";Object.defineProperty(ew,"__esModule",{value:!0});QT();XT()});var Ea,op,Gu=n(()=>{Kt();Ea=class extends fe{};t(Ea,"Aztec");op=Ea});var $Y={};var rw=n(()=>{Gu();ar();sr();Object.entries({people:"Aztec",nation:"Aztec",colors:["#A1DAB5","#EA6B76"]}).forEach(([i,e])=>be.register(new ve(op,i,e)))});var ZY={};var iw=n(()=>{Gu();_t();Pt();["Tenochtitlan","Teotihuacan","Tlatelolco","Texcoco","Tlaxcala","Calixtlahuaca","Xochicalco","Tlacopan","Atzcapotzalco","Tzintzuntzan","Malinalco","Tula","Tamuin","Teayo","Cempoala","Chalco","Tlalmanalco","Ixtapaluca","Huexotla","Tepexpan","Tepetlaoxtoc","Chiconautla","Zitlaltepec","Coyotepec","Tequixquiac","Jilotzingo","Tlapanaloya","Tultitan","Ecatepec","Coatepec","Chalchiuites","Chiauhita","Chapultepec","Itzapalapa","Ayotzinco","Iztapam"].forEach((i,e)=>ee.register(new re(i,op,e===0)))});var nw=P(ow=>{"use strict";Object.defineProperty(ow,"__esModule",{value:!0});rw();iw()});var Sa,np,Uu=n(()=>{Kt();Sa=class extends fe{};t(Sa,"Babylonian");np=Sa});var QY={};var aw=n(()=>{Uu();ar();sr();Object.entries({people:"Babylonian",nation:"Babylon",colors:["#D0B8A6","#2f7b00"]}).forEach(([i,e])=>be.register(new ve(np,i,e)))});var XY={};var sw=n(()=>{Uu();_t();Pt();["Babilim","Eshnunna","Diniktum","Tutub","Der","Sippar","Kutha","Jemdet Nasr","Kish","Borsippa","Mashkan-shapir","Dilbat","Nippur","Marad","Adab","Isin","Kisurra","Shuruppak","Bad-tibira","Zabalam","Umma","Girsu","Lagash","Urum","Uruk","Larsa","Ur","Kuara","Eridu","Akshak","Akkad"].forEach((i,e)=>ee.register(new re(i,np,e===0)))});var mw=P(lw=>{"use strict";Object.defineProperty(lw,"__esModule",{value:!0});aw();sw()});var Fa,ap,Mu=n(()=>{Kt();Fa=class extends fe{};t(Fa,"Chinese");ap=Fa});var ez={};var pw=n(()=>{Mu();ar();sr();Object.entries({people:"Chinese",nation:"China",colors:["#ee1c25","#ff0"]}).forEach(([i,e])=>be.register(new ve(ap,i,e)))});var tz={};var uw=n(()=>{Mu();_t();Pt();["Beijing","Shanghai","Chongqing","Tianjin","Guangzhou","Shenzhen\u2020","Chengdu","Nanjing","Wuhan","Xi'an","Hangzhou","Dongguan","Foshan","Shenyang","Harbin","Qingdao","Dalian","Jinan","Zhengzhou","Changsha","Kunming","Changchun","\xDCr\xFCmqi","Shantou","Hefei","Shijiazhuang","Ningbo","Taiyuan","Nanning","Xiamen\u2020","Fuzhou","Changzhou","Wenzhou","Nanchang","Tangshan","Guiyang","Wuxi","Lanzhou","Zhongshan","Handan","Huai'an","Weifang","Zibo","Shaoxing","Yantai","Huizhou","Luoyang","Nantong","Baotou","Liuzhou"].forEach((i,e)=>ee.register(new re(i,ap,e===0)))});var fw=P(cw=>{"use strict";Object.defineProperty(cw,"__esModule",{value:!0});pw();uw()});var ka,sp,Du=n(()=>{Kt();ka=class extends fe{};t(ka,"Egyptian");sp=ka});var rz={};var yw=n(()=>{Du();ar();sr();Object.entries({people:"Egyptian",nation:"Egypt",colors:["#CE1126","#FFF"]}).forEach(([i,e])=>be.register(new ve(sp,i,e)))});var iz={};var dw=n(()=>{Du();_t();Pt();["Cairo","Alexandria","Gizeh","Shubra El-Kheima","Port Said","Suez","Luxor","al-Mansura","El-Mahalla El-Kubra","Tanta","Asyut","Ismailia","Fayyum","Zagazig","Aswan","Damietta","Damanhur","al-Minya","Beni Suef","Qena","Sohag","Hurghada","6th of October City","Shibin El Kom","Banha","Kafr el-Sheikh","Arish","Mallawi","10th of Ramadan City","Bilbais","Marsa Matruh","Idfu","Mit Ghamr","Al-Hamidiyya","Desouk","Qalyub","Abu Kabir","Kafr el-Dawwar","Girga","Akhmim","Matarey"].forEach((i,e)=>ee.register(new re(i,sp,e===0)))});var hw=P(gw=>{"use strict";Object.defineProperty(gw,"__esModule",{value:!0});yw();dw()});var Ya,_l,lp=n(()=>{Kt();Ya=class extends fe{};t(Ya,"English");_l=Ya});var oz={};var Ow=n(()=>{lp();ar();sr();Object.entries({people:"English",nation:"England",colors:["#FFF","#C8102E"]}).forEach(([i,e])=>be.register(new ve(_l,i,e)))});var nz={};var Rw=n(()=>{lp();_t();Pt();["London","Birmingham","Liverpool","Leeds","Sheffield","Bristol","Manchester","Leicester","Coventry","Kingston upon Hull","Stoke-on-Trent","Wolverhampton","Nottingham","Plymouth","Southampton","Reading","Derby","Dudley","Newcastle upon Tyne","Northampton","Portsmouth","Luton","Preston","Sunderland","Norwich","Walsall","Bournemouth","Southend-on-Sea","Swindon","Huddersfield","Poole","Oxford","Middlesbrough","Blackpool","Oldbury","Boldon","Ipswich","York","West Bromwich","Peterborough","Stockport","Brighton","Slough","Gloucester","Rotherham","Cambridge","Exeter","Eastbourne","Sutton Coldfield","Blackburn","Colchester","Oldham","St Helens","Woking","Chesterfield","Crawley"].forEach((i,e)=>ee.register(new re(i,_l,e===0)))});var vw=P(xw=>{"use strict";Object.defineProperty(xw,"__esModule",{value:!0});Ow();Rw()});var za,mp,Eu=n(()=>{Kt();za=class extends fe{};t(za,"French");mp=za});var az={};var bw=n(()=>{Eu();ar();sr();Object.entries({people:"French",nation:"France",colors:["#FFF","#0055A4"]}).forEach(([i,e])=>be.register(new ve(mp,i,e)))});var sz={};var Cw=n(()=>{Eu();_t();Pt();["Paris","Marseille","Lyon","Toulouse","Nice","Nantes","Strasbourg","Montpellier","Bordeaux","Lille","Rennes","Reims","Le Havre","Saint-\xC9tienne","Toulon","Grenoble","Dijon","N\xEEmes","Angers","Villeurbanne","Le Mans","Saint-Denis","Aix-en-Provence","Clermont-Ferrand","Brest","Limoges","Tours","Amiens","Perpignan","Metz","Besan\xE7on","Boulogne-Billancourt","Orl\xE9ans","Mulhouse","Rouen","Saint-Denis","Caen","Argenteuil","Saint-Paul","Montreuil","Nancy","Roubaix","Tourcoing","Nanterre","Avignon","Vitry-sur-Seine","Cr\xE9teil","Dunkirk","Poitiers","Asni\xE8res-sur-Seine","Courbevoie","Versailles","Colombes","Fort-de-France","Aulnay-sous-Bois","Saint-Pierre","Rueil-Malmaison","Pau","Aubervilliers","Le Tampon","Champigny-sur-Marne","Antibes","B\xE9ziers","La Rochelle","Saint-Maur-des-Foss\xE9s","Cannes","Calais","Saint-Nazaire","M\xE9rignac","Drancy","Colmar","Ajaccio","Bourges","Issy-les-Moulineaux","Levallois-Perret","La Seyne-sur-Mer","Quimper","Noisy-le-Grand","Villeneuve-d'Ascq","Neuilly-sur-Seine","Valence","Antony","Cergy","V\xE9nissieux","Pessac","Troyes","Clichy","Ivry-sur-Seine","Chamb\xE9ry","Lorient","Les Abymes","Montauban","Sarcelles","Niort","Villejuif","Saint-Andr\xE9","Hy\xE8res","Saint-Quentin","Beauvais","\xC9pinay-sur-Seine","Cayenne","Maisons-Alfort","Cholet","Meaux","Chelles","Pantin","\xC9vry","Fontenay-sous-Bois","Fr\xE9jus","Vannes","Bondy","Le Blanc-Mesnil","La Roche-sur-Yon","Saint-Louis","Arles","Clamart","Narbonne","Annecy","Sartrouville","Grasse","Laval","Belfort","Bobigny","\xC9vreux","Vincennes","Montrouge","Sevran","Albi","Charleville-M\xE9zi\xE8res","Suresnes","Martigues","Corbeil-Essonnes","Saint-Ouen","Bayonne","Cagnes-sur-Mer","Brive-la-Gaillarde","Carcassonne","Massy","Blois","Aubagne","Saint-Brieuc","Ch\xE2teauroux","Chalon-sur-Sa\xF4ne","Mantes-la-Jolie","Meudon","Saint-Malo","Ch\xE2lons-en-Champagne","Alfortville","S\xE8te","Salon-de-Provence","Vaulx-en-Velin","Puteaux","Rosny-sous-Bois","Saint-Herblain","Gennevilliers","Le Cannet","Livry-Gargan","Saint-Priest","Istres","Valenciennes","Choisy-le-Roi","Caluire-et-Cuire","Boulogne-sur-Mer","Bastia","Angoul\xEAme","Garges-l\xE8s-Gonesse","Castres","Thionville","Wattrelos","Talence","Saint-Laurent-du-Maroni","Douai","Noisy-le-Sec","Tarbes","Arras","Al\xE8s","La Courneuve","Bourg-en-Bresse","Compi\xE8gne","Gap","Melun","Le Lamentin","Rez\xE9","Saint-Germain-en-Laye","Marcq-en-Bar\u0153ul","Gagny","Anglet","Draguignan","Chartres","Bron","Bagneux","Colomiers","Saint-Martin-d'H\xE8res","Pontault-Combault","Montlu\xE7on","Jou\xE9-l\xE8s-Tours","Saint-Joseph","Poissy","Savigny-sur-Orge","Cherbourg-Octeville","Mont\xE9limar","Villefranche-sur-Sa\xF4ne","Stains","Saint-Beno\xEEt","Bagnolet","Ch\xE2tillon","Le Port","Sainte-Genevi\xE8ve-des-Bois","\xC9chirolles","Roanne","Villepinte","Saint-Chamond","Conflans-Sainte-Honorine","Auxerre","Nevers","Neuilly-sur-Marne","La Ciotat","Tremblay-en-France","Thonon-les-Bains","Vitrolles","Haguenau","Six-Fours-les-Plages","Agen","Creil","Annemasse","Saint-Rapha\xEBl","Marignane","Romans-sur-Is\xE8re","Montigny-le-Bretonneux","Le Perreux-sur-Marne","Franconville","M\xE2con","Saint-Leu","Cambrai","Ch\xE2tenay-Malabry","Sainte-Marie","Villeneuve-Saint-Georges","Houilles","\xC9pinal","Lens","Li\xE9vin","Les Mureaux","Schiltigheim","La Possession","Meyzieu","Dreux","Nogent-sur-Marne","Plaisir","Mont-de-Marsan","Palaiseau","Ch\xE2tellerault","Goussainville","L'Ha\xFF-les-Roses","Viry-Ch\xE2tillon","Vigneux-sur-Seine","Chatou","Trappes","Clichy-sous-Bois","Rillieux-la-Pape","Villenave-'Ornon","Maubeuge","Charenton-le-Pont","Malakoff","Matoury","Dieppe","Athis-Mons","Savigny-le-Temple","P\xE9rigueux","Baie-Mahault","Vandoeuvre-l\xE8s-Nancy","Pontoise","Aix-les-Bains","Cachan","Vienne","Thiais","Orange","Saint-M\xE9dard-en-Jalles","Villemomble","Saint-Cloud","Saint-Laurent-du-Var","Yerres","Saint-\xC9tienne-du-Rouvray","Sotteville-l\xE8s-Rouen","Draveil","Le Chesnay","Bois-Colombes","Le Plessis-Robinson","La Garenne-Colombes","Lambersart","Soissons","Pierrefitte-sur-Seine","Carpentras","Villiers-sur-Marne","Vanves","Menton","Bergerac","Ermont","Bezons","Grigny","Guyancourt","Saumur","Herblay","Ris-Orangis","Villiers-le-Bel","Bourgoin-Jallieu","Vierzon","Le Gosier","D\xE9cines-Charpieu","H\xE9nin-Beaumont","Fresnes","Aurillac","Sannois","Vallauris","Illkirch-Graffenstaden","Alen\xE7on","\xC9lancourt","Tournefeuille","B\xE8gles","Gonesse","Oullins","Brunoy","Taverny","Armenti\xE8res","Montfermeil","Rambouillet","Villeparisis","Le Kremlin-Bic\xEAtre","Sucy-en-Brie","Kourou","Montb\xE9liard","Romainville","Cavaillon","Saint-Dizier","Br\xE9tigny-sur-Orge","Saint-S\xE9bastien-sur-Loire","Saintes","La Teste-de-Buch","Villeneuve-la-Garenne","B\xE9thune","Bussy-Saint-Georges","Vichy","La Garde","Agde","Laon","Sens","Lunel","Miramas","Biarritz","Le Grand-Quevilly","Orvault","Les Ulis","Champs-sur-Marne","Rochefort","Muret","Sainte-Anne","Eaubonne","\xC9tampes","Gradignan","Vernon","Petit-Bourg","Libourne","Abbeville","Rodez","Saint-Ouen-l'Aum\xF4ne","Torcy","Maisons-Laffitte","Montgeron","Villeneuve-sur-Lot","Cormeilles-en-Parisis","\xC9pernay","S\xE8vres","Dole","Le Robert","Le Bouscat","Blagnac","Frontignan","Cenon","Mandelieu-la-Napoule","Vertou","Les Lilas","Bruay-la-Buissi\xE8re","Les Pavillons-sous-Bois","Chaumont","Roissy-en-Brie","Le Moule","Le Petit-Quevilly","Manosque","Saint-Mand\xE9","Fontenay-aux-Roses","Orly","Le Creusot","Oyonnax","La Madeleine","Sainte-Suzanne","Millau","Combs-la-Ville","Fontaine","Deuil-la-Barre","Coudekerque-Branche","Auch","Lanester","Beaune","Montigny-l\xE8s-Metz","Hazebrouck","Longjumeau","Sainte-Foy-l\xE8s-Lyon","Forbach","Sarreguemines","Mons-en-Bar\u0153ul","La Valette-du-Var","H\xE9rouville-Saint-Clair","Morsang-sur-Orge","Grande-Synthe","La Celle-Saint-Cloud","Lisieux","Croix","Dammarie-les-Lys","V\xE9lizy-Villacoublay","Wasquehal","Saint-Gratien","Halluin","Neuilly-Plaisance","Montmorency","Dax","Lagny-sur-Marne","Le M\xE9e-sur-Seine","Saint-Genis-Laval","Fleury-les-Aubrais","Loos","Gif-sur-Yvette","Denain","Saint-Di\xE9-des-Vosges","Sainte-Rose","Saint-Michel-sur-Orge"].forEach((i,e)=>ee.register(new re(i,mp,e===0)))});var Tw=P(Pw=>{"use strict";Object.defineProperty(Pw,"__esModule",{value:!0});bw();Cw()});var La,Kl,pp=n(()=>{Kt();La=class extends fe{};t(La,"German");Kl=La});var lz={};var ww=n(()=>{pp();ar();sr();Object.entries({people:"German",nation:"Germany",colors:["#000","#FC0"]}).forEach(([i,e])=>be.register(new ve(Kl,i,e)))});var mz={};var Iw=n(()=>{pp();_t();Pt();["Berlin","Hamburg","Munich","Cologne","Frankfurt","Stuttgart","D\xFCsseldorf","Dortmund","Essen","Leipzig","Bremen","Dresden","Hanover","Nuremberg","Duisburg","Bochum","Wuppertal","Bielefeld","Bonn","M\xFCnster","Karlsruhe","Mannheim","Augsburg","Wiesbaden","Gelsenkirchen","M\xF6nchengladbach","Braunschweig","Chemnitz","Kiel","Aachen","Halle","Magdeburg","Freiburg","Krefeld","L\xFCbeck","Oberhausen","Erfurt","Mainz","Rostock","Kassel","Hagen","Hamm","Saarbr\xFCcken","M\xFClheim an der Ruhr","Potsdam","Ludwigshafen am Rhein","Oldenburg","Leverkusen","Osnabr\xFCck","Solingen"].forEach((i,e)=>ee.register(new re(i,Kl,e===0)))});var Bw=P(Aw=>{"use strict";Object.defineProperty(Aw,"__esModule",{value:!0});ww();Iw()});var Na,up,Su=n(()=>{Kt();Na=class extends fe{};t(Na,"Greek");up=Na});var pz={};var Gw=n(()=>{Su();ar();sr();Object.entries({people:"Greek",nation:"Greece",colors:["#2175D8","#FFF"]}).forEach(([i,e])=>be.register(new ve(up,i,e)))});var uz={};var Uw=n(()=>{Su();_t();Pt();["Athens","Thessaloniki","Patras","Piraeus","Larissa","Heraklion","Peristeri","Kallithea","Acharnes","Kalamaria","Nikaia","Glyfada","Volos","Ilio","Ilioupoli","Keratsini","Evosmos","Chalandri","Nea Smyrni","Marousi","Agios Dimitrios","Zografou","Egaleo","Nea Ionia","Ioannina","Palaio Faliro","Korydallos","Trikala","Vyronas","Agia Paraskevi","Galatsi","Agrinio","Chalcis","Petroupoli","Serres","Alexandroupoli","Xanthi","Katerini","Kalamata","Kavala","Chania","Lamia","Komotini","Irakleio","Rhodes","Kifissia","Stavroupoli","Chaidari","Drama","Veria","Alimos","Kozani","Polichni","Karditsa","Sykies","Ampelokipoi","Pylaia","Agioi Anargyroi","Argyroupoli","Ano Liosia","Nea Ionia","Rethymno","Ptolemaida","Tripoli","Cholargos","Vrilissia","Aspropyrgos","Corinth","Gerakas","Metamorfosi","Giannitsa","Voula","Kamatero","Mytilene","Neapoli","Eleftherio-Kordelio","Chios","Agia Varvara","Kaisariani","Nea Filadelfeia","Moschato","Perama","Salamina","Eleusis","Corfu","Pyrgos","Megara","Kilkis","Dafni","Thebes","Melissia","Argos","Arta","Artemida","Livadeia","Pefki","Oraiokastro","Aigio","Kos","Koropi","Preveza","Naousa","Orestiada","Peraia","Edessa","Florina","Panorama","Nea Erythraia1","Elliniko1","Amaliada","Pallini","Sparta","Agios Ioannis Rentis","Thermi","Vari","Nea Makri","Tavros","Alexandreia","Menemeni","Paiania","Kalyvia Thorikou","Nafplio","Drapetsona","Efkarpia","Papagou","Nafpaktos","Kastoria","Grevena","Pefka","Nea Alikarnassos","Missolonghi","Gazi","Ierapetra","Kalymnos","Rafina","Loutraki","Agios Nikolaos","Ermoupoli","Ialysos","Mandra","Tyrnavos","Glyka Nera","Ymittos","Neo Psychiko"].forEach((i,e)=>ee.register(new re(i,up,e===0)))});var Dw=P(Mw=>{"use strict";Object.defineProperty(Mw,"__esModule",{value:!0});Gw();Uw()});var ja,cp,Fu=n(()=>{Kt();ja=class extends fe{};t(ja,"Indian");cp=ja});var cz={};var Ew=n(()=>{Fu();ar();sr();Object.entries({people:"Indian",nation:"India",colors:["#138808","#FF9933"]}).forEach(([i,e])=>be.register(new ve(cp,i,e)))});var fz={};var Sw=n(()=>{Fu();_t();Pt();["Delhi","Mumbai","Bangalore","Hyderabad","Ahmedabad","Chennai","Kolkata","Surat","Pune","Jaipur","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivli","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Dhanbad","Amritsar","Navi Mumbai","Allahabad","Howrah","Ranchi","Gwalior","Jabalpur","Coimbatore","Vijayawada","Jodhpur","Madurai","Raipur","Kota","Chandigarh","Guwahati","Solapur","Hubli\u2013Dharwad","Tiruchirappalli","Bareilly","Moradabad","Mysore","Tiruppur","Gurgaon","Aligarh","Jalandhar","Bhubaneswar","Salem","Mira-Bhayandar","Warangal","Jalgaon","Guntur","Bhiwandi","Saharanpur","Gorakhpur","Bikaner","Amravati","Noida","Jamshedpur","Bhilai","Cuttack","Firozabad","Kochi","Nellore","Bhavnagar","Dehradun","Durgapur","Asansol","Rourkela","Nanded","Kolhapur","Ajmer","Akola","Gulbarga","Jamnagar","Ujjain","Loni","Siliguri","Jhansi","Ulhasnagar","Jammu","Sangli-Miraj & Kupwad","Mangalore","Erode","Belgaum","Ambattur","Tirunelveli","Malegaon","Gaya","Thiruvananthapuram","Udaipur","Maheshtala","Davanagere","Kozhikode","Kurnool","Rajpur Sonarpur","Rajahmundry","Bokaro","South Dumdum","Bellary","Patiala","Gopalpur","Agartala","Bhagalpur","Muzaffarnagar","Bhatpara","Panihati","Latur","Dhule","Tirupati","Rohtak","Korba","Bhilwara","Berhampur","Muzaffarpur","Ahmednagar","Mathura","Kollam","Avadi","Kadapa","Kamarhati","Sambalpur","Bilaspur","Shahjahanpur","Satara","Bijapur","Kakinada","Rampur","Shimoga","Chandrapur","Junagadh","Thrissur","Alwar","Bardhaman","Kulti","Nizamabad","Parbhani","Tumkur","Khammam","Ozhukarai","Bihar Sharif","Panipat","Darbhanga","Bally","Aizawl","Dewas","Ichalkaranji","Karnal","Bathinda","Jalna","Eluru","Barasat","Kirari Suleman Nagar","Purnia","Satna","Mau","Sonipat","Farrukhabad","Sagar","Durg","Imphal","Ratlam","Hapur","Arrah","Anantapur","Karimnagar","Etawah","Ambarnath","North Dumdum","Bharatpur","Begusarai","New Delhi","Gandhidham","Baranagar","Tiruvottiyur","Pondicherry","Sikar","Thoothukudi","Rewa","Mirzapur","Raichur","Pali","Ramagundam","Haridwar","Vijayanagaram","Katihar","Nagercoil","Sri Ganganagar","Karawal Nagar","Mango","Thanjavur","Bulandshahr","Uluberia","Katni","Sambhal","Singrauli","Nadiad","Secunderabad","Naihati","Yamunanagar","Bidhannagar","Pallavaram","Bidar","Munger","Panchkula","Burhanpur","Raurkela Industrial Township","Kharagpur","Dindigul","Gandhinagar","Hospet","Nangloi Jat","Malda","Ongole","Deoghar","Chapra","Haldia","Khandwa","Nandyal","Morena","Amroha","Anand","Bhind","Bhalswa Jahangir Pur","Madhyamgram","Bhiwani","Berhampore","Ambala","Morbi","Fatehpur","Raebareli","Mahaboobnagar","Chittoor","Bhusawal","Orai","Bahraich","Vellore","Mehsana","Raiganj","Sirsa","Danapur","Serampore","Sultan Pur Majra","Guna","Jaunpur","Panvel","Shivpuri","Surendranagar Dudhrej","Unnao","Chinsurah","Alappuzha","Kottayam","Machilipatnam","Shimla","Adoni","Udupi","Tenali","Proddatur","Saharsa","Hindupur","Sasaram","Hajipur","Bhimavaram","Kumbakonam","Dehri","Madanapalle","Siwan","Bettiah","Guntakal","Srikakulam","Motihari","Dharmavaram","Gudivada","Phagwara","Narasaraopet","Suryapet","Miryalaguda","Tadipatri","Karaikudi","Kishanganj","Jamalpur","Ballia","Kavali","Tadepalligudem","Amaravati","Buxar","Jehanabad","Aurangabad","Gangtok"].forEach((i,e)=>ee.register(new re(i,cp,e===0)))});var kw=P(Fw=>{"use strict";Object.defineProperty(Fw,"__esModule",{value:!0});Ew();Sw()});var Wa,fp,ku=n(()=>{Kt();Wa=class extends fe{};t(Wa,"Mongol");fp=Wa});var yz={};var Yw=n(()=>{ku();ar();sr();Object.entries({people:"Mongol",nation:"Mongolia",colors:["#DA2032","#0066B3"]}).forEach(([i,e])=>be.register(new ve(fp,i,e)))});var dz={};var zw=n(()=>{ku();_t();Pt();["Ulaanbaatar","Erdenet","Darkhan","Choibalsan","M\xF6r\xF6n","Nalaikh","Bayankhongor","\xD6lgii","Khovd","Arvaikheer","Ulaangom","Baganuur","Sainshand","Tsetserleg","S\xFCkhbaatar","\xD6nd\xF6rkhaan","Dalanzadgad","Z\xFC\xFCnkharaa","Uliastai","Altai","Baruun-Urt","Mandalgovi","Zuunmod","Zamyn-\xDC\xFCd","Bulgan","Kharkhorin","Choir","Bor-\xD6nd\xF6r","Sharyngo"].forEach((i,e)=>ee.register(new re(i,fp,e===0)))});var Nw=P(Lw=>{"use strict";Object.defineProperty(Lw,"__esModule",{value:!0});Yw();zw()});var Ha,yp,Yu=n(()=>{Kt();Ha=class extends fe{};t(Ha,"Roman");yp=Ha});var gz={};var jw=n(()=>{Yu();ar();sr();Object.entries({people:"Roman",nation:"Rome",colors:["#A20101","#D1B24F"]}).forEach(([i,e])=>be.register(new ve(yp,i,e)))});var hz={};var Ww=n(()=>{Yu();_t();Pt();["Roma","Ariminum","Belum","Placentia","Tarraco","Italica","Mod","Salernum","Bononia","Forum Livii","Regium Lepidi","Aquileia","Ascrivium","Valentia Edetanorum","Scalabis","Villa Euracini","Palma","Colonia Narbo Martius","Massa","Pistoria","Segovia","Gerunda","Pompaelo","Naissus","Brigantium","Florentia","Vesontio","Lutetia Parisiorum","Atuatuca Tungrorum","Iulia Romula Hispalis","Augusta Raurica","Noviodunum","Lugdunum","Siscia","Marsonia","Augusta Treverorum","Castra Legionis","Augusta Taurinorum","Augusta Praetoria Salassorum","Emerita Augusta","Norba Caesarina","Lucus Augusta","Caesarea","Bracara Augusta","Novaesium","Castra Vetera","Pons Drusi","Ovilava","Iuvavum","Augusta Vindelicorum","Turicum","Asturica Augusta","Borbetomagus","Caesaraugusta","Sirmium","Sorviodurum","Mogontiacum","Argentoratum","Bonna","Noviomagus","Castellum apud Confluentes","Divodurum","Caesaromagus","Ambianum","Faventia Paterna Barcino","Abila","Lousonna","Ulpia Noviomagus Batavorum","Rigomagus","Aquae Mattiacorum","Mursa","Emona","Vindonissa","Aventicum","Praetorium Agrippinae","Lugdunum Batavorum","Aequum","Londinium","Albanianis","Lauri","Durovernum Cantiacorum","Regulbium","Rutupiae","Viminacium","Camulodunum","Traiectum","Matilo","Forum Hadriani","Nigrum Pullum","Lindum Colonia","Ratae Corieltauvorum","Durocobrivis","Colonia Agrippina","Durocornovium","Verulamium","Letocetum","Dubris","Danum","Mediolanum","Isca Dumnoniorum","Blestium","Viroconium Cornoviorum","Aquae Sulis","Durnovaria","Lindinis","Ad Flexum","Clausentum","Venta Belgarum","Calleva Atrebatum","Duroliponte","Concangis","Condate","Corinium Dobunnorum","Eboracum","Luguvalium","Arae Flaviae","Isca Augusta","Lagentium","Lopodunum","Moridunum","Venta Silurum","Deva Victrix","Mamucium","Olicana","Vinovia","Bonames","Coria","Gerulata","Vindobona","Biriciana","Cannstatt Castrum","Colonia Nervia Glevensium","Sumelocenna","Lopodunum","Traiectum ad Nicrem","Castra Batavar","Nida","Lactodurum","Bovium","Burgodunum","Lentia","Aquae Granni","Complutum","Aeminium","Traiectum ad Mosam","Coriovallum","Portus Lemanis","Andautonia","Salona","Cibalae","Aquae Helveticae","Aquincum","Apulum","Pons Aelius","Durovigutum","Aelia Capitolina","Ala","Castra Regina","Theranda","Pomaria","Partiscum","Gesoriacum","Aurelia Aquensis","Urbs Aurelianorum","Venetiae","Ragusium"].forEach((i,e)=>ee.register(new re(i,yp,e===0)))});var _w=P(Hw=>{"use strict";Object.defineProperty(Hw,"__esModule",{value:!0});jw();Ww()});var _a,ql,dp=n(()=>{Kt();_a=class extends fe{};t(_a,"Russian");ql=_a});var Oz={};var Kw=n(()=>{dp();ar();sr();Object.entries({people:"Russian",nation:"Russia",colors:["#0032A0","#DA291C"]}).forEach(([i,e])=>be.register(new ve(ql,i,e)))});var Rz={};var qw=n(()=>{dp();_t();Pt();["Moscow","Saint Petersburg","Novosibirsk","Yekaterinburg","Nizhny Novgorod","Kazan","Chelyabinsk","Omsk","Samara","Ufa","Rostov-on-Don","Krasnoyarsk","Voronezh","Perm","Volgograd","Krasnodar","Saratov","Tyumen","Makhachkala","Tolyatti","Barnaul","Ulyanovsk","Izhevsk","Vladivostok","Irkutsk","Khabarovsk","Yaroslavl","Tomsk","Orenburg","Kemerovo","Novokuznetsk","Tula","Ryazan","Kirov","Astrakhan","Naberezhnye Chelny","Sochi","Penza","Lipetsk","Cheboksary","Balashikha","Kaliningrad","Kursk","Stavropol","Ulan-Ude","Bryansk","Tver","Magnitogorsk","Ivanovo","Belgorod","Surgut","Vladimir","Arkhangelsk","Nizhny Tagil","Kaluga","Chita","Saransk","Yakutsk","Smolensk","Podolsk","Volzhsky","Vladikavkaz","Vologda","Cherepovets","Kurgan","Oryol","Grozny","Murmansk","Tambov","Petrozavodsk","Sterlitamak","Kostroma","Nizhnevartovsk","Novorossiysk","Yoshkar-Ola","Taganrog","Komsomolsk-on-Amur","Khimki","Syktyvkar","Nalchik","Nizhnekamsk","Shakhty","Dzerzhinsk","Bratsk","Orsk","Angarsk","Engels","Blagoveshchensk","Stary Oskol","Veliky Novgorod","Korolyov","Pskov","Mytishchi","Biysk","Lyubertsy","Prokopyevsk","Yuzhno-Sakhalinsk","Balakovo","Armavir","Rybinsk","Severodvinsk","Abakan","Petropavlovsk-Kamchatsky","Norilsk","Syzran","Volgodonsk","Ussuriysk","Kamensk-Uralsky","Novocherkassk","Zlatoust","Elektrostal","Almetyevsk","Krasnogorsk","Salavat","Miass","Nakhodka","Kopeysk","Pyatigorsk","Rubtsovsk","Berezniki","Kolomna","Maykop","Odintsovo","Khasavyurt","Kovrov","Kislovodsk","Neftekamsk","Nefteyugansk","Novocheboksarsk","Serpukhov","Shchyolkovo","Novomoskovsk","Bataysk","Pervouralsk","Domodedovo","Derbent","Cherkessk","Orekhovo-Zuyevo","Nevinnomyssk","Dimitrovgrad","Nazran","Kyzyl","Oktyabrsky","Obninsk","Kaspiysk","Novy Urengoy","Ramenskoye","Kamyshin","Murom","Zhukovsky"].forEach((i,e)=>ee.register(new re(i,ql,e===0)))});var Jw=P(Vw=>{"use strict";Object.defineProperty(Vw,"__esModule",{value:!0});Kw();qw()});var Ka,gp,zu=n(()=>{Kt();Ka=class extends fe{};t(Ka,"Zulu");gp=Ka});var xz={};var $w=n(()=>{zu();ar();sr();Object.entries({people:"Zulu",nation:"Zulus",colors:["#FFFD1E","#000"]}).forEach(([i,e])=>be.register(new ve(gp,i,e)))});var vz={};var Zw=n(()=>{zu();_t();Pt();["uMgungundlovu","Nobamba","Bulawayo","KwaDukuza","Nongoma","oNdini","Nodwengu","Ndondakusuka","Babanango","Khangela","Kwahlomendlini","Hlobane","eThekwini","Mlambongwenya","Eziqwaqweni","Isiphezi","Masotsheni","Mtunzini","Nyakamubi","Hlatikulu","Mthonjaneni","Empangeni","Pongola","Tungela","Kwamashu","Ingwavuma","Hluhluwe","Mtubatuba","Mhlahlandlela","Mthatha","Maseru","Lobamba","Qunu"].forEach((i,e)=>ee.register(new re(i,gp,e===0)))});var Xw=P(Qw=>{"use strict";Object.defineProperty(Qw,"__esModule",{value:!0});$w();Zw()});var bz={};var eI=n(()=>{U();bd();R.register(xu)});var rI=P(tI=>{"use strict";Object.defineProperty(tI,"__esModule",{value:!0});eI()});var Cz={};var iI=n(()=>{U();nx();R.register(pP)});var nI=P(oI=>{"use strict";Object.defineProperty(oI,"__esModule",{value:!0});iI()});var Pz={};var aI=n(()=>{U();ax();R.register(uP)});var lI=P(sI=>{"use strict";Object.defineProperty(sI,"__esModule",{value:!0});aI()});var Tz={};var mI=n(()=>{U();sx();R.register(cP)});var uI=P(pI=>{"use strict";Object.defineProperty(pI,"__esModule",{value:!0});mI()});var wz={};var cI=n(()=>{U();Cd();R.register(vu)});var yI=P(fI=>{"use strict";Object.defineProperty(fI,"__esModule",{value:!0});cI()});var Iz={};var dI=n(()=>{U();lx();R.register(fP)});var hI=P(gI=>{"use strict";Object.defineProperty(gI,"__esModule",{value:!0});dI()});var Az={};var OI=n(()=>{U();mx();R.register(yP)});var xI=P(RI=>{"use strict";Object.defineProperty(RI,"__esModule",{value:!0});OI()});var Bz={};var vI=n(()=>{U();Td();R.register(Pd)});var CI=P(bI=>{"use strict";Object.defineProperty(bI,"__esModule",{value:!0});vI()});var Gz={};var PI=n(()=>{U();px();R.register(dP)});var wI=P(TI=>{"use strict";Object.defineProperty(TI,"__esModule",{value:!0});PI()});var Uz={};var II=n(()=>{U();ux();R.register(gP)});var BI=P(AI=>{"use strict";Object.defineProperty(AI,"__esModule",{value:!0});II()});var Mz={};var GI=n(()=>{U();wd();R.register(bu)});var MI=P(UI=>{"use strict";Object.defineProperty(UI,"__esModule",{value:!0});GI()});var Dz={};var DI=n(()=>{U();cx();R.register(hP)});var SI=P(EI=>{"use strict";Object.defineProperty(EI,"__esModule",{value:!0});DI()});var Ez={};var FI=n(()=>{U();Id();R.register(Cu)});var YI=P(kI=>{"use strict";Object.defineProperty(kI,"__esModule",{value:!0});FI()});var Sz={};var zI=n(()=>{U();fx();R.register(OP)});var NI=P(LI=>{"use strict";Object.defineProperty(LI,"__esModule",{value:!0});zI()});var Fz={};var jI=n(()=>{U();yx();R.register(RP)});var HI=P(WI=>{"use strict";Object.defineProperty(WI,"__esModule",{value:!0});jI()});var kz={};var _I=n(()=>{U();Ad();R.register(jl)});var qI=P(KI=>{"use strict";Object.defineProperty(KI,"__esModule",{value:!0});_I()});var Yz={};var VI=n(()=>{U();dx();R.register(xP)});var $I=P(JI=>{"use strict";Object.defineProperty(JI,"__esModule",{value:!0});VI()});var zz={};var ZI=n(()=>{U();gx();R.register(vP)});var XI=P(QI=>{"use strict";Object.defineProperty(QI,"__esModule",{value:!0});ZI()});var Lz={};var eA=n(()=>{U();hx();R.register(bP)});var rA=P(tA=>{"use strict";Object.defineProperty(tA,"__esModule",{value:!0});eA()});var Nz={};var iA=n(()=>{U();Ox();R.register(CP)});var nA=P(oA=>{"use strict";Object.defineProperty(oA,"__esModule",{value:!0});iA()});var jz={};var aA=n(()=>{U();Rx();R.register(PP)});var lA=P(sA=>{"use strict";Object.defineProperty(sA,"__esModule",{value:!0});aA()});var Wz={};var mA=n(()=>{U();xx();R.register(TP)});var uA=P(pA=>{"use strict";Object.defineProperty(pA,"__esModule",{value:!0});mA()});var Hz={};var cA=n(()=>{U();vx();R.register(wP)});var yA=P(fA=>{"use strict";Object.defineProperty(fA,"__esModule",{value:!0});cA()});var _z={};var dA=n(()=>{U();bx();R.register(IP)});var hA=P(gA=>{"use strict";Object.defineProperty(gA,"__esModule",{value:!0});dA()});var Kz={};var OA=n(()=>{U();Cx();R.register(AP)});var xA=P(RA=>{"use strict";Object.defineProperty(RA,"__esModule",{value:!0});OA()});var qz={};var vA=n(()=>{U();Gd();R.register(Bd)});var CA=P(bA=>{"use strict";Object.defineProperty(bA,"__esModule",{value:!0});vA()});var Vz={};var PA=n(()=>{U();Px();R.register(BP)});var wA=P(TA=>{"use strict";Object.defineProperty(TA,"__esModule",{value:!0});PA()});var Jz={};var IA=n(()=>{U();Tx();R.register(GP)});var BA=P(AA=>{"use strict";Object.defineProperty(AA,"__esModule",{value:!0});IA()});var $z={};var GA=n(()=>{U();Ud();R.register(tp)});var MA=P(UA=>{"use strict";Object.defineProperty(UA,"__esModule",{value:!0});GA()});var Zz={};var DA=n(()=>{U();Dd();R.register(Md)});var SA=P(EA=>{"use strict";Object.defineProperty(EA,"__esModule",{value:!0});DA()});var Qz={};var FA=n(()=>{U();Ed();R.register(Pu)});var YA=P(kA=>{"use strict";Object.defineProperty(kA,"__esModule",{value:!0});FA()});var Xz={};var zA=n(()=>{U();wx();R.register(UP)});var NA=P(LA=>{"use strict";Object.defineProperty(LA,"__esModule",{value:!0});zA()});var eL={};var jA=n(()=>{U();Fd();R.register(Sd)});var HA=P(WA=>{"use strict";Object.defineProperty(WA,"__esModule",{value:!0});jA()});var tL={};var _A=n(()=>{U();Yd();R.register(kd)});var qA=P(KA=>{"use strict";Object.defineProperty(KA,"__esModule",{value:!0});_A()});var rL={};var VA=n(()=>{U();Ix();R.register(MP)});var $A=P(JA=>{"use strict";Object.defineProperty(JA,"__esModule",{value:!0});VA()});var iL={};var ZA=n(()=>{U();zd();R.register(Tu)});var XA=P(QA=>{"use strict";Object.defineProperty(QA,"__esModule",{value:!0});ZA()});var oL={};var eB=n(()=>{U();Nd();R.register(Ld)});var rB=P(tB=>{"use strict";Object.defineProperty(tB,"__esModule",{value:!0});eB()});var nL={};var iB=n(()=>{U();Ax();R.register(DP)});var nB=P(oB=>{"use strict";Object.defineProperty(oB,"__esModule",{value:!0});iB()});var aL={};var aB=n(()=>{U();Wd();R.register(jd)});var lB=P(sB=>{"use strict";Object.defineProperty(sB,"__esModule",{value:!0});aB()});var sL={};var mB=n(()=>{U();_d();R.register(Hd)});var uB=P(pB=>{"use strict";Object.defineProperty(pB,"__esModule",{value:!0});mB()});var lL={};var cB=n(()=>{U();Bx();R.register(EP)});var yB=P(fB=>{"use strict";Object.defineProperty(fB,"__esModule",{value:!0});cB()});var mL={};var dB=n(()=>{U();Kd();R.register(wu)});var hB=P(gB=>{"use strict";Object.defineProperty(gB,"__esModule",{value:!0});dB()});var pL={};var OB=n(()=>{U();Gx();R.register(SP)});var xB=P(RB=>{"use strict";Object.defineProperty(RB,"__esModule",{value:!0});OB()});var uL={};var vB=n(()=>{U();Ux();R.register(FP)});var CB=P(bB=>{"use strict";Object.defineProperty(bB,"__esModule",{value:!0});vB()});var cL={};var PB=n(()=>{U();qd();R.register(Iu)});var wB=P(TB=>{"use strict";Object.defineProperty(TB,"__esModule",{value:!0});PB()});var fL={};var IB=n(()=>{U();Mx();R.register(kP)});var BB=P(AB=>{"use strict";Object.defineProperty(AB,"__esModule",{value:!0});IB()});var yL={};var GB=n(()=>{U();Dx();R.register(YP)});var MB=P(UB=>{"use strict";Object.defineProperty(UB,"__esModule",{value:!0});GB()});var dL={};var DB=n(()=>{U();Ex();R.register(zP)});var SB=P(EB=>{"use strict";Object.defineProperty(EB,"__esModule",{value:!0});DB()});var gL={};var FB=n(()=>{U();Sx();R.register(LP)});var YB=P(kB=>{"use strict";Object.defineProperty(kB,"__esModule",{value:!0});FB()});var hL={};var zB=n(()=>{U();Vd();R.register(Au)});var NB=P(LB=>{"use strict";Object.defineProperty(LB,"__esModule",{value:!0});zB()});var OL={};var jB=n(()=>{U();Fx();R.register(NP)});var HB=P(WB=>{"use strict";Object.defineProperty(WB,"__esModule",{value:!0});jB()});var RL={};var _B=n(()=>{U();kx();R.register(jP)});var qB=P(KB=>{"use strict";Object.defineProperty(KB,"__esModule",{value:!0});_B()});var xL={};var VB=n(()=>{U();Yx();R.register(WP)});var $B=P(JB=>{"use strict";Object.defineProperty(JB,"__esModule",{value:!0});VB()});var vL={};var ZB=n(()=>{U();zx();R.register(HP)});var XB=P(QB=>{"use strict";Object.defineProperty(QB,"__esModule",{value:!0});ZB()});var bL={};var eG=n(()=>{U();Lx();R.register(_P)});var rG=P(tG=>{"use strict";Object.defineProperty(tG,"__esModule",{value:!0});eG()});var CL={};var iG=n(()=>{U();Bu();R.register(Ua)});var nG=P(oG=>{"use strict";Object.defineProperty(oG,"__esModule",{value:!0});iG()});var PL={};var aG=n(()=>{U();$d();R.register(Jd)});var lG=P(sG=>{"use strict";Object.defineProperty(sG,"__esModule",{value:!0});aG()});var TL={};var mG=n(()=>{U();Qd();R.register(Zd)});var uG=P(pG=>{"use strict";Object.defineProperty(pG,"__esModule",{value:!0});mG()});var wL={};var cG=n(()=>{U();eg();R.register(Xd)});var yG=P(fG=>{"use strict";Object.defineProperty(fG,"__esModule",{value:!0});cG()});var IL={};var dG=n(()=>{U();rg();R.register(tg)});var hG=P(gG=>{"use strict";Object.defineProperty(gG,"__esModule",{value:!0});dG()});var AL={};var OG=n(()=>{U();Nx();R.register(KP)});var xG=P(RG=>{"use strict";Object.defineProperty(RG,"__esModule",{value:!0});OG()});var BL={};var vG=n(()=>{U();Wx();R.register(VP)});var CG=P(bG=>{"use strict";Object.defineProperty(bG,"__esModule",{value:!0});vG()});var GL={};var PG=n(()=>{U();jx();R.register(qP)});var wG=P(TG=>{"use strict";Object.defineProperty(TG,"__esModule",{value:!0});PG()});var UL={};var IG=n(()=>{U();og();R.register(ig)});var BG=P(AG=>{"use strict";Object.defineProperty(AG,"__esModule",{value:!0});IG()});var ML={};var GG=n(()=>{U();ag();R.register(ng)});var MG=P(UG=>{"use strict";Object.defineProperty(UG,"__esModule",{value:!0});GG()});var DL={};var DG=n(()=>{U();Hx();R.register(JP)});var SG=P(EG=>{"use strict";Object.defineProperty(EG,"__esModule",{value:!0});DG()});var EL={};var FG=n(()=>{U();lg();R.register(sg)});var YG=P(kG=>{"use strict";Object.defineProperty(kG,"__esModule",{value:!0});FG()});var SL,zG,LG=n(()=>{bm();v();q();SL=t((i=b)=>[new ci(new p((e,r)=>{i.emit("city:building-complete",e,r)}))],"getRules"),zG=SL});var FL,NG,jG=n(()=>{Xe();St();Fn();$e();q();bl();v();FL=t((i=H,e=W,r=ie,o=Et,s=b)=>[new xr(new p(a=>o.getByCity(a).progress().set(0))),new xr(new p(a=>r.getByCity(a).shrink())),new xr(new p((a,l,u)=>{s.emit("city:captured",a,l,u)})),new xr(new p(a=>e.getByCity(a).forEach(l=>l.destroy())))],"getRules"),NG=FL});var kL,WG,HG=n(()=>{Jn();wn();St();fn();$e();ym();I();v();CR();Yo();PR();wR();kL=t((i=ie,e=gt,r=W)=>[new at(new p(o=>new zb(i.getByCity(o).size()*2))),...[[Ve,1,Fi,er],[Ve,2,At,pt,ut,Ot]].map(([o,s,...a])=>new at(new m(l=>r.getByCity(l).some(u=>u instanceof o)),new m(l=>e.getByPlayer(l.player()).is(...a)),new p(l=>r.getByCity(l).filter(u=>u instanceof o).map(u=>new Lb(s,u))))),new at(new m(o=>e.getByPlayer(o.player()).is(Fi,er)),new m(o=>{let s=i.getByCity(o);return r.getByCity(o).filter(a=>[zt,j,qe,br].some(l=>a instanceof l)).length>s.size()}),new p(o=>{let s=i.getByCity(o);return r.getByCity(o).filter(a=>[zt,j,qe,br].some(l=>a instanceof l)).slice(s.size()).map(a=>new TR(1,a))})),new at(new m(o=>e.getByPlayer(o.player()).is(At,pt,ut,Ot)),new p(o=>r.getByCity(o).filter(s=>[zt,j,qe,br].some(a=>s instanceof a)).map(s=>new TR(1,s))))],"getRules"),WG=kL});var YL,_G,KG=n(()=>{Tl();Fn();St();Xe();q();$n();ao();w();_r();Np();xf();Ac();v();Ym();I();YL=t((i=Fe,e=Et,r=ie,o=H,s=pe,a=d,l=eo,u=b)=>[...[Ue,je].map(c=>new $o(new m(f=>i.getByTile(f.tile()).every(y=>!(y instanceof c))),new p(f=>i.register(new c(f.tile()))))),new $o(new p(c=>e.register(new Ps(c,l,a)))),new $o(new p(c=>r.register(new Gl(c,a)))),new $o(new p(c=>o.register(c))),new $o(new p(c=>{u.emit("city:created",c)})),new $o(new p(c=>Ls(c,s,r)))],"getRules"),_G=YL});var zL,qG,VG=n(()=>{Xe();q();_r();$e();Cl();v();$n();zL=t((i=Fe,e=H,r=b,o=W)=>[new Wr(new p(s=>i.getByTile(s.tile()).filter(a=>a instanceof Ue).forEach(a=>i.unregister(a)))),new Wr(new p((s,a)=>{r.emit("city:destroyed",s,a)})),new Wr(new p(s=>o.getByCity(s).forEach(a=>a.destroy())))],"getRules"),qG=zL});var fg,yg,qx=n(()=>{A();fg=class extends g{};t(fg,"FoodExhausted");yg=fg});var LL,JG,$G=n(()=>{v();qx();LL=t(()=>[new yg(new p(i=>i.shrink()))],"getRules"),JG=LL});var NL,ZG,QG=n(()=>{w();I();v();rR();qx();NL=t((i=d)=>[new _p(new m(e=>e.progress().value()>=e.cost().value()),new p(e=>e.grow())),new _p(new m(e=>e.progress().value()<0),new p(e=>{i.process(yg,e)}))],"getRules"),ZG=NL});var jL,XG,eU=n(()=>{St();ao();I();v();hf();Ym();jL=t((i=ie,e=pe)=>[new Ln(new p(r=>r.empty())),new Ln(new p(r=>r.cost().set((r.size()+1)*10,"city-grow"))),new Ln(new m(r=>r.city().tilesWorked().length<r.size()+1),new p(r=>Ls(r.city(),e,i))),new Ln(new m(r=>r.city().tilesWorked().length>r.size()+1),new p(r=>r.city().tilesWorked().entries().slice(r.size()+1).forEach(o=>r.city().tilesWorked().unregister(o))))],"getRules"),XG=jL});var WL,tU,rU=n(()=>{eR();v();WL=t(()=>[new ff(new p(i=>10*(i.size()+1)))],"getRules"),tU=WL});var dg,Lo,Vl=n(()=>{A();dg=class extends g{};t(dg,"CivilDisorder");Lo=dg});var gg,No,hp=n(()=>{A();gg=class extends g{};t(gg,"ProcessYield");No=gg});var hg,Jl,Og=n(()=>{A();hg=class extends g{};t(hg,"Unsupported");Jl=hg});var HL,iU,oU=n(()=>{Fn();St();xa();va();w();$e();Vl();I();v();hp();Og();HL=t((i=Et,e=ie,r=W,o=d)=>[new No(new m(s=>s instanceof Q),new p((s,a,l)=>{let u=e.getByCity(a),c=new zn(s);l.forEach(f=>{if(!(f instanceof Hs)||c.value()>=0)return;let y=f.unit();y!==null&&(o.process(Jl,a,y,f),c.subtract(f))}),u.add(c),u.check()})),new No(new m(s=>s instanceof V),new p((s,a,l)=>{let u=i.getByCity(a),c=s.clone();l.filter(y=>y instanceof _s).sort((y,h)=>(y.unit()?.tile().distanceFrom(a.tile())??0)-(h.unit()?.tile().distanceFrom(a.tile())??0)).forEach(y=>{if(c.value()>=0)return;let h=y.unit();h!==null&&(o.process(Jl,a,h,y),c.subtract(y))});let f=a.yields();o.process(Lo,a,f).some(y=>y)||u.add(c),u.check()}))],"getRules"),iU=HL});var _L,nU,aU=n(()=>{St();ao();I();v();iR();Ym();_L=t((i=ie,e=pe)=>[new Bl(new m(r=>r.size()>0),new p(r=>r.cost().set((r.size()+1)*10,"city-shrink"))),new Bl(new m(r=>r.size()>0),new m(r=>r.city().tilesWorked().length>r.size()+1),new p(r=>r.city().tilesWorked().entries().slice(r.size()+1).forEach(o=>r.city().tilesWorked().unregister(o)))),new Bl(new m(r=>r.size()>0),new m(r=>r.city().tilesWorked().length<r.size()+1),new p(r=>Ls(r.city(),e,i))),new Bl(new m(r=>r.size()<=0),new p(r=>r.city().destroy()))],"getRules"),nU=_L});var Rg,Pe,Or=n(()=>{Se();ge();Rg=class extends F{constructor(){super(L)}getByCity(e,r=!1){return this.filter(o=>o.city()===e&&!o.destroyed())}};t(Rg,"CityImprovementRegistry");Pe=new Rg});var KL,sU,lU=n(()=>{wn();Or();va();fn();v();ya();_x();Os();Rm();so();KL=t((i=Pe,e=gt)=>[new Zo(new fa,new p((r,o)=>{let s=e.getByPlayer(r.player()),[a]=i.filter(f=>f instanceof hT&&r.player()===f.city().player()).map(f=>f.city()),l=Le(o,le),u=s.is(At)?10:s.is(pt)?0:a?a.tile().distanceFrom(r.tile()):32,[c]=[[Fi,8],[At,20],[pt,0],[er,12],[ut,16],[Ot,24]].filter(([f])=>s.is(f)).map(([,f])=>f);return new tn(c?Math.min(Math.floor(l*u*3/(10*c)),l):0,u.toFixed(2))})),new Zo(new jr(0),new p(r=>r.tilesWorked().entries().flatMap(o=>o.yields(r.player()).flatMap(s=>new s.constructor(s.value(),o.id()+": "+s.values().map(([,a])=>a).join("-"))))))],"getRules"),sU=KL});var qL,mU,pU=n(()=>{$O();Fn();Xe();Nn();I();v();qL=t((i=Et,e=H)=>[new lt(new m(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).some(o=>!o.building())),new p(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).filter(o=>!o.building()).map(o=>new kn(r,o)))),new lt(new m(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).some(o=>!!o.building())),new p(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).filter(o=>!!o.building()).map(o=>new As(r,o))))],"getRules"),mU=qL});var VL,uU,cU=n(()=>{St();Xe();q();$m();I();uu();v();VL=t((i=H,e=ie,r=b)=>[new rn(new m((o,s,a)=>a instanceof Js&&a.to()===o.tile()&&i.getByTile(a.to())!==null),new p(o=>{let s=i.getByTile(o.tile());e.getByCity(s).shrink()})),new rn(new p((o,s,a)=>r.emit("unit:defeated",o,s,a)))],"getRules"),uU=VL});var JL,fU,yU=n(()=>{v();Og();JL=t(()=>[new Jl(new p((i,e)=>e.destroy()))],"getRules"),fU=JL});var $L={};var dU=n(()=>{LG();jG();HG();KG();VG();$G();QG();eU();rU();oU();aU();lU();w();pU();cU();yU();d.register(...zG(),...NG(),...WG(),..._G(),...qG(),...JG(),...ZG(),...XG(),...tU(),...iU(),...nU(),...sU(),...mU(),...uU(),...fU())});var hU=P(gU=>{"use strict";Object.defineProperty(gU,"__esModule",{value:!0});dU()});var xg,vg,Vx=n(()=>{lu();Ws();so();xg=t((i,e=i.city().yields())=>{let r=i.city(),o=new Array(i.size()).fill(1),[s,a]=Fl(e,yy,Wn),l=o.length-1;for(;a>0&&l>-1;)o[l--]=0,a--;for(l=0;s>0&&l<o.length;)o[l]===0&&(o[l]=1,s--),o[l]===1&&(o[l++]=2,s--),o[l]===2&&l++;return o},"calculateCitizenState"),vg=t(i=>i.reduce(([e,r,o],s)=>[e+(s===0?1:0),r+(s===1?1:0),o+(s===2?1:0)],[0,0,0]),"citizenSummary")});var bg,Op,Cg=n(()=>{A();bg=class extends g{};t(bg,"CelebrateLeader");Op=bg});var ZL,OU,RU=n(()=>{St();Vx();Cg();I();v();ZL=t((i=ie)=>[new Op(new m(e=>i.getByCity(e).size()>2),new p((e,r=e.yields())=>{let o=i.getByCity(e),s=xg(o,r),[a,,l]=vg(s);return a===0&&Math.floor(l)>=o.size()/2}))],"getRules"),OU=ZL});var $l,xU=n(()=>{Ws();Ns();$l=class extends Wn{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t($l,"CityImprovementContent");Hr($l)});var Rp,vU=n(()=>{lu();Rp=class extends yy{};t(Rp,"LuxuryHappiness")});var Zl,bU=n(()=>{Ws();Ns();Zl=class extends Wn{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(Zl,"MartialLaw");Hr(Zl)});var qa,CU=n(()=>{Ws();qa=class extends Wn{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(qa,"MilitaryUnhappiness")});var xp,PU=n(()=>{Ws();xp=class extends Wn{};t(xp,"PopulationUnhappiness")});var Pg=n(()=>{dy()});var Tg=n(()=>{xU();va();lu();mu();vU();bU();CU();PU();xa();Pg();Ws()});var QL,TU,wU=n(()=>{Jn();St();wn();Tg();fn();$e();Rm();I();v();QL=t((i=ie,e=gt,r=W)=>[new Zo(new p(o=>new xp(Math.max(i.getByCity(o).size()-5,0)))),...[[Ot,1],[pt,2]].map(([o,s])=>new Zo(new m(a=>{try{return e.getByPlayer(a.player()).is(o)}catch{return!1}}),new m(a=>r.getByCity(a).filter(l=>[zt,j,qe].some(u=>l instanceof u)&&l.tile()!==a.tile()).length>0),new p(a=>r.getByCity(a).filter(l=>[zt,j,qe].some(u=>l instanceof u)&&l.tile()!==a.tile()).map(l=>new qa(s,l)))))],"getRules"),TU=QL});var XL,IU,AU=n(()=>{St();Vx();Vl();v();XL=t((i=ie)=>[new Lo(new p((e,r=e.yields())=>{let o=i.getByCity(e),s=xg(o,r),[a,,l]=vg(s);return a>l}))],"getRules"),IU=XL});var wg,qi,Jx=n(()=>{FO();wg=class extends lc{validate(...e){return!this.criteria().length||this.criteria().some(r=>r.validate(...e))}};t(wg,"Or");qi=wg});var eN,BU,GU=n(()=>{wn();ki();St();Tg();Or();fn();ze();w();$e();ym();I();v();Jn();xl();ya();Ar();Jx();so();eN=t((i=d,e=ie,r=Pe,o=gt,s=N,a=W)=>[new at(new m(l=>o.getByPlayer(l.player()).is(Fi,At,er,ut)),new p((l,u)=>a.getByTile(l.tile()).filter(c=>c instanceof j).slice(0,Math.min(4,Le(u,et))).map(c=>new Zl(1,c)))),...[[Lt,1],[Lt,1,Xt],[ri,3],[yr,4]].map(([l,u,...c])=>new at(new Qe,new m(f=>r.getByCity(f).some(y=>y instanceof l)),new qi(new m(f=>c.length===0),new m(f=>c.every(y=>s.getByPlayer(f.player()).completed(y)))),new m((f,y)=>Le(y,et)>0),new p((f,y)=>new $l(Math.min(u,Le(y,et)),r.getByCity(f).filter(h=>h instanceof l)[0])))),new at(new Dn,new p((l,u)=>new Rp(Math.floor(Le(u,Oi)/2),Oi.name)))],"getRules"),BU=eN});var Ig,na,Lu=n(()=>{A();Ig=class extends g{};t(Ig,"TurnStart");na=Ig});var Ag,Nu,tN,UU,MU=n(()=>{St();Xe();q();w();Cg();Vl();v();ya();Lu();Ag=new Set,Nu=new Set,tN=t((i=H,e=d,r=b,o=ie)=>[new na(new Qe,new p(s=>i.getByPlayer(s).forEach(a=>{let l=e.process(Lo,a,a.yields()).some(c=>c),u=e.process(Op,a,a.yields()).some(c=>c);l&&r.emit("city:civil-disorder",a),l&&!Ag.has(a)&&Ag.add(a),!l&&Ag.has(a)&&(r.emit("city:order-restored",a),Ag.delete(a)),u&&r.emit("city:leader-celebration",a),u&&!Nu.has(a)&&Nu.add(a),!u&&Nu.has(a)&&(r.emit("city:leader-celebration-ended",a),Nu.delete(a))}))),new na(new Qe,new p(s=>i.getByPlayer(s).forEach(a=>{if(!Nu.has(a))return;o.getByCity(a).grow()})))],"getRules"),UU=tN});var rN={};var DU=n(()=>{w();RU();wU();AU();GU();MU();d.register(...OU(),...TU(),...IU(),...BU(),...UU())});var SU=P(EU=>{"use strict";Object.defineProperty(EU,"__esModule",{value:!0});DU()});var iN={};var FU=n(()=>{ki();Tl();eo.register(ei,fr,ti,yr,Co,ri,Br,tr,ii,Bt,Gr,Ur,dr,Po,Gt,Rt,Ut,To,wo,Lt,Mr)});var oN,kU,YU=n(()=>{ki();Ar();xm();Or();ze();I();v();oN=t((i=Pe,e=N)=>[new st(new p((r,o)=>new m(()=>!i.getByCity(r).some(s=>s instanceof o)))),...[[ei,Vr],[Co,Qt],[ri,Vr],[Br,Cr],[ii,bn],[Gr,Si],[dr,Ai],[Rt,Qt],[Lt,wi],[fr,Ti],[yr,It],[tr,ur],[Bt,ht],[Po,Ir],[Ur,Pn],[Gt,Ro],[Ut,Di],[To,Cn],[wo,vo],[Mr,cr]].map(([r,o])=>new st(new m((s,a)=>a===r),new p(s=>new m(()=>e.getByPlayer(s.player()).completed(o))))),...[[fr,dr],[Mr,Gr],[Bt,tr],[Gt,tr],[Ut,tr],[Ur,Bt,Gt,Ut]].map(([r,...o])=>new st(new m((s,a)=>a===r),new p(s=>new m(()=>i.getByCity(s).some(a=>o.some(l=>a instanceof l)))))),...[[Br,Rt],[Bt,Gt,Ut],[Gt,Ut,Bt],[Ut,Bt,Gt]].map(([r,...o])=>new st(new m((s,a)=>a===r),new p(s=>new m(()=>i.getByCity(s).every(a=>!o.some(l=>a instanceof l))))))],"getRules"),kU=oN});var nN,zU,LU=n(()=>{ki();vm();nN=t(()=>[...[[ei,120],[ti,40],[Co,120],[ri,100],[Br,80],[ii,60],[Gr,80],[dr,80],[Rt,200],[Lt,40],[fr,120],[yr,160],[tr,200],[Bt,240],[Po,160],[Ur,320],[Gt,160],[Ut,160],[To,200],[wo,200],[Mr,160]].flatMap(([i,e])=>Cs(i,e))],"getRules"),zU=nN});var aN,NU,jU=n(()=>{Or();bl();v();ki();Be();aN=t((i=Pe,e=()=>Math.random())=>[new xr(new p(r=>{let o=i.getByCity(r).filter(a=>!(a instanceof Oe)),[s]=o.filter(a=>a instanceof Rt);for(s&&(s.destroy(),o.splice(o.indexOf(s),1));o.length>0&&e()>.7;){let a=o[Math.floor(e()*o.length)];if(!a)break;a.destroy(),o.splice(o.indexOf(a),1)}}))],"getRules"),NU=aN});var de,$x=n(()=>{Ts();Ns();de=class extends ro{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t(de,"CityImprovementMaintenanceGold");Hr(de)});var Bg=n(()=>{va();$x();fy();yf();mu();Pg();Ra()});var sN,WU,HU=n(()=>{ki();Ar();Or();ze();Bg();ym();I();v();sN=t((i=Pe,e=N)=>[...[[ei,de,2],[fr,de,3],[yr,de,3],[Co,de,2],[ri,de,2],[Br,de,1],[tr,de,4],[ii,de,1],[Bt,de,4],[Gr,de,1],[Ur,de,6],[dr,de,1],[Po,de,4],[Gt,de,2],[Rt,de,0],[Ut,de,4],[To,de,2],[wo,de,4],[Lt,de,1],[Mr,de,3]].map(([r,o,s])=>new at(new m(a=>i.getByCity(a).some(l=>l instanceof r)),new p(a=>{let[l]=i.getByCity(a).filter(u=>u instanceof r);return new o(s,l)}))),...[[ti,de,0,null,pr],[ti,de,1,pr,Zt],[ti,de,2,Zt,null]].map(([r,o,s,a,l])=>new at(new m(u=>i.getByCity(u).some(c=>c instanceof r)),new m(u=>a===null||e.getByPlayer(u.player()).completed(a)),new m(u=>l===null||!e.getByPlayer(u.player()).completed(l)),new p(u=>{let[c]=i.getByCity(u).filter(f=>f instanceof r);return new o(s,c)})))],"getRules"),WU=sN});var lN,_U,KU=n(()=>{Or();Xe();w();Ac();I();v();ki();lN=t((i=H,e=Pe,r=d)=>[new $o(new m(o=>i.getByPlayer(o.player()).length===0),new p(o=>e.register(new Rt(o,r))))],"getRules"),_U=lN});var mN,qU,VU=n(()=>{Or();I();Cl();v();mN=t((i=Pe)=>[new Wr(new m(e=>i.getByCity(e).length>0),new p(e=>i.getByCity(e).forEach(r=>r.destroy())))],"getRules"),qU=mN});var pN,JU,$U=n(()=>{ki();Or();I();v();Bg();hf();pN=t((i=Pe)=>[new Ln(new m(e=>!i.getByCity(e.city()).some(r=>r instanceof ei)),new m(e=>e.size()>10),new p(e=>e.shrink())),new Ln(new m(e=>i.getByCity(e.city()).some(r=>r instanceof ii)),new p(e=>e.add(new zn(e.cost().value()/2))))],"getRules"),JU=pN});var uN,ZU,QU=n(()=>{Or();q();oR();v();uN=t((i=Pe,e=b)=>[new Kp(new p(r=>i.register(r))),new Kp(new p((r,o)=>{e.emit("city-improvement:created",r,o)}))],"getRules"),ZU=uN});var cN,XU,eM=n(()=>{ki();Or();Bg();I();v();YO();zc();so();cN=t((i=Pe)=>[...[[dr,Ee,.5],[dr,Oi,.5],[fr,Ee,.5],[fr,Oi,.5],[Gr,qt,.5],[Mr,qt,.5],[tr,V,.5],[Ut,V,.5],[Bt,V,.5],[Gt,V,.5],[Ur,V,.5],[Br,tn,.5]].map(([e,r,o])=>new Pl(new qv,new m(s=>i.getByCity(s).some(a=>a instanceof e)),new p((s,a)=>new r(Math.floor(Le(a,r)*o),e.name))))],"getRules"),XU=cN});var fN,tM,rM=n(()=>{Or();Ca();ki();$f();I();v();Ru();fN=t((i=Pe,e=mr)=>[new da(new m(r=>r.city()!==null),new m(r=>i.getByCity(r.city()).some(o=>o instanceof ti)),new p(r=>e.register(new Ta(r))))],"getRules"),tM=fN});var yN={};var iM=n(()=>{w();YU();LU();jU();HU();KU();VU();$U();QU();eM();rM();d.register(...kU(),...zU(),...NU(),...WU(),..._U(),...qU(),...JU(),...ZU(),...XU(),...tM())});var nM=P(oM=>{"use strict";Object.defineProperty(oM,"__esModule",{value:!0});FU();iM()});var sM={};ec(sM,{default:()=>dN,registerCityNames:()=>aM});var aM,dN,lM=n(()=>{_t();Pt();aM=t((i=ee)=>{["Bergen","Cannae","Capua","Cordoba","Cremona","Crete","Cunaxa","Damascus","Dublin","Genoa","Ghent","Issus","Lisbon","Mecca","Melbourne","Milan","Naples","Pisa","Prague","Salamis","Salzburg","Seville","Sidon","Sydney","Tarsus","Toronto","Turin","Tyre","Utica","Venice","Verona"].forEach(e=>i.register(new re(e,null)))},"registerCityNames"),dN=aM});var Zx=n(()=>{ip();Gu();Uu();Mu();Du();lp();Eu();pp();Su();Fu();ku();Yu();dp();zu()});var Gg,Ug,Qx=n(()=>{Qi();Kt();Gg=class extends He{constructor(){super(fe)}};t(Gg,"CivilizationRegistry");Ug=new Gg});var pM={};ec(pM,{default:()=>gN,registerCivilizations:()=>mM});var mM,gN,uM=n(()=>{Zx();Qx();mM=t((i=Ug)=>{i.register(Da,Ea,Sa,Fa,ka,Ya,za,La,Na,ja,Wa,Ha,_a,Ka)},"registerCivilizations"),gN=mM});var Va,cM=n(()=>{ft();ip();Va=class extends se{static civilization(){return Hl}name(){return"Abraham Lincoln"}};t(Va,"AbrahamLincoln")});var fM=n(()=>{ft();ip()});var yM=n(()=>{cM();fM()});var Ja,dM=n(()=>{ft();Gu();Ja=class extends se{static civilization(){return op}name(){return"Moctezuma II"}};t(Ja,"MoctezumaII")});var gM=n(()=>{dM()});var $a,hM=n(()=>{ft();Uu();$a=class extends se{static civilization(){return np}name(){return"Hammurabi"}};t($a,"Hammurabi")});var OM=n(()=>{hM()});var Za,RM=n(()=>{ft();Mu();Za=class extends se{static civilization(){return ap}name(){return"Mao Zedong"}};t(Za,"MaoZedong")});var xM=n(()=>{RM()});var Qa,vM=n(()=>{ft();Du();Qa=class extends se{static civilization(){return sp}name(){return"Ramesses II"}};t(Qa,"RamessesII")});var bM=n(()=>{vM()});var Xa,CM=n(()=>{ft();lp();Xa=class extends se{static civilization(){return _l}name(){return"Elizabeth I"}};t(Xa,"ElizabethI")});var PM=n(()=>{ft();lp()});var TM=n(()=>{CM();PM()});var es,wM=n(()=>{ft();Eu();es=class extends se{static civilization(){return mp}name(){return"Napoleon I"}};t(es,"NapoleonI")});var IM=n(()=>{wM()});var ts,AM=n(()=>{ft();pp();ts=class extends se{static civilization(){return Kl}name(){return"Frederick the Great"}};t(ts,"FrederickTheGreat")});var BM=n(()=>{ft();pp()});var GM=n(()=>{AM();BM()});var rs,UM=n(()=>{ft();Su();rs=class extends se{static civilization(){return up}name(){return"Alexander the Great"}};t(rs,"AlexanderTheGreat")});var MM=n(()=>{UM()});var is,DM=n(()=>{ft();Fu();is=class extends se{static civilization(){return cp}name(){return"Mahatma Gandhi"}};t(is,"MahatmaGandhi")});var EM=n(()=>{DM()});var os,SM=n(()=>{ft();ku();os=class extends se{static civilization(){return fp}name(){return"Genghis Khan"}};t(os,"GenghisKhan")});var FM=n(()=>{SM()});var ns,kM=n(()=>{ft();Yu();ns=class extends se{static civilization(){return yp}name(){return"Julius Caesar"}};t(ns,"JuliusCaesar")});var YM=n(()=>{kM()});var zM=n(()=>{ft();dp()});var as,LM=n(()=>{ft();dp();as=class extends se{static civilization(){return ql}name(){return"Joseph Stalin"}};t(as,"JosephStalin")});var NM=n(()=>{zM();LM()});var ss,jM=n(()=>{ft();zu();ss=class extends se{static civilization(){return gp}name(){return"Shaka"}};t(ss,"Shaka")});var WM=n(()=>{jM()});var Xx=n(()=>{yM();gM();OM();xM();bM();TM();IM();GM();MM();EM();FM();YM();NM();WM()});var _M={};ec(_M,{default:()=>hN,registerLeaders:()=>HM});var HM,hN,KM=n(()=>{Xx();Cm();HM=t((i=Yn)=>{i.register(Va,Ja,$a,Za,Qa,Xa,es,ts,rs,is,os,ns,as,ss)},"registerLeaders"),hN=HM});var Mg,vp,Dg=n(()=>{Wp();Mg=class extends Gs{};t(Mg,"Aggression");vp=Mg});var Eg,bp,qM=n(()=>{Dg();Eg=class extends vp{constructor(e){super(e,1)}};t(Eg,"Aggressive");bp=Eg});var Sg,Cp,Fg=n(()=>{Wp();Sg=class extends Gs{};t(Sg,"Militarism");Cp=Sg});var kg,ls,VM=n(()=>{Fg();kg=class extends Cp{constructor(e){super(e,0)}};t(kg,"Civilized");ls=kg});var Yg,Pp,zg=n(()=>{Wp();Yg=class extends Gs{};t(Yg,"Development");Pp=Yg});var Lg,Tp,JM=n(()=>{zg();Lg=class extends Pp{constructor(e){super(e,1)}};t(Lg,"Expansionist");Tp=Lg});var Ng,jg,$M=n(()=>{Dg();Ng=class extends vp{constructor(e){super(e,0)}};t(Ng,"Friendly");jg=Ng});var Wg,Hg,ZM=n(()=>{Fg();Wg=class extends Cp{constructor(e){super(e,1)}};t(Wg,"Militaristic");Hg=Wg});var _g,Ql,QM=n(()=>{Dg();_g=class extends vp{constructor(e){super(e,.5)}};t(_g,"Normal");Ql=_g});var Kg,wp,XM=n(()=>{zg();Kg=class extends Pp{constructor(e){super(e,.5)}};t(Kg,"Normal");wp=Kg});var qg,Vg,eD=n(()=>{Fg();qg=class extends Cp{constructor(e){super(e,.5)}};t(qg,"Normal");Vg=qg});var Jg,ju,tD=n(()=>{zg();Jg=class extends Pp{constructor(e){super(e,0)}};t(Jg,"Perfectionist");ju=Jg});var iD={};ec(iD,{default:()=>ON,registerTraits:()=>rD});var rD,ON,oD=n(()=>{Xx();ZO();qM();VM();JM();$M();ZM();QM();XM();eD();tD();rD=t((i=lf)=>{[[Va,jg,wp,ls],[Ja,Ql,ju,ls],[$a,jg,ju,ls],[Za,Ql,wp,ls],[Qa,Ql,wp,ls],[Xa,Ql,Tp,Vg],[es,bp,Tp,ls],[ts,bp,ju,ls],[rs,Ql,Tp,Hg],[is,jg,ju,Vg],[os,bp,Tp,Hg],[ns,Ql,Tp,ls],[as,bp,wp,Hg],[ss,bp,wp,Vg]].forEach(([e,...r])=>r.forEach(o=>i.register(new o(e))))},"registerTraits"),ON=rD});var aD=P(nD=>{"use strict";Object.defineProperty(nD,"__esModule",{value:!0});var RN=(lM(),O(sM)),xN=(uM(),O(pM)),vN=(KM(),O(_M)),bN=(oD(),O(iD));(0,RN.default)();(0,xN.default)();(0,vN.default)();(0,bN.default)()});var $g,Zg,ev=n(()=>{A();$g=class extends g{};t($g,"Yield");Zg=$g});var Qg,xt,aa=n(()=>{w();vf();ev();Qg=class extends db{#e;#t;constructor(e,r=d){super(),this.#e=e,this.#t=r,this.addKey("city","yields")}static build(e,r=d){return new this(e,r)}city(){return this.#e}yields(){return this.#t.process(Zg,this).flat()}};t(Qg,"Part");xt=Qg});var Nt,ms,tv=n(()=>{aa();Nt=class extends xt{};t(Nt,"Fuel");ms=Nt});var jt,Wu,rv=n(()=>{aa();jt=class extends xt{};t(jt,"Habitation");Wu=jt});var Xg,Xl,eh=n(()=>{A();Xg=class extends g{};t(Xg,"ChooseSlot");Xl=Xg});var th,em,iv=n(()=>{A();th=class extends g{};t(th,"Active");em=th});var sD,rh,ih,ov=n(()=>{Z();w();eh();iv();sD=t((i,e,r)=>e<=i&&i<r,"isBetween"),rh=class extends k{#e=new Map;#t;#r;#i=[];#o;constructor(e,r,o,s=d){super(),this.addKey("activeSlots","height","inactiveSlots","slots","width"),this.#t=e,this.#r=s,this.#o=r,this.#i.push(...o)}activeSlots(){return this.#i.filter(e=>this.#r.process(em,e,this).every(r=>r))}get(e,r){if(e<0||e>=this.#o||r<0||r>=this.#t)return null;let o=[e,r].toString();if(!this.#e.has(o)){let[s]=this.#i.filter(a=>sD(e,a.x(),a.x()+a.width())&&sD(r,a.y(),a.y()+a.height()));this.#e.set(o,s??null)}return this.#e.get(o)}getAdjacent(e){let r=new Set;for(let o=e.x(),s=e.x()+e.width()-1;o<=s;o++){let a=this.get(o,e.y()-1),l=this.get(o,e.y()+e.height());a&&r.add(a),l&&r.add(l)}for(let o=e.y(),s=e.y()+e.height()-1;o<=s;o++){let a=this.get(e.x()-1,o),l=this.get(e.x()+e.width(),o);a&&r.add(a),l&&r.add(l)}return[...r.values()].filter(o=>o!==e)}getFreeSlot(e){let[r]=this.#r.process(Xl,e,this);return r??null}height(){return this.#t}inactiveSlots(){return this.#i.filter(e=>this.#r.process(em,e,this).some(r=>!r))}slots(){return this.#i}width(){return this.#o}};t(rh,"Layout");ih=rh});var rr,Hu,nv=n(()=>{aa();rr=class extends xt{};t(rr,"LifeSupport");Hu=rr});var Rr,_u,av=n(()=>{aa();Rr=class extends xt{};t(Rr,"Power");_u=Rr});var Mt,ps,sv=n(()=>{aa();Mt=class extends xt{};t(Mt,"Propulsion");ps=Mt});var oh,S,lD=n(()=>{Z();oh=class extends k{#e=[];#t;#r=null;#i;#o;#n;constructor(e,r,o,s,a){super(),this.addKey("height","part","width","x","y"),this.#t=o,this.#i=s,this.#o=e,this.#n=r,this.#e.push(...a)}accepts(e){return this.#e.some(r=>e instanceof r)}empty(){return this.#r===null}fill(e){!this.accepts(e)||(this.#r=e)}height(){return this.#t}part(){return this.#r}width(){return this.#i}x(){return this.#o}y(){return this.#n}};t(oh,"Slot");S=oh});var vt,ae,lv=n(()=>{aa();vt=class extends xt{};t(vt,"Structural");ae=vt});var nh,mD,pD=n(()=>{w();tv();rv();ov();nv();av();sv();lD();lv();nh=class extends ih{constructor(e=d){super(12,12,[new S(9,0,1,1,[ms]),new S(10,0,1,2,[ps]),new S(1,1,2,2,[_u]),new S(5,1,2,2,[_u]),new S(8,1,1,1,[ae]),new S(9,1,1,1,[ae]),new S(10,1,1,1,[ae]),new S(8,2,1,1,[ae]),new S(9,2,1,1,[ms]),new S(10,2,1,2,[ps]),new S(0,3,1,1,[ae]),new S(1,3,1,1,[ae]),new S(2,3,1,1,[ae]),new S(3,3,1,1,[ae]),new S(4,3,1,1,[ae]),new S(5,3,1,1,[ae]),new S(6,3,1,1,[ae]),new S(7,3,1,1,[ae]),new S(8,3,1,1,[ae]),new S(9,3,1,1,[ms]),new S(10,3,1,2,[ps]),new S(0,4,2,2,[Hu]),new S(2,4,2,2,[Wu]),new S(4,4,2,2,[Hu]),new S(6,4,2,2,[Wu]),new S(8,4,1,1,[ae]),new S(9,4,1,1,[ae]),new S(10,4,1,1,[ae]),new S(8,5,1,1,[ae]),new S(9,5,1,1,[ms]),new S(10,5,1,2,[ps]),new S(0,6,2,2,[Wu]),new S(2,6,2,2,[Hu]),new S(4,6,2,2,[Wu]),new S(6,6,2,2,[Hu]),new S(8,6,1,1,[ae]),new S(9,6,1,1,[ms]),new S(10,6,1,2,[ps]),new S(8,7,1,1,[ae]),new S(9,7,1,1,[ae]),new S(10,7,1,1,[ae]),new S(0,8,1,1,[ae]),new S(1,8,1,1,[ae]),new S(2,8,1,1,[ae]),new S(3,8,1,1,[ae]),new S(4,8,1,1,[ae]),new S(5,8,1,1,[ae]),new S(6,8,1,1,[ae]),new S(7,8,1,1,[ae]),new S(8,8,1,1,[ae]),new S(9,8,1,1,[ms]),new S(10,8,1,2,[ps]),new S(1,9,2,2,[_u]),new S(5,9,2,2,[_u]),new S(8,9,1,1,[ae]),new S(9,9,1,1,[ms]),new S(10,9,1,2,[ps]),new S(8,10,1,1,[ae]),new S(9,10,1,1,[ae]),new S(10,10,1,1,[ae]),new S(9,11,1,1,[ms]),new S(10,11,1,2,[ps])],e)}};t(nh,"Default");mD=nh});var ah,Ip,sh=n(()=>{Qi();ov();ah=class extends Kv{constructor(){super(ih)}};t(ah,"LayoutRegistry");Ip=new ah});var CN={};var uD=n(()=>{pD();sh();Ip.register(mD)});var fD=P(cD=>{"use strict";Object.defineProperty(cD,"__esModule",{value:!0});uD()});var lh,mh,mv=n(()=>{lh=class{#e=[];constructor(...e){this.#e.push(...e)}isBetween(...e){return e.every(r=>this.#e.includes(r))&&e.length===this.#e.length}players(){return this.#e}};t(lh,"Interaction");mh=lh});var ph,yD,dD=n(()=>{ge();mv();ph=class extends F{constructor(){super(mh)}getByPlayer(e){return this.entries().filter(r=>r.players().includes(e))}getByPlayers(...e){return this.entries().filter(r=>r.isBetween(...e))}};t(ph,"InteractionRegistry");yD=new ph});var Ap,gD=n(()=>{mv();Ap=class extends mh{constructor(...e){let r=e.map(o=>o.player());super(...r)}};t(Ap,"Contact")});var hD=n(()=>{gD()});var PN,OD,RD=n(()=>{dD();$e();hD();I();v();kt();PN=t((i=yD,e=W)=>[new J(new m(r=>r.tile().getNeighbours().some(o=>e.getByTile(o).some(s=>s.player()!==r.player()))),new p(r=>r.tile().getNeighbours().forEach(o=>e.getByTile(o).filter(s=>s.player()!==r.player()).forEach(s=>i.register(new Ap(r,s))))))],"getRules"),OD=PN});var TN={};var xD=n(()=>{w();RD();d.register(...OD())});var bD=P(vD=>{"use strict";Object.defineProperty(vD,"__esModule",{value:!0});xD()});var uh,ch,pv=n(()=>{uh=class{#e;#t;#r;constructor(e,r,o){this.#e=e,this.#t=r,this.#r=o}civilizationType(){return this.#e}mapGenerator(){return this.#t}startTile(){return this.#r}startTileForMap(e){let{x:r,y:o}=this.#r;return e.get(r,o)}};t(uh,"CivilizationStartTile");ch=uh});var wN,In,uv=n(()=>{wN=t((i,e,r,o)=>{for(;r<0;)r+=e;for(;o<0;)o+=i;return r=r%e,o=o%i,o*e+r},"coordsToIndex"),In=wN});var IN,tm,fh=n(()=>{IN=t((i,e,r)=>{let o=i*e;for(;r<0;)r+=o;return r=r%o,[r%e,Math.floor(r/e)]},"indexToCoords"),tm=IN});var AN,CD,PD=n(()=>{fh();AN=t((i,e,r,o)=>{let[s,a]=tm(i,e,r),[l,u]=tm(i,e,o),c=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[f]=c.map(([y,h])=>[y*e,h*i]).map(([y,h])=>[s-l+y,a-u+h]).map(y=>Math.hypot(...y)).sort((y,h)=>y-h);return f},"distanceFrom"),CD=AN});var BN,rm,cv=n(()=>{uv();fh();BN=t((i,e,r,o=!0)=>{let[s,a]=tm(i,e,r),l=In(i,e,s,a-1),u=In(i,e,s+1,a-1),c=In(i,e,s+1,a),f=In(i,e,s+1,a),y=In(i,e,s,a+1),h=In(i,e,s-1,a+1),G=In(i,e,s-1,a),D=In(i,e,s-1,a-1);return o?[l,c,y,G]:[l,u,c,f,y,h,G,D]},"getNeighbours"),rm=BN});var Bp,yh,dh=n(()=>{uv();PD();cv();fh();Bp=class{#e;#t;#r;constructor(e,r,o={}){this.#e=e,this.#t=o,this.#r=r}coordsToIndex(e,r){return In(this.#e,this.#r,e,r)}distanceFrom(e,r){return CD(this.#e,this.#r,e,r)}generate(){throw new Error(`Generator#generate(): Must be overridden in '${this.constructor.name}'.`)}getNeighbours(e,r=!0){return rm(this.#e,this.#r,e,r)}height(){return this.#e}indexToCoords(e){return tm(this.#e,this.#r,e)}options(){return this.#t}width(){return this.#r}};t(Bp,"Generator");yh=Bp});var GN,gh,Gp,hh=n(()=>{zR();LR();Wy();dh();Hm();NR();jR();WR();HR();yu();qy();_R();KR();GN={A:YC,D:zC,F:jy,G:rl,H:LC,J:NC,M:jC,O:WC,P:jm,R:Ky,S:HC,T:_C},gh=class extends yh{async generate(){return Array.from(`OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOAAAAAAAOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOAAOAOAAAOAAAAAAAAOOOOOOAOOOOOGGOOOOOTAGOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOTTTTAOOOOAAAAAAAAOOOOAAAAAATOOOOOAAOOOOOOOOOOOOOOOAAOOOOOTOOOOOOOOOOOOOOOOOO
OOOTTTTTTTTTAAOAOAAAAAOOOAAAAATOOOOOOOOOOOOOOOAOOOOOFFAAFFFFFOOFFFOOOOFFFOOOOOOO
OTPTGPPPPTTTTTOTAAAOOAOOOAAAATOOOOOOOOOOOOOOOAOOAAOFFGAFFFFFFFAFFFFFFFFFFOTOOOOO
OOOOOPGTPTOOTTAAAAAAAAOOAAGGOOOOOOOOOOGAAOOOOOOGOGFFFGFFFFFFFFAFFAFFFFFGFGGOOOOO
OOOOOGGFGPPTTAAOOOAOTOOOAGOOOOAOOOOOOAFGFPGFOAAFGTGFFFFFFFFFFFFFFFGFFGOGFFOOOOOO
OOOOPMGFPPPPTTOOOATAAOOOOOOOOOOOOOOOGFPGGFOFFFFFFGFFFFFFFFFFFFFFGFFFFGOOFOOOOOOO
OOOOPMGFGPPOTTTAATTTTOOOOOOOOOOHOOOPFGOGGGFFFGFGGGFFFFFFFFFFFFFFFFFFOOOOFGOOOOOO
OOOOPHFFGPGOPPPOPTTTTOOOOOOOOOGROOOOOPOGFGFFGFFFGFGFGGFGGFFFGFFFFFFFGOOOOPOOOOOO
OOOOGGHFGPPPPPPPPPTPPOOOOOOOOOOFOOOFOOOFFFRFFFFRGFPFFPFGPFGFFOFFFFFGPPGOOOOOOOOO
OOOGGGMGGGPPPOPPPPPOPOOOOOOOOOGGOOOGPPFFFGRRFRRRGGFGGGGGPGGFFFFDPPPPPPOOOOOOOOOO
OOOGGFMGRGRPGORRGOPOOOOOOOOOOOOOOGRGGGGFFGFRFRPGPGGGGGPPPPPPPPPPPPPPGPGOOOOOOOOO
OOGGGMMGRGRGGGGOOOOOOOOOOOOOOOOOGGRMMGGGGPGRPRRPPPPPPPPPPPPPPPPPPPPPGPGOPGOOOOOO
OOGGPPHGRRRGGGOOOOOOOOOOOOOOOOOOPGGGGFGRRGPRPDOOPPOPPPDPDDDPPPPPPDPPPGOOGOOOOOOO
OOGFPPFGGRGGGPOOOOOOOOOOOOOOOOPPPPOGHOOGRFOOOHPOGPPDPDPDDPPPPPPDDPPOPGOOMGOOOOOO
OOGPPDDGGRGGOOOOOOOOOOOOOOOOOOPPPOOOGHOOOGPPPPPOPPPPDPPHPDDDDDDPPPGOOOOOOPOOOOOO
OOPOGDDPOOOPOOOOOOOOOOOOOOOOOOOOOOOOOGOOOOOPPPPGPPPPPPHHMHHHHHHHHMHPGOOGOOOOOOOO
OOPOGDDOOOOPOOOOOOOOOOOOOOOOOOGPPDDOOOOOOOOPPRRHPPPDPPHPGHMMMMMHHHPPPGOOOOOOOOOO
OOOOGDGOOOOOOOOOOOOOOOOOOOOOOODPHHPPPGODPOPPPGRRPPPPPHHRDPGMHHMHHPPRRROOOOOOOOOO
OOOOGGPOPOOOGPOOOOOOOOOOOOOOOPPHDDDPPPPDDRGDPPDOPPPPHPRRDGGGHHHHHPGPPPOOOOOOOOOO
OOOOOGGPGOOOOGPOOOOOOOOOOOOOPPDDDDDPDDDDDRDOPDDOOOOHHRRDPGGRGGGHGPGGPOOOOOOOOOOO
OOOOOOOOGGOOOOOOOOOOOOOOOOOOPDDDDDDDDDDDSRSODDDDDDOOOOPPGGGRRPPGFGGGOOOGOOOOOOOO
OOOOOOOOOGOOOOOOOOOOOOOOOOOPDDDDDDPPPDDDDRDOOPDDDDPOOOOGGGGGOOGGGGGOOOOPGOOOOOOO
OOOOOOOOOPPOGPPGOOOOOOOOOOODDDDDDDPDDDDDDRDDOODDDDOOOOOOGGGOOOPPGGOOOOOGGOOOOOOO
OOOOOOOOOOPGFPPPGOOOOOOOOOODDDDDDDDPDPDPPDHHDOOPDOOOOOOOGGOOOOOGGGGOOOOOFGOOOOOO
OOOOOOOOOOOGHGGGGGGOOOOOOOOPPDPPPPDDDPPPPPPMDPOOGOOOOOOOPGOOOOOOOGGOOOOOOGOOOOOO
OOOOOOOOOOOHJJJGGGGROOOOOOOOPPDPPPPPPPPPPPPHMDPOOOOOOOOOOGOOOOOOOOOOOPOOOOOOOOOO
OOOOOOOOOOGHJRRJJRRRGOOOOOOOOPPPGOPPGPGGGGGGMDDPOOOOOOOOOOOOOOOOOOOGPPOOGPOOOOOO
OOOOOOOOOOPGJJRRRRJGFGGOOOOOOOOOOOOGGGGJJJGGODPPOOOOOOOOOOOOOOOGFGOOPGFGGGOGOOOO
OOOOOOOOOOOFGGJJGJJFGGGPOOOOOOOOOOOGGJJRRRGGHPPOOOOOOOOOOOOOOOOOGFOOGOPGOOOPGGOO
OOOOOOOOOOOGHGGGGGGGGGGOOOOOOOOOOOOGGRRRJJHOGGOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOGGO
OOOOOOOOOOOOGMFGGGGGGPOOOOOOOOOOOOOOGRJJJGHMGOOOOOOOOOOOOOOOOOOOOPPOOOOOGOOOOOOO
OOOOOOOOOOOOGFMGGFGPPPOOOOOOOOOOOOOORRGGGGGMPOOOOOOOOOOOOOOOOOOOOOGOOOOOOOPGOOOO
OOOOOOOOOOOOOOHMGGRPGGOOOOOOOOOOOOOOOGGGGGGHGOOOOOOOOOOOOOOOOOOOOOOOOOOGGPGPGGOO
OOOOOOOOOOOOOOGHGGRGGOOOOOOOOOOOOOOOODPPGGGGGGOOOOOOOOOOOOOOOOOOOOOOOOOGGPPPPGOO
OOOOOOOOOOOOOOGMGPRROOOOOOOOOOOOOOOOPPPPPPPGGGOPOOOOOOOOOOOOOOOOOOOOGGPPPDDDPPPO
OOOOOOOOOOOOOOGMGGGPOOOOOOOOOOOOOOOOHPDDPPGGOOOPOOOOOOOOOOOOOOOOOOOGGGPDDDDDDPFO
OOOOOOOOOOOOOOPMGGGOOOOOOOOOOOOOOOOOOPPDPPGGOOOGOOOOOOOOOOOOOOOOOOOGPDDDDDDDDPPO
OOOOOOOOOOOOOOOMGPOOOOOOOOOOOOOOOOOOOHPPPGGGOOGPOOOOOOOOOOOOOOOOOOOGDDDDDPDDDPGO
OOOOOOOOOOOOOOOGGOOOOOOOOOOOOOOOOOOOOHPPGHGOOOPOOOOOOOOOOOOOOOOOOOODDDDDDDPDDHFO
OOOOOOOOOOOOOOOPGOOOOOOOOOOOOOOOOOOOOODPGHGOOOOOOOOOOOOOOOOOOOOOOOODDDOOGDDDHGOO
OOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOPGGGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOGHHHGOOO
OOOOOOOOOOOOOOOOFOOOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOPGOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
`.replace(/\n/g,"")).map(e=>new GN[e])}height(){return 50}width(){return 80}};t(gh,"Earth");Gp=gh});var Oh,TD,wD=n(()=>{pv();hh();Oh=class extends ch{constructor(e,r){super(e,Gp,r)}};t(Oh,"EarthStartTile");TD=Oh});var Ku,xAe,ID,AD=n(()=>{pv();ge();Ku=class extends am{constructor(){super(ch)}getByCivilization(e){let[r]=this.getBy("civilizationType",e);if(!r)throw new TypeError(`${e.name} does not have a registered start tile.`);return r}getStartTileByCivilizationAndWorld(e,r){return this.getByCivilization(e).startTileForMap(r)}};t(Ku,"CivilizationStartTileRegistry");xAe=new Ku,ID=Ku});var Rh,xh,fv=n(()=>{AD();hh();Rh=class extends ID{entries(){return super.entries().filter(e=>e.mapGenerator()===Gp)}};t(Rh,"EarthStartTileRegistry");xh=new Rh});var UN={};var BD=n(()=>{Zx();wD();fv();xh.register(...[[Da,{x:12,y:18}],[Ea,{x:5,y:23}],[Sa,{x:45,y:22}],[Fa,{x:66,y:19}],[ka,{x:41,y:24}],[Ya,{x:31,y:14}],[za,{x:33,y:16}],[La,{x:38,y:15}],[Na,{x:39,y:18}],[ja,{x:57,y:26}],[Wa,{x:49,y:19}],[Ha,{x:36,y:19}],[_a,{x:44,y:12}],[Ka,{x:42,y:42}]].map(([i,e])=>new TD(i,e)))});var UD=P(GD=>{"use strict";Object.defineProperty(GD,"__esModule",{value:!0});BD()});var MN,MD,DD=n(()=>{I();v();xR();MN=t(()=>[new zs(new m(i=>i<252),new p(i=>i*20-4020)),new zs(new m(i=>i>251),new m(i=>i<302),new p(i=>(i-151)*10+1e3)),new zs(new m(i=>i>301),new m(i=>i<352),new p(i=>(i-201)*5+1500)),new zs(new m(i=>i>351),new m(i=>i<402),new p(i=>(i-251)*2+1750)),new zs(new m(i=>i>401),new p(i=>i-301+1850))],"getRules"),MD=MN});var DN={};var ED=n(()=>{w();DD();d.register(...MD())});var FD=P(SD=>{"use strict";Object.defineProperty(SD,"__esModule",{value:!0});ED()});var EN,kD,YD=n(()=>{JO();Xe();uo();ze();$R();I();v();Sl();km();Ra();EN=t((i=N,e=H)=>[new Nl(new m((r,o)=>i.getByPlayer(o.player()).available().length>0),new p((r,o)=>new vs(r,o))),new Nl(new m(r=>[Re,me,ne].some(o=>r.tile().terrain()instanceof o)),new m((r,o)=>r.tile().getSurroundingArea().score(null,[[en,8],[ha,3],[Oa,1]])>=150),new m(r=>r.tile().getSurroundingArea(4).every(o=>e.getByTile(o)===null)),new p((r,o)=>new bs(r,o))),new Nl(new p((r,o)=>new ws(r,o))),new Nl(new p((r,o)=>new Is(r,o)))],"getRules"),kD=EN});var SN,zD,LD=n(()=>{q();ZR();v();SN=t((i=b)=>[new od(new p((e,r)=>{i.emit("goody-hut:action-performed",e,r)}))],"getRules"),zD=SN});var FN,ND,jD=n(()=>{q();pl();QR();v();FN=t((i=Kr,e=b,r=()=>Math.random())=>[new Xm(new p(o=>i.unregister(o))),new Xm(new p((o,s)=>{let a=o.actions(s),l=a[Math.floor(a.length*r())];o.action(l)})),new Xm(new p((o,s)=>{e.emit("goody-hut:discovered",o,s)}))],"getRules"),ND=FN});var vh,Up,yv=n(()=>{A();vh=class extends g{};t(vh,"Distribution");Up=vh});var kN,WD,HD=n(()=>{pl();I();yv();kN=t((i=Kr,e=()=>Math.random())=>[new Up(new m(r=>r.isLand())),new Up(new m(r=>r.getSurroundingArea(3).every(o=>i.getByTile(o)===null))),new Up(new m(()=>e()<.05))],"getRules"),WD=kN});var YN,_D,KD=n(()=>{pl();Yo();w();v();VO();YN=t((i=Kr,e=()=>Math.random(),r=d)=>[new of(new p((o,s)=>{let a=[Dr,Er],l=a[Math.floor(a.length*e())];return new l(null,s.player(),s.tile(),r)}))],"getRules"),_D=YN});var zN,qD,VD=n(()=>{pl();I();v();kt();zN=t((i=Kr)=>[new J(new m(e=>i.getByTile(e.tile())!==null),new p(e=>{i.getByTile(e.tile()).process(e)}))],"getRules"),qD=zN});var bh,fl,Ch=n(()=>{A();bh=class extends g{};t(bh,"Built");fl=bh});var LN,JD,$D=n(()=>{pl();w();Ch();v();XR();yv();LN=t((i=Kr,e=d)=>[new fl(new p(r=>{let o=e.get(Up);r.forEach(s=>{o.every(a=>a.validate(s))&&i.register(new sd(s))})}))],"getRules"),JD=LN});var NN={};var ZD=n(()=>{YD();LD();jD();HD();KD();w();VD();$D();d.register(...kD(),...zD(),...ND(),...WD(),..._D(),...qD(),...JD())});var XD=P(QD=>{"use strict";Object.defineProperty(QD,"__esModule",{value:!0});ZD()});var jN={};var eE=n(()=>{wn();yd();ep.register(At,pt,er,ut,Ot)});var WN,tE,rE=n(()=>{fn();wn();I();v();uR();Nn();WN=t((i=gt)=>[new lt(new m(e=>!i.getByPlayer(e).is(Fi)),new p(e=>[new Ss(e,i.getByPlayer(e))]))],"getRules"),tE=WN});var HN,iE,oE=n(()=>{yd();fn();w();Dl();wn();v();xl();ix();HN=t((i=ep,e=gt,r=d)=>[new yi(new Dn,new p(o=>{let s=new Od(o,i,r);s.set(new er),e.register(s)}))],"getRules"),iE=HN});var _N,nE,aE=n(()=>{Ar();wn();ze();tx();I();_N=t((i=N)=>[new hu(new m(e=>e===er)),...[[At,wt],[pt,ho],[ut,$r],[Ot,Ei]].map(([e,r])=>new hu(new m(o=>o===e),new m((o,s)=>i.getByPlayer(s).completed(r))))],"getRules"),nE=_N});var KN,sE,lE=n(()=>{q();ao();rx();I();v();KN=t((i=b,e=pe)=>[new Ou(new p((r,o)=>{i.emit("player:government:changed",r,o)})),new Ou(new m(r=>{try{return e.getByPlayer(r),!0}catch(o){if(o instanceof TypeError&&o.message.match(/Wrong number of player worlds exist/))return!1;throw o}}),new p(r=>{e.getByPlayer(r).entries().forEach(s=>s.tile().clearYieldCache(r))}))],"getRules"),sE=KN});var qN={};var mE=n(()=>{w();rE();oE();aE();lE();d.register(...tE(),...iE(),...nE(),...sE())});var uE=P(pE=>{"use strict";Object.defineProperty(pE,"__esModule",{value:!0});eE();mE()});var Ph,cE,fE=n(()=>{A();Ph=class extends g{};t(Ph,"TurnEnd");cE=Ph});var VN,yE,dE=n(()=>{Sm();q();w();fE();VN=t((i=Xo,e=d,r=b)=>[["player:turn-end",o=>{i.unregister(o),e.process(cE,o);let[s]=i.entries();if(!s){r.emit("turn:end");return}r.emit("player:turn-start",s)}]],"getEvents"),yE=VN});var JN,gE,hE=n(()=>{Wl();q();w();Lu();JN=t((i=zo,e=b,r=d)=>[["player:turn-start",o=>{r.process(na,o),i.getByPlayer(o).takeTurn().catch(a=>console.error(a)).finally(()=>{e.emit("player:turn-end",o)})}]],"getEvents"),gE=JN});var $N,OE,RE=n(()=>{Sm();q();Ys();$N=t((i=hi,e=Xo,r=b)=>[["turn:start",()=>{e.register(...i.entries());let[o]=e.entries();r.emit("player:turn-start",o)}]],"getEvents"),OE=$N});var ZN={};var xE=n(()=>{q();dE();hE();RE();[...yE(),...gE(),...OE()].forEach(([i,e])=>b.on(i,e))});var Th,sa,qu=n(()=>{A();Th=class extends g{};t(Th,"Defeated");sa=Th});var QN,vE,bE=n(()=>{Xe();w();bl();I();qu();v();QN=t((i=H,e=d)=>[new xr(new m((r,o,s)=>i.getByPlayer(s).filter(a=>a!==r).length===0),new p((r,o,s)=>{e.process(sa,s,o)}))],"getRules"),vE=QN});var XN,CE,PE=n(()=>{Xe();w();I();qu();Cl();v();XN=t((i=H,e=d)=>[new Wr(new m((r,o)=>i.getByPlayer(r.player()).filter(s=>s!==r).length===0),new p((r,o)=>e.process(sa,r.player(),o)))],"getRules"),CE=XN});var dv,ej,TE,wE=n(()=>{Nn();I();v();Gf();Os();dv=new lt(new jr(9001),new m(i=>{dv.disable();let e=i.mandatoryActions();return dv.enable(),e.length===0}),new p(i=>[new Bf(i,null)])),ej=t(()=>[dv],"getRules"),TE=ej});var tj,IE,AE=n(()=>{q();Dl();v();tj=t((i=b)=>[new yi(new p(e=>{i.emit("player:added",e)}))],"getRules"),IE=tj});var rj,BE,GE=n(()=>{Sm();q();Ys();I();qu();v();rj=t((i=Xo,e=hi,r=b)=>[new sa(new m(o=>i.includes(o)),new p(o=>i.unregister(o))),new sa(new m(o=>e.includes(o)),new p(o=>e.unregister(o))),new sa(new p((o,s)=>{r.emit("player:defeated",o,s)}))],"getRules"),BE=rj});var wh,Ih,gv=n(()=>{A();wh=class extends g{};t(wh,"Spawn");Ih=wh});var ij,UE,ME=n(()=>{w();v();Kx();gv();ij=t((i=d)=>[new Ih(new p((e,r)=>{new HT(null,e,r,i)}))],"getRules"),UE=ij});var oj,DE,EE=n(()=>{Xe();w();$e();v();Sl();xl();hp();km();Ra();Lu();so();oj=t((i=d,e=H,r=W)=>[new na(new Dn,new p(o=>{e.getByPlayer(o).forEach(s=>{let a=s.yields();Fl(a,en,ha,Oa).reduce((l,u,c)=>(l[c].set(u,"Consolidated"),l),[new en(0,"Consolidated"),new ha(0,"Consolidated"),new Oa(0,"Consolidated")]).forEach(l=>i.process(No,l,s,a))})})),new na(new p(o=>r.getByPlayer(o).forEach(s=>{if(s.destroyed())return;s.moves().set(s.movement());let a=s.busy();if(!a){s.setActive(),s.setWaiting(!1);return}!a.validate()||a.process()})))],"getRules"),DE=oj});var nj,SE,FE=n(()=>{q();v();pR();nj=t((i=b)=>[new Nf(new p((e,r)=>{i.emit("player:visibility-changed",e,r)}))],"getRules"),SE=nj});var aj,kE,YE=n(()=>{Ys();ao();by();v();aj=t((i=hi,e=pe)=>[new ba(new p(r=>{r.clearYieldCache(null),i.forEach(o=>{e.getByPlayer(o).getByTile(r)!==null&&r.clearYieldCache(o)})}))],"getRules"),kE=aj});var sj,zE,LE=n(()=>{Xe();w();I();qu();Qp();v();sj=t((i=H,e=d)=>[new Qo(new m((r,o)=>i.getByPlayer(r.player()).length===0),new p((r,o)=>e.process(sa,r.player(),o)))],"getRules"),zE=sj});var lj,NE,jE=n(()=>{ao();v();gR();lj=t((i=pe)=>[new Xf(new p((e,r)=>{e.clearYieldCache(r);let o=i.getByPlayer(r);o.register(e),o.getByTile(e).update()}))],"getRules"),NE=lj});var Ah,Bh,hv=n(()=>{A();Ah=class extends g{};t(Ah,"PickStartTile");Bh=Ah});var mj,WE,HE=n(()=>{Qx();Wl();q();Ys();ao();w();Ch();v();Sl();Hm();hv();yu();Wf();km();qy();Ra();gv();mj=t((i=Ug,e=zo,r=b,o=hi,s=pe,a=d,l=()=>Math.random())=>[new fl(new p(u=>o.entries().forEach(c=>s.register(new wm(c,u))))),new fl(new p(u=>{let c=new Map,f=new Map,y=t((B,E=null)=>(c.has(B)||c.set(B,B.score(E,[[en,8],[ha,3],[Oa,1]])),c.get(B)),"tileScore"),h=t((B,E=null)=>(f.has(B)||f.set(B,B.getSurroundingArea().entries().reduce((Y,ue)=>Y+y(ue,E),0)),f.get(B)),"areaScore");r.emit("world:generate-start-tiles");let G=[],D=u.entries().filter(B=>[rl,jm,Ky].some(E=>B.terrain()instanceof E)).map(B=>({tile:B,score:h(B)})).sort(({score:B},{score:E})=>E-B).map(({tile:B})=>B);r.emit("world:start-tiles",D),e.entries().reduce((B,E)=>B.then(async()=>{let Y=E.player();await E.chooseCivilization(i.entries()),i.unregister(Y.civilization().sourceClass());let[ue]=a.process(Bh,u,Y,G);if(!ue)throw new TypeError("Not enough `startingSquare`s.");G.push(ue),a.process(Ih,Y,ue)}),Promise.resolve()).then(()=>r.emit("game:start"))})),new fl(new p(u=>{r.emit("world:built",u)}))],"getRules"),WE=mj});var pj={};var _E=n(()=>{bE();PE();w();wE();AE();GE();ME();EE();FE();YE();LE();jE();HE();d.register(...vE(),...CE(),...TE(),...IE(),...BE(),...UE(),...DE(),...SE(),...kE(),...zE(),...NE(),...WE())});var qE=P(KE=>{"use strict";Object.defineProperty(KE,"__esModule",{value:!0});xE();_E()});var uj={};var VE=n(()=>{Ar();U();R.register(Zn,co,Pi,Qn,Zt,Ti,fo,yo,wi,yn,wa,Cr,dn,wt,Ii,Ia,Vr,go,Ai,ho,Pr,ht,gn,hn,Xn,ea,Aa,On,pr,Ba,ur,Tr,Rn,Ga,wr,Jr,Oo,Qt,Ir,Bi,Gi,xn,$r,Xt,Ui,Zr,Ro,Qr,Mi,vn,bn,Xr,Cn,Di,It,Pn,ta,xo,ra,ia,vo,Ei,Ma,bo,Tn,cr,Si)});var JE=n(()=>{XO()});var cj,$E,ZE=n(()=>{ze();Nn();JE();I();v();cj=t((i=N)=>[new lt(new m(e=>i.getByPlayer(e).researching()===null),new m(e=>i.getByPlayer(e).available().length>0),new p(e=>[new Al(e,i.getByPlayer(e))]))],"getRules"),$E=cj});var fj,QE,XE=n(()=>{U();ze();w();Dl();v();Cc();fj=t((i=R,e=N,r=d,o=()=>Math.random())=>[new yi(new p(s=>e.register(new um(s,i,r)))),new yi(new p(s=>{let a=e.getByPlayer(s);for(let l=0,u=Math.min(a.available().length,Math.floor(4*o()));l<u;l++){let c=a.available();a.addAdvance(c[Math.floor(o()*c.length)])}}))],"getRules"),QE=fj});var yj,e0,t0=n(()=>{ze();bl();v();I();yj=t((i=N,e=()=>Math.random())=>[new xr(new m((r,o,s)=>i.getByPlayer(s).complete().some(a=>!i.getByPlayer(o).completed(a.constructor))),new p((r,o,s)=>{let a=i.getByPlayer(o),l=i.getByPlayer(s).complete().filter(u=>!a.completed(u.constructor));a.addAdvance(l.map(u=>u.constructor)[Math.floor(e()*l.length)])}))],"getRules"),e0=yj});var dj,r0,i0=n(()=>{q();dc();v();dj=t((i=b)=>[new Rs(new p((e,r)=>{i.emit("player:research-complete",e,r)}))],"getRules"),r0=dj});var gj,o0,n0=n(()=>{zO();v();gj=t(()=>[new hc(new p((i,e)=>(e.complete().length+1)*(6+2*0)))],"getRules"),o0=gj});var hj,a0,s0=n(()=>{ze();w();Vl();I();v();hp();Pg();hj=t((i=N,e=d)=>[new No(new m(r=>r instanceof qt),new m((r,o,s)=>!e.process(Lo,o,s).some(a=>a)),new p((r,o)=>i.getByPlayer(o.player()).add(r)))],"getRules"),a0=hj});var Oj,l0,m0=n(()=>{Ar();I();v();LO();Oj=t(()=>[...[[Zn,ea,Pr],[Pi,Bi,Xt],[Qn,bo,Mi],[Zt,dn,ia],[Ti,Ei,Tn],[fo,Vr,Rn],[yn,cr,Gi],[wa,Xn,Ba],[Cr,co],[dn,Di,hn],[wt,Qr,ur],[Ii,ht,Bi],[Ia,hn,Ei],[Vr,Ai,Qt],[go,Ti,ur],[Ai,yo],[ho,Qr,wr],[Pr,xn,Jr],[ht,gn,Pr],[gn,Vr,Ma],[hn,pr,yn],[Xn,Qt,$r],[ea,dn,Mi],[Aa,Ro,vo],[On,go,Gi],[pr,Tr,Rn],[ur,Xr,Ti],[Tr,gn,wr],[Rn,yo],[Ga,Ir,wt],[wr,Cr,Si],[Jr,Ui,Mi],[Oo,co],[Ir,go,Zt],[Bi,co,Qt],[Gi,Qr,Tn],[xn,pr,cr],[$r,Cr,Xt],[Xt,wi],[Ui,Pi,Oo],[Zr,Ir,Qn],[Ro,Zr,ht],[Qr,Xt,wr],[Mi,Ui,Bi],[vn,Di,xo],[Xr,fo,ra],[Cn,ho,Ir],[Di,go,yn],[It,Qr,Si],[Pn,Ii,vn],[ta,ht,Zn],[xo,Ii,ta],[ra,Tr,Mi],[ia,xn,ur],[vo,Ir,vn],[Ei,Cr,wr],[bo,Pi,cr],[Tn,Cr,Ai],[cr,Qr,Bi],[Si,co]].map(([i,...e])=>new Rc(new m(r=>r===i),new p((r,o)=>e.every(s=>o.some(a=>a instanceof s)))))],"getRules"),l0=Oj});var Rj,p0,u0=n(()=>{q();v();vc();Rj=t((i=b)=>[new pm(new p((e,r)=>{i.emit("player:research",e,r)}))],"getRules"),p0=Rj});var xj={};var c0=n(()=>{ZE();XE();t0();i0();n0();w();s0();m0();u0();d.register(...$E(),...QE(),...e0(),...r0(),...o0(),...a0(),...l0(),...p0())});var y0=P(f0=>{"use strict";Object.defineProperty(f0,"__esModule",{value:!0});VE();c0()});var us=n(()=>{tv();rv();nv();av();sv();lv()});var vj={};var d0=n(()=>{us();Tl();eo.register(Nt,jt,rr,Rr,Mt,vt)});var Gh,Uh,Ov=n(()=>{A();Gh=class extends g{};t(Gh,"Built");Uh=Gh});var Mh,Dh,Rv=n(()=>{A();Mh=class extends g{};t(Mh,"ChanceOfSuccess");Dh=Mh});var Eh,Sh,xv=n(()=>{A();Eh=class extends g{};t(Eh,"FlightTime");Sh=Eh});var Fh,kh,vv=n(()=>{A();Fh=class extends g{};t(Fh,"Landed");kh=Fh});var Yh,g0,h0=n(()=>{A();Yh=class extends g{};t(Yh,"Launch");g0=Yh});var zh,Vu,bv=n(()=>{A();zh=class extends g{};t(zh,"Lost");Vu=zh});var Lh,Mp,Nh=n(()=>{Z();w();Ft();Ov();Rv();eh();xv();vv();h0();bv();Lh=class extends k{#e=!1;#t;#r;#i;#o;#n=null;#a;constructor(e,r,o=d,s=te,a=()=>Math.random()){super(),this.#r=e,this.#t=r,this.#o=o,this.#a=s,this.#i=a,this.addKey("activeParts","chanceOfSuccess","flightTime","inactiveParts","launched","layout","player","successful","yields")}activeParts(){return this.#t.activeSlots().filter(e=>!e.empty()).map(e=>e.part())}add(e){let[r]=this.#o.process(Xl,e,this.#t);!r||(r.fill(e),this.#o.process(Uh,e,this))}chanceOfSuccess(){return Math.max(...this.#o.process(Dh,this),0)}check(){if(!(this.#n!==null||this.#e===!1||this.#e+this.flightTime()<this.#a.value())){if(this.#n=this.chanceOfSuccess()>this.#i(),this.#n){this.#o.process(kh,this);return}this.#o.process(Vu,this)}}flightTime(){return Math.min(...this.#o.process(Sh,this),1/0)}inactiveParts(){return this.#t.inactiveSlots().filter(e=>!e.empty()).map(e=>e.part())}launch(){this.#o.process(g0,this),this.#e=this.#a.value()}launched(){return this.#e}layout(){return this.#t}player(){return this.#r}successful(){return this.#n}yields(){return this.activeParts().flatMap(e=>e.yields())}};t(Lh,"Spaceship");Mp=Lh});var jh,jo,im=n(()=>{ge();Nh();jh=class extends F{constructor(){super(Mp)}getActiveByPlayer(e){let[r]=this.getBy("player",e).filter(o=>o.launched()===!1||o.successful()===null);return r||null}};t(jh,"SpaceshipRegistry");jo=new jh});var Wh,ct,An=n(()=>{ge();Be();Wh=class extends F{constructor(){super(Oe)}getByCity(e){return this.getBy("city",e)}getByPlayer(e){return this.filter(r=>r.city().player()===e)}};t(Wh,"WonderRegistry");ct=new Wh});var Bn,Hh,_h=n(()=>{Be();Bn=class extends Ce{};t(Bn,"ApolloProgram");Hh=Bn});var bj,O0,R0=n(()=>{xm();us();ze();im();An();_h();I();v();aa();Vd();Bu();Qd();bj=t((i=ct,e=N,r=jo)=>[new st(new m((o,s)=>Object.prototype.isPrototypeOf.call(xt,s)),new p(()=>new m(()=>i.some(o=>o instanceof Hh)))),new st(new m((o,s)=>Object.prototype.isPrototypeOf.call(xt,s)),new p(o=>new m(()=>{let s=r.getActiveByPlayer(o.player());return s===null?!1:s.launched()===!1}))),...[[vt,Zd],[Nt,Au],[Mt,Au],[jt,Ua],[rr,Ua],[Rr,Ua]].map(([o,s])=>new st(new m((a,l)=>l===o),new p(a=>new m(()=>e.getByPlayer(a.player()).completed(s)))))],"getRules"),O0=bj});var Cj,x0,v0=n(()=>{vm();us();Cj=t(()=>[...[[Nt,160],[jt,320],[rr,320],[Rr,320],[Mt,160],[vt,80]].flatMap(([i,e])=>Cs(i,e))],"getRules"),x0=Cj});var Pj,b0,C0=n(()=>{Sm();sh();w();im();Ft();_h();bm();I();v();aa();Nh();Pj=t((i=Xo,e=jo,r=Ip,o=d,s=te,a=()=>Math.random())=>[new ci(new m((l,u)=>u instanceof Hh),new p(()=>{let[l]=r.entries(),u=new l(o);i.entries().forEach(c=>e.register(new Mp(c,u,o,s,a)))})),new ci(new m((l,u)=>u instanceof xt),new m((l,u)=>e.getActiveByPlayer(u.city().player())!==null),new p((l,u)=>{let c=u;e.getActiveByPlayer(c.city().player()).add(c)}))],"getRules"),b0=Pj});var Kh,yl,Cv=n(()=>{Z();Kh=class extends Ie{#e;#t;constructor(e,r){super(),this.addKey("resource","value"),this.#e=e,this.#t=r}resource(){return this.#e}value(){return this.#t}};t(Kh,"SpendCost");yl=Kh});var Tj,P0,T0=n(()=>{I();v();Ts();aa();jp();Cv();Tj=t(()=>[new to(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(xt,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>new yl(ro,i.remaining()*8))),new to(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(xt,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>new yl(ro,i.remaining()*4)))],"getRules"),P0=Tj});var wj,w0,I0=n(()=>{im();Nn();I();v();sR();wj=t((i=jo)=>[new lt(new m(e=>i.getActiveByPlayer(e)!==null),new p(e=>[new Ob(e,i.getActiveByPlayer(e))]))],"getRules"),w0=wj});var Pv,Ij,A0,B0=n(()=>{us();iv();I();v();Pv=new em(new m(i=>i.part()instanceof Mt),new p((i,e)=>{Pv.disable();let r=e.activeSlots();return Pv.enable(),e.getAdjacent(i).some(o=>o.part()instanceof Nt&&r.includes(o))})),Ij=t(()=>[new em(new p(i=>i.part()!==null)),new em(new m(i=>[Nt,jt,rr,Rr].some(e=>i.part()instanceof e)),new p((i,e)=>e.getAdjacent(i).some(r=>r.part()instanceof vt))),Pv],"getRules"),A0=Ij});var Aj,G0,U0=n(()=>{q();Ov();v();Aj=t((i=b)=>[new Uh(new p(e=>{i.emit("player:spaceship:part-built",e.city().player())}))],"getRules"),G0=Aj});var Gn,M0=n(()=>{De();Gn=class extends z{};t(Gn,"Energy")});var la,D0=n(()=>{De();la=class extends z{};t(la,"LifeSupport")});var Vi,E0=n(()=>{De();Vi=class extends z{};t(Vi,"Mass")});var dl,S0=n(()=>{De();dl=class extends z{};t(dl,"Population")});var qh=n(()=>{M0();D0();E0();S0()});var Bj,F0,k0=n(()=>{qh();us();Rv();v();Bj=t(()=>[new Dh(new p(i=>{let[e,r,o,s,a]=i.yields().reduce(([h,G,D,B,E],Y)=>(Y instanceof Gn&&Y.value()>0&&(h+=Y.value()),Y instanceof Gn&&Y.value()<0&&(G+=Math.abs(Y.value())),Y instanceof la&&Y.value()>0&&(D+=Y.value()),Y instanceof la&&Y.value()<0&&(B+=Math.abs(Y.value())),Y instanceof dl&&(E+=Y.value()),[h,G,D,B,E]),[0,0,0,0,0]),[l,u]=i.activeParts().reduce(([h,G],D)=>(D instanceof Nt&&h++,D instanceof Mt&&G++,[h,G]),[0,0]);if([e,o,a,l,u].some(h=>h===0))return 0;let c=Math.min(l/u,1),f=Math.min(s/o,1),y=Math.min(r/e,1);return c*f*y}))],"getRules"),F0=Bj});var Gj,Y0,z0=n(()=>{eh();I();v();us();Gj=t(()=>[new Xl(new m(i=>i instanceof vt),new m((i,e)=>e.slots().filter(r=>r.accepts(i)&&r.empty()).length>0),new p((i,e)=>{let r=e.slots().filter(s=>s.accepts(i)&&s.empty()),[o]=r.sort((s,a)=>e.getAdjacent(a).filter(l=>l.part()instanceof vt).length-e.getAdjacent(s).filter(l=>l.part()instanceof vt).length||e.getAdjacent(a).filter(l=>!l.empty()).length-e.getAdjacent(s).filter(l=>!l.empty()).length||Math.abs(s.x()-8)-Math.abs(a.x()-8)||Math.abs(s.y()-6)-Math.abs(a.y()-6));return o})),new Xl(new m(i=>!(i instanceof vt)),new m((i,e)=>e.slots().filter(r=>r.accepts(i)&&r.empty()).length>0),new p((i,e)=>{let r=e.slots().filter(s=>s.accepts(i)&&s.empty()),[o]=r.sort((s,a)=>e.getAdjacent(a).filter(l=>!l.empty()).length-e.getAdjacent(s).filter(l=>!l.empty()).length||Math.abs(s.x()-8)-Math.abs(a.x()-8)||Math.abs(s.y()-6)-Math.abs(a.y()-6));return o}))],"getRules"),Y0=Gj});var Uj,L0,N0=n(()=>{Ft();vR();xv();v();qh();us();so();Uj=t((i=Fm,e=te)=>[new Sh(new p(r=>{let o=Le(r.yields(),Vi),s=r.activeParts().reduce((f,y)=>f+(y instanceof Mt?1:0),0),a=Math.trunc(o/20/(1+s*10)*10)/10,l=i.value(),u=l+a,c=e.value();for(;i.value(c)<u;)c++;return c}))],"getRules"),L0=Uj});var Mj,j0,W0=n(()=>{q();v();vv();Mj=t((i=b)=>[new kh(new p(e=>{i.emit("player:spaceship:landed",e.player())}))],"getRules"),j0=Mj});var Dj,H0,_0=n(()=>{q();sh();w();im();Ft();v();bv();Nh();Dj=t((i=jo,e=Ip,r=d,o=te,s=b,a=()=>Math.random())=>[new Vu(new p(l=>{s.emit("player:spaceship:lost",l.player())})),new Vu(new p(l=>{let[u]=e.entries(),c=new u(r);i.register(new Mp(l.player(),c,r,o,a))}))],"getRules"),H0=Dj});var Ej,K0,q0=n(()=>{qh();us();I();v();ev();Ej=t(()=>[...[[Nt,Vi,400],[jt,Gn,-50],[jt,la,-100],[jt,Vi,1600],[jt,dl,1e4],[rr,Gn,-50],[rr,la,100],[rr,Vi,1600],[Rr,Gn,100],[Rr,Vi,400],[Mt,Vi,400],[vt,Vi,100]].map(([i,e,r])=>new Zg(new m(o=>o instanceof i),new p(o=>new e(r,o.id()))))],"getRules"),K0=Ej});var Vh,Jh,Tv=n(()=>{A();Vh=class extends g{};t(Vh,"Start");Jh=Vh});var Sj,V0,J0=n(()=>{im();v();Tv();Sj=t((i=jo)=>[new Jh(new p(()=>{i.entries().forEach(e=>e.check())}))],"getRules"),V0=Sj});var Fj={};var $0=n(()=>{R0();v0();C0();T0();w();I0();B0();U0();k0();z0();N0();W0();_0();q0();J0();d.register(...O0(),...x0(),...b0(),...P0(),...w0(),...A0(),...G0(),...F0(),...Y0(),...L0(),...j0(),...H0(),...K0(),...V0())});var Q0=P(Z0=>{"use strict";Object.defineProperty(Z0,"__esModule",{value:!0});d0();$0()});var $h,gl,Ju=n(()=>{De();$h=class extends z{};t($h,"TradeRate");gl=$h});var cs,X0=n(()=>{mu();Ju();cs=class extends gl{};t(cs,"Luxuries"),cs.tradeYield=Yb});var fs,eS=n(()=>{dy();Ju();fs=class extends gl{};t(fs,"Research"),fs.tradeYield=qt});var ys,tS=n(()=>{Ts();Ju();ys=class extends gl{};t(ys,"Tax"),ys.tradeYield=ro});var wv=n(()=>{X0();eS();tS()});var Zh,hl,$u=n(()=>{Qi();Ju();Zh=class extends He{constructor(){super(gl)}};t(Zh,"AvailableTradeRateRegistry");hl=new Zh});var kj={};var rS=n(()=>{wv();$u();hl.register(cs,fs,ys)});var iS=n(()=>{fy();Ra()});var Qh,Xh,Iv=n(()=>{Z();Qh=class extends Ie{#e=100;#t;#r=[];constructor(e,...r){super(),this.#t=e,this.#r=r,this.addKey("all")}all(){return[...this.#r]}balance(e){if(this.total()===1)return;let r=1-e.value(),o=this.#r.filter(a=>a!==e),s=o.reduce((a,l)=>a+l.value(),0);o.forEach(a=>a.set(a.value()/s*r)),this.total()<1&&o[Math.floor(o.length*Math.random())].add(1-this.total()),this.total()>1&&o[Math.floor(o.length*Math.random())].subtract(1-this.total())}get(e){let[r]=this.#r.filter(o=>o instanceof e);return r}player(){return this.#t}set(e,r){let o=this.get(e);o.set(r),this.balance(o)}setAll(e){if(e.reduce((r,[,o])=>r+o,0)!==1)throw new TypeError("Invalid rates provided, must sum to 1.");e.forEach(([r,o])=>this.get(r).set(o))}total(){return Math.round(this.#r.reduce((e,r)=>e+r.value(),0)*this.#e)/this.#e}};t(Qh,"PlayerTradeRates");Xh=Qh});var eO,Ol,Zu=n(()=>{ge();Iv();eO=class extends F{constructor(){super(Xh)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of PlayerTradeRates for player");return r[0]}};t(eO,"PlayerTradeRatesRegistry");Ol=new eO});var Yj,oS,nS=n(()=>{$u();iS();Zu();v();Rm();so();Yj=t((i=hl,e=Ol)=>[new Om(new p((r,o)=>{let s=e.getByPlayer(r.player()),a=Math.max(0,Le(o,le)),l=a;return i.entries().map(u=>{let c=u.tradeYield,f=Math.min(Math.ceil(a*s.get(u).value()),l);return l-=f,new c(f,u.name)})}))],"getRules"),oS=Yj});var zj,aS,sS=n(()=>{Zu();Nn();QO();v();zj=t((i=Ol)=>[new lt(new p(e=>[new Us(e,i.getByPlayer(e))]))],"getRules"),aS=zj});var Lj,lS,mS=n(()=>{$u();Zu();wv();Dl();v();Iv();Lj=t((i=hl,e=Ol)=>[new yi(new p(r=>{let o=[new ys(.5),new fs(.5),new cs(0)],s=i.entries(),a=new Xh(r,...s.map(l=>{let[u]=o.filter(c=>c instanceof l);return new l(u||0)}));e.register(a)}))],"getRules"),lS=Lj});var tO,Nj,pS,uS=n(()=>{$u();Xe();w();v();xl();hp();Lu();so();tO=[],Nj=t((i=d,e=H,r=hl)=>[new na(new Dn,new p(o=>{tO.length===0&&r.entries().forEach(s=>tO.push(s.tradeYield)),e.getByPlayer(o).forEach(s=>{let a=s.yields();Fl(a,...tO).reduce((l,u,c)=>(l[c].set(u,"Consolidated"),l),tO.map(l=>new l)).forEach(l=>i.process(No,l,s,a))})}))],"getRules"),pS=Nj});var jj={};var cS=n(()=>{w();nS();sS();mS();uS();d.register(...oS(),...aS(),...lS(),...pS())});var yS=P(fS=>{"use strict";Object.defineProperty(fS,"__esModule",{value:!0});rS();cS()});var rO=n(()=>{$x();Ts()});var Wj,dS,gS=n(()=>{Se();I();v();rO();jp();Cv();ga();Wj=t(()=>[new to(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Ge,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>{let e=i.remaining()/10;return new yl(Ee,Math.floor((e+4)*10*e))})),new to(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Ge,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>{let e=i.remaining()/10;return new yl(Ee,Math.floor(5*e**2+20*e))})),new to(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(L,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>new yl(Ee,i.remaining()*4))),new to(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(L,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>new yl(Ee,i.remaining()*2)))],"getRules"),dS=Wj});var Hj,hS,OS=n(()=>{Fn();Xe();Nn();nR();v();Hj=t((i=H,e=Et)=>[new lt(new p(r=>i.getByPlayer(r).map(o=>new Ds(r,e.getByCity(o)))))],"getRules"),hS=Hj});var _j,RS,xS=n(()=>{Il();Dl();v();rO();qO();_j=t((i=fi)=>[new yi(new p(e=>i.register(new ef(e,Ee))))],"getRules"),RS=_j});var iO,oO,Av=n(()=>{A();iO=class extends g{};t(iO,"Updated");oO=iO});var Kj,vS,bS=n(()=>{rO();Or();q();Il();w();KO();Vl();I();v();hp();Av();Kj=t((i=fi,e=d,r=Pe,o=b)=>[new No(new m(s=>s instanceof Ee),new p((s,a,l)=>{let u=i.getByPlayerAndType(a.player(),Ee);l.forEach(c=>{if(c instanceof de){if(u.value()<c.value()){let f=c.cityImprovement(),y=new Kc(f.constructor,a,e);r.unregister(f),u.add(y.cost().value()),o.emit("city:unsupported-improvement",a,f);return}u.subtract(c.value())}})})),new No(new m(s=>s instanceof Ee),new m((s,a,l)=>!e.process(Lo,a,l).some(u=>u)),new p((s,a)=>{let l=i.getByPlayerAndType(a.player(),Ee);l.add(s),e.process(oO,l,a)}))],"getRules"),vS=Kj});var qj,CS,PS=n(()=>{q();I();v();Av();qj=t((i=b)=>[new oO(new m(e=>e.value()<0),new p((e,r)=>{i.emit("player:treasury-exhausted",e.player(),e,r)}))],"getRules"),CS=qj});var Vj={};var TS=n(()=>{w();gS();OS();xS();bS();PS();d.register(...dS(),...hS(),...RS(),...vS(),...CS())});var IS=P(wS=>{"use strict";Object.defineProperty(wS,"__esModule",{value:!0});TS()});var Jj={};var AS=n(()=>{Yo();Tl();eo.register(Io,Ao,oi,Yi,Bo,Go,zi,Li,Uo,Mo,gr,Ni,Dr,ji,Wi,Do,Hi,hr,Eo,_i,Ve,Ki,ni,Er,So,Fo,Sr,ko)});var nO,Dp,Bv=n(()=>{A();nO=class extends g{};t(nO,"Available");Dp=nO});var aO,BS,sO,$j,GS,US=n(()=>{yR();Jn();$m();Pt();Xe();uo();$n();nr();w();nn();_r();Qm();Ft();$e();Ca();kO();Bv();I();v();Jx();Yo();aO=new m((i,e,r=i.tile())=>i instanceof nt),BS=new m((i,e,r=i.tile())=>i instanceof qe),sO=t((i,e)=>e.getByTile(i)!==null,"tileHasCity"),$j=t((i=ee,e=H,r=d,o=Fe,s=mr,a=W,l=yt,u=qn,c=te)=>[new Tt(Um,gi,new qi(new hs(aO,new m((f,y,h=f.tile())=>h.isLand()),new m((f,y)=>y.isLand()),new m((f,y)=>a.getByTile(y).every(h=>h.player()===f.player()))),new hs(BS,new qi(new m((f,y,h=f.tile())=>h.isWater()),new m((f,y,h=f.tile())=>e.getByTile(h)?.player()===f.player())),new qi(new m((f,y)=>y.isWater()),new m((f,y)=>e.getByTile(y)?.player()===f.player()))),new m(f=>f instanceof zt)),new qi(new m((f,y)=>!(f instanceof nt)),new m((f,y,h=f.tile())=>!(h.getNeighbours().some(G=>a.getByTile(G).some(D=>D instanceof nt&&D.tile().terrain()instanceof _&&D.player()!==f.player()))&&y.getNeighbours().some(G=>a.getByTile(G).some(D=>D instanceof nt&&D.tile().terrain()instanceof _&&D.player()!==f.player())))),new m((f,y)=>a.getByTile(y).filter(h=>h.player()===f.player()).length>0),new m((f,y)=>{let h=e.getByTile(y);return h===null?!1:h.player()===f.player()})),new m((f,y)=>{let h=e.getByTile(y);return h===null?!0:h.player()===f.player()}),new m((f,y)=>!a.getByTile(y).some(h=>h.player()!==f.player())),new p((f,y,h=f.tile())=>new Vt(h,y,f,r))),new Tt(Um,gi,new m((f,y)=>a.getByTile(y).some(h=>h.player()!==f.player())),new qi(new hs(new m(f=>f instanceof zt),new qi(new m((f,y)=>!a.getByTile(y).every(h=>h instanceof zt)),new m((f,y)=>f instanceof gr))),new hs(aO,new qi(new m((f,y)=>sO(y,e)),new m((f,y)=>a.getByTile(y).some(h=>h instanceof nt)))),new hs(BS,new qi(new m((f,y)=>!(f instanceof ni)),new m((f,y)=>y.isWater())))),new p((f,y,h=f.tile())=>new Js(h,y,f,r,a))),new Tt(Um,gi,aO,new m((f,y)=>sO(y,e)),new m((f,y)=>a.getByTile(y).length===0),new m((f,y)=>e.getByTile(y).player()!==f.player()),new p((f,y,h=f.tile())=>{let G=e.getByTile(y);return new Nm(h,y,f,G,r)})),new Tt(gi,jn,new m(f=>f instanceof j),new m((f,y)=>o.getByTile(y).filter(h=>[Ue,rt,lr,je].some(G=>h instanceof G)).length>0),new p((f,y,h=f.tile())=>new sl(h,y,f,r,o,c))),new Tt(gi,jn,new m(f=>f instanceof j),new m((f,y,h=f.tile())=>h.isLand()),new p((f,y,h=f.tile())=>new al(h,y,f,r,c,s))),new Tt(gi,jn,new p((f,y,h=f.tile())=>new Pa(h,y,f,r,c))),new Tt(gi,jn,new p((f,y,h=f.tile())=>new _m(h,y,f,r))),new Tt(jn,new p((f,y,h=f.tile())=>new mo(h,y,f,r))),new Tt(gi,jn,new m(f=>f instanceof Ve),new m((f,y,h=f.tile())=>h.isLand()),new m((f,y,h=f.tile())=>!sO(h,e)),new p((f,y,h=f.tile())=>new Vm(h,y,f,i,r))),...[[Ue,$s,new qi(new m((f,y,h=f.tile())=>h.terrain()instanceof ne),new m((f,y,h=f.tile())=>h.getAdjacent().some(G=>G.terrain()instanceof ne||G.terrain()instanceof or||o.getByTile(G).some(D=>D instanceof Ue)&&!sO(G,e))))],[rt,Zs],[je,Qs],[lr,Xs,new m((f,y)=>o.getByTile(y).some(h=>h instanceof je))]].map(([f,y,...h])=>new Tt(new m(G=>G instanceof br),gi,new m((G,D,B=G.tile())=>r.get(Dp).some(E=>E.validate(B,f,G.player()))),jn,...h,new p((G,D,B=G.tile())=>new y(B,D,G,r,c)))),...[[it,il],[Ze,el],[me,ll],[ot,ol]].map(([f,y])=>new Tt(gi,jn,new m(h=>h instanceof br),new m((h,G,D=h.tile())=>D.terrain()instanceof f),new p((h,G,D=h.tile())=>new y(D,G,h,r,l,c)))),new Tt(Um,gi,aO,new m((f,y)=>y.terrain()instanceof or),new m((f,y)=>a.getByTile(y).every(h=>h.player()===f.player())),new m((f,y)=>a.getByTile(y).filter(h=>h instanceof $t).some(h=>h.hasCapacity()&&h.canStow(f))),new p((f,y,h=f.tile())=>{let[G]=a.getByTile(y).filter(D=>D instanceof $t).filter(D=>D.hasCapacity()&&D.canStow(f));return new Km(h,y,f,G,r)})),new Tt(Um,new m(f=>{try{return u.getByUnit(f),!0}catch{return!1}}),new qi(new m((f,y)=>!(f instanceof nt)),new m((f,y)=>y.isLand())),new m((f,y,h=f.tile())=>u.getByUnit(f).transport().tile()===h),new p((f,y,h=f.tile())=>{let G=u.getByUnit(f).transport();return new nl(h,y,f,G,r)})),new Tt(gi,jn,new m(f=>f instanceof $t),new m(f=>f.hasCargo()),new m((f,y)=>y.getNeighbours().some(h=>h.isLand())),new p((f,y,h=f.tile())=>new Jm(h,y,f,r)))],"getRules"),GS=$j});var Zj,MS,DS=n(()=>{Ca();dR();I();v();Ru();Zj=t((i=mr)=>[new Mm(new m(e=>e.moves().value()>0),new p(e=>e.setActive())),new Mm(new m(e=>e.busy()!==null),new p(e=>e.setBusy())),...[vi].map(e=>new Mm(new m(r=>i.getByUnit(r).some(o=>o instanceof e)),new p(r=>i.unregister(...i.getByUnit(r).filter(o=>o instanceof e)))))],"getRules"),MS=Zj});var Qj,ES,SS=n(()=>{xm();Yo();ze();bd();Cd();Td();wd();Id();Ad();I();v();Gd();Ud();Dd();Ed();Fd();Yd();zd();Nd();Wd();_d();Kd();Jn();qd();Bu();$d();eg();rg();og();ag();lg();Qj=t((i=N)=>[new st(new m((e,r)=>Object.prototype.isPrototypeOf.call(qe,r)),new p(e=>new m(()=>e.tile().isCoast()))),...[[Io,Ua],[Ao,tg],[oi,xu],[Yi,wu],[Go,xu],[Bo,ng],[zi,Hd],[Li,ig],[Uo,Cu],[Mo,sg],[gr,Bd],[Ni,Tu],[Dr,Md],[ji,Xd],[Wi,bu],[Do,kd],[Hi,tp],[hr,Jd],[Eo,jl],[_i,Iu],[Ki,Pd],[ni,jd],[Er,Sd],[So,vu],[Fo,Pu],[Sr,Ld]].map(([e,r])=>new st(new m((o,s)=>s===e),new p(o=>new m(()=>i.getByPlayer(o.player()).completed(r))))),...[[Yi,Ua],[zi,wu],[Li,bu],[Ni,Pu],[Dr,jl],[ji,Cu],[Wi,vu],[Hi,jl],[_i,Tu],[Ki,tp],[Er,jl],[Sr,Iu],[ko,tp]].map(([e,r])=>new st(new m((o,s)=>s===e),new p(o=>new m(()=>!i.getByPlayer(o.player()).completed(r)))))],"getRules"),ES=Qj});var Xj,FS,kS=n(()=>{vm();Yo();Xj=t(()=>[...[[Io,80],[Ao,160],[oi,120],[Yi,40],[Bo,50],[Go,160],[zi,40],[Li,40],[Uo,80],[Mo,30],[gr,60],[Ni,40],[Dr,20],[ji,50],[Wi,40],[Do,50],[Hi,30],[hr,160],[Eo,30],[_i,40],[Ve,40],[Ki,20],[ni,50],[Er,20],[So,80],[Fo,50],[Sr,40],[ko,10]].flatMap(([i,e])=>Cs(i,e))],"getRules"),FS=Xj});var eW,YS,zS=n(()=>{St();bm();I();v();Yo();eW=t((i=ie)=>[new ci(new m((e,r)=>r instanceof Ve),new p(e=>i.getByCity(e.city()).shrink()))],"getRules"),YS=eW});var tW,LS,NS=n(()=>{q();$e();$f();v();tW=t((i=W,e=b)=>[new da(new p(r=>i.register(r))),new da(new p(r=>r.applyVisibility())),new da(new p(r=>r.moves().set(r.movement()))),new da(new p(r=>{e.emit("unit:created",r)}))],"getRules"),LS=tW});var rW,jS,WS=n(()=>{Xe();q();w();_r();$e();I();uu();Qp();v();rW=t((i=H,e=d,r=Fe,o=W,s=b)=>[new rn(new p((a,l)=>{s.emit("unit:defeated",a,l),e.process(Qo,a,l.player())})),new rn(new m(a=>i.getByTile(a.tile())===null),new m(a=>o.getByTile(a.tile()).filter(l=>l!==a&&l.player()===a.player()).length>0),new p((a,l)=>o.getByTile(a.tile()).forEach(u=>{u!==a&&u.player()===a.player()&&e.process(Qo,a,l.player())})))],"getRules"),jS=rW});var iW,HS,_S=n(()=>{q();Ca();$e();Qp();v();iW=t((i=W,e=mr,r=b)=>[new Qo(new p((o,s)=>{r.emit("unit:destroyed",o,s)})),new Qo(new p(o=>{o.setActive(!1),o.setDestroyed()})),new Qo(new p(o=>e.getByUnit(o).forEach(s=>e.unregister(s))))],"getRules"),HS=iW});var lO,Ep,Gv=n(()=>{A();lO=class extends g{};t(lO,"LostAtSea");Ep=lO});var oW,KS,qS=n(()=>{q();v();Gv();oW=t((i=b)=>[new Ep(new p(e=>{i.emit("unit:lost-at-sea",e)})),new Ep(new p(e=>e.destroy(null)))],"getRules"),KS=oW});var mO,nW,VS,JS=n(()=>{$m();q();w();Qm();Ft();I();v();xl();Gv();kt();Jn();Yo();Xe();mO=new Map,nW=t((i=qn,e=d,r=()=>Math.random(),o=b,s=H,a=te)=>[new J(new p((l,u)=>{o.emit("unit:moved",l,u)})),new J(new p(l=>l.applyVisibility())),new J(new m(l=>l.moves().value()<=.1),new p(l=>l.moves().set(0))),new J(new m(l=>l.moves().value()<.1),new p(l=>l.setActive(!1))),new J(new m(l=>l instanceof $t),new m((l,u)=>u instanceof Vt),new m(l=>l.hasCargo()),new p((l,u)=>l.cargo().forEach(c=>c.action(u.forUnit(c))))),new J(new m((l,u)=>u instanceof nl),new p(l=>{let u=i.getByUnit(l);u.transport().unload(l),i.unregister(u)})),new J(new m(l=>l instanceof Sr),new m(l=>l.moves().value()===0),new m(l=>!l.tile().isCoast()),new m(()=>r()<=.5),new p(l=>{e.process(Ep,l)})),...[[oi,1],[gr,0],[hr,0]].flatMap(([l,u])=>[new J(new Dn,new m(c=>c instanceof l),new m(c=>c.moves().value()===0),new m(c=>!mO.has(c)),new p(c=>{mO.set(c,a.value())})),new J(new m(c=>c instanceof l),new m(c=>c.moves().value()===0),new m(c=>s.getByTile(c.tile())!==null),new p(c=>{mO.delete(c)})),new J(new m(c=>c instanceof l),new m(c=>c.moves().value()===0),new m(c=>s.getByTile(c.tile())===null),new m(c=>(mO.get(c)??a.value())+u<=a.value()),new p(c=>{e.process(Ep,c)}))])],"getRules"),VS=nW});var $S,aW,ZS,QS=n(()=>{uo();Jn();$m();$n();_r();Qm();I();v();Ri();$S=[[Yt,2],[we,1],[Ze,2],[Re,1],[Me,2],[it,2],[We,3],[mt,1],[me,1],[ne,1],[ot,2],[dt,1]],aW=t((i=Fe,e=qn)=>[...$S.map(([r,o])=>new Te(new m((s,a)=>a instanceof Vt),new m(s=>s instanceof nt),new m((s,a)=>a.to().terrain()instanceof r),new p(()=>o))),new Te(new m((r,o)=>o instanceof Vt),new m(r=>r instanceof zt||r instanceof qe),new p(()=>1)),new Te(new m((r,o)=>o instanceof Vt),new m(r=>r instanceof nt),new m((r,o)=>i.getByTile(o.from()).some(s=>s instanceof je)),new m((r,o)=>i.getByTile(o.to()).some(s=>s instanceof je)),new p(()=>1/3)),new Te(new m((r,o)=>o instanceof Vt),new m(r=>r instanceof nt),new m((r,o)=>i.getByTile(o.from()).some(s=>s instanceof lr)),new m((r,o)=>i.getByTile(o.to()).some(s=>s instanceof lr)),new p(()=>0)),new Te(new m((r,o)=>o instanceof Vt),new m(r=>r instanceof nt),new m(r=>{try{return e.getByUnit(r),!0}catch{return!1}}),new m(r=>e.getByUnit(r).transport()instanceof $t),new p(()=>0)),...[[$s,2],[Zs,3],[Qs,1],[Xs,2],[el,2],[il,3],[ol,3],[al,1],[sl,1],[ll,3],[Pa,0]].flatMap(([r,o])=>$S.map(([s,a])=>new Te(new m((l,u)=>u instanceof r),new m(l=>l.tile().terrain()instanceof s),new p(()=>o*a))))],"getRules"),ZS=aW});var sW,XS,eF=n(()=>{SO();$e();Nn();I();v();sW=t((i=W)=>[new lt(new m(e=>i.getByPlayer(e).some(r=>r.active()&&r.moves().value())),new p(e=>i.getByPlayer(e).filter(r=>r.active()&&r.moves().value()>0).sort((r,o)=>(r.waiting()?1:0)-(o.waiting()?1:0)).map(r=>new ds(e,r)))),new lt(new m(e=>i.getByPlayer(e).some(r=>!r.active()||!r.moves().value())),new p(e=>i.getByPlayer(e).filter(r=>!r.active()||r.moves().value()===0).sort((r,o)=>(r.waiting()?1:0)-(o.waiting()?1:0)).map(r=>new gs(e,r))))],"getRules"),XS=sW});var lW,tF,rF=n(()=>{v();YR();VR();lW=t(()=>[new ed(new p(i=>i.action(new FC(i.tile(),i.tile(),i))))],"getRules"),tF=lW});var mW,iF,oF=n(()=>{Gm();Yo();Ru();w();Ca();Dm();Dm();I();v();mW=t((i=mr,e=d)=>[...[[Io,12,2,2],[Ao,18,12,4,2],[oi,12,1,8,2],[Yi,8],[Bo,0],[Go,1,12,5,2],[zi,6],[Li,4,1,2],[Uo,6,6,6,2],[Mo,0,0,2],[gr,4,2,10,2],[Ni,2,2,3],[Dr,2,1,2],[ji,4,4,4],[Wi,4,2,2],[Do,6,6,3],[Hi,3,2],[hr,99,0,16],[Eo,3,5],[_i,1,1,3],[Ve,0],[Ki,1,2],[ni,8,2,3,2],[Er,3],[So,10,5,3],[Fo,0,3,4],[Sr,1,0,3],[ko]].flatMap(([r,o=1,s=1,a=1,l=1])=>Mb(r,o,s,a,l)),...[[vi,1,di],[Ta,.5,oo,di]].flatMap(([r,o,...s])=>s.map(a=>new El(new m((l,u)=>u instanceof a),new m(l=>i.getByUnit(l).some(u=>u instanceof r)),new p((l,u)=>{let c=new a;e.process(ks,l.constructor,c),u.add(c.value()*o,r.name)}))))],"getRules"),iF=mW});var pW,nF,aF=n(()=>{q();v();Og();pW=t((i=b)=>[new Jl(new p((e,r)=>{i.emit("unit:unsupported",e,r)}))],"getRules"),nF=pW});var uW,sF,lF=n(()=>{I();v();ER();uW=t((i=()=>Math.random())=>[new cu(new m((e,r)=>e.moves().value()>=r),new p((e,r)=>(e.moves().subtract(r),!0))),new cu(new m((e,r)=>e.moves().value()<r),new p((e,r)=>{let o=e.moves().value();return e.moves().set(0),o>=r*.5*i()}))],"getRules"),sF=uW});var cW={};var mF=n(()=>{US();DS();SS();kS();zS();NS();WS();_S();w();qS();JS();QS();eF();rF();oF();aF();lF();d.register(...GS(),...MS(),...ES(),...FS(),...YS(),...LS(),...jS(),...HS(),...KS(),...VS(),...ZS(),...XS(),...tF(),...iF(),...nF(),...sF())});var uF=P(pF=>{"use strict";Object.defineProperty(pF,"__esModule",{value:!0});AS();mF()});var Fr,cF=n(()=>{Be();Fr=class extends Oe{};t(Fr,"Colossus")});var ai,fF=n(()=>{Be();ai=class extends Oe{};t(ai,"CopernicusObservatory")});var Wo,yF=n(()=>{Be();Wo=class extends Ce{};t(Wo,"CureForCancer")});var Ho,dF=n(()=>{Be();Ho=class extends Ce{};t(Ho,"DarwinsVoyage")});var kr,gF=n(()=>{Be();kr=class extends Oe{};t(kr,"GreatLibrary")});var _o,hF=n(()=>{Be();_o=class extends Oe{};t(_o,"GreatWall")});var si,OF=n(()=>{Be();si=class extends Oe{};t(si,"HangingGardens")});var ma,RF=n(()=>{Be();ma=class extends Ce{};t(ma,"HooverDam")});var Ko,xF=n(()=>{Be();Ko=class extends Ce{};t(Ko,"IsaacNewtonsCollege")});var Ji,vF=n(()=>{Be();Ji=class extends Ce{};t(Ji,"JsBachsCathedral")});var li,bF=n(()=>{Be();li=class extends Ce{};t(li,"Lighthouse")});var qo,CF=n(()=>{Be();qo=class extends Oe{};t(qo,"MagellansExpedition")});var Un,PF=n(()=>{Be();Un=class extends Ce{};t(Un,"ManhattanProject")});var Yr,TF=n(()=>{Be();Yr=class extends Ce{};t(Yr,"MichelangelosChapel")});var ir,wF=n(()=>{Be();ir=class extends Oe{};t(ir,"Oracle")});var Vo,IF=n(()=>{Be();Vo=class extends Oe{};t(Vo,"Pyramids")});var Jo,AF=n(()=>{Be();Jo=class extends Ce{};t(Jo,"SetiProgram")});var zr,BF=n(()=>{Be();zr=class extends Ce{};t(zr,"ShakespearesTheatre")});var pa,GF=n(()=>{Be();pa=class extends Ce{};t(pa,"UnitedNations")});var $i,UF=n(()=>{Be();$i=class extends Ce{};t($i,"WomensSuffrage")});var ua=n(()=>{_h();cF();fF();yF();dF();gF();hF();OF();RF();xF();vF();bF();CF();PF();TF();wF();IF();AF();BF();GF();UF()});var fW={};var MF=n(()=>{ua();Tl();eo.register(Bn,Fr,ai,Wo,Ho,kr,_o,si,ma,Ko,Ji,li,qo,Un,Yr,ir,Vo,Jo,zr,pa,$i)});var yW,DF,EF=n(()=>{ua();Ar();xm();ze();An();I();v();Be();Yo();yW=t((i=N,e=ct)=>[new st(new m((r,o)=>Object.isPrototypeOf.call(Oe,o)),new p((r,o)=>new m(()=>e.filter(s=>s instanceof o).length===0))),...[[Fr,yo],[ai,Pi],[kr,wr],[_o,Qt],[si,bn],[li,Oo],[qo,Ui],[ir,wi],[Vo,Qt],[Bn,xo],[Wo,On],[Ho,Xr],[ma,ht],[Ko,bo],[Ji,It],[Un,Zr],[Yr,It],[Jo,Ii],[zr,Gi],[pa,wt],[$i,ur]].map(([r,o])=>new st(new m((s,a)=>a===r),new p(s=>new m(()=>i.getByPlayer(s.player()).completed(o))))),...[[hr,Un]].map(([r,o])=>new st(new m((s,a)=>a===r),new p(()=>new m(()=>e.some(s=>s instanceof o)))))],"getRules"),DF=yW});var dW,SF,FF=n(()=>{ua();vm();dW=t(()=>[...[[Bn,600],[Fr,200],[ai,300],[Wo,600],[Ho,300],[kr,300],[_o,300],[si,300],[ma,600],[Ko,400],[Ji,400],[li,200],[qo,400],[Un,600],[Yr,300],[ir,300],[Vo,300],[Jo,600],[zr,400],[pa,600],[$i,600]].flatMap(([i,e])=>Cs(i,e))],"getRules"),SF=dW});var gW,kF,YF=n(()=>{Fn();q();ze();w();An();bm();I();ua();v();vc();Be();gW=t((i=Et,e=N,r=d,o=ct,s=b)=>[new ci(new m((a,l)=>l instanceof Oe),new p((a,l)=>{let u=l.constructor;o.register(l),i.filter(c=>c.building()?.item()===u).forEach(c=>c.revalidate())})),new ci(new m((a,l)=>l instanceof Oe),new p((a,l)=>{s.emit("wonder:built",l,a.city())})),new ci(new m((a,l)=>l instanceof Ho),new p(a=>{let l=e.getByPlayer(a.city().player()),u=t(f=>{let y=new pm(new m(h=>h===l),new p(()=>{r.unregister(y),f()}));r.register(y)},"createOnStarted"),c=t(()=>{l.add(l.cost()),u(()=>l.add(l.cost()))},"completeResearch");if(l.researching()===null){u(()=>c());return}c()}))],"getRules"),kF=gW});var Sp,Zi,Qu=n(()=>{An();I();Sp=t((i,e=ct)=>new m(r=>e.getByCity(r).some(o=>o instanceof i)),"cityHasWonder"),Zi=t((i,e=ct)=>new m(r=>e.getByPlayer(r.player()).some(o=>o instanceof i)),"playerHasWonder")});var zF,Mn,pO,Xu=n(()=>{ze();I();zF=t((i,e=N)=>new m(r=>e.getByPlayer(r.player()).completed(i)),"discoveredByPlayer"),Mn=t((i,e=N)=>new m(()=>i===null||!e.some(r=>r.completed(i))),"notDiscoveredByAnyPlayer"),pO=t((i,e=N)=>new m(r=>i===null||!e.getByPlayer(r.player()).completed(i)),"notDiscoveredByPlayer")});var uO,LF=n(()=>{Or();I();uO=t((i,e=Pe)=>new m(r=>e.getByCity(r).some(o=>o instanceof i)),"hasCityImprovement")});var hW,NF,jF=n(()=>{ki();Or();Ar();ua();fn();ze();$e();An();Qu();Xu();ym();I();v();ya();Tg();Os();va();LF();so();hW=t((i=Pe,e=gt,r=N,o=W,s=ct)=>[new at(new Qe,Zi(ir,s),uO(Lt,i),pO(Xt,r),Mn(It,r),new p((a,l)=>new et(-Math.min(1,Le(l,et)),ir.name))),new at(new Qe,Zi(ir,s),uO(Lt,i),zF(Xt,r),Mn(It,r),new p((a,l)=>new et(-Math.min(2,Le(l,et)),ir.name))),new at(new jr(4e3),Sp(zr,s),Mn(ht,r),new p((a,l)=>new et(-Le(l,et),zr.name))),new at(new Qe,Zi(Ji,s),new p((a,l)=>new et(-Math.min(2,Le(l,et)),Ji.name))),new at(new Qe,Zi(Yr,s),uO(yr,i),Mn(wt,r),new p((a,l)=>new et(-Math.min(4,Le(l,et)),Yr.name))),new at(new Qe,Zi($i,s),new m((a,l)=>l.some(u=>u instanceof qa)),new p((a,l)=>l.flatMap(u=>u instanceof qa?new et(-1,$i.name):[])))],"getRules"),NF=hW});var OW,WF,HF=n(()=>{An();Cl();I();v();OW=t((i=ct)=>[new Wr(new m(e=>i.getByCity(e).length>0),new p(e=>i.getByCity(e).forEach(r=>i.unregister(r))))],"getRules"),WF=OW});var RW,_F,KF=n(()=>{ua();Ar();va();ze();An();Qu();Rm();v();Os();Xu();RW=t((i=N,e=ct)=>[new Zo(new jr(500),Sp(Fr,e),Mn(Pr,i),new p(r=>new le(r.tilesWorked().filter(o=>o.yields().some(s=>s instanceof le)).length,Fr.name))),...[[si,1,Tr],[Wo,1,null]].map(([r,o,s])=>new Zo(Zi(r,e),Mn(s,i),new p(()=>new js(o,r.name))))],"getRules"),_F=RW});var xW,qF,VF=n(()=>{ua();ze();An();Qu();Ar();v();ya();va();zc();Xu();so();xW=t((i=N,e=ct)=>[...[[ai,qt,1,Zt]].map(([r,o,s,a])=>new Pl(new Qe,Sp(r,e),Mn(a,i),new p((l,u)=>new o(Le(u,o)*s,r.name)))),...[[Jo,qt,.5,null]].map(([r,o,s,a])=>new Pl(new Qe,Zi(r,e),Mn(a,i),new p((l,u)=>new o(Le(u,o)*s,r.name))))],"getRules"),qF=xW});var cO,fO,Uv=n(()=>{A();cO=class extends g{};t(cO,"Obsolete");fO=cO});var vW,JF,$F=n(()=>{Ar();ua();ze();w();An();dc();I();v();Uv();vW=t((i=N,e=d,r=ct)=>[new Rs(new m(()=>r.some(o=>o instanceof kr)),new m((o,s)=>{let[a]=r.filter(u=>u instanceof kr).map(u=>u.city().player());return!i.getByPlayer(a).completed(s.sourceClass())}),new m((o,s)=>i.filter(a=>a.completed(s.sourceClass())).length>=3),new p((o,s)=>{let[a]=r.filter(u=>u instanceof kr).map(u=>u.city().player());return i.getByPlayer(a).addAdvance(s.sourceClass())})),...[[Fr,Pr],[ai,Zt],[kr,cr],[_o,pr],[si,Tr],[Ko,Zr],[li,Jr],[Yr,wt],[ir,It],[Vo,wt],[zr,ht]].map(([o,s])=>new Rs(new m(()=>r.entries().some(a=>a instanceof o)),new m((a,l)=>l instanceof s),new p(()=>{let[a]=r.filter(l=>l instanceof o);e.process(fO,a,a.city())})))],"getRules"),JF=vW});var bW,ZF,QF=n(()=>{ua();ze();An();I();v();ya();Ar();Gm();Jn();Dm();Xu();Qu();bW=t((i=ct,e=N)=>[new Xp(new Qe,new m((r,o)=>o instanceof no),new m(r=>r instanceof qe),Zi(li,i),pO(Jr,e),new p((r,o)=>o.add(1))),new Xp(new Qe,new m((r,o)=>o instanceof no),new m(r=>r instanceof qe),Zi(qo,i),new p((r,o)=>o.add(1)))],"getRules"),ZF=bW});var CW,XF,ek=n(()=>{q();v();Uv();CW=t((i=b)=>[new fO(new p((e,r)=>{i.emit("wonder:obsolete",e,r)}))],"getRules"),XF=CW});var PW={};var tk=n(()=>{EF();FF();YF();jF();HF();KF();VF();w();$F();QF();ek();d.register(...DF(),...SF(),...kF(),...NF(),...WF(),..._F(),...qF(),...JF(),...ZF(),...XF())});var ik=P(rk=>{"use strict";Object.defineProperty(rk,"__esModule",{value:!0});MF();tk()});var TW,ok,nk=n(()=>{uo();$n();ze();Ar();_r();Bv();I();TW=t((i=N,e=Fe)=>[...[[Ue,we,Re,Me,me,ne],[rt,we,Me,We],[je,Yt,we,Ze,Re,Me,it,We,me,ot,dt]].map(([r,...o])=>new Dp(new m((s,a)=>a===r),new m(s=>o.some(a=>s.terrain()instanceof a)),new m((s,a)=>!e.getByTile(s).some(l=>l instanceof a)))),...[[je,fo,ne]].map(([r,o,...s])=>new Dp(new m((a,l)=>l===r),new m(a=>s.some(l=>a.terrain()instanceof l)),new m((a,l)=>!e.getByTile(a).some(u=>u instanceof l)),new m((a,l,u)=>i.getByPlayer(u).completed(o)))),...[[lr,Xr,je,Yt,we,Ze,Re,Me,it,We,me,ne,ot,dt]].map(([r,o,s,...a])=>new Dp(new m((l,u)=>u===r),new m(l=>a.some(u=>l.terrain()instanceof u)),new m((l,u)=>!e.getByTile(l).some(c=>c instanceof u)),new m(l=>e.getByTile(l).some(u=>u instanceof s)),new m((l,u,c)=>i.getByPlayer(c).completed(o))))],"getRules"),ok=TW});var wW,ak,sk=n(()=>{q();$n();_r();by();I();v();wW=t((i=Fe,e=b)=>[new ba(new m((r,o)=>i.getByTile(r).every(s=>o.constructor!==s.constructor)),new p((r,o)=>i.register(o))),new ba(new p(r=>r.clearYieldCache(null))),new ba(new p((r,o)=>{e.emit("tile-improvement:built",r,o)})),...[[rt,Ue],[Ue,rt]].map(([r,o])=>new ba(new m((s,a)=>a instanceof r),new m(s=>i.getByTile(s).some(a=>a instanceof o)),new p(s=>i.unregister(...i.getByTile(s).filter(a=>a instanceof o)))))],"getRules"),ak=wW});var yO,dO,Mv=n(()=>{Qi();xi();yO=class extends He{constructor(){super(Ke)}};t(yO,"AvailableTerrainFeatureRegistry");dO=new yO});var IW,lk,mk=n(()=>{Mv();w();NO();v();Wm();IW=t((i=d,e=dO)=>[new Uc(new p(r=>{let o=i.get(tl);e.entries().forEach(s=>o.filter(a=>a.validate(s,r)).forEach(a=>a.process(s,r)))}))],"getRules"),lk=IW});var Wt,Dv=n(()=>{A();Wt=class extends g{};t(Wt,"Distribution")});var AW,pk,uk=n(()=>{uo();Dv();nr();I();v();AW=t(()=>[new Wt(new m(i=>i===Yt),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:0,to:.01,fill:!0},{from:.01,to:.02},{from:.98,to:.99},{from:.99,to:1,fill:!0}])),new Wt(new m(i=>i===we),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.4,to:.45},{from:.45,to:.55,coverage:.025,cluster:!0,clusterChance:.1},{from:.55,to:.6}])),new Wt(new m(i=>i===Ze),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.05,to:.2},{from:.2,to:.4,cluster:!0,clusterChance:.1,coverage:.1},{from:.4,to:.6},{from:.6,to:.8,cluster:!0,clusterChance:.1,coverage:.1},{from:.8,to:.95}])),new Wt(new m(i=>i===Re),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{fill:!0}])),new Wt(new m(i=>i===Me),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.1,to:.9,path:!0,pathChance:.1,coverage:.06}])),new Wt(new m(i=>i===it),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.3,to:.45,cluster:!0,clusterChance:.2,coverage:.08},{from:.55,to:.7,cluster:!0,clusterChance:.2,coverage:.08}])),new Wt(new m(i=>i===We),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.01,to:.1,coverage:.3,path:!0},{from:.1,to:.9,path:!0},{from:.9,to:.99,coverage:.3,path:!0}])),new Wt(new m(i=>i===mt),new m((i,e)=>e.some(r=>r.constructor===or)),new p(()=>[{fill:!0}])),new Wt(new m(i=>i===me),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.01,to:.2,coverage:.3},{from:.2,to:.4},{from:.1,to:.4,cluster:!0},{from:.4,to:.6},{from:.6,to:.8},{from:.6,to:.9,cluster:!0},{from:.8,to:.99,coverage:.3}])),new Wt(new m(i=>i===ne),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.1,to:.9,coverage:.1,path:!0,pathChance:.5}])),new Wt(new m(i=>i===ot),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.2,to:.4,cluster:!0},{from:.6,to:.8,cluster:!0}])),new Wt(new m(i=>i===dt),new m((i,e)=>e.some(r=>r instanceof _)),new p(()=>[{from:.01,to:.15,cluster:!0,coverage:.15},{from:.85,to:.99,cluster:!0,coverage:.15}]))],"getRules"),pk=AW});var gO,hO,Ev=n(()=>{A();gO=class extends g{};t(gO,"DistributionGroups");hO=gO});var BW,ck,fk=n(()=>{uo();v();Ev();BW=t(()=>[new hO(new p(()=>[mt,Re,ot,We,it,Me,Ze,we,me,dt,Yt,ne]))],"getRules"),ck=BW});var GW,yk,dk=n(()=>{uo();gu();nn();Wm();GW=t((i=yt)=>[...[[sn,.2,Me],[ln,.2,mt],[bi,.2,Ze,dt],[mn,.2,it],[pn,.2,We],[po,.2,me],[Ci,.2,we],[un,.2,ot],[cn,.2,Yt],[an,.5,Re,ne]].flatMap(([r,o,...s])=>s.flatMap(a=>fC(a,r,o,i)))],"getRules"),yk=GW});var OO,RO,gk=n(()=>{A();OO=class extends g{};t(OO,"Pillaged");RO=OO});var UW,hk,Ok=n(()=>{q();_r();gk();I();v();UW=t((i=Fe,e=b)=>[new RO(new m((r,o)=>i.getByTile(r).includes(o)),new p((r,o)=>i.unregister(o))),new RO(new p(r=>r.clearYieldCache(null))),new RO(new p((r,o)=>{e.emit("tile-improvement:pillaged",r,o)}))],"getRules"),hk=UW});var Sv,Fv,kv,MW,DW,EW,SW,Rk,xk=n(()=>{fv();q();xa();uo();v();hv();Sv=new Map,Fv=new Map,kv=new Map,MW=t((i,e=null)=>(Fv.has(i)||Fv.set(i,i.score(e,[[Q,8],[V,3],[le,1]])),Fv.get(i)),"tileScore"),DW=t((i,e=null)=>(kv.has(i)||kv.set(i,i.getSurroundingArea().entries().reduce((r,o)=>r+MW(o,e),0)),kv.get(i)),"areaScore"),EW=t((i,e=b)=>{if(!Sv.has(i)){e.emit("world:generate-start-tiles");let r=i.entries().filter(o=>[Re,me,ne].some(s=>o.terrain()instanceof s)).map(o=>({tile:o,score:DW(o)})).sort(({score:o},{score:s})=>s-o).map(({tile:o})=>o);Sv.set(i,r),e.emit("world:start-tiles",r)}return Sv.get(i)},"pickStartTiles"),SW=t((i=xh,e=b,r=()=>Math.random())=>[new Bh(new p((o,s,a)=>{if(e.option("earth",!1))try{return i.getStartTileByCivilizationAndWorld(s.civilization().sourceClass(),o)}catch{a.push(...i.entries().map(c=>c.startTileForMap(o)))}let l=EW(o,e);return l.forEach(u=>{a.some(c=>c.distanceFrom(u)<=4)&&l.splice(l.indexOf(u),1)}),l[Math.floor(l.length*r())]}))],"getRules"),Rk=SW});var xO,Fp,vO=n(()=>{dh();Qi();xO=class extends He{constructor(){super(yh)}};t(xO,"GeneratorRegistry");Fp=new xO});var bO,CO,Yv=n(()=>{A();bO=class extends g{};t(bO,"PickGenerator");CO=bO});var PO,TO,zv=n(()=>{A();PO=class extends g{};t(PO,"Start");TO=PO});var wO,vk,bk=n(()=>{Z();w();Ch();ge();Xi();wO=class extends k{#e;#t;#r;#i=new am(he);#o;constructor(e,r=d){super(),this.#e=e,this.#t=e.height(),this.#o=e.width(),this.#r=r,this.addKey("height","tiles","width")}build(){return new Promise(e=>{this.#e.generate().then(r=>{r.forEach((o,s)=>{let a=new he(s%this.#o,Math.floor(s/this.#o),o,this,this.#r);this.#i.register(a)}),this.#r.process(fl,this),e(this)})})}entries(){return this.#i.entries()}filter(e){return this.entries().filter(e)}forEach(e){return this.#i.forEach(e)}get(e,r){return this.entries()[this.#e.coordsToIndex(e,r)]}height(){return this.#t}includes(e){return this.#i.includes(e)}map(e){return this.#i.map(e)}register(...e){this.#i.register(...e)}tiles(){return this.entries()}width(){return this.#o}};t(wO,"World");vk=wO});var FW,Ck,Pk=n(()=>{vO();w();q();v();Yv();zv();bk();FW=t((i=d,e=Fp,r=b)=>[new TO(new p(()=>{let[o]=i.process(CO),s=new o(parseInt(r.option("height",100),10),parseInt(r.option("width",160),10),{landCoverage:parseFloat(r.option("landCoverage",.4)),landSize:parseFloat(r.option("landSize",.2)),maxIterations:parseInt(r.option("maxIterations",20),10)});new vk(s,i).build()}))],"getRules"),Ck=FW});var kW,Tk,wk=n(()=>{gu();uo();xa();$n();wn();fn();nn();_r();I();v();HO();kW=t((i=Fe,e=yt,r=gt)=>[...[[Q,Ze,1],[Q,Re,2],[Q,Me,1],[Q,it,1],[Q,mt,1],[Q,me,1],[Q,ne,2],[Q,ot,1],[Q,dt,1],[V,we,1],[V,Ze,2],[V,We,1],[V,me,1]].map(([o,s,a])=>new ui(new m(l=>l.terrain()instanceof s),new p(()=>new o(a,s.name)))),...[[V,sn,2],[Q,ln,1],[Q,bi,1],[le,mn,2],[le,pn,3],[V,po,1],[Q,Ci,2],[V,un,3],[Q,cn,2],[V,an,1]].map(([o,s,a])=>new ui(new m(l=>e.getByTerrain(l.terrain()).some(u=>u instanceof s)),new p(()=>new o(a,s.name)))),...[[V,sn,1],[Q,ln,1],[Q,bi,1],[le,mn,2],[le,pn,2],[V,po,1],[Q,Ci,1],[V,un,1],[Q,cn,1]].map(([o,s,a])=>new ui(new m((l,u)=>{if(!u)return!1;try{return r.getByPlayer(u).is(At,pt,ut,Ot)}catch{return!1}}),new m(l=>e.getByTerrain(l.terrain()).some(u=>u instanceof s)),new p(()=>new o(a,s.name)))),new ui(new m(o=>o.terrain()instanceof mt),new p(()=>new le(2,mt.name))),new ui(new m(o=>o.terrain()instanceof ne),new p(()=>new le(1))),new ui(new m((o,s)=>{if(!s)return!1;try{return r.getByPlayer(s).is(pt,Ot)}catch{return!1}}),new m(o=>o.terrain()instanceof ne||o.terrain()instanceof mt),new p(()=>new le(1,mt.name))),...[[we,Q,Ue,1],[we,V,rt,1],[Me,Q,Ue,1],[Me,V,rt,2],[We,V,rt,1],[me,Q,Ue,1]].map(([o,s,a,l])=>new ui(new m(u=>u.terrain()instanceof o),new m(u=>i.getByTile(u).some(c=>c instanceof a)),new p(()=>new s(l,a.name)))),...[[we,V,rt,1],[Re,Q,Ue,1],[Me,V,rt,1],[We,V,rt,1],[ne,Q,Ue,1]].map(([o,s,a,l])=>new ui(new m((u,c)=>{if(!c)return!1;try{return r.getByPlayer(c).is(At,pt,ut,Ot)}catch{return!1}}),new m(u=>u.terrain()instanceof o),new m(u=>i.getByTile(u).some(c=>c instanceof a)),new p(()=>new s(l,a.name)))),...[we,Re,me].map(o=>new ui(new m(s=>s.terrain()instanceof o),new m(s=>i.getByTile(s).some(a=>a instanceof je)),new p(()=>new le(1,je.name)))),...[we,Re,me].map(o=>new ui(new m((s,a)=>{if(!a)return!1;try{return r.getByPlayer(a).is(pt,Ot)}catch{return!1}}),new m(s=>s.terrain()instanceof o),new m(s=>i.getByTile(s).some(a=>a instanceof je)),new p(()=>new le(1,je.name))))],"getRules"),Tk=kW});var YW,Ik,Ak=n(()=>{xa();_r();I();v();ya();$n();WO();YW=t((i=Fe)=>[...[[Q,.5],[V,.5],[le,.5]].map(([e,r])=>new Ec(new fa,new m((o,s,a)=>a.some(l=>l instanceof e)),new m(o=>i.getByTile(o).some(s=>s instanceof lr)),new p((o,s,a)=>{let l=a.filter(u=>u instanceof e).reduce((u,c)=>u+c.value(),0);a.push(new e(Math.floor(l*r),lr.name))})))],"getRules"),Ik=YW});var zW,Bk,Gk=n(()=>{q();vO();hh();v();Yv();zW=t((i=Fp,e=b,r=()=>Math.random())=>[new CO(new p(()=>{if(e.option("earth",!1))return Gp;let o=i.entries();if(o.length===0)throw new TypeError("No available `World` generators.");return o[Math.floor(o.length*r())]}))],"getRules"),Bk=zW});var LW={};var Uk=n(()=>{nk();sk();mk();uk();fk();dk();w();Ok();xk();Pk();wk();Ak();Gk();d.register(...ok(),...ak(),...lk(),...pk(),...ck(),...yk(),...hk(),...Rk(),...Ck(),...Tk(),...Ik(),...Bk())});var IO,AO,Lv=n(()=>{Qi();dm();IO=class extends He{constructor(){super(En)}};t(IO,"TerrainRegistry");AO=new IO});var NW={};var Mk=n(()=>{uo();Lv();AO.register(Yt,we,Ze,Re,Me,it,We,mt,me,ne,ot,dt)});var jW={};var Dk=n(()=>{gu();Mv();dO.register(sn,ln,bi,mn,pn,po,Ci,un,cn,an)});var Sk=P(Ek=>{"use strict";Object.defineProperty(Ek,"__esModule",{value:!0});Uk();Mk();Dk()});var WW,Fk,kk=n(()=>{Xe();bt();io();Xi();WW=t((i=H)=>[new $(K,"cities",e=>i.getByPlayer(e)),new $(he,"city",e=>i.getByTile(e))],"getAdditionalData"),Fk=WW});var HW={};var Yk=n(()=>{Ct();kk();X.register(...Fk())});var Lk=P(zk=>{"use strict";Object.defineProperty(zk,"__esModule",{value:!0});Yk()});var _W,Nk,jk=n(()=>{Fn();bt();Sn();_W=t((i=Et)=>[new $(_e,"build",e=>i.getByCity(e))],"getAdditionalData"),Nk=_W});var KW={};var Wk=n(()=>{jk();Ct();X.register(...Nk())});var _k=P(Hk=>{"use strict";Object.defineProperty(Hk,"__esModule",{value:!0});Wk()});var qW,Kk,qk=n(()=>{St();bt();Sn();qW=t((i=ie)=>[new $(_e,"growth",e=>i.getByCity(e))],"getAdditionalData"),Kk=qW});var VW={};var Vk=n(()=>{Ct();qk();X.register(...Kk())});var $k=P(Jk=>{"use strict";Object.defineProperty(Jk,"__esModule",{value:!0});Vk()});var JW,Zk,Qk=n(()=>{w();bt();Cg();Sn();Vl();JW=t((i=d)=>[new $(_e,"civilDisorder",e=>i.process(Lo,e,e.yields()).some(r=>r)),new $(_e,"celebrateLeader",e=>i.process(Op,e,e.yields()).some(r=>r))],"getAdditionalData"),Zk=JW});var $W={};var Xk=n(()=>{Qk();Ct();X.register(...Zk())});var t1=P(e1=>{"use strict";Object.defineProperty(e1,"__esModule",{value:!0});Xk()});var ZW,r1,i1=n(()=>{Or();bt();Sn();ZW=t((i=Pe)=>[new $(_e,"improvements",e=>i.getByCity(e))],"getAdditionalData"),r1=ZW});var QW={};var o1=n(()=>{Ct();i1();X.register(...r1())});var a1=P(n1=>{"use strict";Object.defineProperty(n1,"__esModule",{value:!0});o1()});var XW,s1,l1=n(()=>{pl();bt();Xi();XW=t((i=Kr)=>[new $(he,"goodyHut",e=>i.getByTile(e))],"getAdditionalData"),s1=XW});var eH={};var m1=n(()=>{Ct();l1();X.register(...s1())});var u1=P(p1=>{"use strict";Object.defineProperty(p1,"__esModule",{value:!0});m1()});var tH,c1,f1=n(()=>{fn();bt();io();tH=t((i=gt)=>[new $(K,"government",e=>i.getByPlayer(e))],"getAdditionalData"),c1=tH});var rH={};var y1=n(()=>{f1();Ct();X.register(...c1())});var g1=P(d1=>{"use strict";Object.defineProperty(d1,"__esModule",{value:!0});y1()});var iH,h1,O1=n(()=>{ao();bt();io();iH=t((i=pe)=>[new $(K,"world",e=>i.getByPlayer(e))],"getAdditionalData"),h1=iH});var oH={};var R1=n(()=>{Ct();O1();X.register(...h1())});var v1=P(x1=>{"use strict";Object.defineProperty(x1,"__esModule",{value:!0});R1()});var nH,b1,C1=n(()=>{ze();bt();io();nH=t((i=N)=>[new $(K,"research",e=>i.getByPlayer(e))],"getAdditionalData"),b1=nH});var aH={};var P1=n(()=>{Ct();C1();X.register(...b1())});var w1=P(T1=>{"use strict";Object.defineProperty(T1,"__esModule",{value:!0});P1()});var sH,I1,A1=n(()=>{im();bt();io();sH=t((i=jo)=>[new $(K,"spaceship",e=>i.getActiveByPlayer(e))],"getAdditionalData"),I1=sH});var lH={};var B1=n(()=>{Ct();A1();X.register(...I1())});var U1=P(G1=>{"use strict";Object.defineProperty(G1,"__esModule",{value:!0});B1()});var mH,M1,D1=n(()=>{nn();bt();dm();mH=t((i=yt)=>[new $(En,"features",e=>i.getByTerrain(e))],"getAdditionalData"),M1=mH});var pH={};var E1=n(()=>{Ct();D1();X.register(...M1())});var F1=P(S1=>{"use strict";Object.defineProperty(S1,"__esModule",{value:!0});E1()});var uH,k1,Y1=n(()=>{_r();bt();Xi();uH=t((i=Fe)=>[new $(he,"improvements",e=>i.getByTile(e))],"getAdditionalData"),k1=uH});var cH={};var z1=n(()=>{Ct();Y1();X.register(...k1())});var N1=P(L1=>{"use strict";Object.defineProperty(L1,"__esModule",{value:!0});z1()});var fH,j1,W1=n(()=>{Zu();bt();io();fH=t((i=Ol)=>[new $(K,"rates",e=>i.getByPlayer(e))],"getAdditionalData"),j1=fH});var yH={};var H1=n(()=>{Ct();W1();X.register(...j1())});var K1=P(_1=>{"use strict";Object.defineProperty(_1,"__esModule",{value:!0});H1()});var dH,q1,V1=n(()=>{w();bt();Np();jp();dH=t((i=d)=>[new $(Ps,"spendCost",e=>i.process(to,e))],"getAdditionalData"),q1=dH});var gH,J1,$1=n(()=>{Il();bt();io();gH=t((i=fi)=>[new $(K,"treasuries",e=>i.getByPlayer(e))],"getAdditionalData"),J1=gH});var hH={};var Z1=n(()=>{Ct();V1();$1();X.register(...q1(),...J1())});var X1=P(Q1=>{"use strict";Object.defineProperty(Q1,"__esModule",{value:!0});Z1()});var BO,eY,tY=n(()=>{A();BO=class extends g{};t(BO,"End");eY=BO});var OH,rY,iY=n(()=>{q();w();Ft();tY();zv();Tv();OH=t((i=d,e=b,r=te)=>[["engine:start",()=>{i.process(TO)}],...["game:start","turn:end"].map(o=>[o,()=>{e.emit("turn:start",r.increment())}]),["turn:end",()=>{i.process(eY,r)}],["turn:start",()=>{i.process(Jh,r)}]],"getEvents"),rY=OH});var RH={};var oY=n(()=>{q();iY();[...rY()].forEach(([i,e])=>{b.on(i,e)})});var aY=P(nY=>{"use strict";Object.defineProperty(nY,"__esModule",{value:!0});oY()});var xH,sY,lY=n(()=>{$e();bt();Sn();io();Xi();xH=t((i=W)=>[new $(_e,"units",e=>i.getByCity(e)),new $(K,"units",e=>i.getByPlayer(e,!0)),new $(he,"units",e=>i.getByTile(e))],"getAdditionalData"),sY=xH});var vH={};var mY=n(()=>{Ct();lY();X.register(...sY())});var uY=P(pY=>{"use strict";Object.defineProperty(pY,"__esModule",{value:!0});mY()});var bH,cY,fY=n(()=>{Ca();bt();ga();bH=t((i=mr)=>[new $(Ge,"improvements",e=>i.getByUnit(e))],"getAdditionalData"),cY=bH});var CH={};var yY=n(()=>{Ct();fY();X.register(...cY())});var gY=P(dY=>{"use strict";Object.defineProperty(dY,"__esModule",{value:!0});yY()});var GO,hY,OY=n(()=>{Qi();ox();GO=class extends He{constructor(){super(vd)}};t(GO,"AIClientRegistry");hY=new GO});var PH={};var RY=n(()=>{OY();rp();hY.register(oa)});var TH,xY,vY=n(()=>{Wl();$e();bl();I();v();rp();TH=t((i=W,e=zo)=>[new xr(new m((r,o)=>e.getByPlayer(o)instanceof oa),new p((r,o,s)=>e.getByPlayer(o).cityLost(r,s,!1)))],"getRules"),xY=TH});var wH,bY,CY=n(()=>{Wl();$e();I();Cl();v();rp();wH=t((i=W,e=zo)=>[new Wr(new m(r=>e.getByPlayer(r.player())instanceof oa),new p((r,o)=>e.getByPlayer(r.player()).cityLost(r,o,!0)))],"getRules"),bY=wH});var IH,PY,TY=n(()=>{Wl();$e();I();uu();v();rp();IH=t((i=W,e=zo)=>[new rn(new m(r=>e.getByPlayer(r.player())instanceof oa),new p((r,o)=>e.getByPlayer(r.player()).unitDestroyed(r,o&&o.player())))],"getRules"),PY=IH});var AH={};var wY=n(()=>{w();vY();CY();TY();d.register(...xY(),...PY(),...bY())});var AY=P(IY=>{"use strict";Object.defineProperty(IY,"__esModule",{value:!0});RY();wY()});var UO,BY,GY=n(()=>{Dv();dh();nr();w();Lv();Ev();cv();UO=class extends Bp{#e;#t;#r;#i;#o;#n;#a;#s;#l;#m;constructor(e=100,r=160,o={},s=d,a=AO,l=()=>Math.random()){super(e,r);let{landCoverage:u=.4,landSize:c=.2,maxIterations:f=10,clusterChance:y=.05,coverage:h=.25,pathChance:G=.05}=o;this.#e=u,this.#t=c,this.#r=f,this.#i=y,this.#o=h,this.#n=G,this.#l=s,this.#m=a,this.#s=l,this.#a=new Array(this.height()*this.width()).fill(0).map(()=>new or)}async generateIslands(){let e=this.height(),r=this.width(),o=this.#t+this.#s()*.2,s=this.#e,a=this.#r,l=Math.ceil(e*r/100*o),u=new Array(e*r).fill(0);for(;u.length===0||u.filter(c=>c===1).length/u.length<s;){let c={},f=[],y=[],h=Math.floor(e*r*Math.random()),G=t(D=>{D in c||(c[D]=0),c[D]++},"flagAsSeen");for(u[h]=1,f.push(h),G(h),y.push(...rm(e,r,h));y.length;){let D=y.shift();if((c[D]||0)<=a&&(Math.random()>.3?(u[D]=1,f.push(D),rm(e,r,D).filter(B=>y.indexOf(B)===-1).forEach(B=>y.push(B))):rm(e,r,D).forEach(B=>{let E=y.indexOf(B);E>-1&&y.splice(E,1)}),G(D)),f.length>l||u.filter(B=>B===1).length/u.length>=s)break}if(u.filter(D=>D===1).length/u.length>=s)break}this.#a=u.map(c=>c===1?new _:new or)}generate(){return this.generateIslands().then(()=>this.populateTerrain().then(()=>this.#a))}getNeighbours(e,r=!0){return rm(this.height(),this.width(),e,r)}populateTerrain(){return new Promise(e=>{let r=this.#l.get(Wt);this.#l.get(hO).filter(o=>o.validate()).map(o=>{let s=o.process();if(!s)throw new TypeError("Unexpected data from DistributionGroups.");return s}).forEach(o=>o.forEach(s=>r.filter(a=>a.validate(s,this.#a)).map(a=>{let l=a.process(s,this.#a);if(!l)throw new TypeError("Unexpected data from Distribution.");return l}).forEach(a=>a.forEach(({cluster:l=!1,clusterChance:u=this.#i,coverage:c=this.#o,fill:f=!1,from:y=0,path:h=!1,pathChance:G=this.#n,to:D=1})=>{let B=Object.keys(this.#a).map(Y=>parseInt(Y,10)).filter(Y=>this.#a[Y]instanceof s.__proto__).filter(Y=>Y>=y*this.height()*this.width()&&Y<=D*this.height()*this.width());if(f){B.forEach(Y=>{this.#a[Y]=new s});return}let E=B.length*c;for(;E>0;){let Y=B[Math.floor(this.#s()*B.length)];if(this.#a[Y]=new s,E--,l){let ue=this.getNeighbours(Y).filter(Dt=>!(this.#a[Dt]instanceof s));for(;ue.length&&E>0;){let Dt=ue.shift();u>=this.#s()/this.distanceFrom(Y,Dt)&&(this.#a[Dt]=new s,E--,ue.push(...this.getNeighbours(Dt).filter(Lr=>!(this.#a[Lr]instanceof s)).filter(Lr=>this.#a[Lr]instanceof s.__proto__).filter(Lr=>!ue.includes(Lr))))}}if(h){let ue=Y;for(;G>=this.#s();){let Dt=this.getNeighbours(ue).filter(Lr=>this.#a[Lr]instanceof s.__proto__&&!(this.#a[Lr]instanceof s));ue=Dt[Math.floor(this.#s()*Dt.length)],this.#a[ue]=new s,E--}}}})))),e()})}};t(UO,"BaseGenerator");BY=UO});var BH={};var UY=n(()=>{GY();vO();Fp.register(BY)});var DY=P(MY=>{"use strict";Object.defineProperty(MY,"__esModule",{value:!0});UY()});var GH={};var yJe,dJe,gJe,hJe,OJe,RJe,xJe,vJe,bJe,CJe,PJe,TJe,wJe,IJe,AJe,BJe,GJe,UJe,MJe,DJe,EJe,SJe,FJe,kJe,YJe,zJe,LJe,NJe,jJe,WJe,HJe,_Je,KJe,qJe,VJe,JJe,$Je,ZJe,QJe,XJe,e6e,t6e,r6e,i6e,o6e,n6e,a6e,s6e,l6e,m6e,p6e,u6e,c6e,f6e,y6e,d6e,g6e,h6e,O6e,R6e,x6e,v6e,b6e,C6e,P6e,T6e,w6e,I6e,A6e,B6e,G6e,U6e,M6e,D6e,E6e,S6e,F6e,k6e,Y6e,z6e,L6e,N6e,j6e,W6e,H6e,_6e,K6e,q6e,V6e,J6e,$6e,Z6e,Q6e,X6e,e8e,t8e,r8e,i8e,o8e,n8e,a8e,s8e,l8e,m8e,p8e,u8e,c8e,f8e,y8e,d8e,g8e,h8e,O8e,R8e,x8e,v8e,b8e,C8e,EY=n(()=>{"use strict";yJe=T(tw()),dJe=T(nw()),gJe=T(mw()),hJe=T(fw()),OJe=T(hw()),RJe=T(vw()),xJe=T(Tw()),vJe=T(Bw()),bJe=T(Dw()),CJe=T(kw()),PJe=T(Nw()),TJe=T(_w()),wJe=T(Jw()),IJe=T(Xw()),AJe=T(rI()),BJe=T(nI()),GJe=T(lI()),UJe=T(uI()),MJe=T(yI()),DJe=T(hI()),EJe=T(xI()),SJe=T(CI()),FJe=T(wI()),kJe=T(BI()),YJe=T(MI()),zJe=T(SI()),LJe=T(YI()),NJe=T(NI()),jJe=T(HI()),WJe=T(qI()),HJe=T($I()),_Je=T(XI()),KJe=T(rA()),qJe=T(nA()),VJe=T(lA()),JJe=T(uA()),$Je=T(yA()),ZJe=T(hA()),QJe=T(xA()),XJe=T(CA()),e6e=T(wA()),t6e=T(BA()),r6e=T(MA()),i6e=T(SA()),o6e=T(YA()),n6e=T(NA()),a6e=T(HA()),s6e=T(qA()),l6e=T($A()),m6e=T(XA()),p6e=T(rB()),u6e=T(nB()),c6e=T(lB()),f6e=T(uB()),y6e=T(yB()),d6e=T(hB()),g6e=T(xB()),h6e=T(CB()),O6e=T(wB()),R6e=T(BB()),x6e=T(MB()),v6e=T(SB()),b6e=T(YB()),C6e=T(NB()),P6e=T(HB()),T6e=T(qB()),w6e=T($B()),I6e=T(XB()),A6e=T(rG()),B6e=T(nG()),G6e=T(lG()),U6e=T(uG()),M6e=T(yG()),D6e=T(hG()),E6e=T(xG()),S6e=T(CG()),F6e=T(wG()),k6e=T(BG()),Y6e=T(MG()),z6e=T(SG()),L6e=T(YG()),N6e=T(hU()),j6e=T(SU()),W6e=T(nM()),H6e=T(aD()),_6e=T(fD()),K6e=T(bD()),q6e=T(UD()),V6e=T(FD()),J6e=T(XD()),$6e=T(uE()),Z6e=T(qE()),Q6e=T(y0()),X6e=T(Q0()),e8e=T(yS()),t8e=T(IS()),r8e=T(uF()),i8e=T(ik()),o8e=T(Sk()),n8e=T(Lk()),a8e=T(_k()),s8e=T($k()),l8e=T(t1()),m8e=T(a1()),p8e=T(u1()),u8e=T(g1()),c8e=T(v1()),f8e=T(w1()),y8e=T(U1()),d8e=T(F1()),g8e=T(N1()),h8e=T(K1()),O8e=T(X1()),R8e=T(aY()),x8e=T(uY()),v8e=T(gY()),b8e=T(AY()),C8e=T(DY())});SO();JO();$O();nf();Cm();var Hp=class extends Bs{#e;#t;constructor(e,r=Yn,o=()=>Math.random()){super(e),this.#e=r,this.#t=o}chooseCivilization(e){let r=e[Math.floor(e.length*this.#t())],o=this.player(),s=new r;o.setCivilization(s),this.chooseLeader(s)}chooseLeader(e){let r=this.#e.getByCivilization(e.constructor),o=r[Math.floor(r.length*this.#t())];e.setLeader(new o)}};t(Hp,"Client");QO();vr();XO();Sn();xf();Se();Kt();nR();Z();var Es,Af=class{constructor(){xe(this,Es,[])}add(e,r,o=null){C(this,Es).push({[e]:{type:"add",index:o,value:r}})}clear(){C(this,Es).splice(0)}remove(e,r=null){C(this,Es).push({[e]:{type:"remove",index:r}})}transferData(){return C(this,Es).slice(0).map(e=>{let r={};return Object.entries(e).forEach(([o,{type:s,index:a,value:l}])=>{r[o]={type:s,index:a,value:typeof l=="function"?l():l}}),r})}update(e,r,o=null){C(this,Es).push({[e]:{type:"update",index:o,value:r}})}};t(Af,"DataQueue"),Es=new WeakMap;var hb=Af;Gf();aR();sR();Rl();io();mR();Wf();var Hf=class extends Error{constructor(e,r,o){super(e)}};t(Hf,"RetryFailed");var Pb=Hf;var qp,Vp,Im,Jp,Am,$p,Zp,_f=class{constructor(e,r=5,o=100){xe(this,qp,0);xe(this,Vp,void 0);xe(this,Im,void 0);xe(this,Jp,void 0);xe(this,Am,void 0);xe(this,$p,void 0);xe(this,Zp,void 0);Ye(this,Im,e),Ye(this,Jp,r),Ye(this,Am,setInterval(()=>this.run(),o)),Ye(this,Vp,new Promise((s,a)=>{Ye(this,Zp,s),Ye(this,$p,a)}))}run(){if(++Wv(this,qp)._>C(this,Jp)){clearInterval(C(this,Am)),C(this,$p).call(this,new Pb("Retry failed.",C(this,Im),C(this,qp)));return}C(this,Im).call(this)&&(clearInterval(C(this,Am)),C(this,Zp).call(this))}then(){return C(this,Vp)}};t(_f,"Retryable"),qp=new WeakMap,Vp=new WeakMap,Im=new WeakMap,Jp=new WeakMap,Am=new WeakMap,$p=new WeakMap,Zp=new WeakMap;var Tb=_f;uR();Z();var Kf=class extends Ie{constructor(e){super(),Object.assign(this,e),this.addKey(...Object.keys(e))}};t(Kf,"TransferObject");var qf=Kf;Xi();ga();Z();St();var eu,tu,ru,iu,hR=class extends Ie{constructor(r,o,s,a){super();xe(this,eu,void 0);xe(this,tu,void 0);xe(this,ru,{size:0});xe(this,iu,void 0);Ye(this,eu,r),Ye(this,tu,s),C(this,ru).size=a,Ye(this,iu,o),this.addKey("_","growth","name","player","tile")}static fromCity(r){let o=ie.getByCity(r);return new hR(r.name(),r.tile(),r.player(),o.size())}_(){return"City"}name(){return C(this,eu)}player(){return C(this,tu)}growth(){return C(this,ru)}tile(){return C(this,iu)}},ry=hR;t(ry,"City"),eu=new WeakMap,tu=new WeakMap,ru=new WeakMap,iu=new WeakMap;var Db=ry;Z();var ou,OR=class extends Ie{constructor(r){super();xe(this,ou,void 0);Ye(this,ou,r),this.addKey("_","civilization")}static fromPlayer(r){return new OR(r.civilization())}_(){return"Player"}civilization(){return C(this,ou)}},iy=OR;t(iy,"Player"),ou=new WeakMap;var Eb=iy;Z();var nu,au,su,RR=class extends Ie{constructor(r,o,s){super();xe(this,nu,void 0);xe(this,au,void 0);xe(this,su,void 0);Ye(this,nu,r),Ye(this,au,o),Ye(this,su,s),this.addKey("_","tile","player")}static fromUnit(r){return new RR(r.constructor.name,r.tile(),r.player())}_(){return C(this,nu)}player(){return C(this,su)}tile(){return C(this,au)}},oy=RR;t(oy,"Unit"),nu=new WeakMap,au=new WeakMap,su=new WeakMap;var Sb=oy;Be();U();Xe();Sm();q();Cm();Ys();ze();Il();ao();Ft();$e();vR();Ym();va();var jb=t(i=>i instanceof Ie?{"#ref":i.id()}:i,"referenceObject"),Ne=t((...i)=>e=>i.some(r=>e instanceof r)?jb(e):e,"filterToReference"),Nb=t((...i)=>e=>i.some(r=>e instanceof r)?e:jb(e),"filterToReferenceAllExcept"),IR=new Map,AR=new Map,BR=new Map,ye,oe,kl,Ks,Hn,pu,gy=class extends Hp{constructor(r,o,s){super(r);xe(this,ye,t((r=o=>o)=>o=>o instanceof K&&o!==this.player()?(IR.has(o)||IR.set(o,Eb.fromPlayer(o)),IR.get(o)):o instanceof Ge&&o.player()!==this.player()?(AR.has(o)||AR.set(o,Sb.fromUnit(o)),AR.get(o)):o instanceof _e&&o.player()!==this.player()?(BR.has(o)||BR.set(o,Db.fromCity(o)),BR.get(o)):o instanceof he?pe.getByPlayer(this.player()).get(o.x(),o.y()):o instanceof Ae?{_:o.constructor.name}:r(o),"#dataFilter"));xe(this,oe,new hb);xe(this,kl,void 0);xe(this,Ks,void 0);xe(this,Hn,void 0);xe(this,pu,!1);Ye(this,kl,new Mf),Ye(this,Hn,o),Ye(this,Ks,s),C(this,Ks).call(this,"action",(...a)=>{C(this,kl).emit("action",...a)}),C(this,Ks).call(this,"cheat",({name:a,value:l})=>{if(a==="RevealMap"){let u=pe.getByPlayer(this.player()),[c]=u.entries();c.tile().map().entries().forEach(f=>{if(u.includes(f))return;u.register(f);let y=u.getByTile(f);C(this,oe).add(u.id(),()=>f.toPlainObject(C(this,ye).call(this)),`entries[${u.entries().indexOf(y)}]`)})}if(a==="GrantAdvance"){let[u]=R.filter(f=>f.name===l),c=N.getByPlayer(this.player());if(!u||c.completed(u))return;c.addAdvance(u),C(this,oe).add(c.id(),c.toPlainObject(C(this,ye).call(this,Ne(K))))}if(a==="GrantGold"){let u=fi.getByPlayerAndType(this.player(),Ee);u.add(l),C(this,oe).add(u.id(),u.toPlainObject(C(this,ye).call(this,Ne(K))))}if(a==="ModifyUnit"){let{unitId:u,properties:c}=l,[f]=W.getBy("id",u);if(!f)return;["attack","defence","moves","movement","visibility"].forEach(y=>{y in c&&f[y]().set(c[y])}),C(this,oe).add(f.id(),f.toPlainObject(C(this,ye).call(this,Ne(K))))}this.sendPatchData()}),b.on("engine:plugins:load:failed",(a,l)=>{console.log(a+" failed to load"),console.error(l)}),b.on("player:visibility-changed",(a,l)=>{if(l!==this.player())return;let u=pe.getByPlayer(this.player()),c=u.getByTile(a);if(c===null){new Tb(()=>{let f=u.getByTile(a);return f===null?!1:(C(this,oe).add(u.id(),()=>a.toPlainObject(C(this,ye).call(this,Ne(K))),`tiles[${u.entries().indexOf(f)}]`),!0)},2,20);return}C(this,oe).add(u.id(),()=>c.toPlainObject(C(this,ye).call(this,Ne(K))),`tiles[${u.entries().indexOf(c)}]`)}),["unit:created","unit:defeated"].forEach(a=>{b.on(a,l=>{let u=pe.getByPlayer(this.player()),c=u.getByTile(l.tile());if(!!c&&(C(this,oe).update(c.id(),()=>c.toPlainObject(C(this,ye).call(this,Ne(K)))),l.player()===this.player())){if(a==="unit:created"){let f=W.getByPlayer(this.player()),y=f.indexOf(l),h=W.getByCity(l.city()),G=h.indexOf(l),D=W.getByTile(l.tile()),B=D.indexOf(l);C(this,oe).add(r.id(),()=>l.toPlainObject(C(this,ye).call(this,Ne(he,K,Tm,_e))),`units[${y}]`),C(this,oe).add(c.id(),()=>l.toPlainObject(C(this,ye).call(this,Ne(Ge))),`units[${B}]`),l.city()!==null&&C(this,oe).add(l.city().id(),()=>l.toPlainObject(C(this,ye).call(this,Ne(Ge))),`units[${G}]`);return}C(this,oe).update(this.player().id(),()=>this.player().toPlainObject(C(this,ye).call(this,Nb(K,Ge))))}})}),["unit:destroyed"].forEach(a=>{b.on(a,(l,u)=>{l.player()===this.player()&&l.city()!==null&&C(this,oe).update(l.city().id(),()=>l.city().toPlainObject(C(this,ye).call(this,Ne(kn,Gl,L,K,Tm,he,Ge))))})}),["unit:moved"].forEach(a=>{b.on(a,(l,u)=>{let c=pe.getByPlayer(this.player()),f=c.getByTile(u.from()),y=c.getByTile(u.to());!f&&!y||(f&&C(this,oe).update(f.id(),()=>f.toPlainObject(C(this,ye).call(this,Ne(K,_e)))),y&&C(this,oe).update(y.id(),()=>y.toPlainObject(C(this,ye).call(this,Ne(K,_e)))),l.player()===this.player()&&l.city()!==null&&C(this,oe).update(l.city().id(),()=>l.city().toPlainObject(C(this,ye).call(this,Ne(kn,Gl,L,K,Tm,he,Ge)))))})}),["tile-improvement:built","tile-improvement:pillaged"].forEach(a=>{b.on(a,l=>{let u=pe.getByPlayer(this.player()),c=u.getByTile(l);c&&C(this,oe).update(c.id(),()=>c.toPlainObject(C(this,ye).call(this,Ne(K,_e))))})}),b.on("city:captured",(a,l,u)=>{if(u===this.player()){H.getByPlayer(this.player()).indexOf(a)!==-1&&C(this,oe).update(this.player().id(),()=>this.player().toPlainObject(C(this,ye).call(this,Nb(K)))),this.sendNotification(`${l.civilization().name()} have captured our city ${a.name()}!`);return}if(l===this.player()){this.sendNotification(`We have captured ${a.name()} from ${u.civilization().name()}!`);return}}),["city:created","city:captured","city:destroyed","city:grow","city:shrink"].forEach(a=>{b.on(a,l=>{let u=pe.getByPlayer(this.player()),c=u.getByTile(l.tile());!c||C(this,oe).update(c.id(),()=>c.toPlainObject(C(this,ye).call(this,Ne(K))))})}),b.on("city:shrink",a=>{a.player()===this.player()&&this.sendNotification(`Population decrease in ${a.name()}.`)}),b.on("city:unit-unsupported",(a,l)=>{a.player()===this.player()&&this.sendNotification(`${a.name()} cannot support ${l.constructor.name}.`)}),b.on("city:unsupported-improvement",(a,l)=>{a.player()===this.player()&&this.sendNotification(`${a.name()} cannot support ${l.constructor.name}.`)}),b.on("city:food-storage-exhausted",a=>{a.player()===this.player()&&this.sendNotification(`Food storage exhausted in ${a.name()}!`)}),b.on("city:building-complete",(a,l)=>{let u=pe.getByPlayer(this.player());if(a.city().player()!==this.player()&&l instanceof Oe){this.sendNotification(`${u.getByTile(a.city().tile())?a.city().name():"A faraway city"} has completed work on ${l.constructor.name}!`);return}a.city().player()!==this.player()&&!(l instanceof Oe)||(C(this,oe).update(a.id(),()=>a.toPlainObject(C(this,ye).call(this,Ne(he,Ge,K)))),this.sendNotification(`${a.city().name()} has completed work on ${l.constructor.name}!`))}),b.on("player:research-complete",(a,l)=>{a.player()===this.player()&&(C(this,oe).update(a.id(),()=>a.toPlainObject(C(this,ye).call(this,Ne(K)))),this.sendNotification(`You have discovered the secrets of ${l.constructor.name}!`))}),b.on("goody-hut:action-performed",(a,l)=>{let u=a.tile();if(!!W.getByTile(u).some(f=>f.player()===this.player())){if(l instanceof vs){this.sendNotification("You have discovered scrolls of ancient wisdom...");return}if(l instanceof bs){this.sendNotification("You have discovered an advanced tribe...");return}if(l instanceof ws){this.sendNotification("You have discovered valuable treasure...");return}if(l instanceof Is){this.sendNotification("You have discovered a friendly tribe of skilled mercenaries...");return}}}),b.on("player:defeated",(a,l)=>{a===this.player()&&(this.sendNotification("You have been defeated!"),hi.unregister(...hi.entries()),Xo.unregister(...Xo.entries()),C(this,Hn).call(this,"restart",null)),this.sendNotification(`${a.civilization().name()} defeated${l?` by ${l.civilization().name()}`:""}.`)}),b.on("city:civil-disorder",a=>{a.player()===this.player()&&this.sendNotification(`Civil disorder in ${a.name()}!`)}),b.on("city:order-restored",a=>{a.player()===this.player()&&this.sendNotification(`Order restored in ${a.name()}!`)}),b.on("city:leader-celebration",a=>{a.player()===this.player()&&this.sendNotification(`We love the leader celebrations in ${a.name()}!`)}),b.on("city:leader-celebration-ended",a=>{a.player()===this.player()&&this.sendNotification(`We love the leader celebrations cancelled in ${a.name()}!`)}),b.on("player:spaceship:part-built",a=>{this.player()!==a&&this.sendNotification(`Component added to ${a.civilization().name()} spaceship.`)}),b.on("player:spaceship:lost",a=>{this.player()===a&&this.sendNotification("Our spaceship was lost in space.")}),b.on("player:spaceship:landed",a=>{this.player()===a&&this.sendNotification("Our spaceship has landed on Alpha Centauri!")})}chooseCivilization(r){let o=t(s=>(this.player().setCivilization(new s),this.chooseLeader(this.player().civilization())),"makeChoice");return new Promise((s,a)=>{if(r.length===1){let[l]=r;o(l).then(()=>s());return}C(this,Hn).call(this,"chooseCivilization",new qf({choices:r}).toPlainObject()),C(this,Ks).call(this,"chooseCivilization",l=>{let[u]=r.filter(c=>c.name===l);if(!u){a(`Invalid civilization ${l} (options: ${r.map(c=>c.name).join(", ")})`);return}o(u).then(()=>s())})})}chooseLeader(r){return new Promise((o,s)=>{let a=Yn.getByCivilization(r.constructor);if(a.length===1){let[l]=a;r.setLeader(new l),o();return}C(this,Hn).call(this,"chooseLeader",new qf({choices:a}).toPlainObject()),C(this,Ks).call(this,"chooseLeader",l=>{let[u]=a.filter(c=>c.name===l);if(!u){s(`Invalid civilization ${l} (options: ${a.map(c=>c.name).join(", ")})`);return}r.setLeader(new u),o()})})}handleAction(...r){let[o]=r,s=this.player(),a=s.actions(),l=a.filter(y=>y instanceof pi),{name:u,id:c}=o;if(u==="ReassignWorkers"){let[y]=H.getBy("id",o.city);return y&&(Fb(y),C(this,oe).update(y.id(),y.toPlainObject(C(this,ye).call(this,Ne(K,he))))),!1}if(u==="EndTurn")return l.length===1&&l.every(y=>y instanceof Ul);if(!u)return console.log("action not specified"),!1;let[f]=a.filter(y=>y.constructor.name===u&&c===(y.value()?y.value().id():void 0));if(!f)return console.log("action not specified"),!1;if(f instanceof ds){let{unitAction:y,target:h}=o,G=f.value(),B=[...G.actions(),...Object.values(G.actionsForNeighbours())].flat().filter(Y=>Y.constructor.name===y);for(;B.length!==1;){if(B.length===0)return console.log(`action not found: ${y}`),!1;let[Y]=pe.getByPlayer(this.player()).filter(ue=>ue.id()===h);if(!Y)return console.log(`tile not found: ${h}`),!1;if(B=B.filter(ue=>ue.to()===Y.tile()),B.length>1&&!h)return console.log(`too many actions found: ${y} (${B.length})`),!1}let[E]=B;return E.perform(),!1}if(f instanceof gs){let y=f.value();return y.moves().value()>0&&C(this,oe).update(y.id(),y.toPlainObject(C(this,ye).call(this,Ne(K,he)))),y.activate(),!1}if(f instanceof kn||f instanceof As){let y=f.value(),{chosen:h}=o;if(!h)return console.log("no build item specified"),!1;let[G]=y.available().filter(D=>D.item().name===h);return G?(y.build(G.item()),!1):(console.log(`build item not available: ${h}`),!1)}if(f instanceof yb){let y=f.value(),{chosen:h}=o;if(!h)return this.sendNotification("no build item specified"),!1;let[G]=y.available().filter(D=>D.name===h);return G?(y.research(G),!1):(console.log(`build item not available: ${h}`),!1)}if(f instanceof Ds){let y=f.value(),h=fi.getByPlayerAndType(this.player(),Ee);return h.buy(y.city()),C(this,oe).update(h.id(),h.toPlainObject(C(this,ye).call(this,Ne(K)))),!1}if(f instanceof Ss){let y=f.value(),{chosen:h}=o,[G]=y.available().filter(B=>B.name===h);if(!G)return console.error(`Government type: '${h}' not found.`),!1;y.set(new G);let D=pe.getByPlayer(this.player());return C(this,oe).update(D.id(),D.toPlainObject(C(this,ye).call(this,Ne(K)))),H.getByPlayer(this.player()).forEach(B=>C(this,oe).update(B.id(),B.toPlainObject(C(this,ye).call(this,Ne(K,he,Ge))))),!1}if(f instanceof Us){let y=f.value(),{value:h}=o;return y.setAll(h.map(([G,D])=>{let[B]=y.all().filter(E=>E.constructor.name===G);return[B.constructor,D]})),H.getByPlayer(this.player()).forEach(G=>C(this,oe).update(G.id(),G.toPlainObject(C(this,ye).call(this,Ne(K,he,Ge))))),!1}return f instanceof Ml?(f.value().launch(),!1):(console.log(`unhandled action: ${JSON.stringify(o)}`),!1)}sendInitialData(){let r={player:this.player(),turn:te,year:Fm},o=new qf(r);C(this,Hn).call(this,"gameData",o.toPlainObject(C(this,ye).call(this))),Ye(this,pu,!0)}sendPatchData(){C(this,Hn).call(this,"gameDataPatch",C(this,oe).transferData()),C(this,oe).clear()}sendNotification(r){C(this,Hn).call(this,"gameNotification",{message:r})}takeTurn(){return new Promise((r,o)=>{C(this,pu)||this.sendInitialData(),setTimeout(()=>{C(this,oe).update(te.id(),()=>te.toPlainObject()),C(this,oe).update(Fm.id(),()=>Fm.toPlainObject()),C(this,oe).add(this.player().id(),()=>this.player().toPlainObject(C(this,ye).call(this,Ne(he,fe)))),this.sendPatchData()},1);let s=t((...a)=>{try{if(this.handleAction(...a)){C(this,kl).off("action",s),this.sendPatchData(),setTimeout(()=>r(),100);return}C(this,oe).update(this.player().id(),()=>this.player().toPlainObject(C(this,ye).call(this,Ne(wm,he,_e)))),this.sendPatchData()}catch(l){o(l)}},"listener");C(this,kl).on("action",s)})}};t(gy,"DataTransferClient"),ye=new WeakMap,oe=new WeakMap,kl=new WeakMap,Ks=new WeakMap,Hn=new WeakMap,pu=new WeakMap;var Wb=gy;io();rp();Wl();q();Ys();var Ht,MO=class{constructor(e){xe(this,Ht,void 0);Ye(this,Ht,e),e.receive("start",()=>{this.bindEvents(),this.start()}),e.receive("setOption",({name:r,value:o})=>{C(this,Ht).send("notification",`setting ${r} to ${o}`),b.setOption(r,o)}),e.receive("getOptions",r=>e.send("getOptions",r.reduce((o,s)=>(o[s]=b.option(s),o),{}))),e.receive("setOptions",r=>{Object.entries(r).forEach(([o,s])=>b.setOption(o,s)),e.send("setOptions")})}bindEvents(){C(this,Ht).send("notification","binding events"),b.on("engine:initialise",()=>C(this,Ht).send("notification","initialising...")),b.on("engine:plugins:load:success",e=>C(this,Ht).send("notification",`loaded plugin: ${e}`)),b.on("engine:plugins-loaded",()=>C(this,Ht).send("notification","plugins loaded")),b.on("engine:start",()=>C(this,Ht).send("notification","starting...")),b.on("world:generate-start-tiles",()=>C(this,Ht).send("notification","generating start tiles...")),b.on("world:built",()=>C(this,Ht).send("notification","world built")),b.on("game:start",()=>C(this,Ht).send("notification","game start")),b.on("turn:start",e=>C(this,Ht).send("notification",`turn start ${e}`)),b.on("player:turn-start",e=>C(this,Ht).send("notification",`player turn-start: ${e.civilization().constructor.name}`))}start(){b.on("engine:start",()=>{new Array(parseInt(b.option("players"),10)).fill(0).forEach((e,r)=>{let o=new K,s=r===0?new Wb(o,(a,l)=>C(this,Ht).send(a,l),(a,l)=>C(this,Ht).receive(a,l)):new oa(o);hi.register(o),zo.register(s),C(this,Ht).send("notification","generating world...")})}),b.start(),Promise.resolve().then(()=>(EY(),GH)).then(()=>b.emit("plugins:load:end"))}};t(MO,"Game"),Ht=new WeakMap;var SY=MO;var DO=class{async request(e){return new Promise(r=>{this.send(e.channel(),...e.args()),this.receiveOnce(e.channel(),o=>r(o))})}};t(DO,"AbstractTransport");var FY=DO;var EO=class extends FY{receive(e,r){addEventListener("message",({data:{channel:o,data:s}})=>{o===e&&r(s)})}receiveOnce(e,r){addEventListener("message",({data:{channel:o,data:s}})=>{o===e&&r(s)},{once:!0})}send(e,r){postMessage({channel:e,data:r})}};t(EO,"ParentTransport");var kY=EO;var F8e=new SY(new kY);})();
//# sourceMappingURL=backend.js.map
