"use strict";(()=>{var uj=Object.create;var dc=Object.defineProperty;var fj=Object.getOwnPropertyDescriptor;var yj=Object.getOwnPropertyNames;var dj=Object.getPrototypeOf,gj=Object.prototype.hasOwnProperty;var t=(i,e)=>dc(i,"name",{value:e,configurable:!0});var n=(i,e)=>()=>(i&&(e=i(i=0)),e);var w=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Wu=(i,e)=>{for(var r in e)dc(i,r,{get:e[r],enumerable:!0})},xT=(i,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of yj(e))!gj.call(i,a)&&a!==r&&dc(i,a,{get:()=>e[a],enumerable:!(o=fj(e,a))||o.enumerable});return i};var A=(i,e,r)=>(r=i!=null?uj(dj(i)):{},xT(e||!i||!i.__esModule?dc(r,"default",{value:i,enumerable:!0}):r,i)),R=i=>xT(dc({},"__esModule",{value:!0}),i);var RT=(i,e,r)=>{if(!e.has(i))throw TypeError("Cannot "+r)};var I=(i,e,r)=>(RT(i,e,"read from private field"),r?r.call(i):e.get(i)),ae=(i,e,r)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,r)},Ie=(i,e,r,o)=>(RT(i,e,"write to private field"),o?o.call(i,r):e.set(i,r),r),vT=(i,e,r,o)=>({set _(a){Ie(i,e,a,r)},get _(){return I(i,e,o)}});var Y,Zs,ge=n(()=>{Y=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return this.#e.some(r=>e instanceof r)}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,r){return this.filter(o=>{let a=o[e];return a instanceof Function?a.bind(o)()===r:o[e]===r})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(r=>{if(!this.accepts(r))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${r}'.`);this.#t.includes(r)||this.#t.push(r)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(r=>{let o=this.#t.indexOf(r);o>-1&&this.#t.splice(o,1)})}};t(Y,"EntityRegistry");Zs=Y});var Lu,ee,Rt=n(()=>{Lu=class{#e;#t;#r;constructor(e,r,o){this.#e=r,this.#t=o,this.#r=e}data(...e){return this.#t(...e)}key(){return this.#e}type(){return this.#r}};t(Lu,"AdditionalData");ee=Lu});var ju,ne,Ut=n(()=>{ge();Rt();ju=class extends Y{constructor(){super(ee)}getByType(e){return this.filter(r=>r.type()===e||Object.prototype.isPrototypeOf.call(r.type(),e)||Object.prototype.isPrototypeOf.call(r.type().prototype,e))}};t(ju,"AdditionalDataRegistry");ne=new ju});var hj,pR,bT=n(()=>{V();hj=t(i=>{let e=i instanceof he?i.sourceClass():i,r=[];for(;e instanceof Function;)r.push(e),e=Object.getPrototypeOf(e);return r.map(o=>o.name)},"generateInheritance"),pR=hj});var zu,Oj,gc,k,he,V=n(()=>{Ut();ge();bT();zu={},Oj=t(i=>{let e=i.sourceClass().name,r=zu[e];return r||(zu[e]=0),r>=Number.MAX_SAFE_INTEGER&&(zu[e]=BigInt(r)),e+"-"+(++zu[e]).toString(36)},"idProvider"),gc=t((i,e,r=a=>a,o=ne)=>{if(i=r(i),i instanceof Zs&&(i=i.entries()),Array.isArray(i))return i.map(a=>gc(a,e,r,o));if(i instanceof k){let a=i.id();if(!(a in e)){let s={_:i.sourceClass().name,__:pR(i)};e[a]=s,i.keys().forEach(l=>{let c=i[l]instanceof Function?i[l]():i[l];s[l]=gc(c,e,r,o)}),o.getByType(i.sourceClass()).forEach(l=>{s[l.key()]=gc(l.data(i),e,r,o)})}return{"#ref":a}}return i instanceof Function?{_:i.name,__:pR(i)}:i&&i instanceof Object?Object.entries(i).reduce((a,[s,l])=>(a[s]=gc(l,e,r,o),a),{}):i},"toPlainObject"),k=class{#e;#t=["id"];constructor(){this.#e=Oj(this)}addKey(...e){this.#t.push(...e)}id(){return this.#e}keys(){return this.#t}sourceClass(){return this.constructor}toPlainObject(e=o=>o,r=ne){let o={};return{hierarchy:gc(this,o,e,r),objects:o}}};t(k,"DataObject");he=k});var Em,hr,pa=n(()=>{V();Em=class extends k{#e;#t;constructor(e,r){super(),this.#e=e,this.#t=r,this.addKey("value")}player(){return this.#e}value(){return this.#t}};t(Em,"PlayerAction");hr=Em});var Hu,Wi,ql=n(()=>{pa();Hu=class extends hr{};t(Hu,"MandatoryPlayerAction");Wi=Hu});var ln,cR=n(()=>{ql();ln=class extends Wi{};t(ln,"ActiveUnit")});var CT=n(()=>{cR();cR()});var mn,uR=n(()=>{pa();mn=class extends hr{};t(mn,"InactiveUnit")});var TT=n(()=>{uR();uR()});var PT=n(()=>{CT();TT()});var fR=n(()=>{PT()});var _u,b,S=n(()=>{V();_u=class extends he{};t(_u,"Advance");b=_u});var Qe,IT,Ro=n(()=>{Qe=class{#e=[];#t=[];constructor(...e){this.#e.push(...e)}accepts(e){return typeof e=="function"&&this.#e.some(r=>Object.prototype.isPrototypeOf.call(r,e)||Object.prototype.isPrototypeOf.call(r.prototype,e))}entries(){return this.#t.slice()}every(e){return this.entries().every(e)}filter(e){return this.entries().filter(e)}forEach(e){return this.entries().forEach(e)}getBy(e,r){return this.filter(o=>{let a=o[e];return a instanceof Function?a.bind(o)()===r:o[e]===r})}includes(e){return this.#t.includes(e)}indexOf(e){return this.#t.indexOf(e)}get length(){return this.entries().length}map(e){return this.entries().map(e)}register(...e){e.forEach(r=>{if(!this.accepts(r))throw new TypeError(`Registry#register: Invalid entity attempted to be registered: '${r}'.`);this.#t.includes(r)||this.#t.push(r)})}some(e){return this.entries().some(e)}unregister(...e){e.forEach(r=>{let o=this.#t.indexOf(r);o>-1&&this.#t.splice(o,1)})}};t(Qe,"ConstructorRegistry");IT=Qe});var Ku,v,E=n(()=>{S();Ro();Ku=class extends Qe{constructor(){super(b)}};t(Ku,"AdvanceRegistry");v=new Ku});var Sm,m,U=n(()=>{Sm=class{#e=null;constructor(e){e&&(this.#e=e)}validate(...e){return this.#e===null?!0:this.#e(...e)}};t(Sm,"Criterion");m=Sm});var qu,Vu,yR=n(()=>{U();qu=class extends m{#e=[];constructor(...e){super(),e.forEach(r=>{this.#e.push(r)})}criteria(){return this.#e}validate(...e){return this.#e.every(r=>r.validate(...e))}};t(qu,"Criteria");Vu=qu});var Ju,ca,$u=n(()=>{yR();Ju=class extends Vu{};t(Ju,"And");ca=Ju});var Zu,p,C=n(()=>{Zu=class{#e;constructor(e){this.#e=e}apply(...e){return this.#e(...e)}};t(Zu,"Effect");p=Zu});var Qu,xi,Qs=n(()=>{Qu=class{#e;constructor(e=2e3){this.#e=e}value(){return this.#e}};t(Qu,"Priority");xi=Qu});var za,ua,Vl=n(()=>{Qs();za=class extends xi{constructor(){super(1e3)}};t(za,"High");ua=za});var ot,wT,dR=n(()=>{Qs();ot=class extends xi{constructor(){super(3e3)}};t(ot,"Low");wT=ot});var km,AT=n(()=>{Qs();km=class extends xi{constructor(){super(2e3)}};t(km,"Normal")});var Ha=n(()=>{Vl();dR();AT()});var Xu,h,M=n(()=>{$u();U();C();Ha();Xu=class{#e;#t=!0;#r;#i=new km;constructor(...e){let r=[];e.forEach(o=>{if(o instanceof p){if(this.#r)throw new TypeError("Rule: effect already specified, but another was provided.");this.#r=o;return}if(o instanceof m){r.push(o);return}this.#i=o}),r.length&&(this.#e=new ca(...r))}disable(){this.#t=!1}enable(){this.#t=!0}enabled(){return this.#t}priority(){return this.#i}process(...e){if(!!this.#t&&this.#r instanceof p)return this.#r.apply(...e)}validate(...e){return this.#t?this.#e instanceof m?this.#e.validate(...e):!0:!1}};t(Xu,"Rule");h=Xu});var Jl,f,BT,B=n(()=>{ge();M();Jl=class extends Y{#e=new Map;constructor(){super(h)}entries(){return super.entries().sort((e,r)=>e.priority().value()-r.priority().value())}get(e){return this.#e.has(e)||this.#e.set(e,this.filter(r=>r.enabled()&&r instanceof e)),this.#e.get(e)||[]}invalidateCache(e){this.#e.delete(e instanceof h?e.constructor:e)}process(e,...r){return this.get(e).filter(o=>o.validate(...r)).map(o=>o.process(...r))}register(...e){super.register(...e),e.forEach(r=>this.invalidateCache(r))}unregister(...e){super.unregister(...e),e.forEach(r=>this.invalidateCache(r))}};t(Jl,"RuleRegistry");f=new Jl,BT=Jl});var ef,Xs,tf=n(()=>{M();ef=class extends h{};t(ef,"Complete");Xs=ef});var rf,of,gR=n(()=>{M();rf=class extends h{};t(rf,"Cost");of=rf});var nf,af,hR=n(()=>{M();nf=class extends h{};t(nf,"Requirements");af=nf});var el,L,je=n(()=>{V();el=class extends k{#e=[];#t=null;constructor(e=0,r="initial"){super(),this.addKey("value","values"),this.add(e,r)}add(e,r=""){if(e instanceof el)return this.add(e.value(),r);this.#e.push([e,r]),this.#t=null}clone(){return new this.constructor(this)}set(e,r=""){if(this.#e.splice(0),e instanceof el)return this.set(e.value(),r);this.#e.push([e,r]),this.#t=e}subtract(e,r=""){if(e instanceof el)return this.subtract(e.value(),r);this.#e.push([-e,r]),this.#t=null}value(){return this.#t===null&&(this.#t=this.#e.reduce((e,[r])=>e+r,0)),this.#t}values(){return this.#e}};t(el,"Yield");L=el});var $l,GT=n(()=>{je();$l=class extends L{};t($l,"Research")});var MT=n(()=>{GT()});var sf,Fm,lf=n(()=>{M();sf=class extends h{};t(sf,"Started");Fm=sf});var mf,Ym,pf=n(()=>{E();V();B();tf();gR();hR();MT();lf();mf=class extends k{#e;#t=[];#r=null;#i;#o=new $l(1/0);#n=new $l(0);#a;constructor(e,r=v,o=f){super(),this.#e=r,this.#i=e,this.#a=o,this.addKey("available","complete","cost","progress","researching")}add(e){this.#n.add(e),this.check()}addAdvance(e){if(this.#t.some(o=>o instanceof e))return;this.#r===e&&(this.#r=null);let r=new e;this.#t.push(r),this.#a.process(Xs,this,r)}available(){let e=this.#a.get(af);return this.#e.filter(r=>e.filter(o=>o.validate(r,this.#t)).every(o=>o.process(r,this.#t)===!0)&&!this.#t.some(o=>o instanceof r))}check(){if(this.#r!==null&&this.#n.value()>=this.#o.value()){let e=new this.#r;this.#t.push(e),this.#r=null,this.#n.subtract(this.#o),this.#o.set(1/0),this.#a.process(Xs,this,e)}}complete(){return this.#t}completed(e){return this.#t.some(r=>r instanceof e)}cost(){return this.#o}player(){return this.#i}progress(){return this.#n}research(e){let[r]=this.#a.process(of,e,this);this.#o.set(r),this.#r=e,this.#a.process(Fm,this,e)}researching(){return this.#r}};t(mf,"PlayerResearch");Ym=mf});var cf,W,ke=n(()=>{ge();pf();cf=class extends Y{constructor(){super(Ym)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of results for player.");return r[0]}};t(cf,"PlayerResearchRegistry");W=new cf});var Nm,Wm,hc=n(()=>{Nm=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}goodyHut(){return this.#e}perform(){}unit(){return this.#t}};t(Nm,"Action");Wm=Nm});var tl,UT=n(()=>{ke();hc();tl=class extends Wm{#e;#t;constructor(e,r,o=W,a=()=>Math.random()){super(e,r),this.#e=o,this.#t=a}perform(){let e=this.#e.getByPlayer(this.unit().player()),r=e.available(),o=r[Math.floor(r.length*this.#t())];e.addAdvance(o)}};t(tl,"Advance")});var uf,Lm,OR=n(()=>{M();uf=class extends h{};t(uf,"CanBeWorked");Lm=uf});var ff,yf,xR=n(()=>{M();ff=class extends h{};t(ff,"Created");yf=ff});var df,fa,jm=n(()=>{V();B();xR();df=class extends k{#e;constructor(e=f){super(),this.#e=e,this.#e.process(yf,this)}clone(){return new this.constructor(this.#e)}};t(df,"Terrain");fa=df});var J,DT=n(()=>{jm();J=class extends fa{};t(J,"Land")});var Or,RR=n(()=>{jm();Or=class extends fa{};t(Or,"Water")});var xr=n(()=>{DT();RR()});var gf,hf,vR=n(()=>{M();gf=class extends h{};t(gf,"YieldModifier");hf=gf});var Of,Li,bR=n(()=>{M();Of=class extends h{};t(Of,"Yield");Li=Of});var zm,ye,ji=n(()=>{V();xr();B();Oc();je();vR();bR();zm=class extends k{#e;#t=[];#r;#i;#o;#n;#a=new Map;constructor(e,r,o,a,s=f){super(),this.#o=e,this.#n=r,this.#i=o,this.#e=a,this.#r=s,this.addKey("terrain","isCoast","isLand","isWater","x","y","yields")}clearYieldCache(e=null){this.#a.delete(e)}getAdjacent(){return this.getAdjacentDirections().map(e=>this.getNeighbour(e))}getAdjacentDirections(){return["n","e","s","w"]}getNeighbour(e){return e==="n"?this.#e.get(this.#o,this.#n-1):e==="ne"?this.#e.get(this.#o+1,this.#n-1):e==="e"?this.#e.get(this.#o+1,this.#n):e==="se"?this.#e.get(this.#o+1,this.#n+1):e==="s"?this.#e.get(this.#o,this.#n+1):e==="sw"?this.#e.get(this.#o-1,this.#n+1):e==="w"?this.#e.get(this.#o-1,this.#n):this.#e.get(this.#o-1,this.#n-1)}getNeighbouringDirections(){return["n","ne","e","se","s","sw","w","nw"]}getNeighbours(){return this.#t.length||(this.#t=this.getNeighbouringDirections().map(e=>this.getNeighbour(e))),this.#t}getSurroundingArea(e=2){return Hm.fromSurrounding(this,e)}distanceFrom(e){let r=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[o]=r.map(([a,s])=>Math.hypot(this.#o-e.x()+a*this.#e.width(),this.#n-e.y()+s*this.#e.height())).sort((a,s)=>a-s);return o}isCoast(){let e=this;return e.isWater()&&e.getNeighbours().some(r=>r.isLand())||e.isLand()&&e.getNeighbours().some(r=>r.isWater())}isLand(){return this.#i instanceof J}isNeighbourOf(e){return this.getNeighbours().includes(e)}isWater(){return this.#i instanceof Or}map(){return this.#e}score(e=null,r=[[L,3]]){return this.yields(e).map(a=>{let[s]=r.filter(([c])=>a instanceof c),l=s?s[1]||1:0;return a.value()*l}).reduce((a,s)=>a+s,0)}terrain(){return this.#i}setTerrain(e){this.#i=e}x(){return this.#o}y(){return this.#n}yields(e=null){if(!this.#a.has(e)){let r=this.#r.process(Li,this,e).flat();this.#r.process(hf,this,e,r).flat(),this.#a.set(e,r)}return this.#a.get(e)}};t(zm,"Tile");ye=zm});var _m,Hm,Oc=n(()=>{ge();ji();_m=class extends Y{static from(...e){return new this(...e)}static fromSurrounding(e,r=2){let o=t(a=>{let s=[];for(let l=e.x()-a;l<=e.x()+a;l++)for(let c=e.y()-a;c<=e.y()+a;c++)s.push([l,c]);return s},"gen");return this.from(...o(r).map(([a,s])=>e.map().get(a,s)))}constructor(...e){super(zm),this.register(...e)}push(...e){this.register(...e)}shift(){let[e]=this.entries();return this.unregister(e),e}score(e=null,r=[]){return this.entries().reduce((o,a)=>o+a.score(e,r),0)}yields(e=null){return this.entries().flatMap(r=>r.yields(e))}};t(_m,"Tileset");Hm=_m});var xf,rl,Rf=n(()=>{V();xf=class extends he{#e;#t;constructor(e,r){super(),this.#e=r,this.#t=e,this.addKey("city","tile")}city(){return this.#e}tile(){return this.#t}};t(xf,"WorkedTile");rl=xf});var vf,Ge,Ri=n(()=>{B();OR();ge();Oc();Rf();vf=class extends Zs{#e;constructor(e=f){super(rl),this.#e=e}getByCity(e){return this.getBy("city",e)}getByTile(e){let[r]=this.getBy("tile",e);return r??null}getTilesByCity(e){return Hm.from(...this.filter(r=>r.city()===e).map(r=>r.tile()))}register(...e){e.forEach(r=>{let o=r.tile();if(this.getByTile(o)!==null)throw new TypeError(`Tile ${o.x()}, ${o.y()} is already worked!`);super.register(r)})}tileCanBeWorkedBy(e,r){return this.#e.process(Lm,e,r).every(o=>o)}tileIsWorked(e){return!!this.getByTile(e)}unregisterByTile(e){let r=this.getByTile(e);r!==null&&this.unregister(r)}};t(vf,"WorkedTileRegistry");Ge=new vf});var bf,Rr,Zl=n(()=>{M();bf=class extends h{};t(bf,"Captured");Rr=bf});var Cf,Tf,CR=n(()=>{M();Cf=class extends h{};t(Cf,"Tiles");Tf=Cf});var Pf,ut,Km=n(()=>{M();Pf=class extends h{};t(Pf,"Cost");ut=Pf});var If,pn,wf=n(()=>{M();If=class extends h{};t(If,"Created");pn=If});var Af,zr,Ql=n(()=>{M();Af=class extends h{};t(Af,"Destroyed");zr=Af});var qm,cn,Vm=n(()=>{M();qm=class extends h{};t(qm,"Yield");cn=qm});var Bf,Xl,Gf=n(()=>{M();Bf=class extends h{};t(Bf,"YieldModifier");Xl=Bf});var Mf,Xe,ya=n(()=>{V();B();Ri();Zl();CR();Km();wf();Ql();je();Vm();Gf();Mf=class extends k{#e=!1;#t;#r;#i;#o;#n;#a;#s;constructor(e,r,o,a=f,s=Ge){super(),this.#t=o,this.#r=e,this.#i=e,this.#n=r,this.#o=a,this.#s=s,[this.#a]=this.#o.process(Tf,this),this.#o.process(pn,this),this.addKey("destroyed","name","originalPlayer","player","tile","tiles","tilesWorked","yields")}capture(e){let r=this.#i;this.#i=e,this.#o.process(Rr,this,e,r)}destroy(e=null){this.#e=!0,this.#o.process(zr,this,e)}destroyed(){return this.#e}name(){return this.#t}setName(e){this.#t=e}originalPlayer(){return this.#r}player(){return this.#i}tile(){return this.#n}tiles(){return this.#a}tilesWorked(){return this.#s.getTilesByCity(this)}yields(){let e=[];return[this.#o.get(cn),this.#o.get(Xl),this.#o.get(ut)].flat().forEach(r=>{if(!r.validate(this,e))return;let o=r.process(this,e);if(!!o){if(o instanceof L){e.push(o);return}o.forEach(a=>e.push(a))}}),e}};t(Mf,"City");Xe=Mf});var Uf,K,et=n(()=>{ge();ya();Uf=class extends Y{constructor(){super(Xe)}getByPlayer(e,r=!1){return r?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){let[r]=this.filter(o=>o.tile()===e&&!o.destroyed());return r??null}};t(Uf,"CityRegistry");K=new Uf});var il,ET=n(()=>{et();B();hc();ya();il=class extends Wm{#e;constructor(e,r,o=K){super(e,r),this.#e=o}perform(e=f){let r=this.unit().player(),o=new Xe(r,this.goodyHut().tile(),r.civilization().getCityName(!0),e);this.#e.register(o)}};t(il,"City")});var Df,vo,em=n(()=>{ge();Df=class extends Y{constructor(){super(Function)}accepts(e){return"build"in e}};t(Df,"AvailableCityBuildItemsRegistry");vo=new Df});var ft,ST,Jm=n(()=>{U();M();ft=class extends h{process(e,r){let o=super.process(e,r);if(!(o instanceof Sm))throw new TypeError("Invalid build rule.");return o}};t(ft,"Build");ST=ft});var Ef,Sf,TR=n(()=>{V();Ef=class extends he{#e;constructor(e){super(),this.addKey("value"),this.#e=e}value(){return this.#e}};t(Ef,"BuildCost");Sf=Ef});var xc,kT,ol,xj,$m=n(()=>{TR();U();C();M();xc=class extends h{};t(xc,"BuildCost");kT=xc,ol=t((i,e)=>xj([[i,e]]),"buildCost"),xj=t(i=>i.map(([e,r])=>new xc(new m(o=>o.item()===e),new p(()=>new Sf(r)))),"buildCosts")});var kf,Ff,PR=n(()=>{B();TR();$m();V();kf=class extends he{#e;#t=new Sf(1/0);#r;#i;constructor(e,r=null,o=f){super(),this.#r=e,this.#e=r,this.#i=o,this.addKey("cost","item")}cost(){if(!Number.isFinite(this.#t.value())){let[e]=this.#i.process(kT,this,this.#e);e&&(this.#t=e)}return this.#t}item(){return this.#r}};t(kf,"BuildItem");Ff=kf});var tm,FT=n(()=>{je();tm=class extends L{};t(tm,"BuildProgress")});var YT=n(()=>{FT()});var Yf,NT,WT=n(()=>{M();Yf=class extends h{};t(Yf,"BuildingCancelled");NT=Yf});var Nf,zi,Zm=n(()=>{M();Nf=class extends h{};t(Nf,"BuildingComplete");zi=Nf});var Wf,nl,Rc=n(()=>{em();V();B();Jm();PR();YT();WT();Zm();Wf=class extends k{#e;#t=null;#r;#i=new tm(1/0);#o=new tm;#n;constructor(e,r=vo,o=f){super(),this.#e=r,this.#r=e,this.#n=o,this.addKey("available","building","city","cost","progress","remaining")}add(e){this.#o.add(e)}available(){let e=this.#n.get(ST);return this.#e.filter(r=>e.filter(o=>o.validate(this.city(),r)).every(o=>o.process(this.city(),r).validate())).map(r=>new Ff(r,this.city(),this.#n))}build(e){let r=this.getAvailable(e);if(!r)throw new TypeError(`Cannot build ${e.name}, it's not available.`);this.#t=r,this.#i.set(this.#t.cost().value())}building(){return this.#t}check(){if(this.#o.value()>=this.#i.value()&&this.#t){let e=this.#t.item().build(this.#r,this.#n);return this.#o.set(0),this.#t=null,this.#i.set(1/0),this.#n.process(zi,this,e),e}return null}city(){return this.#r}cost(){return this.#i}getAvailable(e){return this.available().filter(r=>r.item()===e)[0]}progress(){return this.#o}remaining(){return this.#i.value()-this.#o.value()}revalidate(){this.#t&&!this.getAvailable(this.#t.item())&&(this.#t=null,this.#i.set(1/0),this.#n.process(NT,this))}};t(Wf,"CityBuild");nl=Wf});var Lf,Kt,da=n(()=>{ge();Rc();Lf=class extends Y{constructor(){super(nl)}getByCity(e){let r=this.getBy("city",e);if(r.length!==1)throw new TypeError("Wrong number of entities returned.");return r[0]}};t(Lf,"CityBuildRegistry");Kt=new Lf});var jf,bo,vc=n(()=>{M();jf=class extends h{};t(jf,"Spend");bo=jf});var zf,LT,jT=n(()=>{M();zf=class extends h{};t(zf,"Rush");LT=zf});var Hf,_f,IR=n(()=>{da();B();V();vc();je();jT();Hf=class extends he{#e;#t;#r;#i=0;#o;constructor(e,r,o=Kt,a=f){super(),this.addKey("value","yield"),this.#e=o,this.#t=e,this.#r=a,this.#o=r}add(e){if(e instanceof L){this.add(e.value());return}this.#i+=e}buy(e){let r=this.#e.getByCity(e),[o]=this.cost(e).filter(s=>s.resource()===this.#o),a=o.value();e.player()!==this.#t||this.value()<a||(this.#r.process(LT,r,o),r.add(new L(r.remaining())),this.subtract(a))}cost(e){let r=this.#e.getByCity(e);return this.#r.process(bo,r)}player(){return this.#t}set(e){this.#i=0,this.add(e)}subtract(e){if(e instanceof L){this.add(e.value());return}this.#i-=e}value(){return this.#i}yield(){return this.#o}};t(Hf,"PlayerTreasury");_f=Hf});var Kf,Hi,rm=n(()=>{ge();IR();Kf=class extends Y{constructor(){super(_f)}getByPlayer(e){return this.getBy("player",e)}getByPlayerAndType(e,r){let o=this.filter(a=>a.player()===e&&a.yield()===r);if(o.length!==1)throw new TypeError(`Wrong number of playerTreasuries: ${o.length}`);return o[0]}};t(Kf,"PlayerTreasuryRegistry");Hi=new Kf});var ze,Co,al=n(()=>{je();ze=class extends L{};t(ze,"Gold");Co=ze});var sl,zT=n(()=>{rm();hc();al();sl=class extends Wm{#e;constructor(e,r,o=Hi){super(e,r),this.#e=o}perform(){this.#e.getByPlayerAndType(this.unit().player(),Co).add(new Co(50))}};t(sl,"Gold")});var qf,Vf,wR=n(()=>{M();qf=class extends h{};t(qf,"Unit");Vf=qf});var ll,HT=n(()=>{hc();B();wR();ll=class extends Nm{#e;#t;constructor(e,r,o=()=>Math.random(),a=f){super(e,r),this.#e=o,this.#t=a}perform(){this.#t.process(Vf,this.goodyHut(),this.unit())}};t(ll,"Unit")});var AR=n(()=>{UT();ET();zT();HT()});var ml,_T=n(()=>{pa();ml=class extends hr{};t(ml,"ChangeProduction")});var ga,KT=n(()=>{ql();ga=class extends Wi{};t(ga,"CityBuild")});var BR=n(()=>{_T();KT()});var Jf,qT,VT=n(()=>{V();Jf=class extends k{#e;constructor(e){super(),this.addKey("value"),this.#e=e}value(){return this.#e}};t(Jf,"Choice");qT=Jf});var pl,GR,$f=n(()=>{V();VT();pl=class extends k{#e=[];#t;#r;constructor(e,r,o){super(),this.addKey("choices","data","key"),e.forEach(a=>this.#e.push(new qT(a))),this.#t=o,this.#r=r}choices(){return this.#e}data(){return this.#t}key(){return this.#r}};t(pl,"ChoiceMeta");GR=pl});var cl,JT,Zf=n(()=>{cl=class{#e;#t;constructor(e,r=()=>Math.random()){this.#e=e,this.#t=r}async chooseFromList(e){let r=e.choices();return r[Math.floor(this.#t()*r.length)].value()}player(){return this.#e}async takeTurn(){throw new TypeError("Client#takeTurn must be implemented.")}};t(cl,"Client");JT=cl});var ul,$T=n(()=>{pa();ul=class extends hr{};t(ul,"AdjustTradeRates")});var MR=n(()=>{$T()});var Qf,Ee,Hr=n(()=>{M();Qf=class extends h{};t(Qf,"Busy");Ee=Qf});var im,ZT,UR=n(()=>{ql();im=class extends Wi{};t(im,"ChooseResearch");ZT=im});var Xf,ey,DR=n(()=>{M();Xf=class extends h{};t(Xf,"Cost");ey=Xf});var ha,ER,ty=n(()=>{je();ha=class extends L{};t(ha,"FoodStorage");ER=ha});var ry,bc,SR=n(()=>{M();ry=class extends h{};t(ry,"FoodStorage");bc=ry});var iy,Oa,oy=n(()=>{M();iy=class extends h{};t(iy,"Grow");Oa=iy});var ny,Qm,kR=n(()=>{M();ny=class extends h{};t(ny,"Shrink");Qm=ny});var ay,om,sy=n(()=>{V();B();DR();ty();SR();oy();kR();ay=class extends k{#e;#t=new ER(1/0);#r=new ER;#i;#o=1;constructor(e,r=f){super(),this.#e=e,this.#i=r,this.setCost(),this.addKey("cost","progress","size")}add(e){this.#r.add(e)}check(){this.#i.process(bc,this)}city(){return this.#e}cost(){return this.#t}setCost(){let e=this.#i.process(ey,this);e.length>0&&this.#t.set(e[0],"setCost")}empty(){this.#r.subtract(this.#r.value())}grow(){this.#o++,this.#i.process(Oa,this)}progress(){return this.#r}shrink(){this.#o--,this.#i.process(Qm,this)}size(){return this.#o}};t(ay,"CityGrowth");om=ay});var fl,QT,ly=n(()=>{V();B();fl=class extends k{static build(e,r=f){throw new TypeError("createFromObject: Must be overridden in extending class")}};t(fl,"Buildable");QT=fl});var my,Cc,FR=n(()=>{M();my=class extends h{};t(my,"Created");Cc=my});var py,z,He=n(()=>{ly();B();FR();py=class extends fl{#e;#t=!1;#r;constructor(e,r=f){super(),this.addKey("destroyed"),this.#e=e,this.#r=r,this.#r.process(Cc,this,e)}static build(e,r=f){return new this(e,r)}city(){return this.#e}destroy(){this.#t=!0}destroyed(){return this.#t}};t(py,"CityImprovement");z=py});var cy,we,vr=n(()=>{V();cy=class extends k{#e;#t;#r;constructor(e,r,o){super(),this.#e=e,this.#t=r,this.#r=o,this.addKey("name","value")}civilization(){return this.#e}name(){return this.#t}value(){return this.#r}};t(cy,"Attribute");we=cy});var Xm,Oe,ir=n(()=>{ge();vr();Xm=class extends Y{constructor(){super(we)}getByCivilization(e){return this.getBy("civilization",e)}getByName(e){return this.getBy("name",e)}};t(Xm,"AttributeRegistry");Oe=new Xm});var uy,se,or=n(()=>{uy=class{#e;#t;#r=!1;constructor(e,r,o=!1){this.#e=e,this.#t=r,this.#r=o}name(){return this.#e}civilization(){return this.#t}capital(){return this.#r}};t(uy,"CityName");se=uy});var fy,re,vt=n(()=>{ge();or();fy=class extends Y{#e=1;#t;constructor(e=()=>Math.random()){super(se),this.#t=e}takeByCivilization(e){let[r]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1);return r instanceof se?(this.unregister(r),r.name()):this.takeUnassociated()}takeCapitalByCivilization(e){let[r]=this.getBy("civilization",e).sort(()=>Math.floor(this.#t()*3)-1).filter(o=>o.capital());return r instanceof se?(this.unregister(r),r.name()):this.takeByCivilization(e)}takeUnassociated(){let[e]=this.getBy("civilization",null).sort(()=>Math.floor(this.#t()*3)-1);return e instanceof se?(this.unregister(e),e.name()):`City #${this.#e++}`}};t(fy,"CityNameRegistry");re=new fy});var yy,de,nr=n(()=>{ir();vt();V();yy=class extends k{#e=null;#t;#r=new Xm;constructor(e=Oe,r=re){super(),this.#t=r,this.#r.register(...e.getByCivilization(this.sourceClass())),this.addKey("name","leader","attributes")}attributes(){return this.#r.entries()}name(){return this.constructor.name}leader(){return this.#e}setLeader(e){this.#e=e}getCityName(e=!1){let r=this.sourceClass();return e?this.#t.takeCapitalByCivilization(r):this.#t.takeByCivilization(r)}};t(yy,"Civilization");de=yy});var yl,XT=n(()=>{pa();yl=class extends Em{};t(yl,"CompleteProduction")});var YR=n(()=>{XT()});var nm,gy,hy=n(()=>{ql();nm=class extends Wi{};t(nm,"EndTurn");gy=nm});var Oy,xy,NR=n(()=>{Oy=class{#e={};on(e,r){e in this.#e||(this.#e[e]=[]),this.#e[e].push(r)}once(e,r){let o=t((...a)=>{r(...a),this.off(e,o)},"onceHandler");this.on(e,o)}off(e,r){if(!(e in this.#e))return;let o=this.#e[e].indexOf(r);o!==-1&&this.#e[e].splice(o,1)}emit(e,...r){e in this.#e&&this.#e[e].forEach(o=>o(...r))}};t(Oy,"EventEmitter");xy=Oy});var te,un,am=n(()=>{je();te=class extends L{};t(te,"Food");un=te});var Q,_a,ep=n(()=>{je();Q=class extends L{};t(Q,"Production");_a=Q});var ce,Ka,qa=n(()=>{je();ce=class extends L{};t(ce,"Trade");Ka=ce});var Va=n(()=>{am();ep();qa()});var WR,Ry,vi,gl=n(()=>{je();WR=t(i=>i instanceof L?-i.value():-i,"negate"),Ry=class extends L{add(e,r=""){super.add(WR(e),r)}set(e,r=""){super.set(WR(e),r)}subtract(e,r=""){super.subtract(WR(e),r)}};t(Ry,"NegativeYield");vi=t(i=>{["add","set","subtract"].forEach(e=>Object.defineProperty(i.prototype,e,Object.getOwnPropertyDescriptor(Ry.prototype,e)||Object.create(null)))},"makeNegative")});var fn,vy=n(()=>{qa();gl();fn=class extends Ka{};t(fn,"Corruption");vi(fn)});var hl,by,Tc=n(()=>{je();hl=class extends L{};t(hl,"Happiness");by=hl});var _i,tP,Pc=n(()=>{je();_i=class extends L{};t(_i,"Luxuries");tP=_i});var tp,rP,LR=n(()=>{am();gl();tp=class extends un{};t(tp,"PopulationSupportFood");vi(tp);rP=tp});var ar,Cy=n(()=>{je();ar=class extends L{};t(ar,"Research")});var nt,xa,Ol=n(()=>{je();nt=class extends L{};t(nt,"Unhappiness");xa=nt});var xl,iP,jR=n(()=>{am();gl();xl=class extends un{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(xl,"UnitSupportFood");vi(xl);iP=xl});var Rl,zR,HR=n(()=>{ep();gl();Rl=class extends _a{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(Rl,"UnitSupportProduction");vi(Rl);zR=Rl});var Ja=n(()=>{Va();vy();ty();al();Tc();Pc();LR();Cy();qa();Ol();jR();HR()});var sm,oP,_R=n(()=>{pa();sm=class extends hr{};t(sm,"LaunchSpaceship");oP=sm});var To,nP=n(()=>{je();To=class extends L{};t(To,"Attack")});var Ki,aP=n(()=>{je();Ki=class extends L{};t(Ki,"Defence")});var Po,sP,KR=n(()=>{je();Po=class extends L{};t(Po,"Movement");sP=Po});var rp,lP=n(()=>{KR();rp=class extends sP{};t(rp,"Moves")});var vl,mP=n(()=>{je();vl=class extends L{};t(vl,"Visibility")});var ip=n(()=>{nP();aP();KR();lP();mP()});var yt,qR,qi,Ra,op,VR=n(()=>{U();C();M();yt=class extends h{};t(yt,"Action");qR=yt,qi=new m(i=>i.moves().value()>=.1),Ra=new m((i,e,r=i.tile())=>r===e),op=new m((i,e,r=i.tile())=>e.isNeighbourOf(r))});var Ty,np,JR=n(()=>{M();Ty=class extends h{};t(Ty,"Activate");np=Ty});var Py,$a,Iy=n(()=>{M();Py=class extends h{};t(Py,"Created");$a=Py});var wy,yn,Ic=n(()=>{M();wy=class extends h{};t(wy,"Destroyed");yn=wy});var Ay,By,$R=n(()=>{M();Ay=class extends h{};t(Ay,"Visibility");By=Ay});var bl,lm,wc,pP,ap=n(()=>{ip();U();C();M();bl=class extends h{};t(bl,"BaseYield");lm=class extends h{};t(lm,"Yield");wc=lm,pP=t((i,e=1,r=1,o=1,a=1)=>[...[[To,e],[Ki,r],[Po,o],[vl,a]].flatMap(([s,l])=>[new lm(new m(c=>c instanceof i),new m((c,u)=>u instanceof s),new p((c,u)=>u.set(l))),new bl(new m(c=>c===i),new m((c,u)=>u instanceof s),new p((c,u)=>u.set(l)))])],"unitYield")});var Gy,Fe,Za=n(()=>{ip();ly();B();VR();JR();Iy();Ic();$R();ap();Gy=class extends fl{#e=!0;#t=null;#r;#i=!1;#o=new rp;#n;#a;#s=null;#l;#m=!1;constructor(e,r,o,a=f){super(),this.#r=e,this.#n=r,this.#l=o,this.#a=a,this.addKey("actions","actionsForNeighbours","active","attack","busy","city","defence","destroyed","movement","moves","player","status","tile","visibility","waiting"),this.#a.process($a,this)}static build(e,r=f){return new this(e,e.player(),e.tile(),r)}action(e,...r){return e.perform(...r)}actions(e=this.#l,r=this.#l){return typeof e=="string"&&(e=r.getNeighbour(e)),this.#a.process(qR,this,e,r)}actionsForNeighbours(e=this.#l){return e.getNeighbouringDirections().reduce((r,o)=>({...r,[o]:this.#a.process(qR,this,e.getNeighbour(o),e)}),{})}activate(){this.#a.process(np,this)}active(){return this.#e}setActive(e=!0){this.#e=e}applyVisibility(){this.#l.getSurroundingArea(this.visibility().value()).forEach(e=>{this.#a.process(By,e,this.#n)})}attack(){let[e]=this.yield(new To);return e}busy(){return this.#t}setBusy(e=null){this.#t=e}city(){return this.#r}defence(){let[e]=this.yield(new Ki);return e}destroy(e=null){this.#a.process(yn,this,e)}destroyed(){return this.#i}setDestroyed(){this.#i=!0}movement(){let[e]=this.yield(new Po);return e}moves(){return this.#o}player(){return this.#n}status(){return this.#s}setStatus(e){this.#s=e}tile(){return this.#l}setTile(e){this.#l=e}visibility(){let[e]=this.yield(new vl);return e}waiting(){return this.#m}setWaiting(e=!0){this.#m=e}yield(...e){let r=this.#a.get(wc);return e.forEach(o=>r.filter(a=>a.validate(this,o)).forEach(a=>a.process(this,o))),e}};t(Gy,"Unit");Fe=Gy});var My,j,Ke=n(()=>{ge();Za();My=class extends Y{constructor(){super(Fe)}getByCity(e){return this.filter(r=>r.city()===e&&!r.destroyed())}getByPlayer(e,r=!1){return r?this.getBy("player",e):this.filter(o=>o.player()===e&&!o.destroyed())}getByTile(e){return this.filter(r=>r.tile()===e&&!r.destroyed())}};t(My,"UnitRegistry");j=new My});var va,Cl,Tl=n(()=>{B();V();va=class extends k{#e;#t;#r;#i;constructor(e,r,o,a=f){super(),this.#e=e,this.#t=a,this.#r=r,this.#i=o,this.addKey("from","to")}forUnit(e){return new this.constructor(this.#e,this.#r,e,this.#t)}from(){return this.#e}perform(...e){}ruleRegistry(){return this.#t}to(){return this.#r}unit(){return this.#i}};t(va,"Action");Cl=va});var Uy,dn,Ac=n(()=>{M();Uy=class extends h{};t(Uy,"Defeated");dn=Uy});var Vi,ZR=n(()=>{B();Ke();Tl();Ac();Vi=class extends Cl{#e;#t;constructor(e,r,o,a=f,s=j,l=()=>Math.random()){super(e,r,o,a),this.#t=s,this.#e=l}perform(){let[e]=this.#t.getByTile(this.to()).sort((o,a)=>a.defence().value()-o.defence().value()),r=Math.min(1,this.unit().moves().value());if(this.unit().attack().value()*r*this.#e()>=e.defence().value()*this.#e()){this.ruleRegistry().process(dn,e,this.unit(),this),this.unit().moves().subtract(r,this.constructor.name);return}this.ruleRegistry().process(dn,this.unit(),e,this)}};t(Vi,"Attack")});var cP=n(()=>{ZR();ZR()});var Dy,uP,fP=n(()=>{Hr();Dy=class extends Ee{};t(Dy,"BuildingIrrigation");uP=Dy});var Pl,$,at=n(()=>{V();Pl=class extends k{#e=0;constructor(){super(),this.addKey("value")}increment(){return this.#e++,this.#e}value(){return this.#e}};t(Pl,"Turn");$=new Pl});var Ey,Z,Dt=n(()=>{M();Ey=class extends h{};t(Ey,"Moved");Z=Ey});var Sy,st,Io=n(()=>{Tl();B();at();Hr();U();C();Dt();Sy=class extends va{#e;constructor(e,r,o,a=f,s=$){super(e,r,o,a),this.#e=s}perform(e,r=()=>{},o=Ee){let a=this.#e.value()+e;this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new o(new m(()=>this.#e.value()===a),new p((...s)=>{let l=this.unit();l.setActive(),l.setBusy(),r(...s),this.ruleRegistry().process(Z,this.unit(),this)})))}};t(Sy,"DelayedAction");st=Sy});var ky,Qa,Fy=n(()=>{M();ky=class extends h{};t(ky,"Built");Qa=ky});var Yy,gn,mm=n(()=>{V();B();Fy();Yy=class extends k{#e;constructor(e,r=f){super(),this.#e=e,r.process(Qa,e,this)}tile(){return this.#e}};t(Yy,"TileImprovement");gn=Yy});var Ye,yP,QR=n(()=>{mm();Ye=class extends gn{};t(Ye,"Irrigation");yP=Ye});var Ny,Me,Ji=n(()=>{M();Ny=class extends h{};t(Ny,"MovementCost");Me=Ny});var hn,XR=n(()=>{fP();Io();QR();Dt();Ji();hn=class extends st{perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new yP(this.unit().tile())},uP),this.ruleRegistry().process(Z,this.unit(),this)}};t(hn,"BuildIrrigation")});var dP=n(()=>{XR();XR()});var Wy,gP,hP=n(()=>{Hr();Wy=class extends Ee{};t(Wy,"BuildingMine");gP=Wy});var lt,OP,ev=n(()=>{mm();lt=class extends gn{};t(lt,"Mine");OP=lt});var On,tv=n(()=>{hP();Io();ev();Dt();Ji();On=class extends st{perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new OP(this.unit().tile())},gP),this.ruleRegistry().process(Z,this.unit(),this)}};t(On,"BuildMine")});var xP=n(()=>{tv();tv()});var Ly,RP,vP=n(()=>{Hr();Ly=class extends Ee{};t(Ly,"BuildingRailroad");RP=Ly});var br,bP,rv=n(()=>{mm();br=class extends gn{};t(br,"Railroad");bP=br});var xn,iv=n(()=>{vP();Io();Dt();Ji();rv();xn=class extends st{perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new bP(this.unit().tile())},RP),this.ruleRegistry().process(Z,this.unit(),this)}};t(xn,"BuildRailroad")});var CP=n(()=>{iv();iv()});var jy,TP,PP=n(()=>{Hr();jy=class extends Ee{};t(jy,"BuildingRoad");TP=jy});var qe,IP,ov=n(()=>{mm();qe=class extends gn{};t(qe,"Road");IP=qe});var Rn,nv=n(()=>{PP();Io();Dt();Ji();ov();Rn=class extends st{perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e||0,()=>{new IP(this.unit().tile())},TP),this.ruleRegistry().process(Z,this.unit(),this)}};t(Rn,"BuildRoad")});var wP=n(()=>{nv();nv()});var zy,Bc,av=n(()=>{M();zy=class extends h{};t(zy,"ValidateMove");Bc=zy});var mt,sp,lp=n(()=>{Tl();Dt();Ji();av();mt=class extends va{perform(){return this.validate()?(this.unit().setTile(this.to()),this.ruleRegistry().process(Z,this.unit(),this),!0):!1}movementCost(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>r-o);return e}validate(){let[e]=this.ruleRegistry().process(Bc,this.unit(),this.movementCost());return e}};t(mt,"Move");sp=mt});var vn,sv=n(()=>{B();lp();vn=class extends sp{#e;constructor(e,r,o,a,s=f){super(e,r,o,s),this.#e=a}perform(){return super.perform()?(this.#e.capture(this.unit().player()),!0):!1}};t(vn,"CaptureCity")});var AP=n(()=>{sv();sv()});var Hy,tt,$i=n(()=>{V();Hy=class extends he{#e;constructor(e){super(),this.#e=e}clone(e=this.terrain()){return new this.constructor(e)}terrain(){return this.#e}};t(Hy,"TerrainFeature");tt=Hy});var lv,_y,bt,bn=n(()=>{ge();$i();lv=new Map,_y=class extends Y{constructor(){super(tt)}getByTerrain(e){return lv.has(e)||lv.set(e,this.getBy("terrain",e)),lv.get(e)}};t(_y,"TerrainFeatureRegistry");bt=new _y});var Ky,BP,GP=n(()=>{Hr();Ky=class extends Ee{};t(Ky,"ClearingForest");BP=Ky});var ue,mp,Gc=n(()=>{xr();ue=class extends J{};t(ue,"Plains");mp=ue});var Cn,mv=n(()=>{B();bn();at();GP();Io();Dt();Ji();Gc();Cn=class extends st{#e;constructor(e,r,o,a=f,s=bt,l=$){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new mp,o=this.#e.getByTerrain(this.from().terrain());this.#e.register(...o.map(a=>a.clone(r))),this.#e.unregister(...o),this.from().setTerrain(r)},BP),this.ruleRegistry().process(Z,this.unit(),this)}};t(Cn,"ClearForest")});var MP=n(()=>{mv();mv()});var qy,UP,DP=n(()=>{Hr();qy=class extends Ee{};t(qy,"ClearingJungle");UP=qy});var Mc,Il,EP,pp=n(()=>{bn();U();C();M();Mc=class extends h{};t(Mc,"Feature");Il=Mc,EP=t((i,e,r=.2,o=bt,a=()=>Math.random())=>[new Mc(new m(s=>s===e),new m((s,l)=>l instanceof i),new m(()=>a()<=r),new p((s,l)=>o.register(new s(l))))],"feature")});var Re,wl,cp=n(()=>{xr();Re=class extends J{};t(Re,"Grassland");wl=Re});var Tn,Vy,Jy=n(()=>{$i();Tn=class extends tt{};t(Tn,"Shield");Vy=Tn});var Pn,pv=n(()=>{B();bn();at();DP();Io();pp();cp();Dt();Ji();Jy();Pn=class extends st{#e;constructor(e,r,o,a=f,s=bt,l=$){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new wl,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(Il,Vy,r),this.#e.unregister(...o),this.from().setTerrain(r)},UP),this.ruleRegistry().process(Z,this.unit(),this)}};t(Pn,"ClearJungle")});var SP=n(()=>{pv();pv()});var $y,kP,FP=n(()=>{Hr();$y=class extends Ee{};t($y,"ClearingSwamp");kP=$y});var In,cv=n(()=>{B();bn();at();FP();Io();pp();cp();Dt();Ji();Jy();In=class extends st{#e;constructor(e,r,o,a=f,s=bt,l=$){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new wl,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(Il,Vy,r),this.#e.unregister(...o),this.from().setTerrain(r)},kP),this.ruleRegistry().process(Z,this.unit(),this)}};t(In,"ClearSwamp")});var YP=n(()=>{cv();cv()});var Xa,uv=n(()=>{Tl();Xa=class extends Cl{perform(){this.unit().destroy()}};t(Xa,"Disband")});var NP=n(()=>{uv();uv()});var wn,fv=n(()=>{B();lp();wn=class extends sp{#e;constructor(e,r,o,a,s=f){super(e,r,o,s),this.#e=a}perform(){return super.perform()?(this.unit().moves().set(0),this.#e.unload(this.unit()),!0):!1}};t(wn,"Disembark")});var WP=n(()=>{fv();fv()});var es,yv=n(()=>{B();Hr();U();lp();Dt();es=class extends sp{#e;constructor(e,r,o,a,s=f){super(e,r,o,s),this.#e=a}perform(){return super.perform()?(this.#e.stow(this.unit()),this.unit().setBusy(new Ee(new m(()=>!1))),this.unit().setActive(!1),this.ruleRegistry().process(Z,this.unit(),this),!0):!1}};t(es,"Embark")});var LP=n(()=>{yv();yv()});var Zy,up,Qy=n(()=>{V();Zy=class extends he{#e;constructor(e){super(),this.#e=e}unit(){return this.#e}};t(Zy,"UnitImprovement");up=Zy});var Xy,Cr,ts=n(()=>{ge();Qy();Xy=class extends Y{constructor(){super(up)}getByUnit(e){return this.getBy("unit",e)}};t(Xy,"UnitImprovementRegistry");Cr=new Xy});var ed,jP,zP=n(()=>{Hr();ed=class extends Ee{};t(ed,"Fortified");jP=ed});var _r,HP,td=n(()=>{Qy();_r=class extends up{};t(_r,"Fortified");HP=_r});var rd,_P,KP=n(()=>{Hr();rd=class extends Ee{};t(rd,"Fortifying");_P=rd});var An,dv=n(()=>{B();at();ts();zP();U();Io();td();KP();Dt();Ji();An=class extends st{#e;constructor(e,r,o,a=f,s=$,l=Cr){super(e,r,o,a,s),this.#e=l}perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{this.unit().moves().set(0),this.unit().setActive(!1),this.unit().setBusy(new jP(new m(()=>!1))),this.#e.register(new HP(this.unit()))},_P),this.ruleRegistry().process(Z,this.unit(),this)}};t(An,"Fortify")});var qP=n(()=>{dv();dv()});var rs,gv=n(()=>{vt();B();Ri();Tl();ya();Dt();rs=class extends Cl{#e;#t;constructor(e,r,o,a=re,s=f,l=Ge){super(e,r,o,s),this.#e=a,this.#t=l}perform(){new Xe(this.unit().player(),this.unit().tile(),this.#e.takeCapitalByCivilization(this.unit().player().civilization().constructor),this.ruleRegistry(),this.#t),this.unit().destroy(),this.ruleRegistry().process(Z,this.unit(),this)}};t(rs,"FoundCity")});var VP=n(()=>{gv();gv()});var JP=n(()=>{lp();lp()});var Bn,hv=n(()=>{Tl();Bn=class extends va{perform(){this.unit().moves().subtract(this.unit().moves())}};t(Bn,"NoOrders")});var $P=n(()=>{hv();hv()});var id,_e,bi=n(()=>{ge();mm();id=class extends Y{constructor(){super(gn)}getByTile(e){return this.getBy("tile",e)}};t(id,"TileImprovementRegistry");_e=new id});var Gn,Ov=n(()=>{B();bi();at();Io();Dt();Ji();Gn=class extends st{#e;constructor(e,r,o,a=f,s=_e,l=$){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let[r]=this.#e.getByTile(this.from());this.#e.unregister(r)}),this.ruleRegistry().process(Z,this.unit(),this)}};t(Gn,"Pillage")});var ZP=n(()=>{Ov();Ov()});var rt,od,nd=n(()=>{xr();rt=class extends J{};t(rt,"Forest");od=rt});var wo,QP,xv=n(()=>{$i();wo=class extends tt{};t(wo,"Horse");QP=wo});var ad,XP,eI=n(()=>{Hr();ad=class extends Ee{};t(ad,"PlantingForest");XP=ad});var Mn,Rv=n(()=>{B();bn();at();Io();pp();nd();xv();Dt();Ji();eI();Mn=class extends st{#e;constructor(e,r,o,a=f,s=bt,l=$){super(e,r,o,a,l),this.#e=s}perform(){let[e]=this.ruleRegistry().process(Me,this.unit(),this).sort((r,o)=>o-r);super.perform(e,()=>{let r=new od,o=this.#e.getByTerrain(this.from().terrain());this.ruleRegistry().process(Il,QP,r),this.#e.unregister(...o),this.from().setTerrain(r)},XP),this.ruleRegistry().process(Z,this.unit(),this)}};t(Mn,"PlantForest")});var tI=n(()=>{Rv();Rv()});var sd,rI,iI=n(()=>{Hr();sd=class extends Ee{};t(sd,"Sleeping");rI=sd});var Ao,oI,ld=n(()=>{B();at();Ke();U();Io();C();iI();Ao=class extends st{#e;constructor(e,r,o,a=f,s=$,l=j){super(e,r,o,a,s),this.#e=l}perform(){this.unit().setActive(!1),this.unit().moves().set(0),this.unit().setBusy(new rI(new m(()=>this.from().getSurroundingArea(this.unit().visibility().value()).some(e=>this.#e.getByTile(e).some(r=>r.player()!==this.unit().player()))),new p(()=>{this.unit().setActive(),this.unit().setBusy()})))}};t(Ao,"Sleep");oI=Ao});var nI=n(()=>{ld();ld()});var Un,aI=n(()=>{B();Ke();md();Un=class extends Vi{#e;constructor(e,r,o,a,s=f,l=j){super(e,r,o,s,l),this.#e=a,this.addKey("enemy")}enemy(){return this.#e}};t(Un,"SneakAttack")});var is,sI=n(()=>{B();md();is=class extends vn{#e;constructor(e,r,o,a,s,l=f){super(e,r,o,a,l),this.#e=s,this.addKey("enemy")}enemy(){return this.#e}};t(is,"SneakCaptureCity")});var os,vv=n(()=>{Tl();os=class extends Cl{perform(){this.unit().setWaiting(),this.unit().cargo().forEach(e=>{e.moves().set(e.movement()),e.activate()})}};t(os,"Unload")});var lI=n(()=>{vv();vv()});var md=n(()=>{cP();dP();xP();CP();wP();AP();MP();SP();YP();NP();WP();LP();qP();VP();JP();$P();ZP();tI();nI();aI();sI();lI()});var pm=n(()=>{md()});var pd,it,Dn=n(()=>{M();pd=class extends h{};t(pd,"Action");it=pd});var cd,Zi,cm=n(()=>{M();cd=class extends h{};t(cd,"Added");Zi=cd});var ud,bv,mI=n(()=>{pa();ud=class extends hr{};t(ud,"HiddenPlayerAction");bv=ud});var fd,H,Kr=n(()=>{V();B();Dn();cm();mI();ql();fd=class extends k{#e=null;#t;constructor(e=f){super(),this.#t=e,this.#t.process(Zi,this),this.addKey("actions","civilization","mandatoryActions")}action(){let[e]=this.actions();return e}actions(){return this.#t.process(it,this).flat().filter(e=>!(e instanceof bv))}civilization(){if(this.#e===null)throw new TypeError("Player#civilization is unset.");return this.#e}hasActions(){return!!this.action()}hasMandatoryActions(){return this.actions().some(e=>e instanceof Wi)}hiddenActions(){return this.#t.process(it,this).flat().filter(e=>e instanceof bv)}mandatoryAction(){let[e]=this.mandatoryActions();return e}mandatoryActions(){return this.actions().filter(e=>e instanceof Wi)}setCivilization(e){this.#e=e}};t(fd,"Player");H=fd});var yd,fp,Cv=n(()=>{Ut();V();ji();yd=class extends k{#e={};#t;#r;#i;constructor(e,r,o=ne){super(),this.#t=o,this.#r=r,this.#i=e,this.addKey("isCoast","isLand","isWater","terrain","x","y","yields"),this.setAdditionalData()}addKey(...e){super.addKey(...e)}isCoast(){return this.#i.isCoast()}isLand(){return this.#i.isLand()}isWater(){return this.#i.isWater()}player(){return this.#r}setAdditionalData(){this.#t.getByType(ye).forEach(e=>{this.#e[e.key()]=e.data(this.#i),Object.defineProperty(this,e.key(),{configurable:!0,value:()=>e.data(this.#i)}),this.addKey(e.key())})}terrain(){return this.#i.terrain()}tile(){return this.#i}update(){this.#i.clearYieldCache(this.#r),this.setAdditionalData()}x(){return this.#i.x()}y(){return this.#i.y()}yields(){return this.#i.yields(this.#r)}};t(yd,"PlayerTile");fp=yd});var dd,pI,cI=n(()=>{jm();dd=class extends fa{};t(dd,"Unknown");pI=dd});var gd,uI,fI=n(()=>{ji();cI();gd=class extends ye{constructor(e,r,o){super(e,r,new pI,o)}};t(gd,"UndiscoveredTile");uI=gd});var hd,Od,Tv=n(()=>{M();hd=class extends h{};t(hd,"VisibilityChanged");Od=hd});var xd,yp,Rd=n(()=>{V();B();Cv();ji();fI();Tv();xd=class extends k{#e;#t;#r=[];#i;constructor(e,r,o=f){super(),this.#e=e,this.#i=r,this.#t=o,this.addKey("height","tiles","width")}entries(){return this.#r}filter(e){return this.entries().filter(e)}forEach(e){return this.#r.forEach(e)}get(e,r){let[o]=this.entries().filter(a=>a.x()===e&&a.y()===r);return o||new uI(e,r,this.#i)}getByTile(e){let[r]=this.filter(o=>o.tile()===e);return r??null}height(){return this.#i.height()}includes(e){return e instanceof ye?!!this.getByTile(e):this.#r.includes(e)}map(e){return this.#r.map(e)}player(){return this.#e}register(...e){e.forEach(r=>{this.includes(r)||(this.#r.push(new fp(r,this.#e)),this.#t.process(Od,r,this.player()))})}tiles(){return this.entries()}width(){return this.#i.width()}};t(xd,"PlayerWorld");yp=xd});var Al,gI=n(()=>{pa();Al=class extends hr{};t(Al,"Revolution")});var Pv=n(()=>{gI()});var Td,ie,Et=n(()=>{ge();sy();Td=class extends Y{constructor(){super(om)}getByCity(e){let r=this.getBy("city",e);if(r.length!==1)throw new TypeError("Wrong number of CityGrowths returned.");return r[0]}};t(Td,"CityGrowthRegistry");ie=new Td});var Ae,ve,Se=n(()=>{He();Ae=class extends z{};t(Ae,"Wonder");ve=Ae});var Ad,Tr,ns=n(()=>{ge();Zf();Ad=class extends Y{constructor(){super(JT)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of Clients for Player.");return r[0]}};t(Ad,"ClientRegistry");Tr=new Ad});var hp,Qi,Bl=n(()=>{ge();Kr();hp=class extends Y{constructor(){super(H)}};t(hp,"PlayerRegistry");Qi=new hp});var Bd,En,Op=n(()=>{Bl();Bd=class extends hp{};t(Bd,"CurrentPlayerRegistry");En=new Bd});var Gd,P,X=n(()=>{NR();Gd=class extends xy{#e={};#t=!1;debug(e){if(!!this.option("debug"))return e()}emit(e,...r){return this.debug(()=>console.log(`Engine#emit: ${String(e)}: ${r}`)),super.emit(e,...r)}loadPlugins(){return this.emit("plugins:load:start"),new Promise((e,r)=>{this.once("plugins:load:end",()=>e())})}option(e,r=null){return this.#e[e]||r}setOption(e,r){this.#e[e]!==r&&(this.#e[e]=r,this.emit("option:changed",e,r))}start(){this.#t||(this.#t=!0,this.emit("engine:initialise"),this.loadPlugins().then(()=>{this.emit("engine:start")}))}};t(Gd,"Engine");P=new Gd});var Md,vI,bI=n(()=>{M();Md=class extends h{};t(Md,"Created");vI=Md});var Bo,CI,xp=n(()=>{V();B();Kr();bI();at();Bo=class extends k{#e=new Set;#t=f;#r=$;#i;constructor(...e){super(),e.forEach(r=>{r instanceof H&&this.#e.add(r),r instanceof Jl&&(this.#t=r),r instanceof Pl&&(this.#r=r)}),this.#i=this.#r.value(),this.addKey("players"),this.#t.process(vI,this)}isBetween(...e){let r=Array.from(new Set(e));return r.every(o=>this.#e.has(o))&&r.length===this.#e.size}players(){return Array.from(this.#e)}ruleRegistry(){return this.#t}when(){return this.#i}};t(Bo,"Interaction");CI=Bo});var Ud,sr,as=n(()=>{ge();xp();Ud=class extends Y{constructor(){super(Bo)}getByPlayer(e){return this.entries().filter(r=>r.players().includes(e))}getByPlayers(...e){return this.entries().filter(r=>r.isBetween(...e))}};t(Ud,"InteractionRegistry");sr=new Ud});var Dd,oe,Ci=n(()=>{ge();Rd();Dd=class extends Y{constructor(){super(yp)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError(`Wrong number of player worlds exist for player: ${e.id()}`);return r[0]}};t(Dd,"PlayerWorldRegistry");oe=new Dd});var Ed,Gl,Bv=n(()=>{M();Ed=class extends h{};t(Ed,"Year");Gl=Ed});var Sd,Rp,Gv=n(()=>{V();B();at();Bv();Sd=class extends k{#e=new Map;#t;#r;constructor(e=$,r=f){super(),this.#t=r,this.#r=e,this.addKey("value")}value(e=this.#r.value()){if(!this.#e.has(e)){let[o]=this.#t.process(Gl,e);this.#e.set(e,o)}let r=this.#e.get(e);if(typeof r!="number")throw new TypeError("Invalid cache result.");return r}};t(Sd,"Year");Rp=new Sd});var um,Ve,Go=n(()=>{um=t((i,...e)=>i.reduce((r,o)=>{let a=e.findIndex(s=>o instanceof s);return a===-1||(r[a]+=o.value()),r},e.map(()=>0)),"reduceYields"),Ve=t((i,e)=>um(i,e).shift()??0,"reduceYield")});var Rj,TI,PI,kd,II,wI,Fd,vp,Ml=n(()=>{Et();Va();Ci();Ri();Go();Rf();Rj=t(i=>TI(i.tiles().entries(),i),"getHighestValueCityTiles"),TI=t((i,e,r=[[te,8],[Q,3*(Ve(e.tilesWorked().yields(e.player()),Q)===0?3:1)],[ce,1*(Ve(e.tilesWorked().yields(e.player()),ce)===0?2:1)]])=>i.sort((o,a)=>a.score(e.player(),r)-o.score(e.player(),r)),"sortTiles"),PI=t((i,e=oe,r=Ge)=>Rj(i).filter(o=>r.tileCanBeWorkedBy(o,i)&&e.getByPlayer(i.player()).includes(o)),"getHighestValueAvailableCityTiles"),kd=t((i,e=oe,r=ie,o=Ge)=>{o.getBy("city",i).forEach(a=>o.unregister(a)),o.register(new rl(i.tile(),i)),II(i,e,r,o)},"reassignWorkers"),II=t((i,e=oe,r=ie,o=Ge)=>{let a=r.getByCity(i);PI(i,e,o).some(s=>i.tilesWorked().length>=a.size()+1?!0:(o.register(new rl(s,i)),!1))},"assignWorkers"),wI=t((i,e=oe,r=ie,o=Ge)=>{let[a]=PI(i,e,o);o.register(new rl(a,i))},"assignWorker"),Fd=t((i,e)=>TI(i.tilesWorked().entries().filter(r=>r!==i.tile()),i).slice(e.size()),"reduceWorkers"),vp=II});var Ul,AI,Yd=n(()=>{xp();B();Ul=class extends Bo{#e;#t;constructor(e,r,o=f){super(...r.players(),o),this.#e=e,this.#t=r,this.addKey("by","for","negotiation")}by(){return this.#e}for(){return this.players().filter(e=>e!==this.#e)}negotiation(){return this.#t}};t(Ul,"Action");AI=Ul});var Nd,Mo,fm=n(()=>{Yd();B();Nd=class extends Ul{#e;constructor(e,r,o=f){super(e,r.negotiation(),o),this.#e=r,this.addKey("proposal")}proposal(){return this.#e}};t(Nd,"Resolution");Mo=Nd});var Wd,Ld,Mv=n(()=>{M();Wd=class extends h{};t(Wd,"Interaction");Ld=Wd});var jd,bp,zd=n(()=>{M();jd=class extends h{};t(jd,"Step");bp=jd});var Hd,Dl,_d=n(()=>{Yd();Hd=class extends AI{};t(Hd,"Terminate");Dl=Hd});var Kd,BI,GI=n(()=>{Kd=class extends Error{};t(Kd,"Terminated");BI=Kd});var qd,Uv,MI=n(()=>{qd=class extends Error{};t(qd,"Unsupported");Uv=qd});var Vd,Cp,Dv=n(()=>{xp();Mv();Kr();zd();_d();GI();MI();Vd=class extends Bo{#e=[];constructor(...e){if(e.filter(o=>o instanceof H).length!==2)throw new Uv;super(...e);let[r]=e.filter(o=>o instanceof H);if(!r)throw new Uv("Not enough `Player`s for `Negotiation`.");this.addKey("interactions","lastInteraction","terminated")}interactions(){return this.#e}lastInteraction(){return this.#e.length===0?null:this.#e[this.#e.length-1]}nextSteps(){let e=this.ruleRegistry().process(bp,this);return e.length===0&&e.push(new Dl(this.players()[0],this,this.ruleRegistry())),e}proceed(e){if(this.terminated())throw new BI;this.#e.push(e),this.ruleRegistry().process(Ld,e,this)}terminated(){return this.#e.some(e=>e instanceof Dl)}};t(Vd,"Negotiation");Cp=Vd});var Jd,Tp,Ev=n(()=>{M();Jd=class extends h{};t(Jd,"Resolved");Tp=Jd});var Pp,Ip,Vc=n(()=>{Yd();B();zd();Ev();Pp=class extends Ul{#e=null;constructor(e,r,o=f){super(e,r,o),this.addKey("resolution","resolved")}choices(){return this.ruleRegistry().process(bp,this.negotiation())}resolution(){return this.#e}resolve(e){this.#e=e,this.ruleRegistry().process(Tp,e,this)}resolved(){return this.#e!==null}};t(Pp,"Proposal");Ip=Pp});var $d,Uo,Jc=n(()=>{Vc();$d=class extends Ip{};t($d,"Initiate");Uo=$d});var qt,SI,Yv=n(()=>{xr();qt=class extends J{};t(qt,"Arctic");SI=qt});var Ue,kI,Nv=n(()=>{xr();Ue=class extends J{};t(Ue,"Desert");kI=Ue});var Ne,FI,Wv=n(()=>{xr();Ne=class extends J{};t(Ne,"Hills");FI=Ne});var pt,YI,Lv=n(()=>{xr();pt=class extends J{};t(pt,"Jungle");YI=pt});var $e,NI,jv=n(()=>{xr();$e=class extends J{};t($e,"Mountains");NI=$e});var dt,WI,zv=n(()=>{RR();dt=class extends Or{};t(dt,"Ocean");WI=dt});var me,eg,tg=n(()=>{xr();me=class extends J{};t(me,"River");eg=me});var ct,LI,Hv=n(()=>{xr();ct=class extends J{};t(ct,"Swamp");LI=ct});var Ct,jI,_v=n(()=>{xr();Ct=class extends J{};t(Ct,"Tundra");jI=Ct});var Eo=n(()=>{Yv();Nv();nd();cp();Wv();Lv();jv();zv();Gc();tg();Hv();_v()});var gt,El,dm=n(()=>{Za();gt=class extends Fe{};t(gt,"Air");El=gt});var zI=n(()=>{dm();dm()});var Ze,rg,Zc=n(()=>{Za();Ze=class extends Fe{};t(Ze,"Land");rg=Ze});var _,Vt=n(()=>{Zc();_=class extends rg{};t(_,"Fortifiable")});var HI=n(()=>{Vt();Vt()});var _I=n(()=>{Zc();Zc()});var We,ba,Sl=n(()=>{Za();We=class extends Fe{};t(We,"Naval");ba=We});var KI=n(()=>{Sl();Sl()});var ig,og,Kv=n(()=>{ig=class{#e;#t;constructor(e,r){this.#e=e,this.#t=r}transport(){return this.#e}unit(){return this.#t}};t(ig,"TransportManifest");og=ig});var ng,Ca,wp=n(()=>{ge();Kv();ng=class extends Y{constructor(){super(og)}getByTransport(e){return this.getBy("transport",e)}getByUnit(e){let r=this.getBy("unit",e);if(r.length!==1)throw new TypeError("Wrong number of results.");return r[0]}};t(ng,"TransportRegistry");Ca=new ng});var ag,sg,qv=n(()=>{M();ag=class extends h{};t(ag,"Stowed");sg=ag});var lg,qI,VI=n(()=>{M();lg=class extends h{};t(lg,"Unloaded");qI=lg});var mg,JI,pg=n(()=>{B();wp();qv();Kv();VI();mg=t(i=>t(class extends i{#e=f;#t=Ca;canStow(r){return!this.cargo().includes(r)&&this.hasCapacity()}capacity(){return 0}cargo(){return this.#t.getByTransport(this).map(r=>r.unit())}hasCapacity(){return this.#t.getByTransport(this).length<this.capacity()}hasCargo(){return this.#t.getByTransport(this).length>0}setRuleRegistry(r){this.#e=r}setTransportRegistry(r){this.#t=r}stow(r){return!this.hasCapacity()||!this.canStow(r)?!1:(this.#t.register(new og(this,r)),this.#e.process(sg,r,this),!0)}unload(r){try{let o=this.#t.getByUnit(r);return this.#t.unregister(o),this.#e.process(qI,r,this),!0}catch{return!1}}},"Transport"),"Transport"),JI=mg});var Tt,Ta,kl=n(()=>{B();wp();Sl();pg();Tt=class extends JI(ba){constructor(e,r,o,a=f,s=Ca){super(e,r,o,a),this.setRuleRegistry(a),this.setTransportRegistry(s)}};t(Tt,"NavalTransport");Ta=Tt});var $I=n(()=>{kl();kl()});var ZI=n(()=>{pg();pg()});var Jt,cg=n(()=>{Zc();Jt=class extends rg{};t(Jt,"Worker")});var QI=n(()=>{cg();cg()});var XI=n(()=>{zI();HI();_I();KI();$I();ZI();QI()});var Pa=n(()=>{XI()});var Sn,ew=n(()=>{$i();Sn=class extends tt{};t(Sn,"Coal")});var kn,tw=n(()=>{$i();kn=class extends tt{};t(kn,"Fish")});var Xi,rw=n(()=>{$i();Xi=class extends tt{};t(Xi,"Game")});var Fn,iw=n(()=>{$i();Fn=class extends tt{};t(Fn,"Gems")});var Yn,ow=n(()=>{$i();Yn=class extends tt{};t(Yn,"Gold")});var eo,nw=n(()=>{$i();eo=class extends tt{};t(eo,"Oasis")});var Nn,aw=n(()=>{$i();Nn=class extends tt{};t(Nn,"Oil")});var Wn,sw=n(()=>{$i();Wn=class extends tt{};t(Wn,"Seal")});var Qc=n(()=>{ew();tw();rw();iw();ow();xv();nw();aw();sw();Jy()});var ug,gm,Vv=n(()=>{M();ug=class extends h{};t(ug,"Action");gm=ug});var fg,yg,Jv=n(()=>{M();fg=class extends h{};t(fg,"ActionPerformed");yg=fg});var dg,Ap,$v=n(()=>{M();dg=class extends h{};t(dg,"Discovered");Ap=dg});var gg,hg,Zv=n(()=>{V();B();Vv();Jv();$v();gg=class extends k{#e;#t;constructor(e,r=f){super(),this.#e=r,this.#t=e,this.addKey("tile")}action(e){e.perform(),this.#e.process(yg,this,e)}actions(e){return this.#e.process(gm,this,e)}process(e){this.#e.process(Ap,this,e)}tile(){return this.#t}};t(gg,"GoodyHut");hg=gg});var Og,Ti,Fl=n(()=>{Zv();ge();Og=class extends Y{constructor(){super(hg)}getByTile(e){let r=this.filter(o=>o.tile()===e);return r.length===0?null:r[0]}};t(Og,"GoodyHutRegistry");Ti=new Og});var lw=n(()=>{mm()});var Ia=n(()=>{QR();ev();lw();ov();rv()});var xg,mw,pw=n(()=>{xg=class{#e;#t;#r;constructor(e,r,o){this.#e=o,this.#t=r,this.#r=e}end(){return this.#e}generate(){throw new Error(`PathFinder#generate: Must be overridden in '${this.constructor.name}'.`)}start(){return this.#t}unit(){return this.#r}};t(xg,"PathFinder");mw=xg});var Rg,vg,Qv=n(()=>{Ro();pw();Rg=class extends Qe{constructor(){super(mw)}};t(Rg,"PathFinderRegistry");vg=new Rg});var bg,Pi,Yl=n(()=>{V();bg=class extends he{};t(bg,"Government");Pi=bg});var Cg,Bp,Tg=n(()=>{Ro();Yl();Cg=class extends Qe{constructor(){super(Pi)}};t(Cg,"AvailableGovernmentRegistry");Bp=new Cg});var Pg,Xc,Xv=n(()=>{M();Pg=class extends h{};t(Pg,"Availability");Xc=Pg});var Ig,eu,eb=n(()=>{M();Ig=class extends h{};t(Ig,"Changed");eu=Ig});var wg,Ag,tb=n(()=>{Tg();V();B();Xv();eb();wg=class extends k{#e;#t=null;#r;#i;constructor(e,r=Bp,o=f){super(),this.#r=e,this.#e=r,this.#i=o,this.addKey("available","current")}available(){return this.#e.filter(e=>this.#i.get(Xc).some(r=>r.validate(e,this.#r)))}current(){return this.#t}is(...e){return e.some(r=>this.#t instanceof r)}player(){return this.#r}set(e){this.#t=e,this.#i.process(eu,this.#r,e)}};t(wg,"PlayerGovernment");Ag=wg});var Bg,Pt,Ln=n(()=>{ge();tb();Bg=class extends Y{constructor(){super(Ag)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of PlayerGovernments for player.");return r[0]}};t(Bg,"PlayerGovernmentRegistry");Pt=new Bg});var Gg,jn,Mg=n(()=>{fm();Gg=class extends Mo{};t(Gg,"Accept");jn=Gg});var Ug,Dg,rb=n(()=>{Zf();Ug=class extends cl{};t(Ug,"AIClient");Dg=Ug});var Eg,ss,Sg=n(()=>{Vc();Eg=class extends Ip{};t(Eg,"ExchangeKnowledge");ss=Eg});var cw=n(()=>{td();td()});var zn,ib=n(()=>{Qy();zn=class extends up{};t(zn,"Veteran")});var uw=n(()=>{ib();ib()});var fw=n(()=>{cw();uw()});var tu=n(()=>{fw()});var wa,ru,kg=n(()=>{S();wa=class extends b{};t(wa,"AdvancedFlight");ru=wa});var So,yw,ob=n(()=>{S();So=class extends b{};t(So,"Alphabet");yw=So});var to,dw,nb=n(()=>{S();to=class extends b{};t(to,"Astronomy");dw=to});var Aa,gw,ab=n(()=>{S();Aa=class extends b{};t(Aa,"AtomicTheory");gw=Aa});var lr,iu,Fg=n(()=>{S();lr=class extends b{};t(lr,"Automobile");iu=lr});var ro,hw,sb=n(()=>{S();ro=class extends b{};t(ro,"Banking");hw=ro});var ko,Ow,lb=n(()=>{S();ko=class extends b{};t(ko,"BridgeBuilding");Ow=ko});var Fo,Yg,Ng=n(()=>{S();Fo=class extends b{};t(Fo,"BronzeWorking");Yg=Fo});var io,xw,mb=n(()=>{S();io=class extends b{};t(io,"CeremonialBurial");xw=io});var Hn,Rw,pb=n(()=>{S();Hn=class extends b{};t(Hn,"Chemistry");Rw=Hn});var ls,ou,Wg=n(()=>{S();ls=class extends b{};t(ls,"Chivalry");ou=ls});var qr,vw,cb=n(()=>{S();qr=class extends b{};t(qr,"CodeOfLaws");vw=qr});var _n,nu,Lg=n(()=>{S();_n=class extends b{};t(_n,"Combustion");nu=_n});var St,bw,ub=n(()=>{S();St=class extends b{};t(St,"Communism");bw=St});var oo,Cw,fb=n(()=>{S();oo=class extends b{};t(oo,"Computers");Cw=oo});var ms,hm,jg=n(()=>{S();ms=class extends b{};t(ms,"Conscription");hm=ms});var Ii,Tw,yb=n(()=>{S();Ii=class extends b{};t(Ii,"Construction");Tw=Ii});var Yo,Pw,db=n(()=>{S();Yo=class extends b{};t(Yo,"Corporation");Pw=Yo});var no,Iw,gb=n(()=>{S();no=class extends b{};t(no,"Currency");Iw=no});var No,ww,hb=n(()=>{S();No=class extends b{};t(No,"Democracy");ww=No});var Vr,Aw,Ob=n(()=>{S();Vr=class extends b{};t(Vr,"Electricity");Aw=Vr});var It,Bw,xb=n(()=>{S();It=class extends b{};t(It,"Electronics");Bw=It});var Kn,Gw,Rb=n(()=>{S();Kn=class extends b{};t(Kn,"Engineering");Gw=Kn});var qn,Mw,vb=n(()=>{S();qn=class extends b{};t(qn,"Explosives");Mw=qn});var Ba,Uw,bb=n(()=>{S();Ba=class extends b{};t(Ba,"Feudalism");Uw=Ba});var Ga,zg,Hg=n(()=>{S();Ga=class extends b{};t(Ga,"Flight");zg=Ga});var ps,Dw,Cb=n(()=>{S();ps=class extends b{};t(ps,"FusionPower");Dw=ps});var Vn,Ew,Tb=n(()=>{S();Vn=class extends b{};t(Vn,"GeneticEngineering");Ew=Vn});var Pr,Gp,_g=n(()=>{S();Pr=class extends b{};t(Pr,"Gunpowder");Gp=Pr});var cs,Kg,qg=n(()=>{S();cs=class extends b{};t(cs,"HorsebackRiding");Kg=cs});var Ir,au,Vg=n(()=>{S();Ir=class extends b{};t(Ir,"Industrialization");au=Ir});var Jr,Sw,Pb=n(()=>{S();Jr=class extends b{};t(Jr,"Invention");Sw=Jr});var Jn,Jg,$g=n(()=>{S();Jn=class extends b{};t(Jn,"IronWorking");Jg=Jn});var us,Zg,Qg=n(()=>{S();us=class extends b{};t(us,"LaborUnion");Zg=us});var $r,kw,Ib=n(()=>{S();$r=class extends b{};t($r,"Literacy");kw=$r});var wi,su,Xg=n(()=>{S();wi=class extends b{};t(wi,"Magnetism");su=wi});var Wo,eh,th=n(()=>{S();Wo=class extends b{};t(Wo,"MapMaking");eh=Wo});var mr,Fw,wb=n(()=>{S();mr=class extends b{};t(mr,"Masonry");Fw=mr});var Zr,rh,ih=n(()=>{S();Zr=class extends b{};t(Zr,"MassProduction");rh=Zr});var ao,oh,nh=n(()=>{S();ao=class extends b{};t(ao,"Mathematics");oh=ao});var so,Yw,Ab=n(()=>{S();so=class extends b{};t(so,"Medicine");Yw=so});var $n,lu,ah=n(()=>{S();$n=class extends b{};t($n,"Metallurgy");lu=$n});var Ai,Nw,Bb=n(()=>{S();Ai=class extends b{};t(Ai,"Monarchy");Nw=Ai});var pr,Ww,Gb=n(()=>{S();pr=class extends b{};t(pr,"Mysticism");Ww=pr});var lo,mu,sh=n(()=>{S();lo=class extends b{};t(lo,"Navigation");mu=lo});var Bi,Lw,Mb=n(()=>{S();Bi=class extends b{};t(Bi,"NuclearFission");Lw=Bi});var Lo,jw,Ub=n(()=>{S();Lo=class extends b{};t(Lo,"NuclearPower");jw=Lo});var Gi,zw,Db=n(()=>{S();Gi=class extends b{};t(Gi,"Philosophy");zw=Gi});var mo,Hw,Eb=n(()=>{S();mo=class extends b{};t(mo,"Physics");Hw=mo});var Zn,pu,lh=n(()=>{S();Zn=class extends b{};t(Zn,"Plastics");pu=Zn});var Qn,_w,Sb=n(()=>{S();Qn=class extends b{};t(Qn,"Pottery");_w=Qn});var Mi,Kw,kb=n(()=>{S();Mi=class extends b{};t(Mi,"Railroad");Kw=Mi});var Xn,qw,Fb=n(()=>{S();Xn=class extends b{};t(Xn,"Recycling");qw=Xn});var po,Vw,Yb=n(()=>{S();po=class extends b{};t(po,"Refining");Vw=po});var kt,Jw,Nb=n(()=>{S();kt=class extends b{};t(kt,"Religion");Jw=kt});var ea,fs,cu=n(()=>{S();ea=class extends b{};t(ea,"Robotics");fs=ea});var Ma,mh,ph=n(()=>{S();Ma=class extends b{};t(Ma,"Rocketry");mh=Ma});var jo,ch,uh=n(()=>{S();jo=class extends b{};t(jo,"SpaceFlight");ch=jo});var Ua,fh,yh=n(()=>{S();Ua=class extends b{};t(Ua,"SteamEngine");fh=Ua});var Da,dh,gh=n(()=>{S();Da=class extends b{};t(Da,"Steel");dh=Da});var zo,$w,Wb=n(()=>{S();zo=class extends b{};t(zo,"Superconductor");$w=zo});var co,Zw,Lb=n(()=>{S();co=class extends b{};t(co,"TheRepublic");Zw=co});var ys,hh,Oh=n(()=>{S();ys=class extends b{};t(ys,"TheWheel");hh=ys});var Ho,Qw,jb=n(()=>{S();Ho=class extends b{};t(Ho,"TheoryOfGravity");Qw=Ho});var ta,xh,Rh=n(()=>{S();ta=class extends b{};t(ta,"Trade");xh=ta});var wr,Xw,zb=n(()=>{S();wr=class extends b{};t(wr,"University");Xw=wr});var uo,vh,bh=n(()=>{S();uo=class extends b{};t(uo,"Writing");vh=uo});var Qr=n(()=>{kg();ob();nb();ab();Fg();sb();lb();Ng();mb();pb();Wg();cb();Lg();ub();fb();jg();yb();db();gb();hb();Ob();xb();Rb();vb();bb();Hg();Cb();Tb();_g();qg();Vg();Pb();$g();Qg();Ib();Xg();th();wb();ih();nh();Ab();ah();Bb();Gb();sh();Mb();Ub();Db();Eb();lh();Sb();kb();Fb();Yb();Nb();cu();ph();uh();yh();gh();Wb();Lb();Oh();jb();Rh();zb();bh()});var fo,eA=n(()=>{Yl();fo=class extends Pi{};t(fo,"Anarchy")});var Ft,tA=n(()=>{Yl();Ft=class extends Pi{};t(Ft,"Communism")});var ht,rA=n(()=>{Yl();ht=class extends Pi{};t(ht,"Democracy")});var cr,iA=n(()=>{Yl();cr=class extends Pi{};t(cr,"Despotism")});var Ot,oA=n(()=>{Yl();Ot=class extends Pi{};t(Ot,"Monarchy")});var wt,nA=n(()=>{Yl();wt=class extends Pi{};t(wt,"Republic")});var ra=n(()=>{eA();tA();rA();iA();oA();nA()});var Ch,Ea,Th=n(()=>{Vc();Ch=class extends Ip{};t(Ch,"OfferPeace");Ea=Ch});var Ui,aA=n(()=>{He();Ui=class extends z{};t(Ui,"Aqueduct")});var Ar,sA=n(()=>{He();Ar=class extends z{};t(Ar,"Bank")});var Di,lA=n(()=>{He();Di=class extends z{};t(Di,"Barracks")});var Br,mA=n(()=>{He();Br=class extends z{};t(Br,"Cathedral")});var _o,pA=n(()=>{He();_o=class extends z{};t(_o,"CityWalls")});var Ei,cA=n(()=>{He();Ei=class extends z{};t(Ei,"Colosseum")});var Xr,uA=n(()=>{He();Xr=class extends z{};t(Xr,"Courthouse")});var ur,fA=n(()=>{He();ur=class extends z{};t(ur,"Factory")});var Si,yA=n(()=>{He();Si=class extends z{};t(Si,"Granary")});var Yt,dA=n(()=>{He();Yt=class extends z{};t(Yt,"HydroPlant")});var ei,gA=n(()=>{He();ei=class extends z{};t(ei,"Library")});var ti,hA=n(()=>{He();ti=class extends z{};t(ti,"ManufacturingPlant")});var Gr,OA=n(()=>{He();Gr=class extends z{};t(Gr,"Marketplace")});var Ko,xA=n(()=>{He();Ko=class extends z{};t(Ko,"MassTransit")});var Nt,RA=n(()=>{He();Nt=class extends z{};t(Nt,"NuclearPlant")});var At,vA,Hb=n(()=>{He();At=class extends z{};t(At,"Palace");vA=At});var Wt,bA=n(()=>{He();Wt=class extends z{};t(Wt,"PowerPlant")});var qo,CA=n(()=>{He();qo=class extends z{};t(qo,"RecyclingCenter")});var Vo,TA=n(()=>{He();Vo=class extends z{};t(Vo,"SdiDefence")});var $t,PA=n(()=>{He();$t=class extends z{};t($t,"Temple")});var ri,IA=n(()=>{He();ri=class extends z{};t(ri,"University")});var yo=n(()=>{aA();sA();lA();mA();pA();cA();uA();fA();yA();dA();gA();hA();OA();xA();RA();Hb();bA();CA();TA();PA();IA()});var Ph,Nl,wA=n(()=>{Qv();Oc();Ph=class extends _m{#e=1/0;end(){return this.entries()[this.length-1]}static for(e,r,o,a=vg){let[s]=a.entries().map(l=>new l(e,r,o)).map(l=>l.generate()).sort((l,c)=>l.movementCost()-c.movementCost());return s&&(s.shift(),s)}movementCost(){return this.#e}setMovementCost(e){this.#e=e}push(...e){e.forEach(r=>{let o=this.end();if(this.length>0&&!r.isNeighbourOf(o))throw new TypeError(`Tile#push: Invalid element passed, ${r.x()},${r.y()} is not a neighbour of ${o.x()},${o.y()}.`);super.push(r)})}start(){return this.entries()[0]}};t(Ph,"Path");Nl=Ph});var ii,_b=n(()=>{Vt();ii=class extends _{};t(ii,"Artillery")});var AA=n(()=>{_b();_b()});var oi,Kb=n(()=>{Sl();oi=class extends ba{};t(oi,"Battleship")});var BA=n(()=>{Kb();Kb()});var fr,qb=n(()=>{dm();fr=class extends El{};t(fr,"Bomber")});var GA=n(()=>{qb();qb()});var Mr,Vb=n(()=>{Vt();Mr=class extends _{};t(Mr,"Cannon")});var MA=n(()=>{Vb();Vb()});var ni,Jb=n(()=>{Vt();ni=class extends _{};t(ni,"Caravan")});var UA=n(()=>{Jb();Jb()});var ai,$b=n(()=>{dm();kl();ai=class extends Ta{canStow(e){return e instanceof El&&super.canStow(e)}capacity(){return 8}};t(ai,"Carrier")});var DA=n(()=>{$b();$b()});var Ur,Zb=n(()=>{Vt();Ur=class extends _{};t(Ur,"Catapult")});var EA=n(()=>{Zb();Zb()});var Dr,Qb=n(()=>{Vt();Dr=class extends _{};t(Dr,"Chariot")});var SA=n(()=>{Qb();Qb()});var si,Xb=n(()=>{Sl();si=class extends ba{};t(si,"Cruiser")});var kA=n(()=>{Xb();Xb()});var li,eC=n(()=>{Vt();li=class extends _{};t(li,"Diplomat")});var FA=n(()=>{eC();eC()});var Lt,tC=n(()=>{dm();Lt=class extends El{};t(Lt,"Fighter")});var YA=n(()=>{tC();tC()});var Er,rC=n(()=>{kl();Er=class extends Ta{capacity(){return 4}};t(Er,"Frigate")});var NA=n(()=>{rC();rC()});var Zt,iC=n(()=>{Vt();Zt=class extends _{};t(Zt,"Horseman")});var WA=n(()=>{iC();iC()});var Sr,oC=n(()=>{Sl();Sr=class extends ba{};t(Sr,"Ironclad")});var LA=n(()=>{oC();oC()});var kr,nC=n(()=>{Vt();kr=class extends _{};t(kr,"Knight")});var jA=n(()=>{nC();nC()});var mi,aC=n(()=>{Vt();mi=class extends _{};t(mi,"MechanizedInfantry")});var zA=n(()=>{aC();aC()});var Fr,sC=n(()=>{Vt();Fr=class extends _{};t(Fr,"Musketman")});var HA=n(()=>{sC();sC()});var jt,lC=n(()=>{dm();jt=class extends El{};t(jt,"Nuclear")});var _A=n(()=>{lC();lC()});var pi,mC=n(()=>{Vt();pi=class extends _{};t(pi,"Rifleman")});var KA=n(()=>{mC();mC()});var Yr,pC=n(()=>{kl();Yr=class extends Ta{capacity(){return 3}};t(Yr,"Sail")});var qA=n(()=>{pC();pC()});var Le,VA,Ih=n(()=>{cg();Le=class extends Jt{};t(Le,"Settlers");VA=Le});var JA=n(()=>{Ih();Ih()});var Nr,cC=n(()=>{Vt();Nr=class extends _{};t(Nr,"Spearman")});var $A=n(()=>{cC();cC()});var yr,uC=n(()=>{Sl();yr=class extends ba{};t(yr,"Submarine")});var ZA=n(()=>{uC();uC()});var Qt,fC=n(()=>{Vt();Qt=class extends _{};t(Qt,"Swordman")});var QA=n(()=>{fC();fC()});var ci,yC=n(()=>{Vt();ci=class extends _{};t(ci,"Tank")});var XA=n(()=>{yC();yC()});var ui,dC=n(()=>{kl();ui=class extends Ta{capacity(){return 8}};t(ui,"Transport")});var eB=n(()=>{dC();dC()});var Xt,gC=n(()=>{kl();Xt=class extends Ta{capacity(){return 2}};t(Xt,"Trireme")});var tB=n(()=>{gC();gC()});var fi,hC=n(()=>{Vt();fi=class extends _{};t(fi,"Warrior")});var rB=n(()=>{hC();hC()});var iB=n(()=>{AA();BA();GA();MA();UA();DA();EA();SA();kA();FA();YA();NA();WA();LA();jA();zA();HA();_A();KA();qA();JA();$A();ZA();QA();XA();eB();tB();rB()});var Jo=n(()=>{iB()});var wh,bj,Ah,Sa,Mp=n(()=>{ip();pm();$f();da();Et();et();ns();Eo();X();Va();Pa();Qc();Fl();as();Ia();Qv();Ln();ke();rm();Ci();B();bn();bi();at();ts();Ke();Mg();rb();ap();Rc();hy();Sg();tu();al();Jc();Qr();ra();Dv();Th();yo();wA();pf();fm();Jo();ji();Za();Se();Ml();wh=t((i,e,r=K)=>{let o=r.getByTile(i);return o===null?!1:o.player()===e},"hasPlayerCity"),bj=15,Ah=class extends Dg{#e=e=>{let r=this.#M.option("earth",!1),o=this.#p.getByPlayer(this.player()).length===0;if(r&&o)return!0;let a=this.#B.getByTerrain(e.terrain());return(e.terrain()instanceof Re||e.terrain()instanceof me||e.terrain()instanceof ue||a.some(s=>s instanceof eo)||a.some(s=>s instanceof Xi))&&e.getSurroundingArea().score(this.player(),[[te,4],[Q,2],[ce,1]])>=160&&!e.getSurroundingArea(4).filter(s=>this.#p.getByTile(s)!==null).length};#t=e=>[Ue,ue,Re,me].some(r=>e.terrain()instanceof r)&&!this.#x.getByTile(e).some(r=>r instanceof Ye)&&e.getSurroundingArea().some(r=>wh(r,this.player(),this.#p))&&[...e.getAdjacent(),e].some(r=>r.terrain()instanceof me||r.isCoast()||this.#x.getByTile(r).some(o=>o instanceof Ye)&&this.#p.getByTile(r)===null);#r=e=>[Ne,$e].some(r=>e.terrain()instanceof r)&&!this.#x.getByTile(e).some(r=>r instanceof lt)&&e.getSurroundingArea().some(r=>wh(r,this.player(),this.#p));#i=e=>!this.#x.getByTile(e).some(r=>r instanceof qe)&&e.getSurroundingArea().some(r=>wh(r,this.player(),this.#p));#o=new Map;#n=new Map;#a=new Map;#s=[];#l=[];#m=[];#g=[];#f=[];#y=[];#u=[];#p;#C;#R;#T;#P;#b;#d;#I;#w;#A;#h;#O;#B;#x;#G;#v;#c;#M;constructor(e,r=K,o=Kt,a=ie,s=Ti,l=vg,c=Pt,u=W,y=Hi,O=oe,G=f,N=bt,g=_e,x=Cr,d=j,T=P,D=Tr,q=sr,Ce=$){super(e),this.#p=r,this.#C=o,this.#R=a,this.#T=D,this.#P=s,this.#b=q,this.#d=l,this.#I=c,this.#w=u,this.#A=y,this.#h=O,this.#O=G,this.#B=N,this.#G=Ce,this.#v=x,this.#x=g,this.#c=d,this.#M=T}scoreUnitMove(e,r){let o=e.actions(r),{attack:a,buildIrrigation:s,buildMine:l,buildRoad:c,captureCity:u,disembark:y,embark:O,fortify:G,foundCity:N,noOrders:g,sneakAttack:x}=o.reduce((Pe,_t)=>({...Pe,[_t.constructor.name.replace(/^./,cj=>cj.toLowerCase())]:_t}),{});if(x&&!this.shouldAttack(x))return-10;if(!o.length||o.length===1&&g||e instanceof _&&o.length===2&&G&&g)return-1;let d=0;this.#P.getByTile(r)!==null&&(d+=60),(N&&this.#e(r)||l&&this.#r(r)||s&&this.#t(r)||c&&this.#i(r))&&(d+=24);let D=this.#c.getByTile(r).sort((Pe,_t)=>_t.defence().value()-Pe.defence().value()),[q]=D,Ce=D.some(Pe=>Pe.player()===this.player());e instanceof Tt&&e.hasCapacity()&&D.length&&Ce&&(d+=10),e instanceof Tt&&e.hasCargo()&&r.isCoast()&&r.isWater()&&(d+=16),O&&(d+=16),y&&(d+=16),u&&(d+=100),a&&e.attack()>q.defence()&&(d+=24*(e.attack().value()-q.defence().value())),a&&e.attack().value()>=q.defence().value()&&(d+=16),a&&e.attack().value()>=q.defence().value()*(2/3)&&(d+=8);let jr=this.#h.getByPlayer(this.player()),ma=r.getNeighbours().filter(Pe=>!jr.includes(Pe)).length;ma>0&&(d+=ma*3);let Te=this.#a.get(e);return Te instanceof ye&&r.distanceFrom(Te)<e.tile().distanceFrom(Te)&&(d+=14),(this.#o.get(e)||[]).includes(r)||(d*=4),d}async moveUnit(e){let r=0;for(;e.active()&&e.moves().value()>=.1;){if(r++>1e3){console.log("SimpleAIClient#moveUnit: loopCheck: aborting"),console.log(`${e.player().civilization().name()} ${e.constructor.name}`),console.log(e.actions()),console.log(e.actionsForNeighbours()),this.noOrders(e);return}let o=this.#n.get(e);if(o){let y=o.shift(),[O]=e.actions(y).filter(G=>G instanceof mt);if(O){e.action(O),o.length===0&&this.#n.delete(e),await this.canNegotiate(e);continue}if(o.length>0){let G=Nl.for(e,e.tile(),o.end());if(G){this.#n.set(e,G);continue}}this.#n.delete(e)}let[a]=e.tile().getNeighbours().map(y=>[y,this.scoreUnitMove(e,y)]).filter(([,y])=>y>-1).sort(([,y],[,O])=>O-y||Math.floor(Math.random()*3)-1).map(([y])=>y);if(!a){this.noOrders(e);return}let s=e.actions(a),[l]=s,c=this.#o.get(e)||[],u=this.#a.get(e);if(!l||(l instanceof Un||l instanceof is)&&!this.shouldAttack(l)){this.noOrders(e);return}u===a&&this.#a.delete(e),c.push(a),this.#o.set(e,c.slice(-50)),e.action(l)}await this.canNegotiate(e),e.moves().value()>0&&this.noOrders(e)}preProcessTurn(){this.#s.splice(0),this.#l.splice(0),this.#m.splice(0),this.#g.splice(0),this.#f.splice(0),this.#y.splice(0),this.#u.splice(0);let e=this.#h.getByPlayer(this.player());e.entries().forEach(r=>{let o=r.tile(),a=this.#p.getByTile(o),s=this.#c.getBy("tile",o),l=this.#u.includes(o)&&![...this.#a.values(),...[...this.#n.values()].map(c=>c.end())].includes(o);a&&a.player()===this.player()&&!s.length&&!this.#u.includes(o)&&!l?this.#u.push(o):a&&a.player()!==this.player()&&a.originalPlayer()===this.player()?this.#s.push(o):a&&a.player()!==this.player()&&!this.#l.includes(o)?this.#l.push(o):s.length&&s.some(c=>c.player()!==this.player())&&this.#m.includes(o)?this.#m.push(o):o.isLand()&&o.getNeighbours().some(c=>!e.includes(c))&&!this.#f.includes(o)&&!l?this.#f.push(o):o.isWater()&&o.getNeighbours().some(c=>!e.includes(c))&&this.#y.includes(o)&&!l&&this.#y.push(o),this.#e(o)&&this.#g.includes(o)&&!l&&this.#g.push(o)}),this.#p.getByPlayer(this.player()).forEach(r=>{let o=this.#c.getByTile(r.tile());vp(r,this.#h,this.#R),!o.length&&!this.#u.includes(r.tile())&&this.#u.push(r.tile())})}async chooseFromList(e){if(e.key()!=="negotiation.next-step")return super.chooseFromList(e);let r=t(a=>a instanceof Ea||a instanceof jn?20:a instanceof ss?10:0,"score"),[o]=e.choices().sort((a,s)=>r(s.value())-r(a.value()));return o.value()}takeTurn(){return new Promise(async(e,r)=>{try{let o=0;this.preProcessTurn();let[a]=this.#I.filter(l=>l.player()===this.player()),[s]=this.#w.filter(l=>l.player()===this.player());for(s.completed(Ai)&&!a.is(Ot)&&a.set(new Ot);this.player().hasMandatoryActions();){let l=this.player().mandatoryAction(),c=l.value();if(o++>1e3){console.log(""),console.log(""),console.log(c),c instanceof Fe&&(console.log(c.actions()),c.tile().getNeighbours().forEach(u=>console.log(c.actions(u))),console.log(c.active()),console.log(c.busy()),console.log(c.moves().value()),console.log(this.#v.getByUnit(c))),this.noOrders(c),console.error("SimpleAIClient: Couldn't pick an action to do.");break}if(c instanceof Fe){let u=c,y=u.tile(),O=this.#a.get(u),G=u.actions(),{buildIrrigation:N,buildMine:g,buildRoad:x,fortify:d,foundCity:T,unload:D}=G.reduce((Te,De)=>({...Te,[De.constructor.name.replace(/^./,Pe=>Pe.toLowerCase())]:De}),{}),q=this.#c.getByTile(y);if(this.#o.get(u)||this.#o.set(u,[u.tile()]),u instanceof Tt&&D&&y.isCoast()&&u.cargo().some(Te=>!y.getNeighbours().some(De=>(this.#o.get(Te)||[]).includes(De)))){u.action(D),u.setWaiting();continue}if(u instanceof Jt){T&&this.#e(y)?u.action(T):N&&this.#t(y)?u.action(N):g&&this.#r(y)?u.action(g):x&&this.#i(y)?u.action(x):!O&&this.#g.length&&this.#a.set(u,this.#g.shift()),await this.moveUnit(u);continue}let[jr]=q.filter(Te=>this.#v.getByUnit(Te).some(De=>De instanceof _r)&&u.defence()>Te.defence()),ma=this.#p.getByTile(y);if(d&&ma&&(jr||q.length<=Math.ceil(this.#R.getByCity(ma).size()/5))){u.action(d),jr&&jr.activate();continue}if(!O){if(u instanceof _&&u.defence().value()>0&&this.#u.length>0){let[Te]=this.#u.sort((Pe,_t)=>Pe.distanceFrom(u.tile())-_t.distanceFrom(u.tile())),De=Nl.for(u,u.tile(),Te,this.#d);De&&(this.#u.splice(this.#u.indexOf(Te),1),this.#n.set(u,De))}else if(u.attack().value()>0&&this.#s.length>0){let[Te]=this.#s.filter(Pe=>u instanceof Ze&&Pe.isLand()).sort((Pe,_t)=>Pe.distanceFrom(u.tile())-_t.distanceFrom(u.tile())),De=Nl.for(u,u.tile(),Te,this.#d);De&&(this.#s.splice(this.#s.indexOf(Te),1),this.#n.set(u,De))}else if(u.attack().value()>0&&this.#m.length>0){let[Te]=this.#m.filter(Pe=>u instanceof Ze&&Pe.isLand()||u instanceof We&&Pe.isWater()).sort((Pe,_t)=>Pe.distanceFrom(u.tile())-_t.distanceFrom(u.tile())),De=Nl.for(u,u.tile(),Te,this.#d);De&&(this.#m.splice(this.#m.indexOf(Te),1),this.#n.set(u,De))}else if(u instanceof Ze&&u.attack().value()>0&&this.#l.length>0){let[Te]=this.#l.sort((Pe,_t)=>Pe.distanceFrom(u.tile())-_t.distanceFrom(u.tile())),De=Nl.for(u,u.tile(),Te,this.#d);De&&(this.#l.splice(this.#l.indexOf(Te),1),this.#n.set(u,De))}else if(u instanceof Ze&&this.#f.length>0){let[Te]=this.#f.sort((Pe,_t)=>Pe.distanceFrom(u.tile())-_t.distanceFrom(u.tile())),De=Nl.for(u,u.tile(),Te,this.#d);De&&(this.#f.splice(this.#f.indexOf(Te),1),this.#n.set(u,De))}else if(u instanceof We&&this.#y.length>0){let[Te]=this.#y.sort((Pe,_t)=>Pe.distanceFrom(u.tile())-_t.distanceFrom(u.tile())),De=Nl.for(u,u.tile(),Te,this.#d);De&&(this.#y.splice(this.#y.indexOf(Te),1),this.#n.set(u,De))}}await this.moveUnit(u);continue}if(c instanceof nl){this.buildItemInCity(c.city());continue}if(c instanceof Ym){let u=c.available();u.length&&c.research(u[Math.floor(u.length*Math.random())]);continue}if(l instanceof gy)break;console.log(`Can't process: '${c.constructor.name}'`);break}e()}catch(o){if(typeof o=="string"){r(new Error(o));return}if(o instanceof Error){r(o);return}r(new Error(`An unknown error occurred: ${o}`))}})}buildItemInCity(e){let r=e.tile(),o=this.#C.getByCity(e),a=this.#c.getByTile(r),s=o.available(),l=[At,Le],c=s.filter(d=>!l.includes(d.item())&&!Object.prototype.isPrototypeOf.call(ve,d.item())),u=s.filter(d=>Object.prototype.isPrototypeOf.call(ve,d.item())),y=c.filter(d=>Object.prototype.isPrototypeOf.call(Fe,d.item())),O=c[Math.floor(c.length*Math.random())].item(),G=t(d=>{let[[T]]=y.map(D=>{let q=D.item(),Ce=new d;return this.#O.process(bl,q,Ce),[q,Ce]}).sort(([,D],[,q])=>q.value()-D.value());return T},"getUnitByYield"),N=(d=>()=>d||(d=G(Ki)))(),g=(d=>()=>d||(d=G(To)))();if(this.#c.getByTile(r).length<2&&N()){o.build(N());return}let x=this.#R.getByCity(o.city());if(s.some(d=>d.item()===Le)&&!this.#c.getByCity(o.city()).some(d=>d instanceof Le)&&this.#c.getByPlayer(this.player()).filter(d=>d instanceof Le).length<3&&x.size()>1){o.build(Le);return}if(this.#s.length>0||this.#l.length>0||this.#m.length>4){o.build(g());return}if(a.filter(d=>this.#v.getByUnit(d).filter(T=>T instanceof _r)).length<2||this.#u.length){o.build(N());return}if(o.city().yields().filter(d=>d instanceof Q).some(d=>d.value()>4)){let d=u.map(T=>T.item());o.build(d[Math.floor(Math.random()*d.length)])}O&&o.build(O)}cityLost(e,r,o){if(!r)return;let a=this.#h.getByPlayer(this.player());if(o){this.#l.push(...a.entries().filter(s=>wh(s.tile(),this.player(),this.#p)).map(s=>s.tile())),this.#m.push(...a.entries().filter(s=>this.#c.getByTile(s.tile()).some(l=>l.player()===r)).map(s=>s.tile()));return}this.#s.push(e.tile())}unitDestroyed(e,r){let o=this.#p.getByTile(e.tile()),a=this.#c.getByTile(e.tile());o&&o.player()===this.player()&&a.length<2&&(this.buildItemInCity(o),this.#A.getByPlayerAndType(this.player(),Co).buy(o))}async canNegotiate(e){let r=Array.from(new Set(e.tile().getNeighbours().flatMap(o=>this.#c.getByTile(o).map(a=>a.player()).filter(a=>a!==this.player()))));r.length!==0&&await r.filter(o=>this.#b.getByPlayer(o).filter(a=>a instanceof Cp&&a.isBetween(o,this.player())).every(a=>this.#G.value()-a.when()>bj)).reduce((o,a)=>o.then(()=>this.handleNegotiation(a)),Promise.resolve())}async handleNegotiation(e){let r=new Cp(this.player(),e,this.#O);for(r.proceed(new Uo(this.player(),r,this.#O));!r.terminated();){let o=r.lastInteraction();if(await(o!==null?o.for():r.players().slice(1)).reduce(async(s,l)=>s.then(async()=>{let u=await this.#T.getByPlayer(l).chooseFromList(new pl(r.nextSteps(),"negotiation.next-step",r));r.proceed(u),u instanceof Mo&&u.proposal().resolve(u)}),Promise.resolve()),r.terminated())break}return this.#b.register(r),r}noOrders(e){e.action(new Bn(e.tile(),e.tile(),e,this.#O))}shouldAttack(e){return!1}};t(Ah,"SimpleAIClient");Sa=Ah});var ds,Om,Up=n(()=>{nr();ds=class extends de{};t(ds,"American");Om=ds});var Cj={};var oB=n(()=>{Up();vr();ir();Object.entries({people:"American",nation:"America",colors:["#0055A4","#FFF"]}).forEach(([i,e])=>Oe.register(new we(Om,i,e)))});var Tj={};var nB=n(()=>{Up();or();vt();["Washington","New York","Los Angeles","Chicago","Houston","Phoenix","Philadelphia","San Antonio","San Diego","Dallas","San Jose","Austin","Jacksonville","Fort Worth","Columbus","San Francisco","Charlotte","Indianapolis","Seattle","Denver","Boston","El Paso","Detroit","Nashville","Portland","Memphis","Oklahoma City","Las Vegas","Louisville","Baltimore","Milwaukee","Albuquerque","Tucson","Fresno","Mesa","Sacramento","Atlanta","Kansas City","Colorado Springs","Miami","Raleigh","Omaha","Long Beach","Virginia Beach","Oakland","Minneapolis","Tulsa","Arlington","Tampa","New Orleans","Wichita","Cleveland","Bakersfield","Aurora","Anaheim","Honolulu","Santa Ana","Riverside","Corpus Christi","Lexington","Stockton","Henderson","Saint Paul","St. Louis","Cincinnati","Pittsburgh","Greensboro","Anchorage","Plano","Lincoln","Orlando","Irvine","Newark","Toledo","Durham","Chula Vista","Fort Wayne","Jersey City","St. Petersburg","Laredo","Madison","Chandler","Buffalo","Lubbock","Scottsdale","Reno","Glendale","Gilbert","Winston\u2013Salem","North Las Vegas","Norfolk","Chesapeake","Garland","Irving","Hialeah","Fremont","Boise","Richmond","Baton Rouge","Spokane","Des Moines","Tacoma","San Bernardino","Modesto","Fontana","Santa Clarita","Birmingham","Oxnard","Fayetteville","Moreno Valley","Rochester","Glendale","Huntington Beach","Salt Lake City","Grand Rapids","Amarillo","Yonkers","Aurora","Montgomery","Akron","Little Rock","Huntsville","Augusta","Port St. Lucie","Grand Prairie","Columbus","Tallahassee","Overland Park","Tempe","McKinney","Mobile","Cape Coral","Shreveport","Frisco","Knoxville","Worcester","Brownsville","Vancouver","Fort Lauderdale","Sioux Falls","Ontario","Chattanooga","Providence","Newport News","Rancho Cucamonga","Santa Rosa","Oceanside","Salem","Elk Grove","Garden Grove","Pembroke Pines","Peoria","Eugene","Corona","Cary","Springfield","Fort Collins","Jackson","Alexandria","Hayward","Lancaster","Lakewood","Clarksville","Palmdale","Salinas","Springfield","Hollywood","Pasadena","Sunnyvale","Macon","Kansas City","Pomona","Escondido","Killeen","Naperville","Joliet","Bellevue","Rockford","Savannah","Paterson","Torrance","Bridgeport","McAllen","Mesquite","Syracuse","Midland","Pasadena","Murfreesboro","Miramar","Dayton","Fullerton","Olathe","Orange","Thornton","Roseville","Denton","Waco","Surprise","Carrollton","West Valley City","Charleston","Warren","Hampton","Gainesville","Visalia","Coral Springs","Columbia","Cedar Rapids","Sterling Heights","New Haven","Stamford","Concord","Kent","Santa Clara","Elizabeth","Round Rock","Thousand Oaks","Lafayette","Athens","Topeka","Simi Valley","Fargo","Norman","Columbia","Abilene","Wilmington","Hartford","Victorville","Pearland","Vallejo","Ann Arbor","Berkeley","Allentown","Richardson","Odessa","Arvada","Cambridge","Sugar Land","Beaumont","Lansing","Evansville","Rochester","Independence","Fairfield","Provo","Clearwater","College Station","West Jordan","Carlsbad","El Monte","Murrieta","Temecula","Springfield","Palm Bay","Costa Mesa","Westminster","North Charleston","Miami Gardens","Manchester","High Point","Downey","Clovis","Pompano Beach","Pueblo","Elgin","Lowell","Antioch","West Palm Beach","Peoria","Everett","Ventura","Centennial","Lakeland","Gresham","Richmond","Billings","Inglewood","Broken Arrow","Sandy Springs","Jurupa Valley","Hillsboro","Waterbury","Santa Maria","Boulder","Greeley","Daly City","Meridian","Lewisville","Davie","West Covina","League City","Tyler","Norwalk","San Mateo","Green Bay","Wichita Falls","Sparks","Lakewood","Burbank","Rialto","Allen","El Cajon","Las Cruces","Renton","Davenport","South Bend","Vista","Tuscaloosa","Clinton","Edison","Woodbridge","San Angelo","Kenosha","Vacaville"].forEach((i,e)=>re.register(new se(i,Om,e===0)))});var sB=w(aB=>{"use strict";Object.defineProperty(aB,"__esModule",{value:!0});oB();nB()});var gs,Dp,uu=n(()=>{nr();gs=class extends de{};t(gs,"Aztec");Dp=gs});var Pj={};var lB=n(()=>{uu();vr();ir();Object.entries({people:"Aztec",nation:"Aztec",colors:["#A1DAB5","#EA6B76"]}).forEach(([i,e])=>Oe.register(new we(Dp,i,e)))});var Ij={};var mB=n(()=>{uu();or();vt();["Tenochtitlan","Teotihuacan","Tlatelolco","Texcoco","Tlaxcala","Calixtlahuaca","Xochicalco","Tlacopan","Atzcapotzalco","Tzintzuntzan","Malinalco","Tula","Tamuin","Teayo","Cempoala","Chalco","Tlalmanalco","Ixtapaluca","Huexotla","Tepexpan","Tepetlaoxtoc","Chiconautla","Zitlaltepec","Coyotepec","Tequixquiac","Jilotzingo","Tlapanaloya","Tultitan","Ecatepec","Coatepec","Chalchiuites","Chiauhita","Chapultepec","Itzapalapa","Ayotzinco","Iztapam"].forEach((i,e)=>re.register(new se(i,Dp,e===0)))});var cB=w(pB=>{"use strict";Object.defineProperty(pB,"__esModule",{value:!0});lB();mB()});var hs,Ep,fu=n(()=>{nr();hs=class extends de{};t(hs,"Babylonian");Ep=hs});var wj={};var uB=n(()=>{fu();vr();ir();Object.entries({people:"Babylonian",nation:"Babylon",colors:["#D0B8A6","#2f7b00"]}).forEach(([i,e])=>Oe.register(new we(Ep,i,e)))});var Aj={};var fB=n(()=>{fu();or();vt();["Babilim","Eshnunna","Diniktum","Tutub","Der","Sippar","Kutha","Jemdet Nasr","Kish","Borsippa","Mashkan-shapir","Dilbat","Nippur","Marad","Adab","Isin","Kisurra","Shuruppak","Bad-tibira","Zabalam","Umma","Girsu","Lagash","Urum","Uruk","Larsa","Ur","Kuara","Eridu","Akshak","Akkad"].forEach((i,e)=>re.register(new se(i,Ep,e===0)))});var dB=w(yB=>{"use strict";Object.defineProperty(yB,"__esModule",{value:!0});uB();fB()});var Os,Sp,yu=n(()=>{nr();Os=class extends de{};t(Os,"Chinese");Sp=Os});var Bj={};var gB=n(()=>{yu();vr();ir();Object.entries({people:"Chinese",nation:"China",colors:["#ee1c25","#ff0"]}).forEach(([i,e])=>Oe.register(new we(Sp,i,e)))});var Gj={};var hB=n(()=>{yu();or();vt();["Beijing","Shanghai","Chongqing","Tianjin","Guangzhou","Shenzhen\u2020","Chengdu","Nanjing","Wuhan","Xi'an","Hangzhou","Dongguan","Foshan","Shenyang","Harbin","Qingdao","Dalian","Jinan","Zhengzhou","Changsha","Kunming","Changchun","\xDCr\xFCmqi","Shantou","Hefei","Shijiazhuang","Ningbo","Taiyuan","Nanning","Xiamen\u2020","Fuzhou","Changzhou","Wenzhou","Nanchang","Tangshan","Guiyang","Wuxi","Lanzhou","Zhongshan","Handan","Huai'an","Weifang","Zibo","Shaoxing","Yantai","Huizhou","Luoyang","Nantong","Baotou","Liuzhou"].forEach((i,e)=>re.register(new se(i,Sp,e===0)))});var xB=w(OB=>{"use strict";Object.defineProperty(OB,"__esModule",{value:!0});gB();hB()});var xs,kp,du=n(()=>{nr();xs=class extends de{};t(xs,"Egyptian");kp=xs});var Mj={};var RB=n(()=>{du();vr();ir();Object.entries({people:"Egyptian",nation:"Egypt",colors:["#CE1126","#FFF"]}).forEach(([i,e])=>Oe.register(new we(kp,i,e)))});var Uj={};var vB=n(()=>{du();or();vt();["Cairo","Alexandria","Gizeh","Shubra El-Kheima","Port Said","Suez","Luxor","al-Mansura","El-Mahalla El-Kubra","Tanta","Asyut","Ismailia","Fayyum","Zagazig","Aswan","Damietta","Damanhur","al-Minya","Beni Suef","Qena","Sohag","Hurghada","6th of October City","Shibin El Kom","Banha","Kafr el-Sheikh","Arish","Mallawi","10th of Ramadan City","Bilbais","Marsa Matruh","Idfu","Mit Ghamr","Al-Hamidiyya","Desouk","Qalyub","Abu Kabir","Kafr el-Dawwar","Girga","Akhmim","Matarey"].forEach((i,e)=>re.register(new se(i,kp,e===0)))});var CB=w(bB=>{"use strict";Object.defineProperty(bB,"__esModule",{value:!0});RB();vB()});var Rs,xm,Fp=n(()=>{nr();Rs=class extends de{};t(Rs,"English");xm=Rs});var Dj={};var TB=n(()=>{Fp();vr();ir();Object.entries({people:"English",nation:"England",colors:["#FFF","#C8102E"]}).forEach(([i,e])=>Oe.register(new we(xm,i,e)))});var Ej={};var PB=n(()=>{Fp();or();vt();["London","Birmingham","Liverpool","Leeds","Sheffield","Bristol","Manchester","Leicester","Coventry","Kingston upon Hull","Stoke-on-Trent","Wolverhampton","Nottingham","Plymouth","Southampton","Reading","Derby","Dudley","Newcastle upon Tyne","Northampton","Portsmouth","Luton","Preston","Sunderland","Norwich","Walsall","Bournemouth","Southend-on-Sea","Swindon","Huddersfield","Poole","Oxford","Middlesbrough","Blackpool","Oldbury","Boldon","Ipswich","York","West Bromwich","Peterborough","Stockport","Brighton","Slough","Gloucester","Rotherham","Cambridge","Exeter","Eastbourne","Sutton Coldfield","Blackburn","Colchester","Oldham","St Helens","Woking","Chesterfield","Crawley"].forEach((i,e)=>re.register(new se(i,xm,e===0)))});var wB=w(IB=>{"use strict";Object.defineProperty(IB,"__esModule",{value:!0});TB();PB()});var vs,Yp,gu=n(()=>{nr();vs=class extends de{};t(vs,"French");Yp=vs});var Sj={};var AB=n(()=>{gu();vr();ir();Object.entries({people:"French",nation:"France",colors:["#FFF","#0055A4"]}).forEach(([i,e])=>Oe.register(new we(Yp,i,e)))});var kj={};var BB=n(()=>{gu();or();vt();["Paris","Marseille","Lyon","Toulouse","Nice","Nantes","Strasbourg","Montpellier","Bordeaux","Lille","Rennes","Reims","Le Havre","Saint-\xC9tienne","Toulon","Grenoble","Dijon","N\xEEmes","Angers","Villeurbanne","Le Mans","Saint-Denis","Aix-en-Provence","Clermont-Ferrand","Brest","Limoges","Tours","Amiens","Perpignan","Metz","Besan\xE7on","Boulogne-Billancourt","Orl\xE9ans","Mulhouse","Rouen","Saint-Denis","Caen","Argenteuil","Saint-Paul","Montreuil","Nancy","Roubaix","Tourcoing","Nanterre","Avignon","Vitry-sur-Seine","Cr\xE9teil","Dunkirk","Poitiers","Asni\xE8res-sur-Seine","Courbevoie","Versailles","Colombes","Fort-de-France","Aulnay-sous-Bois","Saint-Pierre","Rueil-Malmaison","Pau","Aubervilliers","Le Tampon","Champigny-sur-Marne","Antibes","B\xE9ziers","La Rochelle","Saint-Maur-des-Foss\xE9s","Cannes","Calais","Saint-Nazaire","M\xE9rignac","Drancy","Colmar","Ajaccio","Bourges","Issy-les-Moulineaux","Levallois-Perret","La Seyne-sur-Mer","Quimper","Noisy-le-Grand","Villeneuve-d'Ascq","Neuilly-sur-Seine","Valence","Antony","Cergy","V\xE9nissieux","Pessac","Troyes","Clichy","Ivry-sur-Seine","Chamb\xE9ry","Lorient","Les Abymes","Montauban","Sarcelles","Niort","Villejuif","Saint-Andr\xE9","Hy\xE8res","Saint-Quentin","Beauvais","\xC9pinay-sur-Seine","Cayenne","Maisons-Alfort","Cholet","Meaux","Chelles","Pantin","\xC9vry","Fontenay-sous-Bois","Fr\xE9jus","Vannes","Bondy","Le Blanc-Mesnil","La Roche-sur-Yon","Saint-Louis","Arles","Clamart","Narbonne","Annecy","Sartrouville","Grasse","Laval","Belfort","Bobigny","\xC9vreux","Vincennes","Montrouge","Sevran","Albi","Charleville-M\xE9zi\xE8res","Suresnes","Martigues","Corbeil-Essonnes","Saint-Ouen","Bayonne","Cagnes-sur-Mer","Brive-la-Gaillarde","Carcassonne","Massy","Blois","Aubagne","Saint-Brieuc","Ch\xE2teauroux","Chalon-sur-Sa\xF4ne","Mantes-la-Jolie","Meudon","Saint-Malo","Ch\xE2lons-en-Champagne","Alfortville","S\xE8te","Salon-de-Provence","Vaulx-en-Velin","Puteaux","Rosny-sous-Bois","Saint-Herblain","Gennevilliers","Le Cannet","Livry-Gargan","Saint-Priest","Istres","Valenciennes","Choisy-le-Roi","Caluire-et-Cuire","Boulogne-sur-Mer","Bastia","Angoul\xEAme","Garges-l\xE8s-Gonesse","Castres","Thionville","Wattrelos","Talence","Saint-Laurent-du-Maroni","Douai","Noisy-le-Sec","Tarbes","Arras","Al\xE8s","La Courneuve","Bourg-en-Bresse","Compi\xE8gne","Gap","Melun","Le Lamentin","Rez\xE9","Saint-Germain-en-Laye","Marcq-en-Bar\u0153ul","Gagny","Anglet","Draguignan","Chartres","Bron","Bagneux","Colomiers","Saint-Martin-d'H\xE8res","Pontault-Combault","Montlu\xE7on","Jou\xE9-l\xE8s-Tours","Saint-Joseph","Poissy","Savigny-sur-Orge","Cherbourg-Octeville","Mont\xE9limar","Villefranche-sur-Sa\xF4ne","Stains","Saint-Beno\xEEt","Bagnolet","Ch\xE2tillon","Le Port","Sainte-Genevi\xE8ve-des-Bois","\xC9chirolles","Roanne","Villepinte","Saint-Chamond","Conflans-Sainte-Honorine","Auxerre","Nevers","Neuilly-sur-Marne","La Ciotat","Tremblay-en-France","Thonon-les-Bains","Vitrolles","Haguenau","Six-Fours-les-Plages","Agen","Creil","Annemasse","Saint-Rapha\xEBl","Marignane","Romans-sur-Is\xE8re","Montigny-le-Bretonneux","Le Perreux-sur-Marne","Franconville","M\xE2con","Saint-Leu","Cambrai","Ch\xE2tenay-Malabry","Sainte-Marie","Villeneuve-Saint-Georges","Houilles","\xC9pinal","Lens","Li\xE9vin","Les Mureaux","Schiltigheim","La Possession","Meyzieu","Dreux","Nogent-sur-Marne","Plaisir","Mont-de-Marsan","Palaiseau","Ch\xE2tellerault","Goussainville","L'Ha\xFF-les-Roses","Viry-Ch\xE2tillon","Vigneux-sur-Seine","Chatou","Trappes","Clichy-sous-Bois","Rillieux-la-Pape","Villenave-'Ornon","Maubeuge","Charenton-le-Pont","Malakoff","Matoury","Dieppe","Athis-Mons","Savigny-le-Temple","P\xE9rigueux","Baie-Mahault","Vandoeuvre-l\xE8s-Nancy","Pontoise","Aix-les-Bains","Cachan","Vienne","Thiais","Orange","Saint-M\xE9dard-en-Jalles","Villemomble","Saint-Cloud","Saint-Laurent-du-Var","Yerres","Saint-\xC9tienne-du-Rouvray","Sotteville-l\xE8s-Rouen","Draveil","Le Chesnay","Bois-Colombes","Le Plessis-Robinson","La Garenne-Colombes","Lambersart","Soissons","Pierrefitte-sur-Seine","Carpentras","Villiers-sur-Marne","Vanves","Menton","Bergerac","Ermont","Bezons","Grigny","Guyancourt","Saumur","Herblay","Ris-Orangis","Villiers-le-Bel","Bourgoin-Jallieu","Vierzon","Le Gosier","D\xE9cines-Charpieu","H\xE9nin-Beaumont","Fresnes","Aurillac","Sannois","Vallauris","Illkirch-Graffenstaden","Alen\xE7on","\xC9lancourt","Tournefeuille","B\xE8gles","Gonesse","Oullins","Brunoy","Taverny","Armenti\xE8res","Montfermeil","Rambouillet","Villeparisis","Le Kremlin-Bic\xEAtre","Sucy-en-Brie","Kourou","Montb\xE9liard","Romainville","Cavaillon","Saint-Dizier","Br\xE9tigny-sur-Orge","Saint-S\xE9bastien-sur-Loire","Saintes","La Teste-de-Buch","Villeneuve-la-Garenne","B\xE9thune","Bussy-Saint-Georges","Vichy","La Garde","Agde","Laon","Sens","Lunel","Miramas","Biarritz","Le Grand-Quevilly","Orvault","Les Ulis","Champs-sur-Marne","Rochefort","Muret","Sainte-Anne","Eaubonne","\xC9tampes","Gradignan","Vernon","Petit-Bourg","Libourne","Abbeville","Rodez","Saint-Ouen-l'Aum\xF4ne","Torcy","Maisons-Laffitte","Montgeron","Villeneuve-sur-Lot","Cormeilles-en-Parisis","\xC9pernay","S\xE8vres","Dole","Le Robert","Le Bouscat","Blagnac","Frontignan","Cenon","Mandelieu-la-Napoule","Vertou","Les Lilas","Bruay-la-Buissi\xE8re","Les Pavillons-sous-Bois","Chaumont","Roissy-en-Brie","Le Moule","Le Petit-Quevilly","Manosque","Saint-Mand\xE9","Fontenay-aux-Roses","Orly","Le Creusot","Oyonnax","La Madeleine","Sainte-Suzanne","Millau","Combs-la-Ville","Fontaine","Deuil-la-Barre","Coudekerque-Branche","Auch","Lanester","Beaune","Montigny-l\xE8s-Metz","Hazebrouck","Longjumeau","Sainte-Foy-l\xE8s-Lyon","Forbach","Sarreguemines","Mons-en-Bar\u0153ul","La Valette-du-Var","H\xE9rouville-Saint-Clair","Morsang-sur-Orge","Grande-Synthe","La Celle-Saint-Cloud","Lisieux","Croix","Dammarie-les-Lys","V\xE9lizy-Villacoublay","Wasquehal","Saint-Gratien","Halluin","Neuilly-Plaisance","Montmorency","Dax","Lagny-sur-Marne","Le M\xE9e-sur-Seine","Saint-Genis-Laval","Fleury-les-Aubrais","Loos","Gif-sur-Yvette","Denain","Saint-Di\xE9-des-Vosges","Sainte-Rose","Saint-Michel-sur-Orge"].forEach((i,e)=>re.register(new se(i,Yp,e===0)))});var MB=w(GB=>{"use strict";Object.defineProperty(GB,"__esModule",{value:!0});AB();BB()});var bs,Rm,Np=n(()=>{nr();bs=class extends de{};t(bs,"German");Rm=bs});var Fj={};var UB=n(()=>{Np();vr();ir();Object.entries({people:"German",nation:"Germany",colors:["#000","#FC0"]}).forEach(([i,e])=>Oe.register(new we(Rm,i,e)))});var Yj={};var DB=n(()=>{Np();or();vt();["Berlin","Hamburg","Munich","Cologne","Frankfurt","Stuttgart","D\xFCsseldorf","Dortmund","Essen","Leipzig","Bremen","Dresden","Hanover","Nuremberg","Duisburg","Bochum","Wuppertal","Bielefeld","Bonn","M\xFCnster","Karlsruhe","Mannheim","Augsburg","Wiesbaden","Gelsenkirchen","M\xF6nchengladbach","Braunschweig","Chemnitz","Kiel","Aachen","Halle","Magdeburg","Freiburg","Krefeld","L\xFCbeck","Oberhausen","Erfurt","Mainz","Rostock","Kassel","Hagen","Hamm","Saarbr\xFCcken","M\xFClheim an der Ruhr","Potsdam","Ludwigshafen am Rhein","Oldenburg","Leverkusen","Osnabr\xFCck","Solingen"].forEach((i,e)=>re.register(new se(i,Rm,e===0)))});var SB=w(EB=>{"use strict";Object.defineProperty(EB,"__esModule",{value:!0});UB();DB()});var Cs,Wp,hu=n(()=>{nr();Cs=class extends de{};t(Cs,"Greek");Wp=Cs});var Nj={};var kB=n(()=>{hu();vr();ir();Object.entries({people:"Greek",nation:"Greece",colors:["#2175D8","#FFF"]}).forEach(([i,e])=>Oe.register(new we(Wp,i,e)))});var Wj={};var FB=n(()=>{hu();or();vt();["Athens","Thessaloniki","Patras","Piraeus","Larissa","Heraklion","Peristeri","Kallithea","Acharnes","Kalamaria","Nikaia","Glyfada","Volos","Ilio","Ilioupoli","Keratsini","Evosmos","Chalandri","Nea Smyrni","Marousi","Agios Dimitrios","Zografou","Egaleo","Nea Ionia","Ioannina","Palaio Faliro","Korydallos","Trikala","Vyronas","Agia Paraskevi","Galatsi","Agrinio","Chalcis","Petroupoli","Serres","Alexandroupoli","Xanthi","Katerini","Kalamata","Kavala","Chania","Lamia","Komotini","Irakleio","Rhodes","Kifissia","Stavroupoli","Chaidari","Drama","Veria","Alimos","Kozani","Polichni","Karditsa","Sykies","Ampelokipoi","Pylaia","Agioi Anargyroi","Argyroupoli","Ano Liosia","Nea Ionia","Rethymno","Ptolemaida","Tripoli","Cholargos","Vrilissia","Aspropyrgos","Corinth","Gerakas","Metamorfosi","Giannitsa","Voula","Kamatero","Mytilene","Neapoli","Eleftherio-Kordelio","Chios","Agia Varvara","Kaisariani","Nea Filadelfeia","Moschato","Perama","Salamina","Eleusis","Corfu","Pyrgos","Megara","Kilkis","Dafni","Thebes","Melissia","Argos","Arta","Artemida","Livadeia","Pefki","Oraiokastro","Aigio","Kos","Koropi","Preveza","Naousa","Orestiada","Peraia","Edessa","Florina","Panorama","Nea Erythraia1","Elliniko1","Amaliada","Pallini","Sparta","Agios Ioannis Rentis","Thermi","Vari","Nea Makri","Tavros","Alexandreia","Menemeni","Paiania","Kalyvia Thorikou","Nafplio","Drapetsona","Efkarpia","Papagou","Nafpaktos","Kastoria","Grevena","Pefka","Nea Alikarnassos","Missolonghi","Gazi","Ierapetra","Kalymnos","Rafina","Loutraki","Agios Nikolaos","Ermoupoli","Ialysos","Mandra","Tyrnavos","Glyka Nera","Ymittos","Neo Psychiko"].forEach((i,e)=>re.register(new se(i,Wp,e===0)))});var NB=w(YB=>{"use strict";Object.defineProperty(YB,"__esModule",{value:!0});kB();FB()});var Ts,Lp,Ou=n(()=>{nr();Ts=class extends de{};t(Ts,"Indian");Lp=Ts});var Lj={};var WB=n(()=>{Ou();vr();ir();Object.entries({people:"Indian",nation:"India",colors:["#138808","#FF9933"]}).forEach(([i,e])=>Oe.register(new we(Lp,i,e)))});var jj={};var LB=n(()=>{Ou();or();vt();["Delhi","Mumbai","Bangalore","Hyderabad","Ahmedabad","Chennai","Kolkata","Surat","Pune","Jaipur","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivli","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Dhanbad","Amritsar","Navi Mumbai","Allahabad","Howrah","Ranchi","Gwalior","Jabalpur","Coimbatore","Vijayawada","Jodhpur","Madurai","Raipur","Kota","Chandigarh","Guwahati","Solapur","Hubli\u2013Dharwad","Tiruchirappalli","Bareilly","Moradabad","Mysore","Tiruppur","Gurgaon","Aligarh","Jalandhar","Bhubaneswar","Salem","Mira-Bhayandar","Warangal","Jalgaon","Guntur","Bhiwandi","Saharanpur","Gorakhpur","Bikaner","Amravati","Noida","Jamshedpur","Bhilai","Cuttack","Firozabad","Kochi","Nellore","Bhavnagar","Dehradun","Durgapur","Asansol","Rourkela","Nanded","Kolhapur","Ajmer","Akola","Gulbarga","Jamnagar","Ujjain","Loni","Siliguri","Jhansi","Ulhasnagar","Jammu","Sangli-Miraj & Kupwad","Mangalore","Erode","Belgaum","Ambattur","Tirunelveli","Malegaon","Gaya","Thiruvananthapuram","Udaipur","Maheshtala","Davanagere","Kozhikode","Kurnool","Rajpur Sonarpur","Rajahmundry","Bokaro","South Dumdum","Bellary","Patiala","Gopalpur","Agartala","Bhagalpur","Muzaffarnagar","Bhatpara","Panihati","Latur","Dhule","Tirupati","Rohtak","Korba","Bhilwara","Berhampur","Muzaffarpur","Ahmednagar","Mathura","Kollam","Avadi","Kadapa","Kamarhati","Sambalpur","Bilaspur","Shahjahanpur","Satara","Bijapur","Kakinada","Rampur","Shimoga","Chandrapur","Junagadh","Thrissur","Alwar","Bardhaman","Kulti","Nizamabad","Parbhani","Tumkur","Khammam","Ozhukarai","Bihar Sharif","Panipat","Darbhanga","Bally","Aizawl","Dewas","Ichalkaranji","Karnal","Bathinda","Jalna","Eluru","Barasat","Kirari Suleman Nagar","Purnia","Satna","Mau","Sonipat","Farrukhabad","Sagar","Durg","Imphal","Ratlam","Hapur","Arrah","Anantapur","Karimnagar","Etawah","Ambarnath","North Dumdum","Bharatpur","Begusarai","New Delhi","Gandhidham","Baranagar","Tiruvottiyur","Pondicherry","Sikar","Thoothukudi","Rewa","Mirzapur","Raichur","Pali","Ramagundam","Haridwar","Vijayanagaram","Katihar","Nagercoil","Sri Ganganagar","Karawal Nagar","Mango","Thanjavur","Bulandshahr","Uluberia","Katni","Sambhal","Singrauli","Nadiad","Secunderabad","Naihati","Yamunanagar","Bidhannagar","Pallavaram","Bidar","Munger","Panchkula","Burhanpur","Raurkela Industrial Township","Kharagpur","Dindigul","Gandhinagar","Hospet","Nangloi Jat","Malda","Ongole","Deoghar","Chapra","Haldia","Khandwa","Nandyal","Morena","Amroha","Anand","Bhind","Bhalswa Jahangir Pur","Madhyamgram","Bhiwani","Berhampore","Ambala","Morbi","Fatehpur","Raebareli","Mahaboobnagar","Chittoor","Bhusawal","Orai","Bahraich","Vellore","Mehsana","Raiganj","Sirsa","Danapur","Serampore","Sultan Pur Majra","Guna","Jaunpur","Panvel","Shivpuri","Surendranagar Dudhrej","Unnao","Chinsurah","Alappuzha","Kottayam","Machilipatnam","Shimla","Adoni","Udupi","Tenali","Proddatur","Saharsa","Hindupur","Sasaram","Hajipur","Bhimavaram","Kumbakonam","Dehri","Madanapalle","Siwan","Bettiah","Guntakal","Srikakulam","Motihari","Dharmavaram","Gudivada","Phagwara","Narasaraopet","Suryapet","Miryalaguda","Tadipatri","Karaikudi","Kishanganj","Jamalpur","Ballia","Kavali","Tadepalligudem","Amaravati","Buxar","Jehanabad","Aurangabad","Gangtok"].forEach((i,e)=>re.register(new se(i,Lp,e===0)))});var zB=w(jB=>{"use strict";Object.defineProperty(jB,"__esModule",{value:!0});WB();LB()});var Ps,jp,xu=n(()=>{nr();Ps=class extends de{};t(Ps,"Mongol");jp=Ps});var zj={};var HB=n(()=>{xu();vr();ir();Object.entries({people:"Mongol",nation:"Mongolia",colors:["#DA2032","#0066B3"]}).forEach(([i,e])=>Oe.register(new we(jp,i,e)))});var Hj={};var _B=n(()=>{xu();or();vt();["Ulaanbaatar","Erdenet","Darkhan","Choibalsan","M\xF6r\xF6n","Nalaikh","Bayankhongor","\xD6lgii","Khovd","Arvaikheer","Ulaangom","Baganuur","Sainshand","Tsetserleg","S\xFCkhbaatar","\xD6nd\xF6rkhaan","Dalanzadgad","Z\xFC\xFCnkharaa","Uliastai","Altai","Baruun-Urt","Mandalgovi","Zuunmod","Zamyn-\xDC\xFCd","Bulgan","Kharkhorin","Choir","Bor-\xD6nd\xF6r","Sharyngo"].forEach((i,e)=>re.register(new se(i,jp,e===0)))});var qB=w(KB=>{"use strict";Object.defineProperty(KB,"__esModule",{value:!0});HB();_B()});var Is,zp,Ru=n(()=>{nr();Is=class extends de{};t(Is,"Roman");zp=Is});var _j={};var VB=n(()=>{Ru();vr();ir();Object.entries({people:"Roman",nation:"Rome",colors:["#A20101","#D1B24F"]}).forEach(([i,e])=>Oe.register(new we(zp,i,e)))});var Kj={};var JB=n(()=>{Ru();or();vt();["Roma","Ariminum","Belum","Placentia","Tarraco","Italica","Mod","Salernum","Bononia","Forum Livii","Regium Lepidi","Aquileia","Ascrivium","Valentia Edetanorum","Scalabis","Villa Euracini","Palma","Colonia Narbo Martius","Massa","Pistoria","Segovia","Gerunda","Pompaelo","Naissus","Brigantium","Florentia","Vesontio","Lutetia Parisiorum","Atuatuca Tungrorum","Iulia Romula Hispalis","Augusta Raurica","Noviodunum","Lugdunum","Siscia","Marsonia","Augusta Treverorum","Castra Legionis","Augusta Taurinorum","Augusta Praetoria Salassorum","Emerita Augusta","Norba Caesarina","Lucus Augusta","Caesarea","Bracara Augusta","Novaesium","Castra Vetera","Pons Drusi","Ovilava","Iuvavum","Augusta Vindelicorum","Turicum","Asturica Augusta","Borbetomagus","Caesaraugusta","Sirmium","Sorviodurum","Mogontiacum","Argentoratum","Bonna","Noviomagus","Castellum apud Confluentes","Divodurum","Caesaromagus","Ambianum","Faventia Paterna Barcino","Abila","Lousonna","Ulpia Noviomagus Batavorum","Rigomagus","Aquae Mattiacorum","Mursa","Emona","Vindonissa","Aventicum","Praetorium Agrippinae","Lugdunum Batavorum","Aequum","Londinium","Albanianis","Lauri","Durovernum Cantiacorum","Regulbium","Rutupiae","Viminacium","Camulodunum","Traiectum","Matilo","Forum Hadriani","Nigrum Pullum","Lindum Colonia","Ratae Corieltauvorum","Durocobrivis","Colonia Agrippina","Durocornovium","Verulamium","Letocetum","Dubris","Danum","Mediolanum","Isca Dumnoniorum","Blestium","Viroconium Cornoviorum","Aquae Sulis","Durnovaria","Lindinis","Ad Flexum","Clausentum","Venta Belgarum","Calleva Atrebatum","Duroliponte","Concangis","Condate","Corinium Dobunnorum","Eboracum","Luguvalium","Arae Flaviae","Isca Augusta","Lagentium","Lopodunum","Moridunum","Venta Silurum","Deva Victrix","Mamucium","Olicana","Vinovia","Bonames","Coria","Gerulata","Vindobona","Biriciana","Cannstatt Castrum","Colonia Nervia Glevensium","Sumelocenna","Lopodunum","Traiectum ad Nicrem","Castra Batavar","Nida","Lactodurum","Bovium","Burgodunum","Lentia","Aquae Granni","Complutum","Aeminium","Traiectum ad Mosam","Coriovallum","Portus Lemanis","Andautonia","Salona","Cibalae","Aquae Helveticae","Aquincum","Apulum","Pons Aelius","Durovigutum","Aelia Capitolina","Ala","Castra Regina","Theranda","Pomaria","Partiscum","Gesoriacum","Aurelia Aquensis","Urbs Aurelianorum","Venetiae","Ragusium"].forEach((i,e)=>re.register(new se(i,zp,e===0)))});var ZB=w($B=>{"use strict";Object.defineProperty($B,"__esModule",{value:!0});VB();JB()});var ws,vm,Hp=n(()=>{nr();ws=class extends de{};t(ws,"Russian");vm=ws});var qj={};var QB=n(()=>{Hp();vr();ir();Object.entries({people:"Russian",nation:"Russia",colors:["#0032A0","#DA291C"]}).forEach(([i,e])=>Oe.register(new we(vm,i,e)))});var Vj={};var XB=n(()=>{Hp();or();vt();["Moscow","Saint Petersburg","Novosibirsk","Yekaterinburg","Nizhny Novgorod","Kazan","Chelyabinsk","Omsk","Samara","Ufa","Rostov-on-Don","Krasnoyarsk","Voronezh","Perm","Volgograd","Krasnodar","Saratov","Tyumen","Makhachkala","Tolyatti","Barnaul","Ulyanovsk","Izhevsk","Vladivostok","Irkutsk","Khabarovsk","Yaroslavl","Tomsk","Orenburg","Kemerovo","Novokuznetsk","Tula","Ryazan","Kirov","Astrakhan","Naberezhnye Chelny","Sochi","Penza","Lipetsk","Cheboksary","Balashikha","Kaliningrad","Kursk","Stavropol","Ulan-Ude","Bryansk","Tver","Magnitogorsk","Ivanovo","Belgorod","Surgut","Vladimir","Arkhangelsk","Nizhny Tagil","Kaluga","Chita","Saransk","Yakutsk","Smolensk","Podolsk","Volzhsky","Vladikavkaz","Vologda","Cherepovets","Kurgan","Oryol","Grozny","Murmansk","Tambov","Petrozavodsk","Sterlitamak","Kostroma","Nizhnevartovsk","Novorossiysk","Yoshkar-Ola","Taganrog","Komsomolsk-on-Amur","Khimki","Syktyvkar","Nalchik","Nizhnekamsk","Shakhty","Dzerzhinsk","Bratsk","Orsk","Angarsk","Engels","Blagoveshchensk","Stary Oskol","Veliky Novgorod","Korolyov","Pskov","Mytishchi","Biysk","Lyubertsy","Prokopyevsk","Yuzhno-Sakhalinsk","Balakovo","Armavir","Rybinsk","Severodvinsk","Abakan","Petropavlovsk-Kamchatsky","Norilsk","Syzran","Volgodonsk","Ussuriysk","Kamensk-Uralsky","Novocherkassk","Zlatoust","Elektrostal","Almetyevsk","Krasnogorsk","Salavat","Miass","Nakhodka","Kopeysk","Pyatigorsk","Rubtsovsk","Berezniki","Kolomna","Maykop","Odintsovo","Khasavyurt","Kovrov","Kislovodsk","Neftekamsk","Nefteyugansk","Novocheboksarsk","Serpukhov","Shchyolkovo","Novomoskovsk","Bataysk","Pervouralsk","Domodedovo","Derbent","Cherkessk","Orekhovo-Zuyevo","Nevinnomyssk","Dimitrovgrad","Nazran","Kyzyl","Oktyabrsky","Obninsk","Kaspiysk","Novy Urengoy","Ramenskoye","Kamyshin","Murom","Zhukovsky"].forEach((i,e)=>re.register(new se(i,vm,e===0)))});var tG=w(eG=>{"use strict";Object.defineProperty(eG,"__esModule",{value:!0});QB();XB()});var As,_p,vu=n(()=>{nr();As=class extends de{};t(As,"Zulu");_p=As});var Jj={};var rG=n(()=>{vu();vr();ir();Object.entries({people:"Zulu",nation:"Zulus",colors:["#FFFD1E","#000"]}).forEach(([i,e])=>Oe.register(new we(_p,i,e)))});var $j={};var iG=n(()=>{vu();or();vt();["uMgungundlovu","Nobamba","Bulawayo","KwaDukuza","Nongoma","oNdini","Nodwengu","Ndondakusuka","Babanango","Khangela","Kwahlomendlini","Hlobane","eThekwini","Mlambongwenya","Eziqwaqweni","Isiphezi","Masotsheni","Mtunzini","Nyakamubi","Hlatikulu","Mthonjaneni","Empangeni","Pongola","Tungela","Kwamashu","Ingwavuma","Hluhluwe","Mtubatuba","Mhlahlandlela","Mthatha","Maseru","Lobamba","Qunu"].forEach((i,e)=>re.register(new se(i,_p,e===0)))});var nG=w(oG=>{"use strict";Object.defineProperty(oG,"__esModule",{value:!0});rG();iG()});var Zj={};var aG=n(()=>{E();kg();v.register(ru)});var lG=w(sG=>{"use strict";Object.defineProperty(sG,"__esModule",{value:!0});aG()});var Qj={};var mG=n(()=>{E();ob();v.register(yw)});var cG=w(pG=>{"use strict";Object.defineProperty(pG,"__esModule",{value:!0});mG()});var Xj={};var uG=n(()=>{E();nb();v.register(dw)});var yG=w(fG=>{"use strict";Object.defineProperty(fG,"__esModule",{value:!0});uG()});var ez={};var dG=n(()=>{E();ab();v.register(gw)});var hG=w(gG=>{"use strict";Object.defineProperty(gG,"__esModule",{value:!0});dG()});var tz={};var OG=n(()=>{E();Fg();v.register(iu)});var RG=w(xG=>{"use strict";Object.defineProperty(xG,"__esModule",{value:!0});OG()});var rz={};var vG=n(()=>{E();sb();v.register(hw)});var CG=w(bG=>{"use strict";Object.defineProperty(bG,"__esModule",{value:!0});vG()});var iz={};var TG=n(()=>{E();lb();v.register(Ow)});var IG=w(PG=>{"use strict";Object.defineProperty(PG,"__esModule",{value:!0});TG()});var oz={};var wG=n(()=>{E();Ng();v.register(Yg)});var BG=w(AG=>{"use strict";Object.defineProperty(AG,"__esModule",{value:!0});wG()});var nz={};var GG=n(()=>{E();mb();v.register(xw)});var UG=w(MG=>{"use strict";Object.defineProperty(MG,"__esModule",{value:!0});GG()});var az={};var DG=n(()=>{E();pb();v.register(Rw)});var SG=w(EG=>{"use strict";Object.defineProperty(EG,"__esModule",{value:!0});DG()});var sz={};var kG=n(()=>{E();Wg();v.register(ou)});var YG=w(FG=>{"use strict";Object.defineProperty(FG,"__esModule",{value:!0});kG()});var lz={};var NG=n(()=>{E();cb();v.register(vw)});var LG=w(WG=>{"use strict";Object.defineProperty(WG,"__esModule",{value:!0});NG()});var mz={};var jG=n(()=>{E();Lg();v.register(nu)});var HG=w(zG=>{"use strict";Object.defineProperty(zG,"__esModule",{value:!0});jG()});var pz={};var _G=n(()=>{E();ub();v.register(bw)});var qG=w(KG=>{"use strict";Object.defineProperty(KG,"__esModule",{value:!0});_G()});var cz={};var VG=n(()=>{E();fb();v.register(Cw)});var $G=w(JG=>{"use strict";Object.defineProperty(JG,"__esModule",{value:!0});VG()});var uz={};var ZG=n(()=>{E();jg();v.register(hm)});var XG=w(QG=>{"use strict";Object.defineProperty(QG,"__esModule",{value:!0});ZG()});var fz={};var eM=n(()=>{E();yb();v.register(Tw)});var rM=w(tM=>{"use strict";Object.defineProperty(tM,"__esModule",{value:!0});eM()});var yz={};var iM=n(()=>{E();db();v.register(Pw)});var nM=w(oM=>{"use strict";Object.defineProperty(oM,"__esModule",{value:!0});iM()});var dz={};var aM=n(()=>{E();gb();v.register(Iw)});var lM=w(sM=>{"use strict";Object.defineProperty(sM,"__esModule",{value:!0});aM()});var gz={};var mM=n(()=>{E();hb();v.register(ww)});var cM=w(pM=>{"use strict";Object.defineProperty(pM,"__esModule",{value:!0});mM()});var hz={};var uM=n(()=>{E();Ob();v.register(Aw)});var yM=w(fM=>{"use strict";Object.defineProperty(fM,"__esModule",{value:!0});uM()});var Oz={};var dM=n(()=>{E();xb();v.register(Bw)});var hM=w(gM=>{"use strict";Object.defineProperty(gM,"__esModule",{value:!0});dM()});var xz={};var OM=n(()=>{E();Rb();v.register(Gw)});var RM=w(xM=>{"use strict";Object.defineProperty(xM,"__esModule",{value:!0});OM()});var Rz={};var vM=n(()=>{E();vb();v.register(Mw)});var CM=w(bM=>{"use strict";Object.defineProperty(bM,"__esModule",{value:!0});vM()});var vz={};var TM=n(()=>{E();bb();v.register(Uw)});var IM=w(PM=>{"use strict";Object.defineProperty(PM,"__esModule",{value:!0});TM()});var bz={};var wM=n(()=>{E();Hg();v.register(zg)});var BM=w(AM=>{"use strict";Object.defineProperty(AM,"__esModule",{value:!0});wM()});var Cz={};var GM=n(()=>{E();Cb();v.register(Dw)});var UM=w(MM=>{"use strict";Object.defineProperty(MM,"__esModule",{value:!0});GM()});var Tz={};var DM=n(()=>{E();Tb();v.register(Ew)});var SM=w(EM=>{"use strict";Object.defineProperty(EM,"__esModule",{value:!0});DM()});var Pz={};var kM=n(()=>{E();_g();v.register(Gp)});var YM=w(FM=>{"use strict";Object.defineProperty(FM,"__esModule",{value:!0});kM()});var Iz={};var NM=n(()=>{E();qg();v.register(Kg)});var LM=w(WM=>{"use strict";Object.defineProperty(WM,"__esModule",{value:!0});NM()});var wz={};var jM=n(()=>{E();Vg();v.register(au)});var HM=w(zM=>{"use strict";Object.defineProperty(zM,"__esModule",{value:!0});jM()});var Az={};var _M=n(()=>{E();Pb();v.register(Sw)});var qM=w(KM=>{"use strict";Object.defineProperty(KM,"__esModule",{value:!0});_M()});var Bz={};var VM=n(()=>{E();$g();v.register(Jg)});var $M=w(JM=>{"use strict";Object.defineProperty(JM,"__esModule",{value:!0});VM()});var Gz={};var ZM=n(()=>{E();Qg();v.register(Zg)});var XM=w(QM=>{"use strict";Object.defineProperty(QM,"__esModule",{value:!0});ZM()});var Mz={};var eU=n(()=>{E();Ib();v.register(kw)});var rU=w(tU=>{"use strict";Object.defineProperty(tU,"__esModule",{value:!0});eU()});var Uz={};var iU=n(()=>{E();Xg();v.register(su)});var nU=w(oU=>{"use strict";Object.defineProperty(oU,"__esModule",{value:!0});iU()});var Dz={};var aU=n(()=>{E();th();v.register(eh)});var lU=w(sU=>{"use strict";Object.defineProperty(sU,"__esModule",{value:!0});aU()});var Ez={};var mU=n(()=>{E();wb();v.register(Fw)});var cU=w(pU=>{"use strict";Object.defineProperty(pU,"__esModule",{value:!0});mU()});var Sz={};var uU=n(()=>{E();ih();v.register(rh)});var yU=w(fU=>{"use strict";Object.defineProperty(fU,"__esModule",{value:!0});uU()});var kz={};var dU=n(()=>{E();nh();v.register(oh)});var hU=w(gU=>{"use strict";Object.defineProperty(gU,"__esModule",{value:!0});dU()});var Fz={};var OU=n(()=>{E();Ab();v.register(Yw)});var RU=w(xU=>{"use strict";Object.defineProperty(xU,"__esModule",{value:!0});OU()});var Yz={};var vU=n(()=>{E();ah();v.register(lu)});var CU=w(bU=>{"use strict";Object.defineProperty(bU,"__esModule",{value:!0});vU()});var Nz={};var TU=n(()=>{E();Bb();v.register(Nw)});var IU=w(PU=>{"use strict";Object.defineProperty(PU,"__esModule",{value:!0});TU()});var Wz={};var wU=n(()=>{E();Gb();v.register(Ww)});var BU=w(AU=>{"use strict";Object.defineProperty(AU,"__esModule",{value:!0});wU()});var Lz={};var GU=n(()=>{E();sh();v.register(mu)});var UU=w(MU=>{"use strict";Object.defineProperty(MU,"__esModule",{value:!0});GU()});var jz={};var DU=n(()=>{E();Mb();v.register(Lw)});var SU=w(EU=>{"use strict";Object.defineProperty(EU,"__esModule",{value:!0});DU()});var zz={};var kU=n(()=>{E();Ub();v.register(jw)});var YU=w(FU=>{"use strict";Object.defineProperty(FU,"__esModule",{value:!0});kU()});var Hz={};var NU=n(()=>{E();Db();v.register(zw)});var LU=w(WU=>{"use strict";Object.defineProperty(WU,"__esModule",{value:!0});NU()});var _z={};var jU=n(()=>{E();Eb();v.register(Hw)});var HU=w(zU=>{"use strict";Object.defineProperty(zU,"__esModule",{value:!0});jU()});var Kz={};var _U=n(()=>{E();lh();v.register(pu)});var qU=w(KU=>{"use strict";Object.defineProperty(KU,"__esModule",{value:!0});_U()});var qz={};var VU=n(()=>{E();Sb();v.register(_w)});var $U=w(JU=>{"use strict";Object.defineProperty(JU,"__esModule",{value:!0});VU()});var Vz={};var ZU=n(()=>{E();kb();v.register(Kw)});var XU=w(QU=>{"use strict";Object.defineProperty(QU,"__esModule",{value:!0});ZU()});var Jz={};var eD=n(()=>{E();Fb();v.register(qw)});var rD=w(tD=>{"use strict";Object.defineProperty(tD,"__esModule",{value:!0});eD()});var $z={};var iD=n(()=>{E();Yb();v.register(Vw)});var nD=w(oD=>{"use strict";Object.defineProperty(oD,"__esModule",{value:!0});iD()});var Zz={};var aD=n(()=>{E();Nb();v.register(Jw)});var lD=w(sD=>{"use strict";Object.defineProperty(sD,"__esModule",{value:!0});aD()});var Qz={};var mD=n(()=>{E();cu();v.register(fs)});var cD=w(pD=>{"use strict";Object.defineProperty(pD,"__esModule",{value:!0});mD()});var Xz={};var uD=n(()=>{E();ph();v.register(mh)});var yD=w(fD=>{"use strict";Object.defineProperty(fD,"__esModule",{value:!0});uD()});var eH={};var dD=n(()=>{E();uh();v.register(ch)});var hD=w(gD=>{"use strict";Object.defineProperty(gD,"__esModule",{value:!0});dD()});var tH={};var OD=n(()=>{E();yh();v.register(fh)});var RD=w(xD=>{"use strict";Object.defineProperty(xD,"__esModule",{value:!0});OD()});var rH={};var vD=n(()=>{E();gh();v.register(dh)});var CD=w(bD=>{"use strict";Object.defineProperty(bD,"__esModule",{value:!0});vD()});var iH={};var TD=n(()=>{E();Wb();v.register($w)});var ID=w(PD=>{"use strict";Object.defineProperty(PD,"__esModule",{value:!0});TD()});var oH={};var wD=n(()=>{E();jb();v.register(Qw)});var BD=w(AD=>{"use strict";Object.defineProperty(AD,"__esModule",{value:!0});wD()});var nH={};var GD=n(()=>{E();Lb();v.register(Zw)});var UD=w(MD=>{"use strict";Object.defineProperty(MD,"__esModule",{value:!0});GD()});var aH={};var DD=n(()=>{E();Oh();v.register(hh)});var SD=w(ED=>{"use strict";Object.defineProperty(ED,"__esModule",{value:!0});DD()});var sH={};var kD=n(()=>{E();Rh();v.register(xh)});var YD=w(FD=>{"use strict";Object.defineProperty(FD,"__esModule",{value:!0});kD()});var lH={};var ND=n(()=>{E();zb();v.register(Xw)});var LD=w(WD=>{"use strict";Object.defineProperty(WD,"__esModule",{value:!0});ND()});var mH={};var jD=n(()=>{E();bh();v.register(vh)});var HD=w(zD=>{"use strict";Object.defineProperty(zD,"__esModule",{value:!0});jD()});var pH,_D,KD=n(()=>{Zm();C();X();pH=t((i=P)=>[new zi(new p((e,r)=>{i.emit("city:building-complete",e,r)}))],"getRules"),_D=pH});var cH,qD,VD=n(()=>{et();Ke();Ri();OR();C();cH=t((i=K,e=j,r=Ge)=>[new Lm(new p(o=>!r.tileIsWorked(o))),new Lm(new p((o,a)=>!e.getByTile(o).some(s=>s.player()!==a.player()))),new Lm(new p((o,a)=>{let s=i.getByTile(o);return s===null?!0:s===a}))],"getRules"),qD=cH});var uH,JD,$D=n(()=>{et();Et();da();Ke();X();Zl();C();Ml();Ci();Ri();uH=t((i=K,e=j,r=ie,o=Kt,a=P,s=oe,l=Ge)=>[new Rr(new p(c=>o.getByCity(c).progress().set(0))),new Rr(new p(c=>r.getByCity(c).shrink())),new Rr(new p((c,u,y)=>{a.emit("city:captured",c,u,y)})),new Rr(new p(c=>e.getByCity(c).forEach(u=>u.destroy()))),new Rr(new p(c=>kd(c,s,r,l)))],"getRules"),JD=uH});var fH,ZD,QD=n(()=>{Pa();ra();Et();Ln();Ke();Km();U();C();LR();Jo();jR();HR();fH=t((i=ie,e=Pt,r=j)=>[new ut(new p(o=>new rP(i.getByCity(o).size()*2))),...[[Le,1,fo,cr],[Le,2,Ft,ht,Ot,wt]].map(([o,a,...s])=>new ut(new m(l=>r.getByCity(l).some(c=>c instanceof o)),new m(l=>e.getByPlayer(l.player()).is(...s)),new p(l=>r.getByCity(l).filter(c=>c instanceof o).map(c=>new iP(a,c))))),new ut(new m(o=>e.getByPlayer(o.player()).is(fo,cr)),new m(o=>{let a=i.getByCity(o);return r.getByCity(o).filter(s=>[gt,_,We,Jt].some(l=>s instanceof l)).length>a.size()}),new p(o=>{let a=i.getByCity(o);return r.getByCity(o).filter(s=>[gt,_,We,Jt].some(l=>s instanceof l)).slice(a.size()).map(s=>new zR(1,s))})),new ut(new m(o=>e.getByPlayer(o.player()).is(Ft,ht,Ot,wt)),new p(o=>r.getByCity(o).filter(a=>[gt,_,We,Jt].some(s=>a instanceof s)).map(a=>new zR(1,a))))],"getRules"),ZD=fH});var Bh,Kp,Gh=n(()=>{M();Bh=class extends h{};t(Bh,"TileReassigned");Kp=Bh});var yH,XD,eE=n(()=>{em();da();Et();et();X();Ia();Ci();B();bi();Ri();Rc();sy();wf();U();C();Gh();Rf();Ml();yH=t((i=_e,e=Kt,r=ie,o=K,a=oe,s=f,l=vo,c=P,u=Ge)=>[...[Ye,qe].map(y=>new pn(new m(O=>i.getByTile(O.tile()).every(G=>!(G instanceof y))),new p(O=>i.register(new y(O.tile()))))),new pn(new p(y=>e.register(new nl(y,l,s)))),new pn(new p(y=>r.register(new om(y,s)))),new pn(new p(y=>o.register(y))),new pn(new p(y=>{c.emit("city:created",y)})),new pn(new p(y=>{let O=u.getByTile(y.tile());O!==null&&u.unregister(O),u.register(new rl(y.tile(),y)),O!==null&&s.process(Kp,O.city(),O.tile()),vp(y,a,r,u)}))],"getRules"),XD=yH});var dH,tE,rE=n(()=>{et();X();bi();Ke();Ql();C();Ia();Ri();dH=t((i=_e,e=K,r=P,o=j,a=Ge)=>[new zr(new p(s=>i.getByTile(s.tile()).filter(l=>l instanceof Ye).forEach(l=>i.unregister(l)))),new zr(new p((s,l)=>{r.emit("city:destroyed",s,l)})),new zr(new p(s=>o.getByCity(s).forEach(l=>l.destroy()))),new zr(new p(s=>a.getByCity(s).forEach(l=>a.unregister(l))))],"getRules"),tE=dH});var Mh,Uh,OC=n(()=>{M();Mh=class extends h{};t(Mh,"FoodExhausted");Uh=Mh});var gH,iE,oE=n(()=>{C();OC();gH=t(()=>[new Uh(new p(i=>i.shrink()))],"getRules"),iE=gH});var hH,nE,aE=n(()=>{B();U();C();SR();OC();hH=t((i=f)=>[new bc(new m(e=>e.progress().value()>=e.cost().value()),new p(e=>e.grow())),new bc(new m(e=>e.progress().value()<0),new p(e=>{i.process(Uh,e)}))],"getRules"),nE=hH});var OH,sE,lE=n(()=>{Et();Ci();U();C();oy();Ml();Ri();OH=t((i=ie,e=oe,r=Ge)=>[new Oa(new p(o=>o.empty())),new Oa(new p(o=>o.cost().set((o.size()+1)*10,"city-grow"))),new Oa(new m(o=>o.city().tilesWorked().length<o.size()+1),new p(o=>wI(o.city(),e,i,r))),new Oa(new m(o=>o.city().tilesWorked().length>o.size()+1),new p(o=>Fd(o.city(),o).forEach(a=>r.unregisterByTile(a))))],"getRules"),sE=OH});var xH,mE,pE=n(()=>{DR();C();xH=t(()=>[new ey(new p(i=>10*(i.size()+1)))],"getRules"),mE=xH});var Dh,$o,bm=n(()=>{M();Dh=class extends h{};t(Dh,"CivilDisorder");$o=Dh});var Eh,Zo,qp=n(()=>{M();Eh=class extends h{};t(Eh,"ProcessYield");Zo=Eh});var Sh,Cm,kh=n(()=>{M();Sh=class extends h{};t(Sh,"Unsupported");Cm=Sh});var RH,cE,uE=n(()=>{da();Et();Va();Ja();B();Ke();bm();U();C();qp();kh();RH=t((i=Kt,e=ie,r=j,o=f)=>[new Zo(new m(a=>a instanceof te),new p((a,s,l)=>{let c=e.getByCity(s),u=new ha(a);l.forEach(y=>{if(!(y instanceof xl)||u.value()>=0)return;let O=y.unit();O!==null&&(o.process(Cm,s,O,y),u.subtract(y))}),c.add(u),c.check()})),new Zo(new m(a=>a instanceof Q),new p((a,s,l)=>{let c=i.getByCity(s),u=a.clone();l.filter(O=>O instanceof Rl).sort((O,G)=>(O.unit()?.tile().distanceFrom(s.tile())??0)-(G.unit()?.tile().distanceFrom(s.tile())??0)).forEach(O=>{if(u.value()>=0)return;let G=O.unit();G!==null&&(o.process(Cm,s,G,O),u.subtract(O))});let y=s.yields();o.process($o,s,y).some(O=>O)||c.add(u),c.check()}))],"getRules"),cE=RH});var vH,fE,yE=n(()=>{Et();Ci();U();C();kR();Ml();Ri();vH=t((i=ie,e=oe,r=Ge)=>[new Qm(new m(o=>o.size()>0),new p(o=>o.cost().set((o.size()+1)*10,"city-shrink"))),new Qm(new m(o=>o.size()>0),new m(o=>o.city().tilesWorked().length>o.size()+1),new p(o=>Fd(o.city(),o).forEach(a=>r.unregisterByTile(a)))),new Qm(new m(o=>o.size()<=0),new p(o=>o.city().destroy()))],"getRules"),fE=vH});var bH,dE,gE=n(()=>{Et();Ci();Ri();C();Gh();Ml();bH=t((i=oe,e=ie,r=Ge)=>[new Kp(new p(o=>vp(o,i,e,r)))],"getRules"),dE=bH});var CH,hE,OE=n(()=>{C();CR();Oc();CH=t(()=>[new Tf(new p(i=>Hm.from(...i.tile().getSurroundingArea(2).filter((e,r)=>![0,4,20,24].includes(r)))))],"getRules"),hE=CH});var Fh,Be,Wr=n(()=>{He();ge();Fh=class extends Y{constructor(){super(z)}getByCity(e,r=!1){return this.filter(o=>o.city()===e&&!o.destroyed())}};t(Fh,"CityImprovementRegistry");Be=new Fh});var TH,xE,RE=n(()=>{ra();Wr();Ja();Ln();C();Ha();Hb();Qs();Vm();Go();TH=t((i=Be,e=Pt)=>[new cn(new za,new p((r,o)=>{let a=e.getByPlayer(r.player()),[s]=i.filter(y=>y instanceof vA&&r.player()===y.city().player()).map(y=>y.city()),l=Ve(o,ce),c=a.is(Ft)?10:a.is(ht)?0:s?s.tile().distanceFrom(r.tile()):32,[u]=[[fo,8],[Ft,20],[ht,0],[cr,12],[Ot,16],[wt,24]].filter(([y])=>a.is(y)).map(([,y])=>y);return new fn(u?Math.min(Math.floor(l*c*3/(10*u)),l):0,c.toFixed(2))})),new cn(new xi(0),new p(r=>r.tilesWorked().entries().flatMap(o=>o.yields(r.player()).flatMap(a=>new a.constructor(a.value(),o.id()+": "+a.values().map(([,s])=>s).join("-"))))))],"getRules"),xE=TH});var PH,vE,bE=n(()=>{BR();da();et();Dn();U();C();PH=t((i=Kt,e=K)=>[new it(new m(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).some(o=>!o.building())),new p(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).filter(o=>!o.building()).map(o=>new ga(r,o)))),new it(new m(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).some(o=>!!o.building())),new p(r=>e.getByPlayer(r).map(o=>i.getByCity(o)).filter(o=>!!o.building()).map(o=>new ml(r,o))))],"getRules"),vE=PH});var IH,CE,TE=n(()=>{Et();et();X();pm();U();Ac();C();IH=t((i=K,e=ie,r=P)=>[new dn(new m((o,a,s)=>s instanceof Vi&&s.to()===o.tile()&&i.getByTile(s.to())!==null),new p(o=>{let a=i.getByTile(o.tile());e.getByCity(a).shrink()})),new dn(new p((o,a,s)=>r.emit("unit:defeated",o,a,s)))],"getRules"),CE=IH});var wH,PE,IE=n(()=>{B();Ri();U();C();Dt();Gh();wH=t((i=f,e=Ge)=>[new Z(new m(r=>r.moves().value()===0),new m((r,o)=>e.tileIsWorked(o.to())),new m((r,o)=>{let a=e.getByTile(o.to());return a.city().player()===r.player()?!1:!e.tileCanBeWorkedBy(a.tile(),a.city())}),new p((r,o)=>{let a=e.getByTile(o.to());e.unregister(a),i.process(Kp,a.city(),o.to())}))],"getRules"),PE=wH});var AH,wE,AE=n(()=>{C();kh();AH=t(()=>[new Cm(new p((i,e)=>e.destroy()))],"getRules"),wE=AH});var BH={};var BE=n(()=>{KD();VD();$D();QD();eE();rE();oE();aE();lE();pE();uE();yE();gE();OE();RE();B();bE();TE();IE();AE();f.register(..._D(),...qD(),...JD(),...ZD(),...XD(),...tE(),...iE(),...nE(),...sE(),...mE(),...cE(),...fE(),...hE(),...dE(),...xE(),...vE(),...CE(),...PE(),...wE())});var ME=w(GE=>{"use strict";Object.defineProperty(GE,"__esModule",{value:!0});BE()});var Yh,Nh,xC=n(()=>{Tc();Ol();Go();Yh=t((i,e=i.city().yields())=>{let r=i.city(),o=new Array(i.size()).fill(1),[a,s]=um(e,by,xa),l=o.length-1;for(;s>0&&l>-1;)o[l--]=0,s--;for(l=0;a>0&&l<o.length;)o[l]===0&&(o[l]=1,a--),o[l]===1&&(o[l++]=2,a--),o[l]===2&&l++;return o},"calculateCitizenState"),Nh=t(i=>i.reduce(([e,r,o],a)=>[e+(a===0?1:0),r+(a===1?1:0),o+(a===2?1:0)],[0,0,0]),"citizenSummary")});var Wh,Vp,Lh=n(()=>{M();Wh=class extends h{};t(Wh,"CelebrateLeader");Vp=Wh});var GH,UE,DE=n(()=>{Et();xC();Lh();U();C();GH=t((i=ie)=>[new Vp(new m(e=>i.getByCity(e).size()>2),new p((e,r=e.yields())=>{let o=i.getByCity(e),a=Yh(o,r),[s,,l]=Nh(a);return s===0&&Math.floor(l)>=o.size()/2}))],"getRules"),UE=GH});var MH,EE,SE=n(()=>{Et();xC();bm();C();MH=t((i=ie)=>[new $o(new p((e,r=e.yields())=>{let o=i.getByCity(e),a=Yh(o,r),[s,,l]=Nh(a);return s>l}))],"getRules"),EE=MH});var Tm,kE=n(()=>{Ol();gl();Tm=class extends xa{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t(Tm,"CityImprovementContent");vi(Tm)});var Jp,FE=n(()=>{Tc();Jp=class extends by{};t(Jp,"LuxuryHappiness")});var Pm,YE=n(()=>{Ol();gl();Pm=class extends xa{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(Pm,"MartialLaw");vi(Pm)});var Bs,NE=n(()=>{Ol();Bs=class extends xa{#e;constructor(e,r){super(e,r.id()),this.#e=r,this.addKey("unit")}unit(){return this.#e}};t(Bs,"MilitaryUnhappiness")});var $p,WE=n(()=>{Ol();$p=class extends xa{};t($p,"PopulationUnhappiness")});var jh=n(()=>{Cy()});var zh=n(()=>{kE();Ja();Tc();Pc();FE();YE();NE();WE();Va();jh();Ol()});var Hh,yi,_h=n(()=>{yR();Hh=class extends Vu{validate(...e){return!this.criteria().length||this.criteria().some(r=>r.validate(...e))}};t(Hh,"Or");yi=Hh});var UH,LE,jE=n(()=>{ra();yo();Et();zh();Wr();Ln();ke();B();Ke();Km();U();C();Pa();Vl();Ha();Qr();_h();Go();UH=t((i=f,e=ie,r=Be,o=Pt,a=W,s=j)=>[new ut(new m(l=>o.getByPlayer(l.player()).is(fo,Ft,cr,Ot)),new p((l,c)=>s.getByTile(l.tile()).filter(u=>u instanceof _).slice(0,Math.min(4,Ve(c,nt))).map(u=>new Pm(1,u)))),...[[$t,1],[$t,1,pr],[Ei,3],[Br,4]].map(([l,c,...u])=>new ut(new ot,new m(y=>r.getByCity(y).some(O=>O instanceof l)),new yi(new m(y=>u.length===0),new m(y=>u.every(O=>a.getByPlayer(y.player()).completed(O)))),new m((y,O)=>Ve(O,nt)>0),new p((y,O)=>new Tm(Math.min(c,Ve(O,nt)),r.getByCity(y).filter(G=>G instanceof l)[0])))),new ut(new ua,new p((l,c)=>new Jp(Math.floor(Ve(c,_i)/2),_i.name)))],"getRules"),LE=UH});var DH,zE,HE=n(()=>{Pa();Et();ra();zh();Ln();Ke();Vm();U();C();DH=t((i=ie,e=Pt,r=j)=>[new cn(new m(o=>i.getByCity(o).size()-5>0),new p(o=>new $p(Math.max(i.getByCity(o).size()-5,0)))),...[[wt,1],[ht,2]].map(([o,a])=>new cn(new m(s=>{try{return e.getByPlayer(s.player()).is(o)}catch{return!1}}),new m(s=>r.getByCity(s).filter(l=>[gt,_,We].some(c=>l instanceof c)&&l.tile()!==s.tile()).length>0),new p(s=>r.getByCity(s).filter(l=>[gt,_,We].some(c=>l instanceof c)&&l.tile()!==s.tile()).map(l=>new Bs(a,l)))))],"getRules"),zE=DH});var Kh,_E,KE=n(()=>{pa();Kh=class extends hr{};t(Kh,"CivilDisorder");_E=Kh});var qh,ka,bu=n(()=>{M();qh=class extends h{};t(qh,"TurnStart");ka=qh});var Zp,Cu,EH,qE,RC=n(()=>{Et();et();X();B();Lh();bm();C();Ha();bu();Zp=new Set,Cu=new Set,EH=t((i=K,e=f,r=P,o=ie)=>[new ka(new ot,new p(a=>i.getByPlayer(a).forEach(s=>{let l=e.process($o,s,s.yields()).some(u=>u),c=e.process(Vp,s,s.yields()).some(u=>u);l&&r.emit("city:civil-disorder",s),l&&!Zp.has(s)&&Zp.add(s),!l&&Zp.has(s)&&(r.emit("city:order-restored",s),Zp.delete(s)),c&&!Cu.has(s)&&(r.emit("city:leader-celebration",s),Cu.add(s)),!c&&Cu.has(s)&&(r.emit("city:leader-celebration-ended",s),Cu.delete(s))}))),new ka(new ot,new p(a=>i.getByPlayer(a).forEach(s=>{if(!Cu.has(s))return;o.getByCity(s).grow()})))],"getRules"),qE=EH});var SH,VE,JE=n(()=>{et();Dn();KE();C();RC();SH=t((i=K)=>[new it(new p(e=>i.getByPlayer(e).filter(r=>Zp.has(r)).map(r=>new _E(e,r))))],"getRules"),VE=SH});var kH={};var $E=n(()=>{DE();SE();jE();HE();B();JE();RC();f.register(...UE(),...zE(),...EE(),...LE(),...VE(),...qE())});var QE=w(ZE=>{"use strict";Object.defineProperty(ZE,"__esModule",{value:!0});$E()});var FH={};var XE=n(()=>{yo();em();vo.register(Ui,Ar,Di,Br,_o,Ei,Xr,ur,Si,Yt,ei,ti,Gr,Ko,Nt,At,Wt,qo,Vo,$t,ri)});var YH,e0,t0=n(()=>{yo();Qr();Jm();Wr();ke();U();C();YH=t((i=Be,e=W)=>[new ft(new p((r,o)=>new m(()=>!i.getByCity(r).some(a=>a instanceof o)))),...[[Ui,Ii],[_o,mr],[Ei,Ii],[Xr,qr],[Si,Qn],[ei,uo],[Gr,no],[At,mr],[$t,io],[Ar,ro],[Br,kt],[ur,Ir],[Yt,It],[Ko,Zr],[ti,ea],[Nt,Lo],[Wt,po],[qo,Xn],[Vo,zo],[ri,wr]].map(([r,o])=>new ft(new m((a,s)=>s===r),new p(a=>new m(()=>e.getByPlayer(a.player()).completed(o))))),...[[Ar,Gr],[ri,ei],[Yt,ur],[Nt,ur],[Wt,ur],[ti,Yt,Nt,Wt]].map(([r,...o])=>new ft(new m((a,s)=>s===r),new p(a=>new m(()=>i.getByCity(a).some(s=>o.some(l=>s instanceof l)))))),...[[Xr,At],[Yt,Nt,Wt],[Nt,Wt,Yt],[Wt,Yt,Nt]].map(([r,...o])=>new ft(new m((a,s)=>s===r),new p(a=>new m(()=>i.getByCity(a).every(s=>!o.some(l=>s instanceof l))))))],"getRules"),e0=YH});var NH,r0,i0=n(()=>{yo();$m();NH=t(()=>[...[[Ui,120],[Di,40],[_o,120],[Ei,100],[Xr,80],[Si,60],[ei,80],[Gr,80],[At,200],[$t,40],[Ar,120],[Br,160],[ur,200],[Yt,240],[Ko,160],[ti,320],[Nt,160],[Wt,160],[qo,200],[Vo,200],[ri,160]].flatMap(([i,e])=>ol(i,e))],"getRules"),r0=NH});var WH,o0,n0=n(()=>{Wr();Zl();C();yo();Se();WH=t((i=Be,e=()=>Math.random())=>[new Rr(new p(r=>{let o=i.getByCity(r).filter(s=>!(s instanceof ve)),[a]=o.filter(s=>s instanceof At);for(a&&(a.destroy(),o.splice(o.indexOf(a),1));o.length>0&&e()>.7;){let s=o[Math.floor(e()*o.length)];if(!s)break;s.destroy(),o.splice(o.indexOf(s),1)}}))],"getRules"),o0=WH});var xe,vC=n(()=>{al();gl();xe=class extends Co{#e;constructor(e=0,r=null){super(e,r?r.id():"none"),this.#e=r,this.addKey("cityImprovement")}cityImprovement(){return this.#e}};t(xe,"CityImprovementMaintenanceGold");vi(xe)});var Vh=n(()=>{Ja();vC();vy();ty();Pc();jh();qa()});var LH,a0,s0=n(()=>{yo();Qr();Wr();ke();Vh();Km();U();C();LH=t((i=Be,e=W)=>[...[[Ui,xe,2],[Ar,xe,3],[Br,xe,3],[_o,xe,2],[Ei,xe,2],[Xr,xe,1],[ur,xe,4],[Si,xe,1],[Yt,xe,4],[ei,xe,1],[ti,xe,6],[Gr,xe,1],[Ko,xe,4],[Nt,xe,2],[At,xe,0],[Wt,xe,4],[qo,xe,2],[Vo,xe,4],[$t,xe,1],[ri,xe,3]].map(([r,o,a])=>new ut(new m(s=>i.getByCity(s).some(l=>l instanceof r)),new p(s=>{let[l]=i.getByCity(s).filter(c=>c instanceof r);return new o(a,l)}))),...[[Di,xe,0,null,Pr],[Di,xe,1,Pr,lr],[Di,xe,2,lr,null]].map(([r,o,a,s,l])=>new ut(new m(c=>i.getByCity(c).some(u=>u instanceof r)),new m(c=>s===null||e.getByPlayer(c.player()).completed(s)),new m(c=>l===null||!e.getByPlayer(c.player()).completed(l)),new p(c=>{let[u]=i.getByCity(c).filter(y=>y instanceof r);return new o(a,u)})))],"getRules"),a0=LH});var jH,l0,m0=n(()=>{Wr();et();B();wf();U();C();yo();jH=t((i=K,e=Be,r=f)=>[new pn(new m(o=>i.getByPlayer(o.player()).length===0),new p(o=>e.register(new At(o,r))))],"getRules"),l0=jH});var zH,p0,c0=n(()=>{Wr();U();Ql();C();zH=t((i=Be)=>[new zr(new m(e=>i.getByCity(e).length>0),new p(e=>i.getByCity(e).forEach(r=>r.destroy())))],"getRules"),p0=zH});var HH,u0,f0=n(()=>{yo();Wr();U();C();Vh();oy();HH=t((i=Be)=>[new Oa(new m(e=>!i.getByCity(e.city()).some(r=>r instanceof Ui)),new m(e=>e.size()>10),new p(e=>e.shrink())),new Oa(new m(e=>i.getByCity(e.city()).some(r=>r instanceof Si)),new p(e=>e.add(new ha(e.cost().value()/2))))],"getRules"),u0=HH});var _H,y0,d0=n(()=>{Wr();X();FR();C();_H=t((i=Be,e=P)=>[new Cc(new p(r=>i.register(r))),new Cc(new p((r,o)=>{e.emit("city-improvement:created",r,o)}))],"getRules"),y0=_H});var KH,g0,h0=n(()=>{yo();Wr();Vh();U();C();dR();Gf();Go();KH=t((i=Be)=>[...[[Gr,ze,.5],[Gr,_i,.5],[Ar,ze,.5],[Ar,_i,.5],[ei,ar,.5],[ri,ar,.5],[ur,Q,.5],[Wt,Q,.5],[Yt,Q,.5],[Nt,Q,.5],[ti,Q,.5],[Xr,fn,.5]].map(([e,r,o])=>new Xl(new wT,new m(a=>i.getByCity(a).some(s=>s instanceof e)),new p((a,s)=>new r(Math.floor(Ve(s,r)*o),e.name))))],"getRules"),g0=KH});var qH,O0,x0=n(()=>{Wr();ts();yo();Iy();U();C();tu();qH=t((i=Be,e=Cr)=>[new $a(new m(r=>r.city()!==null),new m(r=>i.getByCity(r.city()).some(o=>o instanceof Di)),new p(r=>e.register(new zn(r))))],"getRules"),O0=qH});var VH={};var R0=n(()=>{B();t0();i0();n0();s0();m0();c0();f0();d0();h0();x0();f.register(...e0(),...r0(),...o0(),...a0(),...l0(),...p0(),...u0(),...y0(),...g0(),...O0())});var b0=w(v0=>{"use strict";Object.defineProperty(v0,"__esModule",{value:!0});XE();R0()});var T0={};Wu(T0,{default:()=>JH,registerCityNames:()=>C0});var C0,JH,P0=n(()=>{or();vt();C0=t((i=re)=>{["Bergen","Cannae","Capua","Cordoba","Cremona","Crete","Cunaxa","Damascus","Dublin","Genoa","Ghent","Issus","Lisbon","Mecca","Melbourne","Milan","Naples","Pisa","Prague","Salamis","Salzburg","Seville","Sidon","Sydney","Tarsus","Toronto","Turin","Tyre","Utica","Venice","Verona"].forEach(e=>i.register(new se(e,null)))},"registerCityNames"),JH=C0});var bC=n(()=>{Up();uu();fu();yu();du();Fp();gu();Np();hu();Ou();xu();Ru();Hp();vu()});var Jh,$h,CC=n(()=>{Ro();nr();Jh=class extends Qe{constructor(){super(de)}};t(Jh,"CivilizationRegistry");$h=new Jh});var w0={};Wu(w0,{default:()=>$H,registerCivilizations:()=>I0});var I0,$H,A0=n(()=>{bC();CC();I0=t((i=$h)=>{i.register(ds,gs,hs,Os,xs,Rs,vs,bs,Cs,Ts,Ps,Is,ws,As)},"registerCivilizations"),$H=I0});var Zh,Wl,Tu=n(()=>{je();Zh=class extends L{#e;constructor(e,r){super(r),this.#e=e}leader(){return this.#e}};t(Zh,"Trait");Wl=Zh});var Qh,Qp,Xh=n(()=>{ge();Tu();Qh=class extends Y{constructor(){super(Wl)}getByLeader(e){return this.getBy("leader",e)}getBySubclass(e){return this.filter(r=>r instanceof e)}};t(Qh,"TraitRegistry");Qp=new Qh});var eO,fe,Bt=n(()=>{Xh();V();eO=class extends k{#e=[];constructor(e=Qp){super();let r=e.getByLeader(this.sourceClass());this.#e.push(...r),this.addKey("name")}static civilization(){throw new TypeError("Must be implemented in extending class")}name(){throw new TypeError("Must be implemented in extending class")}traits(){return[...this.#e]}};t(eO,"Leader");fe=eO});var Gs,B0=n(()=>{Bt();Up();Gs=class extends fe{static civilization(){return Om}name(){return"Abraham Lincoln"}};t(Gs,"AbrahamLincoln")});var G0=n(()=>{Bt();Up()});var M0=n(()=>{B0();G0()});var Ms,U0=n(()=>{Bt();uu();Ms=class extends fe{static civilization(){return Dp}name(){return"Moctezuma II"}};t(Ms,"MoctezumaII")});var D0=n(()=>{U0()});var Us,E0=n(()=>{Bt();fu();Us=class extends fe{static civilization(){return Ep}name(){return"Hammurabi"}};t(Us,"Hammurabi")});var S0=n(()=>{E0()});var Ds,k0=n(()=>{Bt();yu();Ds=class extends fe{static civilization(){return Sp}name(){return"Mao Zedong"}};t(Ds,"MaoZedong")});var F0=n(()=>{k0()});var Es,Y0=n(()=>{Bt();du();Es=class extends fe{static civilization(){return kp}name(){return"Ramesses II"}};t(Es,"RamessesII")});var N0=n(()=>{Y0()});var Ss,W0=n(()=>{Bt();Fp();Ss=class extends fe{static civilization(){return xm}name(){return"Elizabeth I"}};t(Ss,"ElizabethI")});var L0=n(()=>{Bt();Fp()});var j0=n(()=>{W0();L0()});var ks,z0=n(()=>{Bt();gu();ks=class extends fe{static civilization(){return Yp}name(){return"Napoleon I"}};t(ks,"NapoleonI")});var H0=n(()=>{z0()});var Fs,_0=n(()=>{Bt();Np();Fs=class extends fe{static civilization(){return Rm}name(){return"Frederick the Great"}};t(Fs,"FrederickTheGreat")});var K0=n(()=>{Bt();Np()});var q0=n(()=>{_0();K0()});var Ys,V0=n(()=>{Bt();hu();Ys=class extends fe{static civilization(){return Wp}name(){return"Alexander the Great"}};t(Ys,"AlexanderTheGreat")});var J0=n(()=>{V0()});var Ns,$0=n(()=>{Bt();Ou();Ns=class extends fe{static civilization(){return Lp}name(){return"Mahatma Gandhi"}};t(Ns,"MahatmaGandhi")});var Z0=n(()=>{$0()});var Ws,Q0=n(()=>{Bt();xu();Ws=class extends fe{static civilization(){return jp}name(){return"Genghis Khan"}};t(Ws,"GenghisKhan")});var X0=n(()=>{Q0()});var Ls,eS=n(()=>{Bt();Ru();Ls=class extends fe{static civilization(){return zp}name(){return"Julius Caesar"}};t(Ls,"JuliusCaesar")});var tS=n(()=>{eS()});var rS=n(()=>{Bt();Hp()});var js,iS=n(()=>{Bt();Hp();js=class extends fe{static civilization(){return vm}name(){return"Joseph Stalin"}};t(js,"JosephStalin")});var oS=n(()=>{rS();iS()});var zs,nS=n(()=>{Bt();vu();zs=class extends fe{static civilization(){return _p}name(){return"Shaka"}};t(zs,"Shaka")});var aS=n(()=>{nS()});var TC=n(()=>{M0();D0();S0();F0();N0();j0();H0();q0();J0();Z0();X0();tS();oS();aS()});var tO,rO,PC=n(()=>{Ro();Bt();tO=class extends Qe{constructor(){super(fe)}getByCivilization(e){return this.getBy("civilization",e)}};t(tO,"LeaderRegistry");rO=new tO});var lS={};Wu(lS,{default:()=>ZH,registerLeaders:()=>sS});var sS,ZH,mS=n(()=>{TC();PC();sS=t((i=rO)=>{i.register(Gs,Ms,Us,Ds,Es,Ss,ks,Fs,Ys,Ns,Ws,Ls,js,zs)},"registerLeaders"),ZH=sS});var iO,Xp,oO=n(()=>{Tu();iO=class extends Wl{};t(iO,"Aggression");Xp=iO});var nO,ec,pS=n(()=>{oO();nO=class extends Xp{constructor(e){super(e,1)}};t(nO,"Aggressive");ec=nO});var aO,tc,sO=n(()=>{Tu();aO=class extends Wl{};t(aO,"Militarism");tc=aO});var lO,Hs,cS=n(()=>{sO();lO=class extends tc{constructor(e){super(e,0)}};t(lO,"Civilized");Hs=lO});var mO,rc,pO=n(()=>{Tu();mO=class extends Wl{};t(mO,"Development");rc=mO});var cO,ic,uS=n(()=>{pO();cO=class extends rc{constructor(e){super(e,1)}};t(cO,"Expansionist");ic=cO});var uO,fO,fS=n(()=>{oO();uO=class extends Xp{constructor(e){super(e,0)}};t(uO,"Friendly");fO=uO});var yO,dO,yS=n(()=>{sO();yO=class extends tc{constructor(e){super(e,1)}};t(yO,"Militaristic");dO=yO});var gO,Im,dS=n(()=>{oO();gO=class extends Xp{constructor(e){super(e,.5)}};t(gO,"Normal");Im=gO});var hO,oc,gS=n(()=>{pO();hO=class extends rc{constructor(e){super(e,.5)}};t(hO,"Normal");oc=hO});var OO,xO,hS=n(()=>{sO();OO=class extends tc{constructor(e){super(e,.5)}};t(OO,"Normal");xO=OO});var RO,Pu,OS=n(()=>{pO();RO=class extends rc{constructor(e){super(e,0)}};t(RO,"Perfectionist");Pu=RO});var RS={};Wu(RS,{default:()=>QH,registerTraits:()=>xS});var xS,QH,vS=n(()=>{TC();Xh();pS();cS();uS();fS();yS();dS();gS();hS();OS();xS=t((i=Qp)=>{[[Gs,fO,oc,Hs],[Ms,Im,Pu,Hs],[Us,fO,Pu,Hs],[Ds,Im,oc,Hs],[Es,Im,oc,Hs],[Ss,Im,ic,xO],[ks,ec,ic,Hs],[Fs,ec,Pu,Hs],[Ys,Im,ic,dO],[Ns,fO,Pu,xO],[Ws,ec,ic,dO],[Ls,Im,ic,Hs],[js,ec,oc,dO],[zs,ec,oc,xO]].forEach(([e,...r])=>r.forEach(o=>i.register(new o(e))))},"registerTraits"),QH=xS});var CS=w(bS=>{"use strict";Object.defineProperty(bS,"__esModule",{value:!0});var XH=(P0(),R(T0)),e_=(A0(),R(w0)),t_=(mS(),R(lS)),r_=(vS(),R(RS));(0,XH.default)();(0,e_.default)();(0,t_.default)();(0,r_.default)()});var vO,bO,IC=n(()=>{M();vO=class extends h{};t(vO,"Yield");bO=vO});var CO,Gt,Fa=n(()=>{B();ly();IC();CO=class extends QT{#e;#t;constructor(e,r=f){super(),this.#e=e,this.#t=r,this.addKey("city","yields")}static build(e,r=f){return new this(e,r)}city(){return this.#e}yields(){return this.#t.process(bO,this).flat()}};t(CO,"Part");Gt=CO});var er,_s,wC=n(()=>{Fa();er=class extends Gt{};t(er,"Fuel");_s=er});var tr,Iu,AC=n(()=>{Fa();tr=class extends Gt{};t(tr,"Habitation");Iu=tr});var TO,wm,PO=n(()=>{M();TO=class extends h{};t(TO,"ChooseSlot");wm=TO});var IO,Am,BC=n(()=>{M();IO=class extends h{};t(IO,"Active");Am=IO});var TS,wO,AO,GC=n(()=>{V();B();PO();BC();TS=t((i,e,r)=>e<=i&&i<r,"isBetween"),wO=class extends k{#e=new Map;#t;#r;#i=[];#o;constructor(e,r,o,a=f){super(),this.addKey("activeSlots","height","inactiveSlots","slots","width"),this.#t=e,this.#r=a,this.#o=r,this.#i.push(...o)}activeSlots(){return this.#i.filter(e=>this.#r.process(Am,e,this).every(r=>r))}get(e,r){if(e<0||e>=this.#o||r<0||r>=this.#t)return null;let o=[e,r].toString();if(!this.#e.has(o)){let[a]=this.#i.filter(s=>TS(e,s.x(),s.x()+s.width())&&TS(r,s.y(),s.y()+s.height()));this.#e.set(o,a??null)}return this.#e.get(o)}getAdjacent(e){let r=new Set;for(let o=e.x(),a=e.x()+e.width()-1;o<=a;o++){let s=this.get(o,e.y()-1),l=this.get(o,e.y()+e.height());s&&r.add(s),l&&r.add(l)}for(let o=e.y(),a=e.y()+e.height()-1;o<=a;o++){let s=this.get(e.x()-1,o),l=this.get(e.x()+e.width(),o);s&&r.add(s),l&&r.add(l)}return[...r.values()].filter(o=>o!==e)}getFreeSlot(e){let[r]=this.#r.process(wm,e,this);return r??null}height(){return this.#t}inactiveSlots(){return this.#i.filter(e=>this.#r.process(Am,e,this).some(r=>!r))}slots(){return this.#i}width(){return this.#o}};t(wO,"Layout");AO=wO});var dr,wu,MC=n(()=>{Fa();dr=class extends Gt{};t(dr,"LifeSupport");wu=dr});var Lr,Au,UC=n(()=>{Fa();Lr=class extends Gt{};t(Lr,"Power");Au=Lr});var zt,Ks,DC=n(()=>{Fa();zt=class extends Gt{};t(zt,"Propulsion");Ks=zt});var BO,F,PS=n(()=>{V();BO=class extends k{#e=[];#t;#r=null;#i;#o;#n;constructor(e,r,o,a,s){super(),this.addKey("height","part","width","x","y"),this.#t=o,this.#i=a,this.#o=e,this.#n=r,this.#e.push(...s)}accepts(e){return this.#e.some(r=>e instanceof r)}empty(){return this.#r===null}fill(e){!this.accepts(e)||(this.#r=e)}height(){return this.#t}part(){return this.#r}width(){return this.#i}x(){return this.#o}y(){return this.#n}};t(BO,"Slot");F=BO});var Mt,pe,EC=n(()=>{Fa();Mt=class extends Gt{};t(Mt,"Structural");pe=Mt});var GO,IS,wS=n(()=>{B();wC();AC();GC();MC();UC();DC();PS();EC();GO=class extends AO{constructor(e=f){super(12,12,[new F(9,0,1,1,[_s]),new F(10,0,1,2,[Ks]),new F(1,1,2,2,[Au]),new F(5,1,2,2,[Au]),new F(8,1,1,1,[pe]),new F(9,1,1,1,[pe]),new F(10,1,1,1,[pe]),new F(8,2,1,1,[pe]),new F(9,2,1,1,[_s]),new F(10,2,1,2,[Ks]),new F(0,3,1,1,[pe]),new F(1,3,1,1,[pe]),new F(2,3,1,1,[pe]),new F(3,3,1,1,[pe]),new F(4,3,1,1,[pe]),new F(5,3,1,1,[pe]),new F(6,3,1,1,[pe]),new F(7,3,1,1,[pe]),new F(8,3,1,1,[pe]),new F(9,3,1,1,[_s]),new F(10,3,1,2,[Ks]),new F(0,4,2,2,[wu]),new F(2,4,2,2,[Iu]),new F(4,4,2,2,[wu]),new F(6,4,2,2,[Iu]),new F(8,4,1,1,[pe]),new F(9,4,1,1,[pe]),new F(10,4,1,1,[pe]),new F(8,5,1,1,[pe]),new F(9,5,1,1,[_s]),new F(10,5,1,2,[Ks]),new F(0,6,2,2,[Iu]),new F(2,6,2,2,[wu]),new F(4,6,2,2,[Iu]),new F(6,6,2,2,[wu]),new F(8,6,1,1,[pe]),new F(9,6,1,1,[_s]),new F(10,6,1,2,[Ks]),new F(8,7,1,1,[pe]),new F(9,7,1,1,[pe]),new F(10,7,1,1,[pe]),new F(0,8,1,1,[pe]),new F(1,8,1,1,[pe]),new F(2,8,1,1,[pe]),new F(3,8,1,1,[pe]),new F(4,8,1,1,[pe]),new F(5,8,1,1,[pe]),new F(6,8,1,1,[pe]),new F(7,8,1,1,[pe]),new F(8,8,1,1,[pe]),new F(9,8,1,1,[_s]),new F(10,8,1,2,[Ks]),new F(1,9,2,2,[Au]),new F(5,9,2,2,[Au]),new F(8,9,1,1,[pe]),new F(9,9,1,1,[_s]),new F(10,9,1,2,[Ks]),new F(8,10,1,1,[pe]),new F(9,10,1,1,[pe]),new F(10,10,1,1,[pe]),new F(9,11,1,1,[_s]),new F(10,11,1,2,[Ks])],e)}};t(GO,"Default");IS=GO});var MO,nc,UO=n(()=>{Ro();GC();MO=class extends IT{constructor(){super(AO)}};t(MO,"LayoutRegistry");nc=new MO});var i_={};var AS=n(()=>{wS();UO();nc.register(IS)});var GS=w(BS=>{"use strict";Object.defineProperty(BS,"__esModule",{value:!0});AS()});var o_,MS,US=n(()=>{as();C();Mv();o_=t((i=sr)=>[new Ld(new p(e=>i.register(e)))],"getRules"),MS=o_});var DO,Bu,SC=n(()=>{V();at();DO=class extends k{#e;#t;constructor(e,r=$){super(),this.#e=e,this.#t=r,this.addKey("expired","expiry")}expired(){return this.#e<=this.#t.value()}expiry(){return this.#e}};t(DO,"Expiry");Bu=DO});var EO,SO,kC=n(()=>{SC();EO=class extends Bu{constructor(){super(1/0)}expired(){return!1}};t(EO,"Never");SO=EO});var kO,FC,YC=n(()=>{xp();at();SC();kC();Kr();B();kO=class extends Bo{#e=new SO;#t=$;constructor(...e){super(...e.filter(r=>r instanceof H||r instanceof BT)),this.addKey("expired","expiry"),e.forEach(r=>{r instanceof Bu&&(this.#e=r),r instanceof Pl&&(this.#t=r)})}active(){return!this.expiry().expired()}expire(){this.#e=new Bu(this.#t.value())}expired(){return this.#e.expired()}expiry(){return this.#e}};t(kO,"Declaration");FC=kO});var ki,Gu,Mu=n(()=>{YC();ki=class extends FC{};t(ki,"Peace");Gu=ki});var FO,Qo,DS=n(()=>{Vc();B();FO=class extends Pp{#e;constructor(e,r,o,a=f){super(e,o,a),this.#e=r,this.addKey("key")}key(){return this.#e}};t(FO,"Dialogue");Qo=FO});var YO,Bm,NC=n(()=>{fm();YO=class extends Mo{};t(YO,"Decline");Bm=YO});var NO,Gm,ES=n(()=>{fm();NO=class extends Mo{};t(NO,"Acknowledge");Gm=NO});var n_,SS,kS=n(()=>{_d();C();U();Mg();Mu();fm();DS();Jc();NC();zd();B();as();ke();ES();Sg();Th();n_=t((i=f,e=sr,r=W)=>{let o=t(d=>new m(T=>!e.getByPlayers(...T.players()).some(D=>D instanceof d&&D.negotiation()===T)),"onlyOncePerNegotiation"),a=t(d=>new m(T=>T.lastInteraction()instanceof Mo&&T.lastInteraction().proposal()instanceof d),"lastInteractionWasResolutionForAction"),s=t(d=>d.lastInteraction()===null?d.players()[0]:d.lastInteraction().for()[0],"getNextBy"),l=t(d=>new p(T=>new d(s(T),T,i)),"proposalAction"),c=t(d=>new p(T=>new d(s(T),T.lastInteraction(),i)),"resolutionAction"),u=t((d,T)=>new p(D=>new d(s(D),T,D,i)),"dialogueAction"),y=t((d,T)=>d.key().split(".")[0]===T,"dialogueNamespaceMatches"),O=t(d=>new m(T=>{let D=T.lastInteraction();return D instanceof Qo&&y(D,d)}),"lastInteractionWasDialogueWithNamespace"),G=t((...d)=>e.getByPlayers(...d).some(T=>T instanceof Gu&&T.active()),"hasPeaceTreaty"),N={standardTopics:[[o(Ea),new m(d=>!G(...d.players())),l(Ea)],[new m(d=>{let[T,D]=d.players().map(jr=>r.getByPlayer(jr)),q=T.complete().filter(jr=>!D.completed(jr.sourceClass())),Ce=D.complete().filter(jr=>!T.completed(jr.sourceClass()));return q.length>0&&Ce.length>0}),l(ss)],[l(Dl)]]},g=[[c(jn)],[c(Bm)]];return[...[[[null],[[l(Uo)]]],[[Uo],g],[[Bm,a(Uo)],[[l(Dl)]]],[[jn,a(Uo),new m(d=>!G(...d.players()))],[[u(Qo,"welcome.no-peace")]]],[[jn,a(Uo),new m(d=>G(...d.players()))],[[u(Qo,"welcome.peace")]]],[[Qo,O("welcome")],[[c(Gm)]]],[[Gm,a(Qo)],N.standardTopics],[[Ea],g],[[Bm,a(Ea)],[[u(Qo,"decline-peace.neutral")]]],[[jn,a(Ea)],[[u(Qo,"accept-peace.neutral")]]],[[Qo,O("decline-peace")],[[c(Gm)]]],[[Qo,O("accept-peace")],[[c(Gm)]]],[[Qo,O("decline-demand")],[[c(Gm)]]],[[Qo,O("accept-demand")],[[c(Gm)]]],[[ss],g],[[Bm,a(ss)],N.standardTopics],[[jn,a(ss)],N.standardTopics]].flatMap(([[d,...T],D])=>D.map(([...q])=>new bp(new m(Ce=>d===null?Ce.lastInteraction()===null:Ce.lastInteraction()instanceof d),...T,...q)))]},"getRules"),SS=n_});var a_,FS,YS=n(()=>{B();as();ke();Ev();U();NC();Jc();C();_d();Mg();Mu();kC();Th();Sg();a_=t((i=f,e=sr,r=W)=>[new Tp(new m((o,a)=>o instanceof Bm&&a instanceof Uo),new p((o,a)=>a.negotiation().proceed(new Dl(o.by(),a.negotiation(),i)))),new Tp(new m((o,a)=>o instanceof jn&&a instanceof Ea),new p((o,a)=>e.register(new Gu(...a.players(),new SO,i)))),new Tp(new m((o,a)=>o instanceof jn&&a instanceof ss),new p((o,a)=>{let s=r.getByPlayer(o.by()),l=r.getByPlayer(o.for()[0]),c=s.complete().filter(y=>!l.completed(y.sourceClass())),u=l.complete().filter(y=>!s.completed(y.sourceClass()));s.addAdvance(u[0].sourceClass()),l.addAdvance(c[0].sourceClass())}))],"getRules"),FS=a_});var ac,NS=n(()=>{xp();ac=class extends CI{constructor(...e){let r=e.map(o=>o.player());super(...r)}};t(ac,"Contact")});var WS=n(()=>{NS()});var s_,LS,jS=n(()=>{as();Ke();WS();U();C();Dt();s_=t((i=sr,e=j)=>[new Z(new m(r=>r.tile().getNeighbours().some(o=>e.getByTile(o).some(a=>a.player()!==r.player()))),new p(r=>r.tile().getNeighbours().forEach(o=>e.getByTile(o).filter(a=>a.player()!==r.player()).forEach(a=>i.register(new ac(r,a))))))],"getRules"),LS=s_});var l_={};var zS=n(()=>{B();US();kS();YS();jS();f.register(...MS(),...SS(),...FS(),...LS())});var _S=w(HS=>{"use strict";Object.defineProperty(HS,"__esModule",{value:!0});zS()});var WO,LO,WC=n(()=>{WO=class{#e;#t;#r;constructor(e,r,o){this.#e=e,this.#t=r,this.#r=o}civilizationType(){return this.#e}mapGenerator(){return this.#t}startTile(){return this.#r}startTileForMap(e){let{x:r,y:o}=this.#r;return e.get(r,o)}};t(WO,"CivilizationStartTile");LO=WO});var m_,ia,LC=n(()=>{m_=t((i,e,r,o)=>{for(;r<0;)r+=e;for(;o<0;)o+=i;return r=r%e,o=o%i,o*e+r},"coordsToIndex"),ia=m_});var p_,Mm,jO=n(()=>{p_=t((i,e,r)=>{let o=i*e;for(;r<0;)r+=o;return r=r%o,[r%e,Math.floor(r/e)]},"indexToCoords"),Mm=p_});var c_,KS,qS=n(()=>{jO();c_=t((i,e,r,o)=>{let[a,s]=Mm(i,e,r),[l,c]=Mm(i,e,o),u=[[-1,1],[-1,0],[-1,-1],[0,1],[0,0],[0,-1],[1,1],[1,0],[1,-1]],[y]=u.map(([O,G])=>[O*e,G*i]).map(([O,G])=>[a-l+O,s-c+G]).map(O=>Math.hypot(...O)).sort((O,G)=>O-G);return y},"distanceFrom"),KS=c_});var u_,Um,jC=n(()=>{LC();jO();u_=t((i,e,r,o=!0)=>{let[a,s]=Mm(i,e,r),l=ia(i,e,a,s-1),c=ia(i,e,a+1,s-1),u=ia(i,e,a+1,s),y=ia(i,e,a+1,s),O=ia(i,e,a,s+1),G=ia(i,e,a-1,s+1),N=ia(i,e,a-1,s),g=ia(i,e,a-1,s-1);return o?[l,u,O,N]:[l,c,u,y,O,G,N,g]},"getNeighbours"),Um=u_});var sc,zO,HO=n(()=>{LC();qS();jC();jO();sc=class{#e;#t;#r;constructor(e,r,o={}){this.#e=e,this.#t=o,this.#r=r}coordsToIndex(e,r){return ia(this.#e,this.#r,e,r)}distanceFrom(e,r){return KS(this.#e,this.#r,e,r)}generate(){throw new Error(`Generator#generate(): Must be overridden in '${this.constructor.name}'.`)}getNeighbours(e,r=!0){return Um(this.#e,this.#r,e,r)}height(){return this.#e}indexToCoords(e){return Mm(this.#e,this.#r,e)}options(){return this.#t}width(){return this.#r}};t(sc,"Generator");zO=sc});var f_,_O,lc,KO=n(()=>{Yv();Nv();nd();HO();cp();Wv();Lv();jv();zv();Gc();tg();Hv();_v();f_={A:SI,D:kI,F:od,G:wl,H:FI,J:YI,M:NI,O:WI,P:mp,R:eg,S:LI,T:jI},_O=class extends zO{async generate(){return Array.from(`OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOAAAAAAAOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOAAOAOAAAOAAAAAAAAOOOOOOAOOOOOGGOOOOOTAGOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOTTTTAOOOOAAAAAAAAOOOOAAAAAATOOOOOAAOOOOOOOOOOOOOOOAAOOOOOTOOOOOOOOOOOOOOOOOO
OOOTTTTTTTTTAAOAOAAAAAOOOAAAAATOOOOOOOOOOOOOOOAOOOOOFFAAFFFFFOOFFFOOOOFFFOOOOOOO
OTPTGPPPPTTTTTOTAAAOOAOOOAAAATOOOOOOOOOOOOOOOAOOAAOFFGAFFFFFFFAFFFFFFFFFFOTOOOOO
OOOOOPGTPTOOTTAAAAAAAAOOAAGGOOOOOOOOOOGAAOOOOOOGOGFFFGFFFFFFFFAFFAFFFFFGFGGOOOOO
OOOOOGGFGPPTTAAOOOAOTOOOAGOOOOAOOOOOOAFGFPGFOAAFGTGFFFFFFFFFFFFFFFGFFGOGFFOOOOOO
OOOOPMGFPPPPTTOOOATAAOOOOOOOOOOOOOOOGFPGGFOFFFFFFGFFFFFFFFFFFFFFGFFFFGOOFOOOOOOO
OOOOPMGFGPPOTTTAATTTTOOOOOOOOOOHOOOPFGOGGGFFFGFGGGFFFFFFFFFFFFFFFFFFOOOOFGOOOOOO
OOOOPHFFGPGOPPPOPTTTTOOOOOOOOOGROOOOOPOGFGFFGFFFGFGFGGFGGFFFGFFFFFFFGOOOOPOOOOOO
OOOOGGHFGPPPPPPPPPTPPOOOOOOOOOOFOOOFOOOFFFRFFFFRGFPFFPFGPFGFFOFFFFFGPPGOOOOOOOOO
OOOGGGMGGGPPPOPPPPPOPOOOOOOOOOGGOOOGPPFFFGRRFRRRGGFGGGGGPGGFFFFDPPPPPPOOOOOOOOOO
OOOGGFMGRGRPGORRGOPOOOOOOOOOOOOOOGRGGGGFFGFRFRPGPGGGGGPPPPPPPPPPPPPPGPGOOOOOOOOO
OOGGGMMGRGRGGGGOOOOOOOOOOOOOOOOOGGRMMGGGGPGRPRRPPPPPPPPPPPPPPPPPPPPPGPGOPGOOOOOO
OOGGPPHGRRRGGGOOOOOOOOOOOOOOOOOOPGGGGFGRRGPRPDOOPPOPPPDPDDDPPPPPPDPPPGOOGOOOOOOO
OOGFPPFGGRGGGPOOOOOOOOOOOOOOOOPPPPOGHOOGRFOOOHPOGPPDPDPDDPPPPPPDDPPOPGOOMGOOOOOO
OOGPPDDGGRGGOOOOOOOOOOOOOOOOOOPPPOOOGHOOOGPPPPPOPPPPDPPHPDDDDDDPPPGOOOOOOPOOOOOO
OOPOGDDPOOOPOOOOOOOOOOOOOOOOOOOOOOOOOGOOOOOPPPPGPPPPPPHHMHHHHHHHHMHPGOOGOOOOOOOO
OOPOGDDOOOOPOOOOOOOOOOOOOOOOOOGPPDDOOOOOOOOPPRRHPPPDPPHPGHMMMMMHHHPPPGOOOOOOOOOO
OOOOGDGOOOOOOOOOOOOOOOOOOOOOOODPHHPPPGODPOPPPGRRPPPPPHHRDPGMHHMHHPPRRROOOOOOOOOO
OOOOGGPOPOOOGPOOOOOOOOOOOOOOOPPHDDDPPPPDDRGDPPDOPPPPHPRRDGGGHHHHHPGPPPOOOOOOOOOO
OOOOOGGPGOOOOGPOOOOOOOOOOOOOPPDDDDDPDDDDDRDOPDDOOOOHHRRDPGGRGGGHGPGGPOOOOOOOOOOO
OOOOOOOOGGOOOOOOOOOOOOOOOOOOPDDDDDDDDDDDSRSODDDDDDOOOOPPGGGRRPPGFGGGOOOGOOOOOOOO
OOOOOOOOOGOOOOOOOOOOOOOOOOOPDDDDDDPPPDDDDRDOOPDDDDPOOOOGGGGGOOGGGGGOOOOPGOOOOOOO
OOOOOOOOOPPOGPPGOOOOOOOOOOODDDDDDDPDDDDDDRDDOODDDDOOOOOOGGGOOOPPGGOOOOOGGOOOOOOO
OOOOOOOOOOPGFPPPGOOOOOOOOOODDDDDDDDPDPDPPDHHDOOPDOOOOOOOGGOOOOOGGGGOOOOOFGOOOOOO
OOOOOOOOOOOGHGGGGGGOOOOOOOOPPDPPPPDDDPPPPPPMDPOOGOOOOOOOPGOOOOOOOGGOOOOOOGOOOOOO
OOOOOOOOOOOHJJJGGGGROOOOOOOOPPDPPPPPPPPPPPPHMDPOOOOOOOOOOGOOOOOOOOOOOPOOOOOOOOOO
OOOOOOOOOOGHJRRJJRRRGOOOOOOOOPPPGOPPGPGGGGGGMDDPOOOOOOOOOOOOOOOOOOOGPPOOGPOOOOOO
OOOOOOOOOOPGJJRRRRJGFGGOOOOOOOOOOOOGGGGJJJGGODPPOOOOOOOOOOOOOOOGFGOOPGFGGGOGOOOO
OOOOOOOOOOOFGGJJGJJFGGGPOOOOOOOOOOOGGJJRRRGGHPPOOOOOOOOOOOOOOOOOGFOOGOPGOOOPGGOO
OOOOOOOOOOOGHGGGGGGGGGGOOOOOOOOOOOOGGRRRJJHOGGOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOGGO
OOOOOOOOOOOOGMFGGGGGGPOOOOOOOOOOOOOOGRJJJGHMGOOOOOOOOOOOOOOOOOOOOPPOOOOOGOOOOOOO
OOOOOOOOOOOOGFMGGFGPPPOOOOOOOOOOOOOORRGGGGGMPOOOOOOOOOOOOOOOOOOOOOGOOOOOOOPGOOOO
OOOOOOOOOOOOOOHMGGRPGGOOOOOOOOOOOOOOOGGGGGGHGOOOOOOOOOOOOOOOOOOOOOOOOOOGGPGPGGOO
OOOOOOOOOOOOOOGHGGRGGOOOOOOOOOOOOOOOODPPGGGGGGOOOOOOOOOOOOOOOOOOOOOOOOOGGPPPPGOO
OOOOOOOOOOOOOOGMGPRROOOOOOOOOOOOOOOOPPPPPPPGGGOPOOOOOOOOOOOOOOOOOOOOGGPPPDDDPPPO
OOOOOOOOOOOOOOGMGGGPOOOOOOOOOOOOOOOOHPDDPPGGOOOPOOOOOOOOOOOOOOOOOOOGGGPDDDDDDPFO
OOOOOOOOOOOOOOPMGGGOOOOOOOOOOOOOOOOOOPPDPPGGOOOGOOOOOOOOOOOOOOOOOOOGPDDDDDDDDPPO
OOOOOOOOOOOOOOOMGPOOOOOOOOOOOOOOOOOOOHPPPGGGOOGPOOOOOOOOOOOOOOOOOOOGDDDDDPDDDPGO
OOOOOOOOOOOOOOOGGOOOOOOOOOOOOOOOOOOOOHPPGHGOOOPOOOOOOOOOOOOOOOOOOOODDDDDDDPDDHFO
OOOOOOOOOOOOOOOPGOOOOOOOOOOOOOOOOOOOOODPGHGOOOOOOOOOOOOOOOOOOOOOOOODDDOOGDDDHGOO
OOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOPGGGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOGHHHGOOO
OOOOOOOOOOOOOOOOFOOOOOOOOOOOOOOOOOOOOOGOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOPGOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO
`.replace(/\n/g,"")).map(e=>new f_[e])}height(){return 50}width(){return 80}};t(_O,"Earth");lc=_O});var qO,VS,JS=n(()=>{WC();KO();qO=class extends LO{constructor(e,r){super(e,lc,r)}};t(qO,"EarthStartTile");VS=qO});var Uu,nYe,$S,ZS=n(()=>{WC();ge();Uu=class extends Zs{constructor(){super(LO)}getByCivilization(e){let[r]=this.getBy("civilizationType",e);if(!r)throw new TypeError(`${e.name} does not have a registered start tile.`);return r}getStartTileByCivilizationAndWorld(e,r){return this.getByCivilization(e).startTileForMap(r)}};t(Uu,"CivilizationStartTileRegistry");nYe=new Uu,$S=Uu});var VO,JO,zC=n(()=>{ZS();KO();VO=class extends $S{entries(){return super.entries().filter(e=>e.mapGenerator()===lc)}};t(VO,"EarthStartTileRegistry");JO=new VO});var y_={};var QS=n(()=>{bC();JS();zC();JO.register(...[[ds,{x:12,y:18}],[gs,{x:5,y:23}],[hs,{x:45,y:22}],[Os,{x:66,y:19}],[xs,{x:41,y:24}],[Rs,{x:31,y:14}],[vs,{x:33,y:16}],[bs,{x:38,y:15}],[Cs,{x:39,y:18}],[Ts,{x:57,y:26}],[Ps,{x:49,y:19}],[Is,{x:36,y:19}],[ws,{x:44,y:12}],[As,{x:42,y:42}]].map(([i,e])=>new VS(i,e)))});var ek=w(XS=>{"use strict";Object.defineProperty(XS,"__esModule",{value:!0});QS()});var d_,tk,rk=n(()=>{U();C();Bv();d_=t(()=>[new Gl(new m(i=>i<252),new p(i=>i*20-4020)),new Gl(new m(i=>i>251),new m(i=>i<302),new p(i=>(i-151)*10+1e3)),new Gl(new m(i=>i>301),new m(i=>i<352),new p(i=>(i-201)*5+1500)),new Gl(new m(i=>i>351),new m(i=>i<402),new p(i=>(i-251)*2+1750)),new Gl(new m(i=>i>401),new p(i=>i-301+1850))],"getRules"),tk=d_});var g_={};var ik=n(()=>{B();rk();f.register(...tk())});var nk=w(ok=>{"use strict";Object.defineProperty(ok,"__esModule",{value:!0});ik()});var h_,ak,sk=n(()=>{AR();et();Eo();ke();Vv();U();C();am();ep();qa();h_=t((i=W,e=K)=>[new gm(new m((r,o)=>i.getByPlayer(o.player()).available().length>0),new p((r,o)=>new tl(r,o))),new gm(new m(r=>[Re,ue,me].some(o=>r.tile().terrain()instanceof o)),new m((r,o)=>r.tile().getSurroundingArea().score(null,[[un,8],[_a,3],[Ka,1]])>=150),new m(r=>r.tile().getSurroundingArea(4).every(o=>e.getByTile(o)===null)),new p((r,o)=>new il(r,o))),new gm(new p((r,o)=>new sl(r,o))),new gm(new p((r,o)=>new ll(r,o)))],"getRules"),ak=h_});var O_,lk,mk=n(()=>{X();Jv();C();O_=t((i=P)=>[new yg(new p((e,r)=>{i.emit("goody-hut:action-performed",e,r)}))],"getRules"),lk=O_});var x_,pk,ck=n(()=>{X();Fl();$v();C();x_=t((i=Ti,e=P,r=()=>Math.random())=>[new Ap(new p(o=>i.unregister(o))),new Ap(new p((o,a)=>{let s=o.actions(a),l=s[Math.floor(s.length*r())];o.action(l)})),new Ap(new p((o,a)=>{e.emit("goody-hut:discovered",o,a)}))],"getRules"),pk=x_});var $O,mc,HC=n(()=>{M();$O=class extends h{};t($O,"Distribution");mc=$O});var R_,uk,fk=n(()=>{Fl();U();HC();R_=t((i=Ti,e=()=>Math.random())=>[new mc(new m(r=>r.isLand())),new mc(new m(r=>r.getSurroundingArea(3).every(o=>i.getByTile(o)===null))),new mc(new m(()=>e()<.05))],"getRules"),uk=R_});var v_,yk,dk=n(()=>{Fl();Jo();B();C();wR();v_=t((i=Ti,e=()=>Math.random(),r=f)=>[new Vf(new p((o,a)=>{let s=[Zt,Qt],l=s[Math.floor(s.length*e())];return new l(null,a.player(),a.tile(),r)}))],"getRules"),yk=v_});var b_,gk,hk=n(()=>{Fl();U();C();Dt();b_=t((i=Ti)=>[new Z(new m(e=>i.getByTile(e.tile())!==null),new p(e=>{i.getByTile(e.tile()).process(e)}))],"getRules"),gk=b_});var ZO,Ll,QO=n(()=>{M();ZO=class extends h{};t(ZO,"Built");Ll=ZO});var C_,Ok,xk=n(()=>{Fl();B();QO();C();Zv();HC();C_=t((i=Ti,e=f)=>[new Ll(new p(r=>{let o=e.get(mc);r.forEach(a=>{o.every(s=>s.validate(a))&&i.register(new hg(a))})}))],"getRules"),Ok=C_});var T_={};var Rk=n(()=>{sk();mk();ck();fk();dk();B();hk();xk();f.register(...ak(),...lk(),...pk(),...uk(),...yk(),...gk(),...Ok())});var bk=w(vk=>{"use strict";Object.defineProperty(vk,"__esModule",{value:!0});Rk()});var P_={};var Ck=n(()=>{ra();Tg();Bp.register(Ft,ht,cr,Ot,wt)});var I_,Tk,Pk=n(()=>{Ln();ra();U();C();Pv();Dn();I_=t((i=Pt)=>[new it(new m(e=>!i.getByPlayer(e).is(fo)),new p(e=>[new Al(e,i.getByPlayer(e))]))],"getRules"),Tk=I_});var w_,Ik,wk=n(()=>{Tg();Ln();B();cm();ra();C();Vl();tb();w_=t((i=Bp,e=Pt,r=f)=>[new Zi(new ua,new p(o=>{let a=new Ag(o,i,r);a.set(new cr),e.register(a)}))],"getRules"),Ik=w_});var A_,Ak,Bk=n(()=>{Qr();ra();ke();Xv();U();A_=t((i=W)=>[new Xc(new m(e=>e===cr)),...[[Ft,St],[ht,No],[Ot,Ai],[wt,co]].map(([e,r])=>new Xc(new m(o=>o===e),new m((o,a)=>i.getByPlayer(a).completed(r))))],"getRules"),Ak=A_});var B_,Gk,Mk=n(()=>{X();Ci();eb();U();C();B_=t((i=P,e=oe)=>[new eu(new p((r,o)=>{i.emit("player:government:changed",r,o)})),new eu(new m(r=>{try{return e.getByPlayer(r),!0}catch(o){if(o instanceof TypeError&&o.message.match(/Wrong number of player worlds exist/))return!1;throw o}}),new p(r=>{e.getByPlayer(r).entries().forEach(a=>a.tile().clearYieldCache(r))}))],"getRules"),Gk=B_});var G_={};var Uk=n(()=>{B();Pk();wk();Bk();Mk();f.register(...Tk(),...Ik(),...Ak(),...Gk())});var Ek=w(Dk=>{"use strict";Object.defineProperty(Dk,"__esModule",{value:!0});Ck();Uk()});var XO,Sk,kk=n(()=>{M();XO=class extends h{};t(XO,"TurnEnd");Sk=XO});var M_,Fk,Yk=n(()=>{Op();X();B();kk();M_=t((i=En,e=f,r=P)=>[["player:turn-end",o=>{i.unregister(o),e.process(Sk,o);let[a]=i.entries();if(!a){r.emit("turn:end");return}r.emit("player:turn-start",a)}]],"getEvents"),Fk=M_});var U_,Nk,Wk=n(()=>{ns();X();B();bu();U_=t((i=Tr,e=P,r=f)=>[["player:turn-start",o=>{r.process(ka,o),i.getByPlayer(o).takeTurn().catch(s=>console.error(s)).finally(()=>{e.emit("player:turn-end",o)})}]],"getEvents"),Nk=U_});var D_,Lk,jk=n(()=>{Op();X();Bl();D_=t((i=Qi,e=En,r=P)=>[["turn:start",()=>{e.register(...i.entries());let[o]=e.entries();r.emit("player:turn-start",o)}]],"getEvents"),Lk=D_});var E_={};var zk=n(()=>{X();Yk();Wk();jk();[...Fk(),...Nk(),...Lk()].forEach(([i,e])=>P.on(i,e))});var ex,Ya,Du=n(()=>{M();ex=class extends h{};t(ex,"Defeated");Ya=ex});var S_,Hk,_k=n(()=>{et();B();Zl();U();Du();C();S_=t((i=K,e=f)=>[new Rr(new m((r,o,a)=>i.getByPlayer(a).filter(s=>s!==r).length===0),new p((r,o,a)=>{e.process(Ya,a,o)}))],"getRules"),Hk=S_});var k_,Kk,qk=n(()=>{et();B();U();Du();Ql();C();k_=t((i=K,e=f)=>[new zr(new m((r,o)=>i.getByPlayer(r.player()).filter(a=>a!==r).length===0),new p((r,o)=>e.process(Ya,r.player(),o)))],"getRules"),Kk=k_});var _C,F_,Vk,Jk=n(()=>{Dn();U();C();hy();Qs();_C=new it(new xi(9001),new m(i=>{_C.disable();let e=i.mandatoryActions();return _C.enable(),e.length===0}),new p(i=>[new gy(i,null)])),F_=t(()=>[_C],"getRules"),Vk=F_});var Y_,$k,Zk=n(()=>{X();cm();C();Y_=t((i=P)=>[new Zi(new p(e=>{i.emit("player:added",e)}))],"getRules"),$k=Y_});var N_,Qk,Xk=n(()=>{Op();X();Bl();U();Du();C();N_=t((i=En,e=Qi,r=P)=>[new Ya(new m(o=>i.includes(o)),new p(o=>i.unregister(o))),new Ya(new m(o=>e.includes(o)),new p(o=>e.unregister(o))),new Ya(new p((o,a)=>{r.emit("player:defeated",o,a)}))],"getRules"),Qk=N_});var tx,rx,KC=n(()=>{M();tx=class extends h{};t(tx,"Spawn");rx=tx});var W_,eF,tF=n(()=>{B();C();Ih();KC();W_=t((i=f)=>[new rx(new p((e,r)=>{new VA(null,e,r,i)}))],"getRules"),eF=W_});var L_,rF,iF=n(()=>{et();B();Ke();C();am();Vl();qp();ep();qa();bu();Go();L_=t((i=f,e=K,r=j)=>[new ka(new ua,new p(o=>{e.getByPlayer(o).forEach(a=>{let s=a.yields();um(s,un,_a,Ka).reduce((l,c,u)=>(l[u].set(c,"Consolidated"),l),[new un(0,"Consolidated"),new _a(0,"Consolidated"),new Ka(0,"Consolidated")]).forEach(l=>i.process(Zo,l,a,s))})})),new ka(new p(o=>r.getByPlayer(o).forEach(a=>{if(a.destroyed())return;a.moves().set(a.movement());let s=a.busy();if(!s){a.setActive(),a.setWaiting(!1);return}!s.validate()||s.process()})))],"getRules"),rF=L_});var j_,oF,nF=n(()=>{X();C();Tv();j_=t((i=P)=>[new Od(new p((e,r)=>{i.emit("player:visibility-changed",e,r)}))],"getRules"),oF=j_});var z_,aF,sF=n(()=>{Bl();Ci();Fy();C();z_=t((i=Qi,e=oe)=>[new Qa(new p(r=>{r.clearYieldCache(null),i.forEach(o=>{e.getByPlayer(o).getByTile(r)!==null&&r.clearYieldCache(o)})}))],"getRules"),aF=z_});var H_,lF,mF=n(()=>{et();B();U();Du();Ic();C();H_=t((i=K,e=f)=>[new yn(new m((r,o)=>i.getByPlayer(r.player()).length===0),new p((r,o)=>e.process(Ya,r.player(),o)))],"getRules"),lF=H_});var __,pF,cF=n(()=>{Ci();C();$R();__=t((i=oe)=>[new By(new p((e,r)=>{e.clearYieldCache(r);let o=i.getByPlayer(r);o.register(e),o.getByTile(e).update()}))],"getRules"),pF=__});var ix,ox,qC=n(()=>{M();ix=class extends h{};t(ix,"PickStartTile");ox=ix});var K_,uF,fF=n(()=>{ir();vt();CC();ns();X();PC();Bl();Ci();B();Xh();QO();$f();C();am();cp();qC();Gc();Rd();ep();tg();KC();qa();K_=t((i=$h,e=Tr,r=P,o=Qi,a=oe,s=f,l=rO,c=Oe,u=re,y=Qp)=>[new Ll(new p(O=>o.entries().forEach(G=>a.register(new yp(G,O))))),new Ll(new p(O=>{let G=new Map,N=new Map,g=t((D,q=null)=>(G.has(D)||G.set(D,D.score(q,[[un,8],[_a,3],[Ka,1]])),G.get(D)),"tileScore"),x=t((D,q=null)=>(N.has(D)||N.set(D,D.getSurroundingArea().entries().reduce((Ce,jr)=>Ce+g(jr,q),0)),N.get(D)),"areaScore");r.emit("world:generate-start-tiles");let d=[],T=O.entries().filter(D=>[wl,mp,eg].some(q=>D.terrain()instanceof q)).map(D=>({tile:D,score:x(D)})).sort(({score:D},{score:q})=>q-D).map(({tile:D})=>D);r.emit("world:start-tiles",T),e.entries().reduce((D,q)=>D.then(async()=>{let Ce=q.player();console.log("processing "+Ce.id()),console.log("waiting for client to choose from list: "+i.entries().map(_t=>_t.name));let jr=await q.chooseFromList(new GR(i.entries(),"choose-civilization")),ma=new jr(c,u);Ce.setCivilization(ma);let Te=await q.chooseFromList(new GR(l.getByCivilization(ma.sourceClass()),"choose-leader")),De=new Te(y);ma.setLeader(De),i.unregister(ma.sourceClass()),l.unregister(De.sourceClass());let[Pe]=s.process(ox,O,Ce,d);if(!Pe)throw new TypeError("Not enough `startingSquare`s.");d.push(Pe),s.process(rx,Ce,Pe)}),Promise.resolve()).then(()=>r.emit("game:start"))})),new Ll(new p(O=>{r.emit("world:built",O)}))],"getRules"),uF=K_});var q_={};var yF=n(()=>{_k();qk();B();Jk();Zk();Xk();tF();iF();nF();sF();mF();cF();fF();f.register(...Hk(),...Kk(),...Vk(),...$k(),...Qk(),...eF(),...rF(),...oF(),...aF(),...lF(),...pF(),...uF())});var gF=w(dF=>{"use strict";Object.defineProperty(dF,"__esModule",{value:!0});zk();yF()});var V_={};var hF=n(()=>{Qr();E();v.register(wa,So,to,Aa,lr,ro,ko,Fo,io,Hn,ls,qr,_n,St,oo,ms,Ii,Yo,no,No,Vr,It,Kn,qn,Ba,Ga,ps,Vn,Pr,cs,Ir,Jr,Jn,us,$r,wi,Wo,mr,Zr,ao,so,$n,Ai,pr,lo,Bi,Lo,Gi,mo,Zn,Qn,Mi,Xn,po,kt,ea,Ma,jo,Ua,Da,zo,co,ys,Ho,ta,wr,uo)});var OF=n(()=>{UR()});var J_,xF,RF=n(()=>{ke();Dn();OF();U();C();J_=t((i=W)=>[new it(new m(e=>i.getByPlayer(e).researching()===null),new m(e=>i.getByPlayer(e).available().length>0),new p(e=>[new im(e,i.getByPlayer(e))]))],"getRules"),xF=J_});var $_,vF,bF=n(()=>{E();ke();B();cm();C();pf();$_=t((i=v,e=W,r=f,o=()=>Math.random())=>[new Zi(new p(a=>e.register(new Ym(a,i,r)))),new Zi(new p(a=>{let s=e.getByPlayer(a);for(let l=0,c=Math.min(s.available().length,Math.floor(4*o()));l<c;l++){let u=s.available();s.addAdvance(u[Math.floor(o()*u.length)])}}))],"getRules"),vF=$_});var Z_,CF,TF=n(()=>{ke();Zl();C();U();Z_=t((i=W,e=()=>Math.random())=>[new Rr(new m((r,o,a)=>i.getByPlayer(a).complete().some(s=>!i.getByPlayer(o).completed(s.constructor))),new p((r,o,a)=>{let s=i.getByPlayer(o),l=i.getByPlayer(a).complete().filter(c=>!s.completed(c.constructor));s.addAdvance(l.map(c=>c.constructor)[Math.floor(e()*l.length)])}))],"getRules"),CF=Z_});var Q_,PF,IF=n(()=>{X();tf();C();Q_=t((i=P)=>[new Xs(new p((e,r)=>{i.emit("player:research-complete",e,r)}))],"getRules"),PF=Q_});var X_,wF,AF=n(()=>{gR();C();X_=t(()=>[new of(new p((i,e)=>(e.complete().length+1)*(6+2*0)))],"getRules"),wF=X_});var eK,BF,GF=n(()=>{ke();B();bm();U();C();qp();jh();eK=t((i=W,e=f)=>[new Zo(new m(r=>r instanceof ar),new m((r,o,a)=>!e.process($o,o,a).some(s=>s)),new p((r,o)=>i.getByPlayer(o.player()).add(r)))],"getRules"),BF=eK});var tK,MF,UF=n(()=>{Qr();U();C();hR();tK=t(()=>[...[[wa,Ga,Vr],[to,ao,pr],[Aa,Ho,mo],[lr,_n,Da],[ro,co,ta],[ko,Ii,Jn],[Hn,wr,so],[ls,Ba,cs],[qr,So],[_n,po,qn],[St,Gi,Ir],[oo,It,ao],[ms,qn,co],[Ii,no,mr],[Yo,ro,Ir],[no,Fo],[No,Gi,$r],[Vr,$n,wi],[It,Kn,Vr],[Kn,Ii,ys],[qn,Pr,Hn],[Ba,mr,Ai],[Ga,_n,mo],[ps,Lo,zo],[Vn,Yo,so],[Pr,Jr,Jn],[Ir,Mi,ro],[Jr,Kn,$r],[Jn,Fo],[us,Zr,St],[$r,qr,uo],[wi,lo,mo],[Wo,So],[Zr,Yo,lr],[ao,So,mr],[so,Gi,ta],[$n,Pr,wr],[Ai,qr,pr],[pr,io],[lo,to,Wo],[Bi,Zr,Aa],[Lo,Bi,It],[Gi,pr,$r],[mo,lo,ao],[Zn,po,jo],[Mi,ko,Ua],[Xn,No,Zr],[po,Yo,Hn],[kt,Gi,uo],[ea,oo,Zn],[Ma,It,wa],[jo,oo,Ma],[Ua,Jr,mo],[Da,$n,Ir],[zo,Zr,Zn],[co,qr,$r],[Ho,to,wr],[ta,qr,no],[wr,Gi,ao],[uo,So]].map(([i,...e])=>new af(new m(r=>r===i),new p((r,o)=>e.every(a=>o.some(s=>s instanceof a)))))],"getRules"),MF=tK});var rK,DF,EF=n(()=>{X();C();lf();rK=t((i=P)=>[new Fm(new p((e,r)=>{i.emit("player:research",e,r)}))],"getRules"),DF=rK});var iK={};var SF=n(()=>{RF();bF();TF();IF();AF();B();GF();UF();EF();f.register(...xF(),...vF(),...CF(),...PF(),...wF(),...BF(),...MF(),...DF())});var FF=w(kF=>{"use strict";Object.defineProperty(kF,"__esModule",{value:!0});hF();SF()});var qs=n(()=>{wC();AC();MC();UC();DC();EC()});var oK={};var YF=n(()=>{qs();em();vo.register(er,tr,dr,Lr,zt,Mt)});var nx,ax,VC=n(()=>{M();nx=class extends h{};t(nx,"Built");ax=nx});var sx,lx,JC=n(()=>{M();sx=class extends h{};t(sx,"ChanceOfSuccess");lx=sx});var mx,px,$C=n(()=>{M();mx=class extends h{};t(mx,"FlightTime");px=mx});var cx,ux,ZC=n(()=>{M();cx=class extends h{};t(cx,"Landed");ux=cx});var fx,NF,WF=n(()=>{M();fx=class extends h{};t(fx,"Launch");NF=fx});var yx,Eu,QC=n(()=>{M();yx=class extends h{};t(yx,"Lost");Eu=yx});var dx,pc,gx=n(()=>{V();B();at();VC();JC();PO();$C();ZC();WF();QC();dx=class extends k{#e=!1;#t;#r;#i;#o;#n=null;#a;constructor(e,r,o=f,a=$,s=()=>Math.random()){super(),this.#r=e,this.#t=r,this.#o=o,this.#a=a,this.#i=s,this.addKey("activeParts","chanceOfSuccess","flightTime","inactiveParts","launched","layout","player","successful","yields")}activeParts(){return this.#t.activeSlots().filter(e=>!e.empty()).map(e=>e.part())}add(e){let[r]=this.#o.process(wm,e,this.#t);!r||(r.fill(e),this.#o.process(ax,e,this))}chanceOfSuccess(){return Math.max(...this.#o.process(lx,this),0)}check(){if(!(this.#n!==null||this.#e===!1||this.#e+this.flightTime()<this.#a.value())){if(this.#n=this.chanceOfSuccess()>this.#i(),this.#n){this.#o.process(ux,this);return}this.#o.process(Eu,this)}}flightTime(){return Math.min(...this.#o.process(px,this),1/0)}inactiveParts(){return this.#t.inactiveSlots().filter(e=>!e.empty()).map(e=>e.part())}launch(){this.#o.process(NF,this),this.#e=this.#a.value()}launched(){return this.#e}layout(){return this.#t}player(){return this.#r}successful(){return this.#n}yields(){return this.activeParts().flatMap(e=>e.yields())}};t(dx,"Spaceship");pc=dx});var hx,Xo,Dm=n(()=>{ge();gx();hx=class extends Y{constructor(){super(pc)}getActiveByPlayer(e){let[r]=this.getBy("player",e).filter(o=>o.launched()===!1||o.successful()===null);return r||null}};t(hx,"SpaceshipRegistry");Xo=new hx});var Ox,xt,oa=n(()=>{ge();Se();Ox=class extends Y{constructor(){super(ve)}getByCity(e){return this.getBy("city",e)}getByPlayer(e){return this.filter(r=>r.city().player()===e)}};t(Ox,"WonderRegistry");xt=new Ox});var na,xx,Rx=n(()=>{Se();na=class extends Ae{};t(na,"ApolloProgram");xx=na});var nK,LF,jF=n(()=>{Jm();qs();ke();Dm();oa();Rx();U();C();Fa();lh();cu();uh();nK=t((i=xt,e=W,r=Xo)=>[new ft(new m((o,a)=>Object.prototype.isPrototypeOf.call(Gt,a)),new p(()=>new m(()=>i.some(o=>o instanceof xx)))),new ft(new m((o,a)=>Object.prototype.isPrototypeOf.call(Gt,a)),new p(o=>new m(()=>{let a=r.getActiveByPlayer(o.player());return a===null?!1:a.launched()===!1}))),...[[Mt,ch],[er,pu],[zt,pu],[tr,fs],[dr,fs],[Lr,fs]].map(([o,a])=>new ft(new m((s,l)=>l===o),new p(s=>new m(()=>e.getByPlayer(s.player()).completed(a)))))],"getRules"),LF=nK});var aK,zF,HF=n(()=>{$m();qs();aK=t(()=>[...[[er,160],[tr,320],[dr,320],[Lr,320],[zt,160],[Mt,80]].flatMap(([i,e])=>ol(i,e))],"getRules"),zF=aK});var sK,_F,KF=n(()=>{Op();UO();B();Dm();at();Rx();Zm();U();C();Fa();gx();sK=t((i=En,e=Xo,r=nc,o=f,a=$,s=()=>Math.random())=>[new zi(new m((l,c)=>c instanceof xx),new p(()=>{let[l]=r.entries(),c=new l(o);i.entries().forEach(u=>e.register(new pc(u,c,o,a,s)))})),new zi(new m((l,c)=>c instanceof Gt),new m((l,c)=>e.getActiveByPlayer(c.city().player())!==null),new p((l,c)=>{let u=c;e.getActiveByPlayer(u.city().player()).add(u)}))],"getRules"),_F=sK});var vx,jl,XC=n(()=>{V();vx=class extends he{#e;#t;constructor(e,r){super(),this.addKey("resource","value"),this.#e=e,this.#t=r}resource(){return this.#e}value(){return this.#t}};t(vx,"SpendCost");jl=vx});var lK,qF,VF=n(()=>{U();C();al();Fa();vc();XC();lK=t(()=>[new bo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Gt,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>new jl(Co,i.remaining()*8))),new bo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Gt,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>new jl(Co,i.remaining()*4)))],"getRules"),qF=lK});var mK,JF,$F=n(()=>{Dm();Dn();U();C();_R();mK=t((i=Xo)=>[new it(new m(e=>i.getActiveByPlayer(e)!==null),new p(e=>[new oP(e,i.getActiveByPlayer(e))]))],"getRules"),JF=mK});var eT,pK,ZF,QF=n(()=>{qs();BC();U();C();eT=new Am(new m(i=>i.part()instanceof zt),new p((i,e)=>{eT.disable();let r=e.activeSlots();return eT.enable(),e.getAdjacent(i).some(o=>o.part()instanceof er&&r.includes(o))})),pK=t(()=>[new Am(new p(i=>i.part()!==null)),new Am(new m(i=>[er,tr,dr,Lr].some(e=>i.part()instanceof e)),new p((i,e)=>e.getAdjacent(i).some(r=>r.part()instanceof Mt))),eT],"getRules"),ZF=pK});var cK,XF,e1=n(()=>{X();VC();C();cK=t((i=P)=>[new ax(new p(e=>{i.emit("player:spaceship:part-built",e.city().player())}))],"getRules"),XF=cK});var aa,t1=n(()=>{je();aa=class extends L{};t(aa,"Energy")});var Na,r1=n(()=>{je();Na=class extends L{};t(Na,"LifeSupport")});var go,i1=n(()=>{je();go=class extends L{};t(go,"Mass")});var zl,o1=n(()=>{je();zl=class extends L{};t(zl,"Population")});var bx=n(()=>{t1();r1();i1();o1()});var uK,n1,a1=n(()=>{bx();qs();JC();C();uK=t(()=>[new lx(new p(i=>{let[e,r,o,a,s]=i.yields().reduce(([G,N,g,x,d],T)=>(T instanceof aa&&T.value()>0&&(G+=T.value()),T instanceof aa&&T.value()<0&&(N+=Math.abs(T.value())),T instanceof Na&&T.value()>0&&(g+=T.value()),T instanceof Na&&T.value()<0&&(x+=Math.abs(T.value())),T instanceof zl&&(d+=T.value()),[G,N,g,x,d]),[0,0,0,0,0]),[l,c]=i.activeParts().reduce(([G,N],g)=>(g instanceof er&&G++,g instanceof zt&&N++,[G,N]),[0,0]);if([e,o,s,l,c].some(G=>G===0))return 0;let u=Math.min(l/c,1),y=Math.min(a/o,1),O=Math.min(r/e,1);return u*y*O}))],"getRules"),n1=uK});var fK,s1,l1=n(()=>{PO();U();C();qs();fK=t(()=>[new wm(new m(i=>i instanceof Mt),new m((i,e)=>e.slots().filter(r=>r.accepts(i)&&r.empty()).length>0),new p((i,e)=>{let r=e.slots().filter(a=>a.accepts(i)&&a.empty()),[o]=r.sort((a,s)=>e.getAdjacent(s).filter(l=>l.part()instanceof Mt).length-e.getAdjacent(a).filter(l=>l.part()instanceof Mt).length||e.getAdjacent(s).filter(l=>!l.empty()).length-e.getAdjacent(a).filter(l=>!l.empty()).length||Math.abs(a.x()-8)-Math.abs(s.x()-8)||Math.abs(a.y()-6)-Math.abs(s.y()-6));return o})),new wm(new m(i=>!(i instanceof Mt)),new m((i,e)=>e.slots().filter(r=>r.accepts(i)&&r.empty()).length>0),new p((i,e)=>{let r=e.slots().filter(a=>a.accepts(i)&&a.empty()),[o]=r.sort((a,s)=>e.getAdjacent(s).filter(l=>!l.empty()).length-e.getAdjacent(a).filter(l=>!l.empty()).length||Math.abs(a.x()-8)-Math.abs(s.x()-8)||Math.abs(a.y()-6)-Math.abs(s.y()-6));return o}))],"getRules"),s1=fK});var yK,m1,p1=n(()=>{at();Gv();$C();C();bx();qs();Go();yK=t((i=Rp,e=$)=>[new px(new p(r=>{let o=Ve(r.yields(),go),a=r.activeParts().reduce((y,O)=>y+(O instanceof zt?1:0),0),s=Math.trunc(o/20/(1+a*10)*10)/10,l=i.value(),c=l+s,u=e.value();for(;i.value(u)<c;)u++;return u}))],"getRules"),m1=yK});var dK,c1,u1=n(()=>{X();C();ZC();dK=t((i=P)=>[new ux(new p(e=>{i.emit("player:spaceship:landed",e.player())}))],"getRules"),c1=dK});var gK,f1,y1=n(()=>{X();UO();B();Dm();at();C();QC();gx();gK=t((i=Xo,e=nc,r=f,o=$,a=P,s=()=>Math.random())=>[new Eu(new p(l=>{a.emit("player:spaceship:lost",l.player())})),new Eu(new p(l=>{let[c]=e.entries(),u=new c(r);i.register(new pc(l.player(),u,r,o,s))}))],"getRules"),f1=gK});var hK,d1,g1=n(()=>{bx();qs();U();C();IC();hK=t(()=>[...[[er,go,400],[tr,aa,-50],[tr,Na,-100],[tr,go,1600],[tr,zl,1e4],[dr,aa,-50],[dr,Na,100],[dr,go,1600],[Lr,aa,100],[Lr,go,400],[zt,go,400],[Mt,go,100]].map(([i,e,r])=>new bO(new m(o=>o instanceof i),new p(o=>new e(r,o.id()))))],"getRules"),d1=hK});var Cx,Tx,tT=n(()=>{M();Cx=class extends h{};t(Cx,"Start");Tx=Cx});var OK,h1,O1=n(()=>{Dm();C();tT();OK=t((i=Xo)=>[new Tx(new p(()=>{i.entries().forEach(e=>e.check())}))],"getRules"),h1=OK});var xK={};var x1=n(()=>{jF();HF();KF();VF();B();$F();QF();e1();a1();l1();p1();u1();y1();g1();O1();f.register(...LF(),...zF(),..._F(),...qF(),...JF(),...ZF(),...XF(),...n1(),...s1(),...m1(),...c1(),...f1(),...d1(),...h1())});var v1=w(R1=>{"use strict";Object.defineProperty(R1,"__esModule",{value:!0});YF();x1()});var Px,Hl,Su=n(()=>{je();Px=class extends L{};t(Px,"TradeRate");Hl=Px});var Vs,b1=n(()=>{Pc();Su();Vs=class extends Hl{};t(Vs,"Luxuries"),Vs.tradeYield=tP});var Js,C1=n(()=>{Cy();Su();Js=class extends Hl{};t(Js,"Research"),Js.tradeYield=ar});var $s,T1=n(()=>{al();Su();$s=class extends Hl{};t($s,"Tax"),$s.tradeYield=Co});var rT=n(()=>{b1();C1();T1()});var Ix,_l,ku=n(()=>{Ro();Su();Ix=class extends Qe{constructor(){super(Hl)}};t(Ix,"AvailableTradeRateRegistry");_l=new Ix});var RK={};var P1=n(()=>{rT();ku();_l.register(Vs,Js,$s)});var I1=n(()=>{vy();qa()});var wx,Ax,iT=n(()=>{V();wx=class extends k{#e;#t=[];constructor(e,...r){super(),this.#e=e,this.#t=r,this.addKey("all")}all(){return[...this.#t]}balance(e){if(this.total()===100)return;let r=100-e.value(),o=this.#t.filter(s=>s!==e),a=o.reduce((s,l)=>s+l.value(),0);o.forEach(s=>s.set(s.value()/a*r)),this.total()<100&&o[Math.floor(o.length*Math.random())].add(100-this.total()),this.total()>100&&o[Math.floor(o.length*Math.random())].subtract(100-this.total())}get(e){let[r]=this.#t.filter(o=>o instanceof e);return r}player(){return this.#e}set(e,r){let o=this.get(e);o.set(r),this.balance(o)}setAll(e){if(e.reduce((r,[,o])=>r+o,0)!==100)throw new TypeError("Invalid rates provided, must sum to 100.");e.forEach(([r,o])=>this.get(r).set(o))}total(){return this.#t.reduce((e,r)=>e+r.value(),0)}};t(wx,"PlayerTradeRates");Ax=wx});var Bx,Kl,Fu=n(()=>{ge();iT();Bx=class extends Y{constructor(){super(Ax)}getByPlayer(e){let r=this.getBy("player",e);if(r.length!==1)throw new TypeError("Wrong number of PlayerTradeRates for player");return r[0]}};t(Bx,"PlayerTradeRatesRegistry");Kl=new Bx});var vK,w1,A1=n(()=>{ku();I1();Fu();C();Vm();Go();vK=t((i=_l,e=Kl)=>[new qm(new p((r,o)=>{let a=e.getByPlayer(r.player()),s=Math.max(0,Ve(o,ce)),l=s;return i.entries().map(c=>{let u=c.tradeYield,y=Math.min(Math.ceil(s*(a.get(c).value()/100)),l);return l-=y,new u(y,c.name)})}))],"getRules"),w1=vK});var bK,B1,G1=n(()=>{Fu();Dn();MR();C();bK=t((i=Kl)=>[new it(new p(e=>[new ul(e,i.getByPlayer(e))]))],"getRules"),B1=bK});var CK,M1,U1=n(()=>{ku();Fu();rT();cm();C();iT();CK=t((i=_l,e=Kl)=>[new Zi(new p(r=>{let o=[new $s(50),new Js(50),new Vs(0)],a=i.entries(),s=new Ax(r,...a.map(l=>{let[c]=o.filter(u=>u instanceof l);return new l(c||0)}));e.register(s)}))],"getRules"),M1=CK});var Gx,TK,D1,E1=n(()=>{ku();et();B();C();Vl();qp();bu();Go();Gx=[],TK=t((i=f,e=K,r=_l)=>[new ka(new ua,new p(o=>{Gx.length===0&&r.entries().forEach(a=>Gx.push(a.tradeYield)),e.getByPlayer(o).forEach(a=>{let s=a.yields();um(s,...Gx).reduce((l,c,u)=>(l[u].set(c,"Consolidated"),l),Gx.map(l=>new l)).forEach(l=>i.process(Zo,l,a,s))})}))],"getRules"),D1=TK});var PK={};var S1=n(()=>{B();A1();G1();U1();E1();f.register(...w1(),...B1(),...M1(),...D1())});var F1=w(k1=>{"use strict";Object.defineProperty(k1,"__esModule",{value:!0});P1();S1()});var Mx=n(()=>{vC();al()});var IK,Y1,N1=n(()=>{He();U();C();Mx();vc();XC();Za();IK=t(()=>[new bo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Fe,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>{let e=i.remaining()/10;return new jl(ze,Math.floor((e+4)*10*e))})),new bo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(Fe,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>{let e=i.remaining()/10;return new jl(ze,Math.floor(5*e**2+20*e))})),new bo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(z,i.building().item())),new m(i=>i.progress().value()===0),new p(i=>new jl(ze,i.remaining()*4))),new bo(new m(i=>i.building()!==null&&Object.isPrototypeOf.call(z,i.building().item())),new m(i=>i.progress().value()>0),new p(i=>new jl(ze,i.remaining()*2)))],"getRules"),Y1=IK});var wK,W1,L1=n(()=>{da();et();Dn();YR();C();wK=t((i=K,e=Kt)=>[new it(new p(r=>i.getByPlayer(r).map(o=>new yl(r,e.getByCity(o)))))],"getRules"),W1=wK});var AK,j1,z1=n(()=>{rm();cm();C();Mx();IR();AK=t((i=Hi)=>[new Zi(new p(e=>i.register(new _f(e,ze))))],"getRules"),j1=AK});var Ux,Dx,oT=n(()=>{M();Ux=class extends h{};t(Ux,"Updated");Dx=Ux});var BK,H1,_1=n(()=>{Mx();Wr();X();rm();B();PR();bm();U();C();qp();oT();BK=t((i=Hi,e=f,r=Be,o=P)=>[new Zo(new m(a=>a instanceof ze),new p((a,s,l)=>{let c=i.getByPlayerAndType(s.player(),ze);l.forEach(u=>{if(u instanceof xe){if(c.value()<u.value()){let y=u.cityImprovement(),O=new Ff(y.constructor,s,e);r.unregister(y),c.add(O.cost().value()),o.emit("city:unsupported-improvement",s,y);return}c.subtract(u.value())}})})),new Zo(new m(a=>a instanceof ze),new m((a,s,l)=>!e.process($o,s,l).some(c=>c)),new p((a,s)=>{let l=i.getByPlayerAndType(s.player(),ze);l.add(a),e.process(Dx,l,s)}))],"getRules"),H1=BK});var GK,K1,q1=n(()=>{X();U();C();oT();GK=t((i=P)=>[new Dx(new m(e=>e.value()<0),new p((e,r)=>{i.emit("player:treasury-exhausted",e.player(),e,r)}))],"getRules"),K1=GK});var MK={};var V1=n(()=>{B();N1();L1();z1();_1();q1();f.register(...Y1(),...W1(),...j1(),...H1(),...K1())});var $1=w(J1=>{"use strict";Object.defineProperty(J1,"__esModule",{value:!0});V1()});var UK={};var Z1=n(()=>{Jo();em();vo.register(ii,oi,fr,Mr,ni,ai,Ur,Dr,si,li,Lt,Er,Zt,Sr,kr,mi,Fr,jt,pi,Yr,Le,Nr,yr,Qt,ci,ui,Xt,fi)});var Ex,cc,nT=n(()=>{M();Ex=class extends h{};t(Ex,"Available");cc=Ex});var Q1=n(()=>{Mu();Mu()});var aT=n(()=>{YC()});var X1=n(()=>{aT();aT()});var sT=n(()=>{Q1();X1()});var Sx,eY,kx,EK,tY,rY=n(()=>{VR();Pa();pm();vt();et();Jo();Eo();as();Ia();xr();B();bn();bi();wp();at();Ke();ts();Ri();$u();nT();U();C();_h();sT();Sx=new m((i,e,r=i.tile())=>i instanceof Ze),eY=new m((i,e,r=i.tile())=>i instanceof We),kx=t((i,e)=>e.getByTile(i)!==null,"tileHasCity"),EK=t((i=re,e=K,r=f,o=_e,a=Cr,s=j,l=bt,c=Ca,u=$,y=sr,O=Ge)=>{let G=[op,qi,new m((g,x)=>s.getByTile(x).some(d=>d.player()!==g.player())),new yi(new ca(new m(g=>g instanceof gt),new yi(new m((g,x)=>!s.getByTile(x).every(d=>d instanceof gt)),new m((g,x)=>g instanceof Lt))),new ca(Sx,new yi(new m((g,x)=>kx(x,e)),new m((g,x)=>s.getByTile(x).some(d=>d instanceof Ze)))),new ca(eY,new yi(new m((g,x)=>!(g instanceof yr)),new m((g,x)=>x.isWater()))))],N=[op,qi,Sx,new m((g,x)=>kx(x,e)),new m((g,x)=>s.getByTile(x).length===0),new m((g,x)=>e.getByTile(x).player()!==g.player())];return[new yt(op,qi,new yi(new ca(Sx,new m((g,x,d=g.tile())=>d.isLand()),new m((g,x)=>x.isLand()),new m((g,x)=>s.getByTile(x).every(d=>d.player()===g.player()))),new ca(eY,new yi(new m((g,x,d=g.tile())=>d.isWater()),new m((g,x,d=g.tile())=>e.getByTile(d)?.player()===g.player())),new yi(new m((g,x)=>x.isWater()),new m((g,x)=>e.getByTile(x)?.player()===g.player()))),new m(g=>g instanceof gt)),new yi(new m((g,x)=>!(g instanceof Ze)),new m((g,x,d=g.tile())=>!(d.getNeighbours().some(T=>s.getByTile(T).some(D=>D instanceof Ze&&D.tile().terrain()instanceof J&&D.player()!==g.player()))&&x.getNeighbours().some(T=>s.getByTile(T).some(D=>D instanceof Ze&&D.tile().terrain()instanceof J&&D.player()!==g.player())))),new m((g,x)=>s.getByTile(x).filter(d=>d.player()===g.player()).length>0),new m((g,x)=>{let d=e.getByTile(x);return d===null?!1:d.player()===g.player()})),new m((g,x)=>{let d=e.getByTile(x);return d===null?!0:d.player()===g.player()}),new m((g,x)=>!s.getByTile(x).some(d=>d.player()!==g.player())),new p((g,x,d=g.tile())=>new mt(d,x,g,r))),new yt(...G,new m((g,x)=>s.getByTile(x).every(d=>y.getByPlayers(g.player(),d.player()).filter(T=>T instanceof ki).every(T=>T.expired()))),new p((g,x,d=g.tile())=>new Vi(d,x,g,r,s))),new yt(...G,new m((g,x)=>s.getByTile(x).every(d=>y.getByPlayers(g.player(),d.player()).filter(T=>T instanceof ki).some(T=>T.active()))),new p((g,x,d=g.tile())=>{let T=Array.from(new Set(s.getByTile(x).filter(D=>y.getByPlayers(g.player(),D.player()).filter(q=>q instanceof ki).some(q=>q.active())).map(D=>D.player())));return T.length>1&&(console.warn("Multiple targets for declaring war:"),console.warn(T),console.warn("core-unit/Rules/Unit/action.ts")),new Un(d,x,g,T[0],r,s)})),new yt(...N,new m((g,x)=>{let d=e.getByTile(x);return y.getByPlayers(g.player(),d.player()).filter(T=>T instanceof ki).every(T=>T.expired())}),new p((g,x,d=g.tile())=>{let T=e.getByTile(x);return new vn(d,x,g,T,r)})),new yt(...N,new m((g,x)=>{let d=e.getByTile(x);return y.getByPlayers(g.player(),d.player()).filter(T=>T instanceof ki).some(T=>T.active())}),new p((g,x,d=g.tile())=>{let T=e.getByTile(x);return new is(d,x,g,T,T.player(),r)})),new yt(qi,Ra,new m(g=>g instanceof _),new m((g,x)=>o.getByTile(x).filter(d=>[Ye,lt,br,qe].some(T=>d instanceof T)).length>0),new p((g,x,d=g.tile())=>new Gn(d,x,g,r,o,u))),new yt(qi,Ra,new m(g=>g instanceof _),new m((g,x,d=g.tile())=>d.isLand()),new p((g,x,d=g.tile())=>new An(d,x,g,r,u,a))),new yt(qi,Ra,new p((g,x,d=g.tile())=>new Ao(d,x,g,r,u))),new yt(qi,Ra,new p((g,x,d=g.tile())=>new Xa(d,x,g,r))),new yt(Ra,new p((g,x,d=g.tile())=>new Bn(d,x,g,r))),new yt(qi,Ra,new m(g=>g instanceof Le),new m((g,x,d=g.tile())=>d.isLand()),new m((g,x,d=g.tile())=>!kx(d,e)),new p((g,x,d=g.tile())=>new rs(d,x,g,i,r,O))),...[[Ye,hn,new yi(new m((g,x,d=g.tile())=>d.terrain()instanceof me),new m((g,x,d=g.tile())=>d.getAdjacent().some(T=>T.terrain()instanceof me||T.terrain()instanceof Or||o.getByTile(T).some(D=>D instanceof Ye)&&!kx(T,e))))],[lt,On],[qe,Rn],[br,xn,new m((g,x)=>o.getByTile(x).some(d=>d instanceof qe))]].map(([g,x,...d])=>new yt(new m(T=>T instanceof Jt),qi,new m((T,D,q=T.tile())=>r.get(cc).some(Ce=>Ce.validate(q,g,T.player()))),Ra,...d,new p((T,D,q=T.tile())=>new x(q,D,T,r,u)))),...[[pt,Pn],[rt,Cn],[ue,Mn],[ct,In]].map(([g,x])=>new yt(qi,Ra,new m(d=>d instanceof Jt),new m((d,T,D=d.tile())=>D.terrain()instanceof g),new p((d,T,D=d.tile())=>new x(D,T,d,r,l,u)))),new yt(op,qi,Sx,new m((g,x)=>x.terrain()instanceof Or),new m((g,x)=>s.getByTile(x).every(d=>d.player()===g.player())),new m((g,x)=>s.getByTile(x).filter(d=>d instanceof Tt).some(d=>d.hasCapacity()&&d.canStow(g))),new p((g,x,d=g.tile())=>{let[T]=s.getByTile(x).filter(D=>D instanceof Tt).filter(D=>D.hasCapacity()&&D.canStow(g));return new es(d,x,g,T,r)})),new yt(op,new m(g=>{try{return c.getByUnit(g),!0}catch{return!1}}),new yi(new m((g,x)=>!(g instanceof Ze)),new m((g,x)=>x.isLand())),new m((g,x,d=g.tile())=>c.getByUnit(g).transport().tile()===d),new p((g,x,d=g.tile())=>{let T=c.getByUnit(g).transport();return new wn(d,x,g,T,r)})),new yt(qi,Ra,new m(g=>g instanceof Tt),new m(g=>g.hasCargo()),new m((g,x)=>x.getNeighbours().some(d=>d.isLand())),new p((g,x,d=g.tile())=>new os(d,x,g,r)))]},"getRules"),tY=EK});var SK,iY,oY=n(()=>{ts();JR();U();C();tu();SK=t((i=Cr)=>[new np(new m(e=>e.moves().value()>0),new p(e=>e.setActive())),new np(new m(e=>e.busy()!==null),new p(e=>e.setBusy())),...[_r].map(e=>new np(new m(r=>i.getByUnit(r).some(o=>o instanceof e)),new p(r=>i.unregister(...i.getByUnit(r).filter(o=>o instanceof e)))))],"getRules"),iY=SK});var kK,nY,aY=n(()=>{Jm();Jo();ke();kg();Fg();Ng();Wg();Lg();jg();U();C();Hg();_g();qg();Vg();$g();Qg();Xg();th();ih();nh();ah();Pa();sh();cu();ph();yh();gh();Oh();Rh();bh();kK=t((i=W)=>[new ft(new m((e,r)=>Object.prototype.isPrototypeOf.call(We,r)),new p(e=>new m(()=>e.tile().isCoast()))),...[[ii,fs],[oi,dh],[fr,ru],[Mr,lu],[ai,ru],[ni,xh],[Ur,oh],[Dr,hh],[si,nu],[li,vh],[Lt,zg],[Er,su],[Zt,Kg],[Sr,fh],[kr,ou],[mi,Zg],[Fr,Gp],[jt,mh],[pi,hm],[Yr,mu],[Nr,Yg],[yr,rh],[Qt,Jg],[ci,iu],[ui,au],[Xt,eh]].map(([e,r])=>new ft(new m((o,a)=>a===e),new p(o=>new m(()=>i.getByPlayer(o.player()).completed(r))))),...[[Mr,fs],[Ur,lu],[Dr,ou],[Er,au],[Zt,hm],[Sr,nu],[kr,iu],[Fr,hm],[Yr,su],[Nr,Gp],[Qt,hm],[Xt,mu],[fi,Gp]].map(([e,r])=>new ft(new m((o,a)=>a===e),new p(o=>new m(()=>!i.getByPlayer(o.player()).completed(r)))))],"getRules"),nY=kK});var FK,sY,lY=n(()=>{$m();Jo();FK=t(()=>[...[[ii,80],[oi,160],[fr,120],[Mr,40],[ni,50],[ai,160],[Ur,40],[Dr,40],[si,80],[li,30],[Lt,60],[Er,40],[Zt,20],[Sr,50],[kr,40],[mi,50],[Fr,30],[jt,160],[pi,30],[Yr,40],[Le,40],[Nr,20],[yr,50],[Qt,20],[ci,80],[ui,50],[Xt,40],[fi,10]].flatMap(([i,e])=>ol(i,e))],"getRules"),sY=FK});var YK,mY,pY=n(()=>{Et();Zm();U();C();Jo();YK=t((i=ie)=>[new zi(new m((e,r)=>r instanceof Le),new p(e=>i.getByCity(e.city()).shrink()))],"getRules"),mY=YK});var NK,cY,uY=n(()=>{X();Ke();Iy();C();NK=t((i=j,e=P)=>[new $a(new p(r=>i.register(r))),new $a(new p(r=>r.applyVisibility())),new $a(new p(r=>r.moves().set(r.movement()))),new $a(new p(r=>{e.emit("unit:created",r)}))],"getRules"),cY=NK});var WK,fY,yY=n(()=>{et();X();B();bi();Ke();U();Ac();Ic();C();WK=t((i=K,e=f,r=_e,o=j,a=P)=>[new dn(new p((s,l)=>{a.emit("unit:defeated",s,l),e.process(yn,s,l.player())})),new dn(new m(s=>i.getByTile(s.tile())===null),new m(s=>o.getByTile(s.tile()).filter(l=>l!==s&&l.player()===s.player()).length>0),new p((s,l)=>o.getByTile(s.tile()).forEach(c=>{c!==s&&c.player()===s.player()&&e.process(yn,s,l.player())})))],"getRules"),fY=WK});var LK,dY,gY=n(()=>{X();ts();Ke();Ic();C();LK=t((i=j,e=Cr,r=P)=>[new yn(new p((o,a)=>{r.emit("unit:destroyed",o,a)})),new yn(new p(o=>{o.setActive(!1),o.setDestroyed()})),new yn(new p(o=>e.getByUnit(o).forEach(a=>e.unregister(a))))],"getRules"),dY=LK});var Fx,uc,lT=n(()=>{M();Fx=class extends h{};t(Fx,"LostAtSea");uc=Fx});var jK,hY,OY=n(()=>{X();C();lT();jK=t((i=P)=>[new uc(new p(e=>{i.emit("unit:lost-at-sea",e)})),new uc(new p(e=>e.destroy(null)))],"getRules"),hY=jK});var Yx,zK,xY,RY=n(()=>{Jo();et();pm();X();as();B();wp();at();$u();U();C();Vl();lT();Dt();_h();Pa();sT();Yx=new Map,zK=t((i=Ca,e=f,r=()=>Math.random(),o=P,a=K,s=$,l=sr)=>[new Z(new p((c,u)=>{o.emit("unit:moved",c,u)})),new Z(new p(c=>c.applyVisibility())),new Z(new m(c=>c.moves().value()<.3),new p(c=>{c.moves().set(0),c.setActive(!1)})),new Z(new m(c=>c instanceof Tt),new m((c,u)=>u instanceof mt),new m(c=>c.hasCargo()),new p((c,u)=>c.cargo().forEach(y=>y.action(u.forUnit(y))))),new Z(new m((c,u)=>u instanceof wn),new p(c=>{let u=i.getByUnit(c);u.transport().unload(c),i.unregister(u)})),new Z(new m(c=>c instanceof Xt),new m(c=>c.moves().value()===0),new m(c=>!c.tile().isCoast()),new m(()=>r()<=.5),new p(c=>{e.process(uc,c)})),...[[fr,1],[Lt,0],[jt,0]].flatMap(([c,u])=>[new Z(new ua,new m(y=>y instanceof c),new m(y=>y.moves().value()===0),new m(y=>!Yx.has(y)),new p(y=>{Yx.set(y,s.value())})),new Z(new m(y=>y instanceof c),new m(y=>y.moves().value()===0),new yi(new m(y=>a.getByTile(y.tile())!==null),new m(y=>!!i.getByUnit(y))),new p(y=>{Yx.delete(y)})),new Z(new m(y=>y instanceof c),new m(y=>y.moves().value()===0),new ca(new m(y=>a.getByTile(y.tile())===null),new m(y=>!i.getByUnit(y))),new m(y=>(Yx.get(y)??s.value())+u<=s.value()),new p(y=>{e.process(uc,y)}))]),new Z(new m((c,u)=>u instanceof Un),new p((c,u)=>{l.filter(O=>O instanceof ki&&O.isBetween(c.player(),u.enemy())&&O.active()).forEach(O=>O.expire())}))],"getRules"),xY=zK});var vY,HK,bY,CY=n(()=>{Eo();Pa();pm();Ia();bi();wp();U();C();Ji();vY=[[qt,2],[Ue,1],[rt,2],[Re,1],[Ne,2],[pt,2],[$e,3],[dt,1],[ue,1],[me,1],[ct,2],[Ct,1]],HK=t((i=_e,e=Ca)=>[...vY.map(([r,o])=>new Me(new m((a,s)=>s instanceof mt),new m(a=>a instanceof Ze),new m((a,s)=>s.to().terrain()instanceof r),new p(()=>o))),new Me(new m((r,o)=>o instanceof mt),new m(r=>r instanceof gt||r instanceof We),new p(()=>1)),new Me(new m((r,o)=>o instanceof mt),new m(r=>r instanceof Ze),new m((r,o)=>i.getByTile(o.from()).some(a=>a instanceof qe)),new m((r,o)=>i.getByTile(o.to()).some(a=>a instanceof qe)),new p(()=>1/3)),new Me(new m((r,o)=>o instanceof mt),new m(r=>r instanceof Ze),new m((r,o)=>i.getByTile(o.from()).some(a=>a instanceof br)),new m((r,o)=>i.getByTile(o.to()).some(a=>a instanceof br)),new p(()=>0)),new Me(new m((r,o)=>o instanceof mt),new m(r=>r instanceof Ze),new m(r=>{try{return e.getByUnit(r),!0}catch{return!1}}),new m(r=>e.getByUnit(r).transport()instanceof Tt),new p(()=>0)),...[[hn,2],[On,3],[Rn,1],[xn,2],[Cn,2],[Pn,3],[In,3],[An,1],[Gn,1],[Mn,3],[Ao,0]].flatMap(([r,o])=>vY.map(([a,s])=>new Me(new m((l,c)=>c instanceof r),new m(l=>l.tile().terrain()instanceof a),new p(()=>o*s))))],"getRules"),bY=HK});var _K,TY,PY=n(()=>{fR();Ke();Dn();U();C();_K=t((i=j)=>[new it(new m(e=>i.getByPlayer(e).some(r=>r.active()&&r.moves().value())),new p(e=>i.getByPlayer(e).filter(r=>r.active()&&r.moves().value()>0).sort((r,o)=>(r.waiting()?1:0)-(o.waiting()?1:0)).map(r=>new ln(e,r)))),new it(new m(e=>i.getByPlayer(e).some(r=>!r.active()||!r.moves().value())),new p(e=>i.getByPlayer(e).filter(r=>!r.active()||r.moves().value()===0).sort((r,o)=>(r.waiting()?1:0)-(o.waiting()?1:0)).map(r=>new mn(e,r))))],"getRules"),TY=_K});var KK,IY,wY=n(()=>{C();ld();qv();KK=t(()=>[new sg(new p(i=>i.action(new oI(i.tile(),i.tile(),i))))],"getRules"),IY=KK});var qK,AY,BY=n(()=>{ip();Jo();tu();B();ts();ap();ap();U();C();qK=t((i=Cr,e=f)=>[...[[ii,12,2,2],[oi,18,12,4,2],[fr,12,1,8,2],[Mr,8],[ni,0],[ai,1,12,5,2],[Ur,6],[Dr,4,1,2],[si,6,6,6,2],[li,0,0,2],[Lt,4,2,10,2],[Er,2,2,3],[Zt,2,1,2],[Sr,4,4,4],[kr,4,2,2],[mi,6,6,3],[Fr,3,2],[jt,99,0,16],[pi,3,5],[Yr,1,1,3],[Le,0],[Nr,1,2],[yr,8,2,3,2],[Qt,3],[ci,10,5,3],[ui,0,3,4],[Xt,1,0,3],[fi]].flatMap(([r,o=1,a=1,s=1,l=1])=>pP(r,o,a,s,l)),...[[_r,1,Ki],[zn,.5,To,Ki]].flatMap(([r,o,...a])=>a.map(s=>new lm(new m((l,c)=>c instanceof s),new m(l=>i.getByUnit(l).some(c=>c instanceof r)),new p((l,c)=>{let u=new s;e.process(bl,l.constructor,u),c.add(u.value()*o,r.name)}))))],"getRules"),AY=qK});var VK,GY,MY=n(()=>{X();C();kh();VK=t((i=P)=>[new Cm(new p((e,r)=>{i.emit("unit:unsupported",e,r)}))],"getRules"),GY=VK});var JK,UY,DY=n(()=>{U();C();av();JK=t((i=()=>Math.random())=>[new Bc(new m((e,r)=>e.moves().value()>=r),new p((e,r)=>(e.moves().subtract(r),!0))),new Bc(new m((e,r)=>e.moves().value()<r),new p((e,r)=>{let o=e.moves().value();return e.moves().set(0),o>=r*.5*i()}))],"getRules"),UY=JK});var $K={};var EY=n(()=>{rY();oY();aY();lY();pY();uY();yY();gY();B();OY();RY();CY();PY();wY();BY();MY();DY();f.register(...tY(),...iY(),...nY(),...sY(),...mY(),...cY(),...fY(),...dY(),...hY(),...xY(),...bY(),...TY(),...IY(),...AY(),...GY(),...UY())});var kY=w(SY=>{"use strict";Object.defineProperty(SY,"__esModule",{value:!0});Z1();EY()});var di,FY=n(()=>{Se();di=class extends ve{};t(di,"Colossus")});var Fi,YY=n(()=>{Se();Fi=class extends ve{};t(Fi,"CopernicusObservatory")});var en,NY=n(()=>{Se();en=class extends Ae{};t(en,"CureForCancer")});var tn,WY=n(()=>{Se();tn=class extends Ae{};t(tn,"DarwinsVoyage")});var gi,LY=n(()=>{Se();gi=class extends ve{};t(gi,"GreatLibrary")});var rn,jY=n(()=>{Se();rn=class extends ve{};t(rn,"GreatWall")});var Yi,zY=n(()=>{Se();Yi=class extends ve{};t(Yi,"HangingGardens")});var Wa,HY=n(()=>{Se();Wa=class extends Ae{};t(Wa,"HooverDam")});var on,_Y=n(()=>{Se();on=class extends Ae{};t(on,"IsaacNewtonsCollege")});var ho,KY=n(()=>{Se();ho=class extends Ae{};t(ho,"JsBachsCathedral")});var Ni,qY=n(()=>{Se();Ni=class extends Ae{};t(Ni,"Lighthouse")});var nn,VY=n(()=>{Se();nn=class extends ve{};t(nn,"MagellansExpedition")});var sa,JY=n(()=>{Se();sa=class extends Ae{};t(sa,"ManhattanProject")});var hi,$Y=n(()=>{Se();hi=class extends Ae{};t(hi,"MichelangelosChapel")});var gr,ZY=n(()=>{Se();gr=class extends ve{};t(gr,"Oracle")});var an,QY=n(()=>{Se();an=class extends ve{};t(an,"Pyramids")});var sn,XY=n(()=>{Se();sn=class extends Ae{};t(sn,"SetiProgram")});var Oi,eN=n(()=>{Se();Oi=class extends Ae{};t(Oi,"ShakespearesTheatre")});var La,tN=n(()=>{Se();La=class extends Ae{};t(La,"UnitedNations")});var Oo,rN=n(()=>{Se();Oo=class extends Ae{};t(Oo,"WomensSuffrage")});var ja=n(()=>{Rx();FY();YY();NY();WY();LY();jY();zY();HY();_Y();KY();qY();VY();JY();$Y();ZY();QY();XY();eN();tN();rN()});var ZK={};var iN=n(()=>{ja();em();vo.register(na,di,Fi,en,tn,gi,rn,Yi,Wa,on,ho,Ni,nn,sa,hi,gr,an,sn,Oi,La,Oo)});var QK,oN,nN=n(()=>{ja();Qr();Jm();ke();oa();U();C();Se();Jo();QK=t((i=W,e=xt)=>[new ft(new m((r,o)=>Object.isPrototypeOf.call(ve,o)),new p((r,o)=>new m(()=>e.filter(a=>a instanceof o).length===0))),...[[di,Fo],[Fi,to],[gi,$r],[rn,mr],[Yi,Qn],[Ni,Wo],[nn,lo],[gr,io],[an,mr],[na,jo],[en,Vn],[tn,Mi],[Wa,It],[on,Ho],[ho,kt],[sa,Bi],[hi,kt],[sn,oo],[Oi,so],[La,St],[Oo,Ir]].map(([r,o])=>new ft(new m((a,s)=>s===r),new p(a=>new m(()=>i.getByPlayer(a.player()).completed(o))))),...[[jt,sa]].map(([r,o])=>new ft(new m((a,s)=>s===r),new p(()=>new m(()=>e.some(a=>a instanceof o)))))],"getRules"),oN=QK});var XK,aN,sN=n(()=>{ja();$m();XK=t(()=>[...[[na,600],[di,200],[Fi,300],[en,600],[tn,300],[gi,300],[rn,300],[Yi,300],[Wa,600],[on,400],[ho,400],[Ni,200],[nn,400],[sa,600],[hi,300],[gr,300],[an,300],[sn,600],[Oi,400],[La,600],[Oo,600]].flatMap(([i,e])=>ol(i,e))],"getRules"),aN=XK});var e2,lN,mN=n(()=>{da();X();ke();B();oa();Zm();U();ja();C();lf();Se();e2=t((i=Kt,e=W,r=f,o=xt,a=P)=>[new zi(new m((s,l)=>l instanceof ve),new p((s,l)=>{let c=l.constructor;o.register(l),i.filter(u=>u.building()?.item()===c).forEach(u=>u.revalidate())})),new zi(new m((s,l)=>l instanceof ve),new p((s,l)=>{a.emit("wonder:built",l,s.city())})),new zi(new m((s,l)=>l instanceof tn),new p(s=>{let l=e.getByPlayer(s.city().player()),c=t(y=>{let O=new Fm(new m(G=>G===l),new p(()=>{r.unregister(O),y()}));r.register(O)},"createOnStarted"),u=t(()=>{l.add(l.cost()),c(()=>l.add(l.cost()))},"completeResearch");if(l.researching()===null){c(()=>u());return}u()}))],"getRules"),lN=e2});var fc,xo,Yu=n(()=>{oa();U();fc=t((i,e=xt)=>new m(r=>e.getByCity(r).some(o=>o instanceof i)),"cityHasWonder"),xo=t((i,e=xt)=>new m(r=>e.getByPlayer(r.player()).some(o=>o instanceof i)),"playerHasWonder")});var pN,la,Nx,Nu=n(()=>{ke();U();pN=t((i,e=W)=>new m(r=>e.getByPlayer(r.player()).completed(i)),"discoveredByPlayer"),la=t((i,e=W)=>new m(()=>i===null||!e.some(r=>r.completed(i))),"notDiscoveredByAnyPlayer"),Nx=t((i,e=W)=>new m(r=>i===null||!e.getByPlayer(r.player()).completed(i)),"notDiscoveredByPlayer")});var Wx,cN=n(()=>{Wr();U();Wx=t((i,e=Be)=>new m(r=>e.getByCity(r).some(o=>o instanceof i)),"hasCityImprovement")});var t2,uN,fN=n(()=>{yo();Wr();Qr();ja();Ln();ke();Ke();oa();Yu();Nu();Km();U();C();Ha();zh();Qs();Ja();cN();Go();t2=t((i=Be,e=Pt,r=W,o=j,a=xt)=>[new ut(new ot,xo(gr,a),Wx($t,i),Nx(pr,r),la(kt,r),new p((s,l)=>new nt(-Math.min(1,Ve(l,nt)),gr.name))),new ut(new ot,xo(gr,a),Wx($t,i),pN(pr,r),la(kt,r),new p((s,l)=>new nt(-Math.min(2,Ve(l,nt)),gr.name))),new ut(new xi(4e3),fc(Oi,a),la(It,r),new p((s,l)=>new nt(-Ve(l,nt),Oi.name))),new ut(new ot,xo(ho,a),new p((s,l)=>new nt(-Math.min(2,Ve(l,nt)),ho.name))),new ut(new ot,xo(hi,a),Wx(Br,i),la(St,r),new p((s,l)=>new nt(-Math.min(4,Ve(l,nt)),hi.name))),new ut(new ot,xo(Oo,a),new m((s,l)=>l.some(c=>c instanceof Bs)),new p((s,l)=>l.flatMap(c=>c instanceof Bs?new nt(-1,Oo.name):[])))],"getRules"),uN=t2});var r2,yN,dN=n(()=>{oa();Ql();U();C();r2=t((i=xt)=>[new zr(new m(e=>i.getByCity(e).length>0),new p(e=>i.getByCity(e).forEach(r=>i.unregister(r))))],"getRules"),yN=r2});var i2,gN,hN=n(()=>{ja();Qr();Ja();ke();oa();Yu();Vm();C();Qs();Nu();i2=t((i=W,e=xt)=>[new cn(new xi(500),fc(di,e),la(Vr,i),new p(r=>new ce(r.tilesWorked().filter(o=>o.yields().some(a=>a instanceof ce)).length,di.name))),...[[Yi,1,Jr],[en,1,null]].map(([r,o,a])=>new cn(xo(r,e),la(a,i),new p(()=>new hl(o,r.name))))],"getRules"),gN=i2});var o2,ON,xN=n(()=>{ja();ke();oa();Yu();Qr();C();Ha();Ja();Gf();Nu();Go();o2=t((i=W,e=xt)=>[...[[Fi,ar,1,lr]].map(([r,o,a,s])=>new Xl(new ot,fc(r,e),la(s,i),new p((l,c)=>new o(Ve(c,o)*a,r.name)))),...[[sn,ar,.5,null]].map(([r,o,a,s])=>new Xl(new ot,xo(r,e),la(s,i),new p((l,c)=>new o(Ve(c,o)*a,r.name))))],"getRules"),ON=o2});var Lx,jx,mT=n(()=>{M();Lx=class extends h{};t(Lx,"Obsolete");jx=Lx});var n2,RN,vN=n(()=>{Qr();ja();ke();B();oa();tf();U();C();mT();n2=t((i=W,e=f,r=xt)=>[new Xs(new m(()=>r.some(o=>o instanceof gi)),new m((o,a)=>{let[s]=r.filter(c=>c instanceof gi).map(c=>c.city().player());return!i.getByPlayer(s).completed(a.sourceClass())}),new m((o,a)=>i.filter(s=>s.completed(a.sourceClass())).length>=3),new p((o,a)=>{let[s]=r.filter(c=>c instanceof gi).map(c=>c.city().player());return i.getByPlayer(s).addAdvance(a.sourceClass())})),...[[di,Vr],[Fi,lr],[gi,wr],[rn,Pr],[Yi,Jr],[on,Bi],[Ni,wi],[hi,St],[gr,kt],[an,St],[Oi,It]].map(([o,a])=>new Xs(new m(()=>r.entries().some(s=>s instanceof o)),new m((s,l)=>l instanceof a),new p(()=>{let[s]=r.filter(l=>l instanceof o);e.process(jx,s,s.city())})))],"getRules"),RN=n2});var a2,bN,CN=n(()=>{ja();ke();oa();U();C();Ha();Qr();ip();Pa();ap();Nu();Yu();a2=t((i=xt,e=W)=>[new wc(new ot,new m((r,o)=>o instanceof Po),new m(r=>r instanceof We),xo(Ni,i),Nx(wi,e),new p((r,o)=>o.add(1))),new wc(new ot,new m((r,o)=>o instanceof Po),new m(r=>r instanceof We),xo(nn,i),new p((r,o)=>o.add(1)))],"getRules"),bN=a2});var s2,TN,PN=n(()=>{X();C();mT();s2=t((i=P)=>[new jx(new p((e,r)=>{i.emit("wonder:obsolete",e,r)}))],"getRules"),TN=s2});var l2={};var IN=n(()=>{nN();sN();mN();fN();dN();hN();xN();B();vN();CN();PN();f.register(...oN(),...aN(),...lN(),...uN(),...yN(),...gN(),...ON(),...RN(),...bN(),...TN())});var AN=w(wN=>{"use strict";Object.defineProperty(wN,"__esModule",{value:!0});iN();IN()});var m2,BN,GN=n(()=>{Eo();Ia();ke();Qr();bi();nT();U();m2=t((i=W,e=_e)=>[...[[Ye,Ue,Re,Ne,ue,me],[lt,Ue,Ne,$e],[qe,qt,Ue,rt,Re,Ne,pt,$e,ue,ct,Ct]].map(([r,...o])=>new cc(new m((a,s)=>s===r),new m(a=>o.some(s=>a.terrain()instanceof s)),new m((a,s)=>!e.getByTile(a).some(l=>l instanceof s)))),...[[qe,ko,me]].map(([r,o,...a])=>new cc(new m((s,l)=>l===r),new m(s=>a.some(l=>s.terrain()instanceof l)),new m((s,l)=>!e.getByTile(s).some(c=>c instanceof l)),new m((s,l,c)=>i.getByPlayer(c).completed(o)))),...[[br,Mi,qe,qt,Ue,rt,Re,Ne,pt,$e,ue,me,ct,Ct]].map(([r,o,a,...s])=>new cc(new m((l,c)=>c===r),new m(l=>s.some(c=>l.terrain()instanceof c)),new m((l,c)=>!e.getByTile(l).some(u=>u instanceof c)),new m(l=>e.getByTile(l).some(c=>c instanceof a)),new m((l,c,u)=>i.getByPlayer(u).completed(o))))],"getRules"),BN=m2});var p2,MN,UN=n(()=>{X();Ia();bi();Fy();U();C();p2=t((i=_e,e=P)=>[new Qa(new m((r,o)=>i.getByTile(r).every(a=>o.constructor!==a.constructor)),new p((r,o)=>i.register(o))),new Qa(new p(r=>r.clearYieldCache(null))),new Qa(new p((r,o)=>{e.emit("tile-improvement:built",r,o)})),...[[lt,Ye],[Ye,lt]].map(([r,o])=>new Qa(new m((a,s)=>s instanceof r),new m(a=>i.getByTile(a).some(s=>s instanceof o)),new p(a=>i.unregister(...i.getByTile(a).filter(s=>s instanceof o)))))],"getRules"),MN=p2});var zx,Hx,pT=n(()=>{Ro();$i();zx=class extends Qe{constructor(){super(tt)}};t(zx,"AvailableTerrainFeatureRegistry");Hx=new zx});var c2,DN,EN=n(()=>{pT();B();xR();C();pp();c2=t((i=f,e=Hx)=>[new yf(new p(r=>{let o=i.get(Il);e.entries().forEach(a=>o.filter(s=>s.validate(a,r)).forEach(s=>s.process(a,r)))}))],"getRules"),DN=c2});var rr,cT=n(()=>{M();rr=class extends h{};t(rr,"Distribution")});var u2,SN,kN=n(()=>{Eo();cT();xr();U();C();u2=t(()=>[new rr(new m(i=>i===qt),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:0,to:.01,fill:!0},{from:.01,to:.02},{from:.98,to:.99},{from:.99,to:1,fill:!0}])),new rr(new m(i=>i===Ue),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.4,to:.45},{from:.45,to:.55,coverage:.025,cluster:!0,clusterChance:.1},{from:.55,to:.6}])),new rr(new m(i=>i===rt),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.05,to:.2},{from:.2,to:.4,cluster:!0,clusterChance:.1,coverage:.1},{from:.4,to:.6},{from:.6,to:.8,cluster:!0,clusterChance:.1,coverage:.1},{from:.8,to:.95}])),new rr(new m(i=>i===Re),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{fill:!0}])),new rr(new m(i=>i===Ne),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.1,to:.9,path:!0,pathChance:.1,coverage:.06}])),new rr(new m(i=>i===pt),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.3,to:.45,cluster:!0,clusterChance:.2,coverage:.08},{from:.55,to:.7,cluster:!0,clusterChance:.2,coverage:.08}])),new rr(new m(i=>i===$e),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.01,to:.1,coverage:.3,path:!0},{from:.1,to:.9,path:!0},{from:.9,to:.99,coverage:.3,path:!0}])),new rr(new m(i=>i===dt),new m((i,e)=>e.some(r=>r.constructor===Or)),new p(()=>[{fill:!0}])),new rr(new m(i=>i===ue),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.01,to:.2,coverage:.3},{from:.2,to:.4},{from:.1,to:.4,cluster:!0},{from:.4,to:.6},{from:.6,to:.8},{from:.6,to:.9,cluster:!0},{from:.8,to:.99,coverage:.3}])),new rr(new m(i=>i===me),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.1,to:.9,coverage:.1,path:!0,pathChance:.5}])),new rr(new m(i=>i===ct),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.2,to:.4,cluster:!0},{from:.6,to:.8,cluster:!0}])),new rr(new m(i=>i===Ct),new m((i,e)=>e.some(r=>r instanceof J)),new p(()=>[{from:.01,to:.15,cluster:!0,coverage:.15},{from:.85,to:.99,cluster:!0,coverage:.15}]))],"getRules"),SN=u2});var _x,Kx,uT=n(()=>{M();_x=class extends h{};t(_x,"DistributionGroups");Kx=_x});var f2,FN,YN=n(()=>{Eo();C();uT();f2=t(()=>[new Kx(new p(()=>[dt,Re,ct,$e,pt,Ne,rt,Ue,ue,Ct,qt,me]))],"getRules"),FN=f2});var y2,NN,WN=n(()=>{Eo();Qc();bn();pp();y2=t((i=bt)=>[...[[Sn,.2,Ne],[kn,.2,dt],[Xi,.2,rt,Ct],[Fn,.2,pt],[Yn,.2,$e],[wo,.2,ue],[eo,.2,Ue],[Nn,.2,ct],[Wn,.2,qt],[Tn,.5,Re,me]].flatMap(([r,o,...a])=>a.flatMap(s=>EP(s,r,o,i)))],"getRules"),NN=y2});var qx,Vx,LN=n(()=>{M();qx=class extends h{};t(qx,"Pillaged");Vx=qx});var d2,jN,zN=n(()=>{X();bi();LN();U();C();d2=t((i=_e,e=P)=>[new Vx(new m((r,o)=>i.getByTile(r).includes(o)),new p((r,o)=>i.unregister(o))),new Vx(new p(r=>r.clearYieldCache(null))),new Vx(new p((r,o)=>{e.emit("tile-improvement:pillaged",r,o)}))],"getRules"),jN=d2});var fT,yT,dT,g2,h2,O2,x2,HN,_N=n(()=>{zC();X();Va();Eo();C();qC();fT=new Map,yT=new Map,dT=new Map,g2=t((i,e=null)=>(yT.has(i)||yT.set(i,i.score(e,[[te,8],[Q,3],[ce,1]])),yT.get(i)),"tileScore"),h2=t((i,e=null)=>(dT.has(i)||dT.set(i,i.getSurroundingArea().entries().reduce((r,o)=>r+g2(o,e),0)),dT.get(i)),"areaScore"),O2=t((i,e=P)=>{if(!fT.has(i)){e.emit("world:generate-start-tiles");let r=i.entries().filter(o=>[Re,ue,me].some(a=>o.terrain()instanceof a)).map(o=>({tile:o,score:h2(o)})).sort(({score:o},{score:a})=>a-o).map(({tile:o})=>o);fT.set(i,r),e.emit("world:start-tiles",r)}return fT.get(i)},"pickStartTiles"),x2=t((i=JO,e=P,r=()=>Math.random())=>[new ox(new p((o,a,s)=>{if(e.option("earth",!1))try{return i.getStartTileByCivilizationAndWorld(a.civilization().sourceClass(),o)}catch{s.push(...i.entries().map(u=>u.startTileForMap(o)))}let l=O2(o,e);return l.forEach(c=>{s.some(u=>u.distanceFrom(c)<=4)&&l.splice(l.indexOf(c),1)}),l[Math.floor(l.length*r())]}))],"getRules"),HN=x2});var Jx,yc,$x=n(()=>{HO();Ro();Jx=class extends Qe{constructor(){super(zO)}};t(Jx,"GeneratorRegistry");yc=new Jx});var Zx,Qx,gT=n(()=>{M();Zx=class extends h{};t(Zx,"PickGenerator");Qx=Zx});var Xx,eR,hT=n(()=>{M();Xx=class extends h{};t(Xx,"Start");eR=Xx});var tR,KN,qN=n(()=>{V();B();QO();ge();ji();tR=class extends k{#e;#t;#r;#i=new Zs(ye);#o;constructor(e,r=f){super(),this.#e=e,this.#t=e.height(),this.#o=e.width(),this.#r=r,this.addKey("height","tiles","width")}build(){return new Promise(e=>{this.#e.generate().then(r=>{r.forEach((o,a)=>{let s=new ye(a%this.#o,Math.floor(a/this.#o),o,this,this.#r);this.#i.register(s)}),this.#r.process(Ll,this),e(this)})})}entries(){return this.#i.entries()}filter(e){return this.entries().filter(e)}forEach(e){return this.#i.forEach(e)}get(e,r){return this.entries()[this.#e.coordsToIndex(e,r)]}height(){return this.#t}includes(e){return this.#i.includes(e)}map(e){return this.#i.map(e)}register(...e){this.#i.register(...e)}tiles(){return this.entries()}width(){return this.#o}};t(tR,"World");KN=tR});var R2,VN,JN=n(()=>{$x();B();X();C();gT();hT();qN();R2=t((i=f,e=yc,r=P)=>[new eR(new p(()=>{let[o]=i.process(Qx),a=new o(parseInt(r.option("height",100),10),parseInt(r.option("width",160),10),{landCoverage:parseFloat(r.option("landCoverage",.4)),landSize:parseFloat(r.option("landSize",.2)),maxIterations:parseInt(r.option("maxIterations",20),10)});new KN(a,i).build()}))],"getRules"),VN=R2});var v2,$N,ZN=n(()=>{Qc();Eo();Va();Ia();ra();Ln();bn();bi();U();C();bR();v2=t((i=_e,e=bt,r=Pt)=>[...[[te,rt,1],[te,Re,2],[te,Ne,1],[te,pt,1],[te,dt,1],[te,ue,1],[te,me,2],[te,ct,1],[te,Ct,1],[Q,Ue,1],[Q,rt,2],[Q,$e,1],[Q,ue,1]].map(([o,a,s])=>new Li(new m(l=>l.terrain()instanceof a),new p(()=>new o(s,a.name)))),...[[Q,Sn,2],[te,kn,1],[te,Xi,1],[ce,Fn,2],[ce,Yn,3],[Q,wo,1],[te,eo,2],[Q,Nn,3],[te,Wn,2],[Q,Tn,1]].map(([o,a,s])=>new Li(new m(l=>e.getByTerrain(l.terrain()).some(c=>c instanceof a)),new p(()=>new o(s,a.name)))),...[[Q,Sn,1],[te,kn,1],[te,Xi,1],[ce,Fn,2],[ce,Yn,2],[Q,wo,1],[te,eo,1],[Q,Nn,1],[te,Wn,1]].map(([o,a,s])=>new Li(new m((l,c)=>{if(!c)return!1;try{return r.getByPlayer(c).is(Ft,ht,Ot,wt)}catch{return!1}}),new m(l=>e.getByTerrain(l.terrain()).some(c=>c instanceof a)),new p(()=>new o(s,a.name)))),new Li(new m(o=>o.terrain()instanceof dt),new p(()=>new ce(2,dt.name))),new Li(new m(o=>o.terrain()instanceof me),new p(()=>new ce(1))),new Li(new m((o,a)=>{if(!a)return!1;try{return r.getByPlayer(a).is(ht,wt)}catch{return!1}}),new m(o=>o.terrain()instanceof me||o.terrain()instanceof dt),new p(()=>new ce(1,dt.name))),...[[Ue,te,Ye,1],[Ue,Q,lt,1],[Ne,te,Ye,1],[Ne,Q,lt,2],[$e,Q,lt,1],[ue,te,Ye,1]].map(([o,a,s,l])=>new Li(new m(c=>c.terrain()instanceof o),new m(c=>i.getByTile(c).some(u=>u instanceof s)),new p(()=>new a(l,s.name)))),...[[Ue,Q,lt,1],[Re,te,Ye,1],[Ne,Q,lt,1],[$e,Q,lt,1],[me,te,Ye,1]].map(([o,a,s,l])=>new Li(new m((c,u)=>{if(!u)return!1;try{return r.getByPlayer(u).is(Ft,ht,Ot,wt)}catch{return!1}}),new m(c=>c.terrain()instanceof o),new m(c=>i.getByTile(c).some(u=>u instanceof s)),new p(()=>new a(l,s.name)))),...[Ue,Re,ue].map(o=>new Li(new m(a=>a.terrain()instanceof o),new m(a=>i.getByTile(a).some(s=>s instanceof qe)),new p(()=>new ce(1,qe.name)))),...[Ue,Re,ue].map(o=>new Li(new m((a,s)=>{if(!s)return!1;try{return r.getByPlayer(s).is(ht,wt)}catch{return!1}}),new m(a=>a.terrain()instanceof o),new m(a=>i.getByTile(a).some(s=>s instanceof qe)),new p(()=>new ce(1,qe.name))))],"getRules"),$N=v2});var b2,QN,XN=n(()=>{Va();bi();U();C();Ha();Ia();vR();b2=t((i=_e)=>[...[[te,.5],[Q,.5],[ce,.5]].map(([e,r])=>new hf(new za,new m((o,a,s)=>s.some(l=>l instanceof e)),new m(o=>i.getByTile(o).some(a=>a instanceof br)),new p((o,a,s)=>{let l=s.filter(c=>c instanceof e).reduce((c,u)=>c+u.value(),0);s.push(new e(Math.floor(l*r),br.name))})))],"getRules"),QN=b2});var C2,eW,tW=n(()=>{X();$x();KO();C();gT();C2=t((i=yc,e=P,r=()=>Math.random())=>[new Qx(new p(()=>{if(e.option("earth",!1))return lc;let o=i.entries();if(o.length===0)throw new TypeError("No available `World` generators.");return o[Math.floor(o.length*r())]}))],"getRules"),eW=C2});var T2={};var rW=n(()=>{GN();UN();EN();kN();YN();WN();B();zN();_N();JN();ZN();XN();tW();f.register(...BN(),...MN(),...DN(),...SN(),...FN(),...NN(),...jN(),...HN(),...VN(),...$N(),...QN(),...eW())});var rR,iR,OT=n(()=>{Ro();jm();rR=class extends Qe{constructor(){super(fa)}};t(rR,"TerrainRegistry");iR=new rR});var P2={};var iW=n(()=>{Eo();OT();iR.register(qt,Ue,rt,Re,Ne,pt,$e,dt,ue,me,ct,Ct)});var I2={};var oW=n(()=>{Qc();pT();Hx.register(Sn,kn,Xi,Fn,Yn,wo,eo,Nn,Wn,Tn)});var aW=w(nW=>{"use strict";Object.defineProperty(nW,"__esModule",{value:!0});rW();iW();oW()});var w2,sW,lW=n(()=>{et();Rt();Kr();ji();w2=t((i=K)=>[new ee(H,"cities",e=>i.getByPlayer(e)),new ee(ye,"city",e=>i.getByTile(e))],"getAdditionalData"),sW=w2});var A2,mW,pW=n(()=>{Ri();Rt();ji();A2=t((i=Ge)=>[new ee(ye,"workedBy",e=>i.getByTile(e)?.city()??null)],"getAdditionalData"),mW=A2});var B2={};var cW=n(()=>{lW();Ut();pW();ne.register(...sW(),...mW())});var fW=w(uW=>{"use strict";Object.defineProperty(uW,"__esModule",{value:!0});cW()});var G2,yW,dW=n(()=>{da();Rt();ya();G2=t((i=Kt)=>[new ee(Xe,"build",e=>i.getByCity(e))],"getAdditionalData"),yW=G2});var M2={};var gW=n(()=>{dW();Ut();ne.register(...yW())});var OW=w(hW=>{"use strict";Object.defineProperty(hW,"__esModule",{value:!0});gW()});var U2,xW,RW=n(()=>{Et();Rt();ya();U2=t((i=ie)=>[new ee(Xe,"growth",e=>i.getByCity(e))],"getAdditionalData"),xW=U2});var D2={};var vW=n(()=>{Ut();RW();ne.register(...xW())});var CW=w(bW=>{"use strict";Object.defineProperty(bW,"__esModule",{value:!0});vW()});var E2,TW,PW=n(()=>{B();Rt();Lh();ya();bm();E2=t((i=f)=>[new ee(Xe,"civilDisorder",e=>i.process($o,e,e.yields()).some(r=>r)),new ee(Xe,"celebrateLeader",e=>i.process(Vp,e,e.yields()).some(r=>r))],"getAdditionalData"),TW=E2});var S2={};var IW=n(()=>{PW();Ut();ne.register(...TW())});var AW=w(wW=>{"use strict";Object.defineProperty(wW,"__esModule",{value:!0});IW()});var k2,BW,GW=n(()=>{Wr();Rt();ya();k2=t((i=Be)=>[new ee(Xe,"improvements",e=>i.getByCity(e))],"getAdditionalData"),BW=k2});var F2={};var MW=n(()=>{Ut();GW();ne.register(...BW())});var DW=w(UW=>{"use strict";Object.defineProperty(UW,"__esModule",{value:!0});MW()});var Y2,EW,SW=n(()=>{Fl();Rt();ji();Y2=t((i=Ti)=>[new ee(ye,"goodyHut",e=>i.getByTile(e))],"getAdditionalData"),EW=Y2});var N2={};var kW=n(()=>{Ut();SW();ne.register(...EW())});var YW=w(FW=>{"use strict";Object.defineProperty(FW,"__esModule",{value:!0});kW()});var W2,NW,WW=n(()=>{Ln();Rt();Kr();W2=t((i=Pt)=>[new ee(H,"government",e=>i.getByPlayer(e))],"getAdditionalData"),NW=W2});var L2={};var LW=n(()=>{WW();Ut();ne.register(...NW())});var zW=w(jW=>{"use strict";Object.defineProperty(jW,"__esModule",{value:!0});LW()});var j2,HW,_W=n(()=>{Ci();Rt();Kr();j2=t((i=oe)=>[new ee(H,"world",e=>i.getByPlayer(e))],"getAdditionalData"),HW=j2});var z2={};var KW=n(()=>{Ut();_W();ne.register(...HW())});var VW=w(qW=>{"use strict";Object.defineProperty(qW,"__esModule",{value:!0});KW()});var H2,JW,$W=n(()=>{ke();Rt();Kr();H2=t((i=W)=>[new ee(H,"research",e=>i.getByPlayer(e))],"getAdditionalData"),JW=H2});var _2={};var ZW=n(()=>{Ut();$W();ne.register(...JW())});var XW=w(QW=>{"use strict";Object.defineProperty(QW,"__esModule",{value:!0});ZW()});var K2,eL,tL=n(()=>{Dm();Rt();Kr();K2=t((i=Xo)=>[new ee(H,"spaceship",e=>i.getActiveByPlayer(e))],"getAdditionalData"),eL=K2});var q2={};var rL=n(()=>{Ut();tL();ne.register(...eL())});var oL=w(iL=>{"use strict";Object.defineProperty(iL,"__esModule",{value:!0});rL()});var V2,nL,aL=n(()=>{bn();Rt();jm();V2=t((i=bt)=>[new ee(fa,"features",e=>i.getByTerrain(e))],"getAdditionalData"),nL=V2});var J2={};var sL=n(()=>{Ut();aL();ne.register(...nL())});var mL=w(lL=>{"use strict";Object.defineProperty(lL,"__esModule",{value:!0});sL()});var $2,pL,cL=n(()=>{bi();Rt();ji();$2=t((i=_e)=>[new ee(ye,"improvements",e=>i.getByTile(e))],"getAdditionalData"),pL=$2});var Z2={};var uL=n(()=>{Ut();cL();ne.register(...pL())});var yL=w(fL=>{"use strict";Object.defineProperty(fL,"__esModule",{value:!0});uL()});var Q2,dL,gL=n(()=>{Fu();Rt();Kr();Q2=t((i=Kl)=>[new ee(H,"rates",e=>i.getByPlayer(e))],"getAdditionalData"),dL=Q2});var X2={};var hL=n(()=>{Ut();gL();ne.register(...dL())});var xL=w(OL=>{"use strict";Object.defineProperty(OL,"__esModule",{value:!0});hL()});var eq,RL,vL=n(()=>{B();Rt();Rc();vc();eq=t((i=f)=>[new ee(nl,"spendCost",e=>i.process(bo,e))],"getAdditionalData"),RL=eq});var tq,bL,CL=n(()=>{rm();Rt();Kr();tq=t((i=Hi)=>[new ee(H,"treasuries",e=>i.getByPlayer(e))],"getAdditionalData"),bL=tq});var rq={};var TL=n(()=>{Ut();vL();CL();ne.register(...RL(),...bL())});var IL=w(PL=>{"use strict";Object.defineProperty(PL,"__esModule",{value:!0});TL()});var oR,wL,AL=n(()=>{M();oR=class extends h{};t(oR,"End");wL=oR});var iq,BL,GL=n(()=>{X();B();at();AL();hT();tT();iq=t((i=f,e=P,r=$)=>[["engine:start",()=>{i.process(eR)}],...["game:start","turn:end"].map(o=>[o,()=>{e.emit("turn:start",r.increment())}]),["turn:end",()=>{i.process(wL,r)}],["turn:start",()=>{i.process(Tx,r)}]],"getEvents"),BL=iq});var oq={};var ML=n(()=>{X();GL();[...BL()].forEach(([i,e])=>{P.on(i,e)})});var DL=w(UL=>{"use strict";Object.defineProperty(UL,"__esModule",{value:!0});ML()});var nq,EL,SL=n(()=>{Ke();Rt();ya();Kr();ji();nq=t((i=j)=>[new ee(Xe,"units",e=>i.getByCity(e)),new ee(H,"units",e=>i.getByPlayer(e,!0)),new ee(ye,"units",e=>i.getByTile(e))],"getAdditionalData"),EL=nq});var aq={};var kL=n(()=>{Ut();SL();ne.register(...EL())});var YL=w(FL=>{"use strict";Object.defineProperty(FL,"__esModule",{value:!0});kL()});var sq,NL,WL=n(()=>{ts();Rt();Za();sq=t((i=Cr)=>[new ee(Fe,"improvements",e=>i.getByUnit(e))],"getAdditionalData"),NL=sq});var lq={};var LL=n(()=>{Ut();WL();ne.register(...NL())});var zL=w(jL=>{"use strict";Object.defineProperty(jL,"__esModule",{value:!0});LL()});var nR,HL,_L=n(()=>{Ro();rb();nR=class extends Qe{constructor(){super(Dg)}};t(nR,"AIClientRegistry");HL=new nR});var mq={};var KL=n(()=>{_L();Mp();HL.register(Sa)});var pq,qL,VL=n(()=>{ns();Ke();Zl();U();C();Mp();pq=t((i=j,e=Tr)=>[new Rr(new m((r,o)=>e.getByPlayer(o)instanceof Sa),new p((r,o,a)=>e.getByPlayer(o).cityLost(r,a,!1)))],"getRules"),qL=pq});var cq,JL,$L=n(()=>{ns();Ke();U();Ql();C();Mp();cq=t((i=j,e=Tr)=>[new zr(new m(r=>e.getByPlayer(r.player())instanceof Sa),new p((r,o)=>e.getByPlayer(r.player()).cityLost(r,o,!0)))],"getRules"),JL=cq});var uq,ZL,QL=n(()=>{ns();Ke();U();Ac();C();Mp();uq=t((i=j,e=Tr)=>[new dn(new m(r=>e.getByPlayer(r.player())instanceof Sa),new p((r,o)=>e.getByPlayer(r.player()).unitDestroyed(r,o&&o.player())))],"getRules"),ZL=uq});var fq={};var XL=n(()=>{B();VL();$L();QL();f.register(...qL(),...ZL(),...JL())});var tj=w(ej=>{"use strict";Object.defineProperty(ej,"__esModule",{value:!0});KL();XL()});var aR,rj,ij=n(()=>{cT();HO();xr();B();OT();uT();jC();aR=class extends sc{#e;#t;#r;#i;#o;#n;#a;#s;#l;#m;constructor(e=100,r=160,o={},a=f,s=iR,l=()=>Math.random()){super(e,r);let{landCoverage:c=.4,landSize:u=.2,maxIterations:y=10,clusterChance:O=.05,coverage:G=.25,pathChance:N=.05}=o;this.#e=c,this.#t=u,this.#r=y,this.#i=O,this.#o=G,this.#n=N,this.#l=a,this.#m=s,this.#s=l,this.#a=new Array(this.height()*this.width()).fill(0).map(()=>new Or)}async generateIslands(){let e=this.height(),r=this.width(),o=this.#t+this.#s()*.2,a=this.#e,s=this.#r,l=Math.ceil(e*r/100*o),c=new Array(e*r).fill(0);for(;c.length===0||c.filter(u=>u===1).length/c.length<a;){let u={},y=[],O=[],G=Math.floor(e*r*Math.random()),N=t(g=>{g in u||(u[g]=0),u[g]++},"flagAsSeen");for(c[G]=1,y.push(G),N(G),O.push(...Um(e,r,G));O.length;){let g=O.shift();if((u[g]||0)<=s&&(Math.random()>.3?(c[g]=1,y.push(g),Um(e,r,g).filter(x=>O.indexOf(x)===-1).forEach(x=>O.push(x))):Um(e,r,g).forEach(x=>{let d=O.indexOf(x);d>-1&&O.splice(d,1)}),N(g)),y.length>l||c.filter(x=>x===1).length/c.length>=a)break}if(c.filter(g=>g===1).length/c.length>=a)break}this.#a=c.map(u=>u===1?new J:new Or)}generate(){return this.generateIslands().then(()=>this.populateTerrain().then(()=>this.#a))}getNeighbours(e,r=!0){return Um(this.height(),this.width(),e,r)}populateTerrain(){return new Promise(e=>{let r=this.#l.get(rr);this.#l.get(Kx).filter(o=>o.validate()).map(o=>{let a=o.process();if(!a)throw new TypeError("Unexpected data from DistributionGroups.");return a}).forEach(o=>o.forEach(a=>r.filter(s=>s.validate(a,this.#a)).map(s=>{let l=s.process(a,this.#a);if(!l)throw new TypeError("Unexpected data from Distribution.");return l}).forEach(s=>s.forEach(({cluster:l=!1,clusterChance:c=this.#i,coverage:u=this.#o,fill:y=!1,from:O=0,path:G=!1,pathChance:N=this.#n,to:g=1})=>{let x=Object.keys(this.#a).map(T=>parseInt(T,10)).filter(T=>this.#a[T]instanceof a.__proto__).filter(T=>T>=O*this.height()*this.width()&&T<=g*this.height()*this.width());if(y){x.forEach(T=>{this.#a[T]=new a});return}let d=x.length*u;for(;d>0;){let T=x[Math.floor(this.#s()*x.length)];if(this.#a[T]=new a,d--,l){let D=this.getNeighbours(T).filter(q=>!(this.#a[q]instanceof a));for(;D.length&&d>0;){let q=D.shift();c>=this.#s()/this.distanceFrom(T,q)&&(this.#a[q]=new a,d--,D.push(...this.getNeighbours(q).filter(Ce=>!(this.#a[Ce]instanceof a)).filter(Ce=>this.#a[Ce]instanceof a.__proto__).filter(Ce=>!D.includes(Ce))))}}if(G){let D=T;for(;N>=this.#s();){let q=this.getNeighbours(D).filter(Ce=>this.#a[Ce]instanceof a.__proto__&&!(this.#a[Ce]instanceof a));D=q[Math.floor(this.#s()*q.length)],this.#a[D]=new a,d--}}}})))),e()})}};t(aR,"BaseGenerator");rj=aR});var yq={};var oj=n(()=>{ij();$x();yc.register(rj)});var aj=w(nj=>{"use strict";Object.defineProperty(nj,"__esModule",{value:!0});oj()});var dq={};var Yit,Nit,Wit,Lit,jit,zit,Hit,_it,Kit,qit,Vit,Jit,$it,Zit,Qit,Xit,eot,tot,rot,iot,oot,not,aot,sot,lot,mot,pot,cot,uot,fot,yot,dot,got,hot,Oot,xot,Rot,vot,bot,Cot,Tot,Pot,Iot,wot,Aot,Bot,Got,Mot,Uot,Dot,Eot,Sot,kot,Fot,Yot,Not,Wot,Lot,jot,zot,Hot,_ot,Kot,qot,Vot,Jot,$ot,Zot,Qot,Xot,ent,tnt,rnt,int,ont,nnt,ant,snt,lnt,mnt,pnt,cnt,unt,fnt,ynt,dnt,gnt,hnt,Ont,xnt,Rnt,vnt,bnt,Cnt,Tnt,Pnt,Int,wnt,Ant,Bnt,Gnt,Mnt,Unt,Dnt,Ent,Snt,knt,Fnt,Ynt,Nnt,Wnt,Lnt,jnt,znt,Hnt,_nt,Knt,qnt,sj=n(()=>{"use strict";Yit=A(sB()),Nit=A(cB()),Wit=A(dB()),Lit=A(xB()),jit=A(CB()),zit=A(wB()),Hit=A(MB()),_it=A(SB()),Kit=A(NB()),qit=A(zB()),Vit=A(qB()),Jit=A(ZB()),$it=A(tG()),Zit=A(nG()),Qit=A(lG()),Xit=A(cG()),eot=A(yG()),tot=A(hG()),rot=A(RG()),iot=A(CG()),oot=A(IG()),not=A(BG()),aot=A(UG()),sot=A(SG()),lot=A(YG()),mot=A(LG()),pot=A(HG()),cot=A(qG()),uot=A($G()),fot=A(XG()),yot=A(rM()),dot=A(nM()),got=A(lM()),hot=A(cM()),Oot=A(yM()),xot=A(hM()),Rot=A(RM()),vot=A(CM()),bot=A(IM()),Cot=A(BM()),Tot=A(UM()),Pot=A(SM()),Iot=A(YM()),wot=A(LM()),Aot=A(HM()),Bot=A(qM()),Got=A($M()),Mot=A(XM()),Uot=A(rU()),Dot=A(nU()),Eot=A(lU()),Sot=A(cU()),kot=A(yU()),Fot=A(hU()),Yot=A(RU()),Not=A(CU()),Wot=A(IU()),Lot=A(BU()),jot=A(UU()),zot=A(SU()),Hot=A(YU()),_ot=A(LU()),Kot=A(HU()),qot=A(qU()),Vot=A($U()),Jot=A(XU()),$ot=A(rD()),Zot=A(nD()),Qot=A(lD()),Xot=A(cD()),ent=A(yD()),tnt=A(hD()),rnt=A(RD()),int=A(CD()),ont=A(ID()),nnt=A(BD()),ant=A(UD()),snt=A(SD()),lnt=A(YD()),mnt=A(LD()),pnt=A(HD()),cnt=A(ME()),unt=A(QE()),fnt=A(b0()),ynt=A(CS()),dnt=A(GS()),gnt=A(_S()),hnt=A(ek()),Ont=A(nk()),xnt=A(bk()),Rnt=A(Ek()),vnt=A(gF()),bnt=A(FF()),Cnt=A(v1()),Tnt=A(F1()),Pnt=A($1()),Int=A(kY()),wnt=A(AN()),Ant=A(aW()),Bnt=A(fW()),Gnt=A(OW()),Mnt=A(CW()),Unt=A(AW()),Dnt=A(DW()),Ent=A(YW()),Snt=A(zW()),knt=A(VW()),Fnt=A(XW()),Ynt=A(oL()),Nnt=A(mL()),Wnt=A(yL()),Lnt=A(xL()),jnt=A(IL()),znt=A(DL()),Hnt=A(YL()),_nt=A(zL()),Knt=A(tj()),qnt=A(aj())});fR();AR();BR();$f();Zf();MR();Hr();UR();ya();sy();He();nr();YR();V();var dl,dy=class{constructor(){ae(this,dl,[])}add(e,r,o=null){I(this,dl).push({[e]:{type:"add",index:o,value:r}})}clear(){I(this,dl).splice(0)}remove(e,r=null){I(this,dl).push({[e]:{type:"remove",index:r}})}transferData(){return I(this,dl).slice(0).map(e=>{let r={};return Object.entries(e).forEach(([o,{type:a,index:s,value:l}])=>{r[o]={type:a,index:s,value:typeof l=="function"?l():l}}),r})}update(e,r,o=null){I(this,dl).push({[e]:{type:"update",index:o,value:r}})}};t(dy,"DataQueue"),dl=new WeakMap;var eP=dy;hy();NR();Ja();_R();ql();pm();Kr();Cv();Rd();var vd=class extends Error{constructor(e,r,o){super(e)}};t(vd,"RetryFailed");var yI=vd;var Uc,Dc,dp,Ec,gp,Sc,kc,bd=class{constructor(e,r=5,o=100){ae(this,Uc,0);ae(this,Dc,void 0);ae(this,dp,void 0);ae(this,Ec,void 0);ae(this,gp,void 0);ae(this,Sc,void 0);ae(this,kc,void 0);Ie(this,dp,e),Ie(this,Ec,r),Ie(this,gp,setInterval(()=>this.run(),o)),Ie(this,Dc,new Promise((a,s)=>{Ie(this,kc,a),Ie(this,Sc,s)}))}run(){if(++vT(this,Uc)._>I(this,Ec)){clearInterval(I(this,gp)),I(this,Sc).call(this,new yI("Retry failed.",I(this,dp),I(this,Uc)));return}I(this,dp).call(this)&&(clearInterval(I(this,gp)),I(this,kc).call(this))}then(){return I(this,Dc)}};t(bd,"Retryable"),Uc=new WeakMap,Dc=new WeakMap,dp=new WeakMap,Ec=new WeakMap,gp=new WeakMap,Sc=new WeakMap,kc=new WeakMap;var dI=bd;Pv();V();var Fc,Yc,Nc,Cd=class extends he{constructor(r,o,a){super();ae(this,Fc,void 0);ae(this,Yc,void 0);ae(this,Nc,void 0);Ie(this,Fc,r),Ie(this,Yc,o),Ie(this,Nc,a),this.addKey("player","turn","year")}player(){return I(this,Fc)}turn(){return I(this,Yc)}year(){return I(this,Nc)}};t(Cd,"TransferObject"),Fc=new WeakMap,Yc=new WeakMap,Nc=new WeakMap;var hI=Cd;ji();Za();V();Et();var Wc,Lc,jc,zc,Iv=class extends he{constructor(r,o,a,s){super();ae(this,Wc,void 0);ae(this,Lc,void 0);ae(this,jc,{size:0});ae(this,zc,void 0);Ie(this,Wc,r),Ie(this,Lc,a),I(this,jc).size=s,Ie(this,zc,o),this.addKey("_","growth","name","player","tile")}static fromCity(r){let o=ie.getByCity(r);return new Iv(r.name(),r.tile(),r.player(),o.size())}_(){return"City"}name(){return I(this,Wc)}player(){return I(this,Lc)}growth(){return I(this,jc)}tile(){return I(this,zc)}},Pd=Iv;t(Pd,"City"),Wc=new WeakMap,Lc=new WeakMap,jc=new WeakMap,zc=new WeakMap;var OI=Pd;V();var Hc,wv=class extends he{constructor(r){super();ae(this,Hc,void 0);Ie(this,Hc,r),this.addKey("_","civilization")}static fromPlayer(r){return new wv(r.civilization())}_(){return"Player"}civilization(){return I(this,Hc)}},Id=wv;t(Id,"Player"),Hc=new WeakMap;var xI=Id;V();var _c,Kc,qc,Av=class extends he{constructor(r,o,a){super();ae(this,_c,void 0);ae(this,Kc,void 0);ae(this,qc,void 0);Ie(this,_c,r),Ie(this,Kc,o),Ie(this,qc,a),this.addKey("_","tile","player")}static fromUnit(r){return new Av(r.constructor.name,r.tile(),r.player())}_(){return I(this,_c)}player(){return I(this,qc)}tile(){return I(this,Kc)}},wd=Av;t(wd,"Unit"),_c=new WeakMap,Kc=new WeakMap,qc=new WeakMap;var RI=wd;Se();E();et();ns();Op();X();as();Bl();ke();rm();Ci();B();at();Ke();Gv();Ml();fm();Dv();Jc();var DI=t(i=>i instanceof he?{"#ref":i.id()}:i,"referenceObject"),Je=t((...i)=>e=>i.some(r=>e instanceof r)?DI(e):e,"filterToReference"),UI=t((...i)=>e=>i.some(r=>e instanceof r)?e:DI(e),"filterToReferenceAllExcept"),vj=15,Sv=new Map,kv=new Map,Fv=new Map,be,le,ym,Qd,Xd,$c,Do,Zd=class extends cl{constructor(r,o,a,s){super(r);ae(this,be,t((r=o=>o)=>o=>o instanceof H&&o!==this.player()?(Sv.has(o)||Sv.set(o,xI.fromPlayer(o)),Sv.get(o)):o instanceof Fe&&o.player()!==this.player()?(kv.has(o)||kv.set(o,RI.fromUnit(o)),kv.get(o)):o instanceof Xe&&o.player()!==this.player()?(Fv.has(o)||Fv.set(o,OI.fromCity(o)),Fv.get(o)):o instanceof ye?oe.getByPlayer(this.player()).get(o.x(),o.y()):o instanceof Ee?{_:o.constructor.name}:r(o),"#dataFilter"));ae(this,le,new eP);ae(this,ym,void 0);ae(this,Qd,void 0);ae(this,Xd,void 0);ae(this,$c,!1);ae(this,Do,void 0);Ie(this,ym,new xy),Ie(this,Do,o),Ie(this,Xd,a),Ie(this,Qd,s),I(this,Do).receive("action",(...l)=>I(this,ym).emit("action",...l)),I(this,Do).receive("cheat",({name:l,value:c})=>{if(l==="RevealMap"){let u=oe.getByPlayer(this.player()),[y]=u.entries();y.tile().map().entries().forEach(O=>{if(u.includes(O))return;u.register(O);let G=u.getByTile(O);I(this,le).add(u.id(),()=>O.toPlainObject(I(this,be).call(this)),`entries[${u.entries().indexOf(G)}]`)})}if(l==="GrantAdvance"){let[u]=v.filter(O=>O.name===c),y=W.getByPlayer(this.player());if(!u||y.completed(u))return;y.addAdvance(u),I(this,le).add(y.id(),y.toPlainObject(I(this,be).call(this,Je(H))))}if(l==="GrantGold"){let u=Hi.getByPlayerAndType(this.player(),ze);u.add(c),I(this,le).add(u.id(),u.toPlainObject(I(this,be).call(this,Je(H))))}if(l==="ModifyUnit"){let{unitId:u,properties:y}=c,[O]=j.getBy("id",u);if(!O)return;["attack","defence","moves","movement","visibility"].forEach(G=>{G in y&&O[G]().set(y[G])}),I(this,le).add(O.id(),O.toPlainObject(I(this,be).call(this,Je(H))))}this.sendPatchData()}),P.on("engine:plugins:load:failed",(l,c)=>{console.log(l+" failed to load"),console.error(c)}),P.on("player:visibility-changed",(l,c)=>{if(c!==this.player())return;let u=oe.getByPlayer(this.player()),y=u.getByTile(l);if(y===null){new dI(()=>{let O=u.getByTile(l);return O===null?!1:(I(this,le).add(u.id(),()=>l.toPlainObject(I(this,be).call(this,Je(H))),`tiles[${u.entries().indexOf(O)}]`),!0)},2,20);return}I(this,le).add(u.id(),()=>y.toPlainObject(I(this,be).call(this,Je(H))),`tiles[${u.entries().indexOf(y)}]`)}),["unit:created","unit:defeated"].forEach(l=>{P.on(l,c=>{let u=oe.getByPlayer(this.player()),y=u.getByTile(c.tile());if(!!y&&(I(this,le).update(y.id(),()=>y.toPlainObject(I(this,be).call(this,Je(H)))),c.player()===this.player())){if(l==="unit:created"){let O=j.getByPlayer(this.player()),G=O.indexOf(c),N=j.getByCity(c.city()),g=N.indexOf(c),x=j.getByTile(c.tile()),d=x.indexOf(c);I(this,le).add(r.id(),()=>c.toPlainObject(I(this,be).call(this,Je(ye,H,fp,Xe))),`units[${G}]`),I(this,le).add(y.id(),()=>c.toPlainObject(I(this,be).call(this,Je(Fe))),`units[${d}]`),c.city()!==null&&I(this,le).add(c.city().id(),()=>c.toPlainObject(I(this,be).call(this,Je(Fe))),`units[${g}]`);return}I(this,le).update(this.player().id(),()=>this.player().toPlainObject(I(this,be).call(this,UI(H,Fe,de))))}})}),["unit:destroyed"].forEach(l=>{P.on(l,(c,u)=>{c.player()===this.player()&&c.city()!==null&&I(this,le).update(c.city().id(),()=>c.city().toPlainObject(I(this,be).call(this,Je(ga,om,z,H,fp,ye,Fe))))})}),["unit:moved"].forEach(l=>{P.on(l,(c,u)=>{let y=oe.getByPlayer(this.player()),O=y.getByTile(u.from()),G=y.getByTile(u.to());!O&&!G||(O&&I(this,le).update(O.id(),()=>O.toPlainObject(I(this,be).call(this,Je(H,Xe)))),G&&I(this,le).update(G.id(),()=>G.toPlainObject(I(this,be).call(this,Je(H,Xe)))),c.player()===this.player()&&c.city()!==null&&I(this,le).update(c.city().id(),()=>c.city().toPlainObject(I(this,be).call(this,Je(ga,om,z,H,fp,ye,Fe)))),this.sendPatchData())})}),["tile-improvement:built","tile-improvement:pillaged"].forEach(l=>{P.on(l,c=>{let u=oe.getByPlayer(this.player()),y=u.getByTile(c);y&&I(this,le).update(y.id(),()=>y.toPlainObject(I(this,be).call(this,Je(H,Xe))))})}),P.on("city:captured",(l,c,u)=>{if(u===this.player()){K.getByPlayer(this.player()).indexOf(l)!==-1&&I(this,le).update(this.player().id(),()=>this.player().toPlainObject(I(this,be).call(this,UI(H,de)))),this.sendNotification(`${c.civilization().name()} have captured our city ${l.name()}!`);return}if(c===this.player()){this.sendNotification(`We have captured ${l.name()} from ${u.civilization().name()}!`);return}}),["city:created","city:captured","city:destroyed","city:grow","city:shrink"].forEach(l=>{P.on(l,c=>{let u=oe.getByPlayer(this.player()),y=u.getByTile(c.tile());!y||I(this,le).update(y.id(),()=>y.toPlainObject(I(this,be).call(this,Je(H))))})}),P.on("city:shrink",l=>{l.player()===this.player()&&this.sendNotification(`Population decrease in ${l.name()}.`)}),P.on("city:unit-unsupported",(l,c)=>{l.player()===this.player()&&this.sendNotification(`${l.name()} cannot support ${c.constructor.name}.`)}),P.on("city:unsupported-improvement",(l,c)=>{l.player()===this.player()&&this.sendNotification(`${l.name()} cannot support ${c.constructor.name}.`)}),P.on("city:food-storage-exhausted",l=>{l.player()===this.player()&&this.sendNotification(`Food storage exhausted in ${l.name()}!`)}),P.on("city:building-complete",(l,c)=>{let u=oe.getByPlayer(this.player());if(l.city().player()!==this.player()&&c instanceof ve){this.sendNotification(`${u.getByTile(l.city().tile())?l.city().name():"A faraway city"} has completed work on ${c.constructor.name}!`);return}l.city().player()!==this.player()&&!(c instanceof ve)||(I(this,le).update(l.id(),()=>l.toPlainObject(I(this,be).call(this,Je(ye,Fe,H)))),this.sendNotification(`${l.city().name()} has completed work on ${c.constructor.name}!`))}),P.on("player:research-complete",(l,c)=>{l.player()===this.player()&&(I(this,le).update(l.id(),()=>l.toPlainObject(I(this,be).call(this,Je(H)))),this.sendNotification(`You have discovered the secrets of ${c.constructor.name}!`))}),P.on("goody-hut:action-performed",(l,c)=>{let u=l.tile();if(!!j.getByTile(u).some(O=>O.player()===this.player())){if(c instanceof tl){this.sendNotification("You have discovered scrolls of ancient wisdom...");return}if(c instanceof il){this.sendNotification("You have discovered an advanced tribe...");return}if(c instanceof sl){this.sendNotification("You have discovered valuable treasure...");return}if(c instanceof ll){this.sendNotification("You have discovered a friendly tribe of skilled mercenaries...");return}}}),P.on("player:defeated",(l,c)=>{l===this.player()&&(this.sendNotification("You have been defeated!"),Qi.unregister(...Qi.entries()),En.unregister(...En.entries()),I(this,Do).send("restart",null)),this.sendNotification(`${l.civilization().name()} defeated${c?` by ${c.civilization().name()}`:""}.`)}),P.on("city:civil-disorder",l=>{l.player()===this.player()&&this.sendNotification(`Civil disorder in ${l.name()}!`)}),P.on("city:order-restored",l=>{l.player()===this.player()&&this.sendNotification(`Order restored in ${l.name()}!`)}),P.on("city:leader-celebration",l=>{l.player()===this.player()&&this.sendNotification(`We love the leader celebrations in ${l.name()}!`)}),P.on("city:leader-celebration-ended",l=>{l.player()===this.player()&&this.sendNotification(`We love the leader celebrations cancelled in ${l.name()}!`)}),P.on("player:spaceship:part-built",l=>{this.player()!==l&&this.sendNotification(`Component added to ${l.civilization().name()} spaceship.`)}),P.on("player:spaceship:lost",l=>{this.player()===l&&this.sendNotification("Our spaceship was lost in space.")}),P.on("player:spaceship:landed",l=>{this.player()===l&&this.sendNotification("Our spaceship has landed on Alpha Centauri!")})}async chooseFromList(r){return new Promise(o=>{if(r.choices().length===1&&r.key()!=="negotiation.next-step"){let[a]=r.choices();o(a.value());return}I(this,Do).send("chooseFromList",r),I(this,Do).receiveOnce("chooseFromList",a=>{let[s]=r.choices().filter(l=>l.id()===a);if(!s){console.warn(`No choice found for '${a}' against '${r.id()}'.`);return}o(s.value())})})}async handleAction(...r){let[o]=r,a=this.player(),s=a.actions(),l=s.filter(O=>O instanceof Wi),{name:c,id:u}=o;if(c==="ReassignWorkers"){let[O]=K.getBy("id",o.city);return O&&(kd(O),I(this,le).update(O.id(),O.toPlainObject(I(this,be).call(this,Je(H,ye))))),!1}if(c==="EndTurn")return l.length===1&&l.every(O=>O instanceof nm);if(!c)return console.log("action not specified: ",o),!1;let[y]=s.filter(O=>O.constructor.name===c&&u===(O.value()?O.value().id():void 0));if(!y)return console.log("action not specified"),!1;if(y instanceof ln){let{unitAction:O,target:G}=o,N=y.value(),x=[...N.actions(),...Object.values(N.actionsForNeighbours())].flat().filter(T=>T.constructor.name===O);for(;x.length!==1;){if(x.length===0)return console.log(`action not found: ${O}`),!1;let[T]=oe.getByPlayer(this.player()).filter(D=>D.id()===G);if(!T)return console.log(`tile not found: ${G}`),!1;if(x=x.filter(D=>D.to()===T.tile()),x.length>1&&!G)return console.log(`too many actions found: ${O} (${x.length})`),!1}let[d]=x;return d.perform(),d instanceof mt&&await this.canNegotiate(N),!1}if(y instanceof mn){let O=y.value();return O.moves().value()>0&&I(this,le).update(O.id(),O.toPlainObject(I(this,be).call(this,Je(H,ye)))),O.activate(),!1}if(y instanceof ga||y instanceof ml){let O=y.value(),{chosen:G}=o;if(!G)return console.log("no build item specified"),!1;let[N]=O.available().filter(g=>g.item().name===G);return N?(O.build(N.item()),!1):(console.log(`build item not available: ${G}`),!1)}if(y instanceof ZT){let O=y.value(),{chosen:G}=o;if(!G)return this.sendNotification("no build item specified"),!1;let[N]=O.available().filter(g=>g.name===G);return N?(O.research(N),!1):(console.log(`build item not available: ${G}`),!1)}if(y instanceof yl){let O=y.value(),G=Hi.getByPlayerAndType(this.player(),ze);return G.buy(O.city()),I(this,le).update(G.id(),G.toPlainObject(I(this,be).call(this,Je(H)))),!1}if(y instanceof Al){let O=y.value(),{chosen:G}=o,[N]=O.available().filter(x=>x.name===G);if(!N)return console.error(`Government type: '${G}' not found.`),!1;O.set(new N);let g=oe.getByPlayer(this.player());return I(this,le).update(g.id(),g.toPlainObject(I(this,be).call(this,Je(H)))),K.getByPlayer(this.player()).forEach(x=>I(this,le).update(x.id(),x.toPlainObject(I(this,be).call(this,Je(H,ye,Fe))))),!1}if(y instanceof ul){let O=y.value(),{value:G}=o;return O.setAll(G.map(([N,g])=>{let[x]=O.all().filter(d=>d.constructor.name===N);return[x.constructor,g]})),K.getByPlayer(this.player()).forEach(N=>I(this,le).update(N.id(),N.toPlainObject(I(this,be).call(this,Je(H,ye,Fe))))),!1}return y instanceof sm?(y.value().launch(),!1):(console.log(`unhandled action: ${JSON.stringify(o)}`),!1)}sendInitialData(){I(this,Do).send("gameData",new hI(this.player(),$,Rp)),Ie(this,$c,!0)}sendPatchData(){I(this,Do).send("gameDataPatch",I(this,le).transferData()),I(this,le).clear()}sendNotification(r){I(this,Do).send("gameNotification",{message:r})}takeTurn(){return new Promise((r,o)=>{I(this,$c)||this.sendInitialData(),setTimeout(()=>{I(this,le).update($.id(),()=>$.toPlainObject()),I(this,le).update(Rp.id(),()=>Rp.toPlainObject()),I(this,le).add(this.player().id(),()=>this.player().toPlainObject(I(this,be).call(this,Je(ye)))),this.sendPatchData()},1);let a=t(async(...s)=>{try{if(await this.handleAction(...s)){I(this,ym).off("action",a),this.sendPatchData(),setTimeout(()=>r(),100);return}I(this,le).update(this.player().id(),()=>this.player().toPlainObject(I(this,be).call(this,Je(yp,ye,Xe)))),this.sendPatchData()}catch(l){o(l)}},"listener");I(this,ym).on("action",a)})}async canNegotiate(r){let o=Array.from(new Set(r.tile().getNeighbours().flatMap(a=>j.getByTile(a).map(s=>s.player()).filter(s=>s!==this.player()))));o.length!==0&&await o.filter(a=>sr.getByPlayer(a).filter(s=>s instanceof Cp&&s.isBetween(a,this.player())).every(s=>$.value()-s.when()>vj)).reduce((a,s)=>a.then(()=>this.handleNegotiation(s)),Promise.resolve())}async handleNegotiation(r){let o=new Cp(r,this.player(),f);for(o.proceed(new Uo(r,o,f));!o.terminated();){let a=o.lastInteraction();if(await(a!==null?a.for():o.players().slice(1)).reduce((l,c)=>l.then(async()=>{let y=await Tr.getByPlayer(c).chooseFromList(new pl(o.nextSteps(),"negotiation.next-step",o));o.proceed(y),y instanceof Mo&&y.proposal().resolve(y)}),Promise.resolve()),o.terminated())break}return sr.register(o),o}};t(Zd,"DataTransferClient"),be=new WeakMap,le=new WeakMap,ym=new WeakMap,Qd=new WeakMap,Xd=new WeakMap,$c=new WeakMap,Do=new WeakMap;var EI=Zd;Kr();Mp();ns();X();Bl();var Ht,sR=class{constructor(e){ae(this,Ht,void 0);Ie(this,Ht,e),e.receive("start",()=>{this.bindEvents(),this.start()}),e.receive("setOption",({name:r,value:o})=>{I(this,Ht).send("notification",`setting ${r} to ${o}`),P.setOption(r,o)}),e.receive("getOptions",r=>e.send("getOptions",r.reduce((o,a)=>(o[a]=P.option(a),o),{}))),e.receive("setOptions",r=>{Object.entries(r).forEach(([o,a])=>P.setOption(o,a)),e.send("setOptions",null)})}bindEvents(){I(this,Ht).send("notification","binding events"),P.on("engine:initialise",()=>I(this,Ht).send("notification","initialising...")),P.on("engine:plugins:load:success",e=>I(this,Ht).send("notification",`loaded plugin: ${e}`)),P.on("engine:plugins-loaded",()=>I(this,Ht).send("notification","plugins loaded")),P.on("engine:start",()=>I(this,Ht).send("notification","starting...")),P.on("world:generate-start-tiles",()=>I(this,Ht).send("notification","generating start tiles...")),P.on("world:built",()=>I(this,Ht).send("notification","world built")),P.on("game:start",()=>I(this,Ht).send("notification","game start")),P.on("turn:start",e=>I(this,Ht).send("notification",`turn start ${e}`)),P.on("player:turn-start",e=>I(this,Ht).send("notification",`player turn-start: ${e.civilization().constructor.name}`))}start(){P.on("engine:start",()=>{new Array(parseInt(P.option("players"),10)).fill(0).forEach((e,r)=>{let o=new H,a=r===0?new EI(o,I(this,Ht),(s,l)=>I(this,Ht).send(s,l),(s,l)=>I(this,Ht).receive(s,l)):new Sa(o);Qi.register(o),Tr.register(a),I(this,Ht).send("notification","generating world...")})}),P.start(),Promise.resolve().then(()=>(sj(),dq)).then(()=>P.emit("plugins:load:end"))}};t(sR,"Game"),Ht=new WeakMap;var lj=sR;var lR=class{async request(e){return new Promise(r=>{this.send(e.channel(),e.args()[0]),this.receiveOnce(e.channel(),o=>r(o))})}};t(lR,"AbstractTransport");var mj=lR;V();var mR=class extends mj{receive(e,r){addEventListener("message",({data:{channel:o,data:a}})=>{e===o&&r(a)})}receiveOnce(e,r){let o=t(({data:{channel:a,data:s}})=>{e===a&&(r(s),removeEventListener("message",o))},"fullHandler");addEventListener("message",o)}send(e,r){r instanceof he&&(r=r.toPlainObject()),postMessage({channel:e,data:r})}};t(mR,"ParentTransport");var pj=mR;var sat=new lj(new pj);})();
//# sourceMappingURL=backend.js.map
