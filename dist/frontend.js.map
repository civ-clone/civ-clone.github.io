{
  "version": 3,
  "sources": ["../node_modules/@dom111/typed-event-emitter/EventEmitter.js", "../src/js/UI/lib/html.ts", "../src/js/UI/lib/reconstituteData.ts", "../src/js/UI/components/Element.ts", "../src/js/UI/components/Actions/Action.ts", "../src/js/UI/components/LockedSlider.ts", "../src/js/UI/components/LockedSliderGroup.ts", "../src/js/UI/components/TransientElement.ts", "../src/js/UI/components/Window.ts", "../node_modules/idb/build/wrap-idb-value.js", "../node_modules/idb/build/index.js", "../src/js/UI/Store.ts", "../src/js/UI/lib/scaleImage.ts", "../src/js/UI/AssetStore.ts", "../src/js/UI/components/Actions/AdjustTradeRates.ts", "../src/js/UI/components/NotificationWindow.ts", "../src/js/UI/components/SelectionWindow.ts", "../src/js/UI/components/Actions/ChooseResearch.ts", "../src/js/UI/lib/yieldMap.ts", "../src/js/UI/lib/getPreloadedImage.ts", "../src/js/UI/lib/replaceColours.ts", "../src/js/UI/components/Map.ts", "../src/js/UI/components/Map/Cities.ts", "../src/js/UI/components/ConfirmationWindow.ts", "../src/js/UI/DataObserver.ts", "../src/js/UI/components/Map/TerrainAbstract.ts", "../src/js/UI/components/Map/Feature.ts", "../src/js/UI/components/Map/Fog.ts", "../src/js/UI/components/Map/Improvements.ts", "../src/js/UI/components/InactiveUnitSelectionWindow.ts", "../src/js/UI/components/Map/Irrigation.ts", "../src/js/UI/components/Map/Land.ts", "../src/js/UI/components/Portal.ts", "../src/js/UI/components/Map/Terrain.ts", "../src/js/UI/components/World.ts", "../src/js/UI/components/Map/Yields.ts", "../src/js/UI/lib/renderUnit.ts", "../src/js/UI/components/Unit.ts", "../src/js/UI/components/City.ts", "../src/js/UI/components/CityBuildSelectionWindow.ts", "../src/js/UI/components/Actions/CityBuild.ts", "../src/js/UI/components/Actions/EndTurn.ts", "../src/js/UI/components/Actions/Revolution.ts", "../src/js/UI/components/Actions.ts", "../src/js/UI/components/Map/Units.ts", "../src/js/UI/components/Map/ActiveUnit.ts", "../src/js/UI/components/Map/CityNames.ts", "../src/js/UI/components/GameDetails.ts", "../src/js/UI/components/GamePortal.ts", "../src/js/UI/components/Map/GoodyHuts.ts", "../src/js/UI/lib/IntervalHandler.ts", "../src/js/Engine/Request.ts", "../src/js/Engine/Requests/Options.ts", "../src/js/UI/components/CustomiseWorldWindow.ts", "../node_modules/@civ-clone/civ1-asset-extractor/BinFile.ts", "../node_modules/@civ-clone/civ1-asset-extractor/LZWDictionary.ts", "../node_modules/@civ-clone/civ1-asset-extractor/LZW.ts", "../node_modules/@civ-clone/civ1-asset-extractor/lib/lowerNibble.ts", "../node_modules/@civ-clone/civ1-asset-extractor/lib/upperNibble.ts", "../node_modules/@civ-clone/civ1-asset-extractor/PicImage.ts", "../node_modules/@civ-clone/civ1-asset-extractor/extractSprites.ts", "../src/js/UI/components/ImportAssetsWindow.ts", "../src/js/UI/components/MandatorySelection.ts", "../src/js/UI/components/NewGameWindow.ts", "../src/js/UI/components/EarthWindow.ts", "../src/js/UI/components/MainMenu.ts", "../src/js/UI/components/Minimap.ts", "../src/js/UI/components/Notifications.ts", "../src/js/UI/components/PlayerDetails.ts", "../src/js/UI/components/UnitDetails.ts", "../src/js/UI/Renderer.ts", "../src/js/Engine/AbstractTransport.ts", "../src/js/Engine/WorkerTransport.ts", "../src/js/frontend.ts"],
  "sourcesContent": ["\"use strict\";var t,e=this&&this.__classPrivateFieldGet||function(t,e,i,s){if(\"a\"===i&&!s)throw new TypeError(\"Private accessor was defined without a getter\");if(\"function\"==typeof e?t!==e||!s:!e.has(t))throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");return\"m\"===i?s:\"a\"===i?s.call(t):s?s.value:e.get(t)};Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.EventEmitter=void 0;class i{constructor(){t.set(this,{})}on(i,s){i in e(this,t,\"f\")||(e(this,t,\"f\")[i]=[]),e(this,t,\"f\")[i].push(s)}once(t,e){const i=(...s)=>{e(...s),this.off(t,i)};this.on(t,i)}off(i,s){if(!(i in e(this,t,\"f\")))return;const r=e(this,t,\"f\")[i].indexOf(s);-1!==r&&e(this,t,\"f\")[i].splice(r,1)}emit(i,...s){i in e(this,t,\"f\")&&e(this,t,\"f\")[i].forEach((t=>t(...s)))}}exports.EventEmitter=i,t=new WeakMap,exports.default=i;", "export const parseSelector = (\n  selector: string\n): [\n  string,\n  string[],\n  {\n    [key: string]: string;\n  }\n] => {\n  const classes: string[] = [],\n    attributes: {\n      [key: string]: string;\n    } = {},\n    strings: string[] = [];\n\n  let element = 'div';\n\n  const parts = selector\n    .replace(\n      /(?!<\\\\)([\"']).+?(?!<\\\\)(\\1)/g,\n      (string) => 'string$' + (strings.push(string.slice(1, -1)) - 1)\n    )\n    .split(/(?=[.#[])/);\n\n  parts.forEach((part) => {\n    if (!part.match(/^[.#\\[]/)) {\n      element = part;\n\n      return;\n    }\n\n    if (part[0] === '.') {\n      classes.push(part.slice(1));\n\n      return;\n    }\n\n    if (part[0] === '#') {\n      attributes.id = part[0].slice(1);\n\n      return;\n    }\n\n    if (part[0] === '[') {\n      const match = part.match(/\\[([^=]+)(=([\"']?)(.+?)\\3)?]/);\n\n      if (match !== null) {\n        attributes[match[1]] = (match[4] ?? '').replace(\n          /string\\$(\\d+)/,\n          (match, id) => strings[id]\n        );\n      }\n\n      return;\n    }\n  });\n\n  return [element, classes, attributes];\n};\n\nexport const t = (string: string): Text => document.createTextNode(string);\n\nexport const e = <Element extends HTMLElement = HTMLElement>(\n  selector: string,\n  ...nodes: Node[]\n): Element => {\n  const [element, classes, attributes] = parseSelector(selector),\n    e = document.createElement(element);\n\n  if (classes.length) {\n    e.classList.add(...classes);\n  }\n\n  a(e, attributes);\n\n  if (nodes.length) {\n    e.append(...nodes);\n  }\n\n  return e as Element;\n};\n\nexport const s = (html: string, ...nodes: Node[]): Node => {\n  const temp = document.createElement('div');\n\n  temp.innerHTML = html;\n\n  if (temp.childNodes.length !== 1) {\n    throw new TypeError('Invalid `html` provided.');\n  }\n\n  temp.firstElementChild!.append(...nodes);\n\n  return temp.firstElementChild!;\n};\n\nexport const a = (\n  element: HTMLElement,\n  attributes: { [key: string]: string }\n) => {\n  Object.entries(attributes).forEach(([name, value]) =>\n    element.setAttribute(name, value)\n  );\n\n  return element;\n};\n\nexport const h = <T extends HTMLElement>(\n  element: T,\n  handlers: { [key: string]: (event: any) => void }\n): T => {\n  Object.entries(handlers).forEach(([eventName, handler]): void =>\n    element.addEventListener(eventName, handler)\n  );\n\n  return element;\n};\n", "export type PlainObject = {\n  [key: string]: any;\n};\n\nexport type ObjectStore = {\n  [key: string]: PlainObject;\n};\n\nexport type ObjectMap = {\n  hierarchy: PlainObject;\n  objects: ObjectStore;\n};\n\nexport const reconstituteData = (\n  { hierarchy, objects }: ObjectMap,\n  orphanIds: string[] | null = null\n): PlainObject => {\n  const seenObjects: Map<PlainObject, PlainObject> = new Map();\n\n  if (orphanIds) {\n    Object.keys(objects).forEach((id) => orphanIds.push(id));\n  }\n\n  const getReferences = (value: any): PlainObject => {\n    if (seenObjects.has(value)) {\n      return seenObjects.get(value)!;\n    }\n\n    if (Array.isArray(value)) {\n      const updated: any[] = [];\n\n      seenObjects.set(value, updated);\n\n      value.forEach((value) => updated.push(getReferences(value)));\n\n      return updated;\n    }\n\n    if (value && value['#ref']) {\n      if (orphanIds) {\n        orphanIds.splice(orphanIds.indexOf(value['#ref']), 1);\n      }\n\n      if (!(value['#ref'] in objects)) {\n        throw new TypeError(`missing ${value['#ref']}`);\n      }\n\n      const updated = getReferences(objects[value['#ref']]);\n\n      seenObjects.set(value, updated);\n\n      return updated;\n    }\n\n    if (value instanceof Object) {\n      const updated: PlainObject = {};\n\n      seenObjects.set(value, updated);\n\n      Object.entries(value).forEach(([key, childValue]) => {\n        updated[key] = getReferences(childValue);\n      });\n\n      return updated;\n    }\n\n    return value;\n  };\n\n  return getReferences(hierarchy);\n};\n\nexport default reconstituteData;\n", "import { e } from '../lib/html';\n\nexport interface IElement {\n  build(...args: any[]): void;\n  element(): HTMLElement;\n}\n\nexport class Element implements IElement {\n  #element: HTMLElement;\n\n  constructor(element: HTMLElement = e('div')) {\n    this.#element = element;\n  }\n\n  build(...args: any[]): void {}\n\n  element(): HTMLElement {\n    return this.#element;\n  }\n\n  protected empty(): void {\n    while (this.#element.firstChild !== null) {\n      this.#element.firstChild.remove();\n    }\n  }\n}\n\nexport default Element;\n", "import {\n  CityBuild,\n  PlayerAction,\n  PlayerGovernment,\n  PlayerResearch,\n  PlayerTradeRates,\n  Unit,\n} from '../../types';\nimport { e } from '../../lib/html';\nimport Transport from '../../../Engine/Transport';\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    actioned: CustomEvent<Action>;\n  }\n}\n\nexport interface IAction {\n  activate(): void;\n  build(): void;\n  complete(): void;\n  element(): HTMLElement;\n  value():\n    | CityBuild\n    | PlayerResearch\n    | Unit\n    | PlayerGovernment\n    | PlayerTradeRates;\n}\n\nexport class Action implements IAction {\n  #action: PlayerAction;\n  #element: HTMLElement;\n  #transport: Transport;\n\n  constructor(action: PlayerAction, transport: Transport) {\n    this.#action = action;\n    this.#transport = transport;\n    this.#element = e('div.action');\n\n    this.#element.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape') {\n        return;\n      }\n\n      event.stopPropagation();\n    });\n\n    this.build();\n  }\n\n  public activate(): void {}\n\n  build(): void {}\n\n  complete(): void {\n    const event = new CustomEvent('actioned', {\n      bubbles: true,\n      detail: this,\n    });\n\n    this.#element.dispatchEvent(event);\n  }\n\n  element(): HTMLElement {\n    return this.#element;\n  }\n\n  transport(): Transport {\n    return this.#transport;\n  }\n\n  value():\n    | CityBuild\n    | PlayerResearch\n    | Unit\n    | PlayerGovernment\n    | PlayerTradeRates {\n    return this.#action.value;\n  }\n}\n\nexport default Action;\n", "import Element from './Element';\nimport { e, t } from '../lib/html';\n\nconst template: (label: string, value: number) => HTMLFieldSetElement = (\n  label: string,\n  value: number\n) =>\n  e(\n    'fieldset',\n    e('legend', t(label)),\n    e(`input[type=\"range\"][max=\"100\"][min=\"0\"][step=\"1\"][value=\"${value}\"]`),\n    e('input[type=\"number\"]'),\n    e('label', e('input[type=\"checkbox\"]'), t('Lock'))\n  ) as HTMLFieldSetElement;\n\nexport type onInputHandler = () => void;\n\nexport class LockedSlider extends Element {\n  #label: string;\n  #range: HTMLInputElement;\n  #number: HTMLInputElement;\n  #lock: HTMLInputElement;\n  #listeners: onInputHandler[] = [];\n\n  constructor(label: string, currentValue: number) {\n    super(template(label, currentValue));\n\n    this.#label = label;\n    this.#range = this.element().querySelector(\n      'input[type=\"range\"]'\n    ) as HTMLInputElement;\n    this.#number = this.element().querySelector(\n      'input[type=\"number\"]'\n    ) as HTMLInputElement;\n    this.#lock = this.element().querySelector(\n      'input[type=\"checkbox\"]'\n    ) as HTMLInputElement;\n\n    this.build();\n  }\n\n  build(): void {\n    this.set(this.#range.value);\n\n    this.#range.addEventListener('input', () => this.set(this.#range.value));\n\n    this.#number.addEventListener('input', () => this.set(this.#number.value));\n\n    this.#lock.addEventListener('input', () => this.lock());\n\n    this.lock();\n  }\n\n  label(): string {\n    return this.#label;\n  }\n\n  private lock(): void {\n    if (this.isLocked()) {\n      this.#range.setAttribute('disabled', '');\n      this.#number.setAttribute('disabled', '');\n\n      return;\n    }\n\n    this.#range.removeAttribute('disabled');\n    this.#number.removeAttribute('disabled');\n  }\n\n  onInput(handler: onInputHandler): void {\n    this.#listeners.push(handler);\n  }\n\n  isLocked(): boolean {\n    return this.#lock.checked;\n  }\n\n  set(value: string): void {\n    value = Math.max(parseInt(value, 10), 0).toString();\n\n    if (this.#range.value !== value) {\n      this.#range.value = value;\n    }\n\n    if (this.#number.value !== value) {\n      this.#number.value = value;\n    }\n\n    this.#listeners.forEach((listener) => listener());\n  }\n\n  value(): number {\n    return parseInt(this.#range.value, 10);\n  }\n}\n\nexport default LockedSlider;\n", "import LockedSlider from './LockedSlider';\n\nexport class LockedSliderGroup {\n  #sliders;\n\n  constructor(...sliders: LockedSlider[]) {\n    this.#sliders = sliders;\n\n    this.#sliders.forEach((slider) =>\n      slider.onInput(() => {\n        if (this.total() === 100) {\n          return;\n        }\n\n        const otherSliders = this.#sliders.filter(\n            (otherSlider) => otherSlider !== slider\n          ),\n          otherActiveSliders = otherSliders.filter(\n            (slider) => !slider.isLocked()\n          );\n\n        if (this.total() !== 100 && otherActiveSliders.length === 0) {\n          slider.set((100 - this.total(otherSliders)).toString());\n\n          return;\n        }\n\n        if (this.total() > 100) {\n          let overage = this.total() - 100,\n            chunk = Math.ceil(overage / otherActiveSliders.length);\n\n          otherActiveSliders.forEach((otherSlider) => {\n            otherSlider.set(\n              (otherSlider.value() - Math.min(chunk, overage)).toString()\n            );\n\n            overage -= chunk;\n          });\n\n          if (this.total() > 100) {\n            slider.set((100 - this.total(otherSliders)).toString());\n          }\n        }\n\n        if (this.total() < 100) {\n          let remaining = 100 - this.total(),\n            chunk = Math.ceil(remaining / otherActiveSliders.length);\n\n          otherActiveSliders.forEach((otherSlider) => {\n            otherSlider.set(\n              (otherSlider.value() + Math.min(chunk, remaining)).toString()\n            );\n\n            remaining -= chunk;\n          });\n\n          if (this.total() < 100) {\n            slider.set((100 - this.total(otherSliders)).toString());\n          }\n        }\n      })\n    );\n  }\n\n  sliders(): LockedSlider[] {\n    return this.#sliders;\n  }\n\n  private total(sliders = this.#sliders): number {\n    return sliders.reduce((total, slider) => total + slider.value(), 0);\n  }\n}\n\nexport default LockedSliderGroup;\n", "import { e } from '../lib/html';\nimport { Element, IElement } from './Element';\n\nexport interface ITransientElement extends IElement {\n  display(): void;\n  parent(): HTMLElement;\n}\n\nexport class TransientElement extends Element implements ITransientElement {\n  #parent: HTMLElement;\n\n  constructor(parent: HTMLElement, element: HTMLElement = e('div')) {\n    super(element);\n\n    // capture keys in the notification window\n    this.element().addEventListener('keydown', (event: KeyboardEvent) => {\n      event.stopPropagation();\n    });\n\n    this.element().setAttribute('tabindex', '0');\n\n    this.#parent = parent;\n  }\n\n  public display(): void {\n    this.build();\n\n    this.#parent.append(this.element());\n  }\n\n  public parent(): HTMLElement {\n    return this.#parent;\n  }\n}\n\nexport default TransientElement;\n", "import { e, h, t } from '../lib/html';\nimport TransientElement, { ITransientElement } from './TransientElement';\n\nexport interface IWindow extends ITransientElement {\n  close(): void;\n  maximise(): void;\n}\n\ntype WindowSize = {\n  height: number | string;\n  width: number | string;\n};\n\ntype WindowPosition = {\n  x: number;\n  y: number;\n};\n\nexport type WindowSettings = {\n  autoDisplay: boolean;\n  canClose: boolean;\n  canMaximise: boolean;\n  canResize: boolean;\n  parent: HTMLElement;\n  position: WindowPosition | 'auto';\n  size: WindowSize | 'auto' | 'maximised';\n};\n\nexport type WindowOptions = { [K in keyof WindowSettings]?: WindowSettings[K] };\n\nconst defaultOptions: WindowSettings = {\n  autoDisplay: true,\n  canClose: true,\n  canMaximise: false,\n  canResize: false,\n  parent: document.body,\n  position: 'auto',\n  size: 'auto',\n};\n\nexport class Window extends TransientElement implements IWindow {\n  private options: WindowSettings;\n  #body: string | Node;\n  #title: string;\n\n  constructor(title: string, body: string | Node, options: WindowOptions = {}) {\n    super(options.parent ?? defaultOptions.parent, e('div.window'));\n\n    this.options = {\n      ...defaultOptions,\n      ...options,\n    };\n\n    this.#body = body;\n    this.#title = title;\n\n    if (this.options.size === 'auto') {\n      this.element().classList.add('size-auto');\n    }\n\n    if (this.options.size === 'maximised') {\n      this.element().classList.add('maximised');\n    }\n\n    if (this.options.size !== 'auto') {\n      (['height', 'width'] as ('height' | 'width')[]).forEach((dimension) => {\n        const value = (this.options.size as WindowSize)[dimension];\n\n        if (typeof value === 'number') {\n          this.element().style[dimension] = value + 'px';\n\n          return;\n        }\n\n        this.element().style[dimension] = value;\n      });\n    }\n\n    if (this.options.position === 'auto') {\n      this.element().classList.add('position-auto');\n    }\n\n    if (this.options.position !== 'auto') {\n      (\n        [\n          ['x', 'left'],\n          ['y', 'top'],\n        ] as ['x' | 'y', 'left' | 'top'][]\n      ).forEach(([axis, property]) => {\n        this.element().style[property] =\n          Math.min(\n            0,\n            Math.max(\n              document.body.clientHeight - 20,\n              (this.options.position as WindowPosition)[axis]\n            )\n          ) + 'px';\n      });\n    }\n\n    if (this.options.autoDisplay) {\n      this.display();\n\n      return;\n    }\n\n    this.build();\n  }\n\n  public build(): void {\n    this.empty();\n\n    const headerActions: HTMLElement[] = (\n      [\n        [\n          this.options.canMaximise,\n          h(\n            e(\n              'button.maximise[aria-label=\"Maximise\"]',\n              t('Maximise'),\n              e(\n                'img.maximise[src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItbWF4aW1pemUiPjxwYXRoIGQ9Ik04IDNINWEyIDIgMCAwIDAtMiAydjNtMTggMFY1YTIgMiAwIDAgMC0yLTJoLTNtMCAxOGgzYTIgMiAwIDAgMCAyLTJ2LTNNMyAxNnYzYTIgMiAwIDAgMCAyIDJoMyI+PC9wYXRoPjwvc3ZnPg==\"][alt=\"Maximise\"]'\n              ),\n              e(\n                'img.restore[src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItbWluaW1pemUiPjxwYXRoIGQ9Ik04IDN2M2EyIDIgMCAwIDEtMiAySDNtMTggMGgtM2EyIDIgMCAwIDEtMi0yVjNtMCAxOHYtM2EyIDIgMCAwIDEgMi0yaDNNMyAxNmgzYTIgMiAwIDAgMSAyIDJ2MyI+PC9wYXRoPjwvc3ZnPg==\"][alt=\"Restore\"]'\n              )\n            ),\n            {\n              click: () => this.maximise(),\n            }\n          ),\n        ],\n        [\n          this.options.canClose,\n          h(\n            e(\n              'button.close[aria-label=\"Close\"]',\n              t('Close'),\n              e(\n                'img[src=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXIteCI+PGxpbmUgeDE9IjE4IiB5MT0iNiIgeDI9IjYiIHkyPSIxOCI+PC9saW5lPjxsaW5lIHgxPSI2IiB5MT0iNiIgeDI9IjE4IiB5Mj0iMTgiPjwvbGluZT48L3N2Zz4=\"][alt=\"Close\"]'\n              )\n            ),\n            {\n              click: () => this.close(),\n            }\n          ),\n        ],\n      ] as [boolean, HTMLElement][]\n    )\n      .filter(([show]: [boolean, HTMLElement]) => show)\n      .map(([, element]) => element);\n\n    let isDragging = false;\n\n    this.element().append(\n      h(e('header', e('h3', t(this.#title)), ...headerActions), {\n        dblclick: () => this.maximise(),\n        mousedown: (event) => {\n          if (event.target.matches('button, button img')) {\n            return;\n          }\n\n          isDragging = true;\n\n          const moveHandler = (event: MouseEvent) => {\n            if (!isDragging) {\n              return;\n            }\n\n            const elementComputedStyle = getComputedStyle(this.element()),\n              currentTop = parseInt(\n                elementComputedStyle.getPropertyValue('top'),\n                10\n              ),\n              currentLeft = parseInt(\n                elementComputedStyle.getPropertyValue('left'),\n                10\n              );\n\n            this.element().style.setProperty(\n              'top',\n              currentTop + event.movementY + 'px'\n            );\n            this.element().style.setProperty(\n              'left',\n              currentLeft + event.movementX + 'px'\n            );\n          };\n\n          document.addEventListener('mousemove', moveHandler);\n\n          document.addEventListener(\n            'mouseup',\n            () => {\n              document.removeEventListener('mousemove', moveHandler);\n\n              isDragging = false;\n            },\n            {\n              once: true,\n            }\n          );\n        },\n      }),\n      e(\n        'div.body',\n        this.#body instanceof Node ? this.#body : e('p', t(this.#body))\n      )\n    );\n\n    this.element().addEventListener('keydown', (event: KeyboardEvent) => {\n      if (event.key === 'Escape' && this.options.canClose) {\n        this.close();\n      }\n\n      // Capture all keypresses whilst this is focused\n      event.stopPropagation();\n    });\n  }\n\n  public close(): void {\n    this.element().remove();\n\n    this.element().dispatchEvent(new CustomEvent('close'));\n  }\n\n  public display(focus = true): void {\n    super.display();\n\n    if (!focus) {\n      return;\n    }\n\n    this.element().focus();\n  }\n\n  public maximise(): void {\n    if (!this.options.canMaximise) {\n      return;\n    }\n\n    this.element().classList.toggle('maximised');\n  }\n\n  public update(content: string | Node): void {\n    this.element().lastElementChild!.remove();\n\n    this.element().append(\n      content instanceof Node ? content : e('p', t(content))\n    );\n  }\n}\n\nexport default Window;\n", "const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n", "import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n", "import {\n  DBSchema,\n  IDBPDatabase,\n  StoreKey,\n  StoreNames,\n  StoreValue,\n} from 'idb/build/entry';\nimport { openDB } from 'idb';\n\nexport interface Record {\n  [key: string]: any;\n}\n\nexport class Store<Types extends DBSchema> {\n  #connection: Promise<IDBPDatabase<Types>>;\n  #store: StoreNames<Types>;\n\n  constructor(\n    db: string,\n    store: StoreNames<Types>,\n    options?: IDBObjectStoreParameters\n  ) {\n    this.#store = store;\n\n    this.#connection = openDB(db, 1, {\n      upgrade: (db) => db.createObjectStore(this.#store, options),\n    });\n  }\n\n  async get(key: StoreKey<Types, StoreNames<Types>>) {\n    return (await this.#connection).get(this.#store, key);\n  }\n\n  async getAll(\n    query?: StoreKey<Types, StoreNames<Types>> | IDBKeyRange | null,\n    count?: number\n  ) {\n    return (await this.#connection).getAll(this.#store, query, count);\n  }\n\n  async set(\n    record: StoreValue<Types, StoreNames<Types>>,\n    key?: StoreKey<Types, StoreNames<Types>>\n  ) {\n    return (await this.#connection).put(this.#store, record, key);\n  }\n\n  async clear() {\n    return (await this.#connection).clear(this.#store);\n  }\n\n  async keys() {\n    return (await this.#connection).getAllKeys(this.#store);\n  }\n}\n", "type ScalingOptions = {\n  smoothing?: boolean;\n};\n\nexport const scaleImage = (\n  image: CanvasImageSource,\n  scale: number,\n  options?: ScalingOptions\n): HTMLCanvasElement => {\n  const newCanvas = document.createElement('canvas')!,\n    context = newCanvas.getContext('2d')!;\n\n  newCanvas.width = (image.width as number) * scale;\n  newCanvas.height = (image.height as number) * scale;\n\n  if (!options?.smoothing) {\n    context.imageSmoothingEnabled = false;\n  }\n\n  context.drawImage(image, 0, 0, newCanvas.width, newCanvas.height);\n\n  return newCanvas;\n};\n\nexport default scaleImage;\n", "import { Record, Store } from './Store';\nimport scaleImage from './lib/scaleImage';\n\ninterface Asset extends Record {\n  name: string;\n  uri: string;\n}\n\nexport class AssetStore extends Store<{\n  assets: {\n    key: string;\n    value: Asset;\n  };\n}> {\n  #cachedAssets = new Map<string, Asset>();\n  #cachedImages = new Map<string, HTMLImageElement>();\n  #cachedScaledImages = new Map<string, HTMLCanvasElement>();\n  #requiredAssets: string[] = [\n    './assets/city/bulb.png',\n    './assets/city/food.png',\n    './assets/city/gold.png',\n    './assets/city/luxury.png',\n    './assets/city/people_content_f.png',\n    './assets/city/people_content_m.png',\n    './assets/city/people_happy_f.png',\n    './assets/city/people_happy_m.png',\n    './assets/city/people_luxury.png',\n    './assets/city/people_science.png',\n    './assets/city/people_tax.png',\n    './assets/city/people_unhappy_f.png',\n    './assets/city/people_unhappy_m.png',\n    './assets/city/pollution.png',\n    './assets/city/sad.png',\n    './assets/city/production.png',\n    './assets/city/trade.png',\n    './assets/cursor/go.png',\n    './assets/cursor/torch.png',\n    './assets/general/texture_1.png',\n    './assets/general/texture_2.png',\n    './assets/improvements/irrigation.png',\n    './assets/improvements/mine.png',\n    './assets/improvements/pollution.png',\n    './assets/improvements/railroad_e.png',\n    './assets/improvements/railroad_se.png',\n    './assets/improvements/railroad_n.png',\n    './assets/improvements/railroad_ne.png',\n    './assets/improvements/railroad_nw.png',\n    './assets/improvements/railroad_s.png',\n    './assets/improvements/railroad_sw.png',\n    './assets/improvements/railroad_w.png',\n    './assets/improvements/road_e.png',\n    './assets/improvements/road_n.png',\n    './assets/improvements/road_ne.png',\n    './assets/improvements/road_nw.png',\n    './assets/improvements/road_s.png',\n    './assets/improvements/road_se.png',\n    './assets/improvements/road_sw.png',\n    './assets/improvements/road_w.png',\n    './assets/map/city.png',\n    './assets/map/fog_e.png',\n    './assets/map/fog_n.png',\n    './assets/map/fog_s.png',\n    './assets/map/fog_w.png',\n    './assets/map/fort.png',\n    './assets/map/fortify.png',\n    './assets/map/hut.png',\n    './assets/status/pollution_0.png',\n    './assets/status/pollution_25.png',\n    './assets/status/pollution_50.png',\n    './assets/status/pollution_75.png',\n    './assets/status/science_0.png',\n    './assets/status/science_25.png',\n    './assets/status/science_50.png',\n    './assets/status/science_75.png',\n    './assets/terrain/arctic.png',\n    './assets/terrain/arctic_e.png',\n    './assets/terrain/arctic_es.png',\n    './assets/terrain/arctic_esw.png',\n    './assets/terrain/arctic_ew.png',\n    './assets/terrain/arctic_n.png',\n    './assets/terrain/arctic_ne.png',\n    './assets/terrain/arctic_nes.png',\n    './assets/terrain/arctic_nesw.png',\n    './assets/terrain/arctic_new.png',\n    './assets/terrain/arctic_ns.png',\n    './assets/terrain/arctic_nsw.png',\n    './assets/terrain/arctic_nw.png',\n    './assets/terrain/arctic_s.png',\n    './assets/terrain/arctic_sw.png',\n    './assets/terrain/arctic_w.png',\n    './assets/terrain/coal.png',\n    './assets/terrain/coast_sprite.png',\n    './assets/terrain/desert.png',\n    './assets/terrain/desert_e.png',\n    './assets/terrain/desert_es.png',\n    './assets/terrain/desert_esw.png',\n    './assets/terrain/desert_ew.png',\n    './assets/terrain/desert_n.png',\n    './assets/terrain/desert_ne.png',\n    './assets/terrain/desert_nes.png',\n    './assets/terrain/desert_nesw.png',\n    './assets/terrain/desert_new.png',\n    './assets/terrain/desert_ns.png',\n    './assets/terrain/desert_nsw.png',\n    './assets/terrain/desert_nw.png',\n    './assets/terrain/desert_s.png',\n    './assets/terrain/desert_sw.png',\n    './assets/terrain/desert_w.png',\n    './assets/terrain/doe.png',\n    './assets/terrain/fish.png',\n    './assets/terrain/forest.png',\n    './assets/terrain/forest_e.png',\n    './assets/terrain/forest_es.png',\n    './assets/terrain/forest_esw.png',\n    './assets/terrain/forest_ew.png',\n    './assets/terrain/forest_n.png',\n    './assets/terrain/forest_ne.png',\n    './assets/terrain/forest_nes.png',\n    './assets/terrain/forest_nesw.png',\n    './assets/terrain/forest_new.png',\n    './assets/terrain/forest_ns.png',\n    './assets/terrain/forest_nsw.png',\n    './assets/terrain/forest_nw.png',\n    './assets/terrain/forest_s.png',\n    './assets/terrain/forest_sw.png',\n    './assets/terrain/forest_w.png',\n    './assets/terrain/gems.png',\n    './assets/terrain/gold.png',\n    './assets/terrain/grassland.png',\n    './assets/terrain/grassland_e.png',\n    './assets/terrain/grassland_es.png',\n    './assets/terrain/grassland_esw.png',\n    './assets/terrain/grassland_ew.png',\n    './assets/terrain/grassland_n.png',\n    './assets/terrain/grassland_ne.png',\n    './assets/terrain/grassland_nes.png',\n    './assets/terrain/grassland_nesw.png',\n    './assets/terrain/grassland_new.png',\n    './assets/terrain/grassland_ns.png',\n    './assets/terrain/grassland_nsw.png',\n    './assets/terrain/grassland_nw.png',\n    './assets/terrain/grassland_s.png',\n    './assets/terrain/grassland_sw.png',\n    './assets/terrain/grassland_w.png',\n    './assets/terrain/hills.png',\n    './assets/terrain/hills_e.png',\n    './assets/terrain/hills_es.png',\n    './assets/terrain/hills_esw.png',\n    './assets/terrain/hills_ew.png',\n    './assets/terrain/hills_n.png',\n    './assets/terrain/hills_ne.png',\n    './assets/terrain/hills_nes.png',\n    './assets/terrain/hills_nesw.png',\n    './assets/terrain/hills_new.png',\n    './assets/terrain/hills_ns.png',\n    './assets/terrain/hills_nsw.png',\n    './assets/terrain/hills_nw.png',\n    './assets/terrain/hills_s.png',\n    './assets/terrain/hills_sw.png',\n    './assets/terrain/hills_w.png',\n    './assets/terrain/horse.png',\n    './assets/terrain/jungle.png',\n    './assets/terrain/jungle_e.png',\n    './assets/terrain/jungle_es.png',\n    './assets/terrain/jungle_esw.png',\n    './assets/terrain/jungle_ew.png',\n    './assets/terrain/jungle_n.png',\n    './assets/terrain/jungle_ne.png',\n    './assets/terrain/jungle_nes.png',\n    './assets/terrain/jungle_nesw.png',\n    './assets/terrain/jungle_new.png',\n    './assets/terrain/jungle_ns.png',\n    './assets/terrain/jungle_nsw.png',\n    './assets/terrain/jungle_nw.png',\n    './assets/terrain/jungle_s.png',\n    './assets/terrain/jungle_sw.png',\n    './assets/terrain/jungle_w.png',\n    './assets/terrain/land.png',\n    './assets/terrain/mountains.png',\n    './assets/terrain/mountains_e.png',\n    './assets/terrain/mountains_es.png',\n    './assets/terrain/mountains_esw.png',\n    './assets/terrain/mountains_ew.png',\n    './assets/terrain/mountains_n.png',\n    './assets/terrain/mountains_ne.png',\n    './assets/terrain/mountains_nes.png',\n    './assets/terrain/mountains_nesw.png',\n    './assets/terrain/mountains_new.png',\n    './assets/terrain/mountains_ns.png',\n    './assets/terrain/mountains_nsw.png',\n    './assets/terrain/mountains_nw.png',\n    './assets/terrain/mountains_s.png',\n    './assets/terrain/mountains_sw.png',\n    './assets/terrain/mountains_w.png',\n    './assets/terrain/oasis.png',\n    './assets/terrain/ocean.png',\n    './assets/terrain/oil.png',\n    './assets/terrain/plains.png',\n    './assets/terrain/plains_e.png',\n    './assets/terrain/plains_es.png',\n    './assets/terrain/plains_esw.png',\n    './assets/terrain/plains_ew.png',\n    './assets/terrain/plains_n.png',\n    './assets/terrain/plains_ne.png',\n    './assets/terrain/plains_nes.png',\n    './assets/terrain/plains_nesw.png',\n    './assets/terrain/plains_new.png',\n    './assets/terrain/plains_ns.png',\n    './assets/terrain/plains_nsw.png',\n    './assets/terrain/plains_nw.png',\n    './assets/terrain/plains_s.png',\n    './assets/terrain/plains_sw.png',\n    './assets/terrain/plains_w.png',\n    './assets/terrain/river_e.png',\n    './assets/terrain/river_es.png',\n    './assets/terrain/river_esw.png',\n    './assets/terrain/river_ew.png',\n    './assets/terrain/river_mouth_e.png',\n    './assets/terrain/river_mouth_n.png',\n    './assets/terrain/river_mouth_s.png',\n    './assets/terrain/river_mouth_w.png',\n    './assets/terrain/river.png',\n    './assets/terrain/river_n.png',\n    './assets/terrain/river_ne.png',\n    './assets/terrain/river_nes.png',\n    './assets/terrain/river_nesw.png',\n    './assets/terrain/river_new.png',\n    './assets/terrain/river_ns.png',\n    './assets/terrain/river_nsw.png',\n    './assets/terrain/river_nw.png',\n    './assets/terrain/river_s.png',\n    './assets/terrain/river_sw.png',\n    './assets/terrain/river_w.png',\n    './assets/terrain/seal.png',\n    './assets/terrain/shield.png',\n    './assets/terrain/game.png',\n    './assets/terrain/swamp.png',\n    './assets/terrain/swamp_e.png',\n    './assets/terrain/swamp_es.png',\n    './assets/terrain/swamp_esw.png',\n    './assets/terrain/swamp_ew.png',\n    './assets/terrain/swamp_n.png',\n    './assets/terrain/swamp_ne.png',\n    './assets/terrain/swamp_nes.png',\n    './assets/terrain/swamp_nesw.png',\n    './assets/terrain/swamp_new.png',\n    './assets/terrain/swamp_ns.png',\n    './assets/terrain/swamp_nsw.png',\n    './assets/terrain/swamp_nw.png',\n    './assets/terrain/swamp_s.png',\n    './assets/terrain/swamp_sw.png',\n    './assets/terrain/swamp_w.png',\n    './assets/terrain/tundra.png',\n    './assets/terrain/tundra_e.png',\n    './assets/terrain/tundra_es.png',\n    './assets/terrain/tundra_esw.png',\n    './assets/terrain/tundra_ew.png',\n    './assets/terrain/tundra_n.png',\n    './assets/terrain/tundra_ne.png',\n    './assets/terrain/tundra_nes.png',\n    './assets/terrain/tundra_nesw.png',\n    './assets/terrain/tundra_new.png',\n    './assets/terrain/tundra_ns.png',\n    './assets/terrain/tundra_nsw.png',\n    './assets/terrain/tundra_nw.png',\n    './assets/terrain/tundra_s.png',\n    './assets/terrain/tundra_sw.png',\n    './assets/terrain/tundra_w.png',\n    './assets/units/tank.png',\n    './assets/units/artillery.png',\n    './assets/units/battleship.png',\n    './assets/units/bomber.png',\n    './assets/units/cannon.png',\n    './assets/units/caravan.png',\n    './assets/units/carrier.png',\n    './assets/units/catapult.png',\n    './assets/units/horseman.png',\n    './assets/units/chariot.png',\n    './assets/units/combat_1.png',\n    './assets/units/combat_2.png',\n    './assets/units/combat_3.png',\n    './assets/units/combat_4.png',\n    './assets/units/combat_5.png',\n    './assets/units/combat_6.png',\n    './assets/units/combat_7.png',\n    './assets/units/combat_8.png',\n    './assets/units/cruiser.png',\n    './assets/units/diplomat.png',\n    './assets/units/fighter.png',\n    './assets/units/frigate.png',\n    './assets/units/ironclad.png',\n    './assets/units/knight.png',\n    './assets/units/swordman.png',\n    './assets/units/mechanizedinfantry.png',\n    './assets/units/warrior.png',\n    './assets/units/musketman.png',\n    './assets/units/nuclear.png',\n    './assets/units/spearman.png',\n    './assets/units/rifleman.png',\n    './assets/units/sail.png',\n    './assets/units/settlers.png',\n    './assets/units/submarine.png',\n    './assets/units/transport.png',\n    './assets/units/trireme.png',\n  ];\n\n  constructor() {\n    super('civ-clone-assets', 'assets', {\n      keyPath: 'name',\n    });\n  }\n\n  async get(path: string): Promise<Asset> {\n    if (!this.#cachedAssets.has(path)) {\n      this.#cachedAssets.set(path, (await super.get(path))!);\n    }\n\n    return this.#cachedAssets.get(path)!;\n  }\n\n  async getImage(path: string): Promise<HTMLImageElement> {\n    if (!this.#cachedImages.has(path)) {\n      const asset = await this.get(path),\n        image = document.createElement('img')!;\n\n      image.src = asset.uri;\n\n      this.#cachedImages.set(path, image);\n    }\n\n    return this.#cachedImages.get(path)!;\n  }\n\n  async getScaled(path: string, scale: number): Promise<HTMLCanvasElement> {\n    if (!this.#cachedScaledImages.has(path)) {\n      this.#cachedScaledImages.set(\n        path,\n        scaleImage(await this.getImage(path), scale)\n      );\n    }\n\n    return this.#cachedScaledImages.get(path)!;\n  }\n\n  async hasAllAssets(): Promise<boolean> {\n    return (await this.missingAssets()).length === 0;\n  }\n\n  async missingAssets(): Promise<string[]> {\n    const dbAssets = await this.keys();\n\n    return this.#requiredAssets.filter(\n      (requiredAsset) => !dbAssets.includes(requiredAsset)\n    );\n  }\n}\n\nexport const assetStore = new AssetStore();\n", "import Action from './Action';\nimport LockedSlider from '../LockedSlider';\nimport LockedSliderGroup from '../LockedSliderGroup';\nimport { PlayerTradeRates } from '../../types';\nimport Window from '../Window';\nimport { e } from '../../lib/html';\nimport { assetStore } from '../../AssetStore';\n\nexport class AdjustTradeRates extends Action {\n  #sliderGroup: LockedSliderGroup | undefined;\n\n  public activate(): void {\n    const sliders: LockedSlider[] = [];\n\n    const window = new Window(\n      'Adjust trade rates',\n      e(\n        'div',\n        ...this.value().all.map((tradeRate) => {\n          const slider = new LockedSlider(tradeRate._, tradeRate.value * 100);\n\n          sliders.push(slider);\n\n          return slider.element();\n        })\n      )\n    );\n\n    window.element().addEventListener('close', () => {\n      this.transport().send('action', {\n        name: 'AdjustTradeRates',\n        id: this.value().id,\n        value: this.#sliderGroup!.sliders().map((slider) => [\n          slider.label(),\n          parseFloat((slider.value() / 100).toFixed(2)),\n        ]),\n      });\n    });\n\n    this.#sliderGroup = new LockedSliderGroup(...sliders);\n  }\n\n  build(): void {\n    assetStore\n      .get('./assets/city/trade.png')\n      .then((asset) =>\n        this.element().append(\n          e(\n            `button.adjustTradeRates[title=\"Adjust trade rates\"][style=\"background-image:url('${\n              asset!.uri\n            }')\"]`\n          )\n        )\n      );\n  }\n\n  value(): PlayerTradeRates {\n    return super.value() as PlayerTradeRates;\n  }\n}\n\nexport default AdjustTradeRates;\n", "import { Window, IWindow, WindowOptions } from './Window';\n\nexport interface INotificationWindow extends IWindow {}\n\nconst notificationQueue: [\n  NotificationWindow,\n  boolean,\n  (...args: any[]) => void\n][] = [];\n\nexport interface NotificationWindowOptions extends WindowOptions {\n  queue?: boolean;\n}\n\nexport class NotificationWindow extends Window implements INotificationWindow {\n  #options: NotificationWindowOptions = {};\n\n  constructor(\n    title: string,\n    body: string | Node,\n    passedOptions: NotificationWindowOptions = {}\n  ) {\n    const options = {\n      queue: true,\n      ...passedOptions,\n    };\n\n    super(title, body, options);\n\n    this.#options = options;\n\n    this.element().classList.add('notificationWindow');\n\n    this.element().addEventListener('keydown', (event) => {\n      if (event.key === 'Enter') {\n        this.close();\n\n        event.stopPropagation();\n      }\n    });\n  }\n\n  close(): void {\n    super.close();\n\n    if (\n      this.#options.queue &&\n      notificationQueue.length &&\n      NotificationWindow.hasOpenWindow()\n    ) {\n      const [notification, focus, resolve] = notificationQueue.shift()!;\n\n      notification.display(focus);\n\n      resolve();\n    }\n  }\n\n  display(focus = true): Promise<any> {\n    return new Promise((resolve) => {\n      if (NotificationWindow.hasOpenWindow()) {\n        notificationQueue.push([this, focus, resolve]);\n\n        return;\n      }\n\n      super.display();\n\n      if (!focus) {\n        resolve(undefined);\n\n        return;\n      }\n\n      this.element().focus();\n\n      resolve(undefined);\n    });\n  }\n\n  public static hasOpenWindow(): boolean {\n    return !!document.querySelector('div.notificationWindow');\n  }\n}\n\nexport default NotificationWindow;\n", "import { e, h, t } from '../lib/html';\nimport {\n  NotificationWindow,\n  NotificationWindowOptions,\n} from './NotificationWindow';\n\nexport interface SelectionWindowOption {\n  label?: string;\n  value: any;\n}\n\nexport interface SelectionWindowAction {\n  label: string;\n  action: (select: SelectionWindow) => void;\n}\n\nexport interface SelectionWindowActions {\n  [key: string]: SelectionWindowAction;\n}\n\nexport interface SelectionWindowOptions extends NotificationWindowOptions {\n  actions?: SelectionWindowActions;\n  autoFocus?: boolean;\n  displayAll?: boolean;\n}\n\nexport class SelectionWindow extends NotificationWindow {\n  #resizeHandler = () => this.resize();\n  #selectionList: HTMLSelectElement;\n\n  constructor(\n    title: string,\n    optionList: SelectionWindowOption[],\n    onChoose: (selection: string) => void,\n    body: string | Node | null = 'Please choose one of the following:',\n    options: SelectionWindowOptions = {}\n  ) {\n    options = {\n      autoFocus: true,\n      displayAll: false,\n      ...options,\n      actions: {\n        primary: {\n          label: 'OK',\n          action: (selectionWindow) =>\n            chooseHandler(selectionWindow.selectionList().value),\n          ...(options.actions?.primary ?? {}),\n        },\n        ...options.actions,\n      },\n    };\n\n    const chooseHandler = (selection: string): void => {\n        this.element().dispatchEvent(\n          new CustomEvent<string>('selection', {\n            detail: selection,\n          })\n        );\n\n        this.close();\n\n        onChoose(selection);\n      },\n      selectionList: HTMLSelectElement = h(\n        e(\n          'select',\n          ...optionList.map((option) =>\n            e(\n              `option[value=\"${option.value}\"]`,\n              t(option.label || option.value)\n            )\n          )\n        ) as HTMLSelectElement,\n        {\n          keydown: (event: KeyboardEvent) => {\n            if (event.key === 'Enter') {\n              chooseHandler(selectionList.value);\n            }\n          },\n          dblclick: () => chooseHandler(selectionList.value),\n        }\n      );\n\n    if (options.displayAll && optionList.length > 1) {\n      selectionList.setAttribute('size', optionList.length.toString());\n    }\n\n    if (options.autoFocus && optionList.length > 1) {\n      selectionList.setAttribute('autofocus', '');\n    }\n\n    super(\n      title,\n      e(\n        'div',\n        ...(body instanceof Node\n          ? [body]\n          : body === null\n          ? []\n          : [e('p', t(body))]),\n        selectionList,\n        e(\n          'footer',\n          ...Object.entries(options.actions!).map(([, { label, action }]) =>\n            h(e('button', t(label)), {\n              click: () => action(this),\n              keydown: (event) => {\n                if (event.key === 'Enter') {\n                  action(this);\n                }\n              },\n            })\n          )\n        )\n      ),\n      options\n    );\n\n    this.element().classList.add('selectionWindow');\n    this.#selectionList = selectionList;\n\n    this.resize();\n\n    window.addEventListener('resize', this.#resizeHandler);\n  }\n\n  close() {\n    window.removeEventListener('resize', this.#resizeHandler);\n\n    super.close();\n  }\n\n  display(): Promise<any> {\n    return super.display(false).then(() => {\n      const select = this.element().querySelector('select');\n\n      if (select && select.hasAttribute('autofocus')) {\n        select.focus();\n      }\n    });\n  }\n\n  resize(): void {\n    // TODO: I'd like to have this height scaled automatically.\n    //  Feels like it should be possible using CSS flexbox, but can't get it to work...\n    try {\n      this.selectionList().style.maxHeight = 'none';\n      this.selectionList().style.maxHeight = `calc(${\n        this.element().offsetHeight -\n        (this.element().firstElementChild! as HTMLElement).offsetHeight -\n        ((this.selectionList().previousElementSibling as HTMLElement)\n          ?.offsetHeight ?? 0) -\n        (this.selectionList().nextElementSibling as HTMLElement).offsetHeight\n      }px - 2em)`;\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n\n  selectionList(): HTMLSelectElement {\n    return this.#selectionList;\n  }\n}\n\nexport default SelectionWindow;\n", "import Action from './Action';\nimport { PlayerResearch } from '../../types';\nimport SelectionWindow from '../SelectionWindow';\nimport { e } from '../../lib/html';\nimport { assetStore } from '../../AssetStore';\n\nexport class ChooseResearch extends Action {\n  public activate(): void {\n    const chooseWindow = new SelectionWindow(\n      'Choose research',\n      this.value().available.map((advance) => ({\n        value: advance._,\n      })),\n      (selection) => {\n        if (!selection) {\n          return;\n        }\n\n        this.transport().send('action', {\n          name: 'ChooseResearch',\n          id: this.value().id,\n          chosen: selection ? selection : '@',\n        });\n\n        this.complete();\n\n        chooseWindow.close();\n      },\n      'Which advance would you like to research next?',\n      {\n        displayAll: true,\n      }\n    );\n  }\n\n  build(): void {\n    assetStore\n      .get('./assets/city/bulb.png')\n      .then((asset) =>\n        this.element().append(\n          e(\n            `button.chooseResearch[title=\"Choose research\"][style=\"background-image:url('${\n              asset!.uri\n            }')\"]`\n          )\n        )\n      );\n  }\n\n  value(): PlayerResearch {\n    return super.value() as PlayerResearch;\n  }\n}\n\nexport default ChooseResearch;\n", "export const knownGroups: { [key: string]: string } = {\n  Food: 'Food',\n  UnitSupportFood: 'Food',\n  PopulationSupportFood: 'Food',\n  Production: 'Production',\n  UnitSupportProduction: 'Production',\n  Trade: 'Trade',\n  Corruption: 'Trade',\n  Happiness: 'Happiness',\n  LuxuryHappiness: 'Happiness',\n  Unhappiness: 'Unhappiness',\n  MartialLaw: 'Unhappiness',\n  MilitaryUnhappiness: 'Unhappiness',\n  PopulationUnhappiness: 'Unhappiness',\n  CityImprovementContent: 'Unhappiness',\n  Research: 'Research',\n  Luxuries: 'Luxuries',\n  Gold: 'Gold',\n  CityImprovementMaintenanceGold: 'Gold',\n};\n\nexport const knownGroupLookup = Object.entries(knownGroups).reduce(\n  (object, [yieldName, group]) => {\n    if (!Object.prototype.hasOwnProperty.call(object, group)) {\n      object[group] = [];\n    }\n\n    object[group].push(yieldName);\n\n    return object;\n  },\n  {} as { [key: string]: string[] }\n);\n\nexport const knownIcons: { [key: string]: string } = {\n  Food: 'city/food.png',\n  Production: 'city/production.png',\n  Trade: 'city/trade.png',\n  Gold: 'city/gold.png',\n  Luxuries: 'city/luxury.png',\n  Pollution: 'city/pollution.png',\n  Research: 'city/bulb.png',\n  Unhappiness: 'city/sad.png',\n};\n", "import { e } from './html';\n\nexport let preloadContainer: HTMLElement;\n\nexport const setPreloadContainer = (preloadContainerElement: HTMLElement) =>\n  (preloadContainer = preloadContainerElement);\n\nexport const getPreloadedImage = (path: string): CanvasImageSource => {\n  const image = preloadContainer.querySelector(`[data-path$=\"${path}.png\"]`);\n\n  if (image === null) {\n    console.error(`Missing image: ${path}.`);\n\n    return e('canvas') as HTMLCanvasElement;\n  }\n\n  return image as HTMLImageElement;\n};\n\nexport default getPreloadedImage;\n", "import { e } from './html';\n\nexport const replaceColours = (\n  image: CanvasImageSource,\n  source: string[],\n  replacement: string[]\n) => {\n  const canvas = e('canvas') as HTMLCanvasElement,\n    context = canvas.getContext('2d')!;\n\n  canvas.width = image.width as number;\n  canvas.height = image.height as number;\n\n  context.drawImage(image, 0, 0, image.width as number, image.height as number);\n\n  const imageData = context.getImageData(0, 0, canvas.width, canvas.height),\n    getColor = (input: string | number[]) => {\n      let match: RegExpMatchArray | null = null,\n        color: { r: number; g: number; b: number; a: number } = {\n          r: 0,\n          g: 0,\n          b: 0,\n          a: 0,\n        };\n\n      if (typeof input === 'string') {\n        if (\n          (match = input.match(\n            /^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1], 16),\n            g: parseInt(match[2], 16),\n            b: parseInt(match[3], 16),\n            a: 1,\n          };\n        } else if (\n          (match = input.match(\n            /^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1] + match[1], 16),\n            g: parseInt(match[2] + match[2], 16),\n            b: parseInt(match[3] + match[3], 16),\n            a: 1,\n          };\n        } else if (\n          (match = input.match(\n            /^rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1]),\n            g: parseInt(match[2]),\n            b: parseInt(match[3]),\n            a: 1,\n          };\n        } else if (\n          (match = input.match(\n            /^rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+|\\d+\\.|\\.\\d+|\\d+\\.\\d+)\\s*\\)\\s*$/\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1]),\n            g: parseInt(match[2]),\n            b: parseInt(match[3]),\n            a: parseFloat(match[4] ?? 1),\n          };\n        }\n      } else if ('length' in input) {\n        color = {\n          r: input[0] || 0,\n          g: input[1] || 0,\n          b: input[2] || 0,\n          a: input[3] || 1,\n        };\n      }\n\n      return color;\n    };\n\n  let sourceColors = source.map(getColor),\n    replaceColors = replacement.map(getColor);\n\n  for (let i = 0; i < imageData.data.length; i += 4) {\n    sourceColors.forEach((color, n) => {\n      if (\n        imageData.data[i] === color.r &&\n        imageData.data[i + 1] === color.g &&\n        imageData.data[i + 2] === color.b &&\n        imageData.data[i + 3] === color.a * 255\n      ) {\n        imageData.data[i] = (replaceColors[n] || replaceColors[0]).r;\n        imageData.data[i + 1] = (replaceColors[n] || replaceColors[0]).g;\n        imageData.data[i + 2] = (replaceColors[n] || replaceColors[0]).b;\n        imageData.data[i + 3] = Math.trunc(\n          (replaceColors[n] || replaceColors[0]).a * 255\n        );\n      }\n    });\n  }\n\n  context.putImageData(imageData, 0, 0);\n\n  return canvas;\n};\n\nexport default replaceColours;\n", "import { NeighbourDirection, Tile } from '../types';\nimport {\n  getPreloadedImage,\n  preloadContainer,\n  setPreloadContainer,\n} from '../lib/getPreloadedImage';\nimport World from './World';\nimport { e } from '../lib/html';\nimport replaceColours from '../lib/replaceColours';\n\nexport interface IMap {\n  context(): CanvasRenderingContext2D;\n  render(...args: any[]): void;\n  scale(): number;\n  tileSize(): number;\n  world(): World;\n}\n\ninterface DrawImageOptions {\n  augment?: (image: CanvasImageSource) => CanvasImageSource;\n  offsetX?: number;\n  offsetY?: number;\n}\n\nexport class Map implements IMap {\n  #canvas: HTMLCanvasElement;\n  #context: CanvasRenderingContext2D;\n  #visible: boolean = true;\n  #scale: number;\n  #tileSize: number;\n  #world: World;\n\n  constructor(\n    world: World,\n    scale: number = 2,\n    tileSize: number = 16,\n    canvas: HTMLCanvasElement = e('canvas') as HTMLCanvasElement\n  ) {\n    this.#canvas = canvas;\n    this.#world = world;\n    this.#tileSize = tileSize;\n    this.#scale = scale;\n\n    this.setCanvasSize();\n\n    this.#context = this.#canvas.getContext('2d') as CanvasRenderingContext2D;\n    setPreloadContainer(document.querySelector('#preload')!);\n  }\n\n  canvas(): HTMLCanvasElement {\n    return this.#canvas;\n  }\n\n  clear(): void {\n    this.context().clearRect(0, 0, this.canvas().width, this.canvas().height);\n  }\n\n  context(): CanvasRenderingContext2D {\n    return this.#context;\n  }\n\n  render(tiles: Tile[] = this.world().tiles()): void {\n    this.clear();\n\n    tiles.forEach(({ x, y }: Tile) => this.renderTile(this.world().get(x, y)));\n  }\n\n  renderTile({ x, y }: Tile): void {\n    const size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    this.context().clearRect(offsetX, offsetY, size, size);\n  }\n\n  scale(): number {\n    return this.#scale;\n  }\n\n  tileSize(): number {\n    return this.#tileSize * this.#scale;\n  }\n\n  update(tilesToUpdate: Tile[]): void {\n    tilesToUpdate.forEach(({ x, y }: Tile) =>\n      this.renderTile(this.world().get(x, y))\n    );\n  }\n\n  world(): World {\n    return this.#world;\n  }\n\n  protected drawImage(\n    path: string,\n    x: number,\n    y: number,\n    options: DrawImageOptions = {}\n  ): void {\n    const size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      image = this.getPreloadedImage(path);\n\n    this.putImage(\n      options.augment ? options.augment(image) : image,\n      offsetX + (options.offsetX ?? 0),\n      offsetY + (options.offsetY ?? 0)\n    );\n  }\n\n  protected filterNeighbours(\n    tile: Tile,\n    filter: (tile: Tile) => boolean,\n    directions: NeighbourDirection[] = ['n', 'e', 's', 'w']\n  ): NeighbourDirection[] {\n    return directions.filter((direction: NeighbourDirection): boolean =>\n      filter(this.#world.getNeighbour(tile, direction))\n    );\n  }\n\n  protected getPreloadedImage(path: string): CanvasImageSource {\n    return getPreloadedImage(path);\n  }\n\n  protected putImage(\n    image: CanvasImageSource,\n    offsetX: number,\n    offsetY: number\n  ): void {\n    this.#context.imageSmoothingEnabled = false;\n\n    this.#context.drawImage(\n      image,\n      offsetX,\n      offsetY,\n      (image.width as number) * this.#scale,\n      (image.height as number) * this.#scale\n    );\n  }\n\n  protected replaceColours(\n    image: CanvasImageSource,\n    source: string[],\n    replacement: string[]\n  ) {\n    return replaceColours(image, source, replacement);\n  }\n\n  protected setCanvasSize(): void {\n    this.#canvas.height = this.#world.height() * this.tileSize();\n    this.#canvas.width = this.#world.width() * this.tileSize();\n    // this.#canvas.setAttribute('height', this.#canvas.height.toString());\n    // this.#canvas.setAttribute('width',this.#canvas.width.toString());\n  }\n\n  isVisible(): boolean {\n    return this.#visible;\n  }\n\n  setVisible(visible: boolean): void {\n    this.#visible = visible;\n  }\n}\n\nexport default Map;\n", "import { Tile, Unit } from '../../types';\nimport { Map, IMap } from '../Map';\n\nexport class Cities extends Map {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    if (tile.city) {\n      const city = tile.city,\n        player = city.player,\n        civilization = player.civilization,\n        [colors] = civilization.attributes.filter(\n          (attribute) => attribute.name === 'colors'\n        );\n\n      if (tile.units.length > 0) {\n        this.context().fillStyle = '#000';\n        this.context().fillRect(offsetX, offsetY, size, size);\n      }\n\n      this.context().fillStyle = colors.value[0];\n      this.context().fillRect(\n        offsetX + this.scale(),\n        offsetY + this.scale(),\n        size - this.scale() * 2,\n        size - this.scale() * 2\n      );\n\n      this.drawImage(`map/city`, x, y, {\n        augment: (image) =>\n          this.replaceColours(\n            image,\n            // To come from theme manifest\n            ['#000'],\n            [colors.value[1]]\n          ),\n        offsetX: this.scale(),\n        offsetY: this.scale(),\n      });\n    }\n  }\n}\n\nexport default Cities;\n", "import {\n  NotificationWindow,\n  NotificationWindowOptions,\n} from './NotificationWindow';\nimport { e, h, t } from '../lib/html';\n\nexport interface ConfirmationWindowOptions extends NotificationWindowOptions {\n  okLabel?: string;\n  cancelLabel?: string;\n}\n\nexport class ConfirmationWindow extends NotificationWindow {\n  constructor(\n    title: string,\n    details: string,\n    onOK: () => void,\n    options: ConfirmationWindowOptions = {}\n  ) {\n    const confirmationButton = h(e('button', t(options.okLabel ?? 'OK')), {\n      click: () => {\n        onOK();\n\n        this.close();\n      },\n      keydown: (event) => {\n        if (event.key === 'Enter' || event.key === ' ') {\n          event.preventDefault();\n          event.stopPropagation();\n\n          onOK();\n\n          this.close();\n        }\n      },\n    });\n\n    super(\n      title,\n      e(\n        'div.content',\n        e('p', t(details)),\n        e(\n          'footer',\n          confirmationButton,\n          h(e('button', t(options.cancelLabel ?? 'Cancel')), {\n            click: () => this.close(),\n            keydown: (event) => {\n              if (event.key === 'Enter' || event.key === ' ') {\n                event.preventDefault();\n                event.stopPropagation();\n\n                this.close();\n              }\n            },\n          })\n        )\n      ),\n      {\n        ...options,\n        queue: false,\n      }\n    );\n\n    confirmationButton.focus();\n  }\n}\n\nexport default ConfirmationWindow;\n", "import { PlainObject } from './types';\nimport { ObjectMap } from './lib/reconstituteData';\n\nexport type dataUpdatedEvent = CustomEvent<{ data: PlainObject }>;\nexport type dataUpdatedHandler = (data: PlainObject) => void;\nexport type patchDataReceivedEvent = CustomEvent<{ value: ObjectMap }>;\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    dataupdated: dataUpdatedEvent;\n    patchdatareceived: patchDataReceivedEvent;\n  }\n}\n\nexport class DataObserver {\n  #handler: (event: patchDataReceivedEvent) => void;\n  #ids: string[] = [];\n\n  constructor(ids: string[], handler: dataUpdatedHandler) {\n    this.setIds(ids);\n\n    this.#handler = (event) => {\n      const { detail } = event,\n        objects = detail.value.objects;\n\n      if (!objects) {\n        return;\n      }\n\n      if (this.#ids.some((id) => id in objects)) {\n        document.addEventListener(\n          'dataupdated',\n          (event) => handler(event.detail.data),\n          {\n            once: true,\n          }\n        );\n      }\n    };\n\n    document.addEventListener('patchdatareceived', this.#handler);\n  }\n\n  dispose(): void {\n    document.removeEventListener('patchdatareceived', this.#handler);\n  }\n\n  setIds(ids: string[]): void {\n    this.#ids.splice(0, this.#ids.length, ...ids);\n  }\n}\n\nexport default DataObserver;\n", "import { NeighbourDirection, Tile } from '../../types';\nimport { Map, IMap } from '../Map';\n\nexport class TerrainAbstract extends Map implements IMap {\n  update(tilesToUpdate: Tile[]): void {\n    // we need to redraw the surrounding tiles to prevent the hidden terrain showing up incorrectly.\n    const extendedTilesToUpdate = [...tilesToUpdate];\n\n    tilesToUpdate.forEach((tile) => {\n      (\n        ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw'] as NeighbourDirection[]\n      ).forEach((direction) => {\n        const target = this.world().getNeighbour(tile, direction);\n\n        if (extendedTilesToUpdate.includes(target)) {\n          return;\n        }\n\n        extendedTilesToUpdate.push(target);\n      });\n    });\n\n    return super.update(extendedTilesToUpdate);\n  }\n}\n\nexport default TerrainAbstract;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Feature extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    if (tile.terrain.features.length) {\n      tile.terrain.features.forEach((feature) =>\n        feature._ === 'Shield'\n          ? this.drawImage(`terrain/${feature._.toLowerCase()}`, x, y, {\n              offsetX: 4 * this.scale(),\n              offsetY: 4 * this.scale(),\n            })\n          : this.drawImage(`terrain/${feature._.toLowerCase()}`, x, y)\n      );\n    }\n  }\n}\n\nexport default Feature;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Fog extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    this.filterNeighbours(tile, (tile) => tile.terrain._ === 'Unknown').forEach(\n      (direction) => this.drawImage(`map/fog_${direction}`, x, y)\n    );\n  }\n}\n\nexport default Fog;\n", "import { EntityInstance, NeighbourDirection, Tile } from '../../types';\nimport TerrainAbstract from './TerrainAbstract';\n\ntype Improvement = 'Mine' | 'Pollution' | 'Railroad' | 'Road';\n\ntype ImprovementLookup = {\n  [key in Improvement]: boolean;\n};\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    const improvements = tile.improvements.reduce(\n      (\n        state: ImprovementLookup,\n        improvement: EntityInstance\n      ): ImprovementLookup => {\n        const improvementType = improvement._ as Improvement;\n\n        if (!(improvementType in state)) {\n          return state;\n        }\n\n        state[improvementType] = true;\n\n        return state;\n      },\n      {\n        Mine: false,\n        Road: false,\n        Railroad: false,\n        Pollution: false,\n      }\n    );\n\n    (['Mine', 'Pollution'] as (keyof ImprovementLookup)[]).forEach(\n      (improvementName: keyof ImprovementLookup) => {\n        if (improvements[improvementName]) {\n          this.drawImage(`improvements/${improvementName.toLowerCase()}`, x, y);\n        }\n      }\n    );\n\n    // Can't have Railroad without Road!\n    if (improvements.Road) {\n      const neighbouringRoad = this.filterNeighbours(\n          tile,\n          (adjoiningTile: Tile): boolean =>\n            adjoiningTile.improvements.some(\n              (improvement: EntityInstance): boolean => improvement._ === 'Road'\n            ),\n          ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw']\n        ),\n        neighbouringRailroad = this.filterNeighbours(\n          tile,\n          (adjoiningTile: Tile): boolean =>\n            !!adjoiningTile.city ||\n            adjoiningTile.improvements.some(\n              (improvement: EntityInstance): boolean =>\n                improvement._ === 'Railroad'\n            ),\n          ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw']\n        );\n\n      neighbouringRoad.forEach((direction: NeighbourDirection): void => {\n        if (\n          !improvements.Railroad ||\n          !neighbouringRailroad.includes(direction)\n        ) {\n          this.drawImage(`improvements/road_${direction}`, x, y);\n        }\n      });\n\n      if (improvements.Railroad) {\n        neighbouringRailroad.forEach((direction: NeighbourDirection): void =>\n          this.drawImage(`improvements/railroad_${direction}`, x, y)\n        );\n      }\n\n      if (neighbouringRoad.length === 0 && neighbouringRailroad.length === 0) {\n        const size = this.tileSize(),\n          offsetX = x * size,\n          offsetY = y * size,\n          center = Math.floor(this.tileSize() / 2) - this.scale();\n\n        this.context().fillStyle = improvements.Railroad ? '#000' : '#8c5828';\n        this.context().rect(\n          offsetX + center,\n          offsetY + center,\n          this.scale() * 2,\n          this.scale() * 2\n        );\n        this.context().fill();\n      }\n    }\n  }\n}\n\nexport default Terrain;\n", "import SelectionWindow from './SelectionWindow';\nimport Transport from '../../Engine/Transport';\nimport { Unit } from '../types';\n\nexport class InactiveUnitSelectionWindow extends SelectionWindow {\n  constructor(\n    units: Unit[],\n    transport: Transport,\n    onComplete: (unit: Unit) => void = () => {}\n  ) {\n    super(\n      // TODO: i18n\n      'Activate unit',\n      units.map((unit: Unit) => ({\n        label:\n          unit._ +\n          ' [' +\n          (unit.city?.name ?? 'NONE') +\n          ']' +\n          (unit.busy ? ` (${unit.busy!._})` : ''),\n        value: unit.id,\n      })),\n      (selection: string) => {\n        const [unit] = units.filter((tileUnit) => tileUnit.id === selection);\n\n        if (!unit) {\n          return;\n        }\n\n        if (!unit.active) {\n          transport.send('action', {\n            name: 'InactiveUnit',\n            id: selection,\n          });\n\n          return;\n        }\n\n        onComplete(unit);\n      },\n      null\n    );\n  }\n}\n\nexport default InactiveUnitSelectionWindow;\n", "import { EntityInstance, NeighbourDirection, Tile } from '../../types';\nimport TerrainAbstract from './TerrainAbstract';\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile,\n      hasIrrigation = tile.improvements.some(\n        (improvement: EntityInstance): boolean => improvement._ === 'Irrigation'\n      );\n\n    if (!hasIrrigation) {\n      return;\n    }\n\n    this.drawImage(`improvements/irrigation`, x, y);\n  }\n}\n\nexport default Terrain;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\nimport { e } from '../../lib/html';\n\nexport class Land extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    if (tile.isLand) {\n      this.drawImage('terrain/land', x, y);\n    } else if (tile.isWater) {\n      this.drawImage('terrain/ocean', x, y);\n\n      if (tile.isCoast) {\n        const sprite = this.getPreloadedImage(\n            'terrain/coast_sprite'\n          ) as HTMLImageElement,\n          // formula from: http://forums.civfanatics.com/showpost.php?p=13507808&postcount=40\n          // Build a bit mask of all 8 surrounding tiles, setting the bit if the tile is not an\n          // ocean tile. Starting with the tile to the left as the least significant bit and\n          // going clockwise\n          bitmask =\n            (this.world().getNeighbour(tile, 'w').isLand ? 1 : 0) |\n            (this.world().getNeighbour(tile, 'nw').isLand ? 2 : 0) |\n            (this.world().getNeighbour(tile, 'n').isLand ? 4 : 0) |\n            (this.world().getNeighbour(tile, 'ne').isLand ? 8 : 0) |\n            (this.world().getNeighbour(tile, 'e').isLand ? 16 : 0) |\n            (this.world().getNeighbour(tile, 'se').isLand ? 32 : 0) |\n            (this.world().getNeighbour(tile, 's').isLand ? 64 : 0) |\n            (this.world().getNeighbour(tile, 'sw').isLand ? 128 : 0);\n\n        if (bitmask > 0) {\n          // There are at least one surrounding tile that is not ocean, so we need to render\n          // coast. We divide the tile into four 8x8 subtiles and for each of these we want\n          // a 3 bit bitmask of the surrounding tiles. We do this by looking at the 3 least\n          // significant bits for the top left subtile and shift the mask to the right as we\n          // are going around the tile. This way we are \"rotating\" our bitmask. The result\n          // are our x offsets into ter257.pic\n          let topLeftSubtileOffset = bitmask & 7,\n            topRightSubtileOffset = (bitmask >> 2) & 7,\n            bottomRightSubtileOffset = (bitmask >> 4) & 7,\n            bottomLeftSubtileOffset =\n              ((bitmask >> 6) & 7) | ((bitmask & 1) << 2);\n\n          const image = e(\n              'canvas[height=\"16\"][width=\"16\"]'\n            ) as HTMLCanvasElement,\n            imageContext = image.getContext('2d') as CanvasRenderingContext2D;\n\n          imageContext.drawImage(\n            sprite,\n            topLeftSubtileOffset << 4,\n            0,\n            8,\n            8,\n            0,\n            0,\n            8,\n            8\n          );\n          imageContext.drawImage(\n            sprite,\n            (topRightSubtileOffset << 4) + 8,\n            0,\n            8,\n            8,\n            8,\n            0,\n            8,\n            8\n          );\n          imageContext.drawImage(\n            sprite,\n            (bottomRightSubtileOffset << 4) + 8,\n            8,\n            8,\n            8,\n            8,\n            8,\n            8,\n            8\n          );\n          imageContext.drawImage(\n            sprite,\n            bottomLeftSubtileOffset << 4,\n            8,\n            8,\n            8,\n            0,\n            8,\n            8,\n            8\n          );\n\n          this.putImage(image, offsetX, offsetY);\n        }\n\n        this.filterNeighbours(\n          tile,\n          (tile: Tile): boolean => tile.terrain._ === 'River'\n        ).forEach((direction) =>\n          this.drawImage(`terrain/river_mouth_${direction}`, x, y)\n        );\n      }\n    }\n  }\n}\n\nexport default Land;\n", "import { Coordinate, Tile, Unit } from '../types';\nimport { EventEmitter } from '@dom111/typed-event-emitter';\nimport Map from './Map';\nimport Transport from '../../Engine/Transport';\nimport World from './World';\nimport { e } from '../lib/html';\n\nexport interface IPortal {\n  build(updatedTiles: Tile[]): void;\n  canvas(): HTMLCanvasElement;\n  center(): Coordinate;\n  getLayer(LayerType: typeof Map): Map | null;\n  getLayers(LayerType: typeof Map): Map[];\n  isVisible(x: number, y: number): boolean;\n  playerId(): string | null;\n  render(): void;\n  scale(): number;\n  setCenter(x: number, y: number): void;\n  tileSize(): number;\n  transport(): Transport;\n  visibleBounds(): [number, number, number, number];\n  visibleRange(): [Coordinate, Coordinate];\n  world(): World;\n}\n\nexport interface PortalSettings {\n  playerId: string | null;\n  scale: number;\n  tileSize: number;\n}\n\ntype PortalOptions = {\n  [K in keyof PortalSettings]?: PortalSettings[K];\n};\n\nconst defaultPortalOptions: PortalSettings = {\n  playerId: null,\n  scale: 2,\n  tileSize: 16,\n};\n\nexport class Portal\n  extends EventEmitter<{\n    ['activate-unit']: [Unit];\n    ['focus-changed']: [number, number];\n  }>\n  implements IPortal\n{\n  #canvas: HTMLCanvasElement;\n  #center: Coordinate = { x: 0, y: 0 };\n  #context: CanvasRenderingContext2D;\n  #layers: Map[] = [];\n  #playerId: string | null = null;\n  #scale: number;\n  #tileSize: number;\n  #transport: Transport;\n  #world: World;\n\n  constructor(\n    world: World,\n    transport: Transport,\n    canvas: HTMLCanvasElement = e('canvas') as HTMLCanvasElement,\n    options: PortalOptions = {\n      playerId: null,\n      scale: 2,\n    },\n    ...layers: typeof Map[]\n  ) {\n    const settings: PortalSettings = {\n      ...defaultPortalOptions,\n      ...options,\n    };\n\n    super();\n\n    this.#world = world;\n    this.#canvas = canvas;\n    this.#playerId = settings.playerId;\n    this.#tileSize = settings.tileSize;\n    this.#scale = settings.scale;\n    this.#transport = transport;\n\n    layers.forEach((MapType) =>\n      this.#layers.push(new MapType(this.#world, this.scale(), this.tileSize()))\n    );\n\n    this.#context = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n    this.bindEvents();\n  }\n\n  protected bindEvents(): void {}\n\n  public build(updatedTiles: Tile[]): void {\n    this.#layers.forEach((layer: Map) => layer.update(updatedTiles));\n  }\n\n  public canvas(): HTMLCanvasElement {\n    return this.#canvas;\n  }\n\n  public center(): Coordinate {\n    return this.#center;\n  }\n\n  public getLayer(LayerType: typeof Map): Map | null {\n    return this.getLayers(LayerType).shift() ?? null;\n  }\n\n  public getLayers(LayerType: typeof Map): Map[] {\n    return this.#layers.filter((layer) => layer instanceof LayerType);\n  }\n\n  public isVisible(x: number, y: number): boolean {\n    const visibleHorizontal = Math.floor(this.#canvas.width / this.#tileSize),\n      visibleVertical = Math.floor(this.#canvas.height / this.#tileSize);\n\n    if (\n      visibleHorizontal >= this.#world.width() &&\n      visibleVertical >= this.#world.height()\n    ) {\n      return true;\n    }\n\n    const [xLowerBound, xUpperBound, yLowerBound, yUpperBound] =\n      this.visibleBounds();\n\n    // I _think_ this logic is correct now...\n    return (\n      (visibleHorizontal >= this.#world.width() ||\n        (xLowerBound > xUpperBound\n          ? x < xUpperBound || x > xLowerBound\n          : x < xUpperBound && x > xLowerBound)) &&\n      (visibleVertical >= this.#world.height() ||\n        (yLowerBound > yUpperBound\n          ? y < yUpperBound || y > yLowerBound\n          : y < yUpperBound && y > yLowerBound))\n    );\n  }\n\n  public playerId(): string | null {\n    return this.#playerId;\n  }\n\n  public render(): void {\n    const tileSize = this.#layers[0].tileSize(),\n      layerWidth = this.#world.width() * tileSize,\n      centerX = this.#center.x * tileSize + Math.trunc(tileSize / this.scale()),\n      portalCenterX = Math.trunc(this.#canvas.width / 2),\n      layerHeight = this.#world.height() * tileSize,\n      centerY = this.#center.y * tileSize + Math.trunc(tileSize / this.scale()),\n      portalCenterY = Math.trunc(this.#canvas.height / 2);\n\n    let startX = portalCenterX - centerX,\n      endX = portalCenterX + layerWidth,\n      startY = portalCenterY - centerY,\n      endY = portalCenterY + layerHeight;\n\n    while (startX > 0) {\n      startX -= layerWidth;\n    }\n\n    while (startY > 0) {\n      startY -= layerHeight;\n    }\n\n    while (endX < this.#canvas.width) {\n      endX += layerWidth;\n    }\n\n    while (endY < this.#canvas.height) {\n      endY += layerHeight;\n    }\n\n    this.#context.fillStyle = '#000';\n    this.#context.fillRect(\n      0,\n      0,\n      Math.max(this.#world.width() * tileSize, this.#canvas.width),\n      Math.max(this.#world.height() * tileSize, this.#canvas.height)\n    );\n\n    for (let x = startX; x < endX; x += layerWidth) {\n      for (let y = startY; y < endY; y += layerHeight) {\n        this.#layers.forEach((layer) => {\n          if (!layer.isVisible()) {\n            return;\n          }\n\n          const canvas = layer.canvas();\n\n          this.#context.drawImage(canvas, x, y, canvas.width, canvas.height);\n        });\n      }\n    }\n  }\n\n  public scale(): number {\n    return this.#scale;\n  }\n\n  public setCenter(x: number, y: number): void {\n    this.#center.x = x;\n    this.#center.y = y;\n\n    this.render();\n\n    this.emit('focus-changed', x, y);\n  }\n\n  public tileSize(): number {\n    return this.#tileSize;\n  }\n\n  transport(): Transport {\n    return this.#transport;\n  }\n\n  public visibleBounds(): [number, number, number, number] {\n    const xRange = Math.floor(\n        this.#canvas.width / this.#layers[0].tileSize() / this.#scale\n      ),\n      yRange = Math.floor(\n        this.#canvas.height / this.#layers[0].tileSize() / this.#scale\n      ),\n      xLowerBound =\n        (this.#center.x - xRange + this.#world.width()) % this.#world.width(),\n      xUpperBound = (this.#center.x + xRange) % this.#world.width(),\n      yLowerBound =\n        (this.#center.y - yRange + this.#world.height()) % this.#world.height(),\n      yUpperBound = (this.#center.y + yRange) % this.#world.height();\n\n    return [xLowerBound, xUpperBound, yLowerBound, yUpperBound];\n  }\n\n  public visibleRange(): [Coordinate, Coordinate] {\n    const xRange = Math.floor(\n        this.#canvas.width / this.#layers[0].tileSize() / this.#scale\n      ),\n      yRange = Math.floor(\n        this.#canvas.height / this.#layers[0].tileSize() / this.#scale\n      );\n\n    return [\n      { x: this.#center.x - xRange, y: this.#center.y - yRange },\n      { x: this.#center.x + xRange, y: this.#center.y + yRange },\n    ];\n  }\n\n  public world(): World {\n    return this.#world;\n  }\n}\n\nexport default Portal;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    const adjoining = this.filterNeighbours(\n      tile,\n      (adjoiningTile: Tile): boolean =>\n        (tile.terrain._ === 'River' && adjoiningTile.isWater) ||\n        tile.terrain._ === adjoiningTile.terrain._\n    ).join('');\n\n    // Ocean is covered with the land/ocean stuff above and if we re-do here, we lose the coastline\n    if (tile.terrain._ !== 'Ocean') {\n      if (adjoining) {\n        this.drawImage(\n          `terrain/${tile.terrain._.toLowerCase()}_${adjoining}`,\n          x,\n          y\n        );\n      } else {\n        this.drawImage(`terrain/${tile.terrain._.toLowerCase()}`, x, y);\n      }\n    }\n  }\n}\n\nexport default Terrain;\n", "import { NeighbourDirection, Tile, World as WorldData } from '../types';\n\nexport class World {\n  #unknown = (x: number, y: number): Tile => ({\n    _: 'Tile',\n    id: `Tile-${x}--${y}`,\n    city: null,\n    goodyHut: null,\n    improvements: [],\n    isCoast: false,\n    isLand: false,\n    isWater: false,\n    terrain: {\n      _: 'Unknown',\n      id: `UnknownTerrain-${x}--${y}`,\n      features: [],\n    },\n    units: [],\n    x,\n    y,\n    yields: [],\n  });\n  #lookupCache: { [key: string]: number } = {};\n  #tiles: Tile[];\n  #height: number;\n  #width: number;\n\n  constructor(world: WorldData) {\n    this.#height = world.height;\n    this.#width = world.width;\n    this.#tiles = world.tiles || [];\n  }\n\n  get(x: number, y: number): Tile {\n    while (x < 0) {\n      x += this.#width;\n    }\n\n    while (y < 0) {\n      y += this.#height;\n    }\n\n    while (x >= this.#width) {\n      x -= this.#width;\n    }\n\n    while (y >= this.#height) {\n      y -= this.#height;\n    }\n\n    const key = [x, y].toString();\n\n    if (!(key in this.#lookupCache)) {\n      const index = this.#tiles.findIndex(\n        (tile) => tile.x === x && tile.y === y\n      );\n\n      if (index === -1) {\n        return this.#unknown(x, y);\n      }\n\n      this.#lookupCache[key] = index;\n    }\n\n    return this.#tiles[this.#lookupCache[key]];\n  }\n\n  getNeighbour(tile: Tile, direction: NeighbourDirection): Tile {\n    if (direction === 'n') {\n      return this.get(tile.x, tile.y - 1);\n    }\n\n    if (direction === 'ne') {\n      return this.get(tile.x + 1, tile.y - 1);\n    }\n\n    if (direction === 'e') {\n      return this.get(tile.x + 1, tile.y);\n    }\n\n    if (direction === 'se') {\n      return this.get(tile.x + 1, tile.y + 1);\n    }\n\n    if (direction === 's') {\n      return this.get(tile.x, tile.y + 1);\n    }\n\n    if (direction === 'sw') {\n      return this.get(tile.x - 1, tile.y + 1);\n    }\n\n    if (direction === 'w') {\n      return this.get(tile.x - 1, tile.y);\n    }\n\n    if (direction === 'nw') {\n      return this.get(tile.x - 1, tile.y - 1);\n    }\n\n    throw new TypeError('Invalid direction.');\n  }\n\n  height(): number {\n    return this.#height;\n  }\n\n  tiles(): Tile[] {\n    return this.#tiles;\n  }\n\n  width(): number {\n    return this.#width;\n  }\n\n  setTiles(tiles: Tile[]): void {\n    this.#tiles = tiles;\n  }\n}\n\nexport default World;\n", "import Map from '../Map';\nimport { Tile } from '../../types';\n\nexport class Yields extends Map {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      total = tile.yields.reduce(\n        (total, tileYield) => total + tileYield.value,\n        0\n      ),\n      // TODO: use a more effective sort than this, this only works by luck (Food -> Production -> Trade)\n      yields = tile.yields.sort(\n        (a, b) => a._.charCodeAt(0) - b._.charCodeAt(0)\n      );\n\n    let i = 0;\n\n    if (total < 5) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 2, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 2, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            ...offsets[i++]\n          );\n        }\n      });\n\n      return;\n    }\n\n    if (total < 7) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 3, offsetY],\n        [offsetX + (size / 3) * 2, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 3, offsetY + size / 2],\n        [offsetX + (size / 3) * 2, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            offsets[i][0],\n            offsets[i++][1]\n          );\n        }\n      });\n\n      return;\n    }\n\n    if (total < 9) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 4, offsetY],\n        [offsetX + (size / 4) * 2, offsetY],\n        [offsetX + (size / 4) * 3, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 4, offsetY + size / 2],\n        [offsetX + (size / 4) * 2, offsetY + size / 2],\n        [offsetX + (size / 4) * 3, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            ...offsets[i++]\n          );\n        }\n      });\n\n      return;\n    }\n\n    if (total < 11) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 5, offsetY],\n        [offsetX + (size / 5) * 2, offsetY],\n        [offsetX + (size / 5) * 3, offsetY],\n        [offsetX + (size / 5) * 4, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 5, offsetY + size / 2],\n        [offsetX + (size / 5) * 2, offsetY + size / 2],\n        [offsetX + (size / 5) * 3, offsetY + size / 2],\n        [offsetX + (size / 5) * 4, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            ...offsets[i++]\n          );\n        }\n      });\n\n      return;\n    }\n\n    const offsets: [number, number][] = [\n      [offsetX, offsetY],\n      [offsetX + size / 6, offsetY],\n      [offsetX + (size / 6) * 2, offsetY],\n      [offsetX + (size / 6) * 3, offsetY],\n      [offsetX + (size / 6) * 4, offsetY],\n      [offsetX + (size / 6) * 5, offsetY],\n      [offsetX, offsetY + size / 2],\n      [offsetX + size / 6, offsetY + size / 2],\n      [offsetX + (size / 6) * 2, offsetY + size / 2],\n      [offsetX + (size / 6) * 3, offsetY + size / 2],\n      [offsetX + (size / 6) * 4, offsetY + size / 2],\n      [offsetX + (size / 6) * 5, offsetY + size / 2],\n    ];\n\n    yields.forEach((tileYield) => {\n      for (let n = 0; n < tileYield.value; n++) {\n        this.putImage(\n          this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n          ...offsets[i++]\n        );\n      }\n    });\n  }\n}\nexport default Yields;\n", "import { Unit } from '../types';\nimport getPreloadedImage from './getPreloadedImage';\nimport replaceColours from './replaceColours';\n\nconst busyLookup: { [key: string]: string } = {\n  BuildingIrrigation: 'I',\n  BuildingMine: 'M',\n  BuildingRoad: 'R',\n  BuildingRailroad: 'RR',\n  // 'ClearingForest': 'CF',\n  // 'ClearingJungle': 'CJ',\n  // 'ClearingSwamp': 'CS',\n  // 'Fortifying': 'F',\n  // 'Sleeping': 'S',\n  // 'PlantingForest': 'PF',\n};\n\nexport const renderUnit = (\n  unit: Unit,\n  // scale: number = 2,\n  tileSize: number = 16\n): CanvasImageSource => {\n  const player = unit.player,\n    civilization = player.civilization,\n    [colors] = civilization.attributes.filter(\n      (attribute) => attribute.name === 'colors'\n    ),\n    unitCanvas = replaceColours(\n      getPreloadedImage(`units/${unit._.toLowerCase()}`),\n      // To come from theme manifest\n      ['#60E064', '#2C7800'],\n      colors.value\n    ),\n    context = unitCanvas.getContext('2d')!;\n\n  context.imageSmoothingEnabled = false;\n\n  if (unit.improvements?.some((improvement) => improvement._ === 'Fortified')) {\n    context.drawImage(getPreloadedImage('map/fortify'), 0, 0);\n  }\n\n  if (unit.busy) {\n    // if (unit.busy._ === 'Sleeping') {} // TODO: fade the unit like in Civ 1\n    const sizeOffsetX = tileSize / 2,\n      sizeOffsetY = tileSize * 0.75,\n      identifier =\n        busyLookup[unit.busy._] ?? unit.busy._.replace(/[a-z]+/g, '');\n\n    context.font = `bold 8px sans-serif`;\n    context.fillStyle = 'black';\n    context.textAlign = 'center';\n    context.fillText(identifier, sizeOffsetX, sizeOffsetY);\n    context.fillStyle = 'white';\n    context.fillText(identifier, sizeOffsetX, sizeOffsetY);\n  }\n\n  return unitCanvas;\n};\n\nexport default renderUnit;\n", "import Element from './Element';\nimport { Unit as UnitData } from '../types';\nimport { e } from '../lib/html';\nimport renderUnit from '../lib/renderUnit';\n\nexport class Unit extends Element {\n  #scale: number = 2;\n\n  constructor(unit: UnitData, scale: number = 2) {\n    super(e('canvas[width=\"32\"][height=\"32\"]'));\n\n    this.#scale = scale;\n\n    this.build(unit);\n  }\n\n  build(unit: UnitData) {\n    const unitCanvas = renderUnit(unit);\n    const context = this.element().getContext('2d')!;\n    context.imageSmoothingEnabled = false;\n\n    const sizeX = this.size(unitCanvas.width as number),\n      sizeY = this.size(unitCanvas.height as number);\n\n    const offsetX = Math.floor((this.size(16) - sizeX) / 2),\n      offsetY = Math.floor((this.size(16) - sizeY) / 2);\n\n    context.drawImage(unitCanvas, offsetX, offsetY, sizeX, sizeY);\n  }\n\n  element(): HTMLCanvasElement {\n    return super.element() as HTMLCanvasElement;\n  }\n\n  size(size: number = 16): number {\n    return size * this.#scale;\n  }\n}\n\nexport default Unit;\n", "import {\n  City as CityData,\n  CityGrowth,\n  CityImprovementMaintenanceGold,\n  MilitaryUnhappiness,\n  PlainObject,\n  Unit as UnitData,\n  UnitSupportFood,\n  UnitSupportProduction,\n  Yield,\n} from '../types';\nimport { e, h, t } from '../lib/html';\nimport { knownGroupLookup, knownGroups, knownIcons } from '../lib/yieldMap';\nimport Cities from './Map/Cities';\nimport CityBuildSelectionWindow from './CityBuildSelectionWindow';\nimport ConfirmationWindow from './ConfirmationWindow';\nimport DataObserver from '../DataObserver';\nimport Feature from './Map/Feature';\nimport Fog from './Map/Fog';\nimport Improvements from './Map/Improvements';\nimport InactiveUnitSelectionWindow from './InactiveUnitSelectionWindow';\nimport Irrigation from './Map/Irrigation';\nimport Land from './Map/Land';\nimport Portal from './Portal';\nimport Terrain from './Map/Terrain';\nimport Transport from '../../Engine/Transport';\nimport Window from './Window';\nimport World from './World';\nimport Yields from './Map/Yields';\nimport Unit from './Unit';\nimport { assetStore } from '../AssetStore';\n\nconst buildTurns = (city: CityData) =>\n    Math.max(\n      1,\n      Math.ceil(\n        (city.build.cost.value - city.build.progress.value) /\n          city.yields\n            .filter((cityYield) =>\n              knownGroupLookup.Production.includes(cityYield._)\n            )\n            .reduce((total, cityYield) => total + cityYield.value, 0)\n      )\n    ),\n  growthTurns = (city: CityData) =>\n    Math.max(\n      1,\n      Math.ceil(\n        (city.growth.cost.value - city.growth.progress.value) /\n          city.yields\n            .filter((cityYield) => knownGroupLookup.Food.includes(cityYield._))\n            .reduce((total, cityYield) => total + cityYield.value, 0)\n      )\n    ),\n  renderPopulation = (city: CityData): Node => {\n    const growth = city.growth,\n      mask = parseInt(city.name.replace(/[^a-z]/gi, ''), 36).toString(2);\n\n    let [happiness, unhappiness] = city.yields.reduce(\n      ([happiness, unhappiness], cityYield) => {\n        if (knownGroupLookup.Happiness.includes(cityYield._)) {\n          happiness += cityYield.value;\n        }\n\n        if (knownGroupLookup.Unhappiness.includes(cityYield._)) {\n          unhappiness += cityYield.value;\n        }\n\n        return [happiness, unhappiness];\n      },\n      [0, 0]\n    );\n\n    const state = new Array(growth.size).fill(1);\n\n    let currentIndex = state.length - 1;\n\n    while (unhappiness > 0 && currentIndex > -1) {\n      state[currentIndex--] = 0;\n      unhappiness--;\n    }\n\n    currentIndex = 0;\n\n    while (happiness > 0 && currentIndex < state.length) {\n      if (state[currentIndex] === 0) {\n        state[currentIndex]++;\n        happiness--;\n      }\n\n      if (state[currentIndex] === 1) {\n        state[currentIndex++]++;\n        happiness--;\n      }\n\n      if (state[currentIndex] === 2) {\n        currentIndex++;\n      }\n    }\n\n    const population = e('div.population');\n\n    state.forEach((status, index) =>\n      assetStore\n        .getScaled(\n          `./assets/city/people_${['unhappy', 'content', 'happy'][status]}_${\n            ['f', 'm'][parseInt(mask[index % mask.length], 10)]\n          }.png`,\n          2\n        )\n        .then((image) =>\n          population.append(\n            e('span.citizen', e(`img[src=\"${image.toDataURL('image/png')}\"]`))\n          )\n        )\n    );\n\n    return population;\n  },\n  reduceYield = (type: string, cityYields: Yield[]): [number, number] =>\n    cityYields\n      .filter((cityYield) => knownGroupLookup[type].includes(cityYield._))\n      .reduce(\n        ([used, free], cityYield) => [\n          used + (cityYield.value < 0 ? -cityYield.value : 0),\n          free + cityYield.value,\n        ],\n        [0, 0]\n      ),\n  renderYields = (city: CityData): Node => {\n    return e(\n      'div.yields-detail',\n      ...[\n        ['Food'],\n        ['Production'],\n        ['Trade'],\n        ['Luxuries', 'Gold', 'Research'],\n      ].map((cityYieldNames) =>\n        e(\n          `div.yields[data-yields=\"${cityYieldNames.join(' ')}\"]`,\n          ...cityYieldNames.map((cityYieldName) =>\n            e(\n              `span.yield[data-yield=\"${cityYieldName}\"]`,\n              ...reduceYield(cityYieldName, city.yields).map((n, i) =>\n                e(\n                  `span.${['used', 'free'][i]}`,\n                  ...yieldImages({\n                    id: '',\n                    _: cityYieldName,\n                    value: n,\n                    values: [],\n                  })\n                )\n              )\n            )\n          )\n        )\n      ),\n      // Other, unknown yields\n      ...Object.entries(\n        city.yields\n          .filter(\n            (cityYield) => !Object.keys(knownGroups).includes(cityYield._)\n          )\n          .reduce((yieldObject, cityYield) => {\n            if (!(cityYield._ in yieldObject)) {\n              yieldObject[cityYield._] = 0;\n            }\n\n            yieldObject[cityYield._] += cityYield.value;\n\n            return yieldObject;\n          }, {} as PlainObject)\n      ).map(([label, value]) =>\n        e('div', e('div', t(label)), e('div', t(value)))\n      )\n    );\n  },\n  renderMap = (portal: Portal, city: CityData, transport: Transport): Node => {\n    const portalCanvas = e('canvas') as HTMLCanvasElement,\n      cityPortal = new Portal(\n        new World(city.player.world),\n        transport,\n        portalCanvas,\n        {\n          playerId: city.player.id,\n          scale: portal.scale(),\n          tileSize: portal.tileSize(),\n        },\n        Land,\n        Irrigation,\n        Terrain,\n        Improvements,\n        Feature,\n        Fog,\n        Cities,\n        Yields\n      );\n\n    portalCanvas.height = portal.tileSize() * portal.scale() * 5;\n    portalCanvas.width = portal.tileSize() * portal.scale() * 5;\n\n    cityPortal.setCenter(city.tile.x, city.tile.y);\n    cityPortal.build(city.tiles);\n\n    const yieldMap = cityPortal.getLayer(Yields) as Yields;\n    yieldMap.render(city.tilesWorked);\n\n    cityPortal.render();\n\n    return h(e('div.city-map', portalCanvas), {\n      click: () =>\n        transport.send('action', {\n          name: 'ReassignWorkers',\n          city: city.id,\n        }),\n    });\n  },\n  yieldImages = (cityYield: Yield): Node[] =>\n    new Array(Math.abs(cityYield.value)).fill(0).map(() => {\n      const icon = e('span.yield-icon');\n\n      assetStore\n        .getScaled(`./assets/${knownIcons[knownGroups[cityYield._]]}`, 2)\n        .then((image) => {\n          icon.append(e(`img[src=\"${image.toDataURL('image/png')}\"]`));\n        });\n\n      return icon;\n    }),\n  renderBuildDetails = (\n    city: CityData,\n    chooseProduction: () => void,\n    completeProduction: () => void\n  ): HTMLElement => {\n    const turnsLeft = buildTurns(city);\n\n    return e(\n      'div.build',\n      e(\n        'header',\n        t(\n          `Building ${\n            city.build.building ? city.build.building.item._ : 'nothing'\n          }`\n        )\n      ),\n      h(e('button', t(city.build.building ? 'Change' : 'Choose')), {\n        click() {\n          chooseProduction();\n        },\n      }),\n      h(e('button', t('Buy')), {\n        click() {\n          completeProduction();\n        },\n      }),\n      city.build.building\n        ? e(\n            'p',\n            t(\n              `Progress ${city.build.progress.value} / ${\n                city.build.cost.value\n              } (${turnsLeft} turn${turnsLeft === 1 ? '' : 's'})`\n            )\n          )\n        : t('')\n    );\n  },\n  renderGrowth = (city: CityData): Node => {\n    const growth: CityGrowth = city.growth,\n      turnsLeft = growthTurns(city);\n\n    return e(\n      'div.growth',\n      e('header', t('Growth')),\n      e('p', t(`Size ${growth.size.toString()}`)),\n      e(\n        'p',\n        t(\n          `Progress ${city.build.progress.value} / ${\n            city.build.cost.value\n          } (${turnsLeft} turn${turnsLeft === 1 ? '' : 's'})`\n        )\n      )\n    );\n  },\n  renderImprovements = (city: CityData): Node => {\n    return e(\n      'div.improvements',\n      e(\n        'div',\n        ...city.improvements.map((improvement) =>\n          e(\n            'div',\n            t(improvement._),\n            ...city.yields\n              .filter(\n                (cityYield): cityYield is CityImprovementMaintenanceGold =>\n                  cityYield._ === 'CityImprovementMaintenanceGold'\n              )\n              .filter(\n                (cityYield) => cityYield.cityImprovement.id === improvement.id\n              )\n              .flatMap((cityYield) => yieldImages(cityYield))\n          )\n        )\n      )\n    );\n  },\n  renderGarrisonedUnits = (city: CityData, transport: Transport): Node => {\n    return h(\n      e(\n        'div.garrisoned-units',\n        e('header', t('Garrisoned Units')),\n        e(\n          'div.units',\n          ...city.tile.units.map((unit) => new Unit(unit).element())\n        )\n      ),\n      {\n        click() {\n          const cityPlayerUnits = city.tile.units.filter(\n            (unit: UnitData) => unit.player.id === city.player.id\n          );\n\n          if (cityPlayerUnits.length === 0) {\n            return;\n          }\n\n          new InactiveUnitSelectionWindow(cityPlayerUnits, transport);\n        },\n      }\n    );\n  },\n  renderSupportedUnits = (city: CityData): Node => {\n    return e(\n      'div.supported-units',\n      e('header', t('Supported Units')),\n      e(\n        'div.units',\n        ...city.units.map((unit) =>\n          e(\n            'span.unit',\n            new Unit(unit).element(),\n            ...city.yields\n              .filter(\n                (\n                  cityYield\n                ): cityYield is\n                  | UnitSupportFood\n                  | UnitSupportProduction\n                  | MilitaryUnhappiness =>\n                  [\n                    'UnitSupportFood',\n                    'UnitSupportProduction',\n                    'MilitaryUnhappiness',\n                  ].includes(cityYield._)\n              )\n              .filter((cityYield) => cityYield.unit.id === unit.id)\n              .flatMap((cityYield) => yieldImages(cityYield))\n          )\n        )\n      )\n    );\n  },\n  buildDetails = (\n    city: CityData,\n    portal: Portal,\n    transport: Transport,\n    chooseProduction: () => void,\n    completeProduction: () => void\n  ) => {\n    return e(\n      'div.city-screen',\n      e(\n        'div.top-row',\n        e(\n          'div.yield-details',\n          renderPopulation(city),\n          renderYields(city),\n          renderSupportedUnits(city)\n        ),\n        renderMap(portal, city, transport),\n        renderImprovements(city)\n      ),\n      e(\n        'div.bottom-row',\n        renderGrowth(city),\n        e(\n          'div.tabbed-details',\n          // TODO: add a tab bar\n          e('div.info', renderGarrisonedUnits(city, transport))\n        ),\n        renderBuildDetails(city, chooseProduction, completeProduction)\n      )\n    );\n  };\n\nexport class City extends Window {\n  #city: CityData;\n  #dataObserver: DataObserver;\n  #portal: Portal;\n  #transport: Transport;\n\n  constructor(city: CityData, portal: Portal, transport: Transport) {\n    super(\n      city.name,\n      buildDetails(\n        city,\n        portal,\n        transport,\n        () => this.changeProduction(),\n        () => this.completeProduction()\n      ),\n      {\n        size: 'maximised',\n      }\n    );\n\n    this.element().classList.add('city-screen-window');\n\n    this.#city = city;\n    this.#portal = portal;\n    this.#transport = transport;\n    this.#dataObserver = new DataObserver(\n      [\n        city.id,\n        city.build.id,\n        city.growth.id,\n        ...city.units.map((unit) => unit.id),\n      ],\n      (data: PlainObject) => {\n        const [updatedCity] = (\n          (data.player?.cities ?? []) as CityData[]\n        ).filter((cityData: CityData) => city.id === cityData.id);\n\n        // City must have been captured or destroyed\n        if (!updatedCity) {\n          this.close();\n\n          return;\n        }\n\n        this.#city = updatedCity;\n\n        this.#dataObserver.setIds([\n          updatedCity.id,\n          updatedCity.build.id,\n          updatedCity.growth.id,\n          ...updatedCity.units.map((unit) => unit.id),\n        ]);\n\n        this.update(\n          buildDetails(\n            updatedCity,\n            this.#portal,\n            transport,\n            () => this.changeProduction(),\n            () => this.completeProduction()\n          )\n        );\n\n        this.element().focus();\n      }\n    );\n\n    this.element().addEventListener('keydown', (event) => {\n      if (['c', 'C'].includes(event.key)) {\n        this.changeProduction();\n\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      if (['b', 'B'].includes(event.key)) {\n        this.completeProduction();\n\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      if (['Enter', 'x', 'X'].includes(event.key)) {\n        this.close();\n      }\n    });\n  }\n\n  changeProduction(): void {\n    new CityBuildSelectionWindow(this.#city.build, this.#transport, () =>\n      this.element().focus()\n    );\n  }\n\n  close(): void {\n    this.#dataObserver.dispose();\n\n    super.close();\n  }\n\n  completeProduction(): void {\n    if (!this.#city.build.building) {\n      return;\n    }\n\n    new ConfirmationWindow(\n      'Are you sure?',\n      `Do you want to rush building of ${this.#city.build.building.item._}`,\n      () =>\n        this.#transport.send('action', {\n          name: 'CompleteProduction',\n          id: this.#city.id,\n        })\n    );\n  }\n}\n\nexport default City;\n", "import { BuildItem, City as CityData, CityBuild } from '../types';\nimport { SelectionWindow, SelectionWindowActions } from './SelectionWindow';\nimport City from './City';\nimport Portal from './Portal';\nimport Transport from '../../Engine/Transport';\n\ntype onCompleteHandler = (hasSelected: boolean, ...args: any[]) => void;\n\nexport class CityBuildSelectionWindow extends SelectionWindow {\n  #onComplete: onCompleteHandler;\n  #transport: Transport;\n\n  public static showCityAction = (\n    city: CityData,\n    portal: Portal,\n    transport: Transport\n  ) => ({\n    label: 'View city',\n    action(selectionWindow: SelectionWindow) {\n      selectionWindow.close();\n\n      new City(city, portal, transport);\n    },\n  });\n  public static showCityOnMapAction = (city: CityData, portal: Portal) => ({\n    label: 'Show on map',\n    action(selectionWindow: SelectionWindow) {\n      selectionWindow.close();\n\n      portal.setCenter(city.tile.x, city.tile.y);\n    },\n  });\n\n  constructor(\n    cityBuild: CityBuild,\n    transport: Transport,\n    onComplete: onCompleteHandler = () => {},\n    additionalActions: SelectionWindowActions = {}\n  ) {\n    const production = cityBuild.city.yields\n        .filter((cityYield) => cityYield._ === 'Production')\n        .reduce((total, cityYield) => total + cityYield.value, 0),\n      turns = (buildItem: BuildItem) =>\n        Math.ceil(\n          (buildItem.cost.value - cityBuild.progress.value) / production\n        );\n\n    super(\n      `What would you like to build in ${cityBuild.city.name}?`,\n      cityBuild.available.map((buildItem) => ({\n        label: `${buildItem.item._} (Cost: ${buildItem.cost.value} / ${turns(\n          buildItem\n        )} turn${turns(buildItem) === 1 ? '' : 's'})`,\n        value: buildItem.item._,\n      })),\n      (selection) => {\n        if (!selection) {\n          return;\n        }\n\n        transport.send('action', {\n          name: cityBuild.building === null ? 'CityBuild' : 'ChangeProduction',\n          id: cityBuild.id,\n          chosen: selection ? selection : '@',\n        });\n\n        this.close(true);\n      },\n      null,\n      {\n        actions: additionalActions,\n        displayAll: true,\n      }\n    );\n\n    this.#onComplete = onComplete;\n    this.#transport = transport;\n  }\n\n  close(hasSelected: boolean = false): void {\n    super.close();\n\n    if (hasSelected) {\n      this.#onComplete(hasSelected);\n    }\n  }\n}\n\nexport default CityBuildSelectionWindow;\n", "import { CityBuild as CityBuildObject, PlayerAction } from '../../types';\nimport { e, h } from '../../lib/html';\nimport Action from './Action';\nimport CityBuildSelectionWindow from '../CityBuildSelectionWindow';\nimport Portal from '../Portal';\nimport Transport from '../../../Engine/Transport';\nimport { assetStore } from '../../AssetStore';\n\nexport class CityBuild extends Action {\n  #portal: Portal;\n\n  constructor(action: PlayerAction, portal: Portal, transport: Transport) {\n    super(action, transport);\n\n    this.#portal = portal;\n  }\n\n  public activate(): void {\n    new CityBuildSelectionWindow(\n      this.value(),\n      this.transport(),\n      () => this.complete(),\n      {\n        showCity: CityBuildSelectionWindow.showCityAction(\n          this.value().city,\n          this.#portal,\n          this.transport()\n        ),\n        showCityOnMap: CityBuildSelectionWindow.showCityOnMapAction(\n          this.value().city,\n          this.#portal\n        ),\n      }\n    );\n  }\n\n  build(): void {\n    const cityBuild = this.value();\n\n    assetStore\n      .get('./assets/city/production.png')\n      .then((asset) =>\n        this.element().append(\n          e(\n            `button.cityBuild[title=\"What would you like to build in ${\n              cityBuild.city.name\n            }?\"][style=\"background-image:url('${asset!.uri}')\"]`\n          )\n        )\n      );\n  }\n\n  value(): CityBuildObject {\n    return super.value() as CityBuildObject;\n  }\n}\n\nexport default CityBuild;\n", "import Action from './Action';\nimport { e } from '../../lib/html';\n\nexport class EndTurn extends Action {\n  activate(): void {\n    this.transport().send('action', {\n      name: 'EndTurn',\n    });\n  }\n\n  build(): void {\n    this.element().append(e(`button.endTurn[title=\"End turn\"]`));\n  }\n}\n\nexport default EndTurn;\n", "import Action from './Action';\nimport { PlayerGovernment } from '../../types';\nimport SelectionWindow from '../SelectionWindow';\nimport { e } from '../../lib/html';\nimport { assetStore } from '../../AssetStore';\n\nexport class Revolution extends Action {\n  public activate(): void {\n    const chooseWindow = new SelectionWindow(\n      'Choose government',\n      this.value().available.map((government) => ({\n        value: government._,\n      })),\n      (selection) => {\n        if (!selection) {\n          return;\n        }\n\n        this.transport().send('action', {\n          name: 'Revolution',\n          id: this.value().id,\n          chosen: selection ? selection : '@',\n        });\n\n        this.complete();\n\n        chooseWindow.close();\n      },\n      'Which government would you like to convert to?',\n      {\n        displayAll: true,\n      }\n    );\n  }\n\n  build(): void {\n    assetStore\n      .get('./assets/city/sad.png')\n      .then((asset) =>\n        this.element().append(\n          e(\n            `button.chooseGovernment[title=\"Choose government\"][style=\"background-image:url('${\n              asset!.uri\n            }')\"]`\n          )\n        )\n      );\n  }\n\n  value(): PlayerGovernment {\n    return super.value() as PlayerGovernment;\n  }\n}\n\nexport default Revolution;\n", "import { Element, IElement } from './Element';\nimport { e, h } from '../lib/html';\nimport Action from './Actions/Action';\nimport AdjustTradeRates from './Actions/AdjustTradeRates';\nimport ChooseResearch from './Actions/ChooseResearch';\nimport CityBuild from './Actions/CityBuild';\nimport EndTurn from './Actions/EndTurn';\nimport { PlayerAction } from '../types';\nimport Portal from './Portal';\nimport Revolution from './Actions/Revolution';\nimport Transport from '../../Engine/Transport';\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    actioned: CustomEvent<Action>;\n  }\n}\n\nexport interface IActions extends IElement {\n  build(mandatoryActions: PlayerAction[], actions: PlayerAction[]): void;\n}\n\nexport class Actions extends Element implements IActions {\n  #portal: Portal;\n  #transport: Transport;\n\n  constructor(\n    container: HTMLElement = e('div.actions'),\n    portal: Portal,\n    transport: Transport\n  ) {\n    super(container);\n\n    this.#portal = portal;\n    this.#transport = transport;\n\n    this.element().addEventListener('actioned', (event) =>\n      event.detail.element().remove()\n    );\n\n    this.element().addEventListener(\n      'keydown',\n      (event) => {\n        const currentChild = document.activeElement;\n\n        if (!this.element().contains(currentChild)) {\n          return;\n        }\n\n        const { key } = event,\n          children = Array.from(this.element().children) as HTMLElement[];\n\n        if (\n          !['ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowUp'].includes(key) ||\n          children.length === 0\n        ) {\n          return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        let currentAction =\n          currentChild === this.element()\n            ? ['ArrowLeft', 'ArrowUp'].includes(key)\n              ? (currentChild.firstElementChild as HTMLElement)\n              : (currentChild.lastElementChild as HTMLElement)\n            : (currentChild as HTMLElement);\n\n        while (currentAction.parentElement !== this.element()) {\n          currentAction = currentAction.parentElement as HTMLElement;\n        }\n\n        const currentIndex = children.indexOf(currentAction);\n\n        if (['ArrowUp', 'ArrowLeft'].includes(key)) {\n          if (currentIndex > 0) {\n            children[currentIndex - 1].querySelector('button')?.focus();\n\n            return;\n          }\n\n          children.pop()!.querySelector('button')!.focus();\n\n          return;\n        }\n\n        if (['ArrowDown', 'ArrowRight'].includes(key)) {\n          if (currentIndex < children.length - 1) {\n            children[currentIndex + 1]!.querySelector('button')!.focus();\n\n            return;\n          }\n\n          children.shift()!.querySelector('button')!.focus();\n\n          return;\n        }\n      },\n      true\n    );\n  }\n\n  build(actions: PlayerAction[]): void {\n    this.empty();\n\n    actions.forEach((playerAction) => {\n      let action: Action;\n\n      switch (playerAction._) {\n        // This is handled separately so no need to worry.\n        case 'ActiveUnit':\n          return;\n\n        case 'AdjustTradeRates':\n          action = new AdjustTradeRates(playerAction, this.#transport);\n\n          break;\n\n        case 'ChooseResearch':\n          action = new ChooseResearch(playerAction, this.#transport);\n\n          break;\n\n        case 'CityBuild':\n          action = new CityBuild(playerAction, this.#portal, this.#transport);\n\n          break;\n\n        case 'EndTurn':\n          action = new EndTurn(playerAction, this.#transport);\n\n          break;\n\n        case 'Revolution':\n          action = new Revolution(playerAction, this.#transport);\n\n          break;\n\n        default:\n          console.log('need to handle ' + playerAction._);\n          return;\n        // throw new TypeError(`Unknown action type '${action._}'.`);\n      }\n\n      this.element().prepend(\n        h(action.element(), {\n          click: () => action.activate(),\n          keydown: ({ key }) => {\n            if (key === ' ' || key === 'Enter') {\n              action.activate();\n            }\n          },\n        })\n      );\n    });\n  }\n}\n\nexport default Actions;\n", "import { Tile, Unit } from '../../types';\nimport { Map, IMap } from '../Map';\nimport renderUnit from '../../lib/renderUnit';\n\nexport class Units extends Map implements IMap {\n  #activeUnit: Unit | null = null;\n\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    if (\n      tile.units.length > 0 &&\n      (this.#activeUnit !== null ? this.#activeUnit.tile.id !== tile.id : true)\n    ) {\n      const [unit] = tile.units.sort(\n          (a: Unit, b: Unit): number => b.defence?.value - a.defence?.value\n        ),\n        image = this.renderUnit(unit);\n\n      if (tile.units.length > 1) {\n        this.putImage(image, offsetX - this.scale(), offsetY - this.scale());\n      }\n\n      this.putImage(image, offsetX, offsetY);\n    }\n  }\n\n  protected renderUnit(unit: Unit): CanvasImageSource {\n    return renderUnit(unit);\n  }\n\n  setActiveUnit(unit: Unit | null): void {\n    this.#activeUnit = unit;\n  }\n\n  protected activeUnit(): Unit | null {\n    return this.#activeUnit;\n  }\n}\n\nexport default Units;\n", "import { IMap } from '../Map';\nimport Units from './Units';\n\nexport class ActiveUnit extends Units implements IMap {\n  render(): void {\n    this.clear();\n\n    const activeUnit = this.activeUnit();\n\n    if (activeUnit === null) {\n      return;\n    }\n\n    const { x, y } = activeUnit.tile,\n      tile = this.world().get(x, y),\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      image = this.renderUnit(activeUnit);\n\n    if (tile.units.length > 1) {\n      this.putImage(image, offsetX - this.scale(), offsetY - this.scale());\n    }\n\n    this.putImage(image, offsetX, offsetY);\n  }\n\n  update(): void {\n    this.render();\n  }\n}\n\nexport default ActiveUnit;\n", "import { Tile } from '../../types';\nimport { Map } from '../Map';\n\nexport class CityNames extends Map {\n  renderTile(tile: Tile): void {\n    if (!tile.city) {\n      return;\n    }\n\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      city = tile.city,\n      sizeOffsetX = this.tileSize() / 2,\n      sizeOffsetY = this.tileSize() * 0.75,\n      textOffsetX = this.tileSize() / 2,\n      textOffsetY = this.tileSize() * 1.6;\n\n    this.context().font = `bold ${8 * this.scale()}px sans-serif`;\n    this.context().fillStyle = 'black';\n    this.context().textAlign = 'center';\n    this.context().fillText(\n      city.growth.size.toString(),\n      offsetX + sizeOffsetX + this.scale(),\n      offsetY + sizeOffsetY\n    );\n    this.context().fillText(\n      city.name,\n      offsetX + textOffsetX + this.scale(),\n      offsetY + textOffsetY\n    );\n    this.context().fillStyle = 'white';\n    this.context().fillText(\n      city.growth.size.toString(),\n      offsetX + sizeOffsetX,\n      offsetY + sizeOffsetY - this.scale()\n    );\n    this.context().fillText(\n      city.name,\n      offsetX + textOffsetX,\n      offsetY + textOffsetY - this.scale()\n    );\n  }\n\n  update(): void {\n    this.clear();\n\n    // TODO: Could be a little smarter about this...\n    this.world()\n      .tiles()\n      .filter((tile) => !!tile.city)\n      .forEach((tile) => this.renderTile(tile));\n  }\n}\n\nexport default CityNames;\n", "import { e, t } from '../lib/html';\nimport { Yield } from '../types';\nimport Element from './Element';\n\nexport class GameDetails extends Element {\n  #turn: Yield;\n  #year: Yield;\n\n  constructor(element: HTMLElement, turn: Yield, year: Yield) {\n    super(element);\n\n    this.#turn = turn;\n    this.#year = year;\n  }\n\n  build(): void {\n    this.empty();\n\n    this.element().append(\n      e(\n        'h3',\n        e('span#year', t(this.year())),\n        e('span#turn', t(`(${this.#turn.value.toString()})`))\n      )\n    );\n  }\n\n  year(year = this.#year.value): string {\n    if (year < 0) {\n      return Math.abs(year) + ' BCE';\n    }\n\n    if (year === 0) {\n      return '1 CE';\n    }\n\n    return year + ' CE';\n  }\n}\n\nexport default GameDetails;\n", "import City from './City';\nimport InactiveUnitSelectionWindow from './InactiveUnitSelectionWindow';\nimport Portal from './Portal';\nimport { Unit } from '../types';\n\nexport class GamePortal extends Portal {\n  protected bindEvents(): void {\n    this.canvas().addEventListener('click', (event) => {\n      const currentCenter = this.center();\n\n      let x = event.offsetX,\n        y = event.offsetY;\n\n      x =\n        (x - (this.canvas().width / 2 - this.tileSize())) /\n          (this.tileSize() * this.scale()) +\n        currentCenter.x;\n      y =\n        (y - (this.canvas().height / 2 - this.tileSize())) /\n          (this.tileSize() * this.scale()) +\n        currentCenter.y;\n\n      while (x < 0) {\n        x += this.world().width();\n      }\n\n      while (y < 0) {\n        y += this.world().height();\n      }\n\n      while (x > this.world().width()) {\n        x -= this.world().width();\n      }\n\n      while (y > this.world().height()) {\n        y -= this.world().height();\n      }\n\n      const tile = this.world().get(Math.trunc(x), Math.trunc(y)),\n        playerTileUnits = tile.units.filter(\n          (unit: Unit) => unit.player.id === this.playerId()\n        );\n\n      if (tile.city && tile.city.player.id === this.playerId()) {\n        new City(tile.city, this, this.transport());\n      } else if (playerTileUnits.length) {\n        new InactiveUnitSelectionWindow(\n          playerTileUnits,\n          this.transport(),\n          (unit: Unit) => this.emit('activate-unit', unit)\n        );\n\n        return;\n      }\n\n      this.setCenter(tile.x, tile.y);\n    });\n  }\n}\n\nexport default GamePortal;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    if (tile.goodyHut !== null) {\n      this.drawImage('map/hut', x, y);\n    }\n  }\n}\n\nexport default Terrain;\n", "export interface IIntervalHandler {\n  check(): void;\n  clear(): void;\n  off(handler: () => void): void;\n  on(handler: () => void): void;\n  pause(): void;\n  isPaused(): boolean;\n  resume(): void;\n}\n\nexport class IntervalHandler implements IIntervalHandler {\n  #paused: boolean = false;\n  #stack: (() => void)[] = [];\n\n  constructor(tick: number = 500) {\n    setInterval(() => this.check(), tick);\n  }\n\n  check(): void {\n    if (this.#paused) {\n      return;\n    }\n\n    this.#stack.forEach((item) => item());\n  }\n\n  clear(): void {\n    this.#stack = [];\n  }\n\n  off(handler: () => void): void {\n    this.#stack = this.#stack.filter((item) => item !== handler);\n  }\n\n  on(handler: () => void): void {\n    this.#stack.push(handler);\n  }\n\n  pause(): void {\n    this.#paused = true;\n  }\n\n  isPaused(): boolean {\n    return this.#paused;\n  }\n\n  resume(): void {\n    this.#paused = false;\n  }\n}\n\nexport default IntervalHandler;\n", "export interface RequestInterface<Args extends any[], Return extends any> {\n  args(): Args;\n  channel(): string;\n}\n\nexport type RequestArgs<RequestType extends Request> =\n  RequestType extends Request<infer Args> ? Args : never;\nexport type RequestReturn<RequestType extends Request> =\n  RequestType extends Request<any[], infer Return> ? Return : never;\n\nexport class Request<Args extends any[] = any[], Return extends any = any>\n  implements RequestInterface<Args, Return>\n{\n  #args: Args;\n  #channel: string;\n\n  constructor(channel: string, ...args: Args) {\n    this.#args = args;\n    this.#channel = channel;\n  }\n\n  args(): Args {\n    return this.#args;\n  }\n\n  channel(): string {\n    return this.#channel;\n  }\n}\n\nexport default Request;\n", "import Request from '../Request';\n\nexport class Options<Key extends string> extends Request<\n  [Key[]],\n  Record<Key, any>\n> {\n  constructor(args: Key[]) {\n    super('getOptions', args);\n  }\n}\n\nexport default Options;\n", "import { e, h, t } from '../lib/html';\nimport Options from '../../Engine/Requests/Options';\nimport Request from '../../Engine/Request';\nimport Transport from '../../Engine/Transport';\nimport Window from './Window';\n\ntype FinishedHandler = () => void;\n\nexport class CustomiseWorldWindow extends Window {\n  #onFinished?: FinishedHandler;\n  #transport: Transport;\n\n  constructor(transport: Transport, onFinished?: FinishedHandler) {\n    super('Customise world', e('div.customise-world'));\n\n    this.#onFinished = onFinished;\n    this.#transport = transport;\n\n    this.init();\n  }\n\n  build(): void {\n    super.build();\n\n    this.init();\n  }\n\n  async init(): Promise<void> {\n    const existingValues = await this.#transport.request(\n        new Options([\n          'players',\n          'height',\n          'width',\n          'landCoverage',\n          'landSize',\n          'maxIterations',\n        ])\n      ),\n      playersInput = e<HTMLInputElement>(\n        `input[name=\"players\"][type=\"number\"][value=\"${\n          existingValues.players ?? 7\n        }\"][step=\"1\"][min=\"1\"][max=\"20\"]`\n      ),\n      heightInput = e<HTMLInputElement>(\n        `input[name=\"height\"][type=\"number\"][value=\"${\n          existingValues.height ?? 60\n        }\"][step=\"1\"][min=\"1\"]`\n      ),\n      widthInput = e<HTMLInputElement>(\n        `input[name=\"width\"][type=\"number\"][value=\"${\n          existingValues.width ?? 80\n        }\"][step=\"1\"][min=\"1\"]`\n      ),\n      landCoverageInput = e<HTMLInputElement>(\n        `input[name=\"landCoverage\"][type=\"number\"][value=\"${\n          existingValues.landCoverage ?? 0.4\n        }\"][step=\"0.01\"][min=\"0\"]`\n      ),\n      landSizeInput = e<HTMLInputElement>(\n        `input[name=\"landSize\"][type=\"number\"][value=\"${\n          existingValues.landSize ?? 0.2\n        }\"][step=\"0.01\"][min=\"0\"]`\n      ),\n      maxIterationsInput = e<HTMLInputElement>(\n        `input[name=\"maxIterations\"][type=\"number\"][value=\"${\n          existingValues.maxIterations ?? 20\n        }\"][step=\"1\"][min=\"1\"]`\n      ),\n      submit = async () => {\n        this.close();\n\n        await this.#transport.request(\n          new Request('setOptions', {\n            players: playersInput.value,\n            height: heightInput.value,\n            width: widthInput.value,\n            landCoverage: landCoverageInput.value,\n            landSize: landSizeInput.value,\n            maxIterations: maxIterationsInput.value,\n          })\n        );\n\n        this.#transport.send('start');\n\n        if (this.#onFinished) {\n          this.#onFinished();\n        }\n      };\n\n    this.update(\n      e(\n        'div.customise-world',\n        e('div.option', e('label', t('Players')), playersInput),\n        e('div.option', e('label', t('Height')), heightInput),\n        e('div.option', e('label', t('Width')), widthInput),\n        e('div.option', e('label', t('Land coverage')), landCoverageInput),\n        e('div.option', e('label', t('Land size')), landSizeInput),\n        e('div.option', e('label', t('Max iterations')), maxIterationsInput),\n        h(e('button', t('Build')), {\n          click: () => submit(),\n        })\n      )\n    );\n\n    this.element().addEventListener('keydown', (event) => {\n      if (event.key === 'Enter') {\n        submit();\n      }\n    });\n  }\n}\n\nexport default CustomiseWorldWindow;\n", "export class BinFile {\n  private blob: string | null = null;\n  private ptr: number = -1;\n\n  fromString(content: string, callback: (...args: any[]) => any) {\n    this.blob = content;\n    this.ptr = 0;\n    this.decode(callback);\n  }\n\n  getUByte() {\n    return (this.blob as string).charCodeAt(this.ptr++);\n  }\n\n  getUShort() {\n    const b1 = this.getUByte(),\n      b2 = this.getUByte();\n\n    return (b2 << 8) + b1;\n  }\n\n  getShort() {\n    return ((this.getUShort() + 0x8000) % 0x10000) - 0x8000;\n  }\n\n  getString(length: number) {\n    const start = this.ptr;\n    this.ptr += length;\n\n    return (this.blob as string).substr(start, length);\n  }\n\n  decode(callback: (...args: any[]) => any): void {\n    if (this.blob === null) {\n      console.warn('file has not been loaded!');\n\n      return;\n    }\n\n    console.warn('The decode function should be overwritten');\n    if (callback) callback();\n  }\n}\n\nexport default BinFile;\n", "export class LZWDictionary {\n  private dicTable: number[][] | null[] = [];\n  private dicSize: number;\n  private curPos: number;\n\n  constructor(maxBits: number) {\n    this.dicTable = [];\n    this.dicSize = 0x1 << maxBits;\n\n    for (let i = 0; i < this.dicSize; i++) {\n      if (i < 256) {\n        this.dicTable[i] = [i];\n      } else {\n        this.dicTable[i] = null;\n      }\n    }\n\n    this.curPos = 0x0101;\n  }\n\n  getEntry(pos: number): number[] | null {\n    return pos < this.curPos ? this.dicTable[pos] : null;\n  }\n\n  isFull() {\n    return this.curPos === this.dicTable.length;\n  }\n\n  getCurPos() {\n    return this.curPos;\n  }\n\n  addEntry(entry: number[]) {\n    if (this.curPos < this.dicTable.length) {\n      this.dicTable[this.curPos] = entry;\n      this.curPos++;\n    }\n\n    return this.curPos - 1;\n  }\n}\n\nexport default LZWDictionary;\n", "import LZWDictionary from './LZWDictionary';\n\nexport class LZW {\n  //Extracts a series of integers from the byte array\n  static parseByteStreamToIndexes(\n    binFile: { getUByte: () => number },\n    remainingCodedBytes: number,\n    uByteMode: number\n  ) {\n    const parsedIndexes = []; //ArrayList<Integer> parsedIndexes = new ArrayList<Integer>();\n\n    let usableBits = 0,\n      usableBitCount = 0,\n      indicatorLength = 1 /* to increment with ++; rule is that 8+indicatorLength must be <= uByteMode, otherwise reset */,\n      indicatorFlag = 0x001 /* to increment with <<=1 followed by |= 1 */,\n      nextThreshold = 0x0100 /*256*/ /* to increment with <<=1, or *=2 */,\n      decodedCounter = 0,\n      index = 0;\n\n    while (remainingCodedBytes > 0) {\n      /* get enough coded bits to work with */\n      while (usableBitCount < 8 + indicatorLength) {\n        usableBits |= binFile.getUByte() << usableBitCount;\n        remainingCodedBytes--;\n        usableBitCount += 8;\n      }\n\n      /* decode bytes and indicators */\n      while (usableBitCount >= 8 + indicatorLength) {\n        //Builds out a bit screen that is of size 8 + the number of indicator bits and ors it with current set of usable bits\n        index = usableBits & (((indicatorFlag << 8) & 0xff00) | 0x00ff);\n\n        usableBits >>= 8 + indicatorLength; //Right-shift out the used bits\n        usableBitCount -= 8 + indicatorLength; //Decrement the usableBitCount by the number of bits used\n\n        decodedCounter++; //Keep track of how many things we have decoded to ensure threshold isn't reached\n\n        if (decodedCounter == nextThreshold) {\n          //If threshold is reached...\n          decodedCounter = 0;\n          indicatorLength += 1; // to increment with ++; rule is that 8+indicatorLength must be <= uByteMode, otherwise reset\n          indicatorFlag <<= 1;\n          indicatorFlag |= 1; // left-shift bitmask and add another 1 (e.g. 0001 > 0011 > 0111)\n          nextThreshold <<= 1; //Double the next threshold\n\n          if (8 + indicatorLength > uByteMode) {\n            decodedCounter = 0;\n            indicatorLength = 1;\n            indicatorFlag = 0x001;\n            nextThreshold = 0x0100 /*256*/;\n          }\n        }\n        parsedIndexes.push(index);\n      }\n    }\n\n    return parsedIndexes;\n  }\n\n  //Decodes the integers into byte-level data using a dictionary look-up\n  static decode(inputData: any, dicIndexMaxBits: number) {\n    dicIndexMaxBits = dicIndexMaxBits || 0x0b;\n\n    let codedData = inputData; //stringToNumArray(inputData); //Convert string to an array of numbers\n\n    const decodedData: number[] = [];\n\n    while (codedData.length > 0) {\n      const dic = new LZWDictionary(dicIndexMaxBits),\n        plainData = [codedData[0]];\n\n      let oldCode = codedData[0],\n        buffer = dic.getEntry(oldCode),\n        character = oldCode,\n        newCode;\n\n      let i = 0;\n      while (!dic.isFull() && i++ < codedData.length - 1) {\n        newCode = codedData[i];\n\n        let p: number[] | null = [];\n\n        if (newCode >= dic.getCurPos()) {\n          p = dic.getEntry(oldCode);\n\n          if (p === null) {\n            console.error(\n              `No dictionary entry in LZW special case: oldCode=${oldCode}; newCode=${newCode}; i=${i}; buffer=${buffer}`\n            );\n          }\n\n          p = [...(p ?? []), character]; //create a copy of the array p to not overwrite the dic entry and append character=\n        } else {\n          // Get entry p for coded index codedData[i]\n          p = dic.getEntry(codedData[i]);\n        }\n\n        plainData.push.apply(plainData, p as number[]); //Merge entry p onto the plainData output\n        character = (p as number[])[0]; // Get first char of p\n        dic.addEntry((buffer as number[]).concat(character)); // Add new entry to dictionary as buffer+c\n        oldCode = newCode;\n        buffer = dic.getEntry(oldCode);\n      }\n\n      decodedData.push.apply(decodedData, plainData); //First append plainData to decodedData\n      codedData = codedData.slice(i + 1); //Second truncate codedData to keep only undecoded stuff before continuing the loop\n    }\n\n    return decodedData;\n  }\n\n  //Run-length decodes around special character 0x90\n  static RLEDecode(byteArr: number[]) {\n    const opt = [];\n\n    let lastChr = 0,\n      isFlag = false;\n\n    for (let i = 0; i < byteArr.length; i++) {\n      const chr = byteArr[i];\n\n      if (isFlag) {\n        if (chr == 0x00) {\n          lastChr = 0x90;\n          opt.push(0x90);\n        } else {\n          for (let j = 0; j < chr - 1; j++) {\n            opt.push(lastChr);\n          }\n        }\n        isFlag = false;\n      } else {\n        if (chr == 0x90) {\n          isFlag = true;\n        } else {\n          opt.push(chr);\n          lastChr = chr;\n        }\n      }\n    }\n\n    return opt;\n  }\n}\n\nexport default LZW;\n", "export const lowerNibble = (byte: number): number => byte & 0xf;\n\nexport default lowerNibble;\n", "export const upperNibble = (byte: number): number => (byte & 0xf0) >> 4;\n\nexport default upperNibble;\n", "import BinFile from './BinFile';\nimport LZW from './LZW';\nimport lowerNibble from './lib/lowerNibble';\nimport upperNibble from './lib/upperNibble';\n\ndeclare type RGBA = {\n  r: number;\n  g: number;\n  b: number;\n  a: number;\n};\n\nexport class PicImage extends BinFile {\n  private palette: RGBA[] = [];\n  private palette16: RGBA[] = [\n    { r: 0xff, g: 0xff, b: 0xff, a: 0x00 }, // 0 - transparent\n    { r: 0xaa, g: 0x00, b: 0x00, a: 0xff }, // 1\n    { r: 0x00, g: 0xaa, b: 0x00, a: 0xff }, // 2\n    { r: 0xaa, g: 0xaa, b: 0x00, a: 0xff }, // 3\n    { r: 0x00, g: 0x00, b: 0xaa, a: 0xff }, // 4\n    { r: 0x00, g: 0x00, b: 0x00, a: 0xff }, // 5\n    { r: 0x00, g: 0x55, b: 0xaa, a: 0xff }, // 6\n    { r: 0xaa, g: 0xaa, b: 0xaa, a: 0xff }, // 7\n    { r: 0x55, g: 0x55, b: 0x55, a: 0xff }, // 8\n    { r: 0xff, g: 0x55, b: 0x55, a: 0xff }, // 9\n    { r: 0x55, g: 0xff, b: 0x55, a: 0xff }, // A\n    { r: 0xff, g: 0xff, b: 0x55, a: 0xff }, // B\n    { r: 0x55, g: 0x55, b: 0xff, a: 0xff }, // C\n    { r: 0xff, g: 0x55, b: 0xff, a: 0xff }, // D\n    { r: 0x55, g: 0xff, b: 0xff, a: 0xff }, // E\n    { r: 0xff, g: 0xff, b: 0xff, a: 0xff }, // F\n  ];\n\n  private imageData: null | number[] = null;\n  private imageHeight = 0;\n  private imageWidth = 0;\n  private byteMode = 0xb;\n\n  decode(callback: (...args: any[]) => any): void {\n    let id = this.getString(2),\n      length = this.getShort();\n\n    if (id == 'M0') {\n      //Second part could be the VGA Palette information\n      this.getPaletteData();\n      id = this.getString(2);\n      length = this.getShort();\n    } else {\n      //If no palette information, let's create a random one\n      console.log('Creating a random color palette...');\n      for (let i = 0; i < 256; i++) {\n        if (i < 16) {\n          this.palette.push(this.palette16[i]);\n        } else {\n          this.palette.push({\n            r: Math.floor(Math.random() * 256),\n            g: Math.floor(Math.random() * 256),\n            b: Math.floor(Math.random() * 256),\n            a: 0xff,\n          });\n        }\n      }\n    }\n\n    if (id == 'X0') {\n      //Final part is image data, in this case VGA\n      this.getX0ImageData(length);\n    } else if (id == 'X1') {\n      //Final part is image data, in this case EGA\n      this.getX1ImageData(length);\n    } else {\n      //Data chunk is of an unknown type\n      console.error('\"' + id + '\" is an unknown chunk type');\n    }\n\n    if (callback) callback();\n  }\n\n  getPaletteData() {\n    const firstIndex = this.getUByte(),\n      lastIndex = this.getUByte(),\n      paletteLength = lastIndex - firstIndex + 1;\n\n    let seenBlack = false;\n\n    for (let i = 0; i < paletteLength; i++) {\n      const colour: RGBA = {\n        r: this.getUByte() * 4, // Each color is between 0 and 64, so to make it use entire\n        g: this.getUByte() * 4, // color space, multiply by 4. The higher-order bits may be used\n        b: this.getUByte() * 4, // for transparency flags, but that's unclear for now...\n        a: 0xff,\n      };\n\n      this.palette.push(colour);\n\n      if (colour.r === colour.g && colour.g === colour.b && colour.r === 0) {\n        // The first black is \"real\" black, the others are (or at least can be) transparency\n        if (!seenBlack) {\n          colour.a = 0;\n        }\n\n        seenBlack = true;\n      }\n    }\n\n    this.palette.push({\n      r: 0,\n      g: 0,\n      b: 0,\n      a: 0,\n    });\n  }\n\n  getX0ImageData(length: number) {\n    this.imageWidth = this.getShort();\n    this.imageHeight = this.getShort();\n    this.byteMode = this.getUByte();\n\n    //Step #1: parse the remainder of the chunk into a set of integers with flags\n    const decompSourceData = LZW.parseByteStreamToIndexes(\n        this,\n        length - 5,\n        this.byteMode\n      ),\n      //Step #2: decode the data using the LZW algorithm\n      decompData = LZW.decode(decompSourceData, this.byteMode);\n\n    //Step #3: decode the final image data using Run-length decoding\n    this.imageData = LZW.RLEDecode(decompData);\n  }\n\n  getX1ImageData(length: number) {\n    this.getX0ImageData(length); //This works the same as x0 data, but each byte includes an upper and lower nibble entry with max 16\n\n    //Loop through each entry and separate into upper and lower nibbles\n    const oldImageData = this.imageData as number[];\n\n    this.imageData = [];\n\n    for (let i = 0; i < oldImageData.length; i++) {\n      this.imageData.push(lowerNibble(oldImageData[i]));\n      this.imageData.push(upperNibble(oldImageData[i]));\n    }\n\n    //set the palette to the hard-coded 16-color palette\n    this.palette = this.palette16;\n  }\n\n  draw(\n    ctx: CanvasRenderingContext2D,\n    destinationX: number = 0,\n    destinationY: number = 0\n  ) {\n    const canvasData = ctx.getImageData(\n      0,\n      0,\n      this.imageWidth,\n      this.imageHeight\n    );\n\n    let index = 0;\n\n    for (let y = 0; y < this.imageHeight; y++) {\n      for (let x = 0; x < this.imageWidth; x++) {\n        const colorIndex = (this.imageData as number[])[index],\n          canvasIndex = (x + y * this.imageWidth) * 4;\n\n        canvasData.data[canvasIndex] = this.palette[colorIndex].r;\n        canvasData.data[canvasIndex + 1] = this.palette[colorIndex].g;\n        canvasData.data[canvasIndex + 2] = this.palette[colorIndex].b;\n        canvasData.data[canvasIndex + 3] = this.palette[colorIndex].a;\n        index++;\n      }\n    }\n\n    ctx.putImageData(canvasData, destinationX, destinationY);\n  }\n\n  getPixel(x: number, y: number): number {\n    if (!this.imageData) {\n      return 0;\n    }\n\n    return this.imageData[x + this.imageWidth * y];\n  }\n}\n\nexport default PicImage;\n", "import { Canvas, CanvasRenderingContext2D } from 'canvas';\nimport PicImage from './PicImage';\n\ntype DefinitionData = {\n  height?: number;\n  width?: number;\n  x?: number;\n  y?: number;\n};\n\ntype DefinitionChild = DefinitionData & { name: string };\n\ntype DefinitionParent = DefinitionData & {\n  contents: DefinitionChild[];\n};\n\ntype Definition = {\n  [filename: string]: DefinitionParent[];\n};\n\ntype DefaultData = {\n  height: number;\n  width: number;\n  clear: {\n    r: number;\n    g: number;\n    b: number;\n  };\n};\n\nexport type ExtractData = {\n  defaults: DefaultData;\n  files: {\n    [filename: string]: Definition;\n  };\n};\n\ntype ImageMap = {\n  name: string;\n  uri: string;\n};\n\nexport const extractSprites = (\n  content: string,\n  extractData: Definition,\n  defaults: DefaultData,\n  canvasProvider: (width: number, height: number) => Canvas | HTMLCanvasElement,\n  logger: (message: string) => void = (message) => console.log(message)\n): ImageMap[] => {\n  const canvas = canvasProvider(320, 200),\n    image = new PicImage(),\n    result: ImageMap[] = [];\n\n  image.fromString(content, () => {\n    image.draw(\n      canvas.getContext('2d', {\n        // @ts-ignore\n        willReadFrequently: true,\n      }) as CanvasRenderingContext2D\n    );\n\n    Object.entries(extractData).forEach(([path, definitionParents]) =>\n      definitionParents.forEach((definition) =>\n        definition.contents.forEach((content) => {\n          const object: { [key: string]: any } = {\n              ...defaults,\n              ...definition,\n              ...content,\n            },\n            filename = `./assets/${path + object.name}.png`,\n            contentCanvas = canvasProvider(object.width, object.height),\n            context = contentCanvas.getContext('2d', {\n              // @ts-ignore\n              willReadFrequently: true,\n            }) as CanvasRenderingContext2D;\n\n          context.clearRect(0, 0, object.width, object.height);\n          context.drawImage(\n            canvas,\n            object.x,\n            object.y,\n            object.width,\n            object.height,\n            0,\n            0,\n            object.width,\n            object.height\n          );\n\n          for (let x = 0; x < canvas.width; x++) {\n            for (let y = 0; y < canvas.height; y++) {\n              let imageData = context.getImageData(x, y, 1, 1).data;\n\n              if (\n                imageData[0] == object.clear.r &&\n                imageData[1] == object.clear.g &&\n                imageData[2] == object.clear.b\n              ) {\n                context.clearRect(x, y, 1, 1);\n              }\n            }\n          }\n\n          logger(`Processing ${filename}...`);\n          result.push({\n            name: filename,\n            uri: contentCanvas.toDataURL('image/png'),\n          });\n        })\n      )\n    );\n  });\n\n  return result;\n};\n\nexport default extractSprites;\n", "import {\n  ExtractData,\n  extractSprites,\n} from '@civ-clone/civ1-asset-extractor/extractSprites';\nimport { e, h, t } from '../lib/html';\nimport Window from './Window';\nimport { assetStore } from '../AssetStore';\nimport extractData from '@civ-clone/civ1-asset-extractor/extract-data.json';\n\nexport class ImportAssetsWindow extends Window {\n  #fileInput: HTMLInputElement;\n  #progressInformation: HTMLParagraphElement;\n\n  constructor() {\n    const fileInput = e<HTMLInputElement>('input[type=\"file\"][multiple]'),\n      progressInformation = e<HTMLParagraphElement>('p.loading[hidden]');\n\n    super(\n      'Import assets',\n      e(\n        'div.import-assets',\n        e(\n          'p',\n          t(\n            `Upload ${Object.keys(extractData.files).join(\n              ', '\n            )} from the original Civilization files to extract assets (these will be stored locally). This process can take at least a few minutes.`\n          )\n        ),\n        e(\n          'p',\n          h(fileInput, {\n            change: (event) => this.handleFileUpload(event),\n          })\n        ),\n        progressInformation\n      )\n    );\n\n    this.#fileInput = fileInput;\n    this.#progressInformation = progressInformation;\n  }\n\n  async handleFileUpload(event: InputEvent) {\n    this.#fileInput.setAttribute('disabled', '');\n    this.#progressInformation.removeAttribute('hidden');\n    this.#progressInformation.innerText = 'Building image assets...';\n\n    const files = Array.from(\n        (event.target as HTMLInputElement).files ?? []\n      ) as File[],\n      filenames: string[] = files.map((file: File) => file.name),\n      expectedMatches = Object.keys(extractData.files).map(\n        (key) => new RegExp(key, 'i')\n      );\n\n    if (\n      !expectedMatches.every((expectedMatch) =>\n        filenames.some((filename) => filename.match(expectedMatch))\n      )\n    ) {\n      console.error(\n        `Please provide ${filenames.join(', ')} to process the assets.`\n      );\n\n      return;\n    }\n\n    const results: { name: string; uri: string }[] = [];\n\n    // Wait for...\n    await Promise.all(\n      // ...all files...\n      files.map(\n        async (file: File) =>\n          // ...to have been...\n          new Promise<void>((resolve) => {\n            const definitions = (extractData as ExtractData).files[\n              file.name.toUpperCase()\n            ];\n\n            if (!definitions) {\n              console.warn(`No definitions found for ${file.name}, skipping.`);\n\n              return;\n            }\n\n            const reader = new FileReader();\n\n            // ...loaded...\n            reader.addEventListener('load', async (event) => {\n              // ...the sprites extracted...\n              extractSprites(\n                event.target!.result as string,\n                definitions,\n                extractData.defaults,\n                (width, height) => {\n                  const canvas = document.createElement(\n                    'canvas'\n                  ) as HTMLCanvasElement;\n\n                  canvas.width = width;\n                  canvas.height = height;\n\n                  return canvas;\n                },\n                (message) => {\n                  this.#progressInformation.innerText = message;\n                }\n              ).forEach((record) => results.push(record));\n\n              resolve();\n            });\n\n            reader.readAsBinaryString(file);\n          })\n      )\n    );\n\n    this.#progressInformation.innerText = 'Writing to database...';\n\n    // ...and all results stored in IDB.\n    await Promise.all(results.map((record) => assetStore.set(record)));\n\n    if (!(await assetStore.hasAllAssets())) {\n      console.error('Something went wrong...');\n      this.#progressInformation.style.color = '#f00';\n      this.#progressInformation.innerText =\n        'Not all expected data was written. Might need to try again... Missing: ' +\n        (await assetStore.missingAssets()).join(', ');\n\n      this.#fileInput.removeAttribute('disabled');\n\n      return;\n    }\n\n    this.#progressInformation.innerText =\n      'Done! Please reload the page to utilise the fresh assets.';\n\n    // We need to reprocess everything and this is the lazy way...\n    location.reload();\n  }\n}\n\nexport default ImportAssetsWindow;\n", "import {\n  SelectionWindow,\n  SelectionWindowOption,\n  SelectionWindowOptions,\n} from './SelectionWindow';\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    selection: CustomEvent<string>;\n  }\n}\n\nexport class MandatorySelection extends SelectionWindow {\n  constructor(\n    title: string,\n    optionList: SelectionWindowOption[],\n    onChoose: (selection: string) => void,\n    body: string | Node | null = 'Please choose one of the following:',\n    options: SelectionWindowOptions = {\n      canClose: false,\n      displayAll: false,\n    }\n  ) {\n    super(title, optionList, onChoose, body, {\n      ...options,\n      displayAll: true,\n    });\n  }\n\n  display(): Promise<string> {\n    return new Promise<string>((resolve) => {\n      this.element().addEventListener('selection', ({ detail }) =>\n        resolve(detail)\n      );\n\n      super.display();\n    });\n  }\n}\n\nexport default MandatorySelection;\n", "import MandatorySelection from './MandatorySelection';\nimport Transport from '../../Engine/Transport';\nimport Request from '../../Engine/Request';\n\nexport type FinishedHandler = () => void;\n\nexport class NewGameWindow extends MandatorySelection {\n  constructor(transport: Transport, onFinished?: FinishedHandler) {\n    // TODO: take the number from Engine options.\n    super(\n      'How many players?',\n      [\n        {\n          label: '7 civilizations',\n          value: 7,\n        },\n        {\n          label: '6 civilizations',\n          value: 6,\n        },\n        {\n          label: '5 civilizations',\n          value: 5,\n        },\n        {\n          label: '4 civilizations',\n          value: 4,\n        },\n        {\n          label: '3 civilizations',\n          value: 3,\n        },\n      ],\n      async (selection) => {\n        this.close();\n\n        await transport.request(\n          new Request('setOptions', {\n            width: 80,\n            height: 60,\n            players: parseInt(selection, 10),\n          })\n        );\n\n        if (onFinished) {\n          await onFinished();\n        }\n\n        transport.send('start');\n      }\n    );\n  }\n}\n\nexport default NewGameWindow;\n", "import { FinishedHandler, NewGameWindow } from './NewGameWindow';\nimport Transport from '../../Engine/Transport';\nimport Request from '../../Engine/Request';\n\nexport class EarthWindow extends NewGameWindow {\n  constructor(transport: Transport, onFinished?: FinishedHandler) {\n    super(transport, async () => {\n      if (onFinished) {\n        await onFinished();\n      }\n\n      await transport.request(\n        new Request('setOptions', {\n          width: 80,\n          height: 50,\n          earth: true,\n        })\n      );\n    });\n  }\n}\n\nexport default EarthWindow;\n", "import { e, h, t } from '../lib/html';\nimport CustomiseWorldWindow from './CustomiseWorldWindow';\nimport Element from './Element';\nimport ImportAssetsWindow from './ImportAssetsWindow';\nimport NewGameWindow from './NewGameWindow';\nimport Transport from '../../Engine/Transport';\nimport { assetStore } from '../AssetStore';\nimport EarthWindow from './EarthWindow';\n\nexport class MainMenu extends Element {\n  #transport: Transport;\n\n  constructor(element: HTMLElement, transport: Transport) {\n    super(element);\n\n    this.#transport = transport;\n\n    this.build();\n\n    element.classList.add('active');\n  }\n\n  async build(showQuit = false) {\n    const hasAssets = await assetStore.hasAllAssets();\n\n    if (!hasAssets) {\n      console.log('Missing assets:');\n      console.log(await assetStore.missingAssets());\n    }\n\n    this.element().append(\n      h(\n        e(\n          'nav',\n          h(\n            e(\n              'button[autofocus]' + (hasAssets ? '' : '[hidden]'),\n              t('Start a New Game')\n            ),\n            {\n              click: () =>\n                new NewGameWindow(this.#transport, () => this.remove()),\n            }\n          ),\n          h(e('button', t('Earth')), {\n            click: () => new EarthWindow(this.#transport, () => this.remove()),\n          }),\n          h(e('button' + (hasAssets ? '' : '[hidden]'), t('Customise World')), {\n            click: async () =>\n              new CustomiseWorldWindow(this.#transport, () => this.remove()),\n          }),\n          h(e('button', t(hasAssets ? 'Update assets' : 'Import assets')), {\n            click: () => new ImportAssetsWindow(),\n          }),\n          h(e('button' + (showQuit ? '' : '[hidden]'), t('Quit')), {\n            click: () => {\n              this.remove();\n\n              this.#transport.send('quit');\n            },\n          })\n        ),\n        {\n          keydown(event: KeyboardEvent) {\n            const currentTarget = document.activeElement;\n\n            if (\n              currentTarget === null ||\n              !currentTarget.matches('#mainmenu nav button')\n            ) {\n              return;\n            }\n\n            if (event.key === 'ArrowDown' && currentTarget.nextElementSibling) {\n              (currentTarget.nextElementSibling as HTMLElement).focus();\n            }\n\n            if (\n              event.key === 'ArrowUp' &&\n              currentTarget.previousElementSibling\n            ) {\n              (currentTarget.previousElementSibling as HTMLElement).focus();\n            }\n          },\n        }\n      )\n    );\n  }\n\n  disableButtons(): void {\n    this.element()\n      .querySelectorAll('button')\n      .forEach((button): void => button.setAttribute('disabled', ''));\n  }\n\n  remove(): void {\n    this.element().classList.remove('active');\n\n    setTimeout((): void => {\n      this.element().remove();\n    }, 2000);\n  }\n}\n\nexport default MainMenu;\n", "import Map from './Map';\nimport Portal from './Portal';\nimport World from './World';\n\nexport class Minimap {\n  #context: CanvasRenderingContext2D;\n  #element: HTMLCanvasElement;\n  #layers: Map[];\n  #portal: Portal;\n  #world: World;\n\n  constructor(\n    element: HTMLCanvasElement,\n    world: World,\n    portal: Portal,\n    ...layers: Map[]\n  ) {\n    this.#element = element;\n    this.#world = world;\n    this.#portal = portal;\n    this.#layers = layers;\n\n    this.#context = this.#element.getContext('2d')!;\n\n    this.#element.addEventListener('click', (event) => {\n      const x = event.offsetX - this.#element.offsetLeft,\n        y = event.offsetY - this.#element.offsetTop,\n        tileX = Math.ceil(\n          (x / this.#element.offsetWidth) * this.#world.width()\n        ),\n        tileY = Math.ceil(\n          (y / this.#element.offsetHeight) * this.#world.height()\n        );\n\n      this.#portal.setCenter(tileX, tileY);\n      this.update();\n    });\n  }\n\n  update(): void {\n    const targetHeight =\n      this.#layers[0].canvas().height * (190 / this.#layers[0].canvas().width);\n\n    this.#element.height = targetHeight;\n    this.#context.clearRect(0, 0, 190, targetHeight);\n\n    this.#layers.forEach((layer) =>\n      this.#context.drawImage(layer.canvas(), 0, 0, 190, targetHeight)\n    );\n\n    const [start, end] = this.#portal.visibleRange();\n\n    // TODO: draw the rectangle replicated when close to the sides\n    this.#context.lineWidth = 1;\n    this.#context.strokeStyle = '#fff';\n    this.#context.fillStyle = 'rgba(255, 255, 255, .2)';\n    this.#context.rect(\n      Math.floor((190 / this.#world.width()) * start.x),\n      Math.floor((targetHeight / this.#world.height()) * start.y),\n      Math.floor((190 / this.#world.width()) * (end.x - start.x)),\n      Math.floor((targetHeight / this.#world.height()) * (end.y - start.y))\n    );\n    this.#context.stroke();\n    this.#context.fill();\n  }\n}\n\nexport default Minimap;\n", "import NotificationWindow from './NotificationWindow';\n\nexport interface Notification {\n  message: string;\n  title?: string;\n}\n\nexport class Notifications {\n  #container: HTMLElement;\n  #notifications: Notification[] = [];\n\n  constructor(container: HTMLElement = document.body) {\n    this.#container = container;\n  }\n\n  receive(notification: Notification): void {\n    this.#notifications.push(notification);\n\n    this.check();\n  }\n\n  private check(): void {\n    const active = document.querySelector('.notificationWindow');\n\n    if (!this.#notifications.length || active) {\n      return;\n    }\n\n    const notification = this.#notifications.shift() as Notification;\n\n    this.publish(notification);\n  }\n\n  private publish(notification: Notification): void {\n    const notificationWindow = new NotificationWindow(\n      notification.title ?? 'Notification',\n      notification.message,\n      {\n        parent: this.#container,\n      }\n    );\n\n    notificationWindow.element().addEventListener('close', () => this.check());\n  }\n}\n\nexport default Notifications;\n", "import { e, t } from '../lib/html';\nimport { City, Player, Yield } from '../types';\nimport Element from './Element';\nimport { knownGroupLookup } from '../lib/yieldMap';\n\nexport class PlayerDetails extends Element {\n  #player: Player;\n\n  constructor(element: HTMLElement, player: Player) {\n    super(element);\n\n    this.#player = player;\n  }\n\n  build(): void {\n    this.empty();\n\n    const { civilization, treasury, research, cities } = this.#player;\n\n    const [totalGold, totalResearch] = cities.reduce(\n        ([totalGold, totalResearch], city: City) =>\n          city.yields.reduce(\n            ([totalGold, totalResearch], cityYield: Yield) => {\n              if (cityYield._ === 'Research') {\n                return [totalGold, totalResearch + cityYield.value];\n              }\n\n              if (knownGroupLookup.Gold.includes(cityYield._)) {\n                return [totalGold + cityYield.value, totalResearch];\n              }\n\n              return [totalGold, totalResearch];\n            },\n            [totalGold, totalResearch]\n          ),\n        [0, 0]\n      ),\n      researchTurns = Math.ceil(\n        (research.cost.value - research.progress.value) / totalResearch\n      );\n\n    this.element().append(\n      e('h3', t(`${civilization.leader.name} of the ${civilization._} empire`)),\n      e(\n        'p',\n        e('strong', t('Researching')),\n        e('br'),\n        t(\n          research.researching\n            ? `${research.researching._} ${research.progress.value} / ${\n                research.cost.value\n              } (${researchTurns} turn${researchTurns === 1 ? '' : 's'})`\n            : 'Nothing'\n        )\n      ),\n      e(\n        'p',\n        e('strong', t('Treasury')),\n        e('br'),\n        t(`${treasury.value} (${totalGold} / turn)`)\n      )\n    );\n  }\n}\n\nexport default PlayerDetails;\n", "import { Unit } from '../types';\nimport { e, t } from '../lib/html';\nimport Element from './Element';\n\nexport class UnitDetails extends Element {\n  #activeUnit: Unit | null;\n\n  constructor(element: HTMLElement, activeUnit: Unit | null) {\n    super(element);\n\n    this.#activeUnit = activeUnit;\n\n    this.build();\n  }\n\n  build(): void {\n    this.empty();\n\n    if (this.#activeUnit === null) {\n      return;\n    }\n\n    this.element().append(\n      e(\n        'p',\n        t(\n          `${this.#activeUnit._} (${this.#activeUnit.tile.x}, ${\n            this.#activeUnit.tile.y\n          })`\n        )\n      ),\n      e('p', t(this.#activeUnit.city?.name ?? 'NONE')),\n      e(\n        'p',\n        t(\n          `${\n            Number.isInteger(this.#activeUnit.moves.value)\n              ? this.#activeUnit.moves.value\n              : this.#activeUnit.moves.value.toFixed(2)\n          } / ${this.#activeUnit.movement.value} moves`\n        )\n      ),\n      e(\n        'p',\n        t(\n          `A: ${this.#activeUnit.attack.value} / D: ${\n            this.#activeUnit.defence.value\n          } / V: ${this.#activeUnit.visibility.value}`\n        )\n      ),\n      e(\n        'p',\n        t(\n          `${this.#activeUnit.improvements\n            .map((improvement) => improvement._)\n            .join(', ')}`\n        )\n      ),\n      e(\n        'p',\n        t(\n          `${this.#activeUnit.tile.terrain._}${\n            this.#activeUnit.tile.terrain.features\n              ? ' ' +\n                this.#activeUnit.tile.terrain.features\n                  .map((feature) => feature._)\n                  .join(', ')\n              : ''\n          }${\n            this.#activeUnit.tile.improvements.length\n              ? ' (' +\n                this.#activeUnit.tile.improvements\n                  .map((improvement) => improvement._)\n                  .join(', ') +\n                ')'\n              : ''\n          }`\n        )\n      ),\n      e(\n        'p',\n        t(\n          `${this.#activeUnit.tile.units\n            .filter((unit) => unit !== this.#activeUnit)\n            .map((unit) => unit._)\n            .join(', ')}`\n        )\n      )\n    );\n  }\n}\n\nexport default UnitDetails;\n", "import {\n  DataPatch,\n  GameData,\n  NeighbourDirection,\n  PlainObject,\n  PlayerAction,\n  Tile,\n  Unit,\n} from './types';\nimport { e, h, t } from './lib/html';\nimport { reconstituteData, ObjectMap } from './lib/reconstituteData';\nimport Actions from './components/Actions';\nimport ActiveUnit from './components/Map/ActiveUnit';\nimport Cities from './components/Map/Cities';\nimport CityNames from './components/Map/CityNames';\nimport Feature from './components/Map/Feature';\nimport Fog from './components/Map/Fog';\nimport GameDetails from './components/GameDetails';\nimport GamePortal from './components/GamePortal';\nimport GoodyHuts from './components/Map/GoodyHuts';\nimport Improvements from './components/Map/Improvements';\nimport IntervalHandler from './lib/IntervalHandler';\nimport Irrigation from './components/Map/Irrigation';\nimport Land from './components/Map/Land';\nimport MainMenu from './components/MainMenu';\nimport Minimap from './components/Minimap';\nimport NotificationWindow from './components/NotificationWindow';\nimport Notifications from './components/Notifications';\nimport PlayerDetails from './components/PlayerDetails';\nimport Portal from './components/Portal';\nimport SelectionWindow from './components/SelectionWindow';\nimport Terrain from './components/Map/Terrain';\nimport UnitDetails from './components/UnitDetails';\nimport Units from './components/Map/Units';\nimport World from './components/World';\nimport Yields from './components/Map/Yields';\nimport Transport from '../Engine/Transport';\nimport { assetStore } from './AssetStore';\n\n// TODO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n//  ! Break this down and use a front-end framework? !\n//  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\nexport class Renderer {\n  #transport: Transport;\n\n  constructor(transport: Transport) {\n    this.#transport = transport;\n  }\n\n  init() {\n    const transport = this.#transport;\n\n    assetStore.hasAllAssets().then((hasAllAssets) => {\n      if (!hasAllAssets) {\n        return;\n      }\n\n      assetStore\n        .getScaled('./assets/cursor/torch.png', 2)\n        .then(\n          (scaledCursor) =>\n            (document.body.style.cursor = `url('${scaledCursor.toDataURL(\n              'image/png'\n            )}'), default`)\n        );\n    });\n\n    const options = {\n      autoEndOfTurn: true,\n    };\n\n    try {\n      const notificationArea = document.getElementById(\n          'notification'\n        ) as HTMLElement,\n        mainMenuElement = document.querySelector('#mainmenu') as HTMLElement,\n        actionArea = document.getElementById('actions') as HTMLElement,\n        secondaryActionArea = document.getElementById(\n          'other-actions'\n        ) as HTMLElement,\n        gameArea = document.getElementById('game') as HTMLElement,\n        mapWrapper = document.getElementById('map') as HTMLElement,\n        mapPortal = mapWrapper.querySelector('canvas') as HTMLCanvasElement,\n        gameInfo = document.getElementById('gameDetails') as HTMLElement,\n        playerInfo = document.getElementById('playerDetails') as HTMLElement,\n        minimapCanvas = document.getElementById('minimap') as HTMLCanvasElement,\n        unitInfo = document.getElementById('unitInfo') as HTMLCanvasElement,\n        preloadContainer = document.getElementById('preload') as HTMLDivElement,\n        notifications = new Notifications(),\n        mainMenu = new MainMenu(mainMenuElement, this.#transport),\n        setActiveUnit = (\n          unit: Unit | null,\n          portal: Portal,\n          unitsMap: Units,\n          activeUnitsMap: ActiveUnit\n        ) => {\n          const unitDetails = new UnitDetails(unitInfo, unit);\n\n          activeUnit = unit;\n\n          unitDetails.build();\n\n          unitsMap.setActiveUnit(unit);\n          unitsMap.render();\n          unitsMap.setVisible(true);\n          activeUnitsMap.setActiveUnit(unit);\n          activeUnitsMap.render();\n          activeUnitsMap.setVisible(true);\n\n          if (unit === null) {\n            portal.render();\n\n            return;\n          }\n\n          lastUnit = unit;\n\n          unitsMap.update([\n            ...(lastUnit?.tile ? [lastUnit.tile] : []),\n            unit.tile,\n          ]);\n\n          if (!portal.isVisible(unit.tile.x, unit.tile.y)) {\n            portal.setCenter(unit.tile.x, unit.tile.y);\n          }\n\n          portal.render();\n        };\n\n      // preloaded the images as they could be remote\n      assetStore.getAll().then((records) =>\n        records.forEach((record) =>\n          preloadContainer.append(\n            h(e(`img[src=\"${record.uri}\"][data-path=\"${record.name}\"]`), {\n              error: () =>\n                console.error(\n                  `There was a problem preloading '${record.name}', you may have some missing details.`\n                ),\n            })\n          )\n        )\n      );\n\n      const tilesToRender: Tile[] = [];\n\n      let globalNotificationTimer: number | undefined,\n        lastUnit: Unit | null = null,\n        activeUnit: Unit | null = null;\n\n      transport.receive('notification', (data): void => {\n        notificationArea.innerHTML = data;\n\n        if (globalNotificationTimer) {\n          window.clearTimeout(globalNotificationTimer);\n        }\n\n        globalNotificationTimer = window.setTimeout((): void => {\n          globalNotificationTimer = undefined;\n\n          notificationArea.innerText = '';\n        }, 4000);\n      });\n\n      [\n        ['chooseCivilization', 'Choose your civilization'],\n        ['chooseLeader', 'Choose your leader'],\n      ].forEach(([channel, label]) =>\n        transport.receive(channel, (rawData) => {\n          const { choices } = reconstituteData(rawData);\n\n          new SelectionWindow(\n            label,\n            choices.map(({ _: choice }: { _: string }) => ({\n              label: choice,\n              value: choice,\n            })),\n            (choice) => transport.send(channel, choice),\n            label,\n            {\n              displayAll: true,\n            }\n          );\n        })\n      );\n\n      transport.receiveOnce('gameData', (objectMap: ObjectMap) => {\n        try {\n          const data: GameData = reconstituteData(objectMap) as GameData,\n            // @ts-ignore\n            formatter = new Intl.ListFormat();\n\n          new NotificationWindow(\n            'Welcome',\n            e(\n              'div.welcome',\n              e(\n                'p',\n                t(\n                  `${data.player.civilization.leader.name}, you have risen to become leader of the ${data.player.civilization._}.`\n                )\n              ),\n              e(\n                'p',\n                t(\n                  `Your people have knowledge of ${formatter.format([\n                    'Irrigation',\n                    'Mining',\n                    'Roads',\n                    ...data.player.research.complete.map(\n                      (advance) => advance._\n                    ),\n                  ])}`\n                )\n              )\n            )\n          );\n\n          gameArea.classList.add('active');\n\n          mapPortal.width = (\n            mapPortal.parentElement as HTMLElement\n          ).offsetWidth;\n          mapPortal.height = (\n            mapPortal.parentElement as HTMLElement\n          ).offsetHeight;\n\n          let activeUnits: PlayerAction[] = [];\n\n          const scale = 2,\n            world = new World(data.player.world),\n            intervalHandler = new IntervalHandler(),\n            portal = new GamePortal(\n              world,\n              transport,\n              mapPortal,\n              {\n                playerId: data.player.id,\n                // TODO: this needs to be a user-controllable item\n                scale,\n                // TODO: this needs to come from the theme\n                tileSize: 16,\n              },\n              Land,\n              Irrigation,\n              Terrain,\n              Improvements,\n              Feature,\n              GoodyHuts,\n              Fog,\n              Yields,\n              Units,\n              Cities,\n              CityNames,\n              ActiveUnit\n            ),\n            landMap = portal.getLayer(Land) as Land,\n            yieldsMap = portal.getLayer(Yields) as Yields,\n            unitsMap = portal.getLayer(Units) as Units,\n            citiesMap = portal.getLayer(Cities) as Cities,\n            cityNamesMap = portal.getLayer(CityNames) as CityNames,\n            activeUnitsMap = portal.getLayer(ActiveUnit) as ActiveUnit,\n            minimap = new Minimap(\n              minimapCanvas,\n              world,\n              portal,\n              landMap,\n              citiesMap\n            ),\n            primaryActions = new Actions(actionArea, portal, this.#transport),\n            secondaryActions = new Actions(\n              secondaryActionArea,\n              portal,\n              this.#transport\n            );\n\n          yieldsMap.setVisible(false);\n\n          portal.on('focus-changed', () => minimap.update());\n          portal.on('activate-unit', (unit) =>\n            setActiveUnit(unit, portal, unitsMap, activeUnitsMap)\n          );\n\n          intervalHandler.on(() => {\n            activeUnitsMap.setVisible(!activeUnitsMap.isVisible());\n\n            portal.build(tilesToRender.splice(0));\n            portal.render();\n          });\n\n          window.addEventListener('resize', () => {\n            mapPortal.width = (\n              mapPortal.parentElement as HTMLElement\n            ).offsetWidth;\n            mapPortal.height = (\n              mapPortal.parentElement as HTMLElement\n            ).offsetHeight;\n          });\n\n          // This needs wrapping.\n          let lastTurn = 1,\n            clearNextTurn = false;\n\n          const handler = (objectMap: ObjectMap): void => {\n            let orphanIds: string[] | null = clearNextTurn ? [] : null;\n\n            // TODO: look into if it's possible to have data reconstituted in a worker thread\n            const data: GameData = reconstituteData(\n              objectMap,\n              orphanIds\n            ) as GameData;\n\n            // A bit crude, I'd like to run this as as background job too\n            if (orphanIds) {\n              // clean up orphan data - late game there can be tens of thousands of these to clean up\n              ((orphanIds) => {\n                const maxCount = 1000,\n                  delay = 200;\n\n                for (\n                  let i = 0, max = Math.ceil(orphanIds.length / maxCount);\n                  i < max;\n                  i++\n                ) {\n                  setTimeout(\n                    () =>\n                      orphanIds\n                        .slice(i * maxCount, (i + 1) * maxCount - 1)\n                        .forEach((id) => delete objectMap.objects[id]),\n                    (i + 1) * delay\n                  );\n                }\n              })(orphanIds);\n\n              clearNextTurn = false;\n            }\n\n            document.dispatchEvent(\n              new CustomEvent('dataupdated', {\n                detail: {\n                  data,\n                },\n              })\n            );\n\n            if (lastTurn !== data.turn.value) {\n              clearNextTurn = true;\n              lastTurn = data.turn.value;\n            }\n\n            primaryActions.build(data.player.mandatoryActions);\n            secondaryActions.build(\n              data.player.actions.filter((action: PlayerAction) =>\n                ['AdjustTradeRates', 'Revolution'].includes(action._)\n              )\n            );\n\n            gameArea.append(primaryActions.element());\n\n            world.setTiles(data.player.world.tiles);\n\n            const gameDetails = new GameDetails(gameInfo, data.turn, data.year);\n\n            gameDetails.build();\n\n            const playerDetails = new PlayerDetails(playerInfo, data.player);\n\n            playerDetails.build();\n\n            activeUnits = data.player.actions.filter(\n              (action: PlayerAction): boolean => action._ === 'ActiveUnit'\n            );\n\n            // This prioritises units that are already on screen\n            const [activeUnitAction] = activeUnits.sort(\n              ({ value: unitA }, { value: unitB }): number =>\n                unitB === lastUnit\n                  ? 1\n                  : unitA === lastUnit\n                  ? -1\n                  : (portal.isVisible(\n                      (unitB as Unit).tile.x,\n                      (unitB as Unit).tile.y\n                    )\n                      ? 1\n                      : 0) -\n                    (portal.isVisible(\n                      (unitA as Unit).tile.x,\n                      (unitA as Unit).tile.y\n                    )\n                      ? 1\n                      : 0)\n            );\n\n            if (lastUnit !== activeUnitAction?.value) {\n              lastUnit = null;\n            }\n\n            setActiveUnit(\n              lastUnit?.active\n                ? lastUnit\n                : activeUnitAction\n                ? (activeUnitAction.value as Unit)\n                : null,\n              portal,\n              unitsMap,\n              activeUnitsMap\n            );\n\n            // ensure UI looks responsive\n            portal.build(tilesToRender.splice(0));\n            portal.render();\n\n            minimap.update();\n\n            if (\n              options.autoEndOfTurn &&\n              data.player.mandatoryActions.length === 1 &&\n              data.player.mandatoryActions.every(\n                (action) => action._ === 'EndTurn'\n              )\n            ) {\n              transport.send('action', {\n                name: 'EndTurn',\n              });\n\n              return;\n            }\n          };\n\n          handler(objectMap);\n\n          transport.receive('gameData', (data) => handler(data));\n\n          const pathToParts = (path: string) =>\n              path.replace(/]/g, '').split(/[.[]/),\n            getPenultimateObject = (\n              object: PlainObject,\n              path: string\n            ): [PlainObject, string | undefined] => {\n              const parts = pathToParts(path),\n                lastPart = parts.pop();\n\n              const tmpObj = parts.reduce((tmpObj, part) => {\n                if (!tmpObj || !(part in tmpObj)) {\n                  return null;\n                }\n\n                return tmpObj[part];\n              }, object);\n\n              return [tmpObj, lastPart];\n            },\n            setObjectPath = (\n              object: PlainObject,\n              path: string,\n              value: any\n            ): void => {\n              const [tmpObj, lastPart] = getPenultimateObject(object, path);\n\n              if (!tmpObj || !lastPart) {\n                console.warn(\n                  `unable to set ${path} of ${object} (${lastPart})`\n                );\n                return;\n              }\n\n              tmpObj[lastPart] = value;\n            },\n            removeObjectPath = (object: PlainObject, path: string): void => {\n              const [tmpObj, lastPart] = getPenultimateObject(object, path);\n\n              if (!tmpObj || !lastPart) {\n                console.warn(\n                  `unable to set ${path} of ${object} (${lastPart})`\n                );\n                return;\n              }\n\n              delete tmpObj[lastPart];\n            };\n\n          transport.receive('gameDataPatch', (data: DataPatch[]) => {\n            data.forEach((patch) =>\n              Object.entries(patch).forEach(([key, { type, index, value }]) => {\n                if (type === 'add' || type === 'update') {\n                  if (!value!.hierarchy) {\n                    console.error('No hierarchy');\n                    console.error(value);\n\n                    return;\n                  }\n\n                  if (index) {\n                    setObjectPath(\n                      objectMap.objects[key],\n                      index,\n                      value!.hierarchy\n                    );\n                  } else {\n                    objectMap.objects[key] = value!.hierarchy;\n                  }\n\n                  document.dispatchEvent(\n                    new CustomEvent('patchdatareceived', {\n                      detail: {\n                        value,\n                      },\n                    })\n                  );\n\n                  Object.entries(value!.objects as PlainObject).forEach(\n                    ([key, value]) => {\n                      objectMap.objects[key] = value;\n\n                      if (value._ === 'PlayerTile') {\n                        // Since we only use tilesToRender for x and y this should be fine...\n                        tilesToRender.push(value);\n                      }\n                    }\n                  );\n                }\n\n                if (type === 'remove') {\n                  if (index) {\n                    removeObjectPath(objectMap.objects[key], index);\n\n                    return;\n                  }\n\n                  delete objectMap.objects[key];\n                }\n              })\n            );\n\n            handler(objectMap);\n          });\n\n          transport.receive('gameNotification', (data): void =>\n            notifications.receive(data)\n          );\n\n          const keyToActionsMap: {\n              [key: string]: string[];\n            } = {\n              ' ': ['NoOrders'],\n              b: ['FoundCity'],\n              D: ['Disband'],\n              f: ['Fortify', 'BuildFortress'],\n              i: [\n                'BuildIrrigation',\n                'ClearForest',\n                'ClearSwamp',\n                'ClearJungle',\n              ],\n              m: ['BuildMine', 'PlantForest'],\n              P: ['Pillage'],\n              r: ['BuildRoad', 'BuildRailroad'],\n              s: ['Sleep'],\n              u: ['Unload'],\n              w: ['Wait'],\n            },\n            directionKeyMap: { [key: string]: NeighbourDirection } = {\n              ArrowUp: 'n',\n              PageUp: 'ne',\n              ArrowRight: 'e',\n              PageDown: 'se',\n              ArrowDown: 's',\n              End: 'sw',\n              ArrowLeft: 'w',\n              Home: 'nw',\n            },\n            directionKeyMapNumpad: { [key: string]: NeighbourDirection } = {\n              8: 'n',\n              9: 'ne',\n              6: 'e',\n              3: 'se',\n              2: 's',\n              1: 'sw',\n              4: 'w',\n              7: 'nw',\n            },\n            directionKeyTypeMap: { [key: string]: { [key: string]: string } } =\n              {\n                [KeyboardEvent.DOM_KEY_LOCATION_STANDARD]: directionKeyMap,\n                [KeyboardEvent.DOM_KEY_LOCATION_NUMPAD]: directionKeyMapNumpad,\n              };\n\n          let lastKey = '';\n\n          document.addEventListener('keydown', (event) => {\n            if (activeUnit) {\n              if (event.key in keyToActionsMap) {\n                const actions = [...keyToActionsMap[event.key]];\n\n                while (actions.length) {\n                  const actionName = actions.shift(),\n                    [unitAction] = activeUnit.actions.filter(\n                      (action): boolean => action._ === actionName\n                    );\n\n                  if (unitAction) {\n                    transport.send('action', {\n                      name: 'ActiveUnit',\n                      id: activeUnit.id,\n                      unitAction: unitAction._,\n                      target: unitAction.to.id,\n                    });\n\n                    event.stopPropagation();\n                    event.preventDefault();\n\n                    return;\n                  }\n                }\n              }\n\n              // if (event.key in directionKeyTypeMap[event.location]) {\n              if (event.key in directionKeyMap) {\n                const [unitAction] =\n                  activeUnit.actionsForNeighbours[directionKeyMap[event.key]];\n\n                if (unitAction) {\n                  transport.send('action', {\n                    name: 'ActiveUnit',\n                    id: activeUnit.id,\n                    unitAction: unitAction._,\n                    target: unitAction.to.id,\n                  });\n\n                  event.stopPropagation();\n                  event.preventDefault();\n\n                  return;\n                }\n              }\n            }\n\n            if (event.key === 'Escape' && document.activeElement !== null) {\n              (document.activeElement as HTMLElement).blur();\n\n              return;\n            }\n\n            if (\n              event.key === 'Enter' &&\n              data.player.mandatoryActions.some(\n                (action) => action._ === 'EndOfTurn'\n              )\n            ) {\n              transport.send('action', {\n                name: 'EndTurn',\n              });\n\n              event.stopPropagation();\n              event.preventDefault();\n\n              return;\n            }\n\n            if (event.key === 'Tab') {\n              const topAction = actionArea.querySelector(\n                'div.action:first-child button'\n              ) as HTMLButtonElement | null;\n\n              if (topAction !== null) {\n                topAction.focus();\n\n                event.preventDefault();\n                event.stopPropagation();\n\n                return;\n              }\n            }\n\n            if (event.key === 'c' && activeUnit) {\n              portal.setCenter(activeUnit.tile.x, activeUnit.tile.y);\n\n              portal.render();\n              minimap.update();\n\n              return;\n            }\n\n            if (event.key === 'w' && activeUnit && activeUnits.length > 1) {\n              const units = activeUnits.map(\n                  (unitAction) => unitAction.value as Unit\n                ),\n                current = units.indexOf(activeUnit),\n                unit = units[current === units.length - 1 ? 0 : current + 1];\n\n              setActiveUnit(unit, portal, unitsMap, activeUnitsMap);\n            }\n\n            if (event.key === 't') {\n              unitsMap.setVisible(!unitsMap.isVisible());\n              citiesMap.setVisible(!citiesMap.isVisible());\n              cityNamesMap.setVisible(!cityNamesMap.isVisible());\n\n              portal.render();\n\n              return;\n            }\n\n            if (event.key === 'y') {\n              yieldsMap.setVisible(!yieldsMap.isVisible());\n\n              portal.render();\n\n              return;\n            }\n\n            if (lastKey === '%' && event.key === '^') {\n              transport.send('cheat', { name: 'RevealMap' });\n\n              return;\n            }\n\n            lastKey = event.key;\n          });\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }\n}\n\nexport default Renderer;\n", "import { Request, RequestArgs, RequestReturn } from './Request';\nimport Transport from './Transport';\n\nexport abstract class AbstractTransport implements Transport {\n  abstract receive(channel: string, handler: (...args: any[]) => void): void;\n  abstract receiveOnce(\n    channel: string,\n    handler: (...args: any[]) => void\n  ): void;\n\n  async request<\n    RequestType extends Request,\n    Args extends any[] = RequestArgs<RequestType>,\n    Return extends any = RequestReturn<RequestType>\n  >(request: Request): Promise<Return> {\n    return new Promise<Return>((resolve) => {\n      this.send(request.channel(), ...request.args());\n\n      this.receiveOnce(request.channel(), (value: Return) => resolve(value));\n    });\n  }\n\n  abstract send(channel: string, data?: any): void;\n}\n\nexport default AbstractTransport;\n", "import AbstractTransport from './AbstractTransport';\nimport { TransportMessage } from './Transport';\n\nexport class WorkerTransport extends AbstractTransport {\n  #worker;\n\n  constructor(worker: Worker) {\n    super();\n\n    this.#worker = worker;\n  }\n\n  receive(receivingChannel: string, handler: (...args: any[]) => void): void {\n    this.#worker.addEventListener('message', ({ data: { channel, data } }) => {\n      if (channel === receivingChannel) {\n        handler(data);\n      }\n    });\n  }\n\n  receiveOnce(\n    receivingChannel: string,\n    handler: (...args: any[]) => void\n  ): void {\n    const onceHandler = ({\n      data: { channel, data },\n    }: MessageEvent<TransportMessage>) => {\n      if (channel === receivingChannel) {\n        handler(data);\n\n        this.#worker.removeEventListener('message', onceHandler);\n      }\n    };\n\n    this.#worker.addEventListener('message', onceHandler);\n  }\n\n  send(channel: string, data: any): void {\n    this.#worker.postMessage({\n      channel,\n      data,\n    });\n  }\n}\n\nexport default WorkerTransport;\n", "import Renderer from './UI/Renderer';\nimport WorkerTransport from './Engine/WorkerTransport';\n\nconst renderer = new Renderer(\n  new WorkerTransport(new Worker('dist/backend.js'))\n);\n\nrenderer.init();\n"],
  "mappings": "u7BAAA,IAAAA,GAAAC,GAAAC,IAAA,cAAa,IAAIC,GAAEC,GAAEF,IAAMA,GAAK,wBAAwB,SAASC,EAAEC,EAAEC,EAAEC,EAAE,CAAC,GAASD,IAAN,KAAS,CAACC,EAAE,MAAM,IAAI,UAAU,+CAA+C,EAAE,GAAe,OAAOF,GAAnB,WAAqBD,IAAIC,GAAG,CAACE,EAAE,CAACF,EAAE,IAAID,CAAC,EAAE,MAAM,IAAI,UAAU,0EAA0E,EAAE,OAAYE,IAAN,IAAQC,EAAQD,IAAN,IAAQC,EAAE,KAAKH,CAAC,EAAEG,EAAEA,EAAE,MAAMF,EAAE,IAAID,CAAC,CAAC,EAAE,OAAO,eAAeD,GAAQ,aAAa,CAAC,MAAM,EAAE,CAAC,EAAEA,GAAQ,aAAa,OAAO,IAAMG,GAAN,KAAO,CAAC,aAAa,CAACF,GAAE,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC,GAAGE,EAAEC,EAAE,CAACD,KAAKD,GAAE,KAAKD,GAAE,GAAG,IAAIC,GAAE,KAAKD,GAAE,GAAG,EAAEE,GAAG,CAAC,GAAGD,GAAE,KAAKD,GAAE,GAAG,EAAEE,GAAG,KAAKC,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,IAAMD,EAAEE,EAAA,IAAI,IAAI,CAAC,EAAE,GAAG,CAAC,EAAE,KAAK,IAAI,EAAEF,CAAC,CAAC,EAA9B,KAAgC,KAAK,GAAG,EAAEA,CAAC,CAAC,CAAC,IAAIA,EAAEC,EAAE,CAAC,GAAG,EAAED,KAAKD,GAAE,KAAKD,GAAE,GAAG,GAAG,OAAO,IAAMK,EAAEJ,GAAE,KAAKD,GAAE,GAAG,EAAEE,GAAG,QAAQC,CAAC,EAAOE,IAAL,IAAQJ,GAAE,KAAKD,GAAE,GAAG,EAAEE,GAAG,OAAOG,EAAE,CAAC,CAAC,CAAC,KAAKH,KAAKC,EAAE,CAACD,KAAKD,GAAE,KAAKD,GAAE,GAAG,GAAGC,GAAE,KAAKD,GAAE,GAAG,EAAEE,GAAG,QAASF,GAAGA,EAAE,GAAGG,CAAC,CAAE,CAAC,CAAC,EAAnWC,EAAAF,GAAA,KAAoWH,GAAQ,aAAaG,GAAEF,GAAE,IAAI,QAAQD,GAAQ,QAAQG,KCA30B,IAAMI,GAAgBC,EAC3BC,GAOG,CACH,IAAMC,EAAoB,CAAC,EACzBC,EAEI,CAAC,EACLC,EAAoB,CAAC,EAEnBC,EAAU,MASd,OAPcJ,EACX,QACC,+BACCK,GAAW,WAAaF,EAAQ,KAAKE,EAAO,MAAM,EAAG,EAAE,CAAC,EAAI,EAC/D,EACC,MAAM,WAAW,EAEd,QAASC,GAAS,CAxB1B,IAAAC,EAyBI,GAAI,CAACD,EAAK,MAAM,SAAS,EAAG,CAC1BF,EAAUE,EAEV,MACF,CAEA,GAAIA,EAAK,KAAO,IAAK,CACnBL,EAAQ,KAAKK,EAAK,MAAM,CAAC,CAAC,EAE1B,MACF,CAEA,GAAIA,EAAK,KAAO,IAAK,CACnBJ,EAAW,GAAKI,EAAK,GAAG,MAAM,CAAC,EAE/B,MACF,CAEA,GAAIA,EAAK,KAAO,IAAK,CACnB,IAAME,EAAQF,EAAK,MAAM,8BAA8B,EAEnDE,IAAU,OACZN,EAAWM,EAAM,MAAOD,EAAAC,EAAM,KAAN,KAAAD,EAAY,IAAI,QACtC,gBACA,CAACC,EAAOC,IAAON,EAAQM,EACzB,GAGF,MACF,CACF,CAAC,EAEM,CAACL,EAASH,EAASC,CAAU,CACtC,EA1D6B,iBA4DhBQ,EAAIX,EAACM,GAAyB,SAAS,eAAeA,CAAM,EAAxD,KAEJM,EAAIZ,EAAA,CACfC,KACGY,IACS,CACZ,GAAM,CAACR,EAASH,EAASC,CAAU,EAAIJ,GAAcE,CAAQ,EAC3DW,EAAI,SAAS,cAAcP,CAAO,EAEpC,OAAIH,EAAQ,QACVU,EAAE,UAAU,IAAI,GAAGV,CAAO,EAG5BY,GAAEF,EAAGT,CAAU,EAEXU,EAAM,QACRD,EAAE,OAAO,GAAGC,CAAK,EAGZD,CACT,EAlBiB,KAkCV,IAAMG,GAAIC,EAAA,CACfC,EACAC,KAEA,OAAO,QAAQA,CAAU,EAAE,QAAQ,CAAC,CAACC,EAAMC,CAAK,IAC9CH,EAAQ,aAAaE,EAAMC,CAAK,CAClC,EAEOH,GARQ,KAWJI,EAAIL,EAAA,CACfC,EACAK,KAEA,OAAO,QAAQA,CAAQ,EAAE,QAAQ,CAAC,CAACC,EAAWC,CAAO,IACnDP,EAAQ,iBAAiBM,EAAWC,CAAO,CAC7C,EAEOP,GARQ,KC9FV,IAAMQ,GAAmBC,EAAA,CAC9B,CAAE,UAAAC,EAAW,QAAAC,CAAQ,EACrBC,EAA6B,OACb,CAChB,IAAMC,EAA6C,IAAI,IAEnDD,GACF,OAAO,KAAKD,CAAO,EAAE,QAASG,GAAOF,EAAU,KAAKE,CAAE,CAAC,EAGzD,IAAMC,EAAgBN,EAACO,GAA4B,CACjD,GAAIH,EAAY,IAAIG,CAAK,EACvB,OAAOH,EAAY,IAAIG,CAAK,EAG9B,GAAI,MAAM,QAAQA,CAAK,EAAG,CACxB,IAAMC,EAAiB,CAAC,EAExB,OAAAJ,EAAY,IAAIG,EAAOC,CAAO,EAE9BD,EAAM,QAASA,GAAUC,EAAQ,KAAKF,EAAcC,CAAK,CAAC,CAAC,EAEpDC,CACT,CAEA,GAAID,GAASA,EAAM,QAAS,CAK1B,GAJIJ,GACFA,EAAU,OAAOA,EAAU,QAAQI,EAAM,OAAO,EAAG,CAAC,EAGlD,EAAEA,EAAM,UAAWL,GACrB,MAAM,IAAI,UAAU,WAAWK,EAAM,SAAS,EAGhD,IAAMC,EAAUF,EAAcJ,EAAQK,EAAM,QAAQ,EAEpD,OAAAH,EAAY,IAAIG,EAAOC,CAAO,EAEvBA,CACT,CAEA,GAAID,aAAiB,OAAQ,CAC3B,IAAMC,EAAuB,CAAC,EAE9B,OAAAJ,EAAY,IAAIG,EAAOC,CAAO,EAE9B,OAAO,QAAQD,CAAK,EAAE,QAAQ,CAAC,CAACE,EAAKC,CAAU,IAAM,CACnDF,EAAQC,GAAOH,EAAcI,CAAU,CACzC,CAAC,EAEMF,CACT,CAEA,OAAOD,CACT,EA5CsB,iBA8CtB,OAAOD,EAAcL,CAAS,CAChC,EAzDgC,oBCbhC,IAAAU,GAOaC,GAAN,KAAkC,CAGvC,YAAYC,EAAuBC,EAAE,KAAK,EAAG,CAF7CC,EAAA,KAAAJ,GAAA,QAGEK,EAAA,KAAKL,GAAWE,EAClB,CAEA,SAASI,EAAmB,CAAC,CAE7B,SAAuB,CACrB,OAAOC,EAAA,KAAKP,GACd,CAEU,OAAc,CACtB,KAAOO,EAAA,KAAKP,IAAS,aAAe,MAClCO,EAAA,KAAKP,IAAS,WAAW,OAAO,CAEpC,CACF,EAlBaQ,EAAAP,GAAA,WACXD,GAAA,YAmBF,IAAOS,EAAQR,GC3Bf,IAAAS,GAAAC,GAAAC,GA8BaC,GAAN,KAAgC,CAKrC,YAAYC,EAAsBC,EAAsB,CAJxDC,EAAA,KAAAN,GAAA,QACAM,EAAA,KAAAL,GAAA,QACAK,EAAA,KAAAJ,GAAA,QAGEK,EAAA,KAAKP,GAAUI,GACfG,EAAA,KAAKL,GAAaG,GAClBE,EAAA,KAAKN,GAAWO,EAAE,YAAY,GAE9BC,EAAA,KAAKR,IAAS,iBAAiB,UAAYS,GAAU,CAC/CA,EAAM,MAAQ,UAIlBA,EAAM,gBAAgB,CACxB,CAAC,EAED,KAAK,MAAM,CACb,CAEO,UAAiB,CAAC,CAEzB,OAAc,CAAC,CAEf,UAAiB,CACf,IAAMA,EAAQ,IAAI,YAAY,WAAY,CACxC,QAAS,GACT,OAAQ,IACV,CAAC,EAEDD,EAAA,KAAKR,IAAS,cAAcS,CAAK,CACnC,CAEA,SAAuB,CACrB,OAAOD,EAAA,KAAKR,GACd,CAEA,WAAuB,CACrB,OAAOQ,EAAA,KAAKP,GACd,CAEA,OAKqB,CACnB,OAAOO,EAAA,KAAKT,IAAQ,KACtB,CACF,EAlDaW,EAAAR,GAAA,UACXH,GAAA,YACAC,GAAA,YACAC,GAAA,YAiDF,IAAOU,EAAQT,GC/Ef,IAAMU,GAAkEC,EAAA,CACtEC,EACAC,IAEAC,EACE,WACAA,EAAE,SAAUC,EAAEH,CAAK,CAAC,EACpBE,EAAE,4DAA4DD,KAAS,EACvEC,EAAE,sBAAsB,EACxBA,EAAE,QAASA,EAAE,wBAAwB,EAAGC,EAAE,MAAM,CAAC,CACnD,EAVsE,YAHxEC,GAAAC,EAAAC,EAAAC,GAAAC,GAiBaC,GAAN,cAA2BC,CAAQ,CAOxC,YAAYV,EAAeW,EAAsB,CAC/C,MAAMb,GAASE,EAAOW,CAAY,CAAC,EAPrCC,EAAA,KAAAR,GAAA,QACAQ,EAAA,KAAAP,EAAA,QACAO,EAAA,KAAAN,EAAA,QACAM,EAAA,KAAAL,GAAA,QACAK,EAAA,KAAAJ,GAA+B,CAAC,GAK9BK,EAAA,KAAKT,GAASJ,GACda,EAAA,KAAKR,EAAS,KAAK,QAAQ,EAAE,cAC3B,qBACF,GACAQ,EAAA,KAAKP,EAAU,KAAK,QAAQ,EAAE,cAC5B,sBACF,GACAO,EAAA,KAAKN,GAAQ,KAAK,QAAQ,EAAE,cAC1B,wBACF,GAEA,KAAK,MAAM,CACb,CAEA,OAAc,CACZ,KAAK,IAAIO,EAAA,KAAKT,GAAO,KAAK,EAE1BS,EAAA,KAAKT,GAAO,iBAAiB,QAAS,IAAM,KAAK,IAAIS,EAAA,KAAKT,GAAO,KAAK,CAAC,EAEvES,EAAA,KAAKR,GAAQ,iBAAiB,QAAS,IAAM,KAAK,IAAIQ,EAAA,KAAKR,GAAQ,KAAK,CAAC,EAEzEQ,EAAA,KAAKP,IAAM,iBAAiB,QAAS,IAAM,KAAK,KAAK,CAAC,EAEtD,KAAK,KAAK,CACZ,CAEA,OAAgB,CACd,OAAOO,EAAA,KAAKV,GACd,CAEQ,MAAa,CACnB,GAAI,KAAK,SAAS,EAAG,CACnBU,EAAA,KAAKT,GAAO,aAAa,WAAY,EAAE,EACvCS,EAAA,KAAKR,GAAQ,aAAa,WAAY,EAAE,EAExC,MACF,CAEAQ,EAAA,KAAKT,GAAO,gBAAgB,UAAU,EACtCS,EAAA,KAAKR,GAAQ,gBAAgB,UAAU,CACzC,CAEA,QAAQS,EAA+B,CACrCD,EAAA,KAAKN,IAAW,KAAKO,CAAO,CAC9B,CAEA,UAAoB,CAClB,OAAOD,EAAA,KAAKP,IAAM,OACpB,CAEA,IAAIN,EAAqB,CACvBA,EAAQ,KAAK,IAAI,SAASA,EAAO,EAAE,EAAG,CAAC,EAAE,SAAS,EAE9Ca,EAAA,KAAKT,GAAO,QAAUJ,IACxBa,EAAA,KAAKT,GAAO,MAAQJ,GAGlBa,EAAA,KAAKR,GAAQ,QAAUL,IACzBa,EAAA,KAAKR,GAAQ,MAAQL,GAGvBa,EAAA,KAAKN,IAAW,QAASQ,GAAaA,EAAS,CAAC,CAClD,CAEA,OAAgB,CACd,OAAO,SAASF,EAAA,KAAKT,GAAO,MAAO,EAAE,CACvC,CACF,EA7EaN,EAAAU,GAAA,gBACXL,GAAA,YACAC,EAAA,YACAC,EAAA,YACAC,GAAA,YACAC,GAAA,YA0EF,IAAOS,GAAQR,GChGf,IAAAS,GAEaC,GAAN,KAAwB,CAG7B,eAAeC,EAAyB,CAFxCC,EAAA,KAAAH,GAAA,QAGEI,EAAA,KAAKJ,GAAWE,GAEhBG,EAAA,KAAKL,IAAS,QAASM,GACrBA,EAAO,QAAQ,IAAM,CACnB,GAAI,KAAK,MAAM,IAAM,IACnB,OAGF,IAAMC,EAAeF,EAAA,KAAKL,IAAS,OAC9BQ,GAAgBA,IAAgBF,CACnC,EACAG,EAAqBF,EAAa,OAC/BD,GAAW,CAACA,EAAO,SAAS,CAC/B,EAEF,GAAI,KAAK,MAAM,IAAM,KAAOG,EAAmB,SAAW,EAAG,CAC3DH,EAAO,KAAK,IAAM,KAAK,MAAMC,CAAY,GAAG,SAAS,CAAC,EAEtD,MACF,CAEA,GAAI,KAAK,MAAM,EAAI,IAAK,CACtB,IAAIG,EAAU,KAAK,MAAM,EAAI,IAC3BC,EAAQ,KAAK,KAAKD,EAAUD,EAAmB,MAAM,EAEvDA,EAAmB,QAASD,GAAgB,CAC1CA,EAAY,KACTA,EAAY,MAAM,EAAI,KAAK,IAAIG,EAAOD,CAAO,GAAG,SAAS,CAC5D,EAEAA,GAAWC,CACb,CAAC,EAEG,KAAK,MAAM,EAAI,KACjBL,EAAO,KAAK,IAAM,KAAK,MAAMC,CAAY,GAAG,SAAS,CAAC,CAE1D,CAEA,GAAI,KAAK,MAAM,EAAI,IAAK,CACtB,IAAIK,EAAY,IAAM,KAAK,MAAM,EAC/BD,EAAQ,KAAK,KAAKC,EAAYH,EAAmB,MAAM,EAEzDA,EAAmB,QAASD,GAAgB,CAC1CA,EAAY,KACTA,EAAY,MAAM,EAAI,KAAK,IAAIG,EAAOC,CAAS,GAAG,SAAS,CAC9D,EAEAA,GAAaD,CACf,CAAC,EAEG,KAAK,MAAM,EAAI,KACjBL,EAAO,KAAK,IAAM,KAAK,MAAMC,CAAY,GAAG,SAAS,CAAC,CAE1D,CACF,CAAC,CACH,CACF,CAEA,SAA0B,CACxB,OAAOF,EAAA,KAAKL,GACd,CAEQ,MAAME,EAAUG,EAAA,KAAKL,IAAkB,CAC7C,OAAOE,EAAQ,OAAO,CAACW,EAAOP,IAAWO,EAAQP,EAAO,MAAM,EAAG,CAAC,CACpE,CACF,EArEaQ,EAAAb,GAAA,qBACXD,GAAA,YAsEF,IAAOe,GAAQd,GCzEf,IAAAe,GAQaC,GAAN,cAA+BC,EAAqC,CAGzE,YAAYC,EAAqBC,EAAuBC,EAAE,KAAK,EAAG,CAChE,MAAMD,CAAO,EAHfE,EAAA,KAAAN,GAAA,QAME,KAAK,QAAQ,EAAE,iBAAiB,UAAYO,GAAyB,CACnEA,EAAM,gBAAgB,CACxB,CAAC,EAED,KAAK,QAAQ,EAAE,aAAa,WAAY,GAAG,EAE3CC,EAAA,KAAKR,GAAUG,EACjB,CAEO,SAAgB,CACrB,KAAK,MAAM,EAEXM,EAAA,KAAKT,IAAQ,OAAO,KAAK,QAAQ,CAAC,CACpC,CAEO,QAAsB,CAC3B,OAAOS,EAAA,KAAKT,GACd,CACF,EAzBaU,EAAAT,GAAA,oBACXD,GAAA,YA0BF,IAAOW,GAAQV,GCLf,IAAMW,GAAiC,CACrC,YAAa,GACb,SAAU,GACV,YAAa,GACb,UAAW,GACX,OAAQ,SAAS,KACjB,SAAU,OACV,KAAM,MACR,EAtCAC,GAAAC,GAwCaC,GAAN,cAAqBC,EAAoC,CAK9D,YAAYC,EAAeC,EAAqBC,EAAyB,CAAC,EAAG,CA7C/E,IAAAC,EA8CI,OAAMA,EAAAD,EAAQ,SAAR,KAAAC,EAAkBR,GAAe,OAAQS,EAAE,YAAY,CAAC,EAJhEC,EAAA,KAAAT,GAAA,QACAS,EAAA,KAAAR,GAAA,QAKE,QAAK,QAAU,CACb,GAAGF,GACH,GAAGO,CACL,EAEAI,EAAA,KAAKV,GAAQK,GACbK,EAAA,KAAKT,GAASG,GAEV,KAAK,QAAQ,OAAS,QACxB,KAAK,QAAQ,EAAE,UAAU,IAAI,WAAW,EAGtC,KAAK,QAAQ,OAAS,aACxB,KAAK,QAAQ,EAAE,UAAU,IAAI,WAAW,EAGtC,KAAK,QAAQ,OAAS,QACvB,CAAC,SAAU,OAAO,EAA6B,QAASO,GAAc,CACrE,IAAMC,EAAS,KAAK,QAAQ,KAAoBD,GAEhD,GAAI,OAAOC,GAAU,SAAU,CAC7B,KAAK,QAAQ,EAAE,MAAMD,GAAaC,EAAQ,KAE1C,MACF,CAEA,KAAK,QAAQ,EAAE,MAAMD,GAAaC,CACpC,CAAC,EAGC,KAAK,QAAQ,WAAa,QAC5B,KAAK,QAAQ,EAAE,UAAU,IAAI,eAAe,EAG1C,KAAK,QAAQ,WAAa,QAE1B,CACE,CAAC,IAAK,MAAM,EACZ,CAAC,IAAK,KAAK,CACb,EACA,QAAQ,CAAC,CAACC,EAAMC,CAAQ,IAAM,CAC9B,KAAK,QAAQ,EAAE,MAAMA,GACnB,KAAK,IACH,EACA,KAAK,IACH,SAAS,KAAK,aAAe,GAC5B,KAAK,QAAQ,SAA4BD,EAC5C,CACF,EAAI,IACR,CAAC,EAGC,KAAK,QAAQ,YAAa,CAC5B,KAAK,QAAQ,EAEb,MACF,CAEA,KAAK,MAAM,CACb,CAEO,OAAc,CACnB,KAAK,MAAM,EAEX,IAAME,EACJ,CACE,CACE,KAAK,QAAQ,YACbC,EACER,EACE,yCACAS,EAAE,UAAU,EACZT,EACE,4fACF,EACAA,EACE,0fACF,CACF,EACA,CACE,MAAO,IAAM,KAAK,SAAS,CAC7B,CACF,CACF,EACA,CACE,KAAK,QAAQ,SACbQ,EACER,EACE,mCACAS,EAAE,OAAO,EACTT,EACE,ocACF,CACF,EACA,CACE,MAAO,IAAM,KAAK,MAAM,CAC1B,CACF,CACF,CACF,EAEC,OAAO,CAAC,CAACU,CAAI,IAA8BA,CAAI,EAC/C,IAAI,CAAC,CAAC,CAAEC,CAAO,IAAMA,CAAO,EAE3BC,EAAa,GAEjB,KAAK,QAAQ,EAAE,OACbJ,EAAER,EAAE,SAAUA,EAAE,KAAMS,EAAEI,EAAA,KAAKpB,GAAM,CAAC,EAAG,GAAGc,CAAa,EAAG,CACxD,SAAU,IAAM,KAAK,SAAS,EAC9B,UAAYO,GAAU,CACpB,GAAIA,EAAM,OAAO,QAAQ,oBAAoB,EAC3C,OAGFF,EAAa,GAEb,IAAMG,EAAcC,EAACF,GAAsB,CACzC,GAAI,CAACF,EACH,OAGF,IAAMK,EAAuB,iBAAiB,KAAK,QAAQ,CAAC,EAC1DC,EAAa,SACXD,EAAqB,iBAAiB,KAAK,EAC3C,EACF,EACAE,EAAc,SACZF,EAAqB,iBAAiB,MAAM,EAC5C,EACF,EAEF,KAAK,QAAQ,EAAE,MAAM,YACnB,MACAC,EAAaJ,EAAM,UAAY,IACjC,EACA,KAAK,QAAQ,EAAE,MAAM,YACnB,OACAK,EAAcL,EAAM,UAAY,IAClC,CACF,EAvBoB,eAyBpB,SAAS,iBAAiB,YAAaC,CAAW,EAElD,SAAS,iBACP,UACA,IAAM,CACJ,SAAS,oBAAoB,YAAaA,CAAW,EAErDH,EAAa,EACf,EACA,CACE,KAAM,EACR,CACF,CACF,CACF,CAAC,EACDZ,EACE,WACAa,EAAA,KAAKrB,cAAiB,KAAOqB,EAAA,KAAKrB,IAAQQ,EAAE,IAAKS,EAAEI,EAAA,KAAKrB,GAAK,CAAC,CAChE,CACF,EAEA,KAAK,QAAQ,EAAE,iBAAiB,UAAYsB,GAAyB,CAC/DA,EAAM,MAAQ,UAAY,KAAK,QAAQ,UACzC,KAAK,MAAM,EAIbA,EAAM,gBAAgB,CACxB,CAAC,CACH,CAEO,OAAc,CACnB,KAAK,QAAQ,EAAE,OAAO,EAEtB,KAAK,QAAQ,EAAE,cAAc,IAAI,YAAY,OAAO,CAAC,CACvD,CAEO,QAAQM,EAAQ,GAAY,CACjC,MAAM,QAAQ,EAETA,GAIL,KAAK,QAAQ,EAAE,MAAM,CACvB,CAEO,UAAiB,CAClB,CAAC,KAAK,QAAQ,aAIlB,KAAK,QAAQ,EAAE,UAAU,OAAO,WAAW,CAC7C,CAEO,OAAOC,EAA8B,CAC1C,KAAK,QAAQ,EAAE,iBAAkB,OAAO,EAExC,KAAK,QAAQ,EAAE,OACbA,aAAmB,KAAOA,EAAUrB,EAAE,IAAKS,EAAEY,CAAO,CAAC,CACvD,CACF,CACF,EAnNaL,EAAAtB,GAAA,UAEXF,GAAA,YACAC,GAAA,YAkNF,IAAO6B,GAAQ5B,GC7Pf,IAAM6B,GAAgBC,EAAA,CAACC,EAAQC,IAAiBA,EAAa,KAAMC,GAAMF,aAAkBE,CAAC,EAAtE,iBAElBC,GACAC,GAEJ,SAASC,IAAuB,CAC5B,OAAQF,KACHA,GAAoB,CACjB,YACA,eACA,SACA,UACA,cACJ,EACR,CATSJ,EAAAM,GAAA,wBAWT,SAASC,IAA0B,CAC/B,OAAQF,KACHA,GAAuB,CACpB,UAAU,UAAU,QACpB,UAAU,UAAU,SACpB,UAAU,UAAU,kBACxB,EACR,CAPSL,EAAAO,GAAA,2BAQT,IAAMC,GAAmB,IAAI,QACvBC,GAAqB,IAAI,QACzBC,GAA2B,IAAI,QAC/BC,GAAiB,IAAI,QACrBC,GAAwB,IAAI,QAClC,SAASC,GAAiBC,EAAS,CAC/B,IAAMC,EAAU,IAAI,QAAQ,CAACC,EAASC,IAAW,CAC7C,IAAMC,EAAWlB,EAAA,IAAM,CACnBc,EAAQ,oBAAoB,UAAWK,CAAO,EAC9CL,EAAQ,oBAAoB,QAASM,CAAK,CAC9C,EAHiB,YAIXD,EAAUnB,EAAA,IAAM,CAClBgB,EAAQK,EAAKP,EAAQ,MAAM,CAAC,EAC5BI,EAAS,CACb,EAHgB,WAIVE,EAAQpB,EAAA,IAAM,CAChBiB,EAAOH,EAAQ,KAAK,EACpBI,EAAS,CACb,EAHc,SAIdJ,EAAQ,iBAAiB,UAAWK,CAAO,EAC3CL,EAAQ,iBAAiB,QAASM,CAAK,CAC3C,CAAC,EACD,OAAAL,EACK,KAAMO,GAAU,CAGbA,aAAiB,WACjBd,GAAiB,IAAIc,EAAOR,CAAO,CAG3C,CAAC,EACI,MAAM,IAAM,CAAE,CAAC,EAGpBF,GAAsB,IAAIG,EAASD,CAAO,EACnCC,CACX,CA/BSf,EAAAa,GAAA,oBAgCT,SAASU,GAA+BC,EAAI,CAExC,GAAIf,GAAmB,IAAIe,CAAE,EACzB,OACJ,IAAMC,EAAO,IAAI,QAAQ,CAACT,EAASC,IAAW,CAC1C,IAAMC,EAAWlB,EAAA,IAAM,CACnBwB,EAAG,oBAAoB,WAAYE,CAAQ,EAC3CF,EAAG,oBAAoB,QAASJ,CAAK,EACrCI,EAAG,oBAAoB,QAASJ,CAAK,CACzC,EAJiB,YAKXM,EAAW1B,EAAA,IAAM,CACnBgB,EAAQ,EACRE,EAAS,CACb,EAHiB,YAIXE,EAAQpB,EAAA,IAAM,CAChBiB,EAAOO,EAAG,OAAS,IAAI,aAAa,aAAc,YAAY,CAAC,EAC/DN,EAAS,CACb,EAHc,SAIdM,EAAG,iBAAiB,WAAYE,CAAQ,EACxCF,EAAG,iBAAiB,QAASJ,CAAK,EAClCI,EAAG,iBAAiB,QAASJ,CAAK,CACtC,CAAC,EAEDX,GAAmB,IAAIe,EAAIC,CAAI,CACnC,CAxBSzB,EAAAuB,GAAA,kCAyBT,IAAII,GAAgB,CAChB,IAAIC,EAAQC,EAAMC,EAAU,CACxB,GAAIF,aAAkB,eAAgB,CAElC,GAAIC,IAAS,OACT,OAAOpB,GAAmB,IAAImB,CAAM,EAExC,GAAIC,IAAS,mBACT,OAAOD,EAAO,kBAAoBlB,GAAyB,IAAIkB,CAAM,EAGzE,GAAIC,IAAS,QACT,OAAOC,EAAS,iBAAiB,GAC3B,OACAA,EAAS,YAAYA,EAAS,iBAAiB,EAAE,CAE/D,CAEA,OAAOT,EAAKO,EAAOC,EAAK,CAC5B,EACA,IAAID,EAAQC,EAAMP,EAAO,CACrB,OAAAM,EAAOC,GAAQP,EACR,EACX,EACA,IAAIM,EAAQC,EAAM,CACd,OAAID,aAAkB,iBACjBC,IAAS,QAAUA,IAAS,SACtB,GAEJA,KAAQD,CACnB,CACJ,EACA,SAASG,GAAaC,EAAU,CAC5BL,GAAgBK,EAASL,EAAa,CAC1C,CAFS3B,EAAA+B,GAAA,gBAGT,SAASE,GAAaC,EAAM,CAIxB,OAAIA,IAAS,YAAY,UAAU,aAC/B,EAAE,qBAAsB,eAAe,WAChC,SAAUC,KAAeC,EAAM,CAClC,IAAMZ,EAAKU,EAAK,KAAKG,GAAO,IAAI,EAAGF,EAAY,GAAGC,CAAI,EACtD,OAAA1B,GAAyB,IAAIc,EAAIW,EAAW,KAAOA,EAAW,KAAK,EAAI,CAACA,CAAU,CAAC,EAC5Ed,EAAKG,CAAE,CAClB,EAOAjB,GAAwB,EAAE,SAAS2B,CAAI,EAChC,YAAaE,EAAM,CAGtB,OAAAF,EAAK,MAAMG,GAAO,IAAI,EAAGD,CAAI,EACtBf,EAAKb,GAAiB,IAAI,IAAI,CAAC,CAC1C,EAEG,YAAa4B,EAAM,CAGtB,OAAOf,EAAKa,EAAK,MAAMG,GAAO,IAAI,EAAGD,CAAI,CAAC,CAC9C,CACJ,CA9BSpC,EAAAiC,GAAA,gBA+BT,SAASK,GAAuBhB,EAAO,CACnC,OAAI,OAAOA,GAAU,WACVW,GAAaX,CAAK,GAGzBA,aAAiB,gBACjBC,GAA+BD,CAAK,EACpCvB,GAAcuB,EAAOhB,GAAqB,CAAC,EACpC,IAAI,MAAMgB,EAAOK,EAAa,EAElCL,EACX,CAXStB,EAAAsC,GAAA,0BAYT,SAASjB,EAAKC,EAAO,CAGjB,GAAIA,aAAiB,WACjB,OAAOT,GAAiBS,CAAK,EAGjC,GAAIX,GAAe,IAAIW,CAAK,EACxB,OAAOX,GAAe,IAAIW,CAAK,EACnC,IAAMiB,EAAWD,GAAuBhB,CAAK,EAG7C,OAAIiB,IAAajB,IACbX,GAAe,IAAIW,EAAOiB,CAAQ,EAClC3B,GAAsB,IAAI2B,EAAUjB,CAAK,GAEtCiB,CACX,CAjBSvC,EAAAqB,EAAA,QAkBT,IAAMgB,GAASrC,EAACsB,GAAUV,GAAsB,IAAIU,CAAK,EAA1C,UC5Kf,SAASkB,GAAOC,EAAMC,EAAS,CAAE,QAAAC,EAAS,QAAAC,EAAS,SAAAC,EAAU,WAAAC,CAAW,EAAI,CAAC,EAAG,CAC5E,IAAMC,EAAU,UAAU,KAAKN,EAAMC,CAAO,EACtCM,EAAcC,EAAKF,CAAO,EAChC,OAAIH,GACAG,EAAQ,iBAAiB,gBAAkBG,GAAU,CACjDN,EAAQK,EAAKF,EAAQ,MAAM,EAAGG,EAAM,WAAYA,EAAM,WAAYD,EAAKF,EAAQ,WAAW,EAAGG,CAAK,CACtG,CAAC,EAEDP,GACAI,EAAQ,iBAAiB,UAAYG,GAAUP,EAE/CO,EAAM,WAAYA,EAAM,WAAYA,CAAK,CAAC,EAE9CF,EACK,KAAMG,GAAO,CACVL,GACAK,EAAG,iBAAiB,QAAS,IAAML,EAAW,CAAC,EAC/CD,GACAM,EAAG,iBAAiB,gBAAkBD,GAAUL,EAASK,EAAM,WAAYA,EAAM,WAAYA,CAAK,CAAC,CAE3G,CAAC,EACI,MAAM,IAAM,CAAE,CAAC,EACbF,CACX,CAvBSI,EAAAZ,GAAA,UAuCT,IAAMa,GAAc,CAAC,MAAO,SAAU,SAAU,aAAc,OAAO,EAC/DC,GAAe,CAAC,MAAO,MAAO,SAAU,OAAO,EAC/CC,GAAgB,IAAI,IAC1B,SAASC,GAAUC,EAAQC,EAAM,CAC7B,GAAI,EAAED,aAAkB,aACpB,EAAEC,KAAQD,IACV,OAAOC,GAAS,UAChB,OAEJ,GAAIH,GAAc,IAAIG,CAAI,EACtB,OAAOH,GAAc,IAAIG,CAAI,EACjC,IAAMC,EAAiBD,EAAK,QAAQ,aAAc,EAAE,EAC9CE,EAAWF,IAASC,EACpBE,EAAUP,GAAa,SAASK,CAAc,EACpD,GAEA,EAAEA,KAAmBC,EAAW,SAAW,gBAAgB,YACvD,EAAEC,GAAWR,GAAY,SAASM,CAAc,GAChD,OAEJ,IAAMG,EAASC,EAAA,eAAgBC,KAAcC,EAAM,CAE/C,IAAMC,EAAK,KAAK,YAAYF,EAAWH,EAAU,YAAc,UAAU,EACrEJ,EAASS,EAAG,MAChB,OAAIN,IACAH,EAASA,EAAO,MAAMQ,EAAK,MAAM,CAAC,IAM9B,MAAM,QAAQ,IAAI,CACtBR,EAAOE,GAAgB,GAAGM,CAAI,EAC9BJ,GAAWK,EAAG,IAClB,CAAC,GAAG,EACR,EAfe,UAgBf,OAAAX,GAAc,IAAIG,EAAMI,CAAM,EACvBA,CACX,CAnCSC,EAAAP,GAAA,aAoCTW,GAAcC,IAAc,CACxB,GAAGA,EACH,IAAK,CAACX,EAAQC,EAAMW,IAAab,GAAUC,EAAQC,CAAI,GAAKU,EAAS,IAAIX,EAAQC,EAAMW,CAAQ,EAC/F,IAAK,CAACZ,EAAQC,IAAS,CAAC,CAACF,GAAUC,EAAQC,CAAI,GAAKU,EAAS,IAAIX,EAAQC,CAAI,CACjF,EAAE,EC5FF,IAAAY,GAAAC,EAaaC,GAAN,KAAoC,CAIzC,YACEC,EACAC,EACAC,EACA,CAPFC,EAAA,KAAAN,GAAA,QACAM,EAAA,KAAAL,EAAA,QAOEM,EAAA,KAAKN,EAASG,GAEdG,EAAA,KAAKP,GAAcQ,GAAOL,EAAI,EAAG,CAC/B,QAAUA,GAAOA,EAAG,kBAAkBM,EAAA,KAAKR,GAAQI,CAAO,CAC5D,CAAC,EACH,CAEA,MAAM,IAAIK,EAAyC,CACjD,OAAQ,MAAMD,EAAA,KAAKT,KAAa,IAAIS,EAAA,KAAKR,GAAQS,CAAG,CACtD,CAEA,MAAM,OACJC,EACAC,EACA,CACA,OAAQ,MAAMH,EAAA,KAAKT,KAAa,OAAOS,EAAA,KAAKR,GAAQU,EAAOC,CAAK,CAClE,CAEA,MAAM,IACJC,EACAH,EACA,CACA,OAAQ,MAAMD,EAAA,KAAKT,KAAa,IAAIS,EAAA,KAAKR,GAAQY,EAAQH,CAAG,CAC9D,CAEA,MAAM,OAAQ,CACZ,OAAQ,MAAMD,EAAA,KAAKT,KAAa,MAAMS,EAAA,KAAKR,EAAM,CACnD,CAEA,MAAM,MAAO,CACX,OAAQ,MAAMQ,EAAA,KAAKT,KAAa,WAAWS,EAAA,KAAKR,EAAM,CACxD,CACF,EAzCaa,EAAAZ,GAAA,SACXF,GAAA,YACAC,EAAA,YCXK,IAAMc,GAAaC,EAAA,CACxBC,EACAC,EACAC,IACsB,CACtB,IAAMC,EAAY,SAAS,cAAc,QAAQ,EAC/CC,EAAUD,EAAU,WAAW,IAAI,EAErC,OAAAA,EAAU,MAASH,EAAM,MAAmBC,EAC5CE,EAAU,OAAUH,EAAM,OAAoBC,EAEzCC,GAAA,MAAAA,EAAS,YACZE,EAAQ,sBAAwB,IAGlCA,EAAQ,UAAUJ,EAAO,EAAG,EAAGG,EAAU,MAAOA,EAAU,MAAM,EAEzDA,CACT,EAlB0B,cAoBnBE,GAAQP,GCxBf,IAAAQ,GAAAC,GAAAC,GAAAC,GAQaC,GAAN,cAAyBC,EAK7B,CAqSD,aAAc,CACZ,MAAM,mBAAoB,SAAU,CAClC,QAAS,MACX,CAAC,EAvSHC,EAAA,KAAAN,GAAgB,IAAI,KACpBM,EAAA,KAAAL,GAAgB,IAAI,KACpBK,EAAA,KAAAJ,GAAsB,IAAI,KAC1BI,EAAA,KAAAH,GAA4B,CAC1B,yBACA,yBACA,yBACA,2BACA,qCACA,qCACA,mCACA,mCACA,kCACA,mCACA,+BACA,qCACA,qCACA,8BACA,wBACA,+BACA,0BACA,yBACA,4BACA,iCACA,iCACA,uCACA,iCACA,sCACA,uCACA,wCACA,uCACA,wCACA,wCACA,uCACA,wCACA,uCACA,mCACA,mCACA,oCACA,oCACA,mCACA,oCACA,oCACA,mCACA,wBACA,yBACA,yBACA,yBACA,yBACA,wBACA,2BACA,uBACA,kCACA,mCACA,mCACA,mCACA,gCACA,iCACA,iCACA,iCACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,4BACA,oCACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,2BACA,4BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,4BACA,4BACA,iCACA,mCACA,oCACA,qCACA,oCACA,mCACA,oCACA,qCACA,sCACA,qCACA,oCACA,qCACA,oCACA,mCACA,oCACA,mCACA,6BACA,+BACA,gCACA,iCACA,gCACA,+BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,+BACA,6BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,4BACA,iCACA,mCACA,oCACA,qCACA,oCACA,mCACA,oCACA,qCACA,sCACA,qCACA,oCACA,qCACA,oCACA,mCACA,oCACA,mCACA,6BACA,6BACA,2BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,iCACA,gCACA,qCACA,qCACA,qCACA,qCACA,6BACA,+BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,+BACA,4BACA,8BACA,4BACA,6BACA,+BACA,gCACA,iCACA,gCACA,+BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,+BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,0BACA,+BACA,gCACA,4BACA,4BACA,6BACA,6BACA,8BACA,8BACA,6BACA,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,6BACA,8BACA,6BACA,6BACA,8BACA,4BACA,8BACA,wCACA,6BACA,+BACA,6BACA,8BACA,8BACA,0BACA,8BACA,+BACA,+BACA,4BACF,EAMA,CAEA,MAAM,IAAII,EAA8B,CACtC,OAAKC,EAAA,KAAKR,IAAc,IAAIO,CAAI,GAC9BC,EAAA,KAAKR,IAAc,IAAIO,EAAO,MAAM,MAAM,IAAIA,CAAI,CAAG,EAGhDC,EAAA,KAAKR,IAAc,IAAIO,CAAI,CACpC,CAEA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",
  "names": ["require_EventEmitter", "__commonJSMin", "exports", "t", "e", "i", "s", "__name", "r", "parseSelector", "__name", "selector", "classes", "attributes", "strings", "element", "string", "part", "_a", "match", "id", "t", "e", "nodes", "a", "a", "__name", "element", "attributes", "name", "value", "h", "handlers", "eventName", "handler", "reconstituteData", "__name", "hierarchy", "objects", "orphanIds", "seenObjects", "id", "getReferences", "value", "updated", "key", "childValue", "_element", "Element", "element", "e", "__privateAdd", "__privateSet", "args", "__privateGet", "__name", "Element_default", "_action", "_element", "_transport", "Action", "action", "transport", "__privateAdd", "__privateSet", "e", "__privateGet", "event", "__name", "Action_default", "template", "__name", "label", "value", "e", "t", "_label", "_range", "_number", "_lock", "_listeners", "LockedSlider", "Element_default", "currentValue", "__privateAdd", "__privateSet", "__privateGet", "handler", "listener", "LockedSlider_default", "_sliders", "LockedSliderGroup", "sliders", "__privateAdd", "__privateSet", "__privateGet", "slider", "otherSliders", "otherSlider", "otherActiveSliders", "overage", "chunk", "remaining", "total", "__name", "LockedSliderGroup_default", "_parent", "TransientElement", "Element", "parent", "element", "e", "__privateAdd", "event", "__privateSet", "__privateGet", "__name", "TransientElement_default", "defaultOptions", "_body", "_title", "Window", "TransientElement_default", "title", "body", "options", "_a", "e", "__privateAdd", "__privateSet", "dimension", "value", "axis", "property", "headerActions", "h", "t", "show", "element", "isDragging", "__privateGet", "event", "moveHandler", "__name", "elementComputedStyle", "currentTop", "currentLeft", "focus", "content", "Window_default", "instanceOfAny", "__name", "object", "constructors", "c", "idbProxyableTypes", "cursorAdvanceMethods", "getIdbProxyableTypes", "getCursorAdvanceMethods", "cursorRequestMap", "transactionDoneMap", "transactionStoreNamesMap", "transformCache", "reverseTransformCache", "promisifyRequest", "request", "promise", "resolve", "reject", "unlisten", "success", "error", "wrap", "value", "cacheDonePromiseForTransaction", "tx", "done", "complete", "idbProxyTraps", "target", "prop", "receiver", "replaceTraps", "callback", "wrapFunction", "func", "storeNames", "args", "unwrap", "transformCachableValue", "newValue", "openDB", "name", "version", "blocked", "upgrade", "blocking", "terminated", "request", "openPromise", "wrap", "event", "db", "__name", "readMethods", "writeMethods", "cachedMethods", "getMethod", "target", "prop", "targetFuncName", "useIndex", "isWrite", "method", "__name", "storeName", "args", "tx", "replaceTraps", "oldTraps", "receiver", "_connection", "_store", "Store", "db", "store", "options", "__privateAdd", "__privateSet", "openDB", "__privateGet", "key", "query", "count", "record", "__name", "scaleImage", "__name", "image", "scale", "options", "newCanvas", "context", "scaleImage_default", "_cachedAssets", "_cachedImages", "_cachedScaledImages", "_requiredAssets", "AssetStore", "Store", "__privateAdd", "path", "__privateGet", "asset", "image", "scale", "scaleImage_default", "dbAssets", "requiredAsset", "__name", "assetStore", "_sliderGroup", "AdjustTradeRates", "Action_default", "__privateAdd", "sliders", "Window_default", "e", "tradeRate", "slider", "LockedSlider_default", "__privateGet", "__privateSet", "LockedSliderGroup_default", "assetStore", "asset", "__name", "AdjustTradeRates_default", "notificationQueue", "_options", "_NotificationWindow", "Window", "title", "body", "passedOptions", "options", "__privateAdd", "__privateSet", "event", "__privateGet", "notification", "focus", "resolve", "NotificationWindow", "__name", "NotificationWindow_default", "_resizeHandler", "_selectionList", "SelectionWindow", "NotificationWindow", "title", "optionList", "onChoose", "body", "options", "_a", "_b", "selectionWindow", "chooseHandler", "__name", "selection", "selectionList", "h", "e", "option", "t", "event", "label", "action", "__privateAdd", "__privateSet", "__privateGet", "select", "SelectionWindow_default", "ChooseResearch", "Action_default", "chooseWindow", "SelectionWindow_default", "advance", "selection", "assetStore", "asset", "e", "__name", "ChooseResearch_default", "knownGroups", "knownGroupLookup", "object", "yieldName", "group", "knownIcons", "preloadContainer", "setPreloadContainer", "__name", "preloadContainerElement", "getPreloadedImage", "path", "image", "e", "getPreloadedImage_default", "replaceColours", "__name", "image", "source", "replacement", "canvas", "e", "context", "imageData", "getColor", "input", "_a", "match", "color", "sourceColors", "replaceColors", "i", "n", "replaceColours_default", "_canvas", "_context", "_visible", "_scale", "_tileSize", "_world", "Map", "world", "scale", "tileSize", "canvas", "e", "__privateAdd", "__privateSet", "__privateGet", "setPreloadContainer", "tiles", "x", "y", "size", "offsetX", "offsetY", "tilesToUpdate", "path", "options", "_a", "_b", "image", "tile", "filter", "directions", "direction", "getPreloadedImage", "source", "replacement", "replaceColours_default", "visible", "__name", "Map_default", "Cities", "Map", "tile", "x", "y", "size", "offsetX", "offsetY", "city", "player", "civilization", "colors", "attribute", "image", "__name", "Cities_default", "ConfirmationWindow", "NotificationWindow", "title", "details", "onOK", "options", "_a", "_b", "confirmationButton", "h", "e", "t", "event", "__name", "ConfirmationWindow_default", "_handler", "_ids", "DataObserver", "ids", "handler", "__privateAdd", "__privateSet", "event", "detail", "objects", "__privateGet", "id", "__name", "DataObserver_default", "TerrainAbstract", "Map", "tilesToUpdate", "extendedTilesToUpdate", "tile", "direction", "target", "__name", "TerrainAbstract_default", "Feature", "TerrainAbstract_default", "tile", "x", "y", "feature", "__name", "Feature_default", "Fog", "TerrainAbstract_default", "tile", "x", "y", "direction", "__name", "Fog_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "improvements", "state", "improvement", "improvementType", "improvementName", "neighbouringRoad", "adjoiningTile", "neighbouringRailroad", "direction", "size", "offsetX", "offsetY", "center", "__name", "Improvements_default", "InactiveUnitSelectionWindow", "SelectionWindow_default", "units", "transport", "onComplete", "unit", "_a", "_b", "selection", "tileUnit", "__name", "InactiveUnitSelectionWindow_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "improvement", "__name", "Irrigation_default", "Land", "TerrainAbstract_default", "tile", "x", "y", "size", "offsetX", "offsetY", "sprite", "bitmask", "topLeftSubtileOffset", "topRightSubtileOffset", "bottomRightSubtileOffset", "bottomLeftSubtileOffset", "image", "e", "imageContext", "direction", "__name", "Land_default", "import_typed_event_emitter", "defaultPortalOptions", "_canvas", "_center", "_context", "_layers", "_playerId", "_scale", "_tileSize", "_transport", "_world", "Portal", "world", "transport", "canvas", "e", "options", "layers", "settings", "__privateAdd", "__privateSet", "MapType", "__privateGet", "updatedTiles", "layer", "LayerType", "_a", "x", "y", "visibleHorizontal", "visibleVertical", "xLowerBound", "xUpperBound", "yLowerBound", "yUpperBound", "tileSize", "layerWidth", "centerX", "portalCenterX", "layerHeight", "centerY", "portalCenterY", "startX", "endX", "startY", "endY", "xRange", "yRange", "__name", "Portal_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "adjoining", "adjoiningTile", "__name", "Terrain_default", "_unknown", "_lookupCache", "_tiles", "_height", "_width", "World", "world", "__privateAdd", "__name", "x", "y", "__privateSet", "__privateGet", "key", "index", "tile", "direction", "tiles", "World_default", "Yields", "Map_default", "tile", "x", "y", "size", "offsetX", "offsetY", "total", "tileYield", "yields", "a", "b", "i", "offsets", "n", "__name", "Yields_default", "busyLookup", "renderUnit", "__name", "unit", "tileSize", "_a", "_b", "player", "civilization", "colors", "attribute", "unitCanvas", "replaceColours_default", "getPreloadedImage_default", "context", "improvement", "sizeOffsetX", "sizeOffsetY", "identifier", "renderUnit_default", "_scale", "Unit", "Element_default", "unit", "scale", "e", "__privateAdd", "__privateSet", "unitCanvas", "renderUnit_default", "context", "sizeX", "sizeY", "offsetX", "offsetY", "size", "__privateGet", "__name", "Unit_default", "buildTurns", "__name", "city", "cityYield", "knownGroupLookup", "total", "growthTurns", "renderPopulation", "growth", "mask", "happiness", "unhappiness", "state", "currentIndex", "population", "e", "status", "index", "assetStore", "image", "reduceYield", "type", "cityYields", "used", "free", "renderYields", "cityYieldNames", "cityYieldName", "i", "yieldImages", "knownGroups", "yieldObject", "label", "value", "t", "renderMap", "portal", "transport", "portalCanvas", "cityPortal", "Portal_default", "World_default", "Land_default", "Irrigation_default", "Terrain_default", "Improvements_default", "Feature_default", "Fog_default", "Cities_default", "Yields_default", "h", "icon", "knownIcons", "renderBuildDetails", "chooseProduction", "completeProduction", "turnsLeft", "renderGrowth", "renderImprovements", "improvement", "renderGarrisonedUnits", "unit", "Unit_default", "cityPlayerUnits", "InactiveUnitSelectionWindow_default", "renderSupportedUnits", "buildDetails", "_city", "_dataObserver", "_portal", "_transport", "City", "Window_default", "__privateAdd", "__privateSet", "DataObserver_default", "data", "_a", "_b", "updatedCity", "cityData", "__privateGet", "event", "CityBuildSelectionWindow_default", "ConfirmationWindow_default", "City_default", "_onComplete", "_transport", "CityBuildSelectionWindow", "SelectionWindow", "cityBuild", "transport", "onComplete", "additionalActions", "production", "cityYield", "total", "turns", "__name", "buildItem", "selection", "__privateAdd", "__privateSet", "hasSelected", "__privateGet", "city", "portal", "selectionWindow", "City_default", "CityBuildSelectionWindow_default", "_portal", "CityBuild", "Action_default", "action", "portal", "transport", "__privateAdd", "__privateSet", "CityBuildSelectionWindow_default", "__privateGet", "cityBuild", "assetStore", "asset", "e", "__name", "CityBuild_default", "EndTurn", "Action_default", "e", "__name", "EndTurn_default", "Revolution", "Action_default", "chooseWindow", "SelectionWindow_default", "government", "selection", "assetStore", "asset", "e", "__name", "Revolution_default", "_portal", "_transport", "Actions", "Element", "container", "e", "portal", "transport", "__privateAdd", "__privateSet", "event", "_a", "currentChild", "key", "children", "currentAction", "currentIndex", "actions", "playerAction", "action", "AdjustTradeRates_default", "__privateGet", "ChooseResearch_default", "CityBuild_default", "EndTurn_default", "Revolution_default", "h", "__name", "Actions_default", "_activeUnit", "Units", "Map", "__privateAdd", "tile", "x", "y", "size", "offsetX", "offsetY", "__privateGet", "unit", "a", "b", "_a", "_b", "image", "renderUnit_default", "__privateSet", "__name", "Units_default", "ActiveUnit", "Units_default", "activeUnit", "x", "y", "tile", "size", "offsetX", "offsetY", "image", "__name", "ActiveUnit_default", "CityNames", "Map", "tile", "x", "y", "size", "offsetX", "offsetY", "city", "sizeOffsetX", "sizeOffsetY", "textOffsetX", "textOffsetY", "__name", "CityNames_default", "_turn", "_year", "GameDetails", "Element_default", "element", "turn", "year", "__privateAdd", "__privateSet", "e", "t", "__privateGet", "__name", "GameDetails_default", "GamePortal", "Portal_default", "event", "currentCenter", "x", "y", "tile", "playerTileUnits", "unit", "City_default", "InactiveUnitSelectionWindow_default", "__name", "GamePortal_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "__name", "GoodyHuts_default", "_paused", "_stack", "IntervalHandler", "tick", "__privateAdd", "__privateGet", "item", "__privateSet", "handler", "__name", "IntervalHandler_default", "_args", "_channel", "Request", "channel", "args", "__privateAdd", "__privateSet", "__privateGet", "__name", "Request_default", "Options", "Request_default", "args", "__name", "Options_default", "_onFinished", "_transport", "CustomiseWorldWindow", "Window_default", "transport", "onFinished", "e", "__privateAdd", "__privateSet", "_a", "_b", "_c", "_d", "_e", "_f", "existingValues", "__privateGet", "Options_default", "playersInput", "heightInput", "widthInput", "landCoverageInput", "landSizeInput", "maxIterationsInput", "submit", "__name", "Request_default", "t", "h", "event", "CustomiseWorldWindow_default", "BinFile", "content", "callback", "b1", "length", "start", "__name", "BinFile_default", "LZWDictionary", "maxBits", "i", "pos", "entry", "__name", "LZWDictionary_default", "LZW", "binFile", "remainingCodedBytes", "uByteMode", "parsedIndexes", "usableBits", "usableBitCount", "indicatorLength", "indicatorFlag", "nextThreshold", "decodedCounter", "index", "inputData", "dicIndexMaxBits", "codedData", "decodedData", "dic", "LZWDictionary_default", "plainData", "oldCode", "buffer", "character", "newCode", "i", "p", "byteArr", "opt", "lastChr", "isFlag", "chr", "j", "__name", "LZW_default", "lowerNibble", "__name", "byte", "lowerNibble_default", "upperNibble", "__name", "byte", "upperNibble_default", "PicImage", "BinFile_default", "callback", "id", "length", "i", "firstIndex", "lastIndex", "paletteLength", "seenBlack", "colour", "decompSourceData", "LZW_default", "decompData", "oldImageData", "lowerNibble_default", "upperNibble_default", "ctx", "destinationX", "destinationY", "canvasData", "index", "y", "x", "colorIndex", "canvasIndex", "__name", "PicImage_default", "extractSprites", "__name", "content", "extractData", "defaults", "canvasProvider", "logger", "message", "canvas", "image", "PicImage_default", "result", "path", "definitionParents", "definition", "object", "filename", "contentCanvas", "context", "x", "y", "imageData", "_fileInput", "_progressInformation", "ImportAssetsWindow", "Window_default", "fileInput", "e", "progressInformation", "t", "extract_data_default", "h", "event", "__privateAdd", "__privateSet", "_a", "__privateGet", "files", "filenames", "file", "key", "expectedMatch", "filename", "results", "resolve", "definitions", "reader", "extractSprites", "width", "height", "canvas", "message", "record", "assetStore", "__name", "ImportAssetsWindow_default", "MandatorySelection", "SelectionWindow", "title", "optionList", "onChoose", "body", "options", "resolve", "detail", "__name", "MandatorySelection_default", "NewGameWindow", "MandatorySelection_default", "transport", "onFinished", "selection", "Request_default", "__name", "NewGameWindow_default", "EarthWindow", "NewGameWindow", "transport", "onFinished", "Request_default", "__name", "EarthWindow_default", "_transport", "MainMenu", "Element_default", "element", "transport", "__privateAdd", "__privateSet", "showQuit", "hasAssets", "assetStore", "h", "e", "t", "NewGameWindow_default", "__privateGet", "EarthWindow_default", "CustomiseWorldWindow_default", "ImportAssetsWindow_default", "event", "currentTarget", "button", "__name", "MainMenu_default", "_context", "_element", "_layers", "_portal", "_world", "Minimap", "element", "world", "portal", "layers", "__privateAdd", "__privateSet", "__privateGet", "event", "x", "y", "tileX", "tileY", "targetHeight", "layer", "start", "end", "__name", "Minimap_default", "_container", "_notifications", "Notifications", "container", "__privateAdd", "__privateSet", "notification", "__privateGet", "active", "_a", "NotificationWindow_default", "__name", "Notifications_default", "_player", "PlayerDetails", "Element_default", "element", "player", "__privateAdd", "__privateSet", "civilization", "treasury", "research", "cities", "__privateGet", "totalGold", "totalResearch", "city", "cityYield", "knownGroupLookup", "researchTurns", "e", "t", "__name", "PlayerDetails_default", "_activeUnit", "UnitDetails", "Element_default", "element", "activeUnit", "__privateAdd", "__privateSet", "_a", "_b", "__privateGet", "e", "t", "improvement", "feature", "unit", "__name", "UnitDetails_default", "_transport", "Renderer", "transport", "__privateAdd", "__privateSet", "__privateGet", "assetStore", "hasAllAssets", "scaledCursor", "options", "notificationArea", "mainMenuElement", "actionArea", "secondaryActionArea", "gameArea", "mapWrapper", "mapPortal", "gameInfo", "playerInfo", "minimapCanvas", "unitInfo", "preloadContainer", "notifications", "Notifications_default", "mainMenu", "MainMenu_default", "setActiveUnit", "__name", "unit", "portal", "unitsMap", "activeUnitsMap", "unitDetails", "UnitDetails_default", "activeUnit", "lastUnit", "records", "record", "h", "e", "tilesToRender", "globalNotificationTimer", "data", "channel", "label", "rawData", "choices", "reconstituteData", "SelectionWindow_default", "choice", "objectMap", "formatter", "NotificationWindow_default", "t", "advance", "activeUnits", "scale", "world", "World_default", "intervalHandler", "IntervalHandler_default", "GamePortal_default", "Land_default", "Irrigation_default", "Terrain_default", "Improvements_default", "Feature_default", "GoodyHuts_default", "Fog_default", "Yields_default", "Units_default", "Cities_default", "CityNames_default", "ActiveUnit_default", "landMap", "yieldsMap", "citiesMap", "cityNamesMap", "minimap", "Minimap_default", "primaryActions", "Actions_default", "secondaryActions", "lastTurn", "clearNextTurn", "handler", "orphanIds", "i", "max", "id", "action", "GameDetails_default", "PlayerDetails_default", "activeUnitAction", "unitA", "unitB", "pathToParts", "path", "getPenultimateObject", "object", "parts", "lastPart", "tmpObj", "part", "setObjectPath", "value", "removeObjectPath", "patch", "key", "type", "index", "keyToActionsMap", "directionKeyMap", "directionKeyMapNumpad", "directionKeyTypeMap", "lastKey", "event", "actions", "actionName", "unitAction", "topAction", "units", "current", "Renderer_default", "AbstractTransport", "request", "resolve", "value", "__name", "AbstractTransport_default", "_worker", "WorkerTransport", "AbstractTransport_default", "worker", "__privateAdd", "__privateSet", "receivingChannel", "handler", "__privateGet", "channel", "data", "onceHandler", "__name", "WorkerTransport_default", "renderer", "Renderer_default", "WorkerTransport_default"]
}
