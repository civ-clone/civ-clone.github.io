{
  "version": 3,
  "sources": ["../node_modules/@dom111/element/dist/Element.js", "../node_modules/@dom111/typed-event-emitter/EventEmitter.js", "../src/js/UI/Renderer.ts", "../src/js/UI/lib/reconstituteData.ts", "../src/js/UI/components/Actions.ts", "../src/js/UI/components/Actions/Action.ts", "../src/js/UI/components/LockedSlider.ts", "../src/js/UI/components/LockedSliderGroup.ts", "../src/js/UI/components/TransientElement.ts", "../src/js/UI/components/Window.ts", "../src/js/UI/lib/html.ts", "../node_modules/idb/build/wrap-idb-value.js", "../node_modules/idb/build/index.js", "../src/js/UI/Store.ts", "../src/js/UI/lib/scaleImage.ts", "../src/js/UI/AssetStore.ts", "../src/js/UI/components/Actions/AdjustTradeRates.ts", "../src/js/UI/components/NotificationWindow.ts", "../src/js/UI/components/SelectionWindow.ts", "../src/js/UI/components/Actions/ChooseResearch.ts", "../src/js/UI/lib/yieldMap.ts", "../node_modules/@dom111/element/src/Element.ts", "../src/js/UI/components/lib/cityYields.ts", "../src/js/UI/lib/getPreloadedImage.ts", "../src/js/UI/lib/replaceColours.ts", "../src/js/UI/components/Map.ts", "../src/js/UI/components/Map/Cities.ts", "../src/js/UI/components/ConfirmationWindow.ts", "../src/js/UI/DataObserver.ts", "../src/js/UI/components/Map/TerrainAbstract.ts", "../src/js/UI/components/Map/Feature.ts", "../src/js/UI/components/Map/Fog.ts", "../src/js/UI/components/Map/Improvements.ts", "../src/js/UI/components/Map/Irrigation.ts", "../src/js/UI/components/Map/Land.ts", "../src/js/UI/components/Portal.ts", "../src/js/UI/components/Map/Terrain.ts", "../src/js/UI/components/Unit.ts", "../src/js/UI/lib/renderUnit.ts", "../src/js/UI/components/UnitSelectionWindow.ts", "../src/js/UI/components/World.ts", "../src/js/UI/components/Map/Yields.ts", "../src/js/UI/components/City.ts", "../src/js/UI/components/SupportedUnit.ts", "../src/js/UI/components/CityBuildSelectionWindow.ts", "../src/js/UI/components/Actions/CityBuild.ts", "../src/js/UI/components/Actions/EndTurn.ts", "../src/js/UI/components/Actions/Revolution.ts", "../src/js/UI/components/Map/Units.ts", "../src/js/UI/components/Map/ActiveUnit.ts", "../src/js/UI/components/Map/CityNames.ts", "../src/js/UI/components/CityStatus.ts", "../src/js/UI/components/GameDetails.ts", "../src/js/UI/components/GamePortal.ts", "../src/js/UI/components/Map/GoodyHuts.ts", "../src/js/UI/components/HappinessReport.ts", "../src/js/UI/lib/IntervalHandler.ts", "../src/js/UI/components/MainMenu.ts", "../src/js/Engine/Request.ts", "../src/js/Engine/Requests/Options.ts", "../src/js/UI/components/CustomiseWorldWindow.ts", "../src/js/UI/components/MandatorySelection.ts", "../src/js/UI/components/NewGameWindow.ts", "../src/js/UI/components/EarthWindow.ts", "../node_modules/@civ-clone/civ1-asset-extractor/BinFile.ts", "../node_modules/@civ-clone/civ1-asset-extractor/LZWDictionary.ts", "../node_modules/@civ-clone/civ1-asset-extractor/LZW.ts", "../node_modules/@civ-clone/civ1-asset-extractor/lib/lowerNibble.ts", "../node_modules/@civ-clone/civ1-asset-extractor/lib/upperNibble.ts", "../node_modules/@civ-clone/civ1-asset-extractor/PicImage.ts", "../node_modules/@civ-clone/civ1-asset-extractor/extractSprites.ts", "../src/js/UI/components/ImportAssetsWindow.ts", "../src/js/UI/components/Minimap.ts", "../src/js/UI/components/Notifications.ts", "../src/js/UI/components/PlayerDetails.ts", "../src/js/UI/components/lib/playerYields.ts", "../src/js/UI/components/ScienceReport.ts", "../src/js/UI/components/UnitDetails.ts", "../src/js/Engine/AbstractTransport.ts", "../src/js/Engine/WorkerTransport.ts", "../src/js/frontend.ts"],
  "sourcesContent": ["\"use strict\";var e,t=this&&this.__classPrivateFieldSet||function(e,t,s,o,r){if(\"m\"===o)throw new TypeError(\"Private method is not writable\");if(\"a\"===o&&!r)throw new TypeError(\"Private accessor was defined without a setter\");if(\"function\"==typeof t?e!==t||!r:!t.has(e))throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");return\"a\"===o?r.call(e,s):r?r.value=s:t.set(e,s),s},s=this&&this.__classPrivateFieldGet||function(e,t,s,o){if(\"a\"===s&&!o)throw new TypeError(\"Private accessor was defined without a getter\");if(\"function\"==typeof t?e!==t||!o:!t.has(e))throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");return\"m\"===s?o:\"a\"===s?o.call(e):o?o.value:t.get(e)};Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.Element=exports.toggleClass=exports.t=exports.s=exports.removeClass=exports.once=exports.onEach=exports.on=exports.off=exports.hasClass=exports.empty=exports.emitCustom=exports.emit=exports.addClass=void 0;exports.addClass=(e,...t)=>e.classList.add(...t);exports.emit=(e,t)=>e.dispatchEvent(t);exports.emitCustom=(e,t,...s)=>(0,exports.emit)(e,new CustomEvent(t,{detail:s}));exports.empty=e=>{for(var t;e.hasChildNodes();)null===(t=e.firstChild)||void 0===t||t.remove()};exports.hasClass=(e,t)=>e.classList.contains(t);exports.off=(e,t,s,o={})=>e.removeEventListener(t,s,o);exports.on=(e,t,s,o={})=>e.addEventListener(t,s,o);exports.onEach=(e,t,s,o={})=>t.forEach((t=>(0,exports.on)(e,t,s,o)));exports.once=(e,t,s,o={})=>(0,exports.on)(e,t,s,Object.assign(Object.assign({},\"boolean\"==typeof o?{capture:o}:o),{once:!0}));exports.removeClass=(e,...t)=>e.classList.remove(...t);exports.s=(e,...t)=>{const s=document.createElement(\"div\");s.innerHTML=e;const r=s.firstElementChild;return t.forEach((e=>{e instanceof o?r.append(e.element()):e instanceof Node?r.append(e):r.append((0,exports.t)(e))})),r};exports.t=e=>document.createTextNode(e);exports.toggleClass=(e,...t)=>t.forEach((t=>e.classList.toggle(t)));class o{constructor(s){e.set(this,void 0),t(this,e,s,\"f\")}static fromString(e){return new o((0,exports.s)(e))}addClass(...e){(0,exports.addClass)(this.element(),...e)}append(...e){e.forEach((e=>{e instanceof o&&(e=e.element()),this.element().append(e)}))}element(){return s(this,e,\"f\")}emit(e){return(0,exports.emit)(this.element(),e)}emitCustom(e,...t){return(0,exports.emitCustom)(this.element(),e,...t)}empty(){(0,exports.empty)(this.element())}hasClass(e){return(0,exports.hasClass)(this.element(),e)}off(e,t,s={}){(0,exports.off)(this.element(),e,t,s)}on(e,t,s={}){(0,exports.on)(this.element(),e,t,s)}onEach(e,t,s={}){(0,exports.onEach)(this.element(),e,t,s)}once(e,t,s={}){(0,exports.once)(this.element(),e,t,s)}query(e){return this.element().querySelector(e)}queryAll(e){return this.element().querySelectorAll(e)}remove(){this.element().remove()}removeClass(...e){(0,exports.removeClass)(this.element(),...e)}toggleClass(...e){(0,exports.toggleClass)(this.element(),...e)}}exports.Element=o,e=new WeakMap,exports.default=o;", "\"use strict\";var t,e=this&&this.__classPrivateFieldGet||function(t,e,i,s){if(\"a\"===i&&!s)throw new TypeError(\"Private accessor was defined without a getter\");if(\"function\"==typeof e?t!==e||!s:!e.has(t))throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");return\"m\"===i?s:\"a\"===i?s.call(t):s?s.value:e.get(t)};Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.EventEmitter=void 0;class i{constructor(){t.set(this,{})}on(i,s){i in e(this,t,\"f\")||(e(this,t,\"f\")[i]=[]),e(this,t,\"f\")[i].push(s)}once(t,e){const i=(...s)=>{e(...s),this.off(t,i)};this.on(t,i)}off(i,s){if(!(i in e(this,t,\"f\")))return;const r=e(this,t,\"f\")[i].indexOf(s);-1!==r&&e(this,t,\"f\")[i].splice(r,1)}emit(i,...s){i in e(this,t,\"f\")&&e(this,t,\"f\")[i].forEach((t=>t(...s)))}}exports.EventEmitter=i,t=new WeakMap,exports.default=i;", "import {\n  DataPatch,\n  GameData,\n  NeighbourDirection,\n  PlainObject,\n  PlayerAction,\n  Tile,\n  Unit,\n} from './types';\nimport { on, s } from '@dom111/element';\nimport { reconstituteData, ObjectMap } from './lib/reconstituteData';\nimport Actions from './components/Actions';\nimport ActiveUnit from './components/Map/ActiveUnit';\nimport Cities from './components/Map/Cities';\nimport CityNames from './components/Map/CityNames';\nimport CityStatus from './components/CityStatus';\nimport ConfirmationWindow from './components/ConfirmationWindow';\nimport Feature from './components/Map/Feature';\nimport Fog from './components/Map/Fog';\nimport GameDetails from './components/GameDetails';\nimport GamePortal from './components/GamePortal';\nimport GoodyHuts from './components/Map/GoodyHuts';\nimport HappinessReport from './components/HappinessReport';\nimport Improvements from './components/Map/Improvements';\nimport IntervalHandler from './lib/IntervalHandler';\nimport Irrigation from './components/Map/Irrigation';\nimport Land from './components/Map/Land';\nimport MainMenu from './components/MainMenu';\nimport Minimap from './components/Minimap';\nimport NotificationWindow from './components/NotificationWindow';\nimport Notifications from './components/Notifications';\nimport PlayerDetails from './components/PlayerDetails';\nimport Portal from './components/Portal';\nimport ScienceReport from './components/ScienceReport';\nimport SelectionWindow from './components/SelectionWindow';\nimport Terrain from './components/Map/Terrain';\nimport Transport from '../Engine/Transport';\nimport UnitDetails from './components/UnitDetails';\nimport Units from './components/Map/Units';\nimport World from './components/World';\nimport Yields from './components/Map/Yields';\nimport { assetStore } from './AssetStore';\nimport { h } from './lib/html';\n\n// TODO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n//  ! Break this down and use a front-end framework? !\n//  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\nexport class Renderer {\n  #transport: Transport;\n\n  constructor(transport: Transport) {\n    this.#transport = transport;\n  }\n\n  init() {\n    const transport = this.#transport;\n\n    assetStore.hasAllAssets().then((hasAllAssets) => {\n      if (!hasAllAssets) {\n        return;\n      }\n\n      assetStore\n        .getScaled('./assets/cursor/torch.png', 2)\n        .then(\n          (scaledCursor) =>\n            (document.body.style.cursor = `url('${scaledCursor.toDataURL(\n              'image/png'\n            )}'), default`)\n        );\n    });\n\n    on(document, 'keypress', (event) => {\n      if (\n        event.key === 'F5' ||\n        (['R', 'r'].includes(event.key) && event.ctrlKey)\n      ) {\n        event.preventDefault();\n\n        new ConfirmationWindow('Quit', 'Are you sure you want to reload?', () =>\n          window.location.reload()\n        );\n\n        return;\n      }\n    });\n\n    const options = {\n      autoEndOfTurn: true,\n    };\n\n    try {\n      const notificationArea = document.getElementById(\n          'notification'\n        ) as HTMLElement,\n        mainMenuElement = document.querySelector('#mainmenu') as HTMLElement,\n        actionArea = document.getElementById('actions') as HTMLElement,\n        secondaryActionArea = document.getElementById(\n          'other-actions'\n        ) as HTMLElement,\n        gameArea = document.getElementById('game') as HTMLElement,\n        mapWrapper = document.getElementById('map') as HTMLElement,\n        mapPortal = mapWrapper.querySelector('canvas') as HTMLCanvasElement,\n        gameInfo = document.getElementById('gameDetails') as HTMLElement,\n        playerInfo = document.getElementById('playerDetails') as HTMLElement,\n        minimapCanvas = document.getElementById('minimap') as HTMLCanvasElement,\n        unitInfo = document.getElementById('unitInfo') as HTMLCanvasElement,\n        preloadContainer = document.getElementById('preload') as HTMLDivElement,\n        notifications = new Notifications(),\n        mainMenu = new MainMenu(mainMenuElement, this.#transport),\n        setActiveUnit = (\n          unit: Unit | null,\n          portal: Portal,\n          unitsMap: Units,\n          activeUnitsMap: ActiveUnit\n        ) => {\n          const unitDetails = new UnitDetails(unitInfo, unit);\n\n          activeUnit = unit;\n\n          unitDetails.build();\n\n          unitsMap.setActiveUnit(unit);\n          unitsMap.render();\n          unitsMap.setVisible(true);\n          activeUnitsMap.setActiveUnit(unit);\n          activeUnitsMap.render();\n          activeUnitsMap.setVisible(true);\n\n          if (unit === null) {\n            portal.render();\n\n            return;\n          }\n\n          lastUnit = unit;\n\n          unitsMap.update([\n            ...(lastUnit?.tile ? [lastUnit.tile] : []),\n            unit.tile,\n          ]);\n\n          if (!portal.isVisible(unit.tile.x, unit.tile.y)) {\n            portal.setCenter(unit.tile.x, unit.tile.y);\n          }\n\n          portal.render();\n        };\n\n      // preloaded the images as they could be remote\n      assetStore.getAll().then((records) =>\n        records.forEach((record) =>\n          preloadContainer.append(\n            h(s(`<img src=\"${record.uri}\" data-path=\"${record.name}\">`), {\n              error: () =>\n                console.error(\n                  `There was a problem preloading '${record.name}', you may have some missing details.`\n                ),\n            })\n          )\n        )\n      );\n\n      const tilesToRender: Tile[] = [];\n\n      let globalNotificationTimer: number | undefined,\n        lastUnit: Unit | null = null,\n        activeUnit: Unit | null = null;\n\n      transport.receive('notification', (data): void => {\n        notificationArea.innerHTML = data;\n\n        if (globalNotificationTimer) {\n          window.clearTimeout(globalNotificationTimer);\n        }\n\n        globalNotificationTimer = window.setTimeout((): void => {\n          globalNotificationTimer = undefined;\n\n          notificationArea.innerText = '';\n        }, 4000);\n      });\n\n      [\n        ['chooseCivilization', 'Choose your civilization'],\n        ['chooseLeader', 'Choose your leader'],\n      ].forEach(([channel, label]) =>\n        transport.receive(channel, (rawData) => {\n          const { choices } = reconstituteData(rawData);\n\n          new SelectionWindow(\n            label,\n            choices.map(({ _: choice }: { _: string }) => ({\n              label: choice,\n              value: choice,\n            })),\n            (choice) => transport.send(channel, choice),\n            label,\n            {\n              displayAll: true,\n            }\n          );\n        })\n      );\n\n      let data: GameData;\n\n      transport.receiveOnce('gameData', (objectMap: ObjectMap) => {\n        try {\n          // @ts-ignore\n          const formatter = new Intl.ListFormat();\n\n          data = reconstituteData(objectMap) as GameData;\n\n          new NotificationWindow(\n            'Welcome',\n            s(\n              `<div class=\"welcome\">\n<p>${\n                data.player.civilization.leader.name\n              }, you have risen to become leader of the ${\n                data.player.civilization._\n              }.</p>\n<p>Your people have knowledge of ${formatter.format([\n                'Irrigation',\n                'Mining',\n                'Roads',\n                ...data.player.research.complete.map((advance) => advance._),\n              ])}.</p>\n</div>`\n            )\n          );\n\n          gameArea.classList.add('active');\n\n          mapPortal.width = (\n            mapPortal.parentElement as HTMLElement\n          ).offsetWidth;\n          mapPortal.height = (\n            mapPortal.parentElement as HTMLElement\n          ).offsetHeight;\n\n          let activeUnits: PlayerAction[] = [];\n\n          const scale = 2,\n            world = new World(data.player.world),\n            intervalHandler = new IntervalHandler(),\n            portal = new GamePortal(\n              world,\n              transport,\n              mapPortal,\n              {\n                playerId: data.player.id,\n                // TODO: this needs to be a user-controllable item\n                scale,\n                // TODO: this needs to come from the theme\n                tileSize: 16,\n              },\n              Land,\n              Irrigation,\n              Terrain,\n              Improvements,\n              Feature,\n              GoodyHuts,\n              Fog,\n              Yields,\n              Units,\n              Cities,\n              CityNames,\n              ActiveUnit\n            ),\n            landMap = portal.getLayer(Land) as Land,\n            yieldsMap = portal.getLayer(Yields) as Yields,\n            unitsMap = portal.getLayer(Units) as Units,\n            citiesMap = portal.getLayer(Cities) as Cities,\n            cityNamesMap = portal.getLayer(CityNames) as CityNames,\n            activeUnitsMap = portal.getLayer(ActiveUnit) as ActiveUnit,\n            minimap = new Minimap(\n              minimapCanvas,\n              world,\n              portal,\n              landMap,\n              citiesMap,\n              activeUnitsMap\n            ),\n            primaryActions = new Actions(actionArea, portal, this.#transport),\n            secondaryActions = new Actions(\n              secondaryActionArea,\n              portal,\n              this.#transport\n            );\n\n          yieldsMap.setVisible(false);\n\n          portal.on('focus-changed', () => minimap.update());\n          portal.on('activate-unit', (unit) =>\n            setActiveUnit(unit, portal, unitsMap, activeUnitsMap)\n          );\n\n          intervalHandler.on(() => {\n            activeUnitsMap.setVisible(!activeUnitsMap.isVisible());\n\n            portal.build(tilesToRender.splice(0));\n            portal.render();\n          });\n\n          on(window, 'resize', () => {\n            mapPortal.width = (\n              mapPortal.parentElement as HTMLElement\n            ).offsetWidth;\n            mapPortal.height = (\n              mapPortal.parentElement as HTMLElement\n            ).offsetHeight;\n          });\n\n          // This needs wrapping.\n          // let lastTurn = 1,\n          //   clearNextTurn = false;\n\n          const handler = (objectMap: ObjectMap): void => {\n            // TODO: this causes a massive slowdown when its processed. Maybe we just leak for now...\n            // let orphanIds: string[] | null = clearNextTurn ? [] : null;\n            // let orphanIds: string[] | null = null;\n\n            // TODO: look into if it's possible to have data reconstituted in a worker thread\n            data = reconstituteData(\n              objectMap\n              // orphanIds\n            ) as GameData;\n\n            // A bit crude, I'd like to run this as as background job too\n            // if (orphanIds) {\n            //   // clean up orphan data - late game there can be tens of thousands of these to clean up\n            //   ((orphanIds) => {\n            //     const maxCount = 1000,\n            //       delay = 200;\n            //\n            //     for (\n            //       let i = 0, max = Math.ceil(orphanIds.length / maxCount);\n            //       i < max;\n            //       i++\n            //     ) {\n            //       setTimeout(\n            //         () =>\n            //           orphanIds\n            //             .slice(i * maxCount, (i + 1) * maxCount - 1)\n            //             .forEach((id) => delete objectMap.objects[id]),\n            //         (i + 1) * delay\n            //       );\n            //     }\n            //   })(orphanIds);\n            //\n            //   clearNextTurn = false;\n            // }\n\n            document.dispatchEvent(\n              new CustomEvent('dataupdated', {\n                detail: {\n                  data,\n                },\n              })\n            );\n\n            // if (lastTurn !== data.turn.value) {\n            //   clearNextTurn = true;\n            //   lastTurn = data.turn.value;\n            // }\n\n            primaryActions.build(data.player.mandatoryActions);\n            secondaryActions.build(\n              data.player.actions.filter((action: PlayerAction) =>\n                ['AdjustTradeRates', 'Revolution'].includes(action._)\n              )\n            );\n\n            gameArea.append(primaryActions.element());\n\n            world.setTiles(data.player.world.tiles);\n\n            const gameDetails = new GameDetails(gameInfo, data.turn, data.year);\n\n            gameDetails.build();\n\n            const playerDetails = new PlayerDetails(playerInfo, data.player);\n\n            playerDetails.build();\n\n            activeUnits = data.player.actions.filter(\n              (action: PlayerAction): boolean => action._ === 'ActiveUnit'\n            );\n\n            // This prioritises units that are already on screen\n            const [activeUnitAction] = activeUnits.sort(\n              ({ value: unitA }, { value: unitB }): number =>\n                unitB === lastUnit\n                  ? 1\n                  : unitA === lastUnit\n                  ? -1\n                  : (portal.isVisible(\n                      (unitB as Unit).tile.x,\n                      (unitB as Unit).tile.y\n                    )\n                      ? 1\n                      : 0) -\n                    (portal.isVisible(\n                      (unitA as Unit).tile.x,\n                      (unitA as Unit).tile.y\n                    )\n                      ? 1\n                      : 0)\n            );\n\n            if (lastUnit !== activeUnitAction?.value) {\n              lastUnit = null;\n            }\n\n            setActiveUnit(\n              lastUnit?.active\n                ? lastUnit\n                : activeUnitAction\n                ? (activeUnitAction.value as Unit)\n                : null,\n              portal,\n              unitsMap,\n              activeUnitsMap\n            );\n\n            // ensure UI looks responsive\n            portal.build(tilesToRender.splice(0));\n            portal.render();\n\n            minimap.update();\n\n            if (\n              options.autoEndOfTurn &&\n              data.player.mandatoryActions.length === 1 &&\n              data.player.mandatoryActions.every(\n                (action) => action._ === 'EndTurn'\n              )\n            ) {\n              transport.send('action', {\n                name: 'EndTurn',\n              });\n\n              return;\n            }\n          };\n\n          handler(objectMap);\n\n          transport.receive('gameData', (data) => handler(data));\n\n          const pathToParts = (path: string) =>\n              path.replace(/]/g, '').split(/[.[]/),\n            getPenultimateObject = (\n              object: PlainObject,\n              path: string\n            ): [PlainObject, string | undefined] => {\n              const parts = pathToParts(path),\n                lastPart = parts.pop();\n\n              const tmpObj = parts.reduce((tmpObj, part) => {\n                if (!tmpObj || !(part in tmpObj)) {\n                  return null;\n                }\n\n                return tmpObj[part];\n              }, object);\n\n              return [tmpObj, lastPart];\n            },\n            setObjectPath = (\n              object: PlainObject,\n              path: string,\n              value: any\n            ): void => {\n              const [tmpObj, lastPart] = getPenultimateObject(object, path);\n\n              if (!tmpObj || !lastPart) {\n                console.warn(\n                  `unable to set ${path} of ${object} (${lastPart})`\n                );\n                return;\n              }\n\n              tmpObj[lastPart] = value;\n            },\n            removeObjectPath = (object: PlainObject, path: string): void => {\n              const [tmpObj, lastPart] = getPenultimateObject(object, path);\n\n              if (!tmpObj || !lastPart) {\n                console.warn(\n                  `unable to set ${path} of ${object} (${lastPart})`\n                );\n                return;\n              }\n\n              delete tmpObj[lastPart];\n            };\n\n          transport.receive('gameDataPatch', (data: DataPatch[]) => {\n            data.forEach((patch) =>\n              Object.entries(patch).forEach(([key, { type, index, value }]) => {\n                if (type === 'add' || type === 'update') {\n                  if (!value!.hierarchy) {\n                    console.error('No hierarchy');\n                    console.error(value);\n\n                    return;\n                  }\n\n                  if (index) {\n                    setObjectPath(\n                      objectMap.objects[key],\n                      index,\n                      value!.hierarchy\n                    );\n                  } else {\n                    objectMap.objects[key] = value!.hierarchy;\n                  }\n\n                  document.dispatchEvent(\n                    new CustomEvent('patchdatareceived', {\n                      detail: {\n                        value,\n                      },\n                    })\n                  );\n\n                  Object.entries(value!.objects as PlainObject).forEach(\n                    ([key, value]) => {\n                      objectMap.objects[key] = value;\n\n                      if (value._ === 'PlayerTile') {\n                        // Since we only use tilesToRender for x and y this should be fine...\n                        tilesToRender.push(value);\n                      }\n                    }\n                  );\n                }\n\n                if (type === 'remove') {\n                  if (index) {\n                    removeObjectPath(objectMap.objects[key], index);\n\n                    return;\n                  }\n\n                  delete objectMap.objects[key];\n                }\n              })\n            );\n\n            handler(objectMap);\n          });\n\n          transport.receive('gameNotification', (data): void =>\n            notifications.receive(data)\n          );\n\n          const keyToActionsMap: {\n              [key: string]: string[];\n            } = {\n              ' ': ['NoOrders'],\n              b: ['FoundCity'],\n              D: ['Disband'],\n              f: ['Fortify', 'BuildFortress'],\n              i: [\n                'BuildIrrigation',\n                'ClearForest',\n                'ClearSwamp',\n                'ClearJungle',\n              ],\n              m: ['BuildMine', 'PlantForest'],\n              P: ['Pillage'],\n              r: ['BuildRoad', 'BuildRailroad'],\n              s: ['Sleep'],\n              u: ['Unload'],\n              w: ['Wait'],\n            },\n            directionKeyMap: { [key: string]: NeighbourDirection } = {\n              ArrowUp: 'n',\n              PageUp: 'ne',\n              ArrowRight: 'e',\n              PageDown: 'se',\n              ArrowDown: 's',\n              End: 'sw',\n              ArrowLeft: 'w',\n              Home: 'nw',\n            },\n            directionKeyMapNumpad: { [key: string]: NeighbourDirection } = {\n              8: 'n',\n              9: 'ne',\n              6: 'e',\n              3: 'se',\n              2: 's',\n              1: 'sw',\n              4: 'w',\n              7: 'nw',\n            },\n            directionKeyTypeMap: { [key: string]: { [key: string]: string } } =\n              {\n                [KeyboardEvent.DOM_KEY_LOCATION_STANDARD]: directionKeyMap,\n                [KeyboardEvent.DOM_KEY_LOCATION_NUMPAD]: directionKeyMapNumpad,\n              },\n            leaderScreensMap: { [key: string]: () => any } = {\n              F1: () => new CityStatus(data.player, portal, transport),\n              F4: () => new HappinessReport(data.player),\n              F6: () => new ScienceReport(data.player),\n            };\n\n          let lastKey = '';\n\n          on(document, 'keydown', (event) => {\n            if (event.key in leaderScreensMap) {\n              leaderScreensMap[event.key]();\n\n              event.preventDefault();\n            }\n\n            if (activeUnit) {\n              if (event.key in keyToActionsMap) {\n                const actions = [...keyToActionsMap[event.key]];\n\n                while (actions.length) {\n                  const actionName = actions.shift(),\n                    [unitAction] = activeUnit.actions.filter(\n                      (action): boolean => action._ === actionName\n                    );\n\n                  if (unitAction) {\n                    transport.send('action', {\n                      name: 'ActiveUnit',\n                      id: activeUnit.id,\n                      unitAction: unitAction._,\n                      target: unitAction.to.id,\n                    });\n\n                    event.stopPropagation();\n                    event.preventDefault();\n\n                    return;\n                  }\n                }\n              }\n\n              // if (event.key in directionKeyTypeMap[event.location]) {\n              if (event.key in directionKeyMap) {\n                const [unitAction] =\n                  activeUnit.actionsForNeighbours[directionKeyMap[event.key]];\n\n                if (unitAction) {\n                  transport.send('action', {\n                    name: 'ActiveUnit',\n                    id: activeUnit.id,\n                    unitAction: unitAction._,\n                    target: unitAction.to.id,\n                  });\n\n                  event.stopPropagation();\n                  event.preventDefault();\n\n                  return;\n                }\n              }\n            }\n\n            if (event.key === 'Escape' && document.activeElement !== null) {\n              (document.activeElement as HTMLElement).blur();\n\n              return;\n            }\n\n            if (\n              event.key === 'Enter' &&\n              data.player.mandatoryActions.some(\n                (action) => action._ === 'EndOfTurn'\n              )\n            ) {\n              transport.send('action', {\n                name: 'EndTurn',\n              });\n\n              event.stopPropagation();\n              event.preventDefault();\n\n              return;\n            }\n\n            if (event.key === 'Tab') {\n              const topAction = actionArea.querySelector(\n                'div.action:first-child button'\n              ) as HTMLButtonElement | null;\n\n              if (topAction !== null) {\n                topAction.focus();\n\n                event.preventDefault();\n                event.stopPropagation();\n\n                return;\n              }\n            }\n\n            if (event.key === 'c' && activeUnit) {\n              portal.setCenter(activeUnit.tile.x, activeUnit.tile.y);\n\n              portal.render();\n              minimap.update();\n\n              return;\n            }\n\n            if (event.key === 'w' && activeUnit && activeUnits.length > 1) {\n              const units = activeUnits.map(\n                  (unitAction) => unitAction.value as Unit\n                ),\n                current = units.indexOf(activeUnit),\n                unit = units[current === units.length - 1 ? 0 : current + 1];\n\n              setActiveUnit(unit, portal, unitsMap, activeUnitsMap);\n            }\n\n            if (event.key === 't') {\n              unitsMap.setVisible(!unitsMap.isVisible());\n              citiesMap.setVisible(!citiesMap.isVisible());\n              cityNamesMap.setVisible(!cityNamesMap.isVisible());\n\n              portal.render();\n\n              return;\n            }\n\n            if (event.key === 'y') {\n              yieldsMap.setVisible(!yieldsMap.isVisible());\n\n              portal.render();\n\n              return;\n            }\n\n            if (lastKey === '%' && event.key === '^') {\n              transport.send('cheat', { name: 'RevealMap' });\n\n              return;\n            }\n\n            lastKey = event.key;\n          });\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    } catch (e) {\n      console.error(e);\n    }\n  }\n}\n\nexport default Renderer;\n", "export type PlainObject = {\n  [key: string]: any;\n};\n\nexport type ObjectStore = {\n  [key: string]: PlainObject;\n};\n\nexport type ObjectMap = {\n  hierarchy: PlainObject;\n  objects: ObjectStore;\n};\n\nexport const reconstituteData = (\n  { hierarchy, objects }: ObjectMap,\n  orphanIds: string[] | null = null\n): PlainObject => {\n  const seenObjects: Map<PlainObject, PlainObject> = new Map();\n\n  if (orphanIds) {\n    Object.keys(objects).forEach((id) => orphanIds.push(id));\n  }\n\n  const getReferences = (value: any): PlainObject => {\n    if (seenObjects.has(value)) {\n      return seenObjects.get(value)!;\n    }\n\n    if (Array.isArray(value)) {\n      const updated: any[] = [];\n\n      seenObjects.set(value, updated);\n\n      value.forEach((value) => updated.push(getReferences(value)));\n\n      return updated;\n    }\n\n    if (value && value['#ref']) {\n      if (orphanIds) {\n        orphanIds.splice(orphanIds.indexOf(value['#ref']), 1);\n      }\n\n      if (!(value['#ref'] in objects)) {\n        throw new TypeError(`missing ${value['#ref']}`);\n      }\n\n      const updated = getReferences(objects[value['#ref']]);\n\n      seenObjects.set(value, updated);\n\n      return updated;\n    }\n\n    if (value instanceof Object) {\n      const updated: PlainObject = {};\n\n      seenObjects.set(value, updated);\n\n      Object.entries(value).forEach(([key, childValue]) => {\n        updated[key] = getReferences(childValue);\n      });\n\n      return updated;\n    }\n\n    return value;\n  };\n\n  return getReferences(hierarchy);\n};\n\nexport default reconstituteData;\n", "import { Element, s } from '@dom111/element';\nimport Action from './Actions/Action';\nimport AdjustTradeRates from './Actions/AdjustTradeRates';\nimport ChooseResearch from './Actions/ChooseResearch';\nimport CityBuild from './Actions/CityBuild';\nimport EndTurn from './Actions/EndTurn';\nimport { PlayerAction } from '../types';\nimport Portal from './Portal';\nimport Revolution from './Actions/Revolution';\nimport Transport from '../../Engine/Transport';\nimport { h } from '../lib/html';\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    actioned: CustomEvent<Action>;\n  }\n}\n\nexport interface IActions {\n  build(mandatoryActions: PlayerAction[], actions: PlayerAction[]): void;\n}\n\nexport class Actions extends Element implements IActions {\n  #portal: Portal;\n  #transport: Transport;\n\n  constructor(\n    container: HTMLElement = s('<div class=\"actions\"></div>'),\n    portal: Portal,\n    transport: Transport\n  ) {\n    super(container);\n\n    this.#portal = portal;\n    this.#transport = transport;\n\n    this.on('actioned', (event) => event.detail.remove());\n\n    this.on(\n      'keydown',\n      (event) => {\n        const currentChild = document.activeElement;\n\n        if (!this.element().contains(currentChild)) {\n          return;\n        }\n\n        const { key } = event,\n          children = Array.from(this.element().children) as HTMLElement[];\n\n        if (\n          !['ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowUp'].includes(key) ||\n          children.length === 0\n        ) {\n          return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        let currentAction =\n          currentChild === this.element()\n            ? ['ArrowLeft', 'ArrowUp'].includes(key)\n              ? (currentChild.firstElementChild as HTMLElement)\n              : (currentChild.lastElementChild as HTMLElement)\n            : (currentChild as HTMLElement);\n\n        while (currentAction.parentElement !== this.element()) {\n          currentAction = currentAction.parentElement as HTMLElement;\n        }\n\n        const currentIndex = children.indexOf(currentAction);\n\n        if (['ArrowUp', 'ArrowLeft'].includes(key)) {\n          if (currentIndex > 0) {\n            children[currentIndex - 1].querySelector('button')?.focus();\n\n            return;\n          }\n\n          children.pop()!.querySelector('button')!.focus();\n\n          return;\n        }\n\n        if (['ArrowDown', 'ArrowRight'].includes(key)) {\n          if (currentIndex < children.length - 1) {\n            children[currentIndex + 1]!.querySelector('button')!.focus();\n\n            return;\n          }\n\n          children.shift()!.querySelector('button')!.focus();\n\n          return;\n        }\n      },\n      true\n    );\n  }\n\n  build(actions: PlayerAction[]): void {\n    this.empty();\n\n    actions.forEach((playerAction) => {\n      let action: Action;\n\n      switch (playerAction._) {\n        // This is handled separately so no need to worry.\n        case 'ActiveUnit':\n          return;\n\n        case 'AdjustTradeRates':\n          action = new AdjustTradeRates(playerAction, this.#transport);\n\n          break;\n\n        case 'ChooseResearch':\n          action = new ChooseResearch(playerAction, this.#transport);\n\n          break;\n\n        case 'CityBuild':\n          action = new CityBuild(playerAction, this.#portal, this.#transport);\n\n          break;\n\n        case 'EndTurn':\n          action = new EndTurn(playerAction, this.#transport);\n\n          break;\n\n        case 'Revolution':\n          action = new Revolution(playerAction, this.#transport);\n\n          break;\n\n        default:\n          console.log('need to handle ' + playerAction._);\n          return;\n        // throw new TypeError(`Unknown action type '${action._}'.`);\n      }\n\n      this.element().prepend(\n        h(action.element(), {\n          click: () => action.activate(),\n          keydown: ({ key }) => {\n            if (key === ' ' || key === 'Enter') {\n              action.activate();\n            }\n          },\n        })\n      );\n    });\n  }\n}\n\nexport default Actions;\n", "import {\n  CityBuild,\n  PlayerAction,\n  PlayerGovernment,\n  PlayerResearch,\n  PlayerTradeRates,\n  Unit,\n} from '../../types';\nimport { Element, s } from '@dom111/element';\nimport Transport from '../../../Engine/Transport';\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    actioned: CustomEvent<Action>;\n  }\n}\n\nexport interface IAction {\n  activate(): void;\n  build(): void;\n  complete(): void;\n  element(): HTMLElement;\n  value():\n    | CityBuild\n    | PlayerResearch\n    | Unit\n    | PlayerGovernment\n    | PlayerTradeRates;\n}\n\nexport class Action extends Element implements IAction {\n  #action: PlayerAction;\n  #transport: Transport;\n\n  constructor(action: PlayerAction, transport: Transport) {\n    super(s('<div class=\"action\"></div>'));\n\n    this.#action = action;\n    this.#transport = transport;\n\n    this.on('keydown', (event) => {\n      if (event.key === 'Escape') {\n        return;\n      }\n\n      event.stopPropagation();\n    });\n\n    this.build();\n  }\n\n  activate(): void {}\n\n  build(): void {}\n\n  complete(): void {\n    this.emit(\n      new CustomEvent('actioned', {\n        bubbles: true,\n        detail: this,\n      })\n    );\n  }\n\n  transport(): Transport {\n    return this.#transport;\n  }\n\n  value():\n    | CityBuild\n    | PlayerResearch\n    | Unit\n    | PlayerGovernment\n    | PlayerTradeRates {\n    return this.#action.value;\n  }\n}\n\nexport default Action;\n", "import { Element, s } from '@dom111/element';\n\nconst template: (label: string, value: number) => HTMLFieldSetElement = (\n  label: string,\n  value: number\n) =>\n  s(\n    `<fieldset><legend>${label}</legend><input type=\"range\" max=\"100\" min=\"0\" step=\"1\" value=\"${value}\"><input type=\"number\"><label><input type=\"checkbox\">Lock</label></fieldset>`\n  ) as HTMLFieldSetElement;\n\nexport type onInputHandler = () => void;\n\nexport class LockedSlider extends Element {\n  #label: string;\n  #range: HTMLInputElement;\n  #number: HTMLInputElement;\n  #lock: HTMLInputElement;\n  #listeners: onInputHandler[] = [];\n\n  constructor(label: string, currentValue: number) {\n    super(template(label, currentValue));\n\n    this.#label = label;\n    this.#range = this.element().querySelector(\n      'input[type=\"range\"]'\n    ) as HTMLInputElement;\n    this.#number = this.element().querySelector(\n      'input[type=\"number\"]'\n    ) as HTMLInputElement;\n    this.#lock = this.element().querySelector(\n      'input[type=\"checkbox\"]'\n    ) as HTMLInputElement;\n\n    this.build();\n  }\n\n  build(): void {\n    this.set(this.#range.value);\n\n    this.#range.addEventListener('input', () => this.set(this.#range.value));\n\n    this.#number.addEventListener('input', () => this.set(this.#number.value));\n\n    this.#lock.addEventListener('input', () => this.lock());\n\n    this.lock();\n  }\n\n  label(): string {\n    return this.#label;\n  }\n\n  private lock(): void {\n    if (this.isLocked()) {\n      this.#range.setAttribute('disabled', '');\n      this.#number.setAttribute('disabled', '');\n\n      return;\n    }\n\n    this.#range.removeAttribute('disabled');\n    this.#number.removeAttribute('disabled');\n  }\n\n  onInput(handler: onInputHandler): void {\n    this.#listeners.push(handler);\n  }\n\n  isLocked(): boolean {\n    return this.#lock.checked;\n  }\n\n  set(value: string): void {\n    value = Math.max(parseInt(value, 10), 0).toString();\n\n    if (this.#range.value !== value) {\n      this.#range.value = value;\n    }\n\n    if (this.#number.value !== value) {\n      this.#number.value = value;\n    }\n\n    this.#listeners.forEach((listener) => listener());\n  }\n\n  value(): number {\n    return parseInt(this.#range.value, 10);\n  }\n}\n\nexport default LockedSlider;\n", "import LockedSlider from './LockedSlider';\n\nexport class LockedSliderGroup {\n  #sliders;\n\n  constructor(...sliders: LockedSlider[]) {\n    this.#sliders = sliders;\n\n    this.#sliders.forEach((slider) =>\n      slider.onInput(() => {\n        if (this.total() === 100) {\n          return;\n        }\n\n        const otherSliders = this.#sliders.filter(\n            (otherSlider) => otherSlider !== slider\n          ),\n          otherActiveSliders = otherSliders.filter(\n            (slider) => !slider.isLocked()\n          );\n\n        if (this.total() !== 100 && otherActiveSliders.length === 0) {\n          slider.set((100 - this.total(otherSliders)).toString());\n\n          return;\n        }\n\n        if (this.total() > 100) {\n          let overage = this.total() - 100,\n            chunk = Math.ceil(overage / otherActiveSliders.length);\n\n          otherActiveSliders.forEach((otherSlider) => {\n            otherSlider.set(\n              (otherSlider.value() - Math.min(chunk, overage)).toString()\n            );\n\n            overage -= chunk;\n          });\n\n          if (this.total() > 100) {\n            slider.set((100 - this.total(otherSliders)).toString());\n          }\n        }\n\n        if (this.total() < 100) {\n          let remaining = 100 - this.total(),\n            chunk = Math.ceil(remaining / otherActiveSliders.length);\n\n          otherActiveSliders.forEach((otherSlider) => {\n            otherSlider.set(\n              (otherSlider.value() + Math.min(chunk, remaining)).toString()\n            );\n\n            remaining -= chunk;\n          });\n\n          if (this.total() < 100) {\n            slider.set((100 - this.total(otherSliders)).toString());\n          }\n        }\n      })\n    );\n  }\n\n  sliders(): LockedSlider[] {\n    return this.#sliders;\n  }\n\n  private total(sliders = this.#sliders): number {\n    return sliders.reduce((total, slider) => total + slider.value(), 0);\n  }\n}\n\nexport default LockedSliderGroup;\n", "import { Element, s } from '@dom111/element';\nimport { CustomEventMap } from '@dom111/element/src/Element';\n\nexport interface ITransientElement {\n  display(): void;\n  parent(): HTMLElement;\n}\n\nexport class TransientElement<\n    T extends HTMLElement = HTMLElement,\n    M extends CustomEventMap = CustomEventMap\n  >\n  extends Element<T, M>\n  implements ITransientElement\n{\n  #parent: HTMLElement;\n\n  constructor(parent: HTMLElement, element: T = s('<div></div>')) {\n    super(element);\n\n    // capture keys in the notification window\n    this.on('keydown', (event: KeyboardEvent) => {\n      event.stopPropagation();\n    });\n\n    this.element().setAttribute('tabindex', '0');\n\n    this.#parent = parent;\n  }\n\n  build(): void {}\n\n  display(): void {\n    this.build();\n\n    this.#parent.append(this.element());\n  }\n\n  parent(): HTMLElement {\n    return this.#parent;\n  }\n}\n\nexport default TransientElement;\n", "import { TransientElement, ITransientElement } from './TransientElement';\nimport { off, on, s } from '@dom111/element';\nimport { Coordinate } from '../types';\nimport { h } from '../lib/html';\n\nexport interface IWindow extends ITransientElement {\n  close(): void;\n  maximise(): void;\n}\n\ntype WindowSize = {\n  height: number | string;\n  width: number | string;\n};\n\ntype WindowPosition = {\n  x: number;\n  y: number;\n};\n\nexport type WindowSettings = {\n  autoDisplay: boolean;\n  canClose: boolean;\n  canMaximise: boolean;\n  canResize: boolean;\n  parent: HTMLElement;\n  position: WindowPosition | 'auto';\n  size: WindowSize | 'auto' | 'maximised';\n};\n\nexport type WindowOptions = { [K in keyof WindowSettings]?: WindowSettings[K] };\n\nconst defaultOptions: WindowSettings = {\n  autoDisplay: true,\n  canClose: true,\n  canMaximise: false,\n  canResize: false,\n  parent: document.body,\n  position: 'auto',\n  size: 'auto',\n};\n\nexport class Window\n  extends TransientElement<\n    HTMLDivElement,\n    {\n      close: [];\n    }\n  >\n  implements IWindow\n{\n  private options: WindowSettings;\n  #body: string | Node;\n  #title: string;\n\n  constructor(title: string, body: string | Node, options: WindowOptions = {}) {\n    super(\n      options.parent ?? defaultOptions.parent,\n      s<HTMLDivElement>('<div class=\"window\"></div>')\n    );\n\n    this.options = {\n      ...defaultOptions,\n      ...options,\n    };\n\n    this.#body = body;\n    this.#title = title;\n\n    if (this.options.size === 'auto') {\n      this.addClass('size-auto');\n    }\n\n    if (this.options.size === 'maximised') {\n      this.addClass('maximised');\n    }\n\n    if (this.options.size !== 'auto') {\n      (['height', 'width'] as ('height' | 'width')[]).forEach((dimension) => {\n        const value = (this.options.size as WindowSize)[dimension];\n\n        if (typeof value === 'number') {\n          this.element().style[dimension] = value + 'px';\n\n          return;\n        }\n\n        this.element().style[dimension] = value;\n      });\n    }\n\n    if (this.options.position === 'auto') {\n      this.addClass('position-auto');\n    }\n\n    if (this.options.position !== 'auto') {\n      (\n        [\n          ['x', 'left'],\n          ['y', 'top'],\n        ] as ['x' | 'y', 'left' | 'top'][]\n      ).forEach(([axis, property]) => {\n        this.element().style[property] =\n          Math.min(\n            0,\n            Math.max(\n              document.body.clientHeight - 20,\n              (this.options.position as WindowPosition)[axis]\n            )\n          ) + 'px';\n      });\n    }\n\n    if (this.options.autoDisplay) {\n      this.display();\n\n      return;\n    }\n\n    this.build();\n  }\n\n  build(): void {\n    this.empty();\n\n    const headerActions: HTMLElement[] = (\n      [\n        [\n          this.options.canMaximise,\n          h(\n            s(\n              `<button class=\"maximise\" aria-label=\"Maximise\">Maximise</button>`\n            ),\n            {\n              click: () => this.maximise(),\n            }\n          ),\n        ],\n        [\n          this.options.canClose,\n          h(s(`<button class=\"close\" aria-label=\"Close\">Maximise</button>`), {\n            click: () => this.close(),\n          }),\n        ],\n      ] as [boolean, HTMLElement][]\n    )\n      .filter(([show]: [boolean, HTMLElement]) => show)\n      .map(([, element]) => element);\n\n    let isDragging = false;\n\n    this.append(\n      h(s(`<header><h3>${this.#title}</h3></header>`, ...headerActions), {\n        dblclick: () => this.maximise(),\n        mousedown: (event) => {\n          if (event.target.matches('button, button img')) {\n            return;\n          }\n\n          isDragging = true;\n\n          const moveHandler = (event: MouseEvent) => {\n            if (!isDragging) {\n              return;\n            }\n\n            this.move({\n              x: event.movementX,\n              y: event.movementY,\n            });\n          };\n\n          on(document, 'mousemove', moveHandler);\n\n          on(\n            document,\n            'mouseup',\n            () => {\n              off(document, 'mousemove', moveHandler);\n\n              isDragging = false;\n            },\n            {\n              once: true,\n            }\n          );\n        },\n      }),\n      s(\n        '<div class=\"body\"></div>',\n        this.#body instanceof Node ? this.#body : s(`<p>${this.#body}</p>`)\n      )\n    );\n\n    this.on('keydown', (event: KeyboardEvent) => {\n      if (event.key === 'Escape' && this.options.canClose) {\n        this.close();\n      }\n\n      // Capture all keypresses whilst this is focused\n      event.stopPropagation();\n    });\n  }\n\n  close(): void {\n    this.remove();\n\n    this.emit(new CustomEvent('close'));\n  }\n\n  display(focus = true): void {\n    super.display();\n\n    if (!focus) {\n      return;\n    }\n\n    this.element().focus();\n  }\n\n  maximise(): void {\n    if (!this.options.canMaximise) {\n      return;\n    }\n\n    this.element().classList.toggle('maximised');\n\n    this.emit(\n      new CustomEvent('resize', {\n        bubbles: false,\n      })\n    );\n  }\n\n  move({ x, y }: Coordinate): void {\n    if (this.hasClass('position-auto')) {\n      // Ensure the auto position is accounted for\n      x += this.element().offsetLeft;\n      y += this.element().offsetTop;\n\n      this.removeClass('position-auto');\n\n      this.element().style.setProperty('top', y + 'px');\n      this.element().style.setProperty('left', x + 'px');\n\n      return;\n    }\n\n    const elementComputedStyle = getComputedStyle(this.element()),\n      currentTop = parseInt(elementComputedStyle.getPropertyValue('top'), 10),\n      currentLeft = parseInt(elementComputedStyle.getPropertyValue('left'), 10);\n\n    this.element().style.setProperty('top', currentTop + y + 'px');\n    this.element().style.setProperty('left', currentLeft + x + 'px');\n  }\n\n  update(content: string | Node): void {\n    this.element().lastElementChild!.remove();\n\n    this.append(content instanceof Node ? content : s(`<p>${content}</p>`));\n  }\n}\n\nexport default Window;\n", "export const h = <T extends HTMLElement>(\n  element: T,\n  handlers: { [key: string]: (event: any) => void }\n): T => {\n  Object.entries(handlers).forEach(([eventName, handler]): void =>\n    element.addEventListener(eventName, handler)\n  );\n\n  return element;\n};\n", "const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n", "import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);\n        });\n    }\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event.newVersion, event));\n    }\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking) {\n            db.addEventListener('versionchange', (event) => blocking(event.oldVersion, event.newVersion, event));\n        }\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked) {\n        request.addEventListener('blocked', (event) => blocked(\n        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405\n        event.oldVersion, event));\n    }\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n", "import {\n  DBSchema,\n  IDBPDatabase,\n  StoreKey,\n  StoreNames,\n  StoreValue,\n} from 'idb/build/entry';\nimport { openDB } from 'idb';\n\nexport interface Record {\n  [key: string]: any;\n}\n\nexport class Store<Types extends DBSchema> {\n  #connection: Promise<IDBPDatabase<Types>>;\n  #store: StoreNames<Types>;\n\n  constructor(\n    db: string,\n    store: StoreNames<Types>,\n    options?: IDBObjectStoreParameters\n  ) {\n    this.#store = store;\n\n    this.#connection = openDB(db, 1, {\n      upgrade: (db) => db.createObjectStore(this.#store, options),\n    });\n  }\n\n  async get(key: StoreKey<Types, StoreNames<Types>>) {\n    return (await this.#connection).get(this.#store, key);\n  }\n\n  async getAll(\n    query?: StoreKey<Types, StoreNames<Types>> | IDBKeyRange | null,\n    count?: number\n  ) {\n    return (await this.#connection).getAll(this.#store, query, count);\n  }\n\n  async set(\n    record: StoreValue<Types, StoreNames<Types>>,\n    key?: StoreKey<Types, StoreNames<Types>>\n  ) {\n    return (await this.#connection).put(this.#store, record, key);\n  }\n\n  async clear() {\n    return (await this.#connection).clear(this.#store);\n  }\n\n  async keys() {\n    return (await this.#connection).getAllKeys(this.#store);\n  }\n}\n", "type ScalingOptions = {\n  smoothing?: boolean;\n};\n\nexport const scaleImage = (\n  image: CanvasImageSource,\n  scale: number,\n  options?: ScalingOptions\n): HTMLCanvasElement => {\n  const newCanvas = document.createElement('canvas')!,\n    context = newCanvas.getContext('2d')!;\n\n  newCanvas.width = (image.width as number) * scale;\n  newCanvas.height = (image.height as number) * scale;\n\n  if (!options?.smoothing) {\n    context.imageSmoothingEnabled = false;\n  }\n\n  context.drawImage(image, 0, 0, newCanvas.width, newCanvas.height);\n\n  return newCanvas;\n};\n\nexport default scaleImage;\n", "import { Record, Store } from './Store';\nimport scaleImage from './lib/scaleImage';\n\ninterface Asset extends Record {\n  name: string;\n  uri: string;\n}\n\nexport class AssetStore extends Store<{\n  assets: {\n    key: string;\n    value: Asset;\n  };\n}> {\n  #cachedAssets = new Map<string, Asset>();\n  #cachedImages = new Map<string, HTMLImageElement>();\n  #cachedScaledImages = new Map<string, HTMLCanvasElement>();\n  #requiredAssets: string[] = [\n    './assets/city/bulb.png',\n    './assets/city/food.png',\n    './assets/city/gold.png',\n    './assets/city/luxury.png',\n    './assets/city/people_content_f.png',\n    './assets/city/people_content_m.png',\n    './assets/city/people_happy_f.png',\n    './assets/city/people_happy_m.png',\n    './assets/city/people_luxury.png',\n    './assets/city/people_science.png',\n    './assets/city/people_tax.png',\n    './assets/city/people_unhappy_f.png',\n    './assets/city/people_unhappy_m.png',\n    './assets/city/pollution.png',\n    './assets/city/sad.png',\n    './assets/city/production.png',\n    './assets/city/trade.png',\n    './assets/cursor/go.png',\n    './assets/cursor/torch.png',\n    './assets/general/texture_1.png',\n    './assets/general/texture_2.png',\n    './assets/improvements/irrigation.png',\n    './assets/improvements/mine.png',\n    './assets/improvements/pollution.png',\n    './assets/improvements/railroad_e.png',\n    './assets/improvements/railroad_se.png',\n    './assets/improvements/railroad_n.png',\n    './assets/improvements/railroad_ne.png',\n    './assets/improvements/railroad_nw.png',\n    './assets/improvements/railroad_s.png',\n    './assets/improvements/railroad_sw.png',\n    './assets/improvements/railroad_w.png',\n    './assets/improvements/road_e.png',\n    './assets/improvements/road_n.png',\n    './assets/improvements/road_ne.png',\n    './assets/improvements/road_nw.png',\n    './assets/improvements/road_s.png',\n    './assets/improvements/road_se.png',\n    './assets/improvements/road_sw.png',\n    './assets/improvements/road_w.png',\n    './assets/map/city.png',\n    './assets/map/fog_e.png',\n    './assets/map/fog_n.png',\n    './assets/map/fog_s.png',\n    './assets/map/fog_w.png',\n    './assets/map/fort.png',\n    './assets/map/fortify.png',\n    './assets/map/hut.png',\n    './assets/status/pollution_0.png',\n    './assets/status/pollution_25.png',\n    './assets/status/pollution_50.png',\n    './assets/status/pollution_75.png',\n    './assets/status/science_0.png',\n    './assets/status/science_25.png',\n    './assets/status/science_50.png',\n    './assets/status/science_75.png',\n    './assets/terrain/arctic.png',\n    './assets/terrain/arctic_e.png',\n    './assets/terrain/arctic_es.png',\n    './assets/terrain/arctic_esw.png',\n    './assets/terrain/arctic_ew.png',\n    './assets/terrain/arctic_n.png',\n    './assets/terrain/arctic_ne.png',\n    './assets/terrain/arctic_nes.png',\n    './assets/terrain/arctic_nesw.png',\n    './assets/terrain/arctic_new.png',\n    './assets/terrain/arctic_ns.png',\n    './assets/terrain/arctic_nsw.png',\n    './assets/terrain/arctic_nw.png',\n    './assets/terrain/arctic_s.png',\n    './assets/terrain/arctic_sw.png',\n    './assets/terrain/arctic_w.png',\n    './assets/terrain/coal.png',\n    './assets/terrain/coast_sprite.png',\n    './assets/terrain/desert.png',\n    './assets/terrain/desert_e.png',\n    './assets/terrain/desert_es.png',\n    './assets/terrain/desert_esw.png',\n    './assets/terrain/desert_ew.png',\n    './assets/terrain/desert_n.png',\n    './assets/terrain/desert_ne.png',\n    './assets/terrain/desert_nes.png',\n    './assets/terrain/desert_nesw.png',\n    './assets/terrain/desert_new.png',\n    './assets/terrain/desert_ns.png',\n    './assets/terrain/desert_nsw.png',\n    './assets/terrain/desert_nw.png',\n    './assets/terrain/desert_s.png',\n    './assets/terrain/desert_sw.png',\n    './assets/terrain/desert_w.png',\n    './assets/terrain/doe.png',\n    './assets/terrain/fish.png',\n    './assets/terrain/forest.png',\n    './assets/terrain/forest_e.png',\n    './assets/terrain/forest_es.png',\n    './assets/terrain/forest_esw.png',\n    './assets/terrain/forest_ew.png',\n    './assets/terrain/forest_n.png',\n    './assets/terrain/forest_ne.png',\n    './assets/terrain/forest_nes.png',\n    './assets/terrain/forest_nesw.png',\n    './assets/terrain/forest_new.png',\n    './assets/terrain/forest_ns.png',\n    './assets/terrain/forest_nsw.png',\n    './assets/terrain/forest_nw.png',\n    './assets/terrain/forest_s.png',\n    './assets/terrain/forest_sw.png',\n    './assets/terrain/forest_w.png',\n    './assets/terrain/gems.png',\n    './assets/terrain/gold.png',\n    './assets/terrain/grassland.png',\n    './assets/terrain/grassland_e.png',\n    './assets/terrain/grassland_es.png',\n    './assets/terrain/grassland_esw.png',\n    './assets/terrain/grassland_ew.png',\n    './assets/terrain/grassland_n.png',\n    './assets/terrain/grassland_ne.png',\n    './assets/terrain/grassland_nes.png',\n    './assets/terrain/grassland_nesw.png',\n    './assets/terrain/grassland_new.png',\n    './assets/terrain/grassland_ns.png',\n    './assets/terrain/grassland_nsw.png',\n    './assets/terrain/grassland_nw.png',\n    './assets/terrain/grassland_s.png',\n    './assets/terrain/grassland_sw.png',\n    './assets/terrain/grassland_w.png',\n    './assets/terrain/hills.png',\n    './assets/terrain/hills_e.png',\n    './assets/terrain/hills_es.png',\n    './assets/terrain/hills_esw.png',\n    './assets/terrain/hills_ew.png',\n    './assets/terrain/hills_n.png',\n    './assets/terrain/hills_ne.png',\n    './assets/terrain/hills_nes.png',\n    './assets/terrain/hills_nesw.png',\n    './assets/terrain/hills_new.png',\n    './assets/terrain/hills_ns.png',\n    './assets/terrain/hills_nsw.png',\n    './assets/terrain/hills_nw.png',\n    './assets/terrain/hills_s.png',\n    './assets/terrain/hills_sw.png',\n    './assets/terrain/hills_w.png',\n    './assets/terrain/horse.png',\n    './assets/terrain/jungle.png',\n    './assets/terrain/jungle_e.png',\n    './assets/terrain/jungle_es.png',\n    './assets/terrain/jungle_esw.png',\n    './assets/terrain/jungle_ew.png',\n    './assets/terrain/jungle_n.png',\n    './assets/terrain/jungle_ne.png',\n    './assets/terrain/jungle_nes.png',\n    './assets/terrain/jungle_nesw.png',\n    './assets/terrain/jungle_new.png',\n    './assets/terrain/jungle_ns.png',\n    './assets/terrain/jungle_nsw.png',\n    './assets/terrain/jungle_nw.png',\n    './assets/terrain/jungle_s.png',\n    './assets/terrain/jungle_sw.png',\n    './assets/terrain/jungle_w.png',\n    './assets/terrain/land.png',\n    './assets/terrain/mountains.png',\n    './assets/terrain/mountains_e.png',\n    './assets/terrain/mountains_es.png',\n    './assets/terrain/mountains_esw.png',\n    './assets/terrain/mountains_ew.png',\n    './assets/terrain/mountains_n.png',\n    './assets/terrain/mountains_ne.png',\n    './assets/terrain/mountains_nes.png',\n    './assets/terrain/mountains_nesw.png',\n    './assets/terrain/mountains_new.png',\n    './assets/terrain/mountains_ns.png',\n    './assets/terrain/mountains_nsw.png',\n    './assets/terrain/mountains_nw.png',\n    './assets/terrain/mountains_s.png',\n    './assets/terrain/mountains_sw.png',\n    './assets/terrain/mountains_w.png',\n    './assets/terrain/oasis.png',\n    './assets/terrain/ocean.png',\n    './assets/terrain/oil.png',\n    './assets/terrain/plains.png',\n    './assets/terrain/plains_e.png',\n    './assets/terrain/plains_es.png',\n    './assets/terrain/plains_esw.png',\n    './assets/terrain/plains_ew.png',\n    './assets/terrain/plains_n.png',\n    './assets/terrain/plains_ne.png',\n    './assets/terrain/plains_nes.png',\n    './assets/terrain/plains_nesw.png',\n    './assets/terrain/plains_new.png',\n    './assets/terrain/plains_ns.png',\n    './assets/terrain/plains_nsw.png',\n    './assets/terrain/plains_nw.png',\n    './assets/terrain/plains_s.png',\n    './assets/terrain/plains_sw.png',\n    './assets/terrain/plains_w.png',\n    './assets/terrain/river_e.png',\n    './assets/terrain/river_es.png',\n    './assets/terrain/river_esw.png',\n    './assets/terrain/river_ew.png',\n    './assets/terrain/river_mouth_e.png',\n    './assets/terrain/river_mouth_n.png',\n    './assets/terrain/river_mouth_s.png',\n    './assets/terrain/river_mouth_w.png',\n    './assets/terrain/river.png',\n    './assets/terrain/river_n.png',\n    './assets/terrain/river_ne.png',\n    './assets/terrain/river_nes.png',\n    './assets/terrain/river_nesw.png',\n    './assets/terrain/river_new.png',\n    './assets/terrain/river_ns.png',\n    './assets/terrain/river_nsw.png',\n    './assets/terrain/river_nw.png',\n    './assets/terrain/river_s.png',\n    './assets/terrain/river_sw.png',\n    './assets/terrain/river_w.png',\n    './assets/terrain/seal.png',\n    './assets/terrain/shield.png',\n    './assets/terrain/game.png',\n    './assets/terrain/swamp.png',\n    './assets/terrain/swamp_e.png',\n    './assets/terrain/swamp_es.png',\n    './assets/terrain/swamp_esw.png',\n    './assets/terrain/swamp_ew.png',\n    './assets/terrain/swamp_n.png',\n    './assets/terrain/swamp_ne.png',\n    './assets/terrain/swamp_nes.png',\n    './assets/terrain/swamp_nesw.png',\n    './assets/terrain/swamp_new.png',\n    './assets/terrain/swamp_ns.png',\n    './assets/terrain/swamp_nsw.png',\n    './assets/terrain/swamp_nw.png',\n    './assets/terrain/swamp_s.png',\n    './assets/terrain/swamp_sw.png',\n    './assets/terrain/swamp_w.png',\n    './assets/terrain/tundra.png',\n    './assets/terrain/tundra_e.png',\n    './assets/terrain/tundra_es.png',\n    './assets/terrain/tundra_esw.png',\n    './assets/terrain/tundra_ew.png',\n    './assets/terrain/tundra_n.png',\n    './assets/terrain/tundra_ne.png',\n    './assets/terrain/tundra_nes.png',\n    './assets/terrain/tundra_nesw.png',\n    './assets/terrain/tundra_new.png',\n    './assets/terrain/tundra_ns.png',\n    './assets/terrain/tundra_nsw.png',\n    './assets/terrain/tundra_nw.png',\n    './assets/terrain/tundra_s.png',\n    './assets/terrain/tundra_sw.png',\n    './assets/terrain/tundra_w.png',\n    './assets/units/tank.png',\n    './assets/units/artillery.png',\n    './assets/units/battleship.png',\n    './assets/units/bomber.png',\n    './assets/units/cannon.png',\n    './assets/units/caravan.png',\n    './assets/units/carrier.png',\n    './assets/units/catapult.png',\n    './assets/units/horseman.png',\n    './assets/units/chariot.png',\n    './assets/units/combat_1.png',\n    './assets/units/combat_2.png',\n    './assets/units/combat_3.png',\n    './assets/units/combat_4.png',\n    './assets/units/combat_5.png',\n    './assets/units/combat_6.png',\n    './assets/units/combat_7.png',\n    './assets/units/combat_8.png',\n    './assets/units/cruiser.png',\n    './assets/units/diplomat.png',\n    './assets/units/fighter.png',\n    './assets/units/frigate.png',\n    './assets/units/ironclad.png',\n    './assets/units/knight.png',\n    './assets/units/swordman.png',\n    './assets/units/mechanizedinfantry.png',\n    './assets/units/warrior.png',\n    './assets/units/musketman.png',\n    './assets/units/nuclear.png',\n    './assets/units/spearman.png',\n    './assets/units/rifleman.png',\n    './assets/units/sail.png',\n    './assets/units/settlers.png',\n    './assets/units/submarine.png',\n    './assets/units/transport.png',\n    './assets/units/trireme.png',\n  ];\n\n  constructor() {\n    super('civ-clone-assets', 'assets', {\n      keyPath: 'name',\n    });\n  }\n\n  async get(path: string): Promise<Asset> {\n    if (!this.#cachedAssets.has(path)) {\n      this.#cachedAssets.set(path, (await super.get(path))!);\n    }\n\n    return this.#cachedAssets.get(path)!;\n  }\n\n  async getImage(path: string): Promise<HTMLImageElement> {\n    if (!this.#cachedImages.has(path)) {\n      const asset = await this.get(path),\n        image = document.createElement('img')!;\n\n      image.src = asset.uri;\n\n      this.#cachedImages.set(path, image);\n    }\n\n    return this.#cachedImages.get(path)!;\n  }\n\n  async getScaled(path: string, scale: number): Promise<HTMLCanvasElement> {\n    if (!this.#cachedScaledImages.has(path)) {\n      this.#cachedScaledImages.set(\n        path,\n        scaleImage(await this.getImage(path), scale)\n      );\n    }\n\n    return this.#cachedScaledImages.get(path)!;\n  }\n\n  async hasAllAssets(): Promise<boolean> {\n    return (await this.missingAssets()).length === 0;\n  }\n\n  async missingAssets(): Promise<string[]> {\n    const dbAssets = await this.keys();\n\n    return this.#requiredAssets.filter(\n      (requiredAsset) => !dbAssets.includes(requiredAsset)\n    );\n  }\n}\n\nexport const assetStore = new AssetStore();\n", "import Action from './Action';\nimport LockedSlider from '../LockedSlider';\nimport LockedSliderGroup from '../LockedSliderGroup';\nimport { PlayerTradeRates } from '../../types';\nimport Window from '../Window';\nimport { assetStore } from '../../AssetStore';\nimport { s } from '@dom111/element';\n\nexport class AdjustTradeRates extends Action {\n  #sliderGroup: LockedSliderGroup | undefined;\n\n  activate(): void {\n    const sliders: LockedSlider[] = [];\n\n    const window = new Window(\n      'Adjust trade rates',\n      s(\n        '<div></div>',\n        ...this.value().all.map((tradeRate) => {\n          const slider = new LockedSlider(tradeRate._, tradeRate.value * 100);\n\n          sliders.push(slider);\n\n          return slider;\n        })\n      )\n    );\n\n    window.on('close', () => {\n      const value = this.#sliderGroup!.sliders().map((slider) => [\n        slider.label(),\n        parseFloat((slider.value() / 100).toFixed(2)),\n      ]);\n\n      console.info('AdjustTradeRates: ', value);\n\n      this.transport().send('action', {\n        name: 'AdjustTradeRates',\n        id: this.value().id,\n        value,\n      });\n    });\n\n    this.#sliderGroup = new LockedSliderGroup(...sliders);\n  }\n\n  build(): void {\n    assetStore\n      .get('./assets/city/trade.png')\n      .then((asset) =>\n        this.append(\n          s(\n            `<button class=\"adjustTradeRates\" title=\"Adjust trade rates\" style=\"background-image:url('${\n              asset!.uri\n            }')\"></button>`\n          )\n        )\n      );\n  }\n\n  value(): PlayerTradeRates {\n    return super.value() as PlayerTradeRates;\n  }\n}\n\nexport default AdjustTradeRates;\n", "import { Window, IWindow, WindowOptions } from './Window';\n\nexport interface INotificationWindow extends IWindow {}\n\nconst notificationQueue: [\n  NotificationWindow,\n  boolean,\n  (...args: any[]) => void\n][] = [];\n\nexport interface NotificationWindowOptions extends WindowOptions {\n  queue?: boolean;\n}\n\nexport class NotificationWindow extends Window implements INotificationWindow {\n  #options: NotificationWindowOptions = {};\n\n  constructor(\n    title: string,\n    body: string | Node,\n    passedOptions: NotificationWindowOptions = {}\n  ) {\n    const options = {\n      queue: true,\n      ...passedOptions,\n    };\n\n    super(title, body, options);\n\n    this.#options = options;\n\n    this.addClass('notificationWindow');\n\n    this.on('keydown', (event) => {\n      if (event.key === 'Enter') {\n        this.close();\n\n        event.stopPropagation();\n      }\n    });\n  }\n\n  close(): void {\n    super.close();\n\n    if (\n      this.#options.queue &&\n      notificationQueue.length &&\n      NotificationWindow.hasOpenWindow()\n    ) {\n      const [notification, focus, resolve] = notificationQueue.shift()!;\n\n      notification.display(focus);\n\n      resolve();\n    }\n  }\n\n  display(focus = true): Promise<any> {\n    return new Promise((resolve) => {\n      if (NotificationWindow.hasOpenWindow()) {\n        notificationQueue.push([this, focus, resolve]);\n\n        return;\n      }\n\n      super.display();\n\n      if (!focus) {\n        resolve(undefined);\n\n        return;\n      }\n\n      this.element().focus();\n\n      resolve(undefined);\n    });\n  }\n\n  static hasOpenWindow(): boolean {\n    return !!document.querySelector('div.notificationWindow');\n  }\n}\n\nexport default NotificationWindow;\n", "import {\n  NotificationWindow,\n  NotificationWindowOptions,\n} from './NotificationWindow';\nimport { off, on, s } from '@dom111/element';\nimport { h } from '../lib/html';\n\nexport interface SelectionWindowOption {\n  label?: string;\n  value: any;\n}\n\nexport interface SelectionWindowAction {\n  label: string;\n  action: (select: SelectionWindow) => void;\n}\n\nexport interface SelectionWindowActions {\n  [key: string]: SelectionWindowAction;\n}\n\nexport interface SelectionWindowOptions extends NotificationWindowOptions {\n  actions?: SelectionWindowActions;\n  autoFocus?: boolean;\n  displayAll?: boolean;\n}\n\nexport class SelectionWindow extends NotificationWindow {\n  #resizeHandler = () => this.resize();\n  #selectionList: HTMLSelectElement;\n\n  constructor(\n    title: string,\n    optionList: SelectionWindowOption[],\n    onChoose: (selection: string) => void,\n    body: string | Node | null = 'Please choose one of the following:',\n    options: SelectionWindowOptions = {}\n  ) {\n    options = {\n      autoFocus: true,\n      displayAll: false,\n      ...options,\n      actions: {\n        primary: {\n          label: 'OK',\n          action: (selectionWindow) =>\n            chooseHandler(selectionWindow.selectionList().value),\n          ...(options.actions?.primary ?? {}),\n        },\n        ...options.actions,\n      },\n    };\n\n    const chooseHandler = (selection: string): void => {\n        this.emit(\n          new CustomEvent<string>('selection', {\n            detail: selection,\n          })\n        );\n\n        this.close();\n\n        onChoose(selection);\n      },\n      selectionList: HTMLSelectElement = h(\n        s(\n          `<select>${optionList\n            .map(\n              (option) =>\n                `<option value=\"${option.value}\">${\n                  option.label || option.value\n                }</option>`\n            )\n            .join('')}</select>`\n        ),\n        {\n          keydown: (event: KeyboardEvent) => {\n            if (event.key === 'Enter') {\n              chooseHandler(selectionList.value);\n            }\n          },\n          dblclick: () => chooseHandler(selectionList.value),\n        }\n      );\n\n    if (options.displayAll && optionList.length > 1) {\n      selectionList.setAttribute('size', optionList.length.toString());\n    }\n\n    if (options.autoFocus && optionList.length > 1) {\n      selectionList.setAttribute('autofocus', '');\n    }\n\n    super(\n      title,\n      s(\n        '<div></div>',\n        ...(body instanceof Node\n          ? [body]\n          : body === null\n          ? []\n          : [s(`<p>${body}</p>`)]),\n        selectionList,\n        s(\n          '<footer></footer>',\n          ...Object.entries(options.actions!).map(([, { label, action }]) =>\n            h(s(`<button>${label}</button>`), {\n              click: () => action(this),\n              keydown: (event) => {\n                if (event.key === 'Enter') {\n                  action(this);\n                }\n              },\n            })\n          )\n        )\n      ),\n      options\n    );\n\n    this.addClass('selectionWindow');\n    this.#selectionList = selectionList;\n\n    this.resize();\n\n    on(window, 'resize', this.#resizeHandler);\n  }\n\n  close() {\n    off(window, 'resize', this.#resizeHandler);\n\n    super.close();\n  }\n\n  display(): Promise<any> {\n    return super.display(false).then(() => {\n      const select = this.query('select');\n\n      if (select && select.hasAttribute('autofocus')) {\n        select.focus();\n      }\n    });\n  }\n\n  resize(): void {\n    // TODO: I'd like to have this height scaled automatically.\n    //  Feels like it should be possible using CSS flexbox, but can't get it to work...\n    try {\n      this.selectionList().style.maxHeight = 'none';\n      this.selectionList().style.maxHeight = `calc(${\n        this.element().offsetHeight -\n        (this.element().firstElementChild! as HTMLElement).offsetHeight -\n        ((this.selectionList().previousElementSibling as HTMLElement)\n          ?.offsetHeight ?? 0) -\n        (this.selectionList().nextElementSibling as HTMLElement).offsetHeight\n      }px - 2.1em)`;\n    } catch (e) {\n      console.warn(e);\n    }\n  }\n\n  selectionList(): HTMLSelectElement {\n    return this.#selectionList;\n  }\n}\n\nexport default SelectionWindow;\n", "import Action from './Action';\nimport { PlayerResearch } from '../../types';\nimport SelectionWindow from '../SelectionWindow';\nimport { assetStore } from '../../AssetStore';\nimport { s } from '@dom111/element';\n\nexport class ChooseResearch extends Action {\n  activate(): void {\n    const chooseWindow = new SelectionWindow(\n      'Choose research',\n      this.value().available.map((advance) => ({\n        value: advance._,\n      })),\n      (selection) => {\n        if (!selection) {\n          return;\n        }\n\n        this.transport().send('action', {\n          name: 'ChooseResearch',\n          id: this.value().id,\n          chosen: selection ? selection : '@',\n        });\n\n        this.complete();\n\n        chooseWindow.close();\n      },\n      'Which advance would you like to research next?',\n      {\n        displayAll: true,\n      }\n    );\n  }\n\n  build(): void {\n    assetStore\n      .get('./assets/city/bulb.png')\n      .then((asset) =>\n        this.append(\n          s(\n            `<button class=\"chooseResearch\" title=\"Choose research\" style=\"background-image:url('${\n              asset!.uri\n            }')\">`\n          )\n        )\n      );\n  }\n\n  value(): PlayerResearch {\n    return super.value() as PlayerResearch;\n  }\n}\n\nexport default ChooseResearch;\n", "import { City, Yield } from '../types';\n\nexport const knownGroups: { [key: string]: string } = {\n  Food: 'Food',\n  UnitSupportFood: 'Food',\n  PopulationSupportFood: 'Food',\n  Production: 'Production',\n  UnitSupportProduction: 'Production',\n  Trade: 'Trade',\n  Corruption: 'Trade',\n  Happiness: 'Happiness',\n  LuxuryHappiness: 'Happiness',\n  Unhappiness: 'Unhappiness',\n  MartialLaw: 'Unhappiness',\n  MilitaryUnhappiness: 'Unhappiness',\n  PopulationUnhappiness: 'Unhappiness',\n  CityImprovementContent: 'Unhappiness',\n  Research: 'Research',\n  Luxuries: 'Luxuries',\n  Gold: 'Gold',\n  CityImprovementMaintenanceGold: 'Gold',\n};\n\nexport const knownGroupLookup = Object.entries(knownGroups).reduce(\n  (object, [yieldName, group]) => {\n    if (!Object.prototype.hasOwnProperty.call(object, group)) {\n      object[group] = [];\n    }\n\n    if (!Object.prototype.hasOwnProperty.call(object, yieldName)) {\n      object[yieldName] = [];\n    }\n\n    object[group].push(yieldName);\n    object[yieldName].push(yieldName);\n\n    return object;\n  },\n  {} as { [key: string]: string[] }\n);\n\nexport const reduceKnownYields = (\n  yields: Yield[],\n  ...yieldNames: string[]\n): number[] =>\n  yields.reduce(\n    (yields, cityYield, index) => {\n      yieldNames.forEach((yieldName, index) => {\n        if (knownGroupLookup[yieldName]?.includes(cityYield._)) {\n          yields[index] += cityYield.value;\n        }\n      });\n\n      return yields;\n    },\n    yieldNames.map(() => 0)\n  );\n\nexport const reduceKnownYield = (yields: Yield[], yieldName: string): number =>\n  reduceKnownYields(yields, yieldName)[0];\n\nexport const knownIcons: { [key: string]: string } = {\n  Food: 'city/food.png',\n  Production: 'city/production.png',\n  Trade: 'city/trade.png',\n  Gold: 'city/gold.png',\n  Luxuries: 'city/luxury.png',\n  Pollution: 'city/pollution.png',\n  Research: 'city/bulb.png',\n  Unhappiness: 'city/sad.png',\n};\n", "export type CustomEventMap = {\n  [key: string]: any[];\n};\ntype Listener<\n  M,\n  K extends string = string\n> = K extends keyof GlobalEventHandlersEventMap\n  ? (event: GlobalEventHandlersEventMap[K]) => any\n  : K extends keyof M\n  ? (event: CustomEvent<M[K]>) => any\n  : EventListener;\ntype ListenerKeys<T> = keyof T extends string ? keyof T : never;\ntype ListenerOptions = boolean | AddEventListenerOptions;\n\nexport const addClass = (element: HTMLElement, ...classes: string[]) =>\n  element.classList.add(...classes);\n\nexport const emit = (target: EventTarget, event: Event): boolean =>\n  target.dispatchEvent(event);\n\nexport const emitCustom = <T extends any[] = any[]>(\n  target: EventTarget,\n  eventName: string,\n  ...params: T\n): boolean =>\n  emit(\n    target,\n    new CustomEvent<T>(eventName, {\n      detail: params,\n    })\n  );\n\nexport const empty = (element: HTMLElement): void => {\n  while (element.hasChildNodes()) {\n    element.firstChild?.remove();\n  }\n};\n\nexport const hasClass = (element: HTMLElement, className: string): boolean =>\n  element.classList.contains(className);\n\nexport const off = <\n  M extends CustomEventMap = CustomEventMap,\n  K extends\n    | string\n    | ListenerKeys<GlobalEventHandlersEventMap>\n    | ListenerKeys<M> = string\n>(\n  target: EventTarget,\n  event: K,\n  listener: Listener<M, K>,\n  options: ListenerOptions = {}\n): void =>\n  target.removeEventListener(\n    event as string,\n    listener as EventListener,\n    options\n  );\n\nexport const on = <\n  M extends CustomEventMap = CustomEventMap,\n  K extends\n    | string\n    | ListenerKeys<GlobalEventHandlersEventMap>\n    | ListenerKeys<M> = string\n>(\n  target: EventTarget,\n  event: K,\n  listener: Listener<M, K>,\n  options: ListenerOptions = {}\n): void =>\n  target.addEventListener(event as string, listener as EventListener, options);\n\nexport const onEach = <\n  M extends CustomEventMap = CustomEventMap,\n  K extends\n    | string\n    | ListenerKeys<GlobalEventHandlersEventMap>\n    | ListenerKeys<M> = string\n>(\n  target: EventTarget,\n  events: K[],\n  listener: Listener<M, K>,\n  options: ListenerOptions = {}\n): void =>\n  events.forEach((event) => on<M, K>(target, event, listener, options));\n\nexport const once = <\n  M extends CustomEventMap = CustomEventMap,\n  K extends\n    | string\n    | ListenerKeys<GlobalEventHandlersEventMap>\n    | ListenerKeys<M> = string\n>(\n  target: EventTarget,\n  event: K,\n  listener: Listener<M, K>,\n  options: ListenerOptions = {}\n): void =>\n  on<M, K>(target, event, listener, {\n    ...(typeof options === 'boolean' ? { capture: options } : options),\n    once: true,\n  });\n\nexport const removeClass = (element: HTMLElement, ...classes: string[]) =>\n  element.classList.remove(...classes);\n\nexport const s = <T extends HTMLElement = HTMLElement>(\n  html: string,\n  ...childNodes: (string | Node | Element)[]\n): T => {\n  const container = document.createElement('div');\n\n  container.innerHTML = html;\n\n  const element = container.firstElementChild as T;\n\n  childNodes.forEach((childNode) => {\n    if (childNode instanceof Element) {\n      element.append(childNode.element());\n\n      return;\n    }\n\n    if (childNode instanceof Node) {\n      element.append(childNode);\n\n      return;\n    }\n\n    element.append(t(childNode));\n  });\n\n  return element;\n};\n\nexport const t = (content: string): Text => document.createTextNode(content);\n\nexport const toggleClass = (element: HTMLElement, ...classes: string[]) =>\n  classes.forEach((className) => element.classList.toggle(className));\n\nexport class Element<\n  T extends HTMLElement = HTMLElement,\n  M extends CustomEventMap = CustomEventMap\n> {\n  #element: T;\n\n  constructor(element: T) {\n    this.#element = element;\n  }\n\n  static fromString<\n    T extends HTMLElement = HTMLElement,\n    M extends CustomEventMap = CustomEventMap\n  >(html: string): Element<T, M> {\n    return new Element(s(html));\n  }\n\n  addClass(...classes: string[]): void {\n    addClass(this.element(), ...classes);\n  }\n\n  append(...nodes: (Node | Element)[]): void {\n    nodes.forEach((node) => {\n      if (node instanceof Element) {\n        node = node.element();\n      }\n\n      this.element().append(node);\n    });\n  }\n\n  element(): T {\n    return this.#element;\n  }\n\n  emit(event: Event): boolean {\n    return emit(this.element(), event);\n  }\n\n  emitCustom<K extends string | keyof M>(\n    eventName: K,\n    ...params: M[K]\n  ): boolean {\n    return emitCustom<M[K]>(this.element(), eventName as string, ...params);\n  }\n\n  empty(): void {\n    empty(this.element());\n  }\n\n  hasClass(className: string): boolean {\n    return hasClass(this.element(), className);\n  }\n\n  off<\n    K extends string =\n      | ListenerKeys<GlobalEventHandlersEventMap>\n      | ListenerKeys<M>\n  >(event: K, listener: Listener<M, K>, options: ListenerOptions = {}): void {\n    off<M, K>(this.element(), event, listener, options);\n  }\n\n  on<\n    K extends string =\n      | ListenerKeys<GlobalEventHandlersEventMap>\n      | ListenerKeys<M>\n  >(event: K, listener: Listener<M, K>, options: ListenerOptions = {}): void {\n    on<M, K>(this.element(), event, listener, options);\n  }\n\n  onEach<K extends string = ListenerKeys<GlobalEventHandlersEventMap & M>>(\n    events: K[],\n    listener: Listener<M, K>,\n    options: ListenerOptions = {}\n  ): void {\n    onEach<M, K>(this.element(), events, listener, options);\n  }\n\n  once<K extends string = ListenerKeys<GlobalEventHandlersEventMap & M>>(\n    event: K,\n    listener: Listener<M, K>,\n    options: ListenerOptions = {}\n  ): void {\n    once<M, K>(this.element(), event, listener, options);\n  }\n\n  query<T extends HTMLElement = HTMLElement>(selector: string): T | null {\n    return this.element().querySelector<T>(selector);\n  }\n\n  queryAll<T extends HTMLElement = HTMLElement>(\n    selector: string\n  ): NodeListOf<T> {\n    return this.element().querySelectorAll<T>(selector);\n  }\n\n  remove(): void {\n    this.element().remove();\n  }\n\n  removeClass(...classes: string[]): void {\n    removeClass(this.element(), ...classes);\n  }\n\n  toggleClass(...classes: string[]): void {\n    toggleClass(this.element(), ...classes);\n  }\n}\n\nexport default Element;\n", "import {\n  City as CityData,\n  City,\n  CityBuild,\n  CityGrowth,\n  PlayerResearch,\n  Yield,\n} from '../../types';\nimport {\n  knownGroupLookup,\n  knownGroups,\n  knownIcons,\n  reduceKnownYield,\n  reduceKnownYields,\n} from '../../lib/yieldMap';\nimport { assetStore } from '../../AssetStore';\nimport { s } from '@dom111/element/src/Element';\n\nexport const buildTurns = (city: City) =>\n  turnsLeft(city.build, city.yields, 'Production');\n\nexport const growthTurns = (city: City) =>\n  turnsLeft(city.growth, city.yields, 'Food');\n\nexport const renderPopulation = (city: CityData): Node => {\n  const growth = city.growth,\n    mask = parseInt(city.name.replace(/[^a-z]/gi, ''), 36).toString(2),\n    state = new Array(growth.size).fill(1),\n    population = s('<div class=\"population\"></div>');\n\n  let [happiness, unhappiness] = reduceKnownYields(\n      city.yields,\n      'Happiness',\n      'Unhappiness'\n    ),\n    currentIndex = state.length - 1;\n\n  while (unhappiness > 0 && currentIndex > -1) {\n    state[currentIndex--] = 0;\n    unhappiness--;\n  }\n\n  currentIndex = 0;\n\n  while (happiness > 0 && currentIndex < state.length) {\n    if (state[currentIndex] === 0) {\n      state[currentIndex]++;\n      happiness--;\n    }\n\n    if (state[currentIndex] === 1) {\n      state[currentIndex++]++;\n      happiness--;\n    }\n\n    if (state[currentIndex] === 2) {\n      currentIndex++;\n    }\n  }\n\n  state.forEach((status, index) =>\n    assetStore\n      .getScaled(\n        `./assets/city/people_${['unhappy', 'content', 'happy'][status]}_${\n          ['f', 'm'][parseInt(mask[index % mask.length], 10)]\n        }.png`,\n        2\n      )\n      .then((image) =>\n        population.append(\n          s(\n            '<span class=\"citizen\"></span>',\n            s(`<img src=\"${image.toDataURL('image/png')}\">`)\n          )\n        )\n      )\n  );\n\n  return population;\n};\n\nexport const renderProgress = (\n  cityData: CityGrowth | CityBuild | PlayerResearch,\n  yields: Yield[],\n  yieldName: string\n) =>\n  `Progress ${cityData.progress.value} / ${cityData.cost.value} (${turnsText(\n    turnsLeft(cityData, yields, yieldName)\n  )})`;\n\nexport const turnsLeft = (\n  data: CityGrowth | CityBuild | PlayerResearch,\n  yields: Yield[],\n  yieldName: string\n) =>\n  Math.max(\n    1,\n    Math.ceil(\n      (data.cost.value - data.progress.value) /\n        reduceKnownYield(yields, yieldName)\n    )\n  );\n\nexport const turnsText = (turns: number) =>\n  turns + ' turn' + (turns === 1 ? '' : 's');\n\nexport const yieldData = (city: CityData, yieldName: string) =>\n  city.yields.reduce(\n    ([total, used, free], cityYield) => {\n      const isKnown = knownGroupLookup[yieldName]?.includes(cityYield._);\n\n      if (isKnown && cityYield.value > 0) {\n        total += cityYield.value;\n      }\n\n      if (isKnown && cityYield.value < 0) {\n        used += cityYield.value;\n      }\n\n      if (isKnown) {\n        free += cityYield.value;\n      }\n\n      return [total, used, free];\n    },\n    [0, 0, 0]\n  );\n\nexport const yieldImages = (cityYield: { _: string; value: number }): Node[] =>\n  new Array(Math.abs(cityYield.value)).fill(0).map(() => {\n    const icon = s('<span class=\"yield-icon\"></span>');\n\n    assetStore\n      .getScaled(`./assets/${knownIcons[knownGroups[cityYield._]]}`, 2)\n      .then((image) =>\n        icon.append(s(`<img src=\"${image.toDataURL('image/png')}\">`))\n      );\n\n    return icon;\n  });\n", "import { s } from '@dom111/element';\n\nexport let preloadContainer: HTMLElement;\n\nexport const setPreloadContainer = (preloadContainerElement: HTMLElement) =>\n  (preloadContainer = preloadContainerElement);\n\nexport const getPreloadedImage = (path: string): CanvasImageSource => {\n  const image = preloadContainer.querySelector(`[data-path$=\"${path}.png\"]`);\n\n  if (image === null) {\n    console.error(`Missing image: ${path}.`);\n\n    return s<HTMLCanvasElement>('<canvas></canvas>');\n  }\n\n  return image as HTMLImageElement;\n};\n\nexport default getPreloadedImage;\n", "import { s } from '@dom111/element';\n\nexport const replaceColours = (\n  image: CanvasImageSource,\n  source: string[],\n  replacement: string[]\n) => {\n  const canvas = s<HTMLCanvasElement>('<canvas></canvas>'),\n    context = canvas.getContext('2d')!;\n\n  canvas.width = image.width as number;\n  canvas.height = image.height as number;\n\n  context.drawImage(image, 0, 0, image.width as number, image.height as number);\n\n  const imageData = context.getImageData(0, 0, canvas.width, canvas.height),\n    getColor = (input: string | number[]) => {\n      let match: RegExpMatchArray | null = null,\n        color: { r: number; g: number; b: number; a: number } = {\n          r: 0,\n          g: 0,\n          b: 0,\n          a: 0,\n        };\n\n      if (typeof input === 'string') {\n        if (\n          (match = input.match(\n            /^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1], 16),\n            g: parseInt(match[2], 16),\n            b: parseInt(match[3], 16),\n            a: 1,\n          };\n        } else if (\n          (match = input.match(\n            /^#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1] + match[1], 16),\n            g: parseInt(match[2] + match[2], 16),\n            b: parseInt(match[3] + match[3], 16),\n            a: 1,\n          };\n        } else if (\n          (match = input.match(\n            /^rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)/\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1]),\n            g: parseInt(match[2]),\n            b: parseInt(match[3]),\n            a: 1,\n          };\n        } else if (\n          (match = input.match(\n            /^rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+|\\d+\\.|\\.\\d+|\\d+\\.\\d+)\\s*\\)\\s*$/\n          )) !== null\n        ) {\n          color = {\n            r: parseInt(match[1]),\n            g: parseInt(match[2]),\n            b: parseInt(match[3]),\n            a: parseFloat(match[4] ?? 1),\n          };\n        }\n      } else if ('length' in input) {\n        color = {\n          r: input[0] || 0,\n          g: input[1] || 0,\n          b: input[2] || 0,\n          a: input[3] || 1,\n        };\n      }\n\n      return color;\n    };\n\n  let sourceColors = source.map(getColor),\n    replaceColors = replacement.map(getColor);\n\n  for (let i = 0; i < imageData.data.length; i += 4) {\n    sourceColors.forEach((color, n) => {\n      if (\n        imageData.data[i] === color.r &&\n        imageData.data[i + 1] === color.g &&\n        imageData.data[i + 2] === color.b &&\n        imageData.data[i + 3] === color.a * 255\n      ) {\n        imageData.data[i] = (replaceColors[n] || replaceColors[0]).r;\n        imageData.data[i + 1] = (replaceColors[n] || replaceColors[0]).g;\n        imageData.data[i + 2] = (replaceColors[n] || replaceColors[0]).b;\n        imageData.data[i + 3] = Math.trunc(\n          (replaceColors[n] || replaceColors[0]).a * 255\n        );\n      }\n    });\n  }\n\n  context.putImageData(imageData, 0, 0);\n\n  return canvas;\n};\n\nexport default replaceColours;\n", "import { NeighbourDirection, Tile } from '../types';\nimport {\n  getPreloadedImage,\n  setPreloadContainer,\n} from '../lib/getPreloadedImage';\nimport World from './World';\nimport replaceColours from '../lib/replaceColours';\nimport { s } from '@dom111/element';\n\nexport interface IMap {\n  context(): CanvasRenderingContext2D;\n  render(...args: any[]): void;\n  scale(): number;\n  tileSize(): number;\n  world(): World;\n}\n\ninterface DrawImageOptions {\n  augment?: (image: CanvasImageSource) => CanvasImageSource;\n  offsetX?: number;\n  offsetY?: number;\n}\n\nexport class Map implements IMap {\n  #canvas: HTMLCanvasElement;\n  #context: CanvasRenderingContext2D;\n  #visible: boolean = true;\n  #scale: number;\n  #tileSize: number;\n  #world: World;\n\n  constructor(\n    world: World,\n    scale: number = 2,\n    tileSize: number = 16,\n    canvas: HTMLCanvasElement = s<HTMLCanvasElement>('<canvas></canvas>')\n  ) {\n    this.#canvas = canvas;\n    this.#world = world;\n    this.#tileSize = tileSize;\n    this.#scale = scale;\n\n    this.setCanvasSize();\n\n    this.#context = this.#canvas.getContext('2d') as CanvasRenderingContext2D;\n    setPreloadContainer(document.querySelector('#preload')!);\n  }\n\n  canvas(): HTMLCanvasElement {\n    return this.#canvas;\n  }\n\n  clear(): void {\n    this.context().clearRect(0, 0, this.canvas().width, this.canvas().height);\n  }\n\n  context(): CanvasRenderingContext2D {\n    return this.#context;\n  }\n\n  render(tiles: Tile[] = this.world().tiles()): void {\n    this.clear();\n\n    tiles.forEach(({ x, y }: Tile) => this.renderTile(this.world().get(x, y)));\n  }\n\n  renderTile({ x, y }: Tile): void {\n    const size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    this.context().clearRect(offsetX, offsetY, size, size);\n  }\n\n  scale(): number {\n    return this.#scale;\n  }\n\n  tileSize(): number {\n    return this.#tileSize * this.#scale;\n  }\n\n  update(tilesToUpdate: Tile[]): void {\n    tilesToUpdate.forEach(({ x, y }: Tile) =>\n      this.renderTile(this.world().get(x, y))\n    );\n  }\n\n  world(): World {\n    return this.#world;\n  }\n\n  protected drawImage(\n    path: string,\n    x: number,\n    y: number,\n    options: DrawImageOptions = {}\n  ): void {\n    const size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      image = this.getPreloadedImage(path);\n\n    this.putImage(\n      options.augment ? options.augment(image) : image,\n      offsetX + (options.offsetX ?? 0),\n      offsetY + (options.offsetY ?? 0)\n    );\n  }\n\n  protected filterNeighbours(\n    tile: Tile,\n    filter: (tile: Tile) => boolean,\n    directions: NeighbourDirection[] = ['n', 'e', 's', 'w']\n  ): NeighbourDirection[] {\n    return directions.filter((direction: NeighbourDirection): boolean =>\n      filter(this.#world.getNeighbour(tile, direction))\n    );\n  }\n\n  protected getPreloadedImage(path: string): CanvasImageSource {\n    return getPreloadedImage(path);\n  }\n\n  protected putImage(\n    image: CanvasImageSource,\n    offsetX: number,\n    offsetY: number\n  ): void {\n    this.#context.imageSmoothingEnabled = false;\n\n    this.#context.drawImage(\n      image,\n      offsetX,\n      offsetY,\n      (image.width as number) * this.#scale,\n      (image.height as number) * this.#scale\n    );\n  }\n\n  protected replaceColours(\n    image: CanvasImageSource,\n    source: string[],\n    replacement: string[]\n  ) {\n    return replaceColours(image, source, replacement);\n  }\n\n  protected setCanvasSize(): void {\n    this.#canvas.height = this.#world.height() * this.tileSize();\n    this.#canvas.width = this.#world.width() * this.tileSize();\n    // this.#canvas.setAttribute('height', this.#canvas.height.toString());\n    // this.#canvas.setAttribute('width',this.#canvas.width.toString());\n  }\n\n  isVisible(): boolean {\n    return this.#visible;\n  }\n\n  setVisible(visible: boolean): void {\n    this.#visible = visible;\n  }\n}\n\nexport default Map;\n", "import { Tile, Unit } from '../../types';\nimport { Map, IMap } from '../Map';\n\nexport class Cities extends Map {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    if (tile.city) {\n      const city = tile.city,\n        player = city.player,\n        civilization = player.civilization,\n        [colors] = civilization.attributes.filter(\n          (attribute) => attribute.name === 'colors'\n        );\n\n      if (tile.units.length > 0) {\n        this.context().fillStyle = '#000';\n        this.context().fillRect(offsetX, offsetY, size, size);\n      }\n\n      this.context().fillStyle = colors.value[0];\n      this.context().fillRect(\n        offsetX + this.scale(),\n        offsetY + this.scale(),\n        size - this.scale() * 2,\n        size - this.scale() * 2\n      );\n\n      this.drawImage(`map/city`, x, y, {\n        augment: (image) =>\n          this.replaceColours(\n            image,\n            // To come from theme manifest\n            ['#000'],\n            [colors.value[1]]\n          ),\n        offsetX: this.scale(),\n        offsetY: this.scale(),\n      });\n    }\n  }\n}\n\nexport default Cities;\n", "import {\n  NotificationWindow,\n  NotificationWindowOptions,\n} from './NotificationWindow';\nimport { h } from '../lib/html';\nimport { s } from '@dom111/element';\n\nexport interface ConfirmationWindowOptions extends NotificationWindowOptions {\n  okLabel?: string;\n  cancelLabel?: string;\n}\n\nexport class ConfirmationWindow extends NotificationWindow {\n  constructor(\n    title: string,\n    details: string,\n    onOK: () => void,\n    options: ConfirmationWindowOptions = {}\n  ) {\n    const confirmationButton = h(\n      s(`<button>${options.okLabel ?? 'OK'}</button>`),\n      {\n        click: () => {\n          onOK();\n\n          this.close();\n        },\n        keydown: (event) => {\n          if (event.key === 'Enter' || event.key === ' ') {\n            event.preventDefault();\n            event.stopPropagation();\n\n            onOK();\n\n            this.close();\n          }\n        },\n      }\n    );\n\n    super(\n      title,\n      s(\n        `<div class=\"content\"><p>${details}</p></div>`,\n        s(\n          '<footer></footer>',\n          confirmationButton,\n          h(s(`<button>${options.cancelLabel ?? 'Cancel'}</button>`), {\n            click: () => this.close(),\n            keydown: (event) => {\n              if (event.key === 'Enter' || event.key === ' ') {\n                event.preventDefault();\n                event.stopPropagation();\n\n                this.close();\n              }\n            },\n          })\n        )\n      ),\n      {\n        ...options,\n        queue: false,\n      }\n    );\n\n    confirmationButton.focus();\n  }\n}\n\nexport default ConfirmationWindow;\n", "import { PlainObject } from './types';\nimport { ObjectMap } from './lib/reconstituteData';\n\nexport type dataUpdatedEvent = CustomEvent<{ data: PlainObject }>;\nexport type dataUpdatedHandler = (data: PlainObject) => void;\nexport type patchDataReceivedEvent = CustomEvent<{ value: ObjectMap }>;\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    dataupdated: dataUpdatedEvent;\n    patchdatareceived: patchDataReceivedEvent;\n  }\n}\n\nexport class DataObserver {\n  #handler: (event: patchDataReceivedEvent) => void;\n  #ids: string[] = [];\n\n  constructor(ids: string[], handler: dataUpdatedHandler) {\n    this.setIds(ids);\n\n    this.#handler = (event) => {\n      const { detail } = event,\n        objects = detail.value.objects;\n\n      if (!objects) {\n        return;\n      }\n\n      if (this.#ids.some((id) => id in objects)) {\n        document.addEventListener(\n          'dataupdated',\n          (event) => handler(event.detail.data),\n          {\n            once: true,\n          }\n        );\n      }\n    };\n\n    document.addEventListener('patchdatareceived', this.#handler);\n  }\n\n  dispose(): void {\n    document.removeEventListener('patchdatareceived', this.#handler);\n  }\n\n  setIds(ids: string[]): void {\n    this.#ids.splice(0, this.#ids.length, ...ids);\n  }\n}\n\nexport default DataObserver;\n", "import { NeighbourDirection, Tile } from '../../types';\nimport { Map, IMap } from '../Map';\n\nexport class TerrainAbstract extends Map implements IMap {\n  update(tilesToUpdate: Tile[]): void {\n    // we need to redraw the surrounding tiles to prevent the hidden terrain showing up incorrectly.\n    const extendedTilesToUpdate = [...tilesToUpdate];\n\n    tilesToUpdate.forEach((tile) => {\n      (\n        ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw'] as NeighbourDirection[]\n      ).forEach((direction) => {\n        const target = this.world().getNeighbour(tile, direction);\n\n        if (extendedTilesToUpdate.includes(target)) {\n          return;\n        }\n\n        extendedTilesToUpdate.push(target);\n      });\n    });\n\n    return super.update(extendedTilesToUpdate);\n  }\n}\n\nexport default TerrainAbstract;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Feature extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    if (tile.terrain.features.length) {\n      tile.terrain.features.forEach((feature) =>\n        feature._ === 'Shield'\n          ? this.drawImage(`terrain/${feature._.toLowerCase()}`, x, y, {\n              offsetX: 4 * this.scale(),\n              offsetY: 4 * this.scale(),\n            })\n          : this.drawImage(`terrain/${feature._.toLowerCase()}`, x, y)\n      );\n    }\n  }\n}\n\nexport default Feature;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Fog extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    this.filterNeighbours(tile, (tile) => tile.terrain._ === 'Unknown').forEach(\n      (direction) => this.drawImage(`map/fog_${direction}`, x, y)\n    );\n  }\n}\n\nexport default Fog;\n", "import { EntityInstance, NeighbourDirection, Tile } from '../../types';\nimport TerrainAbstract from './TerrainAbstract';\n\ntype Improvement = 'Mine' | 'Pollution' | 'Railroad' | 'Road';\n\ntype ImprovementLookup = {\n  [key in Improvement]: boolean;\n};\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    const improvements = tile.improvements.reduce(\n      (\n        state: ImprovementLookup,\n        improvement: EntityInstance\n      ): ImprovementLookup => {\n        const improvementType = improvement._ as Improvement;\n\n        if (!(improvementType in state)) {\n          return state;\n        }\n\n        state[improvementType] = true;\n\n        return state;\n      },\n      {\n        Mine: false,\n        Road: false,\n        Railroad: false,\n        Pollution: false,\n      }\n    );\n\n    (['Mine', 'Pollution'] as (keyof ImprovementLookup)[]).forEach(\n      (improvementName: keyof ImprovementLookup) => {\n        if (improvements[improvementName]) {\n          this.drawImage(`improvements/${improvementName.toLowerCase()}`, x, y);\n        }\n      }\n    );\n\n    // Can't have Railroad without Road!\n    if (improvements.Road) {\n      const neighbouringRoad = this.filterNeighbours(\n          tile,\n          (adjoiningTile: Tile): boolean =>\n            adjoiningTile.improvements.some(\n              (improvement: EntityInstance): boolean => improvement._ === 'Road'\n            ),\n          ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw']\n        ),\n        neighbouringRailroad = this.filterNeighbours(\n          tile,\n          (adjoiningTile: Tile): boolean =>\n            !!adjoiningTile.city ||\n            adjoiningTile.improvements.some(\n              (improvement: EntityInstance): boolean =>\n                improvement._ === 'Railroad'\n            ),\n          ['n', 'ne', 'e', 'se', 's', 'sw', 'w', 'nw']\n        );\n\n      neighbouringRoad.forEach((direction: NeighbourDirection): void => {\n        if (\n          !improvements.Railroad ||\n          !neighbouringRailroad.includes(direction)\n        ) {\n          this.drawImage(`improvements/road_${direction}`, x, y);\n        }\n      });\n\n      if (improvements.Railroad) {\n        neighbouringRailroad.forEach((direction: NeighbourDirection): void =>\n          this.drawImage(`improvements/railroad_${direction}`, x, y)\n        );\n      }\n\n      if (neighbouringRoad.length === 0 && neighbouringRailroad.length === 0) {\n        const size = this.tileSize(),\n          offsetX = x * size,\n          offsetY = y * size,\n          center = Math.floor(this.tileSize() / 2) - this.scale();\n\n        this.context().fillStyle = improvements.Railroad ? '#000' : '#8c5828';\n        this.context().rect(\n          offsetX + center,\n          offsetY + center,\n          this.scale() * 2,\n          this.scale() * 2\n        );\n        this.context().fill();\n      }\n    }\n  }\n}\n\nexport default Terrain;\n", "import { EntityInstance, NeighbourDirection, Tile } from '../../types';\nimport TerrainAbstract from './TerrainAbstract';\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile,\n      hasIrrigation = tile.improvements.some(\n        (improvement: EntityInstance): boolean => improvement._ === 'Irrigation'\n      );\n\n    if (!hasIrrigation) {\n      return;\n    }\n\n    this.drawImage(`improvements/irrigation`, x, y);\n  }\n}\n\nexport default Terrain;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\nimport { s } from '@dom111/element';\n\nexport class Land extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    if (tile.isLand) {\n      this.drawImage('terrain/land', x, y);\n    } else if (tile.isWater) {\n      this.drawImage('terrain/ocean', x, y);\n\n      if (tile.isCoast) {\n        const sprite = this.getPreloadedImage(\n            'terrain/coast_sprite'\n          ) as HTMLImageElement,\n          // formula from: http://forums.civfanatics.com/showpost.php?p=13507808&postcount=40\n          // Build a bit mask of all 8 surrounding tiles, setting the bit if the tile is not an\n          // ocean tile. Starting with the tile to the left as the least significant bit and\n          // going clockwise\n          bitmask =\n            (this.world().getNeighbour(tile, 'w').isLand ? 1 : 0) |\n            (this.world().getNeighbour(tile, 'nw').isLand ? 2 : 0) |\n            (this.world().getNeighbour(tile, 'n').isLand ? 4 : 0) |\n            (this.world().getNeighbour(tile, 'ne').isLand ? 8 : 0) |\n            (this.world().getNeighbour(tile, 'e').isLand ? 16 : 0) |\n            (this.world().getNeighbour(tile, 'se').isLand ? 32 : 0) |\n            (this.world().getNeighbour(tile, 's').isLand ? 64 : 0) |\n            (this.world().getNeighbour(tile, 'sw').isLand ? 128 : 0);\n\n        if (bitmask > 0) {\n          // There are at least one surrounding tile that is not ocean, so we need to render\n          // coast. We divide the tile into four 8x8 subtiles and for each of these we want\n          // a 3 bit bitmask of the surrounding tiles. We do this by looking at the 3 least\n          // significant bits for the top left subtile and shift the mask to the right as we\n          // are going around the tile. This way we are \"rotating\" our bitmask. The result\n          // are our x offsets into ter257.pic\n          let topLeftSubtileOffset = bitmask & 7,\n            topRightSubtileOffset = (bitmask >> 2) & 7,\n            bottomRightSubtileOffset = (bitmask >> 4) & 7,\n            bottomLeftSubtileOffset =\n              ((bitmask >> 6) & 7) | ((bitmask & 1) << 2);\n\n          const image = s<HTMLCanvasElement>(\n              '<canvas height=\"16\" width=\"16\"></canvas>'\n            ),\n            imageContext = image.getContext('2d') as CanvasRenderingContext2D;\n\n          imageContext.drawImage(\n            sprite,\n            topLeftSubtileOffset << 4,\n            0,\n            8,\n            8,\n            0,\n            0,\n            8,\n            8\n          );\n          imageContext.drawImage(\n            sprite,\n            (topRightSubtileOffset << 4) + 8,\n            0,\n            8,\n            8,\n            8,\n            0,\n            8,\n            8\n          );\n          imageContext.drawImage(\n            sprite,\n            (bottomRightSubtileOffset << 4) + 8,\n            8,\n            8,\n            8,\n            8,\n            8,\n            8,\n            8\n          );\n          imageContext.drawImage(\n            sprite,\n            bottomLeftSubtileOffset << 4,\n            8,\n            8,\n            8,\n            0,\n            8,\n            8,\n            8\n          );\n\n          this.putImage(image, offsetX, offsetY);\n        }\n\n        this.filterNeighbours(\n          tile,\n          (tile: Tile): boolean => tile.terrain._ === 'River'\n        ).forEach((direction) =>\n          this.drawImage(`terrain/river_mouth_${direction}`, x, y)\n        );\n      }\n    }\n  }\n}\n\nexport default Land;\n", "import { Coordinate, Tile, Unit } from '../types';\nimport { EventEmitter } from '@dom111/typed-event-emitter';\nimport Map from './Map';\nimport Transport from '../../Engine/Transport';\nimport World from './World';\nimport { s } from '@dom111/element';\n\nexport interface IPortal {\n  build(updatedTiles: Tile[]): void;\n  canvas(): HTMLCanvasElement;\n  center(): Coordinate;\n  getLayer(LayerType: typeof Map): Map | null;\n  getLayers(LayerType: typeof Map): Map[];\n  isVisible(x: number, y: number): boolean;\n  playerId(): string | null;\n  render(): void;\n  scale(): number;\n  setCenter(x: number, y: number): void;\n  tileSize(): number;\n  transport(): Transport;\n  visibleBounds(): [number, number, number, number];\n  visibleRange(): [Coordinate, Coordinate];\n  world(): World;\n}\n\nexport interface PortalSettings {\n  playerId: string | null;\n  scale: number;\n  tileSize: number;\n}\n\ntype PortalOptions = {\n  [K in keyof PortalSettings]?: PortalSettings[K];\n};\n\nconst defaultPortalOptions: PortalSettings = {\n  playerId: null,\n  scale: 2,\n  tileSize: 16,\n};\n\nexport class Portal\n  extends EventEmitter<{\n    ['activate-unit']: [Unit];\n    ['focus-changed']: [number, number];\n  }>\n  implements IPortal\n{\n  #canvas: HTMLCanvasElement;\n  #center: Coordinate = { x: 0, y: 0 };\n  #context: CanvasRenderingContext2D;\n  #layers: Map[] = [];\n  #playerId: string | null = null;\n  #scale: number;\n  #tileSize: number;\n  #transport: Transport;\n  #world: World;\n\n  constructor(\n    world: World,\n    transport: Transport,\n    canvas: HTMLCanvasElement = s<HTMLCanvasElement>('<canvas></canvas>'),\n    options: PortalOptions = {\n      playerId: null,\n      scale: 2,\n    },\n    ...layers: typeof Map[]\n  ) {\n    const settings: PortalSettings = {\n      ...defaultPortalOptions,\n      ...options,\n    };\n\n    super();\n\n    this.#world = world;\n    this.#canvas = canvas;\n    this.#playerId = settings.playerId;\n    this.#tileSize = settings.tileSize;\n    this.#scale = settings.scale;\n    this.#transport = transport;\n\n    layers.forEach((MapType) =>\n      this.#layers.push(new MapType(this.#world, this.scale(), this.#tileSize))\n    );\n\n    this.#context = canvas.getContext('2d') as CanvasRenderingContext2D;\n\n    this.bindEvents();\n  }\n\n  protected bindEvents(): void {}\n\n  build(updatedTiles: Tile[]): void {\n    this.#layers.forEach((layer: Map) => layer.update(updatedTiles));\n  }\n\n  canvas(): HTMLCanvasElement {\n    return this.#canvas;\n  }\n\n  center(): Coordinate {\n    return this.#center;\n  }\n\n  getLayer(LayerType: typeof Map): Map | null {\n    return this.getLayers(LayerType).shift() ?? null;\n  }\n\n  getLayers(LayerType: typeof Map): Map[] {\n    return this.#layers.filter((layer) => layer instanceof LayerType);\n  }\n\n  isVisible(x: number, y: number): boolean {\n    const visibleHorizontal = Math.floor(this.#canvas.width / this.tileSize()),\n      visibleVertical = Math.floor(this.#canvas.height / this.tileSize());\n\n    if (\n      visibleHorizontal >= this.#world.width() &&\n      visibleVertical >= this.#world.height()\n    ) {\n      return true;\n    }\n\n    const [xLowerBound, xUpperBound, yLowerBound, yUpperBound] =\n      this.visibleBounds();\n\n    // I _think_ this logic is correct now...\n    return (\n      (visibleHorizontal >= this.#world.width() ||\n        (xLowerBound > xUpperBound\n          ? x < xUpperBound || x > xLowerBound\n          : x < xUpperBound && x > xLowerBound)) &&\n      (visibleVertical >= this.#world.height() ||\n        (yLowerBound > yUpperBound\n          ? y < yUpperBound || y > yLowerBound\n          : y < yUpperBound && y > yLowerBound))\n    );\n  }\n\n  playerId(): string | null {\n    return this.#playerId;\n  }\n\n  render(): void {\n    const tileSize = this.tileSize(),\n      layerWidth = this.#world.width() * tileSize,\n      centerX = this.#center.x * tileSize + Math.trunc(tileSize / this.scale()),\n      portalCenterX = Math.trunc(this.#canvas.width / 2),\n      layerHeight = this.#world.height() * tileSize,\n      centerY = this.#center.y * tileSize + Math.trunc(tileSize / this.scale()),\n      portalCenterY = Math.trunc(this.#canvas.height / 2);\n\n    let startX = portalCenterX - centerX,\n      endX = portalCenterX + layerWidth,\n      startY = portalCenterY - centerY,\n      endY = portalCenterY + layerHeight;\n\n    while (startX > 0) {\n      startX -= layerWidth;\n    }\n\n    while (startY > 0) {\n      startY -= layerHeight;\n    }\n\n    while (endX < this.#canvas.width) {\n      endX += layerWidth;\n    }\n\n    while (endY < this.#canvas.height) {\n      endY += layerHeight;\n    }\n\n    this.#context.fillStyle = '#000';\n    this.#context.fillRect(\n      0,\n      0,\n      Math.max(this.#world.width() * tileSize, this.#canvas.width),\n      Math.max(this.#world.height() * tileSize, this.#canvas.height)\n    );\n\n    for (let x = startX; x < endX; x += layerWidth) {\n      for (let y = startY; y < endY; y += layerHeight) {\n        this.#layers.forEach((layer) => {\n          if (!layer.isVisible()) {\n            return;\n          }\n\n          const canvas = layer.canvas();\n\n          this.#context.drawImage(canvas, x, y, canvas.width, canvas.height);\n        });\n      }\n    }\n  }\n\n  scale(): number {\n    return this.#scale;\n  }\n\n  setCenter(x: number, y: number): void {\n    this.#center.x = x;\n    this.#center.y = y;\n\n    this.render();\n\n    this.emit('focus-changed', x, y);\n  }\n\n  tileSize(): number {\n    return this.#tileSize * this.#scale;\n  }\n\n  transport(): Transport {\n    return this.#transport;\n  }\n\n  visibleBounds(): [number, number, number, number] {\n    const [\n      { x: xLowerBound, y: yLowerBound },\n      { x: xUpperBound, y: yUpperBound },\n    ] = this.visibleRange();\n\n    return [xLowerBound, xUpperBound, yLowerBound, yUpperBound];\n  }\n\n  visibleRange(): [Coordinate, Coordinate] {\n    const tileRangeX = Math.floor(\n        Math.floor(this.#canvas.width / this.tileSize()) / 2\n      ),\n      tileRangeY = Math.floor(\n        Math.floor(this.#canvas.height / this.tileSize()) / 2\n      );\n\n    return [\n      {\n        x:\n          (this.#center.x - tileRangeX + this.#world.width()) %\n          this.#world.width(),\n        y:\n          (this.#center.y - tileRangeY + this.#world.height()) %\n          this.#world.height(),\n      },\n      {\n        x: (this.#center.x + tileRangeX) % this.#world.width(),\n        y: (this.#center.y + tileRangeY) % this.#world.height(),\n      },\n    ];\n  }\n\n  rawVisibleRange(): [Coordinate, Coordinate] {\n    const tileRangeX = Math.floor(\n        Math.floor(this.#canvas.width / this.tileSize()) / 2\n      ),\n      tileRangeY = Math.floor(\n        Math.floor(this.#canvas.height / this.tileSize()) / 2\n      );\n\n    return [\n      {\n        x: this.#center.x - tileRangeX,\n        y: this.#center.y - tileRangeY,\n      },\n      {\n        x: this.#center.x + tileRangeX,\n        y: this.#center.y + tileRangeY,\n      },\n    ];\n  }\n\n  world(): World {\n    return this.#world;\n  }\n}\n\nexport default Portal;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    const adjoining = this.filterNeighbours(\n      tile,\n      (adjoiningTile: Tile): boolean =>\n        (tile.terrain._ === 'River' && adjoiningTile.isWater) ||\n        tile.terrain._ === adjoiningTile.terrain._\n    ).join('');\n\n    // Ocean is covered with the land/ocean stuff above and if we re-do here, we lose the coastline\n    if (tile.terrain._ !== 'Ocean') {\n      if (adjoining) {\n        this.drawImage(\n          `terrain/${tile.terrain._.toLowerCase()}_${adjoining}`,\n          x,\n          y\n        );\n      } else {\n        this.drawImage(`terrain/${tile.terrain._.toLowerCase()}`, x, y);\n      }\n    }\n  }\n}\n\nexport default Terrain;\n", "import { Element, s } from '@dom111/element';\nimport { Unit as UnitData } from '../types';\nimport renderUnit from '../lib/renderUnit';\n\nexport class Unit extends Element {\n  #scale: number = 2;\n\n  constructor(unit: UnitData, scale: number = 2) {\n    super(s<HTMLCanvasElement>('<canvas width=\"32\" height=\"32\"></canvas>'));\n\n    this.#scale = scale;\n\n    this.build(unit);\n  }\n\n  build(unit: UnitData) {\n    const unitCanvas = renderUnit(unit),\n      context = this.element().getContext('2d')!,\n      sizeX = this.size(unitCanvas.width as number),\n      sizeY = this.size(unitCanvas.height as number),\n      offsetX = Math.floor((this.size(16) - sizeX) / 2),\n      offsetY = Math.floor((this.size(16) - sizeY) / 2);\n\n    context.imageSmoothingEnabled = false;\n\n    context.drawImage(unitCanvas, offsetX, offsetY, sizeX, sizeY);\n  }\n\n  element(): HTMLCanvasElement {\n    return super.element() as HTMLCanvasElement;\n  }\n\n  size(size: number): number {\n    return size * this.#scale;\n  }\n}\n\nexport default Unit;\n", "import { Unit } from '../types';\nimport getPreloadedImage from './getPreloadedImage';\nimport replaceColours from './replaceColours';\n\nconst busyLookup: { [key: string]: string } = {\n  BuildingIrrigation: 'I',\n  BuildingMine: 'M',\n  BuildingRoad: 'R',\n  BuildingRailroad: 'RR',\n  // 'ClearingForest': 'CF',\n  // 'ClearingJungle': 'CJ',\n  // 'ClearingSwamp': 'CS',\n  // 'Fortifying': 'F',\n  // 'Sleeping': 'S',\n  // 'PlantingForest': 'PF',\n};\n\nexport const renderUnit = (\n  unit: Unit,\n  // scale: number = 2,\n  tileSize: number = 16\n): CanvasImageSource => {\n  const player = unit.player,\n    civilization = player.civilization,\n    [colors] = civilization.attributes.filter(\n      (attribute) => attribute.name === 'colors'\n    ),\n    unitCanvas = replaceColours(\n      getPreloadedImage(`units/${unit._.toLowerCase()}`),\n      // To come from theme manifest\n      ['#60E064', '#2C7800'],\n      colors.value\n    ),\n    context = unitCanvas.getContext('2d')!;\n\n  context.imageSmoothingEnabled = false;\n\n  if (unit.improvements?.some((improvement) => improvement._ === 'Fortified')) {\n    context.drawImage(getPreloadedImage('map/fortify'), 0, 0);\n  }\n\n  if (unit.busy) {\n    // if (unit.busy._ === 'Sleeping') {} // TODO: fade the unit like in Civ 1\n    const sizeOffsetX = tileSize / 2,\n      sizeOffsetY = tileSize * 0.75,\n      identifier =\n        busyLookup[unit.busy._] ?? unit.busy._.replace(/[a-z]+/g, '');\n\n    context.font = `bold 8px sans-serif`;\n    context.fillStyle = 'black';\n    context.textAlign = 'center';\n    context.fillText(identifier, sizeOffsetX, sizeOffsetY);\n    context.fillStyle = 'white';\n    context.fillText(identifier, sizeOffsetX, sizeOffsetY);\n  }\n\n  return unitCanvas;\n};\n\nexport default renderUnit;\n", "import SelectionWindow from './SelectionWindow';\nimport Transport from '../../Engine/Transport';\nimport { Unit } from '../types';\n\nexport class UnitSelectionWindow extends SelectionWindow {\n  constructor(\n    units: Unit[],\n    transport: Transport,\n    onComplete: (unit: Unit) => void = () => {}\n  ) {\n    super(\n      // TODO: i18n\n      'Activate unit',\n      units.map((unit: Unit) => ({\n        label:\n          unit._ +\n          ' [' +\n          (unit.city?.name ?? 'NONE') +\n          ']' +\n          (unit.busy ? ` (${unit.busy!._})` : ''),\n        value: unit.id,\n      })),\n      (selection: string) => {\n        const [unit] = units.filter((tileUnit) => tileUnit.id === selection);\n\n        if (!unit) {\n          return;\n        }\n\n        if (!unit.active) {\n          transport.send('action', {\n            name: 'InactiveUnit',\n            id: selection,\n          });\n\n          return;\n        }\n\n        onComplete(unit);\n      },\n      null\n    );\n  }\n}\n\nexport default UnitSelectionWindow;\n", "import { NeighbourDirection, Tile, World as WorldData } from '../types';\n\nexport class World {\n  #unknown = (x: number, y: number): Tile => ({\n    _: 'Tile',\n    id: `Tile-${x}--${y}`,\n    city: null,\n    goodyHut: null,\n    improvements: [],\n    isCoast: false,\n    isLand: false,\n    isWater: false,\n    terrain: {\n      _: 'Unknown',\n      id: `UnknownTerrain-${x}--${y}`,\n      features: [],\n    },\n    units: [],\n    x,\n    y,\n    yields: [],\n  });\n  #lookupCache: { [key: string]: number } = {};\n  #tiles: Tile[];\n  #height: number;\n  #width: number;\n\n  constructor(world: WorldData) {\n    this.#height = world.height;\n    this.#width = world.width;\n    this.#tiles = world.tiles || [];\n  }\n\n  get(x: number, y: number): Tile {\n    while (x < 0) {\n      x += this.#width;\n    }\n\n    while (y < 0) {\n      y += this.#height;\n    }\n\n    while (x >= this.#width) {\n      x -= this.#width;\n    }\n\n    while (y >= this.#height) {\n      y -= this.#height;\n    }\n\n    const key = [x, y].toString();\n\n    if (!(key in this.#lookupCache)) {\n      const index = this.#tiles.findIndex(\n        (tile) => tile.x === x && tile.y === y\n      );\n\n      if (index === -1) {\n        return this.#unknown(x, y);\n      }\n\n      this.#lookupCache[key] = index;\n    }\n\n    return this.#tiles[this.#lookupCache[key]];\n  }\n\n  getNeighbour(tile: Tile, direction: NeighbourDirection): Tile {\n    if (direction === 'n') {\n      return this.get(tile.x, tile.y - 1);\n    }\n\n    if (direction === 'ne') {\n      return this.get(tile.x + 1, tile.y - 1);\n    }\n\n    if (direction === 'e') {\n      return this.get(tile.x + 1, tile.y);\n    }\n\n    if (direction === 'se') {\n      return this.get(tile.x + 1, tile.y + 1);\n    }\n\n    if (direction === 's') {\n      return this.get(tile.x, tile.y + 1);\n    }\n\n    if (direction === 'sw') {\n      return this.get(tile.x - 1, tile.y + 1);\n    }\n\n    if (direction === 'w') {\n      return this.get(tile.x - 1, tile.y);\n    }\n\n    if (direction === 'nw') {\n      return this.get(tile.x - 1, tile.y - 1);\n    }\n\n    throw new TypeError('Invalid direction.');\n  }\n\n  height(): number {\n    return this.#height;\n  }\n\n  tiles(): Tile[] {\n    return this.#tiles;\n  }\n\n  width(): number {\n    return this.#width;\n  }\n\n  setTiles(tiles: Tile[]): void {\n    this.#tiles = tiles;\n  }\n}\n\nexport default World;\n", "import Map from '../Map';\nimport { Tile } from '../../types';\n\nexport class Yields extends Map {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      total = tile.yields.reduce(\n        (total, tileYield) => total + tileYield.value,\n        0\n      ),\n      // TODO: use a more effective sort than this, this only works by luck (Food -> Production -> Trade)\n      yields = tile.yields.sort(\n        (a, b) => a._.charCodeAt(0) - b._.charCodeAt(0)\n      );\n\n    let i = 0;\n\n    if (total < 5) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 2, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 2, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            ...offsets[i++]\n          );\n        }\n      });\n\n      return;\n    }\n\n    if (total < 7) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 3, offsetY],\n        [offsetX + (size / 3) * 2, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 3, offsetY + size / 2],\n        [offsetX + (size / 3) * 2, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            offsets[i][0],\n            offsets[i++][1]\n          );\n        }\n      });\n\n      return;\n    }\n\n    if (total < 9) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 4, offsetY],\n        [offsetX + (size / 4) * 2, offsetY],\n        [offsetX + (size / 4) * 3, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 4, offsetY + size / 2],\n        [offsetX + (size / 4) * 2, offsetY + size / 2],\n        [offsetX + (size / 4) * 3, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            ...offsets[i++]\n          );\n        }\n      });\n\n      return;\n    }\n\n    if (total < 11) {\n      const offsets: [number, number][] = [\n        [offsetX, offsetY],\n        [offsetX + size / 5, offsetY],\n        [offsetX + (size / 5) * 2, offsetY],\n        [offsetX + (size / 5) * 3, offsetY],\n        [offsetX + (size / 5) * 4, offsetY],\n        [offsetX, offsetY + size / 2],\n        [offsetX + size / 5, offsetY + size / 2],\n        [offsetX + (size / 5) * 2, offsetY + size / 2],\n        [offsetX + (size / 5) * 3, offsetY + size / 2],\n        [offsetX + (size / 5) * 4, offsetY + size / 2],\n      ];\n\n      yields.forEach((tileYield) => {\n        for (let n = 0; n < tileYield.value; n++) {\n          this.putImage(\n            this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n            ...offsets[i++]\n          );\n        }\n      });\n\n      return;\n    }\n\n    const offsets: [number, number][] = [\n      [offsetX, offsetY],\n      [offsetX + size / 6, offsetY],\n      [offsetX + (size / 6) * 2, offsetY],\n      [offsetX + (size / 6) * 3, offsetY],\n      [offsetX + (size / 6) * 4, offsetY],\n      [offsetX + (size / 6) * 5, offsetY],\n      [offsetX, offsetY + size / 2],\n      [offsetX + size / 6, offsetY + size / 2],\n      [offsetX + (size / 6) * 2, offsetY + size / 2],\n      [offsetX + (size / 6) * 3, offsetY + size / 2],\n      [offsetX + (size / 6) * 4, offsetY + size / 2],\n      [offsetX + (size / 6) * 5, offsetY + size / 2],\n    ];\n\n    yields.forEach((tileYield) => {\n      for (let n = 0; n < tileYield.value; n++) {\n        this.putImage(\n          this.getPreloadedImage(`city/${tileYield._.toLowerCase()}`),\n          ...offsets[i++]\n        );\n      }\n    });\n  }\n}\nexport default Yields;\n", "import {\n  City as CityData,\n  CityImprovementMaintenanceGold,\n  PlainObject,\n  Unit as UnitData,\n  Yield,\n} from '../types';\nimport { knownGroupLookup, knownGroups } from '../lib/yieldMap';\nimport {\n  renderPopulation,\n  renderProgress,\n  yieldImages,\n} from './lib/cityYields';\nimport Cities from './Map/Cities';\nimport CityBuildSelectionWindow from './CityBuildSelectionWindow';\nimport ConfirmationWindow from './ConfirmationWindow';\nimport DataObserver from '../DataObserver';\nimport Feature from './Map/Feature';\nimport Fog from './Map/Fog';\nimport Improvements from './Map/Improvements';\nimport Irrigation from './Map/Irrigation';\nimport Land from './Map/Land';\nimport Portal from './Portal';\nimport Terrain from './Map/Terrain';\nimport Transport from '../../Engine/Transport';\nimport Unit from './Unit';\nimport UnitSelectionWindow from './UnitSelectionWindow';\nimport Window from './Window';\nimport World from './World';\nimport Yields from './Map/Yields';\nimport { h } from '../lib/html';\nimport { s } from '@dom111/element';\nimport { SupportedUnit } from './SupportedUnit';\n\nconst reduceYield = (type: string, cityYields: Yield[]): [number, number] =>\n    cityYields\n      .filter((cityYield) => knownGroupLookup[type].includes(cityYield._))\n      .reduce(\n        ([used, free], cityYield) => [\n          used + (cityYield.value < 0 ? -cityYield.value : 0),\n          free + cityYield.value,\n        ],\n        [0, 0]\n      ),\n  renderYields = (city: CityData): Node => {\n    return s(\n      '<div class=\"yields-detail\"></div>',\n      ...[\n        ['Food'],\n        ['Production'],\n        ['Trade'],\n        ['Luxuries', 'Gold', 'Research'],\n      ].map((cityYieldNames) =>\n        s(\n          `<div class=\"yields\" data-yields=\"${cityYieldNames.join(\n            ' '\n          )}\"></div>`,\n          ...cityYieldNames.map((cityYieldName) =>\n            s(\n              `<span class=\"yield\" data-yield=\"${cityYieldName}\"></span>`,\n              ...reduceYield(cityYieldName, city.yields).map((n, i) =>\n                s(\n                  `<span class=\"${['used', 'free'][i]}\"></span>`,\n                  ...yieldImages({\n                    _: cityYieldName,\n                    value: n,\n                  })\n                )\n              )\n            )\n          )\n        )\n      ),\n      // Other, unknown yields\n      ...Object.entries(\n        city.yields\n          .filter(\n            (cityYield) => !Object.keys(knownGroups).includes(cityYield._)\n          )\n          .reduce((yieldObject, cityYield) => {\n            if (!(cityYield._ in yieldObject)) {\n              yieldObject[cityYield._] = 0;\n            }\n\n            yieldObject[cityYield._] += cityYield.value;\n\n            return yieldObject;\n          }, {} as PlainObject)\n      ).map(([label, value]) =>\n        s(`<div><div>${label}</div><div>${value}</div></div>`)\n      )\n    );\n  },\n  resizeYields = (element: HTMLElement) => {\n    const yieldWrappers = element.querySelectorAll('.yields-detail .yield')!;\n\n    Array.from(yieldWrappers).forEach((container) => {\n      const [used, free] = Array.from(container.children);\n\n      while (used.scrollWidth + free.scrollWidth > container.clientWidth) {\n        const currentMaxWidth = parseInt(\n          container.getAttribute('data-max-width') || '14',\n          10\n        );\n\n        if (currentMaxWidth === 0) {\n          break;\n        }\n\n        container.setAttribute(\n          'data-max-width',\n          (currentMaxWidth - 1).toString()\n        );\n      }\n    });\n  },\n  renderMap = (portal: Portal, city: CityData, transport: Transport): Node => {\n    const portalCanvas = s<HTMLCanvasElement>('<canvas></canvas>'),\n      cityPortal = new Portal(\n        new World(city.player.world),\n        transport,\n        portalCanvas,\n        {\n          playerId: city.player.id,\n          scale: portal.scale(),\n          tileSize: portal.tileSize() / portal.scale(),\n        },\n        Land,\n        Irrigation,\n        Terrain,\n        Improvements,\n        Feature,\n        Fog,\n        Cities,\n        Yields\n      );\n\n    portalCanvas.height = portal.tileSize() * 5;\n    portalCanvas.width = portal.tileSize() * 5;\n\n    cityPortal.setCenter(city.tile.x, city.tile.y);\n    cityPortal.build(city.tiles);\n\n    const yieldMap = cityPortal.getLayer(Yields) as Yields;\n    yieldMap.render(city.tilesWorked);\n\n    cityPortal.render();\n\n    return h(s('<div class=\"city-map\"></div>', portalCanvas), {\n      click: () =>\n        transport.send('action', {\n          name: 'ReassignWorkers',\n          city: city.id,\n        }),\n    });\n  },\n  renderBuild = (\n    city: CityData,\n    chooseProduction: () => void,\n    completeProduction: () => void\n  ): HTMLElement =>\n    s(\n      `<div class=\"build\"><header>Building ${\n        city.build.building ? city.build.building.item._ : 'nothing'\n      }</header></div>`,\n      h(s(`<button>${city.build.building ? 'Change' : 'Choose'}</button>`), {\n        click() {\n          chooseProduction();\n        },\n      }),\n      h(s('<button>Buy</button>'), {\n        click() {\n          completeProduction();\n        },\n      }),\n      city.build.building\n        ? s(`<p>${renderProgress(city.build, city.yields, 'Production')}</p>`)\n        : ''\n    ),\n  renderGrowth = (city: CityData): Node =>\n    s(\n      `<div class=\"growth\"><header>Growth</header><p>Size ${city.growth.size.toString()}</p><p>${renderProgress(\n        city.growth,\n        city.yields,\n        'Food'\n      )}</p></div>`\n    ),\n  renderImprovements = (city: CityData): Node => {\n    return s(\n      `<div class=\"improvements\"></div>`,\n      s(\n        `<div></div>`,\n        ...city.improvements.map((improvement) =>\n          s(\n            `<div>${improvement._}</div>`,\n            ...city.yields\n              .filter(\n                (cityYield): cityYield is CityImprovementMaintenanceGold =>\n                  cityYield._ === 'CityImprovementMaintenanceGold'\n              )\n              .filter(\n                (cityYield) => cityYield.cityImprovement.id === improvement.id\n              )\n              .flatMap((cityYield) => yieldImages(cityYield))\n          )\n        )\n      )\n    );\n  },\n  renderGarrisonedUnits = (city: CityData, transport: Transport): Node => {\n    return h(\n      s(\n        `<div class=\"garrisoned-units\"><header>Garrisoned Units</header></div>`,\n        s(\n          '<div class=\"units\"></div>',\n          ...city.tile.units.map((unit) => new Unit(unit).element())\n        )\n      ),\n      {\n        click() {\n          const cityPlayerUnits = city.tile.units.filter(\n            (unit: UnitData) => unit.player.id === city.player.id\n          );\n\n          if (cityPlayerUnits.length === 0) {\n            return;\n          }\n\n          new UnitSelectionWindow(cityPlayerUnits, transport);\n        },\n      }\n    );\n  },\n  renderSupportedUnits = (city: CityData): Node => {\n    return s(\n      `<div class=\"supported-units\"><header>Supported units</header></div>`,\n      s(\n        '<div class=\"units\"></div>',\n        ...city.units.map((unit) => new SupportedUnit(city, unit))\n      )\n    );\n  },\n  cityDetails = (\n    city: CityData,\n    portal: Portal,\n    transport: Transport,\n    chooseProduction: () => void,\n    completeProduction: () => void\n  ) => {\n    return s(\n      '<div class=\"city-screen\"></div>',\n      s(\n        '<div class=\"top-row\"></div>',\n        s(\n          '<div class=\"yield-details\"></div>',\n          renderPopulation(city),\n          renderYields(city),\n          renderSupportedUnits(city)\n        ),\n        renderMap(portal, city, transport),\n        renderImprovements(city)\n      ),\n      s(\n        '<div class=\"bottom-row\"></div>',\n        renderGrowth(city),\n        s(\n          '<div class=\"tabbed-details\"></div>',\n          // TODO: add a tab bar\n          s('<div class=\"info\"></div>', renderGarrisonedUnits(city, transport))\n        ),\n        renderBuild(city, chooseProduction, completeProduction)\n      )\n    );\n  };\n\nexport class City extends Window {\n  #city: CityData;\n  #dataObserver: DataObserver;\n  #portal: Portal;\n  #transport: Transport;\n\n  constructor(city: CityData, portal: Portal, transport: Transport) {\n    super(\n      city.name,\n      cityDetails(\n        city,\n        portal,\n        transport,\n        () => this.changeProduction(),\n        () => this.completeProduction()\n      ),\n      {\n        canResize: true,\n        canMaximise: true,\n        size: 'maximised',\n      }\n    );\n\n    setTimeout(() => resizeYields(this.element()), 200);\n\n    this.addClass('city-screen-window');\n\n    this.#city = city;\n    this.#portal = portal;\n    this.#transport = transport;\n    this.#dataObserver = new DataObserver(\n      [\n        city.id,\n        city.build.id,\n        city.growth.id,\n        ...city.units.map((unit) => unit.id),\n      ],\n      (data: PlainObject) => {\n        const [updatedCity] = (\n          (data.player?.cities ?? []) as CityData[]\n        ).filter((cityData: CityData) => city.id === cityData.id);\n\n        // City must have been captured or destroyed\n        if (!updatedCity) {\n          this.close();\n\n          return;\n        }\n\n        this.#city = updatedCity;\n\n        this.#dataObserver.setIds([\n          updatedCity.id,\n          updatedCity.build.id,\n          updatedCity.growth.id,\n          ...updatedCity.units.map((unit) => unit.id),\n        ]);\n\n        this.update(\n          cityDetails(\n            updatedCity,\n            this.#portal,\n            transport,\n            () => this.changeProduction(),\n            () => this.completeProduction()\n          )\n        );\n\n        this.element().focus();\n\n        setTimeout(() => resizeYields(this.element()), 200);\n      }\n    );\n\n    this.on('keydown', (event) => {\n      if (['c', 'C'].includes(event.key)) {\n        this.changeProduction();\n\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      if (['b', 'B'].includes(event.key)) {\n        this.completeProduction();\n\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      if (['Enter', 'x', 'X'].includes(event.key)) {\n        this.close();\n      }\n    });\n\n    const resizeHandler = () =>\n      setTimeout(() => resizeYields(this.element()), 200);\n\n    this.on('close', () => window.removeEventListener('resize', resizeHandler));\n\n    window.addEventListener('resize', resizeHandler);\n\n    this.on('close', () => this.off('resize', resizeHandler));\n\n    this.on('resize', resizeHandler);\n  }\n\n  changeProduction(): void {\n    new CityBuildSelectionWindow(this.#city.build, this.#transport, () =>\n      this.element().focus()\n    );\n  }\n\n  close(): void {\n    this.#dataObserver.dispose();\n\n    super.close();\n  }\n\n  completeProduction(): void {\n    if (!this.#city.build.building) {\n      return;\n    }\n\n    new ConfirmationWindow(\n      'Are you sure?',\n      `Do you want to rush building of ${this.#city.build.building.item._}`,\n      () =>\n        this.#transport.send('action', {\n          name: 'CompleteProduction',\n          id: this.#city.id,\n        })\n    );\n  }\n}\n\nexport default City;\n", "import {\n  City,\n  MilitaryUnhappiness,\n  Unit as UnitData,\n  UnitSupportFood,\n  UnitSupportProduction,\n  Yield,\n} from '../types';\nimport { Element, s } from '@dom111/element';\nimport Unit from './Unit';\nimport { yieldImages } from './lib/cityYields';\n\ntype YieldWithUnit = Yield & { unit: UnitData };\n\nexport class SupportedUnit extends Element {\n  constructor(\n    city: City,\n    unit: UnitData,\n    yieldsToInclude: string[] = [\n      'UnitSupportFood',\n      'UnitSupportProduction',\n      'MilitaryUnhappiness',\n    ]\n  ) {\n    super(\n      s(\n        '<span class=\"supported-unit\"></span>',\n        new Unit(unit),\n        ...city.yields\n          .filter((cityYield): cityYield is YieldWithUnit =>\n            yieldsToInclude.includes(cityYield._)\n          )\n          .filter((cityYield) => cityYield.unit.id === unit.id)\n          .flatMap((cityYield) => yieldImages(cityYield))\n      )\n    );\n  }\n}\n\nexport default SupportedUnit;\n", "import { BuildItem, City as CityData, CityBuild } from '../types';\nimport { SelectionWindow, SelectionWindowActions } from './SelectionWindow';\nimport City from './City';\nimport Portal from './Portal';\nimport Transport from '../../Engine/Transport';\nimport { reduceKnownYield } from '../lib/yieldMap';\n\ntype onCompleteHandler = (hasSelected: boolean, ...args: any[]) => void;\n\nexport class CityBuildSelectionWindow extends SelectionWindow {\n  #onComplete: onCompleteHandler;\n  #transport: Transport;\n\n  static showCityAction = (\n    city: CityData,\n    portal: Portal,\n    transport: Transport\n  ) => ({\n    label: 'View city',\n    action(selectionWindow: SelectionWindow) {\n      selectionWindow.close();\n\n      new City(city, portal, transport);\n    },\n  });\n  static showCityOnMapAction = (city: CityData, portal: Portal) => ({\n    label: 'Show on map',\n    action(selectionWindow: SelectionWindow) {\n      selectionWindow.close();\n\n      portal.setCenter(city.tile.x, city.tile.y);\n    },\n  });\n\n  constructor(\n    cityBuild: CityBuild,\n    transport: Transport,\n    onComplete: onCompleteHandler = () => {},\n    additionalActions: SelectionWindowActions = {}\n  ) {\n    const turns = (buildItem: BuildItem) =>\n      Math.max(\n        1,\n        Math.ceil(\n          (buildItem.cost.value - cityBuild.progress.value) /\n            reduceKnownYield(cityBuild.city.yields, 'Production')\n        )\n      );\n\n    super(\n      `What would you like to build in ${cityBuild.city.name}?`,\n      cityBuild.available.map((buildItem) => ({\n        label: `${buildItem.item._} (Cost: ${buildItem.cost.value} / ${turns(\n          buildItem\n        )} turn${turns(buildItem) === 1 ? '' : 's'})`,\n        value: buildItem.item._,\n      })),\n      (selection) => {\n        if (!selection) {\n          return;\n        }\n\n        transport.send('action', {\n          name: cityBuild.building === null ? 'CityBuild' : 'ChangeProduction',\n          id: cityBuild.id,\n          chosen: selection ? selection : '@',\n        });\n\n        this.close(true);\n      },\n      null,\n      {\n        actions: additionalActions,\n        displayAll: true,\n      }\n    );\n\n    this.#onComplete = onComplete;\n    this.#transport = transport;\n  }\n\n  close(hasSelected: boolean = false): void {\n    super.close();\n\n    if (hasSelected) {\n      this.#onComplete(hasSelected);\n    }\n  }\n}\n\nexport default CityBuildSelectionWindow;\n", "import { CityBuild as CityBuildObject, PlayerAction } from '../../types';\nimport Action from './Action';\nimport CityBuildSelectionWindow from '../CityBuildSelectionWindow';\nimport Portal from '../Portal';\nimport Transport from '../../../Engine/Transport';\nimport { assetStore } from '../../AssetStore';\nimport { s } from '@dom111/element';\n\nexport class CityBuild extends Action {\n  #portal: Portal;\n\n  constructor(action: PlayerAction, portal: Portal, transport: Transport) {\n    super(action, transport);\n\n    this.#portal = portal;\n  }\n\n  activate(): void {\n    new CityBuildSelectionWindow(\n      this.value(),\n      this.transport(),\n      () => this.complete(),\n      {\n        showCity: CityBuildSelectionWindow.showCityAction(\n          this.value().city,\n          this.#portal,\n          this.transport()\n        ),\n        showCityOnMap: CityBuildSelectionWindow.showCityOnMapAction(\n          this.value().city,\n          this.#portal\n        ),\n      }\n    );\n  }\n\n  build(): void {\n    const cityBuild = this.value();\n\n    assetStore\n      .get('./assets/city/production.png')\n      .then((asset) =>\n        this.append(\n          s(\n            `<button class=\"cityBuild\" title=\"What would you like to build in ${\n              cityBuild.city.name\n            }?\" style=\"background-image:url('${asset!.uri}')\">`\n          )\n        )\n      );\n  }\n\n  value(): CityBuildObject {\n    return super.value() as CityBuildObject;\n  }\n}\n\nexport default CityBuild;\n", "import Action from './Action';\nimport { s } from '@dom111/element';\n\nexport class EndTurn extends Action {\n  activate(): void {\n    this.transport().send('action', {\n      name: 'EndTurn',\n    });\n  }\n\n  build(): void {\n    this.append(s(`<button class=\"endTurn\" title=\"End turn\"></button>`));\n  }\n}\n\nexport default EndTurn;\n", "import Action from './Action';\nimport { PlayerGovernment } from '../../types';\nimport SelectionWindow from '../SelectionWindow';\nimport { assetStore } from '../../AssetStore';\nimport { s } from '@dom111/element';\n\nexport class Revolution extends Action {\n  activate(): void {\n    const chooseWindow = new SelectionWindow(\n      'Choose government',\n      this.value().available.map((government) => ({\n        value: government._,\n      })),\n      (selection) => {\n        if (!selection) {\n          return;\n        }\n\n        this.transport().send('action', {\n          name: 'Revolution',\n          id: this.value().id,\n          chosen: selection ? selection : '@',\n        });\n\n        this.complete();\n\n        chooseWindow.close();\n      },\n      'Which government would you like to convert to?',\n      {\n        displayAll: true,\n      }\n    );\n  }\n\n  build(): void {\n    assetStore\n      .get('./assets/city/sad.png')\n      .then((asset) =>\n        this.append(\n          s(\n            `<button class=\"chooseGovernment\" title=\"Choose government\" style=\"background-image:url('${\n              asset!.uri\n            }')\"></button>`\n          )\n        )\n      );\n  }\n\n  value(): PlayerGovernment {\n    return super.value() as PlayerGovernment;\n  }\n}\n\nexport default Revolution;\n", "import { Tile, Unit } from '../../types';\nimport { Map, IMap } from '../Map';\nimport renderUnit from '../../lib/renderUnit';\n\nexport class Units extends Map implements IMap {\n  #activeUnit: Unit | null = null;\n\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size;\n\n    if (\n      tile.units.length > 0 &&\n      (this.#activeUnit !== null ? this.#activeUnit.tile.id !== tile.id : true)\n    ) {\n      const [unit] = tile.units.sort(\n          (a: Unit, b: Unit): number => b.defence?.value - a.defence?.value\n        ),\n        image = this.renderUnit(unit);\n\n      if (tile.units.length > 1) {\n        this.putImage(image, offsetX - this.scale(), offsetY - this.scale());\n      }\n\n      this.putImage(image, offsetX, offsetY);\n    }\n  }\n\n  protected renderUnit(unit: Unit): CanvasImageSource {\n    return renderUnit(unit);\n  }\n\n  setActiveUnit(unit: Unit | null): void {\n    this.#activeUnit = unit;\n  }\n\n  protected activeUnit(): Unit | null {\n    return this.#activeUnit;\n  }\n}\n\nexport default Units;\n", "import { IMap } from '../Map';\nimport Units from './Units';\n\nexport class ActiveUnit extends Units implements IMap {\n  render(): void {\n    this.clear();\n\n    const activeUnit = this.activeUnit();\n\n    if (activeUnit === null) {\n      return;\n    }\n\n    const { x, y } = activeUnit.tile,\n      tile = this.world().get(x, y),\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      image = this.renderUnit(activeUnit);\n\n    if (tile.units.length > 1) {\n      this.putImage(image, offsetX - this.scale(), offsetY - this.scale());\n    }\n\n    this.putImage(image, offsetX, offsetY);\n  }\n\n  update(): void {\n    this.render();\n  }\n}\n\nexport default ActiveUnit;\n", "import { Tile } from '../../types';\nimport { Map } from '../Map';\n\nexport class CityNames extends Map {\n  renderTile(tile: Tile): void {\n    if (!tile.city) {\n      return;\n    }\n\n    super.renderTile(tile);\n\n    const { x, y } = tile,\n      size = this.tileSize(),\n      offsetX = x * size,\n      offsetY = y * size,\n      city = tile.city,\n      sizeOffsetX = this.tileSize() / 2,\n      sizeOffsetY = this.tileSize() * 0.75,\n      textOffsetX = this.tileSize() / 2,\n      textOffsetY = this.tileSize() * 1.6;\n\n    this.context().font = `bold ${8 * this.scale()}px sans-serif`;\n    this.context().fillStyle = 'black';\n    this.context().textAlign = 'center';\n    this.context().fillText(\n      city.growth.size.toString(),\n      offsetX + sizeOffsetX + this.scale(),\n      offsetY + sizeOffsetY\n    );\n    this.context().fillText(\n      city.name,\n      offsetX + textOffsetX + this.scale(),\n      offsetY + textOffsetY\n    );\n    this.context().fillStyle = 'white';\n    this.context().fillText(\n      city.growth.size.toString(),\n      offsetX + sizeOffsetX,\n      offsetY + sizeOffsetY - this.scale()\n    );\n    this.context().fillText(\n      city.name,\n      offsetX + textOffsetX,\n      offsetY + textOffsetY - this.scale()\n    );\n  }\n\n  update(): void {\n    this.clear();\n\n    // TODO: Could be a little smarter about this...\n    this.world()\n      .tiles()\n      .filter((tile) => !!tile.city)\n      .forEach((tile) => this.renderTile(tile));\n  }\n}\n\nexport default CityNames;\n", "import { City as CityData, GameData, PlainObject, Player } from '../types';\nimport { knownIcons } from '../lib/yieldMap';\nimport { turnsLeft, turnsText, yieldData } from './lib/cityYields';\nimport City from './City';\nimport DataObserver from '../DataObserver';\nimport Portal from './Portal';\nimport Transport from '../../Engine/Transport';\nimport Window from './Window';\nimport { assetStore } from '../AssetStore';\nimport { h } from '../lib/html';\nimport { s } from '@dom111/element';\n\nconst buildCityRow = async (city: CityData): Promise<HTMLElement[]> => {\n  const [food, production, trade, research, gold, luxuries] = [\n      'Food',\n      'Production',\n      'Trade',\n      'Research',\n      'Gold',\n      'Luxuries',\n    ].map((yieldName) => yieldData(city, yieldName)),\n    [\n      foodIcon,\n      productionIcon,\n      tradeIcon,\n      researchIcon,\n      goldIcon,\n      luxuriesIcon,\n    ] = await Promise.all(\n      ['Food', 'Production', 'Trade', 'Research', 'Gold', 'Luxuries'].map(\n        (yieldName) =>\n          assetStore\n            .getScaled(`./assets/${knownIcons[yieldName]}`, 2)\n            .then((image) => `<img src=\"${image.toDataURL('image/png')}\">`)\n      )\n    );\n\n  return [\n    s(`<header>${city.name}</header>`),\n    s(\n      `<div class=\"growth\"><strong>${city.growth.size}</strong> ${foodIcon} ${\n        food[2]\n      } [${food[0]}] (${turnsText(\n        turnsLeft(city.growth, city.yields, 'Food')\n      )})</div>`\n    ),\n    s(\n      `<div class=\"build\">${productionIcon} ${production[2]} [${\n        production[0]\n      }] ${city.build.building ? city.build.building.item._ : 'Nothing'}${\n        city.build.building\n          ? ` (${turnsText(turnsLeft(city.build, city.yields, 'Production'))})`\n          : ''\n      }</div>`\n    ),\n    s(\n      `<div class=\"yields\">${(\n        [\n          [trade, tradeIcon],\n          [research, researchIcon],\n          [gold, goldIcon],\n          [luxuries, luxuriesIcon],\n        ] as [[number, number, number], string][]\n      )\n        .filter(([[total]]) => total !== 0)\n        .map(\n          ([[total, , free], icon]) =>\n            `${icon} ${free}${free !== total ? ` [${total}]` : ''}`\n        )\n        .join(', ')}</div>`\n    ),\n  ];\n};\n\nexport class CityStatus extends Window {\n  #cities: CityData[];\n  #dataObserver: DataObserver;\n  #portal: Portal;\n  #transport: Transport;\n\n  constructor(player: Player, portal: Portal, transport: Transport) {\n    super('City details', s('<div class=\"loading\"></div>'));\n\n    this.addClass('city-status');\n\n    this.#cities = player.cities;\n    this.#dataObserver = new DataObserver(\n      [\n        player.id,\n        ...player.cities.flatMap(({ id, build, growth }: CityData) => [\n          id,\n          growth.id,\n          build.id,\n        ]),\n      ],\n      (data) => {\n        const player = (data as GameData).player;\n\n        this.#cities = player.cities;\n\n        this.#dataObserver.setIds([\n          player.id,\n          ...player.cities.flatMap(({ id, build, growth }: CityData) => [\n            id,\n            growth.id,\n            build.id,\n          ]),\n        ]);\n\n        this.update();\n      }\n    );\n    this.#portal = portal;\n    this.#transport = transport;\n\n    this.update();\n  }\n\n  close() {\n    this.#dataObserver.dispose();\n\n    return super.close();\n  }\n\n  update() {\n    Promise.all(this.#cities.map((city) => buildCityRow(city))).then((rows) =>\n      super.update(\n        s(\n          '<table></table>',\n          ...rows.map(([name, growth, build, yields], index) => {\n            const row = document.createElement('tr');\n\n            row.append(\n              ...(\n                [\n                  [name, 'th'],\n                  [growth, 'td'],\n                  [build, 'td'],\n                  [yields, 'td'],\n                ] as [HTMLElement, string][]\n              ).map(([element, containerNodeName]) => {\n                const container = document.createElement(containerNodeName);\n\n                container.append(element);\n\n                return container;\n              })\n            );\n\n            return h(row, {\n              click: () =>\n                new City(this.#cities[index], this.#portal, this.#transport),\n            });\n          })\n        )\n      )\n    );\n  }\n}\n\nexport default CityStatus;\n", "import { Element, s } from '@dom111/element';\nimport { Yield } from '../types';\n\nexport class GameDetails extends Element {\n  #turn: Yield;\n  #year: Yield;\n\n  constructor(element: HTMLElement, turn: Yield, year: Yield) {\n    super(element);\n\n    this.#turn = turn;\n    this.#year = year;\n  }\n\n  build(): void {\n    this.empty();\n\n    this.append(\n      s(\n        `<h3><span class=\"year\">${this.year()}</span><span class=\"turn\">${this.#turn.value.toString()}</span></h3>`\n      )\n    );\n  }\n\n  year(year = this.#year.value): string {\n    if (year < 0) {\n      return Math.abs(year) + ' BCE';\n    }\n\n    if (year === 0) {\n      return '1 CE';\n    }\n\n    return year + ' CE';\n  }\n}\n\nexport default GameDetails;\n", "import City from './City';\nimport UnitSelectionWindow from './UnitSelectionWindow';\nimport Portal from './Portal';\nimport { Unit } from '../types';\nimport { on } from '@dom111/element';\n\nexport class GamePortal extends Portal {\n  protected bindEvents(): void {\n    on(this.canvas(), 'click', (event) => {\n      const centerTile = this.center(),\n        canvasCenterOffset = {\n          x: Math.floor(this.canvas().width / 2 - this.tileSize() / 2),\n          y: Math.floor(this.canvas().height / 2 - this.tileSize() / 2),\n        },\n        x =\n          centerTile.x +\n          Math.trunc(\n            ((event.offsetX - canvasCenterOffset.x) / this.tileSize() +\n              this.world().width()) %\n              this.world().width()\n          ),\n        y =\n          centerTile.y +\n          Math.trunc(\n            ((event.offsetY - canvasCenterOffset.y) / this.tileSize() +\n              this.world().height()) %\n              this.world().height()\n          );\n\n      const tile = this.world().get(x, y),\n        playerTileUnits = tile.units.filter(\n          (unit: Unit) => unit.player.id === this.playerId()\n        );\n\n      if (tile.city && tile.city.player.id === this.playerId()) {\n        new City(tile.city, this, this.transport());\n      } else if (playerTileUnits.length) {\n        new UnitSelectionWindow(\n          playerTileUnits,\n          this.transport(),\n          (unit: Unit) => this.emit('activate-unit', unit)\n        );\n\n        return;\n      }\n\n      this.setCenter(tile.x, tile.y);\n    });\n  }\n}\n\nexport default GamePortal;\n", "import TerrainAbstract from './TerrainAbstract';\nimport { Tile } from '../../types';\n\nexport class Terrain extends TerrainAbstract {\n  renderTile(tile: Tile): void {\n    super.renderTile(tile);\n\n    if (tile.terrain._ === 'Unknown') {\n      return;\n    }\n\n    const { x, y } = tile;\n\n    if (tile.goodyHut !== null) {\n      this.drawImage('map/hut', x, y);\n    }\n  }\n}\n\nexport default Terrain;\n", "import {\n  City,\n  CityImprovementContent,\n  GameData,\n  MartialLaw,\n  MilitaryUnhappiness,\n  Player,\n  Yield,\n} from '../types';\nimport Window from './Window';\nimport { s } from '@dom111/element';\nimport { renderPopulation } from './lib/cityYields';\nimport Unit from './Unit';\nimport { SupportedUnit } from './SupportedUnit';\nimport Element from '@dom111/element';\nimport DataObserver from '../DataObserver';\n\nconst buildCityRow = async (city: City) => {\n  const happinessReasons: {\n    [key: string]: (cityYield: any) => string | HTMLElement | Element;\n  } = {\n    CityImprovementContent: (cityYield: CityImprovementContent) =>\n      cityYield.cityImprovement._,\n    MartialLaw: (cityYield: MartialLaw) => new Unit(cityYield.unit),\n    MilitaryUnhappiness: (cityYield: MilitaryUnhappiness) =>\n      new SupportedUnit(city, cityYield.unit, ['MilitaryUnhappiness']),\n  };\n\n  const reasons = city.yields.reduce(\n    (reasons: (string | HTMLElement | Element)[], cityYield) => {\n      if (cityYield._ in happinessReasons) {\n        reasons.push(happinessReasons[cityYield._](cityYield));\n      }\n\n      return reasons;\n    },\n    []\n  );\n\n  return s(\n    `<div class=\"city\"><div class=\"name\">${city.name}</div></div>`,\n    renderPopulation(city),\n    s('<div class=\"reasons\"></div>', ...reasons)\n  );\n};\n\nexport class HappinessReport extends Window {\n  #dataObserver: DataObserver;\n  #player: Player;\n\n  constructor(player: Player) {\n    super('Happiness report', s('<div></div>'));\n\n    this.addClass('happiness-report');\n\n    this.#dataObserver = new DataObserver(\n      [player.id, ...player.cities.map((city) => city.id)],\n      (data) => {\n        this.#player = (data as GameData).player;\n\n        this.#dataObserver.setIds([\n          player.id,\n          ...player.cities.map((city) => city.id),\n        ]);\n\n        this.update();\n      }\n    );\n\n    this.#player = player;\n\n    this.update();\n  }\n\n  close() {\n    this.#dataObserver.dispose();\n\n    return super.close();\n  }\n\n  update() {\n    Promise.all(this.#player.cities.map((city) => buildCityRow(city))).then(\n      (rows) => super.update(s('<div></div>', ...rows))\n    );\n  }\n}\n\nexport default HappinessReport;\n", "export interface IIntervalHandler {\n  check(): void;\n  clear(): void;\n  off(handler: () => void): void;\n  on(handler: () => void): void;\n  pause(): void;\n  isPaused(): boolean;\n  resume(): void;\n}\n\nexport class IntervalHandler implements IIntervalHandler {\n  #paused: boolean = false;\n  #stack: (() => void)[] = [];\n\n  constructor(tick: number = 500) {\n    setInterval(() => this.check(), tick);\n  }\n\n  check(): void {\n    if (this.#paused) {\n      return;\n    }\n\n    this.#stack.forEach((item) => item());\n  }\n\n  clear(): void {\n    this.#stack = [];\n  }\n\n  off(handler: () => void): void {\n    this.#stack = this.#stack.filter((item) => item !== handler);\n  }\n\n  on(handler: () => void): void {\n    this.#stack.push(handler);\n  }\n\n  pause(): void {\n    this.#paused = true;\n  }\n\n  isPaused(): boolean {\n    return this.#paused;\n  }\n\n  resume(): void {\n    this.#paused = false;\n  }\n}\n\nexport default IntervalHandler;\n", "import { Element, s } from '@dom111/element';\nimport CustomiseWorldWindow from './CustomiseWorldWindow';\nimport EarthWindow from './EarthWindow';\nimport ImportAssetsWindow from './ImportAssetsWindow';\nimport NewGameWindow from './NewGameWindow';\nimport Transport from '../../Engine/Transport';\nimport { assetStore } from '../AssetStore';\nimport { version } from '../../../../build.json';\nimport { h } from '../lib/html';\n\nexport class MainMenu extends Element {\n  #transport: Transport;\n\n  constructor(element: HTMLElement, transport: Transport) {\n    super(element);\n\n    this.#transport = transport;\n\n    this.build();\n\n    this.addClass('active');\n  }\n\n  async build(showQuit = false) {\n    const hasAssets = await assetStore.hasAllAssets();\n\n    if (!hasAssets) {\n      console.log('Missing assets:');\n      console.log(await assetStore.missingAssets());\n    }\n\n    this.append(\n      h(\n        s(\n          '<nav></nav>',\n          h(\n            s(\n              `<button autofocus${\n                hasAssets ? '' : ' hidden'\n              }>Start a New Game</button>`\n            ),\n            {\n              click: () => {\n                new NewGameWindow(this.#transport, () => this.remove());\n              },\n            }\n          ),\n          h(s(`<button${hasAssets ? '' : ' hidden'}>Earth</button>`), {\n            click: () => new EarthWindow(this.#transport, () => this.remove()),\n          }),\n          h(\n            s(`<button${hasAssets ? '' : ' hidden'}>Customise World</button>`),\n            {\n              click: async () =>\n                new CustomiseWorldWindow(this.#transport, () => this.remove()),\n            }\n          ),\n          h(s(`<button${hasAssets ? '' : ' hidden'}>Import Assets</button>`), {\n            click: () => new ImportAssetsWindow(),\n          }),\n          h(s(`<button${showQuit ? '' : ' hidden'}>Quit</button>`), {\n            click: () => {\n              this.remove();\n\n              this.#transport.send('quit');\n            },\n          })\n        ),\n        {\n          keydown(event: KeyboardEvent) {\n            const currentTarget = document.activeElement;\n\n            if (\n              currentTarget === null ||\n              !currentTarget.matches('#mainmenu nav button')\n            ) {\n              return;\n            }\n\n            if (event.key === 'ArrowDown' && currentTarget.nextElementSibling) {\n              (currentTarget.nextElementSibling as HTMLElement).focus();\n            }\n\n            if (\n              event.key === 'ArrowUp' &&\n              currentTarget.previousElementSibling\n            ) {\n              (currentTarget.previousElementSibling as HTMLElement).focus();\n            }\n          },\n        }\n      ),\n      s(`<footer>version: ${version}</footer>`)\n    );\n  }\n\n  remove(): void {\n    this.removeClass('active');\n\n    setTimeout((): void => super.remove(), 2000);\n  }\n}\n\nexport default MainMenu;\n", "export interface RequestInterface<Args extends any[], Return extends any> {\n  args(): Args;\n  channel(): string;\n}\n\nexport type RequestArgs<RequestType extends Request> =\n  RequestType extends Request<infer Args> ? Args : never;\nexport type RequestReturn<RequestType extends Request> =\n  RequestType extends Request<any[], infer Return> ? Return : never;\n\nexport class Request<Args extends any[] = any[], Return extends any = any>\n  implements RequestInterface<Args, Return>\n{\n  #args: Args;\n  #channel: string;\n\n  constructor(channel: string, ...args: Args) {\n    this.#args = args;\n    this.#channel = channel;\n  }\n\n  args(): Args {\n    return this.#args;\n  }\n\n  channel(): string {\n    return this.#channel;\n  }\n}\n\nexport default Request;\n", "import Request from '../Request';\n\nexport class Options<Key extends string> extends Request<\n  [Key[]],\n  Record<Key, any>\n> {\n  constructor(args: Key[]) {\n    super('getOptions', args);\n  }\n}\n\nexport default Options;\n", "import Options from '../../Engine/Requests/Options';\nimport Request from '../../Engine/Request';\nimport Transport from '../../Engine/Transport';\nimport Window from './Window';\nimport { h } from '../lib/html';\nimport { s } from '@dom111/element';\n\ntype FinishedHandler = () => void;\n\nexport class CustomiseWorldWindow extends Window {\n  #onFinished?: FinishedHandler;\n  #transport: Transport;\n\n  constructor(transport: Transport, onFinished?: FinishedHandler) {\n    super('Customise world', s('<div class=\"customise-world\"></div>'));\n\n    this.#onFinished = onFinished;\n    this.#transport = transport;\n\n    this.init();\n  }\n\n  build(): void {\n    super.build();\n\n    this.init();\n  }\n\n  async init(): Promise<void> {\n    const existingValues = await this.#transport.request(\n        new Options([\n          'players',\n          'height',\n          'width',\n          'landCoverage',\n          'landSize',\n          'maxIterations',\n        ])\n      ),\n      playersInput = s<HTMLInputElement>(\n        `<input name=\"players\" type=\"number\" value=\"${\n          existingValues.players ?? 7\n        }\" step=\"1\" min=\"1\" max=\"20\">`\n      ),\n      heightInput = s<HTMLInputElement>(\n        `<input name=\"height\" type=\"number\" value=\"${\n          existingValues.height ?? 60\n        }\" step=\"1\" min=\"1\">`\n      ),\n      widthInput = s<HTMLInputElement>(\n        `<input name=\"width\" type=\"number\" value=\"${\n          existingValues.width ?? 80\n        }\" step=\"1\" min=\"1\">`\n      ),\n      landCoverageInput = s<HTMLInputElement>(\n        `<input name=\"landCoverage\" type=\"number\" value=\"${\n          existingValues.landCoverage ?? 0.4\n        }\" step=\"0.01\" min=\"0\">`\n      ),\n      landSizeInput = s<HTMLInputElement>(\n        `<input name=\"landSize\" type=\"number\" value=\"${\n          existingValues.landSize ?? 0.2\n        }\" step=\"0.01\" min=\"0\">`\n      ),\n      maxIterationsInput = s<HTMLInputElement>(\n        `<input name=\"maxIterations\" type=\"number\" value=\"${\n          existingValues.maxIterations ?? 20\n        }\" step=\"1\" min=\"1\">`\n      ),\n      submit = async () => {\n        this.close();\n\n        await this.#transport.request(\n          new Request('setOptions', {\n            players: playersInput.value,\n            height: heightInput.value,\n            width: widthInput.value,\n            landCoverage: landCoverageInput.value,\n            landSize: landSizeInput.value,\n            maxIterations: maxIterationsInput.value,\n          })\n        );\n\n        this.#transport.send('start');\n\n        if (this.#onFinished) {\n          this.#onFinished();\n        }\n      };\n\n    this.update(\n      s(\n        '<div class=\"customise-world\"></div>',\n        s('<div class=\"option\"><label>Players</label></div>', playersInput),\n        s('<div class=\"option\"><label>Height</label></div>', heightInput),\n        s('<div class=\"option\"><label>Width</label></div>', widthInput),\n        s(\n          '<div class=\"option\"><label>Land coverage</label></div>',\n          landCoverageInput\n        ),\n        s('<div class=\"option\"><label>Land size</label></div>', landSizeInput),\n        s(\n          '<div class=\"option\"><label>Max iterations</label></div>',\n          maxIterationsInput\n        ),\n        h(s('<button>Build</button>'), {\n          click: () => submit(),\n        })\n      )\n    );\n\n    this.on('keydown', (event) => {\n      if (event.key === 'Enter') {\n        submit();\n      }\n    });\n  }\n}\n\nexport default CustomiseWorldWindow;\n", "import {\n  SelectionWindow,\n  SelectionWindowOption,\n  SelectionWindowOptions,\n} from './SelectionWindow';\n\ndeclare global {\n  interface GlobalEventHandlersEventMap {\n    selection: CustomEvent<string>;\n  }\n}\n\nexport class MandatorySelection extends SelectionWindow {\n  constructor(\n    title: string,\n    optionList: SelectionWindowOption[],\n    onChoose: (selection: string) => void,\n    body: string | Node | null = 'Please choose one of the following:',\n    options: SelectionWindowOptions = {\n      canClose: false,\n      displayAll: false,\n    }\n  ) {\n    super(title, optionList, onChoose, body, {\n      ...options,\n      displayAll: true,\n    });\n  }\n\n  display(): Promise<string> {\n    return new Promise<string>((resolve) => {\n      this.on('selection', ({ detail }) => resolve(detail));\n\n      super.display();\n    });\n  }\n}\n\nexport default MandatorySelection;\n", "import MandatorySelection from './MandatorySelection';\nimport Transport from '../../Engine/Transport';\nimport Request from '../../Engine/Request';\n\nexport type FinishedHandler = () => void;\n\nexport class NewGameWindow extends MandatorySelection {\n  constructor(transport: Transport, onFinished?: FinishedHandler) {\n    // TODO: take the number from Engine options.\n    super(\n      'How many players?',\n      [\n        {\n          label: '7 civilizations',\n          value: 7,\n        },\n        {\n          label: '6 civilizations',\n          value: 6,\n        },\n        {\n          label: '5 civilizations',\n          value: 5,\n        },\n        {\n          label: '4 civilizations',\n          value: 4,\n        },\n        {\n          label: '3 civilizations',\n          value: 3,\n        },\n      ],\n      async (selection) => {\n        this.close();\n\n        await transport.request(\n          new Request('setOptions', {\n            width: 80,\n            height: 60,\n            players: parseInt(selection, 10),\n          })\n        );\n\n        if (onFinished) {\n          await onFinished();\n        }\n\n        transport.send('start');\n      }\n    );\n  }\n}\n\nexport default NewGameWindow;\n", "import { FinishedHandler, NewGameWindow } from './NewGameWindow';\nimport Transport from '../../Engine/Transport';\nimport Request from '../../Engine/Request';\n\nexport class EarthWindow extends NewGameWindow {\n  constructor(transport: Transport, onFinished?: FinishedHandler) {\n    super(transport, async () => {\n      if (onFinished) {\n        await onFinished();\n      }\n\n      await transport.request(\n        new Request('setOptions', {\n          width: 80,\n          height: 50,\n          earth: true,\n        })\n      );\n    });\n  }\n}\n\nexport default EarthWindow;\n", "export class BinFile {\n  private blob: string | null = null;\n  private ptr: number = -1;\n\n  fromString(content: string, callback: (...args: any[]) => any) {\n    this.blob = content;\n    this.ptr = 0;\n    this.decode(callback);\n  }\n\n  getUByte() {\n    return (this.blob as string).charCodeAt(this.ptr++);\n  }\n\n  getUShort() {\n    const b1 = this.getUByte(),\n      b2 = this.getUByte();\n\n    return (b2 << 8) + b1;\n  }\n\n  getShort() {\n    return ((this.getUShort() + 0x8000) % 0x10000) - 0x8000;\n  }\n\n  getString(length: number) {\n    const start = this.ptr;\n    this.ptr += length;\n\n    return (this.blob as string).substr(start, length);\n  }\n\n  decode(callback: (...args: any[]) => any): void {\n    if (this.blob === null) {\n      console.warn('file has not been loaded!');\n\n      return;\n    }\n\n    console.warn('The decode function should be overwritten');\n    if (callback) callback();\n  }\n}\n\nexport default BinFile;\n", "export class LZWDictionary {\n  private dicTable: number[][] | null[] = [];\n  private dicSize: number;\n  private curPos: number;\n\n  constructor(maxBits: number) {\n    this.dicTable = [];\n    this.dicSize = 0x1 << maxBits;\n\n    for (let i = 0; i < this.dicSize; i++) {\n      if (i < 256) {\n        this.dicTable[i] = [i];\n      } else {\n        this.dicTable[i] = null;\n      }\n    }\n\n    this.curPos = 0x0101;\n  }\n\n  getEntry(pos: number): number[] | null {\n    return pos < this.curPos ? this.dicTable[pos] : null;\n  }\n\n  isFull() {\n    return this.curPos === this.dicTable.length;\n  }\n\n  getCurPos() {\n    return this.curPos;\n  }\n\n  addEntry(entry: number[]) {\n    if (this.curPos < this.dicTable.length) {\n      this.dicTable[this.curPos] = entry;\n      this.curPos++;\n    }\n\n    return this.curPos - 1;\n  }\n}\n\nexport default LZWDictionary;\n", "import LZWDictionary from './LZWDictionary';\n\nexport class LZW {\n  //Extracts a series of integers from the byte array\n  static parseByteStreamToIndexes(\n    binFile: { getUByte: () => number },\n    remainingCodedBytes: number,\n    uByteMode: number\n  ) {\n    const parsedIndexes = []; //ArrayList<Integer> parsedIndexes = new ArrayList<Integer>();\n\n    let usableBits = 0,\n      usableBitCount = 0,\n      indicatorLength = 1 /* to increment with ++; rule is that 8+indicatorLength must be <= uByteMode, otherwise reset */,\n      indicatorFlag = 0x001 /* to increment with <<=1 followed by |= 1 */,\n      nextThreshold = 0x0100 /*256*/ /* to increment with <<=1, or *=2 */,\n      decodedCounter = 0,\n      index = 0;\n\n    while (remainingCodedBytes > 0) {\n      /* get enough coded bits to work with */\n      while (usableBitCount < 8 + indicatorLength) {\n        usableBits |= binFile.getUByte() << usableBitCount;\n        remainingCodedBytes--;\n        usableBitCount += 8;\n      }\n\n      /* decode bytes and indicators */\n      while (usableBitCount >= 8 + indicatorLength) {\n        //Builds out a bit screen that is of size 8 + the number of indicator bits and ors it with current set of usable bits\n        index = usableBits & (((indicatorFlag << 8) & 0xff00) | 0x00ff);\n\n        usableBits >>= 8 + indicatorLength; //Right-shift out the used bits\n        usableBitCount -= 8 + indicatorLength; //Decrement the usableBitCount by the number of bits used\n\n        decodedCounter++; //Keep track of how many things we have decoded to ensure threshold isn't reached\n\n        if (decodedCounter == nextThreshold) {\n          //If threshold is reached...\n          decodedCounter = 0;\n          indicatorLength += 1; // to increment with ++; rule is that 8+indicatorLength must be <= uByteMode, otherwise reset\n          indicatorFlag <<= 1;\n          indicatorFlag |= 1; // left-shift bitmask and add another 1 (e.g. 0001 > 0011 > 0111)\n          nextThreshold <<= 1; //Double the next threshold\n\n          if (8 + indicatorLength > uByteMode) {\n            decodedCounter = 0;\n            indicatorLength = 1;\n            indicatorFlag = 0x001;\n            nextThreshold = 0x0100 /*256*/;\n          }\n        }\n        parsedIndexes.push(index);\n      }\n    }\n\n    return parsedIndexes;\n  }\n\n  //Decodes the integers into byte-level data using a dictionary look-up\n  static decode(inputData: any, dicIndexMaxBits: number) {\n    dicIndexMaxBits = dicIndexMaxBits || 0x0b;\n\n    let codedData = inputData; //stringToNumArray(inputData); //Convert string to an array of numbers\n\n    const decodedData: number[] = [];\n\n    while (codedData.length > 0) {\n      const dic = new LZWDictionary(dicIndexMaxBits),\n        plainData = [codedData[0]];\n\n      let oldCode = codedData[0],\n        buffer = dic.getEntry(oldCode),\n        character = oldCode,\n        newCode;\n\n      let i = 0;\n      while (!dic.isFull() && i++ < codedData.length - 1) {\n        newCode = codedData[i];\n\n        let p: number[] | null = [];\n\n        if (newCode >= dic.getCurPos()) {\n          p = dic.getEntry(oldCode);\n\n          if (p === null) {\n            console.error(\n              `No dictionary entry in LZW special case: oldCode=${oldCode}; newCode=${newCode}; i=${i}; buffer=${buffer}`\n            );\n          }\n\n          p = [...(p ?? []), character]; //create a copy of the array p to not overwrite the dic entry and append character=\n        } else {\n          // Get entry p for coded index codedData[i]\n          p = dic.getEntry(codedData[i]);\n        }\n\n        plainData.push.apply(plainData, p as number[]); //Merge entry p onto the plainData output\n        character = (p as number[])[0]; // Get first char of p\n        dic.addEntry((buffer as number[]).concat(character)); // Add new entry to dictionary as buffer+c\n        oldCode = newCode;\n        buffer = dic.getEntry(oldCode);\n      }\n\n      decodedData.push.apply(decodedData, plainData); //First append plainData to decodedData\n      codedData = codedData.slice(i + 1); //Second truncate codedData to keep only undecoded stuff before continuing the loop\n    }\n\n    return decodedData;\n  }\n\n  //Run-length decodes around special character 0x90\n  static RLEDecode(byteArr: number[]) {\n    const opt = [];\n\n    let lastChr = 0,\n      isFlag = false;\n\n    for (let i = 0; i < byteArr.length; i++) {\n      const chr = byteArr[i];\n\n      if (isFlag) {\n        if (chr == 0x00) {\n          lastChr = 0x90;\n          opt.push(0x90);\n        } else {\n          for (let j = 0; j < chr - 1; j++) {\n            opt.push(lastChr);\n          }\n        }\n        isFlag = false;\n      } else {\n        if (chr == 0x90) {\n          isFlag = true;\n        } else {\n          opt.push(chr);\n          lastChr = chr;\n        }\n      }\n    }\n\n    return opt;\n  }\n}\n\nexport default LZW;\n", "export const lowerNibble = (byte: number): number => byte & 0xf;\n\nexport default lowerNibble;\n", "export const upperNibble = (byte: number): number => (byte & 0xf0) >> 4;\n\nexport default upperNibble;\n", "import BinFile from './BinFile';\nimport LZW from './LZW';\nimport lowerNibble from './lib/lowerNibble';\nimport upperNibble from './lib/upperNibble';\n\ndeclare type RGBA = {\n  r: number;\n  g: number;\n  b: number;\n  a: number;\n};\n\nexport class PicImage extends BinFile {\n  private palette: RGBA[] = [];\n  private palette16: RGBA[] = [\n    { r: 0xff, g: 0xff, b: 0xff, a: 0x00 }, // 0 - transparent\n    { r: 0xaa, g: 0x00, b: 0x00, a: 0xff }, // 1\n    { r: 0x00, g: 0xaa, b: 0x00, a: 0xff }, // 2\n    { r: 0xaa, g: 0xaa, b: 0x00, a: 0xff }, // 3\n    { r: 0x00, g: 0x00, b: 0xaa, a: 0xff }, // 4\n    { r: 0x00, g: 0x00, b: 0x00, a: 0xff }, // 5\n    { r: 0x00, g: 0x55, b: 0xaa, a: 0xff }, // 6\n    { r: 0xaa, g: 0xaa, b: 0xaa, a: 0xff }, // 7\n    { r: 0x55, g: 0x55, b: 0x55, a: 0xff }, // 8\n    { r: 0xff, g: 0x55, b: 0x55, a: 0xff }, // 9\n    { r: 0x55, g: 0xff, b: 0x55, a: 0xff }, // A\n    { r: 0xff, g: 0xff, b: 0x55, a: 0xff }, // B\n    { r: 0x55, g: 0x55, b: 0xff, a: 0xff }, // C\n    { r: 0xff, g: 0x55, b: 0xff, a: 0xff }, // D\n    { r: 0x55, g: 0xff, b: 0xff, a: 0xff }, // E\n    { r: 0xff, g: 0xff, b: 0xff, a: 0xff }, // F\n  ];\n\n  private imageData: null | number[] = null;\n  private imageHeight = 0;\n  private imageWidth = 0;\n  private byteMode = 0xb;\n\n  decode(callback: (...args: any[]) => any): void {\n    let id = this.getString(2),\n      length = this.getShort();\n\n    if (id == 'M0') {\n      //Second part could be the VGA Palette information\n      this.getPaletteData();\n      id = this.getString(2);\n      length = this.getShort();\n    } else {\n      //If no palette information, let's create a random one\n      console.log('Creating a random color palette...');\n      for (let i = 0; i < 256; i++) {\n        if (i < 16) {\n          this.palette.push(this.palette16[i]);\n        } else {\n          this.palette.push({\n            r: Math.floor(Math.random() * 256),\n            g: Math.floor(Math.random() * 256),\n            b: Math.floor(Math.random() * 256),\n            a: 0xff,\n          });\n        }\n      }\n    }\n\n    if (id == 'X0') {\n      //Final part is image data, in this case VGA\n      this.getX0ImageData(length);\n    } else if (id == 'X1') {\n      //Final part is image data, in this case EGA\n      this.getX1ImageData(length);\n    } else {\n      //Data chunk is of an unknown type\n      console.error('\"' + id + '\" is an unknown chunk type');\n    }\n\n    if (callback) callback();\n  }\n\n  getPaletteData() {\n    const firstIndex = this.getUByte(),\n      lastIndex = this.getUByte(),\n      paletteLength = lastIndex - firstIndex + 1;\n\n    let seenBlack = false;\n\n    for (let i = 0; i < paletteLength; i++) {\n      const colour: RGBA = {\n        r: this.getUByte() * 4, // Each color is between 0 and 64, so to make it use entire\n        g: this.getUByte() * 4, // color space, multiply by 4. The higher-order bits may be used\n        b: this.getUByte() * 4, // for transparency flags, but that's unclear for now...\n        a: 0xff,\n      };\n\n      this.palette.push(colour);\n\n      if (colour.r === colour.g && colour.g === colour.b && colour.r === 0) {\n        // The first black is \"real\" black, the others are (or at least can be) transparency\n        if (!seenBlack) {\n          colour.a = 0;\n        }\n\n        seenBlack = true;\n      }\n    }\n\n    this.palette.push({\n      r: 0,\n      g: 0,\n      b: 0,\n      a: 0,\n    });\n  }\n\n  getX0ImageData(length: number) {\n    this.imageWidth = this.getShort();\n    this.imageHeight = this.getShort();\n    this.byteMode = this.getUByte();\n\n    //Step #1: parse the remainder of the chunk into a set of integers with flags\n    const decompSourceData = LZW.parseByteStreamToIndexes(\n        this,\n        length - 5,\n        this.byteMode\n      ),\n      //Step #2: decode the data using the LZW algorithm\n      decompData = LZW.decode(decompSourceData, this.byteMode);\n\n    //Step #3: decode the final image data using Run-length decoding\n    this.imageData = LZW.RLEDecode(decompData);\n  }\n\n  getX1ImageData(length: number) {\n    this.getX0ImageData(length); //This works the same as x0 data, but each byte includes an upper and lower nibble entry with max 16\n\n    //Loop through each entry and separate into upper and lower nibbles\n    const oldImageData = this.imageData as number[];\n\n    this.imageData = [];\n\n    for (let i = 0; i < oldImageData.length; i++) {\n      this.imageData.push(lowerNibble(oldImageData[i]));\n      this.imageData.push(upperNibble(oldImageData[i]));\n    }\n\n    //set the palette to the hard-coded 16-color palette\n    this.palette = this.palette16;\n  }\n\n  draw(\n    ctx: CanvasRenderingContext2D,\n    destinationX: number = 0,\n    destinationY: number = 0\n  ) {\n    const canvasData = ctx.getImageData(\n      0,\n      0,\n      this.imageWidth,\n      this.imageHeight\n    );\n\n    let index = 0;\n\n    for (let y = 0; y < this.imageHeight; y++) {\n      for (let x = 0; x < this.imageWidth; x++) {\n        const colorIndex = (this.imageData as number[])[index],\n          canvasIndex = (x + y * this.imageWidth) * 4;\n\n        canvasData.data[canvasIndex] = this.palette[colorIndex].r;\n        canvasData.data[canvasIndex + 1] = this.palette[colorIndex].g;\n        canvasData.data[canvasIndex + 2] = this.palette[colorIndex].b;\n        canvasData.data[canvasIndex + 3] = this.palette[colorIndex].a;\n        index++;\n      }\n    }\n\n    ctx.putImageData(canvasData, destinationX, destinationY);\n  }\n\n  getPixel(x: number, y: number): number {\n    if (!this.imageData) {\n      return 0;\n    }\n\n    return this.imageData[x + this.imageWidth * y];\n  }\n}\n\nexport default PicImage;\n", "import { Canvas, CanvasRenderingContext2D } from 'canvas';\nimport PicImage from './PicImage';\n\ntype DefinitionData = {\n  height?: number;\n  width?: number;\n  x?: number;\n  y?: number;\n};\n\ntype DefinitionChild = DefinitionData & { name: string };\n\ntype DefinitionParent = DefinitionData & {\n  contents: DefinitionChild[];\n};\n\ntype Definition = {\n  [filename: string]: DefinitionParent[];\n};\n\ntype DefaultData = {\n  height: number;\n  width: number;\n  clear: {\n    r: number;\n    g: number;\n    b: number;\n  };\n};\n\nexport type ExtractData = {\n  defaults: DefaultData;\n  files: {\n    [filename: string]: Definition;\n  };\n};\n\ntype ImageMap = {\n  name: string;\n  uri: string;\n};\n\nexport const extractSprites = (\n  content: string,\n  extractData: Definition,\n  defaults: DefaultData,\n  canvasProvider: (width: number, height: number) => Canvas | HTMLCanvasElement,\n  logger: (message: string) => void = (message) => console.log(message)\n): ImageMap[] => {\n  const canvas = canvasProvider(320, 200),\n    image = new PicImage(),\n    result: ImageMap[] = [];\n\n  image.fromString(content, () => {\n    image.draw(\n      canvas.getContext('2d', {\n        // @ts-ignore\n        willReadFrequently: true,\n      }) as CanvasRenderingContext2D\n    );\n\n    Object.entries(extractData).forEach(([path, definitionParents]) =>\n      definitionParents.forEach((definition) =>\n        definition.contents.forEach((content) => {\n          const object: { [key: string]: any } = {\n              ...defaults,\n              ...definition,\n              ...content,\n            },\n            filename = `./assets/${path + object.name}.png`,\n            contentCanvas = canvasProvider(object.width, object.height),\n            context = contentCanvas.getContext('2d', {\n              // @ts-ignore\n              willReadFrequently: true,\n            }) as CanvasRenderingContext2D;\n\n          context.clearRect(0, 0, object.width, object.height);\n          context.drawImage(\n            canvas,\n            object.x,\n            object.y,\n            object.width,\n            object.height,\n            0,\n            0,\n            object.width,\n            object.height\n          );\n\n          for (let x = 0; x < canvas.width; x++) {\n            for (let y = 0; y < canvas.height; y++) {\n              let imageData = context.getImageData(x, y, 1, 1).data;\n\n              if (\n                imageData[0] == object.clear.r &&\n                imageData[1] == object.clear.g &&\n                imageData[2] == object.clear.b\n              ) {\n                context.clearRect(x, y, 1, 1);\n              }\n            }\n          }\n\n          logger(`Processing ${filename}...`);\n          result.push({\n            name: filename,\n            uri: contentCanvas.toDataURL('image/png'),\n          });\n        })\n      )\n    );\n  });\n\n  return result;\n};\n\nexport default extractSprites;\n", "import {\n  ExtractData,\n  extractSprites,\n} from '@civ-clone/civ1-asset-extractor/extractSprites';\nimport Window from './Window';\nimport { assetStore } from '../AssetStore';\nimport extractData from '@civ-clone/civ1-asset-extractor/extract-data.json';\nimport { h } from '../lib/html';\nimport { s } from '@dom111/element';\n\nexport class ImportAssetsWindow extends Window {\n  #fileInput: HTMLInputElement;\n  #progressInformation: HTMLParagraphElement;\n\n  constructor() {\n    const fileInput = s<HTMLInputElement>('<input type=\"file\" multiple>'),\n      progressInformation = s<HTMLParagraphElement>(\n        '<p class=\"loading\" hidden></p>'\n      );\n\n    super(\n      'Import assets',\n      s(\n        `<div class=\"import-assets\"><p>Upload ${Object.keys(\n          extractData.files\n        ).join(\n          ', '\n        )} from the original Civilization files to extract assets (these will be stored locally). This process can take at least a few minutes.</p><div class=\"brave\" ${\n          // @ts-ignore\n          navigator?.brave ? '' : ' hidden'\n        }><p>It looks like you're using Brave and due to the use of <code>HTMLCanvasElement</code>'s <code>getImageData</code> and <code>toDataURL</code> functions, please put Shields down while importing, and playing, otherwise any colour-replaced icons won't look correct. <strong>Remember to put them back up after!</strong></p><p><a href=\"https://brave.com/privacy-updates/4-fingerprinting-defenses-2.0/#2-fingerprinting-protections-20-farbling-for-great-good\" target=\"_blank\">Read more about \"farbling\".</a></p></div></div>`,\n        s(\n          '<p></p>',\n          h(fileInput, {\n            change: (event) => this.handleFileUpload(event),\n          })\n        ),\n        progressInformation\n      )\n    );\n\n    this.#fileInput = fileInput;\n    this.#progressInformation = progressInformation;\n  }\n\n  async handleFileUpload(event: InputEvent) {\n    this.#fileInput.setAttribute('disabled', '');\n    this.#progressInformation.removeAttribute('hidden');\n    this.#progressInformation.innerText = 'Building image assets...';\n\n    const files = Array.from(\n        (event.target as HTMLInputElement).files ?? []\n      ) as File[],\n      filenames: string[] = files.map((file: File) => file.name),\n      expectedMatches = Object.keys(extractData.files).map(\n        (key) => new RegExp(key, 'i')\n      );\n\n    if (\n      !expectedMatches.every((expectedMatch) =>\n        filenames.some((filename) => filename.match(expectedMatch))\n      )\n    ) {\n      console.error(\n        `Please provide ${filenames.join(', ')} to process the assets.`\n      );\n\n      return;\n    }\n\n    const results: { name: string; uri: string }[] = [];\n\n    // Wait for...\n    await Promise.all(\n      // ...all files...\n      files.map(\n        async (file: File) =>\n          // ...to have been...\n          new Promise<void>((resolve) => {\n            const definitions = (extractData as ExtractData).files[\n              file.name.toUpperCase()\n            ];\n\n            if (!definitions) {\n              console.warn(`No definitions found for ${file.name}, skipping.`);\n\n              return;\n            }\n\n            const reader = new FileReader();\n\n            // ...loaded...\n            reader.addEventListener('load', async (event) => {\n              // ...the sprites extracted...\n              extractSprites(\n                event.target!.result as string,\n                definitions,\n                extractData.defaults,\n                (width, height) => {\n                  const canvas = document.createElement(\n                    'canvas'\n                  ) as HTMLCanvasElement;\n\n                  canvas.width = width;\n                  canvas.height = height;\n\n                  return canvas;\n                },\n                (message) => {\n                  this.#progressInformation.innerText = message;\n                }\n              ).forEach((record) => results.push(record));\n\n              resolve();\n            });\n\n            reader.readAsBinaryString(file);\n          })\n      )\n    );\n\n    this.#progressInformation.innerText = 'Writing to database...';\n\n    // ...and all results stored in IDB.\n    await Promise.all(results.map((record) => assetStore.set(record)));\n\n    if (!(await assetStore.hasAllAssets())) {\n      console.error('Something went wrong...');\n      this.#progressInformation.style.color = '#f00';\n      this.#progressInformation.innerText =\n        'Not all expected data was written. Might need to try again... Missing: ' +\n        (await assetStore.missingAssets()).join(', ');\n\n      this.#fileInput.removeAttribute('disabled');\n\n      return;\n    }\n\n    this.#progressInformation.innerText =\n      'Done! Please reload the page to utilise the fresh assets.';\n\n    // We need to reprocess everything and this is the lazy way...\n    location.reload();\n  }\n}\n\nexport default ImportAssetsWindow;\n", "import Map from './Map';\nimport Portal from './Portal';\nimport World from './World';\nimport { on } from '@dom111/element';\n\nexport class Minimap {\n  #context: CanvasRenderingContext2D;\n  #element: HTMLCanvasElement;\n  #layers: Map[];\n  #portal: Portal;\n  #world: World;\n\n  constructor(\n    element: HTMLCanvasElement,\n    world: World,\n    portal: Portal,\n    ...layers: Map[]\n  ) {\n    this.#element = element;\n    this.#world = world;\n    this.#portal = portal;\n    this.#layers = layers;\n\n    this.#context = this.#element.getContext('2d')!;\n\n    on(this.#element, 'click', (event) => {\n      const x = event.offsetX - this.#element.offsetLeft,\n        y = event.offsetY - this.#element.offsetTop,\n        tileX = Math.ceil(\n          (x / this.#element.offsetWidth) * this.#world.width()\n        ),\n        tileY = Math.ceil(\n          (y / this.#element.offsetHeight) * this.#world.height()\n        );\n\n      this.#portal.setCenter(tileX, tileY);\n      this.update();\n    });\n  }\n\n  update(): void {\n    const targetHeight =\n      this.#layers[0].canvas().height * (190 / this.#layers[0].canvas().width);\n\n    this.#element.height = targetHeight;\n    this.#context.clearRect(0, 0, 190, targetHeight);\n\n    this.#layers.forEach((layer) =>\n      this.#context.drawImage(layer.canvas(), 0, 0, 190, targetHeight)\n    );\n\n    const [start, end] = this.#portal.rawVisibleRange();\n\n    // TODO: draw the rectangle replicated when close to the sides\n    this.#context.lineWidth = 1;\n    this.#context.strokeStyle = '#fff';\n    this.#context.fillStyle = 'rgba(255, 255, 255, .2)';\n    this.#context.rect(\n      Math.floor((190 / this.#world.width()) * start.x),\n      Math.floor((targetHeight / this.#world.height()) * start.y),\n      Math.floor((190 / this.#world.width()) * (end.x - start.x)),\n      Math.floor((targetHeight / this.#world.height()) * (end.y - start.y))\n    );\n    this.#context.stroke();\n    this.#context.fill();\n  }\n}\n\nexport default Minimap;\n", "import NotificationWindow from './NotificationWindow';\n\nexport interface Notification {\n  message: string;\n  title?: string;\n}\n\nexport class Notifications {\n  #container: HTMLElement;\n  #notifications: Notification[] = [];\n\n  constructor(container: HTMLElement = document.body) {\n    this.#container = container;\n  }\n\n  receive(notification: Notification): void {\n    this.#notifications.push(notification);\n\n    this.check();\n  }\n\n  private check(): void {\n    const active = document.querySelector('.notificationWindow');\n\n    if (!this.#notifications.length || active) {\n      return;\n    }\n\n    const notification = this.#notifications.shift() as Notification;\n\n    this.publish(notification);\n  }\n\n  private publish(notification: Notification): void {\n    const notificationWindow = new NotificationWindow(\n      notification.title ?? 'Notification',\n      notification.message,\n      {\n        parent: this.#container,\n      }\n    );\n\n    notificationWindow.on('close', () => this.check());\n  }\n}\n\nexport default Notifications;\n", "import { City, Player } from '../types';\nimport { Element, s } from '@dom111/element';\nimport { reduceKnownYields } from '../lib/yieldMap';\n\nexport class PlayerDetails extends Element {\n  #player: Player;\n\n  constructor(element: HTMLElement, player: Player) {\n    super(element);\n\n    this.#player = player;\n  }\n\n  build(): void {\n    this.empty();\n\n    const { civilization, treasury, research, cities } = this.#player;\n\n    const [totalGold, totalResearch] = cities.reduce(\n        ([totalGold, totalResearch], city: City): [number, number] => {\n          // TODO: There must be a way to specify that the return array has the same number of elements as the arguments...\n          const [cityGold, cityResearch] = reduceKnownYields(\n            city.yields,\n            'Gold',\n            'Research'\n          );\n\n          return [totalGold + cityGold, totalResearch + cityResearch];\n        },\n        [0, 0]\n      ),\n      researchTurns = Math.ceil(\n        (research.cost.value - research.progress.value) / totalResearch\n      );\n\n    this.append(\n      s(`<h3>${civilization.leader.name} of the ${civilization._} empire</h3>`),\n      s(\n        `<p><strong>Researching</strong><br/>${\n          research.researching\n            ? `${research.researching._} ${research.progress.value} / ${\n                research.cost.value\n              } (${researchTurns} turn${researchTurns === 1 ? '' : 's'})`\n            : 'Nothing'\n        }</p>`\n      ),\n      s(\n        `<p><strong>Treasury</strong><br/>${treasury.value} (${totalGold} / turn}</p>`\n      )\n    );\n  }\n}\n\nexport default PlayerDetails;\n", "import { Player, Yield } from '../../types';\n\nexport const combinedYields = (player: Player) =>\n  player.cities.reduce(\n    (yields: Yield[], city) => yields.concat(city.yields),\n    []\n  );\n", "import { GameData, Player, PlayerResearch, Yield } from '../types';\nimport { knownIcons, reduceKnownYield } from '../lib/yieldMap';\nimport DataObserver from '../DataObserver';\nimport Window from './Window';\nimport { combinedYields } from './lib/playerYields';\nimport { renderProgress } from './lib/cityYields';\nimport { s } from '@dom111/element';\nimport { assetStore } from '../AssetStore';\n\nconst template = async (playerResearch: PlayerResearch, yields: Yield[]) => {\n  const researchIcon = await assetStore\n    .getScaled(`./assets/${knownIcons.Research}`, 2)\n    .then((image) => `<img src=\"${image.toDataURL('image/png')}\">`);\n\n  return s(\n    `<div><p><strong>Researching ${\n      playerResearch.researching ? playerResearch.researching._ : 'Nothing'\n    }</strong>${\n      playerResearch.researching\n        ? ` ${renderProgress(playerResearch, yields, 'Research')}`\n        : ''\n    }</p><p>${researchIcon} ${reduceKnownYield(\n      yields,\n      'Research'\n    )} / turn</p><div class=\"discovered\">${playerResearch.complete\n      .map((advance) => `<div>${advance._}</div>`)\n      .join('')}</div></div>`\n  );\n};\n\nexport class ScienceReport extends Window {\n  #dataObserver: DataObserver;\n  #player: Player;\n\n  constructor(player: Player) {\n    super('Player research', s('<div></div>'));\n\n    this.#player = player;\n\n    this.addClass('science-report');\n\n    this.update();\n\n    this.#dataObserver = new DataObserver(\n      [player.id, player.research.id, ...player.cities.map((city) => city.id)],\n      (data) => {\n        const player = (data as GameData).player;\n\n        this.#dataObserver.setIds([\n          player.id,\n          player.research.id,\n          ...player.cities.map((city) => city.id),\n        ]);\n\n        this.#player = player;\n\n        this.update();\n      }\n    );\n  }\n\n  close() {\n    this.#dataObserver.dispose();\n\n    return super.close();\n  }\n\n  update() {\n    template(this.#player.research, combinedYields(this.#player)).then(\n      (template) => super.update(template)\n    );\n  }\n}\n\nexport default ScienceReport;\n", "import { Element, s } from '@dom111/element';\nimport { Unit } from '../types';\n\nexport class UnitDetails extends Element {\n  #activeUnit: Unit | null;\n\n  constructor(element: HTMLElement, activeUnit: Unit | null) {\n    super(element);\n\n    this.#activeUnit = activeUnit;\n\n    this.build();\n  }\n\n  build(): void {\n    this.empty();\n\n    if (this.#activeUnit === null) {\n      return;\n    }\n\n    this.append(\n      s(\n        `<p>${this.#activeUnit._} (${this.#activeUnit.tile.x}, ${\n          this.#activeUnit.tile.y\n        })</p>`\n      ),\n      s(`<p>${this.#activeUnit.city?.name ?? 'NONE'}</p>`),\n      s(\n        `<p>${\n          Number.isInteger(this.#activeUnit.moves.value)\n            ? this.#activeUnit.moves.value\n            : this.#activeUnit.moves.value.toFixed(2)\n        } / ${this.#activeUnit.movement.value} moves</p>`\n      ),\n      s(\n        `<p>A: ${this.#activeUnit.attack.value} / D: ${\n          this.#activeUnit.defence.value\n        } / V: ${this.#activeUnit.visibility.value}</p>`\n      ),\n      s(\n        `<p>${this.#activeUnit.improvements\n          .map((improvement) => improvement._)\n          .join(', ')}</p>`\n      ),\n      s(\n        `<p>${this.#activeUnit.tile.terrain._}${\n          this.#activeUnit.tile.terrain.features\n            ? ' ' +\n              this.#activeUnit.tile.terrain.features\n                .map((feature) => feature._)\n                .join(', ')\n            : ''\n        }${\n          this.#activeUnit.tile.improvements.length\n            ? ' (' +\n              this.#activeUnit.tile.improvements\n                .map((improvement) => improvement._)\n                .join(', ') +\n              ')'\n            : ''\n        }</p>`\n      ),\n      s(\n        `<p>${this.#activeUnit.tile.units\n          .filter((unit) => unit !== this.#activeUnit)\n          .map((unit) => unit._)\n          .join(', ')}</p>`\n      )\n    );\n  }\n}\n\nexport default UnitDetails;\n", "import { Request, RequestArgs, RequestReturn } from './Request';\nimport Transport from './Transport';\n\nexport abstract class AbstractTransport implements Transport {\n  abstract receive(channel: string, handler: (...args: any[]) => void): void;\n  abstract receiveOnce(\n    channel: string,\n    handler: (...args: any[]) => void\n  ): void;\n\n  async request<\n    RequestType extends Request,\n    Args extends any[] = RequestArgs<RequestType>,\n    Return extends any = RequestReturn<RequestType>\n  >(request: Request): Promise<Return> {\n    return new Promise<Return>((resolve) => {\n      this.send(request.channel(), ...request.args());\n\n      this.receiveOnce(request.channel(), (value: Return) => resolve(value));\n    });\n  }\n\n  abstract send(channel: string, data?: any): void;\n}\n\nexport default AbstractTransport;\n", "import AbstractTransport from './AbstractTransport';\nimport { TransportMessage } from './Transport';\n\nexport class WorkerTransport extends AbstractTransport {\n  #worker;\n\n  constructor(worker: Worker) {\n    super();\n\n    this.#worker = worker;\n  }\n\n  receive(receivingChannel: string, handler: (...args: any[]) => void): void {\n    this.#worker.addEventListener('message', ({ data: { channel, data } }) => {\n      if (channel === receivingChannel) {\n        handler(data);\n      }\n    });\n  }\n\n  receiveOnce(\n    receivingChannel: string,\n    handler: (...args: any[]) => void\n  ): void {\n    const onceHandler = ({\n      data: { channel, data },\n    }: MessageEvent<TransportMessage>) => {\n      if (channel === receivingChannel) {\n        handler(data);\n\n        this.#worker.removeEventListener('message', onceHandler);\n      }\n    };\n\n    this.#worker.addEventListener('message', onceHandler);\n  }\n\n  send(channel: string, data: any): void {\n    this.#worker.postMessage({\n      channel,\n      data,\n    });\n  }\n}\n\nexport default WorkerTransport;\n", "import Renderer from './UI/Renderer';\nimport WorkerTransport from './Engine/WorkerTransport';\n\nconst renderer = new Renderer(\n  new WorkerTransport(new Worker('dist/backend.js'))\n);\n\nrenderer.init();\n"],
  "mappings": "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CC,GAAA,MAAAA,EAAS,YACZE,EAAQ,sBAAwB,IAGlCA,EAAQ,UAAUJ,EAAO,EAAG,EAAGG,EAAU,MAAOA,EAAU,MAAM,EAEzDA,CACT,EAlB0B,cAoBnBE,GAAQP,GCxBf,IAAAQ,GAAAC,GAAAC,GAAAC,GAQaC,GAAN,cAAyBC,EAK7B,CAqSD,aAAc,CACZ,MAAM,mBAAoB,SAAU,CAClC,QAAS,MACX,CAAC,EAvSHC,EAAA,KAAAN,GAAgB,IAAI,KACpBM,EAAA,KAAAL,GAAgB,IAAI,KACpBK,EAAA,KAAAJ,GAAsB,IAAI,KAC1BI,EAAA,KAAAH,GAA4B,CAC1B,yBACA,yBACA,yBACA,2BACA,qCACA,qCACA,mCACA,mCACA,kCACA,mCACA,+BACA,qCACA,qCACA,8BACA,wBACA,+BACA,0BACA,yBACA,4BACA,iCACA,iCACA,uCACA,iCACA,sCACA,uCACA,wCACA,uCACA,wCACA,wCACA,uCACA,wCACA,uCACA,mCACA,mCACA,oCACA,oCACA,mCACA,oCACA,oCACA,mCACA,wBACA,yBACA,yBACA,yBACA,yBACA,wBACA,2BACA,uBACA,kCACA,mCACA,mCACA,mCACA,gCACA,iCACA,iCACA,iCACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,4BACA,oCACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,2BACA,4BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,4BACA,4BACA,iCACA,mCACA,oCACA,qCACA,oCACA,mCACA,oCACA,qCACA,sCACA,qCACA,oCACA,qCACA,oCACA,mCACA,oCACA,mCACA,6BACA,+BACA,gCACA,iCACA,gCACA,+BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,+BACA,6BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,4BACA,iCACA,mCACA,oCACA,qCACA,oCACA,mCACA,oCACA,qCACA,sCACA,qCACA,oCACA,qCACA,oCACA,mCACA,oCACA,mCACA,6BACA,6BACA,2BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,iCACA,gCACA,qCACA,qCACA,qCACA,qCACA,6BACA,+BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,+BACA,4BACA,8BACA,4BACA,6BACA,+BACA,gCACA,iCACA,gCACA,+BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,+BACA,gCACA,+BACA,8BACA,gCACA,iCACA,kCACA,iCACA,gCACA,iCACA,kCACA,mCACA,kCACA,iCACA,kCACA,iCACA,gCACA,iCACA,gCACA,0BACA,+BACA,gCACA,4BACA,4BACA,6BACA,6BACA,8BACA,8BACA,6BACA,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,8BACA,6BACA,8BACA,6BACA,6BACA,8BACA,4BACA,8BACA,wCACA,6BACA,+BACA,6BACA,8BACA,8BACA,0BACA,8BACA,+BACA,+BACA,4BACF,EAMA,CAEA,MAAM,IAAII,EAA8B,CACtC,OAAKC,EAAA,KAAKR,IAAc,IAAIO,CAAI,GAC9BC,EAAA,KAAKR,IAAc,IAAIO,EAAO,MAAM,MAAM,IAAIA,CAAI,CAAG,EAGhDC,EAAA,KAAKR,IAAc,IAAIO,CAAI,CACpC,CAEA,MAAM,SAASA,EAAyC,CACtD,GAAI,CAACC,EAAA,KAAKP,IAAc,IAAIM,CAAI,EAAG,CACjC,IAAME,EAAQ,MAAM,KAAK,IAAIF,CAAI,EAC/BG,EAAQ,SAAS,cAAc,KAAK,EAEtCA,EAAM,IAAMD,EAAM,IAElBD,EA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",
  "names": ["require_Element", "__commonJSMin", "exports", "e", "t", "s", "o", "r", "__name", "require_EventEmitter", "__commonJSMin", "exports", "t", "e", "i", "s", "__name", "r", "import_element", "reconstituteData", "__name", "hierarchy", "objects", "orphanIds", "seenObjects", "id", "getReferences", "value", "updated", "key", "childValue", "import_element", "import_element", "_action", "_transport", "Action", "action", "transport", "__privateAdd", "__privateSet", "event", "__privateGet", "__name", "Action_default", "import_element", "template", "__name", "label", "value", "_label", "_range", "_number", "_lock", "_listeners", "LockedSlider", "currentValue", "__privateAdd", "__privateSet", "__privateGet", "handler", "listener", "LockedSlider_default", "_sliders", "LockedSliderGroup", "sliders", "__privateAdd", "__privateSet", "__privateGet", "slider", "otherSliders", "otherSlider", "otherActiveSliders", "overage", "chunk", "remaining", "total", "__name", "LockedSliderGroup_default", "import_element", "_parent", "TransientElement", "parent", "element", "__privateAdd", "event", "__privateSet", "__privateGet", "__name", "import_element", "h", "__name", "element", "handlers", "eventName", "handler", "defaultOptions", "_body", "_title", "Window", "TransientElement", "title", "body", "options", "_a", "__privateAdd", "__privateSet", "dimension", "value", "axis", "property", "headerActions", "h", "show", "element", "isDragging", "__privateGet", "event", "moveHandler", "__name", "focus", "x", "y", "elementComputedStyle", "currentTop", "currentLeft", "content", "Window_default", "instanceOfAny", "__name", "object", "constructors", "c", "idbProxyableTypes", "cursorAdvanceMethods", "getIdbProxyableTypes", "getCursorAdvanceMethods", "cursorRequestMap", "transactionDoneMap", "transactionStoreNamesMap", "transformCache", "reverseTransformCache", "promisifyRequest", "request", "promise", "resolve", "reject", "unlisten", "success", "error", "wrap", "value", "cacheDonePromiseForTransaction", "tx", "done", "complete", "idbProxyTraps", "target", "prop", "receiver", "replaceTraps", "callback", "wrapFunction", "func", "storeNames", "args", "unwrap", "transformCachableValue", "newValue", "openDB", "name", "version", "blocked", "upgrade", "blocking", "terminated", "request", "openPromise", "wrap", "event", "db", "__name", "readMethods", "writeMethods", "cachedMethods", "getMethod", "target", "prop", "targetFuncName", "useIndex", "isWrite", "method", "__name", "storeName", "args", "tx", "replaceTraps", "oldTraps", "receiver", "_connection", "_store", "Store", "db", "store", "options", "__privateAdd", "__privateSet", "openDB", "__privateGet", "key", "query", "count", "record", "__name", "scaleImage", "__name", "image", "scale", "options", "newCanvas", "context", "scaleImage_default", "_cachedAssets", "_cachedImages", "_cachedScaledImages", "_requiredAssets", "AssetStore", "Store", "__privateAdd", "path", "__privateGet", "asset", "image", "scale", "scaleImage_default", "dbAssets", "requiredAsset", "__name", "assetStore", "import_element", "_sliderGroup", "AdjustTradeRates", "Action_default", "__privateAdd", "sliders", "Window_default", "tradeRate", "slider", "LockedSlider_default", "value", "__privateGet", "__privateSet", "LockedSliderGroup_default", "assetStore", "asset", "__name", "AdjustTradeRates_default", "notificationQueue", "_options", "_NotificationWindow", "Window", "title", "body", "passedOptions", "options", "__privateAdd", "__privateSet", "event", "__privateGet", "notification", "focus", "resolve", "NotificationWindow", "__name", "NotificationWindow_default", "import_element", "_resizeHandler", "_selectionList", "SelectionWindow", "NotificationWindow", "title", "optionList", "onChoose", "body", "options", "_a", "_b", "selectionWindow", "chooseHandler", "__name", "selection", "selectionList", "h", "option", "event", "label", "action", "__privateAdd", "__privateSet", "__privateGet", "select", "e", "SelectionWindow_default", "import_element", "ChooseResearch", "Action_default", "chooseWindow", "SelectionWindow_default", "advance", "selection", "assetStore", "asset", "__name", "ChooseResearch_default", "knownGroups", "knownGroupLookup", "object", "yieldName", "group", "reduceKnownYields", "__name", "yields", "yieldNames", "cityYield", "index", "_a", "reduceKnownYield", "knownIcons", "addClass", "__name", "element", "classes", "emit", "target", "event", "emitCustom", "eventName", "params", "empty", "hasClass", "className", "off", "listener", "options", "on", "onEach", "events", "once", "removeClass", "s", "html", "childNodes", "container", "childNode", "Element", "t", "content", "toggleClass", "#element", "nodes", "node", "selector", "renderPopulation", "__name", "city", "growth", "mask", "state", "population", "s", "happiness", "unhappiness", "reduceKnownYields", "currentIndex", "status", "index", "assetStore", "image", "renderProgress", "cityData", "yields", "yieldName", "turnsText", "turnsLeft", "data", "reduceKnownYield", "turns", "yieldData", "total", "used", "free", "cityYield", "_a", "isKnown", "knownGroupLookup", "yieldImages", "icon", "knownIcons", "knownGroups", "import_element", "preloadContainer", "setPreloadContainer", "__name", "preloadContainerElement", "getPreloadedImage", "path", "image", "getPreloadedImage_default", "import_element", "replaceColours", "__name", "image", "source", "replacement", "canvas", "context", "imageData", "getColor", "input", "_a", "match", "color", "sourceColors", "replaceColors", "i", "n", "replaceColours_default", "import_element", "_canvas", "_context", "_visible", "_scale", "_tileSize", "_world", "Map", "world", "scale", "tileSize", "canvas", "__privateAdd", "__privateSet", "__privateGet", "setPreloadContainer", "tiles", "x", "y", "size", "offsetX", "offsetY", "tilesToUpdate", "path", "options", "_a", "_b", "image", "tile", "filter", "directions", "direction", "getPreloadedImage", "source", "replacement", "replaceColours_default", "visible", "__name", "Map_default", "Cities", "Map", "tile", "x", "y", "size", "offsetX", "offsetY", "city", "player", "civilization", "colors", "attribute", "image", "__name", "Cities_default", "import_element", "ConfirmationWindow", "NotificationWindow", "title", "details", "onOK", "options", "_a", "_b", "confirmationButton", "h", "event", "__name", "ConfirmationWindow_default", "_handler", "_ids", "DataObserver", "ids", "handler", "__privateAdd", "__privateSet", "event", "detail", "objects", "__privateGet", "id", "__name", "DataObserver_default", "TerrainAbstract", "Map", "tilesToUpdate", "extendedTilesToUpdate", "tile", "direction", "target", "__name", "TerrainAbstract_default", "Feature", "TerrainAbstract_default", "tile", "x", "y", "feature", "__name", "Feature_default", "Fog", "TerrainAbstract_default", "tile", "x", "y", "direction", "__name", "Fog_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "improvements", "state", "improvement", "improvementType", "improvementName", "neighbouringRoad", "adjoiningTile", "neighbouringRailroad", "direction", "size", "offsetX", "offsetY", "center", "__name", "Improvements_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "improvement", "__name", "Irrigation_default", "import_element", "Land", "TerrainAbstract_default", "tile", "x", "y", "size", "offsetX", "offsetY", "sprite", "bitmask", "topLeftSubtileOffset", "topRightSubtileOffset", "bottomRightSubtileOffset", "bottomLeftSubtileOffset", "image", "imageContext", "direction", "__name", "Land_default", "import_typed_event_emitter", "import_element", "defaultPortalOptions", "_canvas", "_center", "_context", "_layers", "_playerId", "_scale", "_tileSize", "_transport", "_world", "Portal", "world", "transport", "canvas", "options", "layers", "settings", "__privateAdd", "__privateSet", "MapType", "__privateGet", "updatedTiles", "layer", "LayerType", "_a", "x", "y", "visibleHorizontal", "visibleVertical", "xLowerBound", "xUpperBound", "yLowerBound", "yUpperBound", "tileSize", "layerWidth", "centerX", "portalCenterX", "layerHeight", "centerY", "portalCenterY", "startX", "endX", "startY", "endY", "tileRangeX", "tileRangeY", "__name", "Portal_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "adjoining", "adjoiningTile", "__name", "Terrain_default", "import_element", "busyLookup", "renderUnit", "__name", "unit", "tileSize", "_a", "_b", "player", "civilization", "colors", "attribute", "unitCanvas", "replaceColours_default", "getPreloadedImage_default", "context", "improvement", "sizeOffsetX", "sizeOffsetY", "identifier", "renderUnit_default", "_scale", "Unit", "unit", "scale", "__privateAdd", "__privateSet", "unitCanvas", "renderUnit_default", "context", "sizeX", "sizeY", "offsetX", "offsetY", "size", "__privateGet", "__name", "Unit_default", "UnitSelectionWindow", "SelectionWindow_default", "units", "transport", "onComplete", "unit", "_a", "_b", "selection", "tileUnit", "__name", "UnitSelectionWindow_default", "_unknown", "_lookupCache", "_tiles", "_height", "_width", "World", "world", "__privateAdd", "__name", "x", "y", "__privateSet", "__privateGet", "key", "index", "tile", "direction", "tiles", "World_default", "Yields", "Map_default", "tile", "x", "y", "size", "offsetX", "offsetY", "total", "tileYield", "yields", "a", "b", "i", "offsets", "n", "__name", "Yields_default", "import_element", "import_element", "SupportedUnit", "city", "unit", "yieldsToInclude", "Unit_default", "cityYield", "yieldImages", "__name", "reduceYield", "__name", "type", "cityYields", "cityYield", "knownGroupLookup", "used", "free", "renderYields", "city", "cityYieldNames", "cityYieldName", "n", "i", "yieldImages", "knownGroups", "yieldObject", "label", "value", "resizeYields", "element", "yieldWrappers", "container", "currentMaxWidth", "renderMap", "portal", "transport", "portalCanvas", "cityPortal", "Portal_default", "World_default", "Land_default", "Irrigation_default", "Terrain_default", "Improvements_default", "Feature_default", "Fog_default", "Cities_default", "Yields_default", "h", "renderBuild", "chooseProduction", "completeProduction", "renderProgress", "renderGrowth", "renderImprovements", "improvement", "renderGarrisonedUnits", "unit", "Unit_default", "cityPlayerUnits", "UnitSelectionWindow_default", "renderSupportedUnits", "SupportedUnit", "cityDetails", "renderPopulation", "_city", "_dataObserver", "_portal", "_transport", "City", "Window_default", "__privateAdd", "__privateSet", "DataObserver_default", "data", "_a", "_b", "updatedCity", "cityData", "__privateGet", "event", "resizeHandler", "CityBuildSelectionWindow_default", "ConfirmationWindow_default", "City_default", "_onComplete", "_transport", "CityBuildSelectionWindow", "SelectionWindow", "cityBuild", "transport", "onComplete", "additionalActions", "turns", "__name", "buildItem", "reduceKnownYield", "selection", "__privateAdd", "__privateSet", "hasSelected", "__privateGet", "city", "portal", "selectionWindow", "City_default", "CityBuildSelectionWindow_default", "import_element", "_portal", "CityBuild", "Action_default", "action", "portal", "transport", "__privateAdd", "__privateSet", "CityBuildSelectionWindow_default", "__privateGet", "cityBuild", "assetStore", "asset", "__name", "CityBuild_default", "import_element", "EndTurn", "Action_default", "__name", "EndTurn_default", "import_element", "Revolution", "Action_default", "chooseWindow", "SelectionWindow_default", "government", "selection", "assetStore", "asset", "__name", "Revolution_default", "_portal", "_transport", "Actions", "container", "portal", "transport", "__privateAdd", "__privateSet", "event", "_a", "currentChild", "key", "children", "currentAction", "currentIndex", "actions", "playerAction", "action", "AdjustTradeRates_default", "__privateGet", "ChooseResearch_default", "CityBuild_default", "EndTurn_default", "Revolution_default", "h", "__name", "Actions_default", "_activeUnit", "Units", "Map", "__privateAdd", "tile", "x", "y", "size", "offsetX", "offsetY", "__privateGet", "unit", "a", "b", "_a", "_b", "image", "renderUnit_default", "__privateSet", "__name", "Units_default", "ActiveUnit", "Units_default", "activeUnit", "x", "y", "tile", "size", "offsetX", "offsetY", "image", "__name", "ActiveUnit_default", "CityNames", "Map", "tile", "x", "y", "size", "offsetX", "offsetY", "city", "sizeOffsetX", "sizeOffsetY", "textOffsetX", "textOffsetY", "__name", "CityNames_default", "import_element", "buildCityRow", "__name", "city", "food", "production", "trade", "research", "gold", "luxuries", "yieldName", "yieldData", "foodIcon", "productionIcon", "tradeIcon", "researchIcon", "goldIcon", "luxuriesIcon", "assetStore", "knownIcons", "image", "turnsText", "turnsLeft", "total", "free", "icon", "_cities", "_dataObserver", "_portal", "_transport", "CityStatus", "Window_default", "player", "portal", "transport", "__privateAdd", "__privateSet", "DataObserver_default", "id", "build", "growth", "data", "__privateGet", "rows", "name", "yields", "index", "row", "element", "containerNodeName", "container", "h", "City_default", "CityStatus_default", "import_element", "_turn", "_year", "GameDetails", "element", "turn", "year", "__privateAdd", "__privateSet", "__privateGet", "__name", "GameDetails_default", "import_element", "GamePortal", "Portal_default", "event", "centerTile", "canvasCenterOffset", "x", "y", "tile", "playerTileUnits", "unit", "City_default", "UnitSelectionWindow_default", "__name", "GamePortal_default", "Terrain", "TerrainAbstract_default", "tile", "x", "y", "__name", "GoodyHuts_default", "import_element", "buildCityRow", "__name", "city", "happinessReasons", "cityYield", "Unit_default", "SupportedUnit", "reasons", "renderPopulation", "_dataObserver", "_player", "HappinessReport", "Window_default", "player", "__privateAdd", "__privateSet", "DataObserver_default", "data", "__privateGet", "rows", "HappinessReport_default", "_paused", "_stack", "IntervalHandler", "tick", "__privateAdd", "__privateGet", "item", "__privateSet", "handler", "__name", "IntervalHandler_default", "import_element", "_args", "_channel", "Request", "channel", "args", "__privateAdd", "__privateSet", "__privateGet", "__name", "Request_default", "Options", "Request_default", "args", "__name", "Options_default", "import_element", "_onFinished", "_transport", "CustomiseWorldWindow", "Window_default", "transport", "onFinished", "__privateAdd", "__privateSet", "_a", "_b", "_c", "_d", "_e", "_f", "existingValues", "__privateGet", "Options_default", "playersInput", "heightInput", "widthInput", "landCoverageInput", "landSizeInput", "maxIterationsInput", "submit", "__name", "Request_default", "h", "event", "CustomiseWorldWindow_default", "MandatorySelection", "SelectionWindow", "title", "optionList", "onChoose", "body", "options", "resolve", "detail", "__name", "MandatorySelection_default", "NewGameWindow", "MandatorySelection_default", "transport", "onFinished", "selection", "Request_default", "__name", "NewGameWindow_default", "EarthWindow", "NewGameWindow", "transport", "onFinished", "Request_default", "__name", "EarthWindow_default", "BinFile", "content", "callback", "b1", "length", "start", "__name", "BinFile_default", "LZWDictionary", "maxBits", "i", "pos", "entry", "__name", "LZWDictionary_default", "LZW", "binFile", "remainingCodedBytes", "uByteMode", "parsedIndexes", "usableBits", "usableBitCount", "indicatorLength", "indicatorFlag", "nextThreshold", "decodedCounter", "index", "inputData", "dicIndexMaxBits", "codedData", "decodedData", "dic", "LZWDictionary_default", "plainData", "oldCode", "buffer", "character", "newCode", "i", "p", "byteArr", "opt", "lastChr", "isFlag", "chr", "j", "__name", "LZW_default", "lowerNibble", "__name", "byte", "lowerNibble_default", "upperNibble", "__name", "byte", "upperNibble_default", "PicImage", "BinFile_default", "callback", "id", "length", "i", "firstIndex", "lastIndex", "paletteLength", "seenBlack", "colour", "decompSourceData", "LZW_default", "decompData", "oldImageData", "lowerNibble_default", "upperNibble_default", "ctx", "destinationX", "destinationY", "canvasData", "index", "y", "x", "colorIndex", "canvasIndex", "__name", "PicImage_default", "extractSprites", "__name", "content", "extractData", "defaults", "canvasProvider", "logger", "message", "canvas", "image", "PicImage_default", "result", "path", "definitionParents", "definition", "object", "filename", "contentCanvas", "context", "x", "y", "imageData", "import_element", "_fileInput", "_progressInformation", "ImportAssetsWindow", "Window_default", "fileInput", "progressInformation", "extract_data_default", "h", "event", "__privateAdd", "__privateSet", "_a", "__privateGet", "files", "filenames", "file", "key", "expectedMatch", "filename", "results", "resolve", "definitions", "reader", "extractSprites", "width", "height", "canvas", "message", "record", "assetStore", "__name", "ImportAssetsWindow_default", "_transport", "MainMenu", "element", "transport", "__privateAdd", "__privateSet", "showQuit", "hasAssets", "assetStore", "h", "NewGameWindow_default", "__privateGet", "EarthWindow_default", "CustomiseWorldWindow_default", "ImportAssetsWindow_default", "event", "currentTarget", "version", "__name", "MainMenu_default", "import_element", "_context", "_element", "_layers", "_portal", "_world", "Minimap", "element", "world", "portal", "layers", "__privateAdd", "__privateSet", "__privateGet", "event", "x", "y", "tileX", "tileY", "targetHeight", "layer", "start", "end", "__name", "Minimap_default", "_container", "_notifications", "Notifications", "container", "__privateAdd", "__privateSet", "notification", "__privateGet", "active", "_a", "NotificationWindow_default", "__name", "Notifications_default", "import_element", "_player", "PlayerDetails", "element", "player", "__privateAdd", "__privateSet", "civilization", "treasury", "research", "cities", "__privateGet", "totalGold", "totalResearch", "city", "cityGold", "cityResearch", "reduceKnownYields", "researchTurns", "__name", "PlayerDetails_default", "combinedYields", "__name", "player", "yields", "city", "import_element", "template", "__name", "playerResearch", "yields", "researchIcon", "assetStore", "knownIcons", "image", "renderProgress", "reduceKnownYield", "advance", "_dataObserver", "_player", "ScienceReport", "Window_default", "player", "__privateAdd", "__privateSet", "DataObserver_default", "city", "data", "__privateGet", "combinedYields", "ScienceReport_default", "import_element", "_activeUnit", "UnitDetails", "element", "activeUnit", "__privateAdd", "__privateSet", "_a", "_b", "__privateGet", "improvement", "feature", "unit", "__name", "UnitDetails_default", "_transport", "Renderer", "transport", "__privateAdd", "__privateSet", "__privateGet", "assetStore", "hasAllAssets", "scaledCursor", "event", "ConfirmationWindow_default", "options", "notificationArea", "mainMenuElement", "actionArea", "secondaryActionArea", "gameArea", "mapWrapper", "mapPortal", "gameInfo", "playerInfo", "minimapCanvas", "unitInfo", "preloadContainer", "notifications", "Notifications_default", "mainMenu", "MainMenu_default", "setActiveUnit", "__name", "unit", "portal", "unitsMap", "activeUnitsMap", "unitDetails", "UnitDetails_default", "activeUnit", "lastUnit", "records", "record", "h", "tilesToRender", "globalNotificationTimer", "data", "channel", "label", "rawData", "choices", "reconstituteData", "SelectionWindow_default", "choice", "objectMap", "formatter", "NotificationWindow_default", "advance", "activeUnits", "scale", "world", "World_default", "intervalHandler", "IntervalHandler_default", "GamePortal_default", "Land_default", "Irrigation_default", "Terrain_default", "Improvements_default", "Feature_default", "GoodyHuts_default", "Fog_default", "Yields_default", "Units_default", "Cities_default", "CityNames_default", "ActiveUnit_default", "landMap", "yieldsMap", "citiesMap", "cityNamesMap", "minimap", "Minimap_default", "primaryActions", "Actions_default", "secondaryActions", "handler", "action", "GameDetails_default", "PlayerDetails_default", "activeUnitAction", "unitA", "unitB", "pathToParts", "path", "getPenultimateObject", "object", "parts", "lastPart", "tmpObj", "part", "setObjectPath", "value", "removeObjectPath", "patch", "key", "type", "index", "keyToActionsMap", "directionKeyMap", "directionKeyMapNumpad", "directionKeyTypeMap", "leaderScreensMap", "CityStatus_default", "HappinessReport_default", "ScienceReport_default", "lastKey", "actions", "actionName", "unitAction", "topAction", "units", "current", "e", "Renderer_default", "AbstractTransport", "request", "resolve", "value", "__name", "AbstractTransport_default", "_worker", "WorkerTransport", "AbstractTransport_default", "worker", "__privateAdd", "__privateSet", "receivingChannel", "handler", "__privateGet", "channel", "data", "onceHandler", "__name", "WorkerTransport_default", "renderer", "Renderer_default", "WorkerTransport_default"]
}
